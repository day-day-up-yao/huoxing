(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[10],{1103:function(e,t,n){var r;r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=79)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.util=t.PresentationMode=void 0,t.createDom=a,t.hasClass=s,t.addClass=u,t.removeClass=l,t.toggleClass=c,t.findDom=d,t.padStart=f,t.format=p,t.event=h,t.typeOf=g,t.deepCopy=v,t.getBgImage=m,t.copyDom=y,t._setInterval=_,t._clearInterval=b,t.createImgBtn=S,t.isWeiXin=k,t.isUc=w,t.computeWatchDur=E,t.offInDestroy=T,t.on=x,t.once=C,t.getBuffered2=I,t.checkIsBrowser=R,t.setStyle=A,t.checkWebkitSetPresentationMode=function(e){return"function"==typeof e.webkitSetPresentationMode};var r,i=n(7),o=(r=i)&&r.__esModule?r:{default:r};function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=r,i.innerHTML=t,Object.keys(n).forEach(function(t){var r=t,o=n[t];"video"===e||"audio"===e?o&&i.setAttribute(r,o):i.setAttribute(r,o)}),i}function s(e,t){return!!e&&(e.classList?Array.prototype.some.call(e.classList,function(e){return e===t}):!!e.className&&!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)")))}function u(e,t){e&&(e.classList?t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(t){t&&e.classList.add(t)}):s(e,t)||(e.className+=" "+t))}function l(e,t){e&&(e.classList?t.split(/\s+/g).forEach(function(t){e.classList.remove(t)}):s(e,t)&&t.split(/\s+/g).forEach(function(t){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}))}function c(e,t){e&&t.split(/\s+/g).forEach(function(t){s(e,t)?l(e,t):u(e,t)})}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=arguments[1],n=void 0;try{n=e.querySelector(t)}catch(r){0===t.indexOf("#")&&(n=e.getElementById(t.slice(1)))}return n}function f(e,t,n){for(var r=String(n),i=t>>0,o=Math.ceil(i/r.length),a=[],s=String(e);o--;)a.push(r);return a.join("").substring(0,i-s.length)+s}function p(e){if(window.isNaN(e))return"";var t=f(Math.floor(e/3600),2,0),n=f(Math.floor((e-3600*t)/60),2,0),r=f(Math.floor(e-3600*t-60*n),2,0);return("00"===t?[n,r]:[t,n,r]).join(":")}function h(e){if(e.touches){var t=e.touches[0]||e.changedTouches[0];e.clientX=t.clientX||0,e.clientY=t.clientY||0,e.offsetX=t.pageX-t.target.offsetLeft,e.offsetY=t.pageY-t.target.offsetTop}e._target=e.target||e.srcElement}function g(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}function v(e,t){if("Object"===g(t)&&"Object"===g(e))return Object.keys(t).forEach(function(n){"Object"!==g(t[n])||t[n]instanceof Node?"Array"===g(t[n])?e[n]="Array"===g(e[n])?e[n].concat(t[n]):t[n]:e[n]=t[n]:e[n]?v(e[n],t[n]):e[n]=t[n]}),e}function m(e){var t=(e.currentStyle||window.getComputedStyle(e,null)).backgroundImage;if(!t||"none"===t)return"";var n=document.createElement("a");return n.href=t.replace(/url\("|"\)/g,""),n.href}function y(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,function(e){t.setAttribute(e.name,e.value)}),e.innerHTML&&(t.innerHTML=e.innerHTML),t}return""}function _(e,t,n,r){e._interval[t]||(e._interval[t]=setInterval(n.bind(e),r))}function b(e,t){clearInterval(e._interval[t]),e._interval[t]=null}function S(e,t,n,r){var i=a("xg-"+e,"",{},"xgplayer-"+e+"-img");if(i.style.backgroundImage='url("'+t+'")',n&&r){var o=void 0,s=void 0,u=void 0;["px","rem","em","pt","dp","vw","vh","vm","%"].every(function(e){return!(n.indexOf(e)>-1&&r.indexOf(e)>-1)||(o=Number(n.slice(0,n.indexOf(e)).trim()),s=Number(r.slice(0,r.indexOf(e)).trim()),u=e,!1)}),i.style.width=""+o+u,i.style.height=""+s+u,i.style.backgroundSize=""+o+u+" "+s+u,i.style.margin="start"===e?"-"+s/2+u+" auto auto -"+o/2+u:"auto 5px auto 5px"}return i}function k(){return window.navigator.userAgent.toLowerCase().indexOf("micromessenger")>-1}function w(){return window.navigator.userAgent.toLowerCase().indexOf("ucbrowser")>-1}function E(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[],n=0;n<e.length;n++)if(!(!e[n].end||e[n].begin<0||e[n].end<0||e[n].end<e[n].begin))if(t.length<1)t.push({begin:e[n].begin,end:e[n].end});else for(var r=0;r<t.length;r++){var i=e[n].begin,o=e[n].end;if(o<t[r].begin){t.splice(r,0,{begin:i,end:o});break}if(!(i>t[r].end)){var a=t[r].begin,s=t[r].end;t[r].begin=Math.min(i,a),t[r].end=Math.max(o,s);break}if(r>t.length-2){t.push({begin:i,end:o});break}}for(var u=0,l=0;l<t.length;l++)u+=t[l].end-t[l].begin;return u}function T(e,t,n,r){e.once(r,function i(){e.off(t,n),e.off(r,i)})}function x(e,t,n,r){if(r)e.on(t,n),T(e,t,n,r);else{e.on(t,function r(i){n(i),e.off(t,r)})}}function C(e,t,n,r){if(r)e.once(t,n),T(e,t,n,r);else{e.once(t,function r(i){n(i),e.off(t,r)})}}function I(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=[],r=0;r<e.length;r++)n.push({start:e.start(r)<.5?0:e.start(r),end:e.end(r)});n.sort(function(e,t){var n=e.start-t.start;return n||t.end-e.end});var i=[];if(t)for(var a=0;a<n.length;a++){var s=i.length;if(s){var u=i[s-1].end;n[a].start-u<t?n[a].end>u&&(i[s-1].end=n[a].end):i.push(n[a])}else i.push(n[a])}else i=n;return new o.default(i)}function R(){return!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)}function A(e,t,n){var r=e.style;try{r[t]=n}catch(e){r.setProperty(t,n)}}t.PresentationMode={PIP:"picture-in-picture",INLINE:"inline",FULLSCREEN:"fullscreen"};t.util={createDom:a,hasClass:s,addClass:u,removeClass:l,toggleClass:c,findDom:d,padStart:f,format:p,event:h,typeOf:g,deepCopy:v,getBgImage:m,copyDom:y,setInterval:_,clearInterval:b,createImgBtn:S,isWeiXin:k,isUc:w,computeWatchDur:E,offInDestroy:T,on:x,once:C,getBuffered2:I,checkIsBrowser:R,setStyle:A}},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var i=(a=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),o=r.sources.map(function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"});return[n].concat(o).concat([i]).join("\n")}var a;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(r[o]=!0)}for(i=0;i<e.length;i++){var a=e[i];"number"==typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},function(e,t,n){var r,i,o={},a=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=r.apply(this,arguments)),i}),s=function(e){var t={};return function(e){if("function"==typeof e)return e();if(void 0===t[e]){var n=function(e){return document.querySelector(e)}.call(this,e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),u=null,l=0,c=[],d=n(36);function f(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=o[r.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](r.parts[a]);for(;a<r.parts.length;a++)i.parts.push(y(r.parts[a],t))}else{var s=[];for(a=0;a<r.parts.length;a++)s.push(y(r.parts[a],t));o[r.id]={id:r.id,refs:1,parts:s}}}}function p(e,t){for(var n=[],r={},i=0;i<e.length;i++){var o=e[i],a=t.base?o[0]+t.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};r[a]?r[a].parts.push(s):n.push(r[a]={id:a,parts:[s]})}return n}function h(e,t){var n=s(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=c[c.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),c.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=s(e.insertInto+" "+e.insertAt.before);n.insertBefore(t,i)}}function g(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=c.indexOf(e);t>=0&&c.splice(t,1)}function v(e){var t=document.createElement("style");return e.attrs.type="text/css",m(t,e.attrs),h(e,t),t}function m(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function y(e,t){var n,r,i,o;if(t.transform&&e.css){if(!(o=t.transform(e.css)))return function(){};e.css=o}if(t.singleton){var a=l++;n=u||(u=v(t)),r=S.bind(null,n,a,!1),i=S.bind(null,n,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return e.attrs.type="text/css",e.attrs.rel="stylesheet",m(t,e.attrs),h(e,t),t}(t),r=function(e,t,n){var r=n.css,i=n.sourceMap,o=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||o)&&(r=d(r));i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var a=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,n,t),i=function(){g(n),n.href&&URL.revokeObjectURL(n.href)}):(n=v(t),r=function(e,t){var n=t.css,r=t.media;r&&e.setAttribute("media",r);if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),i=function(){g(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=p(e,t);return f(n,t),function(e){for(var r=[],i=0;i<n.length;i++){var a=n[i];(s=o[a.id]).refs--,r.push(s)}e&&f(p(e,t),t);for(i=0;i<r.length;i++){var s;if(0===(s=r[i]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete o[s.id]}}}};var _,b=(_=[],function(e,t){return _[e]=t,_.filter(Boolean).join("\n")});function S(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=b(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}},function(e,t,n){"use strict";var r=n(24)();e.exports=function(e){return e!==r&&null!==e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8);var i={network:{code:1,msg:"视频下载错误",remark:"只要视频下载错误就使用此类型，无论是video本身的超时还是xhr的分段请求超时或者资源不存在"},mse:{code:2,msg:"流追加错误",remark:"追加流的时候如果类型不对、无法被正确解码则会触发此类错误"},parse:{code:3,msg:"解析错误",remark:"mp4、hls、flv我们都是使用js进行格式解析，如果解析失败则会触发此类错误"},format:{code:4,msg:"格式错误",remark:"如果浏览器不支持的格式导致播放错误"},decoder:{code:5,msg:"解码错误",remark:"浏览器解码异常会抛出此类型错误"},runtime:{code:6,msg:"语法错误",remark:"播放器语法错误"},timeout:{code:7,msg:"播放超时",remark:"播放过程中无法正常请求下一个分段导致播放中断"},other:{code:8,msg:"其他错误",remark:"不可知的错误或被忽略的错误类型"}};t.default=function e(t,n,o,a,s,u,l,c){var d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{line:"",handle:"",msg:"",version:""},f=arguments[9],p=arguments[10];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var h={};if(arguments.length>1)h.playerVersion=r.version,h.errorType=t,h.domain=document.domain,h.duration=o,h.currentTime=n,h.networkState=a,h.readyState=s,h.currentSrc=l,h.src=u,h.ended=c,h.errd=d,h.ex=(i[t]||{}).msg,h.errorCode=f,h.mediaError=p;else{var g=arguments[0];Object.keys(g).map(function(e){h[e]=g[e]}),h.ex=(g.type&&i[g.type]||{}).msg}return h},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};Object.defineProperty(r,"device",{get:function(){return r.os.isPc?"pc":"mobile"}}),Object.defineProperty(r,"browser",{get:function(){var e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firfox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter(function(n){return t[n].test(e)}))[0]||""}}),Object.defineProperty(r,"os",{get:function(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),n=/(?:SymbianOS)/.test(e)||t,r=/(?:Android)/.test(e),i=/(?:Firefox)/.test(e),o=/(?:iPad|PlayBook)/.test(e)||r&&!/(?:Mobile)/.test(e)||i&&/(?:Tablet)/.test(e),a=/(?:iPhone)/.test(e)&&!o;return{isTablet:o,isPhone:a,isAndroid:r,isPc:!(a||r||n||o),isSymbian:n,isWindowsPhone:t,isFireFox:i}}}),t.default=r,e.exports=t.default},function(e,t,n){"use strict";e.exports=function(e){return null!=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bufferedList=t}return r(e,[{key:"start",value:function(e){return this.bufferedList[e].start}},{key:"end",value:function(e){return this.bufferedList[e].end}},{key:"length",get:function(){return this.bufferedList.length}}]),e}();t.default=i,e.exports=t.default},function(e){e.exports=JSON.parse('{"version":"2.32.1"}')},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=f(n(11)),o=n(0),a=f(n(5)),s=f(n(7)),u=f(n(4)),l=f(n(31)),c=f(n(10));n(34);var d=n(8);function f(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(n.config=(0,o.deepCopy)({width:600,height:337.5,ignores:[],whitelist:[],lang:(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase(),inactive:3e3,volume:.6,controls:!0,controlsList:["nodownload"]},e),n.version=d.version,n.userTimer=null,n.waitTimer=null,n.history=[],n.isProgressMoving=!1,n.root=(0,o.findDom)(document,"#"+n.config.id),n.controls=(0,o.createDom)("xg-controls","",{unselectable:"on",onselectstart:"return false"},"xgplayer-controls"),n.config.isShowControl&&(n.controls.style.display="none"),!n.root){var r=n.config.el;if(!r||1!==r.nodeType)return n.emit("error",new u.default({type:"use",errd:{line:45,handle:"Constructor",msg:"container id can't be empty"},vid:n.config.vid})),console.error("container id can't be empty"),!1,p(n,!1);n.root=r}if((0,o.addClass)(n.root,"xgplayer xgplayer-"+a.default.device+" xgplayer-nostart xgplayer-pause "+(n.config.controls?"":"xgplayer-no-controls")),n.root.appendChild(n.controls),n.config.fluid?(n.root.style["max-width"]="100%",n.root.style.width="100%",n.root.style.height="0",n.root.style["padding-top"]=100*n.config.height/n.config.width+"%",n.video.style.position="absolute",n.video.style.top="0",n.video.style.left="0"):(n.config.width&&("number"!=typeof n.config.width?n.root.style.width=n.config.width:n.root.style.width=n.config.width+"px"),n.config.height&&("number"!=typeof n.config.height?n.root.style.height=n.config.height:n.root.style.height=n.config.height+"px")),n.config.execBeforePluginsCall&&n.config.execBeforePluginsCall.forEach(function(e){e.call(n,n)}),n.config.closeI18n||t.install(c.default.name,c.default.method),n.config.controlStyle&&"String"===(0,o.typeOf)(n.config.controlStyle)){var i=n;fetch(i.config.controlStyle,{method:"GET",headers:{Accept:"application/json"}}).then(function(e){e.ok&&e.json().then(function(e){for(var t in e)e.hasOwnProperty(t)&&(i.config[t]=e[t]);i.pluginsCall()})}).catch(function(e){console.log("Fetch错误:"+e)})}else n.pluginsCall();n.config.controlPlugins&&t.controlsRun(n.config.controlPlugins,n),n.ev.forEach(function(e){var t=Object.keys(e)[0],r=n[e[t]];r&&n.on(t,r)}),["focus","blur"].forEach(function(e){n.on(e,n["on"+e.charAt(0).toUpperCase()+e.slice(1)])});var s=n;return n.mousemoveFunc=function(){s.emit("focus"),s.config.closeFocusVideoFocus||s.video.focus()},n.root.addEventListener("mousemove",n.mousemoveFunc),n.playFunc=function(){s.emit("focus"),s.config.closePlayVideoFocus||s.video.focus()},s.once("play",n.playFunc),n.getVideoSize=function(){if(this.video.videoWidth&&this.video.videoHeight){var e=s.root.getBoundingClientRect();"auto"===s.config.fitVideoSize?e.width/e.height>this.video.videoWidth/this.video.videoHeight?s.root.style.height=this.video.videoHeight/this.video.videoWidth*e.width+"px":s.root.style.width=this.video.videoWidth/this.video.videoHeight*e.height+"px":"fixWidth"===s.config.fitVideoSize?s.root.style.height=this.video.videoHeight/this.video.videoWidth*e.width+"px":"fixHeight"===s.config.fitVideoSize&&(s.root.style.width=this.video.videoWidth/this.video.videoHeight*e.height+"px")}},s.once("loadeddata",n.getVideoSize),setTimeout(function(){n.emit("ready"),n.isReady=!0},0),n.config.videoInit&&(0,o.hasClass)(n.root,"xgplayer-nostart")&&n.start(),s.config.rotate&&(s.on("requestFullscreen",n.updateRotateDeg),s.on("exitFullscreen",n.updateRotateDeg)),s.once("destroy",function e(){s.root.removeEventListener("mousemove",s.mousemoveFunc),s.off("destroy",e)}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),r(t,[{key:"attachVideo",value:function(){var e=this;this.video&&1===this.video.nodeType&&this.root.insertBefore(this.video,this.root.firstChild),setTimeout(function(){e.emit("complete"),e.danmu&&"function"==typeof e.danmu.resize&&e.danmu.resize()},1)}},{key:"start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.url;if(this.video){var n=this;t&&""!==t?(this.canPlayFunc=function(){n.off("canplay",n.canPlayFunc);var e=n.video.play();void 0!==e&&e&&e.then(function(){n.emit("autoplay started")}).catch(function(){n.emit("autoplay was prevented"),(0,o.addClass)(n.root,"xgplayer-is-autoplay")})},"Array"!==(0,o.typeOf)(t)?"String"===(0,o.typeOf)(t)&&t.indexOf("blob:")>-1&&t===this.video.src||(this.video.src=t):t.forEach(function(t){e.video.appendChild((0,o.createDom)("source","",{src:""+t.src,type:""+(t.type||"")}))}),this.config.autoplay&&(a.default.os.isPhone?this.canPlayFunc():this.on("canplay",this.canPlayFunc)),this.config.disableStartLoad||this.video.load(),this.attachVideo()):this.emit("urlNull")}}},{key:"reload",value:function(){this.video.load(),this.reloadFunc=function(){var e=this.play();void 0!==e&&e&&e.catch(function(e){})},this.once("loadeddata",this.reloadFunc)}},{key:"destroy",value:function(){var e=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=this;for(var i in clearInterval(this.bulletResizeTimer),this._interval)clearInterval(this._interval[i]),this._interval[i]=null;this.checkTimer&&clearInterval(this.checkTimer),this.waitTimer&&clearTimeout(this.waitTimer),this.ev.forEach(function(t){var n=Object.keys(t)[0],r=e[t[n]];r&&e.off(n,r)}),this.loadeddataFunc&&this.off("loadeddata",this.loadeddataFunc),this.reloadFunc&&this.off("loadeddata",this.reloadFunc),this.replayFunc&&this.off("play",this.replayFunc),this.playFunc&&this.off("play",this.playFunc),this.getVideoSize&&this.off("loadeddata",this.getVideoSize),["focus","blur"].forEach(function(t){e.off(t,e["on"+t.charAt(0).toUpperCase()+t.slice(1)])}),this.config.keyShortcut&&"on"!==this.config.keyShortcut||["video","controls"].forEach(function(t){e[t]&&e[t].removeEventListener("keydown",function(e){r.onKeydown(e,r)})}),function(){if(this.emit("destroy"),this.video.removeAttribute("src"),this.video.load(),n){this.root.innerHTML="";var e=this.root.className.split(" ");e.length>0?this.root.className=e.filter(function(e){return e.indexOf("xgplayer")<0}).join(" "):this.root.className=""}for(var t in this)delete this[t];(0,l.default)(this)}.call(this),function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"replay",value:function(){var e=this._replay;if((0,o.removeClass)(this.root,"xgplayer-ended"),a.default.browser.indexOf("ie")>-1&&(this.emit("play"),this.emit("playing")),e&&e instanceof Function)e();else{this.currentTime=0;var t=this.play();void 0!==t&&t&&t.catch(function(e){})}}},{key:"userGestureTrigEvent",value:function(e,t){var n=this,r=function(e,t){n.emit(e,t)};this.config.userGestureEventMiddleware&&"function"==typeof this.config.userGestureEventMiddleware[e]?this.config.userGestureEventMiddleware[e].call(this,this,e,t,r):r.call(this,e,t)}},{key:"pluginsCall",value:function(){var e=this;t.plugins.s_i18n&&t.plugins.s_i18n.call(this,this);var n=this;if(t.plugins){var r=this.config.ignores;Object.keys(t.plugins).forEach(function(i){var o=t.plugins[i];o&&"function"==typeof o?r.some(function(e){return i===e||i==="s_"+e})||"s_i18n"===i||(["pc","tablet","mobile"].some(function(e){return e===i})?i===a.default.device&&setTimeout(function(){n.video&&o.call(n,n)},0):o.call(e,e)):console.warn("plugin name",i,"is invalid")})}}},{key:"onFocus",value:function(){var e=this;(0,o.hasClass)(this.root,"xgplayer-inactive")&&e.emit("controlShow"),(0,o.removeClass)(this.root,"xgplayer-inactive"),e.userTimer&&clearTimeout(e.userTimer),e.userTimer=setTimeout(function(){e.emit("blur")},e.config.inactive)}},{key:"onBlur",value:function(){!this.config.enablePausedInactive&&this.paused||this.ended||this.config.closeInactive||((0,o.hasClass)(this.root,"xgplayer-inactive")||this.emit("controlHide"),(0,o.addClass)(this.root,"xgplayer-inactive"))}},{key:"onPlay",value:function(){(0,o.addClass)(this.root,"xgplayer-isloading"),(0,o.addClass)(this.root,"xgplayer-playing"),(0,o.removeClass)(this.root,"xgplayer-pause")}},{key:"onPause",value:function(){(0,o.addClass)(this.root,"xgplayer-pause"),this.userTimer&&clearTimeout(this.userTimer),this.emit("focus")}},{key:"onEnded",value:function(){(0,o.addClass)(this.root,"xgplayer-ended"),(0,o.removeClass)(this.root,"xgplayer-playing")}},{key:"onSeeking",value:function(){this.isSeeking=!0,this.onWaiting()}},{key:"onSeeked",value:function(){var e=this;this.once("timeupdate",function(){e.isSeeking=!1}),this.waitTimer&&clearTimeout(this.waitTimer),(0,o.removeClass)(this.root,"xgplayer-isloading")}},{key:"onWaiting",value:function(){var e=this;e.waitTimer&&clearTimeout(e.waitTimer),e.checkTimer&&(clearInterval(e.checkTimer),e.checkTimer=null);var t=e.currentTime;e.waitTimer=setTimeout(function(){(0,o.addClass)(e.root,"xgplayer-isloading"),e.checkTimer=setInterval(function(){e.currentTime!==t&&((0,o.removeClass)(e.root,"xgplayer-isloading"),clearInterval(e.checkTimer),e.checkTimer=null)},1e3)},500)}},{key:"onPlaying",value:function(){this.paused||(this.isSeeking=!1,this.waitTimer&&clearTimeout(this.waitTimer),(0,o.removeClass)(this.root,"xgplayer-isloading xgplayer-nostart xgplayer-pause xgplayer-ended xgplayer-is-error xgplayer-replay"),(0,o.addClass)(this.root,"xgplayer-playing"))}}],[{key:"install",value:function(e,n){(0,o.checkIsBrowser)()&&(t.plugins||(t.plugins={}),t.plugins[e]||(t.plugins[e]=n))}},{key:"installAll",value:function(e){for(var n=0;n<e.length;n++)t.install(e[n].name,e[n].method)}},{key:"use",value:function(e,n){t.plugins||(t.plugins={}),t.plugins[e]=n}},{key:"useAll",value:function(e){for(var n in e)t.use(e[n].name,e[n].method)}},{key:"controlsRun",value:function(e,t){e.forEach(function(e){e.method.call(t)})}}]),t}();h.util=o.util,h.sniffer=a.default,h.Errors=u.default,h.XgplayerTimeRange=s.default,t.default=h,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={name:"s_i18n",method:function(){var e=this,t={en:{HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"Pip",MINIPLAYER:"Miniplayer",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",MINIPLAYER_DRAG:"Click and hold to drag",AIRPLAY_TIPS:"Airplay"},"zh-cn":{HAVE_NOTHING:"没有关于音频/视频是否就绪的信息",HAVE_METADATA:"音频/视频的元数据已就绪",HAVE_CURRENT_DATA:"关于当前播放位置的数据是可用的，但没有足够的数据来播放下一帧/毫秒",HAVE_FUTURE_DATA:"当前及至少下一帧的数据是可用的",HAVE_ENOUGH_DATA:"可用数据足以开始播放",NETWORK_EMPTY:"音频/视频尚未初始化",NETWORK_IDLE:"音频/视频是活动的且已选取资源，但并未使用网络",NETWORK_LOADING:"浏览器正在下载数据",NETWORK_NO_SOURCE:"未找到音频/视频来源",MEDIA_ERR_ABORTED:"取回过程被用户中止",MEDIA_ERR_NETWORK:"当下载时发生错误",MEDIA_ERR_DECODE:"当解码时发生错误",MEDIA_ERR_SRC_NOT_SUPPORTED:"不支持的音频/视频格式",REPLAY:"重播",ERROR:"网络连接似乎出现了问题",PLAY_TIPS:"播放",PAUSE_TIPS:"暂停",PLAYNEXT_TIPS:"下一集",DOWNLOAD_TIPS:"下载",ROTATE_TIPS:"旋转",RELOAD_TIPS:"重新载入",FULLSCREEN_TIPS:"进入全屏",EXITFULLSCREEN_TIPS:"退出全屏",CSSFULLSCREEN_TIPS:"进入样式全屏",EXITCSSFULLSCREEN_TIPS:"退出样式全屏",TEXTTRACK:"字幕",PIP:"画中画",MINIPLAYER:"迷你播放器",SCREENSHOT:"截图",LIVE:"正在直播",OFF:"关闭",MINIPLAYER_DRAG:"点击按住可拖动视频",AIRPLAY_TIPS:"隔空播放"},"zh-hk":{HAVE_NOTHING:"沒有關於音頻/視頻是否就緒的信息",HAVE_METADATA:"音頻/視頻的元數據已就緒",HAVE_CURRENT_DATA:"關於當前播放位置的數據是可用的，但沒有足夠的數據來播放下壹幀/毫秒",HAVE_FUTURE_DATA:"當前及至少下壹幀的數據是可用的",HAVE_ENOUGH_DATA:"可用數據足以開始播放",NETWORK_EMPTY:"音頻/視頻尚未初始化",NETWORK_IDLE:"音頻/視頻是活動的且已選取資源，但並未使用網絡",NETWORK_LOADING:"瀏覽器正在下載數據",NETWORK_NO_SOURCE:"未找到音頻/視頻來源",MEDIA_ERR_ABORTED:"取回過程被用戶中止",MEDIA_ERR_NETWORK:"當下載時發生錯誤",MEDIA_ERR_DECODE:"當解碼時發生錯誤",MEDIA_ERR_SRC_NOT_SUPPORTED:"不支持的音頻/視頻格式",REPLAY:"重播",ERROR:"網絡連接似乎出現了問題",PLAY_TIPS:"播放",PAUSE_TIPS:"暫停",PLAYNEXT_TIPS:"下壹集",DOWNLOAD_TIPS:"下載",ROTATE_TIPS:"旋轉",RELOAD_TIPS:"重新載入",FULLSCREEN_TIPS:"進入全屏",EXITFULLSCREEN_TIPS:"退出全屏",CSSFULLSCREEN_TIPS:"進入樣式全屏",EXITCSSFULLSCREEN_TIPS:"退出樣式全屏",TEXTTRACK:"字幕",PIP:"畫中畫",MINIPLAYER:"迷妳播放器",SCREENSHOT:"截圖",LIVE:"正在直播",OFF:"關閉",MINIPLAYER_DRAG:"點擊按住可拖動視頻",AIRPLAY_TIPS:"隔空播放"},jp:{HAVE_NOTHING:"オーディオ/ビデオが準備できているか情報がありません",HAVE_METADATA:"オーディオ/ビデオのメタデータは準備できています",HAVE_CURRENT_DATA:"現在の再生位置に関するデータは利用可能ですが、次のフレーム/ミリ秒を再生するのに十分なデータがありません",HAVE_FUTURE_DATA:"現在、少なくとも次のフレームのデータが利用可能です",HAVE_ENOUGH_DATA:"利用可能なデータは再生を開始するのに十分です",NETWORK_EMPTY:"オーディオ/ビデオが初期化されていません",NETWORK_IDLE:"オーディオ/ビデオはアクティブでリソースが選択されていますが、ネットワークが使用されていません",NETWORK_LOADING:"ブラウザーはデータをダウンロードしています",NETWORK_NO_SOURCE:"オーディオ/ビデオ のソースが見つかりません",MEDIA_ERR_ABORTED:"ユーザーによってフェッチプロセスが中止されました",MEDIA_ERR_NETWORK:"ダウンロード中にエラーが発生しました",MEDIA_ERR_DECODE:"デコード中にエラーが発生しました",MEDIA_ERR_SRC_NOT_SUPPORTED:"オーディオ/ビデオ の形式がサポートされていません",REPLAY:"リプレイ",ERROR:"ネットワークの接続に問題が発生しました",PLAY_TIPS:"プレイ",PAUSE_TIPS:"一時停止",PLAYNEXT_TIPS:"次をプレイ",DOWNLOAD_TIPS:"ダウンロード",ROTATE_TIPS:"回転",RELOAD_TIPS:"再読み込み",FULLSCREEN_TIPS:"フルスクリーン",EXITFULLSCREEN_TIPS:"フルスクリーンを終了",CSSFULLSCREEN_TIPS:"シアターモード",EXITCSSFULLSCREEN_TIPS:"シアターモードを終了",TEXTTRACK:"字幕",PIP:"ミニプレーヤー",MINIPLAYER:"ミニプレーヤー",SCREENSHOT:"スクリーンショット",LIVE:"生放送",OFF:"オフ",MINIPLAYER_DRAG:"ボタンを押して働画をドラッグする",AIRPLAY_TIPS:"隔空放送"}};Object.defineProperty(e,"lang",{get:function(){return e.config&&t[e.config.lang]||t.en},set:function(e){"Object"===(0,r.typeOf)(e)&&Object.keys(e).forEach(function(n){t[n]=e[n]})}})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=s(n(12)),o=n(0),a=s(n(4));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._hasStart=!1,this.videoConfig={controls:!!t.isShowControl,autoplay:t.autoplay,playsinline:t.playsinline,"webkit-playsinline":t.playsinline,"x5-playsinline":t.playsinline,"x5-video-player-type":t["x5-video-player-type"]||t.x5VideoPlayerType,"x5-video-player-fullscreen":t["x5-video-player-fullscreen"]||t.x5VideoPlayerFullscreen,"x5-video-orientation":t["x5-video-orientation"]||t.x5VideoOrientation,airplay:t.airplay,"webkit-airplay":t.airplay,tabindex:2,mediaType:t.mediaType||"video"},t.muted&&(this.videoConfig.muted="muted"),t.loop&&(this.videoConfig.loop="loop");var r="";if(this.textTrackShowDefault=!0,t.nativeTextTrack&&Array.isArray(t.nativeTextTrack)&&(t.nativeTextTrack.length>0&&!t.nativeTextTrack.some(function(e){return e.default})&&(t.nativeTextTrack[0].default=!0,this.textTrackShowDefault=!1),t.nativeTextTrack.some(function(e){if(e.src&&e.label&&e.default)return r+='<track src="'+e.src+'" ',e.kind&&(r+='kind="'+e.kind+'" '),r+='label="'+e.label+'" ',e.srclang&&(r+='srclang="'+e.srclang+'" '),r+=(e.default?"default":"")+">",!0}),this.videoConfig.crossorigin="anonymous"),t.textTrackStyle){var a=document.createElement("style");this.textTrackStyle=a,document.head.appendChild(a);var s="";for(var u in t.textTrackStyle)s+=u+": "+t.textTrackStyle[u]+";";var l=t.id?"#"+t.id:t.el.id?"#"+t.el.id:"."+t.el.className;a.sheet.insertRule?a.sheet.insertRule(l+" video::cue { "+s+" }",0):a.sheet.addRule&&a.sheet.addRule(l+" video::cue",s)}var c=t.el?t.el:(0,o.findDom)(document,"#"+t.id),d=this.constructor.XgVideoProxy;(d&&this.videoConfig.mediaType===d.mediaType?this.video=new d(c,t):this.video=(0,o.createDom)(this.videoConfig.mediaType,r,this.videoConfig,""),t.videoStyle&&Object.keys(t.videoStyle).forEach(function(e){(0,o.setStyle)(n.video,e,t.videoStyle[e])}),!this.textTrackShowDefault&&r)&&(this.video.getElementsByTagName("Track")[0].track.mode="hidden");t.autoplay&&(this.video.autoplay=!0,t.autoplayMuted&&(this.video.muted=!0)),this.ev=["play","playing","pause","ended","error","seeking","seeked","progress","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","ratechange","loadedmetadata","loadeddata","loadstart"].map(function(e){return t={},n=e,r="on"+e.charAt(0).toUpperCase()+e.slice(1),n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t;var t,n,r}),(0,i.default)(this),this._interval={};var f="0,0",p=this,h=function(e){n&&("play"===e?n.hasStart=!0:"canplay"===e?(0,o.removeClass)(n.root,"xgplayer-is-enter"):"waiting"===e?n.inWaitingStart=(new Date).getTime():"playing"===e&&((0,o.removeClass)(n.root,"xgplayer-is-enter"),n.inWaitingStart&&(n.inWaitingStart=void 0)),"error"===e?n._onError(e):n.emit(e,n),n.hasOwnProperty("_interval")&&(["ended","error","timeupdate"].indexOf(e)<0?((0,o._clearInterval)(n,"bufferedChange"),(0,o._setInterval)(n,"bufferedChange",function(){if(this.video&&this.video.buffered){for(var e=[],t=0,n=this.video.buffered.length;t<n;t++)e.push([this.video.buffered.start(t),this.video.buffered.end(t)]);e.toString()!==f&&(f=e.toString(),this.emit("bufferedChange",e))}},200)):"timeupdate"!==e&&(0,o._clearInterval)(n,"bufferedChange")))};this.ev.forEach(function(e){p.evItem=Object.keys(e)[0];var r=Object.keys(e)[0];p.video.addEventListener(Object.keys(e)[0],function(e){t.videoEventMiddleware&&"function"==typeof t.videoEventMiddleware[e]?t.videoEventMiddleware[e].call(n,n,e,h):h.call(n,e)}.bind(p,r))})}return r(e,[{key:"_onError",value:function(e){this.video&&this.video.error&&this.emit(e,new a.default("other",this.currentTime,this.duration,this.networkState,this.readyState,this.currentSrc,this.src,this.ended,{line:162,msg:this.error,handle:"Constructor"},this.video.error.code,this.video.error))}},{key:"destroy",value:function(){this.textTrackStyle&&this.textTrackStyle.parentNode.removeChild(this.textTrackStyle)}},{key:"play",value:function(){return this.video.play()}},{key:"pause",value:function(){this.video.pause()}},{key:"canPlayType",value:function(e){return this.video.canPlayType(e)}},{key:"getBufferedRange",value:function(e){var t=[0,0],n=this.video;e||(e=n.buffered);var r=n.currentTime;if(e)for(var i=0,o=e.length;i<o&&(t[0]=e.start(i),t[1]=e.end(i),!(t[0]<=r&&r<=t[1]));i++);return t[0]-r<=0&&r-t[1]<=0?t:[0,0]}},{key:"proxyOn",value:function(e,t){(0,o.on)(this,e,t,"destroy")}},{key:"proxyOnce",value:function(e,t){(0,o.once)(this,e,t,"destroy")}},{key:"hasStart",get:function(){return this._hasStart},set:function(e){"boolean"!=typeof e||!0!==e||this._hasStart||(this._hasStart=!0,this.emit("hasstart"))}},{key:"autoplay",set:function(e){this.video&&(this.video.autoplay=e)},get:function(){return!!this.video&&this.video.autoplay}},{key:"buffered",get:function(){return this.video?this.video.buffered:void 0}},{key:"buffered2",get:function(){return(0,o.getBuffered2)(this.video.buffered)}},{key:"crossOrigin",get:function(){return!!this.video&&this.video.crossOrigin},set:function(e){this.video&&(this.video.crossOrigin=e)}},{key:"currentSrc",get:function(){return this.video?this.video.currentSrc:void 0}},{key:"currentTime",get:function(){return this.video&&this.video.currentTime||0},set:function(e){var t=this;("function"!=typeof isFinite||isFinite(e))&&((0,o.hasClass)(this.root,"xgplayer-ended")?(this.once("playing",function(){t.video.currentTime=e}),this.replay()):this.video.currentTime=e,this.emit("currentTimeChange",e))}},{key:"defaultMuted",get:function(){return!!this.video&&this.video.defaultMuted},set:function(e){this.video&&(this.video.defaultMuted=e)}},{key:"duration",get:function(){return this.config.duration?this.video?Math.min(this.config.duration,this.video.duration):this.config.duration:this.video?this.video.duration:null}},{key:"ended",get:function(){return!this.video||(this.video.ended||!1)}},{key:"error",get:function(){var e=this.video.error;if(!e)return null;var t=[{en:"MEDIA_ERR_ABORTED",cn:"取回过程被用户中止"},{en:"MEDIA_ERR_NETWORK",cn:"当下载时发生错误"},{en:"MEDIA_ERR_DECODE",cn:"当解码时发生错误"},{en:"MEDIA_ERR_SRC_NOT_SUPPORTED",cn:"不支持音频/视频"}];return this.lang?this.lang[t[e.code-1].en]:t[e.code-1].en}},{key:"loop",get:function(){return!!this.video&&this.video.loop},set:function(e){this.video&&(this.video.loop=e)}},{key:"muted",get:function(){return!!this.video&&this.video.muted},set:function(e){this.video&&(this.video.muted=e)}},{key:"networkState",get:function(){var e=[{en:"NETWORK_EMPTY",cn:"音频/视频尚未初始化"},{en:"NETWORK_IDLE",cn:"音频/视频是活动的且已选取资源，但并未使用网络"},{en:"NETWORK_LOADING",cn:"浏览器正在下载数据"},{en:"NETWORK_NO_SOURCE",cn:"未找到音频/视频来源"}];return this.lang?this.lang[e[this.video.networkState].en]:e[this.video.networkState].en}},{key:"paused",get:function(){return(0,o.hasClass)(this.root,"xgplayer-pause")}},{key:"playbackRate",get:function(){return this.video?this.video.playbackRate:1},set:function(e){this.video&&(this.video.playbackRate=e)}},{key:"played",get:function(){return this.video?this.video.played:void 0}},{key:"preload",get:function(){return!!this.video&&this.video.preload},set:function(e){this.video&&(this.video.preload=e)}},{key:"readyState",get:function(){var e=[{en:"HAVE_NOTHING",cn:"没有关于音频/视频是否就绪的信息"},{en:"HAVE_METADATA",cn:"关于音频/视频就绪的元数据"},{en:"HAVE_CURRENT_DATA",cn:"关于当前播放位置的数据是可用的，但没有足够的数据来播放下一帧/毫秒"},{en:"HAVE_FUTURE_DATA",cn:"当前及至少下一帧的数据是可用的"},{en:"HAVE_ENOUGH_DATA",cn:"可用数据足以开始播放"}];return this.lang?this.lang[e[this.video.readyState].en]:e[this.video.readyState]}},{key:"seekable",get:function(){return!!this.video&&this.video.seekable}},{key:"seeking",get:function(){return!!this.video&&this.video.seeking}},{key:"src",get:function(){return this.video?this.video.src:void 0},set:function(e){(0,o.hasClass)(this.root,"xgplayer-ended")||this.emit("urlchange",this.video.src),(0,o.removeClass)(this.root,"xgplayer-ended xgplayer-is-replay xgplayer-is-error"),this.video.pause(),this.emit("pause"),this.video.src=e,this.emit("srcChange")}},{key:"poster",set:function(e){var t=(0,o.findDom)(this.root,".xgplayer-poster");t&&(t.style.backgroundImage="url("+e+")")}},{key:"volume",get:function(){return this.video?this.video.volume:1},set:function(e){this.video&&(this.video.volume=e)}},{key:"fullscreen",get:function(){return(0,o.hasClass)(this.root,"xgplayer-is-fullscreen")||(0,o.hasClass)(this.root,"xgplayer-fullscreen-active")}},{key:"bullet",get:function(){return!!(0,o.findDom)(this.root,"xg-danmu")&&(0,o.hasClass)((0,o.findDom)(this.root,"xg-danmu"),"xgplayer-has-danmu")}},{key:"textTrack",get:function(){return(0,o.hasClass)(this.root,"xgplayer-is-textTrack")}},{key:"pip",get:function(){return(0,o.hasClass)(this.root,"xgplayer-pip-active")}},{key:"isMiniPlayer",get:function(){return(0,o.hasClass)(this.root,"xgplayer-miniplayer-active")}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";var r,i,o,a,s,u,l,c=n(13),d=n(30),f=Function.prototype.apply,p=Function.prototype.call,h=Object.create,g=Object.defineProperty,v=Object.defineProperties,m=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var n,i;return d(t),i=this,r.call(this,e,n=function(){o.call(i,e,n),f.call(t,this,arguments)}),n.__eeOnceListener__=t,this},s={on:r=function(e,t){var n;return d(t),m.call(this,"__ee__")?n=this.__ee__:(n=y.value=h(null),g(this,"__ee__",y),y.value=null),n[e]?"object"==typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},once:i,off:o=function(e,t){var n,r,i,o;if(d(t),!m.call(this,"__ee__"))return this;if(!(n=this.__ee__)[e])return this;if("object"==typeof(r=n[e]))for(o=0;i=r[o];++o)i!==t&&i.__eeOnceListener__!==t||(2===r.length?n[e]=r[o?0:1]:r.splice(o,1));else r!==t&&r.__eeOnceListener__!==t||delete n[e];return this},emit:a=function(e){var t,n,r,i,o;if(m.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==typeof i){for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];for(i=i.slice(),t=0;r=i[t];++t)f.call(r,this,o)}else switch(arguments.length){case 1:p.call(i,this);break;case 2:p.call(i,this,arguments[1]);break;case 3:p.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];f.call(i,this,o)}}},u={on:c(r),once:c(i),off:c(o),emit:c(a)},l=v({},u),e.exports=t=function(e){return null==e?h(l):v(Object(e),u)},t.methods=s},function(e,t,n){"use strict";var r=n(6),i=n(14),o=n(18),a=n(26),s=n(27);(e.exports=function(e,t){var n,i,u,l,c;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],r(e)?(n=s.call(e,"c"),i=s.call(e,"e"),u=s.call(e,"w")):(n=u=!0,i=!1),c={value:t,configurable:n,enumerable:i,writable:u},l?o(a(l),c):c}).gs=function(e,t,n){var u,l,c,d;return"string"!=typeof e?(c=n,n=t,t=e,e=null):c=arguments[3],r(t)?i(t)?r(n)?i(n)||(c=n,n=void 0):n=void 0:(c=t,t=n=void 0):t=void 0,r(e)?(u=s.call(e,"c"),l=s.call(e,"e")):(u=!0,l=!1),d={get:t,set:n,configurable:u,enumerable:l},c?o(a(c),d):d}},function(e,t,n){"use strict";var r=n(15),i=/^\s*class[\s{/}]/,o=Function.prototype.toString;e.exports=function(e){return!!r(e)&&!i.test(o.call(e))}},function(e,t,n){"use strict";var r=n(16);e.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(e){return!1}return!r(e)}},function(e,t,n){"use strict";var r=n(17);e.exports=function(e){if(!r(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(e){return!1}}},function(e,t,n){"use strict";var r=n(6),i={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!r(e)&&hasOwnProperty.call(i,typeof e)}},function(e,t,n){"use strict";e.exports=n(19)()?Object.assign:n(20)},function(e,t,n){"use strict";e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,n){"use strict";var r=n(21),i=n(25),o=Math.max;e.exports=function(e,t){var n,a,s,u=o(arguments.length,2);for(e=Object(i(e)),s=function(r){try{e[r]=t[r]}catch(e){n||(n=e)}},a=1;a<u;++a)t=arguments[a],r(t).forEach(s);if(void 0!==n)throw n;return e}},function(e,t,n){"use strict";e.exports=n(22)()?Object.keys:n(23)},function(e,t,n){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,n){"use strict";var r=n(3),i=Object.keys;e.exports=function(e){return i(r(e)?Object(e):e)}},function(e,t,n){"use strict";e.exports=function(){}},function(e,t,n){"use strict";var r=n(3);e.exports=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,n){"use strict";var r=n(3),i=Array.prototype.forEach,o=Object.create;e.exports=function(e){var t=o(null);return i.call(arguments,function(e){r(e)&&function(e,t){var n;for(n in e)t[n]=e[n]}(Object(e),t)}),t}},function(e,t,n){"use strict";e.exports=n(28)()?String.prototype.contains:n(29)},function(e,t,n){"use strict";var r="razdwatrzy";e.exports=function(){return"function"==typeof r.contains&&(!0===r.contains("dwa")&&!1===r.contains("foo"))}},function(e,t,n){"use strict";var r=String.prototype.indexOf;e.exports=function(e){return r.call(this,e,arguments[1])>-1}},function(e,t,n){"use strict";e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,n){"use strict";var r=n(32),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t,n=arguments[1];if(r(e),void 0===n)i.call(e,"__ee__")&&delete e.__ee__;else{if(!(t=i.call(e,"__ee__")&&e.__ee__))return;t[n]&&delete t[n]}}},function(e,t,n){"use strict";var r=n(33);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not an Object");return e}},function(e,t,n){"use strict";var r=n(3),i={function:!0,object:!0};e.exports=function(e){return r(e)&&i[typeof e]||!1}},function(e,t,n){var r=n(35);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default{background:#000;width:100%;height:100%;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;-ms-user-select:none}.xgplayer-skin-default *{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}.xgplayer-skin-default.xgplayer-rotate-fullscreen{position:absolute;top:0;left:100%;bottom:0;right:0;height:100vw!important;width:100vh!important;-webkit-transform-origin:top left;-ms-transform-origin:top left;transform-origin:top left;-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg)}.xgplayer-skin-default.xgplayer-is-fullscreen{width:100%!important;height:100%!important;padding-top:0!important;z-index:9999}.xgplayer-skin-default.xgplayer-is-fullscreen.xgplayer-inactive{cursor:none}.xgplayer-skin-default video{width:100%;height:100%;outline:none}.xgplayer-skin-default .xgplayer-none{display:none}@-webkit-keyframes loadingRotate{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes loadingRotate{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@-webkit-keyframes loadingDashOffset{0%{stroke-dashoffset:236}to{stroke-dashoffset:0}}@keyframes loadingDashOffset{0%{stroke-dashoffset:236}to{stroke-dashoffset:0}}.xgplayer-skin-default .xgplayer-controls{display:-webkit-flex;display:-moz-box;display:flex;position:absolute;bottom:0;left:0;right:0;height:40px;background-image:linear-gradient(180deg,transparent,rgba(0,0,0,.37),rgba(0,0,0,.75),rgba(0,0,0,.75));z-index:10}.xgplayer-skin-default.xgplayer-inactive .xgplayer-controls,.xgplayer-skin-default.xgplayer-is-live .xgplayer-controls .xgplayer-progress,.xgplayer-skin-default.xgplayer-is-live .xgplayer-controls .xgplayer-time,.xgplayer-skin-default.xgplayer-no-controls .xgplayer-controls,.xgplayer-skin-default.xgplayer-nostart .xgplayer-controls{display:none}.xgplayer-skin-default.xgplayer-is-live .xgplayer-controls .xgplayer-live{display:block}.xgplayer-skin-default .xgplayer-live{display:block;font-size:12px;color:#fff;line-height:40px;-webkit-order:1;-moz-box-ordinal-group:2;order:1}.xgplayer-skin-default .xgplayer-icon{display:block;width:40px;height:40px;overflow:hidden;fill:#fff}.xgplayer-skin-default .xgplayer-icon svg{position:absolute}.xgplayer-skin-default .xgplayer-tips{background:rgba(0,0,0,.54);border-radius:1px;display:none;position:absolute;font-family:PingFangSC-Regular;font-size:11px;color:#fff;padding:2px 4px;text-align:center;top:-30px;left:50%;margin-left:-16px;width:auto;white-space:nowrap}.xgplayer-skin-default.xgplayer-mobile .xgplayer-tips{display:none!important}.xgplayer-skin-default .xgplayer-screen-container{display:block;width:100%}",""])},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var i,o=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?e:(i=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:r+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={name:"mobile",method:function(){var e=this,t=e.root,n=0,i=void 0,o={first:"",second:""};function a(t){e.video.addEventListener("touchend",function(t){e.onElementTouchend(t,e.video)}),e.video.addEventListener("touchstart",function(){e.isTouchMove=!1}),e.video.addEventListener("touchmove",function(){e.isTouchMove=!0}),e.config.autoplay&&e.start()}e.onElementTouchend=function(e,a){this.config.closeVideoPreventDefault||e.preventDefault(),this.config.closeVideoStopPropagation||e.stopPropagation();var s=this;if((0,r.hasClass)(t,"xgplayer-inactive")?s.emit("focus"):s.emit("blur"),!s.config.closeVideoTouch&&!s.isTouchMove){var u=function(){i=setTimeout(function(){if((0,r.hasClass)(s.root,"xgplayer-nostart"))return!1;if(!s.ended)if(s.paused){var e=s.play();void 0!==e&&e&&e.catch(function(e){})}else s.pause();n=0},200)};s.config.closeVideoClick||(n++,i&&clearTimeout(i),1===n?s.config.enableVideoDbltouch?o.first=new Date:u():2===n&&s.config.enableVideoDbltouch?(o.second=new Date,Math.abs(o.first-o.second)<400?u():(o.first=new Date,n=1)):n=0)}},e.once("ready",a),e.once("destroy",function t(){e.off("ready",a),e.off("destroy",t)})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={name:"pc",method:function(){var e=this;if(e.controls&&e.video){var t=e.controls,n=e.root,i=0,o=void 0;e.onElementClick=function(e,t){this.config.closeVideoPreventDefault||e.preventDefault(),this.config.closeVideoStopPropagation||e.stopPropagation();var n=this;n.config.closeVideoClick||(i++,o&&clearTimeout(o),1===i?o=setTimeout(function(){if((0,r.hasClass)(n.root,"xgplayer-nostart"))return!1;if(!n.ended)if(n.paused){var e=n.play();void 0!==e&&e&&e.catch(function(e){})}else n.pause();i=0},200):i=0)},e.video.addEventListener("click",function(t){e.onElementClick(t,e.video)},!1),e.onElementDblclick=function(e,n){if(this.config.closeVideoPreventDefault||e.preventDefault(),this.config.closeVideoStopPropagation||e.stopPropagation(),!this.config.closeVideoDblclick){var r=t.querySelector(".xgplayer-fullscreen");if(r){var i=void 0;document.createEvent?(i=document.createEvent("Event")).initEvent("click",!0,!0):i=new Event("click"),r.dispatchEvent(i)}}},e.video.addEventListener("dblclick",function(t){e.onElementDblclick(t,e.video)},!1),n.addEventListener("mouseenter",a),n.addEventListener("mouseleave",s),t.addEventListener("mouseenter",function(t){e.userTimer&&clearTimeout(e.userTimer)}),t.addEventListener("mouseleave",function(t){e.config.closeControlsBlur||e.emit("focus",e)}),t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation()}),e.once("ready",u),e.once("destroy",function t(){n.removeEventListener("mouseenter",a),n.removeEventListener("mouseleave",s),e.off("ready",u),e.off("destroy",t)})}function a(){clearTimeout(e.leavePlayerTimer),e.emit("focus",e)}function s(){e.config.closePlayerBlur||(e.leavePlayerTimer=setTimeout(function(){e.emit("blur",e)},e.config.leavePlayerTime||0))}function u(t){e.config.autoplay&&e.start()}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={name:"start",method:function(){var e=this,t=e.root;function n(){e.off("canplay",n);var t=e.play();void 0!==t&&t&&t.catch(function(e){})}function i(){(0,r.hasClass)(t,"xgplayer-nostart")?((0,r.removeClass)(t,"xgplayer-nostart"),(0,r.addClass)(t,"xgplayer-is-enter"),"function"==typeof t.contains?e.video&&1===e.video.nodeType&&!t.contains(e.video)||e.video&&1!==e.video.nodeType&&void 0===e.video.mediaSource?(e.once("canplay",n),e.start()):n():e.video&&1===e.video.nodeType&&!t.querySelector(this.videoConfig.mediaType)||e.video&&1!==e.video.nodeType&&void 0===e.video.mediaSource?(e.once("canplay",n),e.start()):n()):e.paused&&((0,r.removeClass)(t,"xgplayer-nostart xgplayer-isloading"),setTimeout(function(){var t=e.play();void 0!==t&&t&&t.catch(function(e){})},10))}e.on("startBtnClick",i),e.once("destroy",function t(){e.off("startBtnClick",i),e.off("canplay",n),e.off("destroy",t)})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=a(n(41)),o=a(n(42));function a(e){return e&&e.__esModule?e:{default:e}}n(43);t.default={name:"s_start",method:function(){var e=this,t=e.root,n=(0,r.createDom)("xg-start",'<div class="xgplayer-icon-play">'+i.default+'</div>\n                                      <div class="xgplayer-icon-pause">'+o.default+"</div>",{},"xgplayer-start");function a(e){(0,r.addClass)(e.root,"xgplayer-skin-default"),e.config&&(e.config.autoplay&&!(0,r.isWeiXin)()&&!(0,r.isUc)()&&(0,r.addClass)(e.root,"xgplayer-is-enter"),e.config.lang&&"en"===e.config.lang?(0,r.addClass)(e.root,"xgplayer-lang-is-en"):"jp"===e.config.lang&&(0,r.addClass)(e.root,"xgplayer-lang-is-jp"),e.config.enableContextmenu||e.video.addEventListener("contextmenu",function(e){e.preventDefault(),e.stopPropagation()}))}e.config&&e.config.hideStartBtn&&(0,r.addClass)(t,"xgplayer-start-hide"),e.isReady?(t.appendChild(n),a(e)):e.once("ready",function(){t.appendChild(n),a(e)}),e.once("autoplay was prevented",function(){(0,r.removeClass)(e.root,"xgplayer-is-enter"),(0,r.addClass)(e.root,"xgplayer-nostart")}),e.once("canplay",function(){(0,r.removeClass)(e.root,"xgplayer-is-enter")}),n.onclick=function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("startBtnClick")}}},e.exports=t.default},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" viewBox="0 0 70 70">\n  <path transform="translate(15,15) scale(0.04,0.04)" d="M576,363L810,512L576,661zM342,214L576,363L576,661L342,810z"></path>\n</svg>\n'},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" viewBox="0 0 70 70">\n  <path transform="translate(15,15) scale(0.04 0.04)" d="M598,214h170v596h-170v-596zM256 810v-596h170v596h-170z"></path>\n</svg>\n'},function(e,t,n){var r=n(44);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-start{border-radius:50%;display:inline-block;width:70px;height:70px;background:rgba(0,0,0,.38);overflow:hidden;text-align:center;line-height:70px;vertical-align:middle;position:absolute;left:50%;top:50%;z-index:115;margin:-35px auto auto -35px;cursor:pointer}.xgplayer-skin-default .xgplayer-start div{position:absolute}.xgplayer-skin-default .xgplayer-start div svg{fill:hsla(0,0%,100%,.7)}.xgplayer-skin-default .xgplayer-start .xgplayer-icon-play{display:block}.xgplayer-skin-default .xgplayer-start .xgplayer-icon-pause{display:none}.xgplayer-skin-default .xgplayer-start:hover{opacity:.85}.xgplayer-skin-default.xgplayer-pause.xgplayer-start-hide .xgplayer-start,.xgplayer-skin-default.xgplayer-playing .xgplayer-start,.xgplayer-skin-default.xgplayer-playing .xgplayer-start .xgplayer-icon-play,.xgplayer-skin-default.xgplayer-start-hide .xgplayer-start{display:none}.xgplayer-skin-default.xgplayer-playing .xgplayer-start .xgplayer-icon-pause{display:block}.xgplayer-skin-default.xgplayer-pause .xgplayer-start{display:inline-block}.xgplayer-skin-default.xgplayer-pause .xgplayer-start .xgplayer-icon-play{display:block}.xgplayer-skin-default.xgplayer-is-replay .xgplayer-start,.xgplayer-skin-default.xgplayer-pause .xgplayer-start .xgplayer-icon-pause{display:none}.xgplayer-skin-default.xgplayer-is-replay .xgplayer-start .xgplayer-icon-play{display:block}.xgplayer-skin-default.xgplayer-is-replay .xgplayer-start .xgplayer-icon-pause{display:none}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={name:"fullscreen",method:function(){var e=this,t=e.root;function n(){e.config.rotateFullscreen?(0,r.hasClass)(t,"xgplayer-rotate-fullscreen")?e.exitRotateFullscreen():e.getRotateFullscreen():(0,r.hasClass)(t,"xgplayer-is-fullscreen")?e.exitFullscreen(t):e.getFullscreen(t)}function i(){var n=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;n&&n===t?((0,r.addClass)(t,"xgplayer-is-fullscreen"),e.emit("requestFullscreen")):(0,r.hasClass)(t,"xgplayer-is-fullscreen")&&((0,r.removeClass)(t,"xgplayer-is-fullscreen"),e.emit("exitFullscreen")),e.danmu&&"function"==typeof e.danmu.resize&&e.danmu.resize()}function o(n){e.video.webkitPresentationMode!==r.PresentationMode.FULLSCREEN&&((0,r.removeClass)(t,"xgplayer-is-fullscreen"),e.emit("exitFullscreen"))}e.on("fullscreenBtnClick",n),["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"].forEach(function(e){document.addEventListener(e,i)}),e.video.addEventListener("webkitbeginfullscreen",function(){(0,r.addClass)(t,"xgplayer-is-fullscreen"),e.emit("requestFullscreen")}),e.video.addEventListener("webkitendfullscreen",function(){(0,r.removeClass)(t,"xgplayer-is-fullscreen"),e.emit("exitFullscreen")}),(0,r.checkWebkitSetPresentationMode)(e.video)&&e.video.addEventListener("webkitpresentationmodechanged",o),e.once("destroy",function t(){e.off("fullscreenBtnClick",n),["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"].forEach(function(e){document.removeEventListener(e,i)}),(0,r.checkWebkitSetPresentationMode)(e.video)&&e.video.removeEventListener("webkitpresentationmodechanged",o),e.off("destroy",t)}),e.getFullscreen=function(e){var t=this;if(e.requestFullscreen){var n=e.requestFullscreen();n&&n.catch(function(){t.emit("fullscreen error")})}else e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):t.video.webkitSupportsFullscreen?t.video.webkitEnterFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():(0,r.addClass)(e,"xgplayer-is-cssfullscreen")},e.exitFullscreen=function(e){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),(0,r.removeClass)(e,"xgplayer-is-cssfullscreen")},e.getRotateFullscreen=function(){document.documentElement.style.width="100%",document.documentElement.style.height="100%",this.config.fluid&&(this.root.style["padding-top"]="",this.root.style["max-width"]="unset"),this.root&&!(0,r.hasClass)(this.root,"xgplayer-rotate-fullscreen")&&(0,r.addClass)(this.root,"xgplayer-rotate-fullscreen"),this.emit("getRotateFullscreen")},e.exitRotateFullscreen=function(){document.documentElement.style.width="unset",document.documentElement.style.height="unset",this.config.fluid&&(this.root.style.width="100%",this.root.style.height="0",this.root.style["padding-top"]=100*this.config.height/this.config.width+"%",this.root.style["max-width"]="100%"),this.root&&(0,r.hasClass)(this.root,"xgplayer-rotate-fullscreen")&&(0,r.removeClass)(this.root,"xgplayer-rotate-fullscreen"),this.emit("exitRotateFullscreen")}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={name:"play",method:function(){var e=this;function t(){if(e.config.allowPlayAfterEnded||!e.ended)if((0,r.hasClass)(e.root,"xgplayer-nostart")&&e.start(),e.paused){var t=e.play();void 0!==t&&t&&t.catch(function(e){})}else e.pause()}e.on("playBtnClick",t),e.once("destroy",function n(){e.off("playBtnClick",t),e.off("destroy",n)})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={name:"replay",method:function(){var e=this,t=e.root;function n(){(0,r.removeClass)(t,"xgplayer-is-replay"),e.replay()}e.on("replayBtnClick",n),e.on("ended",function(){e.config.loop||(0,r.addClass)(t,"xgplayer-is-replay")}),e.once("destroy",function t(){e.off("replayBtnClick",n),e.off("destroy",t)})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=a(n(49)),o=a(n(50));function a(e){return e&&e.__esModule?e:{default:e}}n(51);t.default={name:"s_play",method:function(){var e=this,t=e.config.playBtn?e.config.playBtn:{},n=void 0;n="img"===t.type?(0,r.createImgBtn)("play",t.url.play,t.width,t.height):(0,r.createDom)("xg-play",'<xg-icon class="xgplayer-icon">\n                                      <div class="xgplayer-icon-play">'+i.default+'</div>\n                                      <div class="xgplayer-icon-pause">'+o.default+"</div>\n                                     </xg-icon>",{},"xgplayer-play");var a={};a.play=e.lang.PLAY_TIPS,a.pause=e.lang.PAUSE_TIPS;var s=(0,r.createDom)("xg-tips",'<span class="xgplayer-tip-play">'+a.play+'</span>\n                                        <span class="xgplayer-tip-pause">'+a.pause+"</span>",{},"xgplayer-tips");n.appendChild(s),e.once("ready",function(){e.controls&&e.controls.appendChild(n)}),["click","touchend"].forEach(function(t){n.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("playBtnClick")})})}},e.exports=t.default},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">\n  <path transform="translate(2,2) scale(0.0320625 0.0320625)" d="M576,363L810,512L576,661zM342,214L576,363L576,661L342,810z"></path>\n</svg>\n'},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">\n  <path transform="translate(2,2) scale(0.0320625 0.0320625)" d="M598,214h170v596h-170v-596zM256 810v-596h170v596h-170z"></path>\n</svg>\n'},function(e,t,n){var r=n(52);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-play,.xgplayer-skin-default .xgplayer-play-img{width:40px;position:relative;-webkit-order:0;-moz-box-ordinal-group:1;order:0;display:block;cursor:pointer;margin-left:3px}.xgplayer-skin-default .xgplayer-play-img .xgplayer-icon,.xgplayer-skin-default .xgplayer-play .xgplayer-icon{margin-top:3px;width:32px}.xgplayer-skin-default .xgplayer-play-img .xgplayer-icon div,.xgplayer-skin-default .xgplayer-play .xgplayer-icon div{position:absolute}.xgplayer-skin-default .xgplayer-play-img .xgplayer-icon .xgplayer-icon-play,.xgplayer-skin-default .xgplayer-play .xgplayer-icon .xgplayer-icon-play{display:block}.xgplayer-skin-default .xgplayer-play-img .xgplayer-icon .xgplayer-icon-pause,.xgplayer-skin-default .xgplayer-play .xgplayer-icon .xgplayer-icon-pause{display:none}.xgplayer-skin-default .xgplayer-play-img .xgplayer-tips .xgplayer-tip-play,.xgplayer-skin-default .xgplayer-play .xgplayer-tips .xgplayer-tip-play{display:block}.xgplayer-skin-default .xgplayer-play-img .xgplayer-tips .xgplayer-tip-pause,.xgplayer-skin-default .xgplayer-play .xgplayer-tips .xgplayer-tip-pause{display:none}.xgplayer-skin-default .xgplayer-play-img:hover,.xgplayer-skin-default .xgplayer-play:hover{opacity:.85}.xgplayer-skin-default .xgplayer-play-img:hover .xgplayer-tips,.xgplayer-skin-default .xgplayer-play:hover .xgplayer-tips{display:block}.xgplayer-skin-default.xgplayer-playing .xgplayer-play-img .xgplayer-icon .xgplayer-icon-play,.xgplayer-skin-default.xgplayer-playing .xgplayer-play .xgplayer-icon .xgplayer-icon-play{display:none}.xgplayer-skin-default.xgplayer-playing .xgplayer-play-img .xgplayer-icon .xgplayer-icon-pause,.xgplayer-skin-default.xgplayer-playing .xgplayer-play .xgplayer-icon .xgplayer-icon-pause{display:block}.xgplayer-skin-default.xgplayer-playing .xgplayer-play-img .xgplayer-tips .xgplayer-tip-play,.xgplayer-skin-default.xgplayer-playing .xgplayer-play .xgplayer-tips .xgplayer-tip-play{display:none}.xgplayer-skin-default.xgplayer-pause .xgplayer-play-img .xgplayer-icon .xgplayer-icon-play,.xgplayer-skin-default.xgplayer-pause .xgplayer-play .xgplayer-icon .xgplayer-icon-play,.xgplayer-skin-default.xgplayer-playing .xgplayer-play-img .xgplayer-tips .xgplayer-tip-pause,.xgplayer-skin-default.xgplayer-playing .xgplayer-play .xgplayer-tips .xgplayer-tip-pause{display:block}.xgplayer-skin-default.xgplayer-pause .xgplayer-play-img .xgplayer-icon .xgplayer-icon-pause,.xgplayer-skin-default.xgplayer-pause .xgplayer-play .xgplayer-icon .xgplayer-icon-pause{display:none}.xgplayer-skin-default.xgplayer-pause .xgplayer-play-img .xgplayer-tips .xgplayer-tip-play,.xgplayer-skin-default.xgplayer-pause .xgplayer-play .xgplayer-tips .xgplayer-tip-play{display:block}.xgplayer-skin-default.xgplayer-pause .xgplayer-play-img .xgplayer-tips .xgplayer-tip-pause,.xgplayer-skin-default.xgplayer-pause .xgplayer-play .xgplayer-tips .xgplayer-tip-pause{display:none}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(54);t.default={name:"s_poster",method:function(){var e=this.root;if(this.config.poster){var t=(0,r.createDom)("xg-poster","",{},"xgplayer-poster");t.style.backgroundImage="url("+this.config.poster+")",e.appendChild(t)}}},e.exports=t.default},function(e,t,n){var r=n(55);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-poster{display:none;position:absolute;left:0;top:0;width:100%;height:100%;z-index:100;background-size:cover;background-position:50%}.xgplayer-skin-default.xgplayer-nostart .xgplayer-poster{display:block}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(57);t.default={name:"s_flex",method:function(){var e=(0,r.createDom)("xg-placeholder","",{},"xgplayer-placeholder");this.controls.appendChild(e)}},e.exports=t.default},function(e,t,n){var r=n(58);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-placeholder{-webkit-flex:1;-moz-box-flex:1;flex:1;-webkit-order:3;-moz-box-ordinal-group:4;order:3;display:block}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=a(n(60)),o=a(n(61));function a(e){return e&&e.__esModule?e:{default:e}}n(62);t.default={name:"s_fullscreen",method:function(){var e=this,t=e.config.fullscreenBtn?e.config.fullscreenBtn:{},n=void 0;n="img"===t.type?(0,r.createImgBtn)("fullscreen",t.url.request,t.width,t.height):(0,r.createDom)("xg-fullscreen",'<xg-icon class="xgplayer-icon">\n                                             <div class="xgplayer-icon-requestfull">'+i.default+'</div>\n                                             <div class="xgplayer-icon-exitfull">'+o.default+"</div>\n                                           </xg-icon>",{},"xgplayer-fullscreen");var a={};a.requestfull=e.lang.FULLSCREEN_TIPS,a.exitfull=e.lang.EXITFULLSCREEN_TIPS;var s=(0,r.createDom)("xg-tips",'<span class="xgplayer-tip-requestfull">'+a.requestfull+'</span>\n                                        <span class="xgplayer-tip-exitfull">'+a.exitfull+"</span>",{},"xgplayer-tips");n.appendChild(s),e.once("ready",function(){e.controls&&e.controls.appendChild(n)}),["click","touchend"].forEach(function(t){n.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("fullscreenBtnClick")})})}},e.exports=t.default},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">\n  <path transform="scale(0.0320625 0.0320625)" d="M598 214h212v212h-84v-128h-128v-84zM726 726v-128h84v212h-212v-84h128zM214 426v-212h212v84h-128v128h-84zM298 598v128h128v84h-212v-212h84z"></path>\n</svg>\n'},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">\n  <path transform="scale(0.0320625 0.0320625)" d="M682 342h128v84h-212v-212h84v128zM598 810v-212h212v84h-128v128h-84zM342 342v-128h84v212h-212v-84h128zM214 682v-84h212v212h-84v-128h-128z"></path>\n</svg>\n'},function(e,t,n){var r=n(63);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-fullscreen,.xgplayer-skin-default .xgplayer-fullscreen-img{position:relative;-webkit-order:13;-moz-box-ordinal-group:14;order:13;display:block;cursor:pointer;margin-left:5px;margin-right:3px}.xgplayer-skin-default .xgplayer-fullscreen-img .xgplayer-icon,.xgplayer-skin-default .xgplayer-fullscreen .xgplayer-icon{margin-top:3px}.xgplayer-skin-default .xgplayer-fullscreen-img .xgplayer-icon div,.xgplayer-skin-default .xgplayer-fullscreen .xgplayer-icon div{position:absolute}.xgplayer-skin-default .xgplayer-fullscreen-img .xgplayer-icon .xgplayer-icon-requestfull,.xgplayer-skin-default .xgplayer-fullscreen .xgplayer-icon .xgplayer-icon-requestfull{display:block}.xgplayer-skin-default .xgplayer-fullscreen-img .xgplayer-icon .xgplayer-icon-exitfull,.xgplayer-skin-default .xgplayer-fullscreen .xgplayer-icon .xgplayer-icon-exitfull{display:none}.xgplayer-skin-default .xgplayer-fullscreen-img .xgplayer-tips,.xgplayer-skin-default .xgplayer-fullscreen .xgplayer-tips{position:absolute;right:0;left:auto}.xgplayer-skin-default .xgplayer-fullscreen-img .xgplayer-tips .xgplayer-tip-requestfull,.xgplayer-skin-default .xgplayer-fullscreen .xgplayer-tips .xgplayer-tip-requestfull{display:block}.xgplayer-skin-default .xgplayer-fullscreen-img .xgplayer-tips .xgplayer-tip-exitfull,.xgplayer-skin-default .xgplayer-fullscreen .xgplayer-tips .xgplayer-tip-exitfull{display:none}.xgplayer-skin-default .xgplayer-fullscreen-img:hover,.xgplayer-skin-default .xgplayer-fullscreen:hover{opacity:.85}.xgplayer-skin-default .xgplayer-fullscreen-img:hover .xgplayer-tips,.xgplayer-skin-default .xgplayer-fullscreen:hover .xgplayer-tips{display:block}.xgplayer-skin-default.xgplayer-is-fullscreen .xgplayer-fullscreen-img .xgplayer-icon .xgplayer-icon-requestfull,.xgplayer-skin-default.xgplayer-is-fullscreen .xgplayer-fullscreen .xgplayer-icon .xgplayer-icon-requestfull,.xgplayer-skin-default.xgplayer-rotate-fullscreen .xgplayer-fullscreen-img .xgplayer-icon .xgplayer-icon-requestfull,.xgplayer-skin-default.xgplayer-rotate-fullscreen .xgplayer-fullscreen .xgplayer-icon .xgplayer-icon-requestfull{display:none}.xgplayer-skin-default.xgplayer-is-fullscreen .xgplayer-fullscreen-img .xgplayer-icon .xgplayer-icon-exitfull,.xgplayer-skin-default.xgplayer-is-fullscreen .xgplayer-fullscreen .xgplayer-icon .xgplayer-icon-exitfull,.xgplayer-skin-default.xgplayer-rotate-fullscreen .xgplayer-fullscreen-img .xgplayer-icon .xgplayer-icon-exitfull,.xgplayer-skin-default.xgplayer-rotate-fullscreen .xgplayer-fullscreen .xgplayer-icon .xgplayer-icon-exitfull{display:block}.xgplayer-skin-default.xgplayer-is-fullscreen .xgplayer-fullscreen-img .xgplayer-tips .xgplayer-tip-requestfull,.xgplayer-skin-default.xgplayer-is-fullscreen .xgplayer-fullscreen .xgplayer-tips .xgplayer-tip-requestfull,.xgplayer-skin-default.xgplayer-rotate-fullscreen .xgplayer-fullscreen-img .xgplayer-tips .xgplayer-tip-requestfull,.xgplayer-skin-default.xgplayer-rotate-fullscreen .xgplayer-fullscreen .xgplayer-tips .xgplayer-tip-requestfull{display:none}.xgplayer-skin-default.xgplayer-is-fullscreen .xgplayer-fullscreen-img .xgplayer-tips .xgplayer-tip-exitfull,.xgplayer-skin-default.xgplayer-is-fullscreen .xgplayer-fullscreen .xgplayer-tips .xgplayer-tip-exitfull,.xgplayer-skin-default.xgplayer-rotate-fullscreen .xgplayer-fullscreen-img .xgplayer-tips .xgplayer-tip-exitfull,.xgplayer-skin-default.xgplayer-rotate-fullscreen .xgplayer-fullscreen .xgplayer-tips .xgplayer-tip-exitfull{display:block}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(65),a=(r=o)&&r.__esModule?r:{default:r};n(66);t.default={name:"s_loading",method:function(){var e=this.root,t=(0,i.createDom)("xg-loading",""+a.default,{},"xgplayer-loading");this.once("ready",function(){e.appendChild(t)})}},e.exports=t.default},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewbox="0 0 100 100">\n  <path d="M100,50A50,50,0,1,1,50,0"></path>\n</svg>\n'},function(e,t,n){var r=n(67);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-loading{display:none;width:100px;height:100px;overflow:hidden;-webkit-transform:scale(.7);-ms-transform:scale(.7);transform:scale(.7);position:absolute;left:50%;top:50%;margin:-50px auto auto -50px}.xgplayer-skin-default .xgplayer-loading svg{border-radius:50%;-webkit-transform-origin:center;-ms-transform-origin:center;transform-origin:center;-webkit-animation:loadingRotate 1s linear infinite;animation:loadingRotate 1s linear infinite}.xgplayer-skin-default .xgplayer-loading svg path{stroke:#ddd;stroke-dasharray:236;-webkit-animation:loadingDashOffset 2s linear infinite;animation:loadingDashOffset 2s linear infinite;animation-direction:alternate-reverse;fill:none;stroke-width:12px}.xgplayer-skin-default.xgplayer-nostart .xgplayer-loading{display:none}.xgplayer-skin-default.xgplayer-pause .xgplayer-loading{display:none!important}.xgplayer-skin-default.xgplayer-isloading .xgplayer-loading{display:block}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(5),a=(r=o)&&r.__esModule?r:{default:r};n(69);var s=function(e){return(0,i.hasClass)(e.root,"xgplayer-rotate-fullscreen")};t.default={name:"s_progress",method:function(){var e=this,t=(0,i.createDom)("xg-progress",'<xg-outer class="xgplayer-progress-outer">\n                                                   <xg-cache class="xgplayer-progress-cache"></xg-cache>\n                                                   <xg-played class="xgplayer-progress-played">\n                                                     <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>\n                                                     <xg-point class="xgplayer-progress-point xgplayer-tips"></xg-point>\n                                                     <xg-thumbnail class="xgplayer-progress-thumbnail xgplayer-tips"></xg-thumbnail>\n                                                   </xg-played>\n                                                 </xg-outer>',{tabindex:1},"xgplayer-progress"),n=void 0;e.controls.appendChild(t);var r=t.querySelector(".xgplayer-progress-played"),o=t.querySelector(".xgplayer-progress-outer"),u=t.querySelector(".xgplayer-progress-cache"),l=t.querySelector(".xgplayer-progress-point"),c=t.querySelector(".xgplayer-progress-thumbnail");function d(n,r){n.addEventListener("mouseenter",function(e){r&&((0,i.addClass)(n,"xgplayer-progress-dot-show"),(0,i.addClass)(t,"xgplayer-progress-dot-active"))}),n.addEventListener("mouseleave",function(e){r&&((0,i.removeClass)(n,"xgplayer-progress-dot-show"),(0,i.removeClass)(t,"xgplayer-progress-dot-active"))}),n.addEventListener("touchend",function(o){o.stopPropagation(),r&&((0,i.hasClass)(n,"xgplayer-progress-dot-show")||Object.keys(e.dotArr).forEach(function(t){e.dotArr[t]&&(0,i.removeClass)(e.dotArr[t],"xgplayer-progress-dot-show")}),(0,i.toggleClass)(n,"xgplayer-progress-dot-show"),(0,i.toggleClass)(t,"xgplayer-progress-dot-active"))})}function f(){e.config.progressDot&&"Array"===(0,i.typeOf)(e.config.progressDot)&&e.config.progressDot.forEach(function(t){if(t.time>=0&&t.time<=e.duration){var n=(0,i.createDom)("xg-progress-dot",t.text?'<span class="xgplayer-progress-tip">'+t.text+"</span>":"",{},"xgplayer-progress-dot");if(n.style.left=t.time/e.duration*100+"%",t.duration>=0&&(n.style.width=Math.min(t.duration,e.duration-t.time)/e.duration*100+"%"),t.style)for(var r in t.style)n.style[r]=t.style[r];o.appendChild(n),e.dotArr[t.time]=n,d(n,t.text)}})}e.dotArr={},e.once("canplay",f),e.addProgressDot=function(t,n,r,a){if(!e.dotArr[t]&&t>=0&&t<=e.duration){var s=(0,i.createDom)("xg-progress-dot",n?'<span class="xgplayer-progress-tip">'+n+"</span>":"",{},"xgplayer-progress-dot");if(s.style.left=t/e.duration*100+"%",r>=0&&(s.style.width=Math.min(r,e.duration-t)/e.duration*100+"%"),a)for(var u in a)s.style[u]=a[u];o.appendChild(s),e.dotArr[t]=s,d(s,n)}},e.removeProgressDot=function(t){if(t>=0&&t<=e.duration&&e.dotArr[t]){var n=e.dotArr[t];n.parentNode.removeChild(n),n=null,e.dotArr[t]=null}},e.removeAllProgressDot=function(){Object.keys(e.dotArr).forEach(function(t){if(e.dotArr[t]){var n=e.dotArr[t];n.parentNode.removeChild(n),n=null,e.dotArr[t]=null}})};var p=0,h=0,g=0,v=0,m=0,y=0,_=[],b=void 0,S=void 0,k=function(){e.config.thumbnail&&(e.config.thumbnail.isShowCoverPreview&&!b&&(r.removeChild(c),(b=(0,i.createDom)("xg-coverpreview",'<xg-outer class="xgplayer-coverpreview-outer">\n            <xg-thumbnail class="xgplayer-coverpreview-thumbnail"></xg-thumbnail>\n            <xg-point class="xgplayer-coverpreview-point"></xg-point>\n          </xg-outer>',{tabindex:1},"xgplayer-coverpreview")).querySelector(".xgplayer-coverpreview-outer"),S=b.querySelector(".xgplayer-coverpreview-point"),c=b.querySelector(".xgplayer-coverpreview-thumbnail"),e.root.appendChild(b)),p=e.config.thumbnail.pic_num,h=e.config.thumbnail.width,g=e.config.thumbnail.height,v=e.config.thumbnail.col,m=e.config.thumbnail.row,_=e.config.thumbnail.urls,c.style.width=h+"px",c.style.height=g+"px")};e.on("loadedmetadata",k),"function"==typeof e.config.disableSwipeHandler&&"function"==typeof e.config.enableSwipeHandler&&(e.root.addEventListener("touchmove",function(t){t.preventDefault(),e.disableSwipe||(e.disableSwipe=!0,e.config.disableSwipeHandler.call(e))}),e.root.addEventListener("touchstart",function(t){e.disableSwipe=!0,e.config.disableSwipeHandler.call(e)}),e.root.addEventListener("touchend",function(t){e.disableSwipe=!1,e.config.enableSwipeHandler.call(e)}));var w=["touchstart","mousedown"];"mobile"===a.default.device&&w.pop(),w.forEach(function(o){t.addEventListener(o,function(o){if(!e.config.disableProgress){if(o.stopPropagation(),(0,i.event)(o),o._target===l||!e.config.allowSeekAfterEnded&&e.ended)return!0;t.focus();var u=r.getBoundingClientRect().left,d=s(e);d?(u=r.getBoundingClientRect().top,n=t.getBoundingClientRect().height):(n=t.getBoundingClientRect().width,u=r.getBoundingClientRect().left);var f=function(t){t.stopPropagation(),(0,i.event)(t),e.isProgressMoving=!0;var o=(d?t.clientY:t.clientX)-u;o>n&&(o=n);var a=o/n*e.duration;if(a<0&&(a=0),e.config.allowSeekPlayed&&Number(a).toFixed(1)>e.maxPlayedTime);else if(r.style.width=100*o/n+"%","video"!==e.videoConfig.mediaType||e.dash||e.config.closeMoveSeek){var s=(0,i.findDom)(e.controls,".xgplayer-time");s&&(s.innerHTML='<span class="xgplayer-time-current">'+(0,i.format)(a||0)+"</span><span>"+(0,i.format)(e.duration)+"</span>")}else console.log("trigger touchmove"),e.currentTime=Number(a).toFixed(1);if(e.config.thumbnail&&e.config.thumbnail.isShowCoverPreview){S.innerHTML="<span>"+(0,i.format)(a)+"</span> / "+(0,i.format)(e.duration||0),y=e.duration/p;var l=Math.floor(a/y);c.style.backgroundImage="url("+_[Math.ceil((l+1)/(v*m))-1]+")";var f=l+1-v*m*(Math.ceil((l+1)/(v*m))-1),k=Math.ceil(f/m)-1,w=f-k*m-1;c.style["background-position"]="-"+w*h+"px -"+k*g+"px",b.style.display="block"}e.emit("focus")},k=function o(s){if(console.log("up event",s),s.stopPropagation(),(0,i.event)(s),window.removeEventListener("mousemove",f),window.removeEventListener("touchmove",f,{passive:!1}),window.removeEventListener("mouseup",o),window.removeEventListener("touchend",o),a.default.browser.indexOf("ie")<0&&t.blur(),!e.isProgressMoving||e.videoConfig&&"audio"===e.videoConfig.mediaType||e.dash||e.config.closeMoveSeek){var l=(d?s.clientY:s.clientX)-u;l>n&&(l=n);var c=l/n*e.duration;c<0&&(c=0),e.config.allowSeekPlayed&&Number(c).toFixed(1)>e.maxPlayedTime||(r.style.width=100*l/n+"%",console.warn("trigger touchup"),e.currentTime=Number(c).toFixed(1))}e.config.thumbnail&&e.config.thumbnail.isShowCoverPreview&&(b.style.display="none"),e.emit("focus"),e.isProgressMoving=!1};return window.addEventListener("touchmove",f,{passive:!1}),window.addEventListener("touchend",k),window.addEventListener("mousemove",f),window.addEventListener("mouseup",k),!0}})}),t.addEventListener("mouseenter",function(n){if(!e.config.allowSeekAfterEnded&&e.ended)return!0;var r=s(e),o=r?t.getBoundingClientRect().top:t.getBoundingClientRect().left,a=r?t.getBoundingClientRect().height:t.getBoundingClientRect().width,u=function(n){var s=((r?n.clientY:n.clientX)-o)/a*e.duration;s=s<0?0:s,l.textContent=(0,i.format)(s);var u=l.getBoundingClientRect().width;if(e.config.thumbnail&&!e.config.thumbnail.isShowCoverPreview){y=e.duration/p;var d=Math.floor(s/y);c.style.backgroundImage="url("+_[Math.ceil((d+1)/(v*m))-1]+")";var f=d+1-v*m*(Math.ceil((d+1)/(v*m))-1),b=Math.ceil(f/m)-1,S=f-b*m-1;c.style["background-position"]="-"+S*h+"px -"+b*g+"px";var k=(r?n.clientY:n.clientX)-o-h/2;k=(k=k>0?k:0)<a-h?k:a-h,c.style.left=k+"px",c.style.top=-10-g+"px",c.style.display="block",l.style.left=k+h/2-u/2+"px"}else{var w=n.clientX-o-u/2;w=(w=w>0?w:0)>a-u?a-u:w,l.style.left=w+"px"}(0,i.hasClass)(t,"xgplayer-progress-dot-active")?l.style.display="none":l.style.display="block"},d=function(e){u(e)};t.addEventListener("mousemove",d,!1),t.addEventListener("mouseleave",function n(r){t.removeEventListener("mousemove",d,!1),t.removeEventListener("mouseleave",n,!1),u(r),l.style.display="none",e.config.thumbnail&&!e.config.thumbnail.isShowCoverPreview&&(c.style.display="none")},!1),u(n)},!1);var E=function(){if(void 0===e.maxPlayedTime&&(e.maxPlayedTime=0),e.maxPlayedTime<e.currentTime&&(e.maxPlayedTime=e.currentTime),!n&&t&&(n=t.getBoundingClientRect().width),!e.isProgressMoving&&!e.isSeeking&&!e.seeking){var i=e.currentTime/e.duration,o=Number(r.style.width.replace("%","")||"0")/Number(t.style.width||"100");Math.abs(i-o)<=1&&(r.style.width=100*e.currentTime/e.duration+"%")}};e.on("timeupdate",E);var T=function(t){r.style.width=100*t/e.duration+"%"};e.on("currentTimeChange",T);var x=function(){r.style.width="0%"};e.on("srcChange",x);var C=function(){var t=e.buffered;if(t&&t.length>0){for(var n=t.end(t.length-1),r=0,i=t.length;r<i;r++)if(e.currentTime>=t.start(r)&&e.currentTime<=t.end(r)){n=t.end(r);for(var o=r+1;o<t.length;o++)if(t.start(o)-t.end(o-1)>=2){n=t.end(o-1);break}break}u.style.width=n/e.duration*100+"%"}},I=["bufferedChange","cacheupdate","ended","timeupdate"];I.forEach(function(t){e.on(t,C)}),e.once("destroy",function t(){e.removeAllProgressDot(),e.off("canplay",f),e.off("timeupdate",E),e.off("currentTimeChange",T),e.off("srcChange",x),e.off("loadedmetadata",k),I.forEach(function(t){e.off(t,C)}),e.off("destroy",t)})}},e.exports=t.default},function(e,t,n){var r=n(70);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-progress{display:block;position:absolute;height:20px;line-height:20px;left:12px;right:12px;outline:none;top:-15px;z-index:35}.xgplayer-skin-default .xgplayer-progress-outer{background:hsla(0,0%,100%,.3);display:block;height:3px;line-height:3px;margin-top:8.5px;width:100%;position:relative;cursor:pointer}.xgplayer-skin-default .xgplayer-progress-cache,.xgplayer-skin-default .xgplayer-progress-played{display:block;height:100%;line-height:1;position:absolute;left:0;top:0}.xgplayer-skin-default .xgplayer-progress-cache{width:0;background:hsla(0,0%,100%,.5)}.xgplayer-skin-default .xgplayer-progress-played{display:block;width:0;background-image:linear-gradient(-90deg,#fa1f41,#e31106);border-radius:0 1.5px 1.5px 0}.xgplayer-skin-default .xgplayer-progress-btn{display:none;position:absolute;left:0;top:-5px;width:13px;height:13px;border-radius:30px;background:#fff;box-shadow:0 0 2px 0 rgba(0,0,0,.26);left:100%;-webkit-transform:translate(-50%);-ms-transform:translate(-50%);transform:translate(-50%);z-index:36}.xgplayer-skin-default .xgplayer-progress-point{position:absolute}.xgplayer-skin-default .xgplayer-progress-point.xgplayer-tips{margin-left:0;top:-25px;display:none;z-index:100}.xgplayer-skin-default .xgplayer-progress-dot{display:inline-block;position:absolute;height:3px;width:5px;top:0;background:#fff;border-radius:6px;z-index:16}.xgplayer-skin-default .xgplayer-progress-dot .xgplayer-progress-tip{position:absolute;bottom:200%;right:50%;-webkit-transform:translateX(50%);-ms-transform:translateX(50%);transform:translateX(50%);height:auto;line-height:30px;width:auto;background:rgba(0,0,0,.3);border-radius:6px;border:1px solid rgba(0,0,0,.8);cursor:default;white-space:nowrap;display:none}.xgplayer-skin-default .xgplayer-progress-dot-show .xgplayer-progress-tip{display:block}.xgplayer-skin-default .xgplayer-progress-thumbnail{position:absolute;-moz-box-sizing:border-box;box-sizing:border-box}.xgplayer-skin-default .xgplayer-progress-thumbnail.xgplayer-tips{margin-left:0;display:none;z-index:99}.xgplayer-skin-default .xgplayer-coverpreview{position:absolute;width:100%;height:100%;top:0;left:0;display:none}.xgplayer-skin-default .xgplayer-coverpreview .xgplayer-coverpreview-outer{position:absolute;display:block;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.xgplayer-skin-default .xgplayer-coverpreview .xgplayer-coverpreview-outer .xgplayer-coverpreview-thumbnail{display:block}.xgplayer-skin-default .xgplayer-coverpreview .xgplayer-coverpreview-outer .xgplayer-coverpreview-point{display:block;text-align:center;font-family:PingFangSC-Regular;font-size:11px;color:#ccc;padding:2px 4px}.xgplayer-skin-default .xgplayer-coverpreview .xgplayer-coverpreview-outer .xgplayer-coverpreview-point span{color:#fff}.xgplayer-skin-default .xgplayer-progress:focus .xgplayer-progress-outer,.xgplayer-skin-default .xgplayer-progress:hover .xgplayer-progress-outer{height:6px;margin-top:7px}.xgplayer-skin-default .xgplayer-progress:focus .xgplayer-progress-dot,.xgplayer-skin-default .xgplayer-progress:hover .xgplayer-progress-dot{height:6px}.xgplayer-skin-default .xgplayer-progress:focus .xgplayer-progress-btn,.xgplayer-skin-default .xgplayer-progress:hover .xgplayer-progress-btn{display:block;top:-3px}.xgplayer-skin-default.xgplayer-definition-active .xgplayer-progress,.xgplayer-skin-default.xgplayer-playbackrate-active .xgplayer-progress,.xgplayer-skin-default.xgplayer-texttrack-active .xgplayer-progress,.xgplayer-skin-default.xgplayer-volume-active .xgplayer-progress{z-index:15}.xgplayer-skin-default.xgplayer-mobile .xgplayer-progress-btn{display:block!important}.xgplayer-skin-default.xgplayer-mobile .xgplayer-progress:focus .xgplayer-progress-outer,.xgplayer-skin-default.xgplayer-mobile .xgplayer-progress:hover .xgplayer-progress-outer{height:3px!important;margin-top:8.5px!important}.xgplayer-skin-default.xgplayer-mobile .xgplayer-progress:focus .xgplayer-progress-btn,.xgplayer-skin-default.xgplayer-mobile .xgplayer-progress:hover .xgplayer-progress-btn{display:block!important;top:-5px!important}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(72);t.default={name:"s_time",method:function(){var e=this,t=(0,r.createDom)("xg-time",'<span class="xgplayer-time-current">'+(e.currentTime||(0,r.format)(0))+"</span>\n                                           <span>"+(e.duration||(0,r.format)(0))+"</span>",{},"xgplayer-time");e.once("ready",function(){e.controls&&e.controls.appendChild(t)});var n=function(){"audio"===e.videoConfig.mediaType&&e.isProgressMoving&&e.dash||(t.innerHTML='<span class="xgplayer-time-current">'+(0,r.format)(e.currentTime||0)+"</span><span>"+(0,r.format)(e.duration)+"</span>")};e.on("durationchange",n),e.on("timeupdate",n),e.once("destroy",function t(){e.off("durationchange",n),e.off("timeupdate",n),e.off("destroy",t)})}},e.exports=t.default},function(e,t,n){var r=n(73);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,'.xgplayer-skin-default .xgplayer-time{-webkit-order:2;-moz-box-ordinal-group:3;order:2;font-family:ArialMT;font-size:13px;color:#fff;line-height:40px;height:40px;text-align:center;display:inline-block;margin:auto 8px}.xgplayer-skin-default .xgplayer-time span{color:hsla(0,0%,100%,.5)}.xgplayer-skin-default .xgplayer-time .xgplayer-time-current{color:#fff}.xgplayer-skin-default .xgplayer-time .xgplayer-time-current:after{content:"/";display:inline-block;padding:0 3px}',""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(75),a=(r=o)&&r.__esModule?r:{default:r};n(76);t.default={name:"s_replay",method:function(){var e=this,t=e.root,n=e.lang.REPLAY,r=(0,i.createDom)("xg-replay",a.default+'\n                                         <xg-replay-txt class="xgplayer-replay-txt">'+n+"</xg-replay-txt>\n                                        ",{},"xgplayer-replay");function o(){var e=r.querySelector("path");if(e){var t=window.getComputedStyle(e).getPropertyValue("transform");if("string"==typeof t&&t.indexOf("none")>-1)return;e.setAttribute("transform",t)}}e.once("ready",function(){t.appendChild(r)}),e.on("ended",o),r.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation()});var s=r.querySelector("svg");["click","touchend"].forEach(function(t){s.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("replayBtnClick")})}),e.once("destroy",function t(){e.off("ended",o),e.off("destroy",t)})}},e.exports=t.default},function(e,t,n){"use strict";n.r(t),t.default='<svg class="xgplayer-replay-svg" xmlns="http://www.w3.org/2000/svg" width="78" height="78" viewbox="0 0 78 78">\n  <path d="M8.22708362,13.8757234 L11.2677371,12.6472196 C11.7798067,12.4403301 12.3626381,12.6877273 12.5695276,13.1997969 L12.9441342,14.1269807 C13.1510237,14.6390502 12.9036264,15.2218816 12.3915569,15.4287712 L6.8284538,17.6764107 L5.90126995,18.0510173 C5.38920044,18.2579068 4.80636901,18.0105096 4.5994795,17.49844 L1.97723335,11.0081531 C1.77034384,10.4960836 2.0177411,9.91325213 2.52981061,9.70636262 L3.45699446,9.33175602 C3.96906396,9.12486652 4.5518954,9.37226378 4.75878491,9.88433329 L5.67885163,12.1615783 C7.99551726,6.6766934 13.3983951,3 19.5,3 C27.7842712,3 34.5,9.71572875 34.5,18 C34.5,26.2842712 27.7842712,33 19.5,33 C15.4573596,33 11.6658607,31.3912946 8.87004692,28.5831991 C8.28554571,27.9961303 8.28762719,27.0463851 8.87469603,26.4618839 C9.46176488,25.8773827 10.4115101,25.8794641 10.9960113,26.466533 C13.2344327,28.7147875 16.263503,30 19.5,30 C26.127417,30 31.5,24.627417 31.5,18 C31.5,11.372583 26.127417,6 19.5,6 C14.4183772,6 9.94214483,9.18783811 8.22708362,13.8757234 Z"></path>\n</svg>\n'},function(e,t,n){var r=n(77);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-replay{position:absolute;left:0;top:0;width:100%;height:100%;z-index:105;display:none;-webkit-justify-content:center;-moz-box-pack:center;justify-content:center;-webkit-align-items:center;-moz-box-align:center;align-items:center;background:rgba(0,0,0,.54);-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;flex-direction:column}.xgplayer-skin-default .xgplayer-replay svg{background:rgba(0,0,0,.58);border-radius:100%;cursor:pointer}.xgplayer-skin-default .xgplayer-replay svg path{-webkit-transform:translate(20px,21px);-ms-transform:translate(20px,21px);transform:translate(20px,21px);fill:#ddd}.xgplayer-skin-default .xgplayer-replay svg:hover{background:rgba(0,0,0,.38)}.xgplayer-skin-default .xgplayer-replay svg:hover path{fill:#fff}.xgplayer-skin-default .xgplayer-replay .xgplayer-replay-txt{display:inline-block;font-family:PingFangSC-Regular;font-size:14px;color:#fff;line-height:34px}.xgplayer-skin-default.xgplayer.xgplayer-ended .xgplayer-controls{display:none}.xgplayer-skin-default.xgplayer.xgplayer-ended .xgplayer-replay{display:-webkit-flex;display:-moz-box;display:flex}",""])},function(e,t,n){var r=n(161);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){e.exports=n(80)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=I(n(9)),i=I(n(81)),o=I(n(82)),a=I(n(83)),s=I(n(84)),u=I(n(85)),l=I(n(88)),c=I(n(45)),d=I(n(89)),f=I(n(90)),p=I(n(91)),h=I(n(92)),g=I(n(37)),v=I(n(38)),m=I(n(98)),y=I(n(46)),_=I(n(99)),b=I(n(100)),S=I(n(47)),k=I(n(101)),w=I(n(102)),E=I(n(103)),T=I(n(39)),x=I(n(104)),C=I(n(105));function I(e){return e&&e.__esModule?e:{default:e}}n(107),r.default.installAll([i.default,o.default,a.default,s.default,u.default,l.default,c.default,d.default,f.default,p.default,h.default,g.default,v.default,m.default,y.default,_.default,b.default,S.default,k.default,w.default,E.default,T.default,x.default,C.default]),t.default=r.default,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={name:"airplay",method:function(){var e=this;function t(){e.video.webkitShowPlaybackTargetPicker()}e.config.airplay&&window.WebKitPlaybackTargetAvailabilityEvent&&(e.on("airplayBtnClick",t),e.once("destroy",function n(){e.off("airplayBtnClick",t),e.off("destroy",n)}))}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={name:"cssFullscreen",method:function(){var e=this,t=e.root;function n(){(0,r.hasClass)(t,"xgplayer-is-cssfullscreen")?e.exitCssFullscreen():e.getCssFullscreen()}e.on("cssFullscreenBtnClick",n),e.on("exitFullscreen",function(){(0,r.removeClass)(t,"xgplayer-is-cssfullscreen")}),e.once("destroy",function t(){e.off("cssFullscreenBtnClick",n),e.off("destroy",t)}),e.getCssFullscreen=function(){this.config.fluid&&(this.root.style["padding-top"]=""),(0,r.addClass)(this.root,"xgplayer-is-cssfullscreen"),this.emit("requestCssFullscreen")},e.exitCssFullscreen=function(){this.config.fluid&&(this.root.style.width="100%",this.root.style.height="0",this.root.style["padding-top"]=100*this.config.height/this.config.width+"%"),(0,r.removeClass)(this.root,"xgplayer-is-cssfullscreen"),this.emit("exitCssFullscreen")}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={name:"danmu",method:function(){var e=this;e.on("initDefaultDanmu",function(t){var n=e.root.querySelector("xg-danmu");if((0,r.addClass)(n,"xgplayer-has-danmu"),!e.config.danmu.closeDefaultBtn){var i=function(){t.start()},o=function(){(0,r.hasClass)(e.danmuBtn,"danmu-switch-active")&&t.pause()},a=function(){(0,r.hasClass)(e.danmuBtn,"danmu-switch-active")&&t.play()},s=function(){(0,r.hasClass)(e.danmuBtn,"danmu-switch-active")&&(t.stop(),t.start())};e.danmuBtn=(0,r.copyDom)(t.bulletBtn.createSwitch(!0)),e.controls.appendChild(e.danmuBtn),["click","touchend"].forEach(function(o){e.danmuBtn.addEventListener(o,function(o){o.preventDefault(),o.stopPropagation(),(0,r.toggleClass)(e.danmuBtn,"danmu-switch-active"),(0,r.hasClass)(e.danmuBtn,"danmu-switch-active")?(e.emit("danmuBtnOn"),(0,r.addClass)(n,"xgplayer-has-danmu"),e.once("timeupdate",i)):(e.emit("danmuBtnOff"),(0,r.removeClass)(n,"xgplayer-has-danmu"),t.stop())})}),e.onElementClick&&n.addEventListener("click",function(t){e.onElementClick(t,n)},!1),e.onElementDblclick&&n.addEventListener("dblclick",function(t){e.onElementDblclick(t,n)},!1),e.on("pause",o),e.on("play",a),e.on("seeked",s),e.once("destroy",function t(){e.off("timeupdate",i),e.off("pause",o),e.off("play",a),e.off("seeked",s),e.off("destroy",t)})}})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={name:"definition",method:function(){var e=this;e.once("destroy",function t(){e.off("destroy",t)})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(86),o=(r=i)&&r.__esModule?r:{default:r},a=n(87);t.default={name:"download",method:function(){var e=this;function t(){e.download()}e.on("downloadBtnClick",t),e.once("destroy",function n(){e.off("downloadBtnClick",t),e.off("destroy",n)}),e.download=function(){var e=(0,a.getAbsoluteURL)(this.config.url);(0,o.default)(e)}}},e.exports=t.default},function(e,t,n){var r,i,o;i=[],void 0===(o="function"==typeof(r=function(){return function e(t,n,r){var i,o,a=window,s="application/octet-stream",u=r||s,l=t,c=!n&&!r&&l,d=document.createElement("a"),f=function(e){return String(e)},p=a.Blob||a.MozBlob||a.WebKitBlob||f,h=n||"download";if(p=p.call?p.bind(a):Blob,"true"===String(this)&&(u=(l=[l,u])[0],l=l[1]),c&&c.length<2048&&(h=c.split("/").pop().split("?")[0],d.href=c,-1!==d.href.indexOf(c))){var g=new XMLHttpRequest;return g.open("GET",c,!0),g.responseType="blob",g.onload=function(t){e(t.target.response,h,s)},setTimeout(function(){g.send()},0),g}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(l)){if(!(l.length>2096103.424&&p!==f))return navigator.msSaveBlob?navigator.msSaveBlob(_(l),h):b(l);l=_(l),u=l.type||s}else if(/([\x80-\xff])/.test(l)){for(var v=0,m=new Uint8Array(l.length),y=m.length;v<y;++v)m[v]=l.charCodeAt(v);l=new p([m],{type:u})}function _(e){for(var t=e.split(/[:;,]/),n=t[1],r="base64"==t[2]?atob:decodeURIComponent,i=r(t.pop()),o=i.length,a=0,s=new Uint8Array(o);a<o;++a)s[a]=i.charCodeAt(a);return new p([s],{type:n})}function b(e,t){if("download"in d)return d.href=e,d.setAttribute("download",h),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout(function(){d.click(),document.body.removeChild(d),!0===t&&setTimeout(function(){a.URL.revokeObjectURL(d.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var n=document.createElement("iframe");document.body.appendChild(n),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),n.src=e,setTimeout(function(){document.body.removeChild(n)},333)}if(i=l instanceof p?l:new p([l],{type:u}),navigator.msSaveBlob)return navigator.msSaveBlob(i,h);if(a.URL)b(a.URL.createObjectURL(i),!0);else{if("string"==typeof i||i.constructor===f)try{return b("data:"+u+";base64,"+a.btoa(i))}catch(e){return b("data:"+u+","+encodeURIComponent(i))}(o=new FileReader).onload=function(e){b(this.result)},o.readAsDataURL(i)}return!0}})?r.apply(t,i):r)||(e.exports=o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getAbsoluteURL=function(e){if(!e.match(/^https?:\/\//)){var t=document.createElement("div");t.innerHTML='<a href="'+e+'">x</a>',e=t.firstChild.href}return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(4),o=(r=i)&&r.__esModule?r:{default:r};var a={maxCount:3,backupUrl:"",isFetch:!0,fetchTimeout:100};t.default={name:"errorretry",method:function(){var e=this,t=this;if(t.config.errorConfig&&!(t.src.indexOf("blob:")>-1)){var n={},r=t.config.errorConfig;for(var i in a)void 0===r[i]?n[i]=a[i]:n[i]=r[i];t.retryData={count:0,errfTimer:null,isFetchReturn:!1,currentTime:0};var s=t._onError;t._onError=function(r){var i=e.retryData.count;if(i>n.maxCount)n.isFetch?function(e,t,n){var r=function(t,n){e.retryData.isFetchReturn||(e.retryData.isFetchReturn=!0,t(n))};return new Promise(function(i,o){try{var a=new window.XMLHttpRequest;a.open("get",t),a.onload=function(){r(i,{status:a.status,statusText:a.statusText,xhr:a})},a.onerror=function(){r(i,{status:a.status,statusText:a.statusText||"The network environment is disconnected or the address is invalid",xhr:a})},a.onabort=function(){},e.retryData.errfTimer=window.setTimeout(function(){var t=e.retryData.errfTimer;window.clearTimeout(t),e.retryData.errfTimer=null,r(i,{status:-1,statusText:"request timeout"})},n),a.send()}catch(t){e.retryData.isFetchReturn=!0,r(i,{status:-2,statusText:"request error"})}})}(e,e.currentSrc,n.fetchTimeout).then(function(t){e.emit("error",new o.default({type:"network",currentTime:e.currentTime,duration:e.duration||0,networkState:e.networkState,readyState:e.readyState,currentSrc:e.currentSrc,src:e.src,ended:e.ended,httpCode:t.status,httpMsg:t.statusText,errd:{line:101,msg:e.error,handle:"plugin errorRetry"},errorCode:e.video&&e.video.error.code,mediaError:e.video&&e.video.error})),s.call(e,t)}):s.call(e,r);else{0===i&&(e.retryData.currentTime=e.currentTime,e.once("canplay",function(){this.currentTime=this.retryData.currentTime,this.play(),this.retryData.retryCode=0,this.retryData.isFetchReturn=!1,this.retryData.currentTime=0}.bind(e)));var a="";a=n.count<2?n.backupUrl?n.backupUrl:t.currentSrc:n.backupUrl&&i>1?n.backupUrl:t.currentSrc,e.retryData.count++,e.src=a}}}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0);var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.state={playbackRate:0,isRepeat:!1,keyCode:0,repeat:0,isBody:!1},this.timer=null,this.initEvents()}return r(e,[{key:"initEvents",value:function(){var e=this,t=this.player,n=t.root,r=t.config;if(this.player.onBodyKeydown=this.onBodyKeydown.bind(this),this.player.onKeydown=this.onKeydown.bind(this),this.player.onKeyup=this.onKeyup.bind(this),!r.keyShortcut||"on"===r.keyShortcut){document.addEventListener("keydown",this.player.onBodyKeydown),n.addEventListener("keydown",this.player.onKeydown);(0,i.on)(this.player,"destroy",function(){document.removeEventListener("keydown",e.player.onBodyKeydown),n.removeEventListener("keydown",e.player.onKeydown),clearTimeout(e.timer),e.timer=null})}}},{key:"checkTarget",value:function(e){var t=this.player;return e.target===t.root||e.target===t.video||e.target===t.controls}},{key:"onBodyKeydown",value:function(e){var t=e||window.event,n=t.keyCode;if(t.target===document.body&&(37===n||39===n||32===n))return t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,t.repeat||document.addEventListener("keyup",this.player.onKeyup),this.handler(t),!1}},{key:"onKeydown",value:function(e){var t=e||window.event,n=t.keyCode;if(this.checkTarget(t)&&(37===n||38===n||39===n||40===n||32===n||27===n))return t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,this.player.emit("focus"),t.repeat||this.player.root.addEventListener("keyup",this.player.onKeyup),this.handler(t),!1}},{key:"onKeyup",value:function(){var e=this.state,t=this.player;document.removeEventListener("keyup",this.player.onKeyup),t.root.removeEventListener("keyup",this.player.onKeyup),e.keyCode&&(0!==e.playbackRate&&(t.playbackRate=e.playbackRate),e.isRepeat||this.handlerKeyCode(e.keyCode,!1),e.playbackRate=0,e.isRepeat=!1,e.keyCode=0,e.repeat=0,this.changeVolumeSlide())}},{key:"handler",value:function(e){var t=this.state,n=this.player;t.keyCode=e.keyCode,t.isRepeat=e.repeat,e.repeat&&(n.config.disableLongPress?this.handlerKeyCode(t.keyCode,!1):t.repeat%2==0&&this.handlerKeyCode(t.keyCode,!0),t.repeat++)}},{key:"handlerKeyCode",value:function(e,t){var n=this.player,r=this.state;switch(e){case 39:t?0===r.repeat&&this.changeRate():this.seek(!1,t);break;case 37:this.seek(!0,t);break;case 38:this.changeVolume(!0);break;case 40:this.changeVolume(!1);break;case 32:t||(n.paused?n.play():n.pause());break;case 27:(0,i.hasClass)(n.root,"xgplayer-is-cssfullscreen")&&n.exitCssFullscreen()}}},{key:"seek",value:function(e,t){var n=this.player,r=(n.config.keyShortcutStep||{}).currentTime||10;n.isLoading||n.isSeeking||t&&this.state.repeat%8>0||(e?n.currentTime-r>=0?n.currentTime-=r:n.currentTime=0:n.maxPlayedTime&&n.config.allowSeekPlayed&&n.currentTime+r>n.maxPlayedTime?n.currentTime=n.maxPlayedTime:n.currentTime+r<=n.duration?n.currentTime+=r:n.currentTime=n.duration+1)}},{key:"changeRate",value:function(){this.state.playbackRate=this.player.playbackRate,this.player.playbackRate=this.player.config.keyboardRate||5}},{key:"changeVolumeSlide",value:function(e){var t=this.player;t.controls&&(e?(t.emit("focus"),(0,i.hasClass)(t.root,"xgplayer-volume-active")||(0,i.addClass)(t.root,"xgplayer-volume-active")):(clearTimeout(this.timer),this.timer=setTimeout(function(){(0,i.removeClass)(t.root,"xgplayer-volume-active")},1e3)))}},{key:"changeVolume",value:function(e){var t=this.player,n=(t.config.keyShortcutStep||{}).volume||.1;this.changeVolumeSlide(!0);var r=t.volume;e&&r+n<=1?t.volume=r+n:!e&&r-n>=0&&(t.volume=r-n)}}]),e}();t.default={name:"keyboard",method:function(){this.keyboard=new o(this)}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={name:"localPreview",method:function(){var e=this,t=e.root;function n(n){e.uploadFile=n.files[0];var i=URL.createObjectURL(e.uploadFile);if((0,r.hasClass)(t,"xgplayer-nostart"))e.config.url=i,e.start();else{e.src=i;var o=e.play();void 0!==o&&o&&o.catch(function(e){})}}e.on("upload",n),e.once("destroy",function t(){e.off("upload",n),e.off("destroy",t)})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={name:"memoryPlay",method:function(){var e=this;e.on("memoryPlayStart",function(t){setTimeout(function(){console.log("memoryPlayStart",t,e.readyState,11),e.currentTime=t})})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(93),a=(r=o)&&r.__esModule?r:{default:r};t.default={name:"miniplayer",method:function(){var e=this,t=e.root;function n(){(0,i.hasClass)(t,"xgplayer-miniplayer-active")?e.exitMiniplayer():e.getMiniplayer()}e.on("miniplayerBtnClick",n),e.once("destroy",function t(){e.off("miniplayerBtnClick",n),e.off("destroy",t)}),e.getMiniplayer=function(){(0,i.hasClass)(t,"xgplayer-is-fullscreen")&&this.exitFullscreen(t),(0,i.hasClass)(t,"xgplayer-is-cssfullscreen")&&this.exitCssFullscreen(),(0,i.hasClass)(t,"xgplayer-rotate-fullscreen")&&this.exitRotateFullscreen();var e=(0,i.createDom)("xg-miniplayer-lay","<div></div>",{},"xgplayer-miniplayer-lay");this.root.appendChild(e);var n=(0,i.createDom)("xg-miniplayer-drag",'<div class="drag-handle"><span>'+this.lang.MINIPLAYER_DRAG+"</span></div>",{tabindex:9},"xgplayer-miniplayer-drag");this.root.appendChild(n),new a.default(".xgplayer",{handle:".drag-handle"}),(0,i.addClass)(this.root,"xgplayer-miniplayer-active"),this.root.style.right=0,this.root.style.bottom="200px",this.root.style.top="",this.root.style.left="",this.root.style.width="320px",this.root.style.height="180px",this.config.miniplayerConfig&&(void 0!==this.config.miniplayerConfig.top&&(this.root.style.top=this.config.miniplayerConfig.top+"px",this.root.style.bottom=""),void 0!==this.config.miniplayerConfig.bottom&&(this.root.style.bottom=this.config.miniplayerConfig.bottom+"px"),void 0!==this.config.miniplayerConfig.left&&(this.root.style.left=this.config.miniplayerConfig.left+"px",this.root.style.right=""),void 0!==this.config.miniplayerConfig.right&&(this.root.style.right=this.config.miniplayerConfig.right+"px"),void 0!==this.config.miniplayerConfig.width&&(this.root.style.width=this.config.miniplayerConfig.width+"px"),void 0!==this.config.miniplayerConfig.height&&(this.root.style.height=this.config.miniplayerConfig.height+"px")),this.config.fluid&&(this.root.style["padding-top"]="");var r=this;["click","touchend"].forEach(function(t){e.addEventListener(t,function(e){e.preventDefault(),e.stopPropagation(),r.exitMiniplayer()})})},e.exitMiniplayer=function(){(0,i.removeClass)(this.root,"xgplayer-miniplayer-active"),this.root.style.right="",this.root.style.bottom="",this.root.style.top="",this.root.style.left="",this.config.fluid?(this.root.style.width="100%",this.root.style.height="0",this.root.style["padding-top"]=100*this.config.height/this.config.width+"%"):(this.config.width&&("number"!=typeof this.config.width?this.root.style.width=this.config.width:this.root.style.width=this.config.width+"px"),this.config.height&&("number"!=typeof this.config.height?this.root.style.height=this.config.height:this.root.style.height=this.config.height+"px"));var e=(0,i.findDom)(this.root,".xgplayer-miniplayer-lay");e&&e.parentNode&&e.parentNode.removeChild(e);var t=(0,i.findDom)(this.root,".xgplayer-miniplayer-drag");t&&t.parentNode&&t.parentNode.removeChild(t)}}},e.exports=t.default},function(e,t,n){var r,i;
/*!
 * Draggabilly v2.4.1
 * Make that shiz draggable
 * https://draggabilly.desandro.com
 * MIT license
 */
/*!
 * Draggabilly v2.4.1
 * Make that shiz draggable
 * https://draggabilly.desandro.com
 * MIT license
 */
!function(o,a){r=[n(94),n(95)],void 0===(i=function(e,t){return function(e,t,n){function r(e,t){for(var n in t)e[n]=t[n];return e}var i=e.jQuery;function o(e,t){this.element="string"==typeof e?document.querySelector(e):e,i&&(this.$element=i(this.element)),this.options=r({},this.constructor.defaults),this.option(t),this._create()}var a=o.prototype=Object.create(n.prototype);o.defaults={},a.option=function(e){r(this.options,e)};var s={relative:!0,absolute:!0,fixed:!0};function u(e,t,n){return n=n||"round",t?Math[n](e/t)*t:e}a._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition=r({},this.position);var e=getComputedStyle(this.element);s[e.position]||(this.element.style.position="relative"),this.on("pointerMove",this.onPointerMove),this.on("pointerUp",this.onPointerUp),this.enable(),this.setHandles()},a.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element],this.bindHandles()},a.dispatchEvent=function(e,t,n){var r=[t].concat(n);this.emitEvent(e,r),this.dispatchJQueryEvent(e,t,n)},a.dispatchJQueryEvent=function(t,n,r){var i=e.jQuery;if(i&&this.$element){var o=i.Event(n);o.type=t,this.$element.trigger(o,r)}},a._getPosition=function(){var e=getComputedStyle(this.element),t=this._getPositionCoord(e.left,"width"),n=this._getPositionCoord(e.top,"height");this.position.x=isNaN(t)?0:t,this.position.y=isNaN(n)?0:n,this._addTransformPosition(e)},a._getPositionCoord=function(e,n){if(-1!=e.indexOf("%")){var r=t(this.element.parentNode);return r?parseFloat(e)/100*r[n]:0}return parseInt(e,10)},a._addTransformPosition=function(e){var t=e.transform;if(0===t.indexOf("matrix")){var n=t.split(","),r=0===t.indexOf("matrix3d")?12:4,i=parseInt(n[r],10),o=parseInt(n[r+1],10);this.position.x+=i,this.position.y+=o}},a.onPointerDown=function(e,t){this.element.classList.add("is-pointer-down"),this.dispatchJQueryEvent("pointerDown",e,[t])},a.pointerDown=function(e,t){this.okayPointerDown(e)&&this.isEnabled?(this.pointerDownPointer={pageX:t.pageX,pageY:t.pageY},e.preventDefault(),this.pointerDownBlur(),this._bindPostStartEvents(e),this.element.classList.add("is-pointer-down"),this.dispatchEvent("pointerDown",e,[t])):this._pointerReset()},a.dragStart=function(e,t){this.isEnabled&&(this._getPosition(),this.measureContainment(),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this.element.classList.add("is-dragging"),this.dispatchEvent("dragStart",e,[t]),this.animate())},a.measureContainment=function(){var e=this.getContainer();if(e){var n=t(this.element),r=t(e),i=this.element.getBoundingClientRect(),o=e.getBoundingClientRect(),a=r.borderLeftWidth+r.borderRightWidth,s=r.borderTopWidth+r.borderBottomWidth,u=this.relativeStartPosition={x:i.left-(o.left+r.borderLeftWidth),y:i.top-(o.top+r.borderTopWidth)};this.containSize={width:r.width-a-u.x-n.width,height:r.height-s-u.y-n.height}}},a.getContainer=function(){var e=this.options.containment;if(e)return e instanceof HTMLElement?e:"string"==typeof e?document.querySelector(e):this.element.parentNode},a.onPointerMove=function(e,t,n){this.dispatchJQueryEvent("pointerMove",e,[t,n])},a.dragMove=function(e,t,n){if(this.isEnabled){var r=n.x,i=n.y,o=this.options.grid,a=o&&o[0],s=o&&o[1];r=u(r,a),i=u(i,s),r=this.containDrag("x",r,a),i=this.containDrag("y",i,s),r="y"==this.options.axis?0:r,i="x"==this.options.axis?0:i,this.position.x=this.startPosition.x+r,this.position.y=this.startPosition.y+i,this.dragPoint.x=r,this.dragPoint.y=i,this.dispatchEvent("dragMove",e,[t,n])}},a.containDrag=function(e,t,n){if(!this.options.containment)return t;var r="x"==e?"width":"height",i=u(-this.relativeStartPosition[e],n,"ceil"),o=this.containSize[r];return o=u(o,n,"floor"),Math.max(i,Math.min(o,t))},a.onPointerUp=function(e,t){this.element.classList.remove("is-pointer-down"),this.dispatchJQueryEvent("pointerUp",e,[t])},a.dragEnd=function(e,t){this.isEnabled&&(this.element.style.transform="",this.setLeftTop(),this.element.classList.remove("is-dragging"),this.dispatchEvent("dragEnd",e,[t]))},a.animate=function(){if(this.isDragging){this.positionDrag();var e=this;requestAnimationFrame(function(){e.animate()})}},a.setLeftTop=function(){this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"},a.positionDrag=function(){this.element.style.transform="translate3d( "+this.dragPoint.x+"px, "+this.dragPoint.y+"px, 0)"},a.staticClick=function(e,t){this.dispatchEvent("staticClick",e,[t])},a.setPosition=function(e,t){this.position.x=e,this.position.y=t,this.setLeftTop()},a.enable=function(){this.isEnabled=!0},a.disable=function(){this.isEnabled=!1,this.isDragging&&this.dragEnd()},a.destroy=function(){this.disable(),this.element.style.transform="",this.element.style.left="",this.element.style.top="",this.element.style.position="",this.unbindHandles(),this.$element&&this.$element.removeData("draggabilly")},a._init=function(){},i&&i.bridget&&i.bridget("draggabilly",o);return o}(o,e,t)}.apply(t,r))||(e.exports=i)}(window)},function(e,t,n){var r,i;
/*!
 * getSize v2.0.3
 * measure size of elements
 * MIT license
 */window,void 0===(i="function"==typeof(r=function(){"use strict";function e(e){var t=parseFloat(e),n=-1==e.indexOf("%")&&!isNaN(t);return n&&t}var t="undefined"==typeof console?function(){}:function(e){console.error(e)},n=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],r=n.length;function i(e){var n=getComputedStyle(e);return n||t("Style returned "+n+". Are you running this code in a hidden iframe on Firefox? See https://bit.ly/getsizebug1"),n}var o,a=!1;function s(t){if(function(){if(!a){a=!0;var t=document.createElement("div");t.style.width="200px",t.style.padding="1px 2px 3px 4px",t.style.borderStyle="solid",t.style.borderWidth="1px 2px 3px 4px",t.style.boxSizing="border-box";var n=document.body||document.documentElement;n.appendChild(t);var r=i(t);o=200==Math.round(e(r.width)),s.isBoxSizeOuter=o,n.removeChild(t)}}(),"string"==typeof t&&(t=document.querySelector(t)),t&&"object"==typeof t&&t.nodeType){var u=i(t);if("none"==u.display)return function(){for(var e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},t=0;t<r;t++){var i=n[t];e[i]=0}return e}();var l={};l.width=t.offsetWidth,l.height=t.offsetHeight;for(var c=l.isBorderBox="border-box"==u.boxSizing,d=0;d<r;d++){var f=n[d],p=u[f],h=parseFloat(p);l[f]=isNaN(h)?0:h}var g=l.paddingLeft+l.paddingRight,v=l.paddingTop+l.paddingBottom,m=l.marginLeft+l.marginRight,y=l.marginTop+l.marginBottom,_=l.borderLeftWidth+l.borderRightWidth,b=l.borderTopWidth+l.borderBottomWidth,S=c&&o,k=e(u.width);!1!==k&&(l.width=k+(S?0:g+_));var w=e(u.height);return!1!==w&&(l.height=w+(S?0:v+b)),l.innerWidth=l.width-(g+_),l.innerHeight=l.height-(v+b),l.outerWidth=l.width+m,l.outerHeight=l.height+y,l}}return s})?r.call(t,n,t,e):r)||(e.exports=i)},function(e,t,n){var r,i;
/*!
 * Unidragger v2.4.0
 * Draggable base class
 * MIT license
 */
/*!
 * Unidragger v2.4.0
 * Draggable base class
 * MIT license
 */
!function(o,a){r=[n(96)],void 0===(i=function(e){return function(e,t){"use strict";function n(){}var r=n.prototype=Object.create(t.prototype);r.bindHandles=function(){this._bindHandles(!0)},r.unbindHandles=function(){this._bindHandles(!1)},r._bindHandles=function(t){for(var n=(t=void 0===t||t)?"addEventListener":"removeEventListener",r=t?this._touchActionValue:"",i=0;i<this.handles.length;i++){var o=this.handles[i];this._bindStartEvent(o,t),o[n]("click",this),e.PointerEvent&&(o.style.touchAction=r)}},r._touchActionValue="none",r.pointerDown=function(e,t){var n=this.okayPointerDown(e);n&&(this.pointerDownPointer={pageX:t.pageX,pageY:t.pageY},e.preventDefault(),this.pointerDownBlur(),this._bindPostStartEvents(e),this.emitEvent("pointerDown",[e,t]))};var i={TEXTAREA:!0,INPUT:!0,SELECT:!0,OPTION:!0},o={radio:!0,checkbox:!0,button:!0,submit:!0,image:!0,file:!0};return r.okayPointerDown=function(e){var t=i[e.target.nodeName],n=o[e.target.type],r=!t||n;return r||this._pointerReset(),r},r.pointerDownBlur=function(){var e=document.activeElement;e&&e.blur&&e!=document.body&&e.blur()},r.pointerMove=function(e,t){var n=this._dragPointerMove(e,t);this.emitEvent("pointerMove",[e,t,n]),this._dragMove(e,t,n)},r._dragPointerMove=function(e,t){var n={x:t.pageX-this.pointerDownPointer.pageX,y:t.pageY-this.pointerDownPointer.pageY};return!this.isDragging&&this.hasDragStarted(n)&&this._dragStart(e,t),n},r.hasDragStarted=function(e){return Math.abs(e.x)>3||Math.abs(e.y)>3},r.pointerUp=function(e,t){this.emitEvent("pointerUp",[e,t]),this._dragPointerUp(e,t)},r._dragPointerUp=function(e,t){this.isDragging?this._dragEnd(e,t):this._staticClick(e,t)},r._dragStart=function(e,t){this.isDragging=!0,this.isPreventingClicks=!0,this.dragStart(e,t)},r.dragStart=function(e,t){this.emitEvent("dragStart",[e,t])},r._dragMove=function(e,t,n){this.isDragging&&this.dragMove(e,t,n)},r.dragMove=function(e,t,n){e.preventDefault(),this.emitEvent("dragMove",[e,t,n])},r._dragEnd=function(e,t){this.isDragging=!1,setTimeout(function(){delete this.isPreventingClicks}.bind(this)),this.dragEnd(e,t)},r.dragEnd=function(e,t){this.emitEvent("dragEnd",[e,t])},r.onclick=function(e){this.isPreventingClicks&&e.preventDefault()},r._staticClick=function(e,t){this.isIgnoringMouseUp&&"mouseup"==e.type||(this.staticClick(e,t),"mouseup"!=e.type&&(this.isIgnoringMouseUp=!0,setTimeout(function(){delete this.isIgnoringMouseUp}.bind(this),400)))},r.staticClick=function(e,t){this.emitEvent("staticClick",[e,t])},n.getPointerPoint=t.getPointerPoint,n}(o,e)}.apply(t,r))||(e.exports=i)}(window)},function(e,t,n){var r,i;
/*!
 * Unipointer v2.4.0
 * base class for doing one thing with pointer event
 * MIT license
 */
/*!
 * Unipointer v2.4.0
 * base class for doing one thing with pointer event
 * MIT license
 */
!function(o,a){r=[n(97)],void 0===(i=function(e){return function(e,t){"use strict";function n(){}var r=n.prototype=Object.create(t.prototype);r.bindStartEvent=function(e){this._bindStartEvent(e,!0)},r.unbindStartEvent=function(e){this._bindStartEvent(e,!1)},r._bindStartEvent=function(t,n){var r=(n=void 0===n||n)?"addEventListener":"removeEventListener",i="mousedown";"ontouchstart"in e?i="touchstart":e.PointerEvent&&(i="pointerdown"),t[r](i,this)},r.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},r.getTouch=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.identifier==this.pointerIdentifier)return n}},r.onmousedown=function(e){var t=e.button;t&&0!==t&&1!==t||this._pointerDown(e,e)},r.ontouchstart=function(e){this._pointerDown(e,e.changedTouches[0])},r.onpointerdown=function(e){this._pointerDown(e,e)},r._pointerDown=function(e,t){e.button||this.isPointerDown||(this.isPointerDown=!0,this.pointerIdentifier=void 0!==t.pointerId?t.pointerId:t.identifier,this.pointerDown(e,t))},r.pointerDown=function(e,t){this._bindPostStartEvents(e),this.emitEvent("pointerDown",[e,t])};var i={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]};return r._bindPostStartEvents=function(t){if(t){var n=i[t.type];n.forEach(function(t){e.addEventListener(t,this)},this),this._boundPointerEvents=n}},r._unbindPostStartEvents=function(){this._boundPointerEvents&&(this._boundPointerEvents.forEach(function(t){e.removeEventListener(t,this)},this),delete this._boundPointerEvents)},r.onmousemove=function(e){this._pointerMove(e,e)},r.onpointermove=function(e){e.pointerId==this.pointerIdentifier&&this._pointerMove(e,e)},r.ontouchmove=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerMove(e,t)},r._pointerMove=function(e,t){this.pointerMove(e,t)},r.pointerMove=function(e,t){this.emitEvent("pointerMove",[e,t])},r.onmouseup=function(e){this._pointerUp(e,e)},r.onpointerup=function(e){e.pointerId==this.pointerIdentifier&&this._pointerUp(e,e)},r.ontouchend=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerUp(e,t)},r._pointerUp=function(e,t){this._pointerDone(),this.pointerUp(e,t)},r.pointerUp=function(e,t){this.emitEvent("pointerUp",[e,t])},r._pointerDone=function(){this._pointerReset(),this._unbindPostStartEvents(),this.pointerDone()},r._pointerReset=function(){this.isPointerDown=!1,delete this.pointerIdentifier},r.pointerDone=function(){},r.onpointercancel=function(e){e.pointerId==this.pointerIdentifier&&this._pointerCancel(e,e)},r.ontouchcancel=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerCancel(e,t)},r._pointerCancel=function(e,t){this._pointerDone(),this.pointerCancel(e,t)},r.pointerCancel=function(e,t){this.emitEvent("pointerCancel",[e,t])},n.getPointerPoint=function(e){return{x:e.pageX,y:e.pageY}},n}(o,e)}.apply(t,r))||(e.exports=i)}(window)},function(e,t,n){var r,i;"undefined"!=typeof window&&window,void 0===(i="function"==typeof(r=function(){"use strict";function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var n=this._events=this._events||{},r=n[e]=n[e]||[];return-1==r.indexOf(t)&&r.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var n=this._onceEvents=this._onceEvents||{};return(n[e]=n[e]||{})[t]=!0,this}},t.off=function(e,t){var n=this._events&&this._events[e];if(n&&n.length){var r=n.indexOf(t);return-1!=r&&n.splice(r,1),this}},t.emitEvent=function(e,t){var n=this._events&&this._events[e];if(n&&n.length){n=n.slice(0),t=t||[];for(var r=this._onceEvents&&this._onceEvents[e],i=0;i<n.length;i++){var o=n[i];r&&r[o]&&(this.off(e,o),delete r[o]),o.apply(this,t)}return this}},t.allOff=function(){delete this._events,delete this._onceEvents},e})?r.call(t,n,t,e):r)||(e.exports=i)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={name:"pip",method:function(){var e=this,t=this;function n(){t.video!==document.pictureInPictureElement?t.video.requestPictureInPicture():document.exitPictureInPicture()}t.on("pipBtnClick",n);var i=function(n){var i=t.video.webkitPresentationMode;e.pMode=i,i===r.PresentationMode.PIP?t.emit("requestPictureInPicture",n.pictureInPictureWindow):i===r.PresentationMode.INLINE&&t.emit("exitPictureInPicture")};t.video.addEventListener("enterpictureinpicture",function(e){(0,r.addClass)(t.root,"xgplayer-pip-active"),t.emit("requestPictureInPicture",e)}),t.video.addEventListener("leavepictureinpicture",function(){(0,r.removeClass)(t.root,"xgplayer-pip-active"),t.emit("exitPictureInPicture")}),(0,r.checkWebkitSetPresentationMode)(t.video)&&t.video.addEventListener("webkitpresentationmodechanged",i),t.once("destroy",function e(){t.off("pipBtnClick",n),t.off("destroy",e),(0,r.checkWebkitSetPresentationMode)(t.video)&&t.video.removeEventListener("webkitpresentationmodechanged",i)})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={name:"playNext",method:function(){var e=this,t=e.config.playNext;function n(){e.currentVideoIndex+1<t.urlList.length&&(e.currentVideoIndex++,e.video.autoplay=!0,e.src=t.urlList[e.currentVideoIndex],e.emit("playerNext",e.currentVideoIndex+1),e.currentVideoIndex+1===t.urlList.length&&e.emit("urlListEnd"))}e.currentVideoIndex=-1,e.on("playNextBtnClick",n),e.once("destroy",function t(){e.off("playNextBtnClick",n),e.off("destroy",t)})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={name:"reload",method:function(){var e=this;function t(){(0,r.removeClass)(e.root,"xgplayer-is-error"),e.src=e.config.url}e.config.reload&&(e.on("reloadBtnClick",t),e.once("destroy",function n(){e.off("reloadBtnClick",t),e.off("destroy",n)}))}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={name:"rotate",method:function(){var e=this,t=e.config.rotate;function n(){e.rotate(t.clockwise,t.innerRotate)}t&&(e.on("rotateBtnClick",n),e.once("destroy",function t(){e.off("rotateBtnClick",n),e.off("destroy",t)}),e.updateRotateDeg=function(){this.rotateDeg||(this.rotateDeg=0);var e=this.root.offsetWidth,t=this.root.offsetHeight,n=this.video.videoWidth,r=this.video.videoHeight;!this.config.rotate.innerRotate&&this.config.rotate.controlsFix&&(this.root.style.width=t+"px",this.root.style.height=e+"px");var i=void 0;.25===this.rotateDeg||.75===this.rotateDeg?(i=this.config.rotate.innerRotate?n/r>t/e?t/(r/n>t/e?t*n/r:e):e/(r/n>t/e?t:e*r/n):e>=t?e/t:t/e,i=Number(i.toFixed(5))):i=1,this.config.rotate.innerRotate?(this.video.style.transformOrigin="center center",this.video.style.transform="rotate("+this.rotateDeg+"turn) scale("+i+")",this.video.style.webKitTransform="rotate("+this.rotateDeg+"turn) scale("+i+")"):this.config.rotate.controlsFix?(this.video.style.transformOrigin="center center",this.video.style.transform="rotate("+this.rotateDeg+"turn) scale("+i+")",this.video.style.webKitTransform="rotate("+this.rotateDeg+"turn) scale("+i+")"):(this.root.style.transformOrigin="center center",this.root.style.transform="rotate("+this.rotateDeg+"turn) scale(1)",this.root.style.webKitTransform="rotate("+this.rotateDeg+"turn) scale(1)")},e.rotate=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:1);this.rotateDeg||(this.rotateDeg=0);var n=e?1:-1;this.rotateDeg=(this.rotateDeg+1+.25*n*t)%1,this.updateRotateDeg(),this.emit("rotate",360*this.rotateDeg)})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={name:"screenShot",method:function(){var e=this,t=e.config.screenShot,n=null;if(t){e.video.setAttribute("crossOrigin","anonymous");var r=.92;(t.quality||0===t.quality)&&(r=t.quality);var i=void 0===t.type?"image/png":t.type,o=void 0===t.format?".png":t.format,a=document.createElement("canvas"),s=a.getContext("2d"),u=new Image;a.width=this.config.width||600,a.height=this.config.height||337.5,e.screenShot=function(){var l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];l=void 0===t.saveImg?l:t.saveImg,a.width=e.video.videoWidth||600,a.height=e.video.videoHeight||337.5,n=t.callBack,u.onload=function(){s.drawImage(e.video,0,0,a.width,a.height),u.src=a.toDataURL(i,r).replace(i,"image/octet-stream");var c=u.src.replace(/^data:image\/[^;]+/,"data:application/octet-stream"),d=t.fileName||e.lang.SCREENSHOT;e.emit("screenShot",c),l&&n?n(c,d,o):l&&function(e,t){var n=document.createElement("a");n.href=e,n.download=t;var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)}(c,d+o)}()},e.on("screenShotBtnClick",e.screenShot),e.once("destroy",function t(){e.off("screenShotBtnClick",e.screenShot),e.off("destroy",t)})}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(4),o=(r=i)&&r.__esModule?r:{default:r};t.default={name:"stallCheck",method:function(){var e=this;if(e.config.enableStallCheck){var t=0,n=void 0,r=void 0;e.once("complete",function(){setInterval(function(){e.currentTime-(t||0)>.1||e.paused?1!==n&&2!==n||(n=0,clearTimeout(r),r=null):n||(n=1,r=setTimeout(function(){1===n&&(n=2,e.emit("error",new o.default("STALL"))),r=null},2e4)),t=e.currentTime},1e3)})}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(5),a=(r=o)&&r.__esModule?r:{default:r};t.default={name:"volume",method:function(){var e=this,t=e.root,n=void 0,r=void 0,o=void 0,s=void 0;function u(){e.controls&&(e.volume=e.config.volume,(n=e.controls.querySelector(".xgplayer-volume"))&&(r=n.querySelector(".xgplayer-slider"),o=n.querySelector(".xgplayer-bar"),s=n.querySelector(".xgplayer-drag"),"mobile"===a.default.device&&(0===e.volume&&(e.video.muted=!0),h())))}function l(t){if(r){e.video.muted=!1,r.focus(),(0,i.event)(t);var n=o.getBoundingClientRect(),a=(t.clientX,t.clientY),u=s.getBoundingClientRect().height,l=!1,c=function(t){t.preventDefault(),t.stopPropagation(),(0,i.event)(t),l=!0;var r=u-t.clientY+a,o=r/n.height;s.style.height=r+"px",e.volume=Math.max(Math.min(o,1),0)},d=function t(o){if(o.preventDefault(),o.stopPropagation(),(0,i.event)(o),window.removeEventListener("mousemove",c),window.removeEventListener("touchmove",c),window.removeEventListener("mouseup",t),window.removeEventListener("touchend",t),!l){var a=n.height-(o.clientY-n.top),u=a/n.height;s.style.height=a+"px",u<=0&&(e.volume>0?s.volume=e.video.volume:u=s.volume),e.volume=Math.max(Math.min(u,1),0)}r.volume=e.volume,l=!1};return window.addEventListener("mousemove",c),window.addEventListener("touchmove",c),window.addEventListener("mouseup",d),window.addEventListener("touchend",d),!1}}function c(){if("mobile"===a.default.device)e.video.muted?(e.video.muted=!1,e.emit("unmute"),e.volume=1):(e.video.muted=!0,e.emit("mute"),e.volume=0);else{if(!r)return;e.video.muted=!1,e.volume<.1?(r.volume<.1?e.volume=.6:e.volume=r.volume,e.emit("unmute")):(e.volume=0,e.emit("mute"))}}function d(){(0,i.addClass)(t,"xgplayer-volume-active"),n&&n.focus()}function f(){(0,i.removeClass)(t,"xgplayer-volume-active")}e.once("canplay",u),e.on("volumeBarClick",l),e.on("volumeIconClick",c),e.on("volumeIconEnter",d),e.on("volumeIconLeave",f);var p=null;function h(){p&&clearTimeout(p),p=setTimeout(function(){if("mobile"===a.default.device)(0,i.removeClass)(t,"xgplayer-volume-muted"),(0,i.removeClass)(t,"xgplayer-volume-large"),e.video.muted||e.video.defaultMuted?(e.video.muted||(e.video.muted=!0),e.video.defaultMuted=!1,(0,i.addClass)(t,"xgplayer-volume-muted")):(0,i.addClass)(t,"xgplayer-volume-large");else{if((0,i.removeClass)(t,"xgplayer-volume-muted"),(0,i.removeClass)(t,"xgplayer-volume-small"),(0,i.removeClass)(t,"xgplayer-volume-large"),0===e.volume||e.muted?(0,i.addClass)(t,"xgplayer-volume-muted"):e.volume<.5?(0,i.addClass)(t,"xgplayer-volume-small"):(0,i.addClass)(t,"xgplayer-volume-large"),!o)return;var n=o.getBoundingClientRect().height||76;s.style.height=e.volume*n+"px"}},50)}e.on("volumechange",h),e.once("destroy",function t(){e.off("canplay",u),e.off("volumeBarClick",l),e.off("volumeIconClick",c),e.off("volumeIconEnter",d),e.off("volumeIconLeave",f),e.off("volumechange",h),e.off("destroy",t),p&&(clearTimeout(p),p=null)})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(106),a=(r=o)&&r.__esModule?r:{default:r};var s={follow:!0,mode:"stroke",followBottom:50,fitVideo:!0,offsetBottom:2,baseSizeX:49,baseSizeY:28,minSize:16,minMobileSize:13,line:"double",fontColor:"#fff"},u=function(){function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=this.create(n,r,t.textTrackShowDefault);o.attachPlayer(t),this.subtitle=o,this.player=t,this.positionData={vBottom:0,marginBottom:0},this.isActive=!1,this.followBottom=r.followBottom,["onSubtitleResize","onFocus","onBlur"].map(function(e){i[e]=i[e].bind(i)}),t.controls&&r.follow&&(this.subtitle.on("resize",this.onSubtitleResize),t.on("focus",this.onFocus),t.on("blur",this.onBlur))}return i(e,[{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={subTitles:e,defaultOpen:!(arguments.length>2&&void 0!==arguments[2])||arguments[2]};return Object.keys(t).map(function(e){n[e]=t[e]}),new a.default(n)}},{key:"switch",value:function(e){return this.subtitle.switch(e)}},{key:"switchOff",value:function(){return this.subtitle.switchOff()}},{key:"setSubTitles",value:function(e,t,n){return this.subtitle.setSubTitles(e,t,n)}},{key:"onFocus",value:function(){var e=this.positionData,t=e.marginBottom,n=e.vBottom;if(!this.isActive&&t){this.isActive=!0;var r=t+n;this.followBottom>r&&(r=this.followBottom),this.subtitle&&(this.subtitle.root.style.bottom=r+"px")}}},{key:"onBlur",value:function(){this.isActive=!1;var e=this.positionData.vBottom+this.positionData.marginBottom;this.subtitle&&(this.subtitle.root.style.bottom=e+"px")}},{key:"onSubtitleResize",value:function(e){this.positionData.vBottom=e.vBottom,this.positionData.marginBottom=e.marginBottom}},{key:"destroy",value:function(){this.subtitle.off("resize",this.onSubtitleResize),this.player.off("focus",this.onFocus),this.player.off("blur",this.onBlur),this.subtitle.destroy(),this.subtitle=null}}]),e}();t.default={name:"textTrack",method:function(){var e=this,t=this,n=t.config.textTrack;if(n){var r=t.config.textTrackStyle||{};Object.keys(s).map(function(e){void 0===r[e]&&(r[e]=s[e])}),t.textTrackShowDefault=!1,t.config.textTrack.map(function(e,n){e.id||e.language||(e.id=n),!e.url&&(e.url=e.src),!e.language&&(e.language=e.srclang),void 0===e.isDefault&&(e.isDefault=e.default),!t.textTrackShowDefault&&(t.textTrackShowDefault=e.isDefault||e.default)}),this.subTitles=new u(t,t.config.textTrack,r),t.setSubTitles=function(n){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!1;n.map(function(e,t){e.id||e.language||(e.id=t),!e.url&&(e.url=e.src),!e.language&&(e.language=e.srclang),void 0===e.isDefault&&(e.isDefault=e.default),e.isDefault&&(i=!0)}),t.textTrackShowDefault=i,e.subTitles.setSubTitles(n,i,r),t.emit("subtitle_change",{off:!1,isListUpdate:!0,list:n})},t.switchSubTitle=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:"",language:""};e.subTitles.switch(n).then(function(e){0===e.code&&(n.off=!1,n.isListUpdate=!1,n.list=[],t.emit("subtitle_change",n))})},t.switchOffSubtile=function(){e.subTitles.switchOff(),t.emit("subtitle_change",{off:!0,isListUpdate:!1,list:[]})},t.once("destroy",function(){this.subTitles.destroy(),this.subTitles=null})}}},e.exports=t.default},function(e,t,n){e.exports=function(){"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}function n(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=I(t),this.reject=I(n)}function r(e){var t=e.length;return 3===t?(60*(60*Number(e[0])+Number(e[1]))*1e3+1e3*Number(e[2]))/1e3:2===t?(60*Number(e[0])*1e3+1e3*Number(e[1]))/1e3:Number(e[0])}function i(e){return/^(\-|\+)?\d+(\.\d+)?$/.test(e)}function o(e){return e}function a(e,t){return e>=0&&e<t.length?t[e]:""}function s(e,t){if(!e)return!1;if(e.classList)return Array.prototype.some.call(e.classList,function(e){return e===t});var n=e.className&&"object"===Dt(e.className)?e.getAttribute("class"):e.className;return n&&!!n.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function u(e,t){e&&(e.classList?t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(t){t&&e.classList.add(t)}):s(e,t)||(e.className&&"object"===Dt(e.className)?e.setAttribute("class",e.getAttribute("class")+" "+t):e.className+=" "+t))}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={code:yr[e].code,msg:yr[e].msg};return rr(t).map(function(e){n[e]=t[e]}),n}function c(e,t,n,r,i){i?n(l(2,i),{format:r.format}):r.format?(e.list=r.list,e.format=r.format,e.styles=r.styles,t(e)):n(l(3))}function d(e){return new tr(function(t,n){if(e.list)t(e);else{if(e.json){var r=gr.parseJson(e.json);return e.list=r,e.format="json",void t(e)}if(e.stringContent&&!e.url)gr.parse(e.stringContent,function(r,i){c(e,t,n,r,i)});else if(e.url)new or({url:e.url,type:"text"}).then(function(r){gr.parse(r.res.response,function(r,i){c(e,t,n,r,i)})}).catch(function(t){var r=l(1,{statusText:t.statusText,status:t.status,type:t.type,message:"http load error",url:e.url});n(r)});else{var i=l(8);n(i)}}})}function f(e,t){return!!(e.id&&e.id===t.id||e.language&&e.language===t.language)}var p=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e},h=function(e){return Object(p(e))},g={}.hasOwnProperty,v=function(e,t){return g.call(e,t)},m=t(function(e){var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)}),y=(m.version,t(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)})),_=t(function(e){var t=y["__core-js_shared__"]||(y["__core-js_shared__"]={});(e.exports=function(e,n){return t[e]||(t[e]=void 0!==n?n:{})})("versions",[]).push({version:m.version,mode:"pure",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})}),b=0,S=Math.random(),k=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++b+S).toString(36))},w=_("keys"),E=function(e){return w[e]||(w[e]=k(e))},T=E("IE_PROTO"),x=Object.prototype,C=Object.getPrototypeOf||function(e){return e=h(e),v(e,T)?e[T]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?x:null},I=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},R=function(e,t,n){if(I(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},A=function(e){return"object"==typeof e?null!==e:"function"==typeof e},O=function(e){if(!A(e))throw TypeError(e+" is not an object!");return e},M=function(e){try{return!!e()}catch(e){return!0}},D=!M(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),L=y.document,P=A(L)&&A(L.createElement),N=function(e){return P?L.createElement(e):{}},U=!D&&!M(function(){return 7!=Object.defineProperty(N("div"),"a",{get:function(){return 7}}).a}),F=function(e,t){if(!A(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!A(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!A(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!A(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},j=Object.defineProperty,G={f:D?Object.defineProperty:function(e,t,n){if(O(e),t=F(t,!0),O(n),U)try{return j(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},B=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},V=D?function(e,t,n){return G.f(e,t,B(1,n))}:function(e,t,n){return e[t]=n,e},q=function(e,t,n){var r,i,o,a=e&q.F,s=e&q.G,u=e&q.S,l=e&q.P,c=e&q.B,d=e&q.W,f=s?m:m[t]||(m[t]={}),p=f.prototype,h=s?y:u?y[t]:(y[t]||{}).prototype;for(r in s&&(n=t),n)(i=!a&&h&&void 0!==h[r])&&v(f,r)||(o=i?h[r]:n[r],f[r]=s&&"function"!=typeof h[r]?n[r]:c&&i?R(o,y):d&&h[r]==o?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(o):l&&"function"==typeof o?R(Function.call,o):o,l&&((f.virtual||(f.virtual={}))[r]=o,e&q.R&&p&&!p[r]&&V(p,r,o)))};q.F=1,q.G=2,q.S=4,q.P=8,q.B=16,q.W=32,q.U=64,q.R=128;var H=q,z=function(e,t){var n=(m.Object||{})[e]||Object[e],r={};r[e]=t(n),H(H.S+H.F*M(function(){n(1)}),"Object",r)};z("getPrototypeOf",function(){return function(e){return C(h(e))}});var K=m.Object.getPrototypeOf,W=e(t(function(e){e.exports={default:K,__esModule:!0}})),Y=e(t(function(e,t){t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}})),J=Math.ceil,X=Math.floor,Q=function(e){return isNaN(e=+e)?0:(e>0?X:J)(e)},Z=V,$={},ee={}.toString,te=function(e){return ee.call(e).slice(8,-1)},ne=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==te(e)?e.split(""):Object(e)},re=function(e){return ne(p(e))},ie=Math.min,oe=function(e){return e>0?ie(Q(e),9007199254740991):0},ae=Math.max,se=Math.min,ue=function(e,t,n){for(var r=re(e),i=oe(r.length),o=function(e,t){return(e=Q(e))<0?ae(e+t,0):se(e,t)}(n,i);i>o;o++)if(o in r&&r[o]===t)return o||0;return-1},le=E("IE_PROTO"),ce=function(e,t){var n,r=re(e),i=0,o=[];for(n in r)n!=le&&v(r,n)&&o.push(n);for(;t.length>i;)v(r,n=t[i++])&&(~ue(o,n)||o.push(n));return o},de="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),fe=Object.keys||function(e){return ce(e,de)},pe=D?Object.defineProperties:function(e,t){O(e);for(var n,r=fe(t),i=r.length,o=0;i>o;)G.f(e,n=r[o++],t[n]);return e},he=y.document,ge=he&&he.documentElement,ve=E("IE_PROTO"),me=function(){},ye=function(){var e,t=N("iframe"),n=de.length;for(t.style.display="none",ge.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),ye=e.F;n--;)delete ye.prototype[de[n]];return ye()},_e=Object.create||function(e,t){var n;return null!==e?(me.prototype=O(e),n=new me,me.prototype=null,n[ve]=e):n=ye(),void 0===t?n:pe(n,t)},be=t(function(e){var t=_("wks"),n=y.Symbol,r="function"==typeof n;(e.exports=function(e){return t[e]||(t[e]=r&&n[e]||(r?n:k)("Symbol."+e))}).store=t}),Se=G.f,ke=be("toStringTag"),we=function(e,t,n){e&&!v(e=n?e:e.prototype,ke)&&Se(e,ke,{configurable:!0,value:t})},Ee={};V(Ee,be("iterator"),function(){return this});var Te=be("iterator"),xe=!([].keys&&"next"in[].keys()),Ce=function(){return this},Ie=function(e,t,n,r,i,o,a){!function(e,t,n){e.prototype=_e(Ee,{next:B(1,n)}),we(e,t+" Iterator")}(n,t,r);var s,u,l,c=function(e){if(!xe&&e in h)return h[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},d=t+" Iterator",f="values"==i,p=!1,h=e.prototype,g=h[Te]||h["@@iterator"]||i&&h[i],v=g||c(i),m=i?f?c("entries"):v:void 0,y="Array"==t&&h.entries||g;if(y&&(l=C(y.call(new e)))!==Object.prototype&&l.next&&we(l,d,!0),f&&g&&"values"!==g.name&&(p=!0,v=function(){return g.call(this)}),a&&(xe||p||!h[Te])&&V(h,Te,v),$[t]=v,$[d]=Ce,i)if(s={values:f?v:c("values"),keys:o?v:c("keys"),entries:m},a)for(u in s)u in h||Z(h,u,s[u]);else H(H.P+H.F*(xe||p),t,s);return s},Re=function(e,t){var n,r,i=String(p(e)),o=Q(t),a=i.length;return o<0||o>=a?"":(n=i.charCodeAt(o))<55296||n>56319||o+1===a||(r=i.charCodeAt(o+1))<56320||r>57343?i.charAt(o):i.slice(o,o+2)};Ie(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=Re(t,n),this._i+=e.length,{value:e,done:!1})});var Ae=function(e,t){return{value:t,done:!!e}};Ie(Array,"Array",function(e,t){this._t=re(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,Ae(1)):Ae(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),$.Arguments=$.Array;for(var Oe=be("toStringTag"),Me="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),De=0;De<Me.length;De++){var Le=Me[De],Pe=y[Le],Ne=Pe&&Pe.prototype;Ne&&!Ne[Oe]&&V(Ne,Oe,Le),$[Le]=$.Array}var Ue={f:be},Fe=Ue.f("iterator"),je=t(function(e){e.exports={default:Fe,__esModule:!0}});e(je);var Ge=t(function(e){var t=k("meta"),n=G.f,r=0,i=Object.isExtensible||function(){return!0},o=!M(function(){return i(Object.preventExtensions({}))}),a=function(e){n(e,t,{value:{i:"O"+ ++r,w:{}}})},s=e.exports={KEY:t,NEED:!1,fastKey:function(e,n){if(!A(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!v(e,t)){if(!i(e))return"F";if(!n)return"E";a(e)}return e[t].i},getWeak:function(e,n){if(!v(e,t)){if(!i(e))return!0;if(!n)return!1;a(e)}return e[t].w},onFreeze:function(e){return o&&s.NEED&&i(e)&&!v(e,t)&&a(e),e}}}),Be=(Ge.KEY,Ge.NEED,Ge.fastKey,Ge.getWeak,Ge.onFreeze,G.f),Ve=function(e){var t=m.Symbol||(m.Symbol={});"_"==e.charAt(0)||e in t||Be(t,e,{value:Ue.f(e)})},qe={f:Object.getOwnPropertySymbols},He={f:{}.propertyIsEnumerable},ze=Array.isArray||function(e){return"Array"==te(e)},Ke=de.concat("length","prototype"),We={f:Object.getOwnPropertyNames||function(e){return ce(e,Ke)}},Ye=We.f,Je={}.toString,Xe="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Qe={f:function(e){return Xe&&"[object Window]"==Je.call(e)?function(e){try{return Ye(e)}catch(e){return Xe.slice()}}(e):Ye(re(e))}},Ze=Object.getOwnPropertyDescriptor,$e={f:D?Ze:function(e,t){if(e=re(e),t=F(t,!0),U)try{return Ze(e,t)}catch(e){}if(v(e,t))return B(!He.f.call(e,t),e[t])}},et=Ge.KEY,tt=$e.f,nt=G.f,rt=Qe.f,it=y.Symbol,ot=y.JSON,at=ot&&ot.stringify,st=be("_hidden"),ut=be("toPrimitive"),lt={}.propertyIsEnumerable,ct=_("symbol-registry"),dt=_("symbols"),ft=_("op-symbols"),pt=Object.prototype,ht="function"==typeof it&&!!qe.f,gt=y.QObject,vt=!gt||!gt.prototype||!gt.prototype.findChild,mt=D&&M(function(){return 7!=_e(nt({},"a",{get:function(){return nt(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=tt(pt,t);r&&delete pt[t],nt(e,t,n),r&&e!==pt&&nt(pt,t,r)}:nt,yt=function(e){var t=dt[e]=_e(it.prototype);return t._k=e,t},_t=ht&&"symbol"==typeof it.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof it},bt=function(e,t,n){return e===pt&&bt(ft,t,n),O(e),t=F(t,!0),O(n),v(dt,t)?(n.enumerable?(v(e,st)&&e[st][t]&&(e[st][t]=!1),n=_e(n,{enumerable:B(0,!1)})):(v(e,st)||nt(e,st,B(1,{})),e[st][t]=!0),mt(e,t,n)):nt(e,t,n)},St=function(e,t){O(e);for(var n,r=function(e){var t=fe(e),n=qe.f;if(n)for(var r,i=n(e),o=He.f,a=0;i.length>a;)o.call(e,r=i[a++])&&t.push(r);return t}(t=re(t)),i=0,o=r.length;o>i;)bt(e,n=r[i++],t[n]);return e},kt=function(e,t){if(e=re(e),t=F(t,!0),e!==pt||!v(dt,t)||v(ft,t)){var n=tt(e,t);return!n||!v(dt,t)||v(e,st)&&e[st][t]||(n.enumerable=!0),n}},wt=function(e){for(var t,n=rt(re(e)),r=[],i=0;n.length>i;)v(dt,t=n[i++])||t==st||t==et||r.push(t);return r},Et=function(e){for(var t,n=e===pt,r=rt(n?ft:re(e)),i=[],o=0;r.length>o;)!v(dt,t=r[o++])||n&&!v(pt,t)||i.push(dt[t]);return i};ht||(Z((it=function(){if(this instanceof it)throw TypeError("Symbol is not a constructor!");var e=k(arguments.length>0?arguments[0]:void 0),t=function(n){this===pt&&t.call(ft,n),v(this,st)&&v(this[st],e)&&(this[st][e]=!1),mt(this,e,B(1,n))};return D&&vt&&mt(pt,e,{configurable:!0,set:t}),yt(e)}).prototype,"toString",function(){return this._k}),$e.f=kt,G.f=bt,We.f=Qe.f=wt,He.f=function(e){var t=lt.call(this,e=F(e,!0));return!(this===pt&&v(dt,e)&&!v(ft,e))&&(!(t||!v(this,e)||!v(dt,e)||v(this,st)&&this[st][e])||t)},qe.f=Et,Ue.f=function(e){return yt(be(e))}),H(H.G+H.W+H.F*!ht,{Symbol:it});for(var Tt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),xt=0;Tt.length>xt;)be(Tt[xt++]);for(var Ct=fe(be.store),It=0;Ct.length>It;)Ve(Ct[It++]);H(H.S+H.F*!ht,"Symbol",{for:function(e){return v(ct,e+="")?ct[e]:ct[e]=it(e)},keyFor:function(e){if(!_t(e))throw TypeError(e+" is not a symbol!");for(var t in ct)if(ct[t]===e)return t},useSetter:function(){vt=!0},useSimple:function(){vt=!1}}),H(H.S+H.F*!ht,"Object",{create:function(e,t){return void 0===t?_e(e):St(_e(e),t)},defineProperty:bt,defineProperties:St,getOwnPropertyDescriptor:kt,getOwnPropertyNames:wt,getOwnPropertySymbols:Et});var Rt=M(function(){qe.f(1)});H(H.S+H.F*Rt,"Object",{getOwnPropertySymbols:function(e){return qe.f(h(e))}}),ot&&H(H.S+H.F*(!ht||M(function(){var e=it();return"[null]"!=at([e])||"{}"!=at({a:e})||"{}"!=at(Object(e))})),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(A(t)||void 0!==e)&&!_t(e))return ze(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!_t(t))return t}),r[1]=t,at.apply(ot,r)}}),it.prototype[ut]||V(it.prototype,ut,it.prototype.valueOf),we(it,"Symbol"),we(Math,"Math",!0),we(y.JSON,"JSON",!0),Ve("asyncIterator"),Ve("observable");var At=m.Symbol,Ot=t(function(e){e.exports={default:At,__esModule:!0}});e(Ot);var Mt=t(function(e,t){function n(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var r=n(je),i=n(Ot),o="function"==typeof i.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":typeof e};t.default="function"==typeof i.default&&"symbol"===o(r.default)?function(e){return void 0===e?"undefined":o(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":o(e)}}),Dt=e(Mt),Lt=e(t(function(e,t){t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(Mt);t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,n.default)(t))&&"function"!=typeof t?e:t}}));H(H.S+H.F*!D,"Object",{defineProperty:G.f});var Pt=m.Object,Nt=function(e,t,n){return Pt.defineProperty(e,t,n)},Ut=t(function(e){e.exports={default:Nt,__esModule:!0}});e(Ut);var Ft=e(t(function(e,t){t.__esModule=!0;var n=function(e){return e&&e.__esModule?e:{default:e}}(Ut);t.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,n.default)(e,i.key,i)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()})),jt=function(e,t){if(O(e),!A(t)&&null!==t)throw TypeError(t+": can't set as prototype!")},Gt={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,n){try{(n=R(Function.call,$e.f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return jt(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:jt};H(H.S,"Object",{setPrototypeOf:Gt.set});var Bt=m.Object.setPrototypeOf,Vt=t(function(e){e.exports={default:Bt,__esModule:!0}});e(Vt),H(H.S,"Object",{create:_e});var qt=m.Object,Ht=function(e,t){return qt.create(e,t)},zt=t(function(e){e.exports={default:Ht,__esModule:!0}});e(zt);var Kt,Wt,Yt,Jt=e(t(function(e,t){function n(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var r=n(Vt),i=n(zt),o=n(Mt);t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,o.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}})),Xt=be("toStringTag"),Qt="Arguments"==te(function(){return arguments}()),Zt=function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Xt))?n:Qt?te(t):"Object"==(r=te(t))&&"function"==typeof t.callee?"Arguments":r},$t=function(e,t,n,r){try{return r?t(O(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&O(i.call(e)),t}},en=be("iterator"),tn=Array.prototype,nn=be("iterator"),rn=m.getIteratorMethod=function(e){if(null!=e)return e[nn]||e["@@iterator"]||$[Zt(e)]},on=t(function(e){var t={},n={},r=e.exports=function(e,r,i,o,a){var s,u,l,c,d=a?function(){return e}:rn(e),f=R(i,o,r?2:1),p=0;if("function"!=typeof d)throw TypeError(e+" is not iterable!");if(function(e){return void 0!==e&&($.Array===e||tn[en]===e)}(d)){for(s=oe(e.length);s>p;p++)if((c=r?f(O(u=e[p])[0],u[1]):f(e[p]))===t||c===n)return c}else for(l=d.call(e);!(u=l.next()).done;)if((c=$t(l,f,u.value,r))===t||c===n)return c};r.BREAK=t,r.RETURN=n}),an=be("species"),sn=function(e,t){var n,r=O(e).constructor;return void 0===r||null==(n=O(r)[an])?t:I(n)},un=y.process,ln=y.setImmediate,cn=y.clearImmediate,dn=y.MessageChannel,fn=y.Dispatch,pn=0,hn={},gn=function(){var e=+this;if(hn.hasOwnProperty(e)){var t=hn[e];delete hn[e],t()}},vn=function(e){gn.call(e.data)};ln&&cn||(ln=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return hn[++pn]=function(){!function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}e.apply(n,t)}("function"==typeof e?e:Function(e),t)},Kt(pn),pn},cn=function(e){delete hn[e]},"process"==te(un)?Kt=function(e){un.nextTick(R(gn,e,1))}:fn&&fn.now?Kt=function(e){fn.now(R(gn,e,1))}:dn?(Yt=(Wt=new dn).port2,Wt.port1.onmessage=vn,Kt=R(Yt.postMessage,Yt,1)):y.addEventListener&&"function"==typeof postMessage&&!y.importScripts?(Kt=function(e){y.postMessage(e+"","*")},y.addEventListener("message",vn,!1)):Kt="onreadystatechange"in N("script")?function(e){ge.appendChild(N("script")).onreadystatechange=function(){ge.removeChild(this),gn.call(e)}}:function(e){setTimeout(R(gn,e,1),0)});var mn={set:ln,clear:cn},yn=mn.set,_n=y.MutationObserver||y.WebKitMutationObserver,bn=y.process,Sn=y.Promise,kn="process"==te(bn),wn={f:function(e){return new n(e)}},En=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}},Tn=y.navigator,xn=Tn&&Tn.userAgent||"",Cn=function(e,t){if(O(e),A(t)&&t.constructor===e)return t;var n=wn.f(e);return(0,n.resolve)(t),n.promise},In=be("species"),Rn=be("iterator"),An=!1;try{var On=[7][Rn]();On.return=function(){An=!0},Array.from(On,function(){throw 2})}catch(e){}var Mn,Dn,Ln,Pn,Nn=mn.set,Un=function(){var e,t,n,r=function(){var r,i;for(kn&&(r=bn.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(kn)n=function(){bn.nextTick(r)};else if(!_n||y.navigator&&y.navigator.standalone)if(Sn&&Sn.resolve){var i=Sn.resolve(void 0);n=function(){i.then(r)}}else n=function(){yn.call(y,r)};else{var o=!0,a=document.createTextNode("");new _n(r).observe(a,{characterData:!0}),n=function(){a.data=o=!o}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}(),Fn=y.TypeError,jn=y.process,Gn=jn&&jn.versions,Bn=Gn&&Gn.v8||"",Vn=y.Promise,qn="process"==Zt(jn),Hn=function(){},zn=Dn=wn.f,Kn=!!function(){try{var e=Vn.resolve(1),t=(e.constructor={})[be("species")]=function(e){e(Hn,Hn)};return(qn||"function"==typeof PromiseRejectionEvent)&&e.then(Hn)instanceof t&&0!==Bn.indexOf("6.6")&&-1===xn.indexOf("Chrome/66")}catch(e){}}(),Wn=function(e){var t;return!(!A(e)||"function"!=typeof(t=e.then))&&t},Yn=function(e,t){if(!e._n){e._n=!0;var n=e._c;Un(function(){for(var r=e._v,i=1==e._s,o=0;n.length>o;)!function(t){var n,o,a,s=i?t.ok:t.fail,u=t.resolve,l=t.reject,c=t.domain;try{s?(i||(2==e._h&&Qn(e),e._h=1),!0===s?n=r:(c&&c.enter(),n=s(r),c&&(c.exit(),a=!0)),n===t.promise?l(Fn("Promise-chain cycle")):(o=Wn(n))?o.call(n,u,l):u(n)):l(r)}catch(e){c&&!a&&c.exit(),l(e)}}(n[o++]);e._c=[],e._n=!1,t&&!e._h&&Jn(e)})}},Jn=function(e){Nn.call(y,function(){var t,n,r,i=e._v,o=Xn(e);if(o&&(t=En(function(){qn?jn.emit("unhandledRejection",i,e):(n=y.onunhandledrejection)?n({promise:e,reason:i}):(r=y.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=qn||Xn(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},Xn=function(e){return 1!==e._h&&0===(e._a||e._c).length},Qn=function(e){Nn.call(y,function(){var t;qn?jn.emit("rejectionHandled",e):(t=y.onrejectionhandled)&&t({promise:e,reason:e._v})})},Zn=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),Yn(t,!0))},$n=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw Fn("Promise can't be resolved itself");(t=Wn(e))?Un(function(){var r={_w:n,_d:!1};try{t.call(e,R($n,r,1),R(Zn,r,1))}catch(e){Zn.call(r,e)}}):(n._v=e,n._s=1,Yn(n,!1))}catch(e){Zn.call({_w:n,_d:!1},e)}}};Kn||(Vn=function(e){(function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!")})(this,Vn,"Promise","_h"),I(e),Mn.call(this);try{e(R($n,this,1),R(Zn,this,1))}catch(e){Zn.call(this,e)}},(Mn=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(e,t,n){for(var r in t)V(e,r,t[r]);return e}(Vn.prototype,{then:function(e,t){var n=zn(sn(this,Vn));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=qn?jn.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&Yn(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),Ln=function(){var e=new Mn;this.promise=e,this.resolve=R($n,e,1),this.reject=R(Zn,e,1)},wn.f=zn=function(e){return e===Vn||e===Pn?new Ln(e):Dn(e)}),H(H.G+H.W+H.F*!Kn,{Promise:Vn}),we(Vn,"Promise"),function(e){var t="function"==typeof m[e]?m[e]:y[e];D&&t&&!t[In]&&G.f(t,In,{configurable:!0,get:function(){return this}})}("Promise"),Pn=m.Promise,H(H.S+H.F*!Kn,"Promise",{reject:function(e){var t=zn(this);return(0,t.reject)(e),t.promise}}),H(H.S+!0*H.F,"Promise",{resolve:function(e){return Cn(this===Pn?Vn:this,e)}}),H(H.S+H.F*!(Kn&&function(e,t){if(!An)return!1;var n=!1;try{var r=[7],i=r[Rn]();i.next=function(){return{done:n=!0}},r[Rn]=function(){return i},function(e){Vn.all(e).catch(Hn)}(r)}catch(e){}return n}()),"Promise",{all:function(e){var t=this,n=zn(t),r=n.resolve,i=n.reject,o=En(function(){var n=[],o=0,a=1;on(e,!1,function(e){var s=o++,u=!1;n.push(void 0),a++,t.resolve(e).then(function(e){u||(u=!0,n[s]=e,--a||r(n))},i)}),--a||r(n)});return o.e&&i(o.v),n.promise},race:function(e){var t=this,n=zn(t),r=n.reject,i=En(function(){on(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}}),H(H.P+H.R,"Promise",{finally:function(e){var t=sn(this,m.Promise||y.Promise),n="function"==typeof e;return this.then(n?function(n){return Cn(t,e()).then(function(){return n})}:e,n?function(n){return Cn(t,e()).then(function(){throw n})}:e)}}),H(H.S,"Promise",{try:function(e){var t=wn.f(this),n=En(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}});var er=m.Promise,tr=e(t(function(e){e.exports={default:er,__esModule:!0}}));z("keys",function(){return function(e){return fe(h(e))}});var nr=m.Object.keys,rr=e(t(function(e){e.exports={default:nr,__esModule:!0}})),ir=t(function(e){function t(){}function n(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function r(e,t,r,i,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new n(r,i||e,o),u=s?s+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],a]:e._events[u].push(a):(e._events[u]=a,e._eventsCount++),e}function i(e,n){0==--e._eventsCount?e._events=new t:delete e._events[n]}function o(){this._events=new t,this._eventsCount=0}var a=Object.prototype.hasOwnProperty,s="~";Object.create&&(t.prototype=Object.create(null),(new t).__proto__||(s=!1)),o.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)a.call(e,t)&&n.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},o.prototype.listeners=function(e){var t=s?s+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,o=new Array(i);r<i;r++)o[r]=n[r].fn;return o},o.prototype.listenerCount=function(e){var t=s?s+e:e,n=this._events[t];return n?n.fn?1:n.length:0},o.prototype.emit=function(e,t,n,r,i,o){var a=s?s+e:e;if(!this._events[a])return!1;var u,l,c=this._events[a],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,o),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;case 4:c[l].fn.call(c[l].context,t,n,r);break;default:if(!u)for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},o.prototype.on=function(e,t,n){return r(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return r(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,n,r){var o=s?s+e:e;if(!this._events[o])return this;if(!t)return i(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||i(this,o);else{for(var u=0,l=[],c=a.length;u<c;u++)(a[u].fn!==t||r&&!a[u].once||n&&a[u].context!==n)&&l.push(a[u]);l.length?this._events[o]=1===l.length?l[0]:l:i(this,o)}return this},o.prototype.removeAllListeners=function(e){var n;return e?(n=s?s+e:e,this._events[n]&&i(this,n)):(this._events=new t,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=s,o.EventEmitter=o,e.exports=o}),or=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.url,r=t.method,i=void 0===r?"GET":r,o=t.type,a=void 0===o?"arraybuffer":o,s=t.timeout,u=void 0===s?1e4:s,l=t.data,c=void 0===l?{}:l,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Y(this,e),new tr(function(e,t){var r=new window.XMLHttpRequest,o=i.toUpperCase(),s=[];for(var l in a&&(r.responseType=a),u&&(r.timeout=u),c)s.push("k="+c[l]);if(r.onload=function(){200===r.status||206===r.status?e({context:d,res:r}):t(new Error({context:d,res:r,type:"error"}))},r.onerror=function(e){t(new Error({context:d,res:r,type:"error"}))},r.ontimeout=function(e){t(new Error({context:d,res:r,type:"error"}))},r.onabort=function(){t(new Error({context:d,res:r,type:"error"}))},"GET"===o)r.open(o,""+n),r.send();else{if("post"!==o)throw new Error("xhr "+o+" is not supported");r.open(o,n),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(s.join("&"))}})},ar=/^WEBVTT/,sr=/^STYLE+$/,ur=/^\:\:cue/,lr=/^}+$/,cr=/^\[Script Info\].*/,dr=[/[0-9]{1,3}:[0-9]{2}:[0-9]{2}\.[0-9]{1,3}-->[0-9]{1,3}:[0-9]{2}:[0-9]{2}\.[0-9]{1,3}/,/[0-9]{1,2}:[0-9]{2}\.[0-9]{1,3}-->[0-9]{1,2}:[0-9]{2}\.[0-9]{1,3}/,/[0-9]{1,2}\.[0-9]{1,3}-->[0-9]{1,2}\.[0-9]{1,3}/],fr=/^Format:\s/,pr=/^Style:\s/,hr=/^Dialogue:\s/,gr=function(){function e(){Y(this,e)}return Ft(e,null,[{key:"parseJson",value:function(e){for(var t=[],n=0,r=0;r<e.length;r++){if(n>=50&&(n=0),0===n){var i={start:e[r].start,list:[e[r]],end:e[r].end};t.push(i)}else t[t.length-1].list.push(e[r]),t[t.length-1].end=e[r].end;n++}return t}},{key:"parse",value:function(t,n){var r=e.checkFormat(t);r||n({format:r});try{var i=[];"ass"===r?i=e.parseASS(t):"vtt"===r&&(i=e.parseVTT(t)),n({format:r,list:i.list,styles:i.styles})}catch(e){console.error(e),n({format:r},e)}}},{key:"parseASSItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.split(","),i={},a="";try{var s=n.length-t.length;return a=o(a=(a=s>0?n.splice(t.length-1,s+1).join(",")+"":n[n.length-1]+"").replace(/\\n+/g,"")),n[t.length-1]=a,t.map(function(e,t){"end"===e||"start"===e?i[e]=r(n[t].split(":")):"text"===e?i[e]=[n[t]]:"layer"===e?(i[e]=[n[t]],i.textTag=[n[t]]):i[e]="style"===e?[n[t]]:Number(n[t])?Number(n[t]):n[t]}),i}catch(e){return console.error(e),{}}}},{key:"parseASS",value:function(t){for(var n=t.split("\n"),r=[],i=0,o=0,a=[],s=[],u=null;i<n.length;){if(fr.test(n[i]))s=(s=n[i].replace(fr,"").replace(/\s+/g,"").split(",")).map(function(e){return e.toLocaleLowerCase()});else if(pr.test(n[i]))a.push(n[i].replace(pr,"").replace(/\s+/g,""));else if(hr.test(n[i])){var l=e.parseASSItem(n[i].replace(hr,""),s);if(u&&l.start===u.start&&l.end===u.end)try{var c=u,d=c.text,f=c.textTag,p=c.style;d.push(l.text[0]),f.push(l.textTag[0]),p.push(l.style[0])}catch(e){console.error(e)}else{u=l;var h=null;o%50==0?((h={start:u.start,end:u.end,list:[]}).list.push(u),r.push(h)):((h=r[r.length-1]).end=u.end,h.list.push(u)),o++}}i++}return{list:r,style:{}}}},{key:"parseVTTStyle",value:function(e,t){var n=e.split(":");if(n.length>1){var r=n[0].trim().split("-"),i="";r.length>1?r.map(function(e,t){i+=0===t?e:e.charAt(0).toUpperCase()+e.slice(1)}):i=r[0],t[i]=n[1].trim().replace(/;$/,"")}return t}},{key:"parseVTT",value:function(e){for(var t=(e=e.replace(ar,"")).split("\n"),n=[],r=0,o=0,s=null,u=!1,l=!1,c=null,d=null,f=[];r<t.length;){var p=a(r,t).trim();if(!p||u&&i(p))u=!p;else if(ur.test(p)&&sr.test(a(r-1,t).trim())){l=!0;var h=/\((.+?)\)/g.exec(p);d=h?h[1]:"",c=""}else if(l)lr.test(p)?(f.push({key:d,style:c}),c=null,d=null,l=!1):c+=p;else if(p){u=!1;var g=this.checkIsTime(t[r]);if(g){var v=this.parseVttTime(g);if(!s||v.start!==s.start||v.end!==s.end){(s=v).text=[],s.textTag=[];var m=null;o%50==0?((m={start:s.start,end:s.end,list:[]}).list.push(s),n.push(m)):((m=n[n.length-1]).end=s.end,m.list.push(s)),o++}}else if(s){var y=s,_=y.text,b=y.textTag,S=this.parseVttText(t[r]);_.push(S.text),b.push(S.tag)}u=!1}r++}return{list:n,styles:f}}},{key:"checkIsTime",value:function(e){e=e.replace(/\s+/g,"");for(var t=0,n=null;t<dr.length&&!(n=dr[t].exec(e));)t++;return n?n[0]:null}},{key:"parseVttText",value:function(e){var t=/^(<?.+?>)/g.exec(e),n="",r="default";if(t){r=t[0].replace(/\<|\>|\&/g,"");var i=RegExp("^<"+r+">(([\\s\\S])*?)</"+r+">$").exec(e);i?n=i[1]:(n=e,r="")}else n=e;for(var a=/<(\w+).(\w+)>/g,s=a.exec(n);s&&s.length>2;)n=n.replace(s[0],"<"+s[1]+' class="'+s[2]+'">'),s=a.exec(n);return{tag:r,text:o(n.replace(/\\n+/g,"<br/>"))}}},{key:"parseVttTime",value:function(e){var t=e.split("--\x3e"),n=void 0,i=0;if(2===t.length){var o=t[0].split(":"),a=t[1].split(":");n=r(o),i=r(a)}return{start:n,end:i,time:e}}},{key:"isVTT",value:function(e){return ar.test(e)}},{key:"isASS",value:function(e){return cr.test(e)}},{key:"checkFormat",value:function(e){return e?ar.test(e)?"vtt":cr.test(e)?"ass":null:null}}]),e}(),vr=function(){function e(){var t=this;Y(this,e),this.__handlers=[],window.ResizeObserver&&(this.observer=new window.ResizeObserver(function(e){t.__trigger(e)}))}return Ft(e,[{key:"addObserver",value:function(e,t){if(this.observer){this.observer&&this.observer.observe(e);for(var n=this.__handlers,r=-1,i=0;i<n.length;i++)n[i]&&e===n[i].target&&(r=i);r>-1?this.__handlers[r].handler.push(t):this.__handlers.push({target:e,handler:[t]})}}},{key:"unObserver",value:function(e){var t=-1;this.__handlers.map(function(n,r){e===n.target&&(t=r)}),this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e,t){for(var n=this.__handlers,r=0;r<n.length;r++)if(n[r]&&e===n[r].target){n[r].handler&&n[r].handler.map(function(n){try{n(e,t)}catch(e){console.error(e)}});break}}},{key:"__trigger",value:function(e){var t=this;e.map(function(e){var n=e.contentRect;t.__runHandler(e.target,n)})}}]),e}(),mr=null;!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}('xg-text-track.xg-text-track {\n  font-family: "PingFang SC","SF Pro SC","SF Pro Text","SF Pro Icons","Helvetica Neue","Helvetica","Arial",sans-serif;\n  -webkit-font-smoothing: antialiased;\n  position: absolute;\n  bottom: 0;\n  color: #fff;\n  left: 0;\n  right: 0;\n  pointer-events: none;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center; }\n  xg-text-track.xg-text-track.text-track-no-fitvideo {\n    margin-bottom: 2%; }\n  xg-text-track.xg-text-track.text-track-hide {\n    opacity: 0;\n    visibility: hidden; }\n  xg-text-track.xg-text-track.text-track-show {\n    opacity: 1;\n    visibility: visible; }\n  xg-text-track.xg-text-track xg-text-track-inner {\n    display: block;\n    max-width: 92%; }\n  xg-text-track.xg-text-track xg-text-track-span {\n    display: -webkit-box;\n    text-align: center;\n    text-overflow: ellipsis;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    padding: 1px 4px;\n    -webkit-line-clamp: 1;\n    line-height: 120%;\n    word-break: break-word; }\n    xg-text-track.xg-text-track xg-text-track-span.text-track-deputy {\n      font-size: 75%; }\n    xg-text-track.xg-text-track xg-text-track-span.text-track-single {\n      -webkit-line-clamp: 1; }\n    xg-text-track.xg-text-track xg-text-track-span.text-track-double {\n      -webkit-line-clamp: 2; }\n    xg-text-track.xg-text-track xg-text-track-span.text-track-three {\n      -webkit-line-clamp: 3; }\n  xg-text-track.xg-text-track.text-track-bg xg-text-track-inner {\n    background-color: rgba(0, 0, 0, .54);\n    border-radius: 2px; }\n  xg-text-track.xg-text-track.text-track-stroke xg-text-track-inner {\n    background-color: none;\n    border-radius: 0;\n    text-shadow: -1px 1px 0 rgba(0, 0, 0, .7), 1px 1px 0 rgba(0, 0, 0, .7), 1px -1px 0 rgba(0, 0, 0, .7), -1px -1px 0 rgba(0, 0, 0, .7); }\n');var yr=[{code:0,msg:"SUCCESS"},{code:1,msg:"LOAD_ERROR"},{code:2,msg:"PARSER_ERROR"},{code:3,msg:"FORMAT_NOT_SUPPORTED"},{code:4,msg:"ID_OR_LANGUAGE_NOT_EXIST"},{code:5,msg:"PARAMETERS_ERROR"},{code:6,msg:"ABORT"},{code:7,msg:"UNKNOWN"},{code:8,msg:"DATA_ERROR:subtitle.url is null"}],_r={RESIZE:"resize"},br=!1;return function(e){function t(e){Y(this,t);var n=Lt(this,(t.__proto__||W(t)).call(this));return br=function(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),n=/(?:SymbianOS)/.test(e)||t,r=/(?:Android)/.test(e),i=/(?:Firefox)/.test(e),o=/(?:iPad|PlayBook)/.test(e)||r&&!/(?:Mobile)/.test(e)||i&&/(?:Tablet)/.test(e);return/(?:iPhone)/.test(e)&&!o||r||n||o}(),n.currentText=null,n.textTrack=[],n._cid=-1,n._gid=-1,n._cids=[],n._iId=null,n._iC=0,n.player=null,n.root=null,n.config={line:"double",bottom:0,mode:"stroke",defaultOpen:!1,baseSizeX:49,baseSizeY:28,minSize:16,minMobileSize:13,fitVideo:!0,offsetBottom:2,fontColor:"#fff"},n._ctime=0,n._loadingTrack={},rr(n.config).map(function(t){void 0!==e[t]&&null!==e[t]&&(n.config[t]=e[t])}),n._isOpen=!1,n._videoMeta={scale:0,videoHeight:0,videoWidth:0,lwidth:0,lheight:0,vWidth:0,vHeight:0,vBottom:0,vLeft:0,marginBottom:0},e.subTitles&&"Array"===function(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}(e.subTitles)?(e.player&&n.attachPlayer(e.player),n.setSubTitles(e.subTitles,n.config.defaultOpen),n):Lt(n)}return Jt(t,e),Ft(t,[{key:"version",get:function(){return"1.0.12"}}]),Ft(t,[{key:"setSubTitles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this._isOpen||n;r&&this.innerRoot&&this.switchOff(),this.currentText=null,this.textTrack=[],e.map(function(e){var n={};rr(e).map(function(t){n[t]=e[t]}),n.isDefault&&(t.currentText=n),t.textTrack.push(n)}),this.currentText&&d(this.currentText).then(function(e){t.addStyles(e),i&&t.switch()})}},{key:"addStyles",value:function(e){var t=e.styles,n=e.format;t&&"vtt"===n&&(t.map(function(e){e.key||(e.key="xg-text-track-span")}),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="";e.map(function(e){n+=" "+t+" "+e.key+" {"+e.style+"}"});var r=document.createElement("style"),i=document.head||document.getElementsByTagName("head")[0];if(r.type="text/css",r.id="ssss",r.styleSheet){var o=function(){try{r.styleSheet.cssText=n}catch(e){}};r.styleSheet.disabled?setTimeout(o,10):o()}else{var a=document.createTextNode(n);r.appendChild(a)}i.appendChild(r)}(t,"xg-text-track"))}},{key:"attachPlayer",value:function(e){var t=this;if(e){this.player&&this.detachPlayer();var n=this.config,r=n.fontColor,i=n.mode,o=n.fitVideo;this.player=e,this.root=document.createElement("xg-text-track"),this.root.className="xg-text-track",!this._isOpen&&u(this.root,"text-track-hide"),!o&&u(this.root,"text-track-no-fitvideo"),i&&u(this.root,"text-track-"+i),this.innerRoot=document.createElement("xg-text-track-inner"),this.root.appendChild(this.innerRoot),r&&(this.root.style.color=r),this.currentText&&["language","id","label"].map(function(e){t.root.setAttribute("data-"+e,t.currentText[e]||"")}),this.player.root.appendChild(this.root),["destroy","__onTimeupdate","_onResize"].map(function(e){t[e]=t[e].bind(t)}),this.player.on("destroy",this.destroy),this.player.on("timeupdate",this.__onTimeupdate),this._isOpen&&this.switch(),function(e,t){mr||(mr=new vr),mr.addObserver(e,t)}(e.root,this._onResize)}}},{key:"detachPlayer",value:function(){var e=this.player;e&&(e.off("destroy",this.destroy),e.off("timeupdate",this.__onTimeupdate),e.root&&(function(e,t){mr&&mr.unObserver(e,t)}(e.root,this._onResize),e.root.removeChild(this.root)),this.innerRoot=null,this.root=null,this.player=null)}},{key:"switch",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:"",language:""};return this._loadingTrack=t,new tr(function(n,r){if(t.id||t.language)if(e.currentText&&f(t,e.currentText))e._loadingTrack={},e._updateCurrent(e.currentText),e._isOpen=!0,e.show(),n(l(0));else{for(var i=null,o=0;o<e.textTrack.length;o++)if(f(t,e.textTrack[o])){i=e.textTrack[o];break}if(i)i.list?(e._loadingTrack={},e._updateCurrent(i),e._isOpen=!0,e.show(),n(l(0))):d(i).then(function(t){if(e.addStyles(t),e._loadingTrack.id===i.id||e._loadingTrack.language===t.language)e._loadingTrack={},e._updateCurrent(t),e._isOpen=!0,e.show(),n(l(0));else{var o=l(6,{message:"check _loadingTrack fail id: "+e._loadingTrack.id+"  nextSubtitle:"+t.id});console.trace(o),r(o)}}).catch(function(e){r(e)});else{var a=l(4,new Error("The is no subtitle with id:[{"+t.id+"}] or language:["+t.language+"]"));console.trace(a),r(a)}}else{if(e.currentText){e._loadingTrack={},e._updateCurrent(e.currentText),e._isOpen=!0,e.show();var s=l(0,{message:"switch default subtitle success"});return void n(s)}var u=l(5,{message:"no default subtitle"});r(u)}})}},{key:"switchOff",value:function(){this._isOpen=!1,this.hide()}},{key:"_updateCurrent",value:function(e){var t=this;if(this.root){this.currentText=e,["language","id","label"].map(function(e){t.root.setAttribute("data-"+e,t.currentText[e]||"")}),this.__remove(this._cids);var n=this.player.currentTime;this._cids=[],this._gid=-1,this._cid=-1,this._update(n)}}},{key:"__loadAll",value:function(){this.textTrack.map(function(e){d(e)})}},{key:"getDelCid",value:function(e,t){for(var n=[],r=0;r<e.length;r++)t.includes(e[r])||n.push(e[r]);return n}},{key:"getNewCid",value:function(e,t){for(var n=[],r=0;r<t.length;r++)e.includes(t[r])||n.push(t[r]);return n}},{key:"_update",value:function(e){var t=this,n=function(e,t,n){var r=t.length;if(r<1)return-1;if(t[n=n<0?0:n>=r?r-1:n].start<=e&&e<t[n].end)return n;for(var i=t[n].end<=e?n+1:0;i<r;i++){if(t[i].start<=e&&e<t[i].end)return i;if(e>t[i].end&&i+1<r&&e<t[i+1].start)return-1;if(e>t[i].end&&i+1>=r)return-1}return-1}(e,this.currentText.list,this._gid),r=[];if(n>-1&&(r=function(e,t,n){var r=t.length;if(r<1)return[];var i=[];if((n=n<0?0:n>=r?r-1:n)<r)for(var o=t[n].end<=e?n:0;o<r&&(t[o].start<=e&&e<t[o].end&&i.push(o),!(e<t[o].start));o++);return i}(e,this.currentText.list[n].list,this._cid)),r.length<1)return this._cids.length>0&&this.__remove(this._cids),void(this._cids=[]);if(this._cids!==r||n!==this._gid){this._gid=n,this._cid=r[0];var i=this.getDelCid(this._cids,r),o=this.getNewCid(this._cids,r);this._cids=r,this.__remove(i);var a=[];o.map(function(e){var r=t.currentText.list[n].list[e];r.index=e,a.push(r)}),this.__render(a,e)}}},{key:"__onTimeupdate",value:function(){if(this._isOpen){var e=this.player.video,t=e.videoWidth,n=e.videoHeight;!this._videoMeta.scale&&t&&n&&this._onResize(this.player.root);var r=this.player.currentTime;Math.round(Math.abs(1e3*r-this._ctime))<200||(this._ctime=1e3*r,this.currentText&&this.currentText.list&&this._update(r))}}},{key:"_onResize",value:function(e){var t=this._videoMeta;if(e&&e instanceof window.Element||(e=this.player.root),this._iId&&(clearTimeout(this._iId),this._iId=null),!t.scale){if(!this.player.video)return;var n=this.player.video,r=n.videoWidth,i=n.videoHeight;if(!r||!i)return;t.videoWidth=r,t.videoHeight=i,t.scale=parseInt(i/r*100,10)}this.__startResize(e)}},{key:"resize",value:function(e,t){var n=this,r=this.config,i=r.baseSizeX,o=r.baseSizeY,a=r.minMobileSize,s=r.minSize,u=r.fitVideo,l=r.offsetBottom,c=this._videoMeta.scale;this._videoMeta.lwidth=e,this._videoMeta.lheight=t;var d=void 0,f=0;t/e*100>=c?(f=parseInt(c*e,10)/100,d=e):(f=t,d=parseInt(t/c*100,10)),this._videoMeta.vWidth=d,this._videoMeta.vHeight=f;var p=0,h=0;c>120?(p=o,h=parseInt(p*f/1080,10)):(p=i,h=parseInt(p*d/1920,10));var g=br?a:s,v={fontSize:h=h<g?g:h>p?p:h},m=parseInt((t-f)/2,10),y=parseInt((e-d)/2,10),_=parseInt(f*l,10)/100;this._videoMeta.vBottom=m,this._videoMeta.vLeft=y,this._videoMeta.marginBottom=_,u&&(v.bottom=m+_,v.left=v.right=y),rr(v).map(function(e){n.root.style[e]=v[e]+"px"}),this.emit(_r.RESIZE,{vLeft:y,vBottom:m,marginBottom:_,vWidth:d,vHeight:f,fontSize:h,scale:c})}},{key:"__startResize",value:function(e){var t=this,n=e.getBoundingClientRect(),r=this._videoMeta,i=n.width,o=n.height;if(this._iId&&(clearTimeout(this._iId),this._iId=null),i>0&&o>0&&(i!==r.lwidth||o!==r.lheight))this._iC=0,this.resize(i,o);else{if(this._iC>=5)return void(this._iC=0);this._iC++,this._iId=setTimeout(function(){t.__startResize(e)},50)}}},{key:"__remove",value:function(e){var t=this;if(e&&!(e.length<1)){for(var n=this.innerRoot.children,r=[],i=0;i<n.length;i++){var o=Number(n[i].getAttribute("data-index"));e.includes(o)&&r.push(n[i])}r.map(function(e){t.innerRoot.removeChild(e)})}}},{key:"__render",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length>0&&t.map(function(t){var n="text-track-"+e.config.line;t.text.map(function(r,i){i>0&&(n+=" text-track-deputy");var o={"data-start":t.start,"data-end":t.end,"data-index":t.index};e.innerRoot.appendChild(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=r,i.innerHTML=t,rr(n).forEach(function(t){var r=t,o=n[t];"video"===e||"audio"===e||"live-video"===e?o&&i.setAttribute(r,o):i.setAttribute(r,o)}),i}("xg-text-track-span",r,o,n))})})}},{key:"show",value:function(){var e,t;e=this.root,t="text-track-hide",e&&(e.classList?t.split(/\s+/g).forEach(function(t){e.classList.remove(t)}):s(e,t)&&t.split(/\s+/g).forEach(function(t){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className&&"object"===Dt(e.className)?e.setAttribute("class",e.getAttribute("class").replace(n," ")):e.className=e.className.replace(n," ")}))}},{key:"hide",value:function(){u(this.root,"text-track-hide"),this.innerRoot.innerHTML=""}},{key:"destroy",value:function(){this.detachPlayer(),this.removeAllListeners(),this.player=null,this.textTrack=null}},{key:"marginBottom",get:function(){var e=this._videoMeta,t=e.bottom,n=e.marginBottom;return this.config.fitVideo?t+n:n}}]),t}(ir)}()},function(e,t,n){"use strict";var r=D(n(9)),i=D(n(10)),o=D(n(108)),a=D(n(48)),s=D(n(40)),u=D(n(53)),l=D(n(56)),c=D(n(59)),d=D(n(111)),f=D(n(116)),p=D(n(122)),h=D(n(64)),g=D(n(68)),v=D(n(71)),m=D(n(74)),y=D(n(125)),_=D(n(128)),b=D(n(129)),S=D(n(133)),k=D(n(139)),w=D(n(142)),E=D(n(145)),T=D(n(149)),x=D(n(153)),C=D(n(157)),I=D(n(160)),R=D(n(162)),A=D(n(163)),O=D(n(166)),M=D(n(169));function D(e){return e&&e.__esModule?e:{default:e}}r.default.installAll([i.default,o.default,a.default,s.default,u.default,l.default,c.default,d.default,f.default,p.default,h.default,g.default,v.default,m.default,y.default,_.default,b.default,S.default,k.default,w.default,E.default,T.default,x.default,C.default,I.default,R.default,A.default,O.default,M.default])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(109);t.default={name:"s_enter",method:function(){for(var e=this.root,t="",n=1;n<=12;n++)t+='<div class="xgplayer-enter-bar'+n+'"></div>';var i=(0,r.createDom)("xg-enter",'<div class="xgplayer-enter-spinner">\n                                                  '+t+"\n                                                </div>",{},"xgplayer-enter");e.appendChild(i)}},e.exports=t.default},function(e,t,n){var r=n(110);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-enter{display:none;position:absolute;left:0;top:0;width:100%;height:100%;background:#000;z-index:120}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner{display:block;position:absolute;left:50%;top:50%;height:100px;width:100px;position:relative;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner div{width:12%;height:26%;background-color:hsla(0,0%,100%,.7);position:absolute;left:44%;top:37%;opacity:0;border-radius:30px;-webkit-animation:fade 1s linear infinite;animation:fade 1s linear infinite}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner div.xgplayer-enter-bar1{-webkit-transform:rotate(0deg) translateY(-142%);-ms-transform:rotate(0deg) translateY(-142%);transform:rotate(0deg) translateY(-142%);-webkit-animation-delay:0s;animation-delay:0s}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner div.xgplayer-enter-bar2{-webkit-transform:rotate(30deg) translateY(-142%);-ms-transform:rotate(30deg) translateY(-142%);transform:rotate(30deg) translateY(-142%);-webkit-animation-delay:-.9163s;animation-delay:-.9163s}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner div.xgplayer-enter-bar3{-webkit-transform:rotate(60deg) translateY(-142%);-ms-transform:rotate(60deg) translateY(-142%);transform:rotate(60deg) translateY(-142%);-webkit-animation-delay:-.833s;animation-delay:-.833s}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner div.xgplayer-enter-bar4{-webkit-transform:rotate(90deg) translateY(-142%);-ms-transform:rotate(90deg) translateY(-142%);transform:rotate(90deg) translateY(-142%);-webkit-animation-delay:-.7497s;animation-delay:-.7497s}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner div.xgplayer-enter-bar5{-webkit-transform:rotate(120deg) translateY(-142%);-ms-transform:rotate(120deg) translateY(-142%);transform:rotate(120deg) translateY(-142%);-webkit-animation-delay:-.6664s;animation-delay:-.6664s}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner div.xgplayer-enter-bar6{-webkit-transform:rotate(150deg) translateY(-142%);-ms-transform:rotate(150deg) translateY(-142%);transform:rotate(150deg) translateY(-142%);-webkit-animation-delay:-.5831s;animation-delay:-.5831s}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner div.xgplayer-enter-bar7{-webkit-transform:rotate(180deg) translateY(-142%);-ms-transform:rotate(180deg) translateY(-142%);transform:rotate(180deg) translateY(-142%);-webkit-animation-delay:-.4998s;animation-delay:-.4998s}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner div.xgplayer-enter-bar8{-webkit-transform:rotate(210deg) translateY(-142%);-ms-transform:rotate(210deg) translateY(-142%);transform:rotate(210deg) translateY(-142%);-webkit-animation-delay:-.4165s;animation-delay:-.4165s}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner div.xgplayer-enter-bar9{-webkit-transform:rotate(240deg) translateY(-142%);-ms-transform:rotate(240deg) translateY(-142%);transform:rotate(240deg) translateY(-142%);-webkit-animation-delay:-.3332s;animation-delay:-.3332s}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner div.xgplayer-enter-bar10{-webkit-transform:rotate(270deg) translateY(-142%);-ms-transform:rotate(270deg) translateY(-142%);transform:rotate(270deg) translateY(-142%);-webkit-animation-delay:-.2499s;animation-delay:-.2499s}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner div.xgplayer-enter-bar11{-webkit-transform:rotate(300deg) translateY(-142%);-ms-transform:rotate(300deg) translateY(-142%);transform:rotate(300deg) translateY(-142%);-webkit-animation-delay:-.1666s;animation-delay:-.1666s}.xgplayer-skin-default .xgplayer-enter .xgplayer-enter-spinner div.xgplayer-enter-bar12{-webkit-transform:rotate(330deg) translateY(-142%);-ms-transform:rotate(330deg) translateY(-142%);transform:rotate(330deg) translateY(-142%);-webkit-animation-delay:-.0833s;animation-delay:-.0833s}@-webkit-keyframes fade{0%{opacity:1}to{opacity:.25}}@keyframes fade{0%{opacity:1}to{opacity:.25}}.xgplayer-skin-default.xgplayer-is-enter .xgplayer-enter{display:block}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=a(n(112)),o=a(n(113));function a(e){return e&&e.__esModule?e:{default:e}}n(114);t.default={name:"s_cssFullscreen",method:function(){var e=this;if(e.config.cssFullscreen){var t=(0,r.createDom)("xg-cssfullscreen",'<xg-icon class="xgplayer-icon">\n                                             <div class="xgplayer-icon-requestfull">'+i.default+'</div>\n                                             <div class="xgplayer-icon-exitfull">'+o.default+"</div>\n                                           </xg-icon>",{},"xgplayer-cssfullscreen"),n={};n.requestfull=e.lang.CSSFULLSCREEN_TIPS,n.exitfull=e.lang.EXITCSSFULLSCREEN_TIPS;var a=(0,r.createDom)("xg-tips",'<span class="xgplayer-tip-requestfull">'+n.requestfull+'</span>\n                                        <span class="xgplayer-tip-exitfull">'+n.exitfull+"</span>",{},"xgplayer-tips");t.appendChild(a),e.once("ready",function(){e.controls.appendChild(t)}),["click","touchend"].forEach(function(n){t.addEventListener(n,function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("cssFullscreenBtnClick")})})}}},e.exports=t.default},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">\n  <path transform="scale(0.028 0.028)" d="M843.617212 67.898413 175.411567 67.898413c-61.502749 0-111.367437 49.856501-111.367437 111.367437l0 668.205645c0 61.510936 49.864688 111.367437 111.367437 111.367437L843.617212 958.838931c61.510936 0 111.367437-49.856501 111.367437-111.367437L954.984648 179.26585C954.984648 117.754914 905.12917 67.898413 843.617212 67.898413zM398.146441 736.104057c15.380292 0 27.842115 12.461823 27.842115 27.842115 0 15.379269-12.461823 27.841092-27.842115 27.841092L259.725858 791.787264c-7.785314 0-14.781658-3.217275-19.838837-8.365528-5.383614-4.577249-8.791224-11.228739-8.791224-19.475564L231.095797 624.736621c0-15.371082 12.471033-27.842115 27.842115-27.842115 15.380292 0 27.842115 12.471033 27.842115 27.842115l-0.61603 71.426773 133.036969-133.037992 39.378869 39.378869L324.962651 736.113267 398.146441 736.104057zM419.199942 463.611943 286.162974 330.565764l0.61603 71.435982c0 15.380292-12.461823 27.842115-27.842115 27.842115-15.371082 0-27.842115-12.461823-27.842115-27.842115L231.094774 262.791172c0-8.256034 3.40761-14.908548 8.791224-19.476587 5.057179-5.148253 12.053524-8.374738 19.838837-8.374738l138.420583 0.00921c15.380292 0 27.842115 12.461823 27.842115 27.842115s-12.461823 27.842115-27.842115 27.842115l-73.175603-0.00921 133.607974 133.607974L419.199942 463.611943zM787.932981 763.946172c0 8.247848-3.40761 14.899338-8.791224 19.475564-5.057179 5.148253-12.053524 8.365528-19.839861 8.365528L620.881314 791.787264c-15.379269 0-27.841092-12.461823-27.841092-27.841092 0-15.380292 12.461823-27.842115 27.841092-27.842115l73.185836 0.00921L560.449967 602.50427l39.378869-39.378869L732.875015 696.163393l-0.62524-71.426773c0-15.371082 12.462846-27.842115 27.842115-27.842115 15.380292 0 27.842115 12.471033 27.842115 27.842115L787.934005 763.946172zM787.932981 402.000724c0 15.380292-12.461823 27.842115-27.842115 27.842115-15.379269 0-27.842115-12.461823-27.842115-27.842115l0.62524-71.435982L599.828836 463.611943l-39.378869-39.378869 133.617184-133.607974-73.185836 0.00921c-15.379269 0-27.841092-12.461823-27.841092-27.842115s12.461823-27.842115 27.841092-27.842115l138.421606-0.00921c7.785314 0 14.781658 3.226484 19.839861 8.374738 5.383614 4.568039 8.791224 11.219529 8.791224 19.476587L787.934005 402.000724z"></path>\n</svg>\n'},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">\n  <path transform="scale(0.028 0.028)" d="M834.56 81.92H189.44c-59.392 0-107.52 48.128-107.52 107.52v645.12c0 59.392 48.128 107.52 107.52 107.52h645.12c59.392 0 107.52-48.128 107.52-107.52V189.44c0-59.392-48.128-107.52-107.52-107.52zM458.24 727.04c0 14.848-12.288 26.624-26.624 26.624S404.48 741.888 404.48 727.04v-69.632L289.28 773.12c-10.752 10.24-27.648 10.24-37.888 0-10.24-10.752-10.24-27.648 0-37.888L366.592 619.52H296.96c-14.848 0-26.624-12.288-26.624-26.624s12.288-26.624 26.624-26.624h134.144c14.848 0 26.624 12.288 26.624 26.624V727.04z m0-295.936c0 14.848-12.288 26.624-26.624 26.624H296.96c-14.848 0-26.624-12.288-26.624-26.624S282.112 404.48 296.96 404.48h69.632L251.392 289.28c-10.24-10.752-10.24-27.648 0-37.888 5.12-5.12 12.288-7.68 18.944-7.68 6.656 0 13.824 2.56 18.944 7.68L404.48 366.592V296.96c0-14.848 12.288-26.624 26.624-26.624s26.624 12.288 26.624 26.624v134.144zM773.12 773.12c-10.752 10.24-27.648 10.24-37.888 0L619.52 657.408V727.04c0 14.848-12.288 26.624-26.624 26.624s-26.624-11.776-26.624-26.624v-134.144c0-14.848 12.288-26.624 26.624-26.624H727.04c14.848 0 26.624 12.288 26.624 26.624s-12.288 26.624-26.624 26.624h-69.632l115.2 115.2c10.752 10.752 10.752 27.648 0.512 38.4z m0-483.84L657.408 404.48H727.04c14.848 0 26.624 12.288 26.624 26.624 0 14.848-12.288 26.624-26.624 26.624h-134.144c-14.848 0-26.624-12.288-26.624-26.624V296.96c0-14.848 12.288-26.624 26.624-26.624s26.624 12.288 26.624 26.624v69.632L734.72 250.88c5.12-5.12 12.288-7.68 18.944-7.68s13.824 2.56 18.944 7.68c10.752 10.752 10.752 27.648 0.512 38.4z"></path>\n</svg>\n'},function(e,t,n){var r=n(115);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-cssfullscreen,.xgplayer-skin-default .xgplayer-cssfullscreen-img{position:relative;-webkit-order:12;-moz-box-ordinal-group:13;order:12;display:block;cursor:pointer}.xgplayer-skin-default .xgplayer-cssfullscreen-img .xgplayer-icon,.xgplayer-skin-default .xgplayer-cssfullscreen .xgplayer-icon{width:32px;margin-top:5px}.xgplayer-skin-default .xgplayer-cssfullscreen-img .xgplayer-icon div,.xgplayer-skin-default .xgplayer-cssfullscreen .xgplayer-icon div{position:absolute}.xgplayer-skin-default .xgplayer-cssfullscreen-img .xgplayer-icon .xgplayer-icon-requestfull,.xgplayer-skin-default .xgplayer-cssfullscreen .xgplayer-icon .xgplayer-icon-requestfull{display:block}.xgplayer-skin-default .xgplayer-cssfullscreen-img .xgplayer-icon .xgplayer-icon-exitfull,.xgplayer-skin-default .xgplayer-cssfullscreen .xgplayer-icon .xgplayer-icon-exitfull{display:none}.xgplayer-skin-default .xgplayer-cssfullscreen-img .xgplayer-tips,.xgplayer-skin-default .xgplayer-cssfullscreen .xgplayer-tips{margin-left:-40px}.xgplayer-skin-default .xgplayer-cssfullscreen-img .xgplayer-tips .xgplayer-tip-requestfull,.xgplayer-skin-default .xgplayer-cssfullscreen .xgplayer-tips .xgplayer-tip-requestfull{display:block}.xgplayer-skin-default .xgplayer-cssfullscreen-img .xgplayer-tips .xgplayer-tip-exitfull,.xgplayer-skin-default .xgplayer-cssfullscreen .xgplayer-tips .xgplayer-tip-exitfull{display:none}.xgplayer-skin-default .xgplayer-cssfullscreen-img:hover,.xgplayer-skin-default .xgplayer-cssfullscreen:hover{opacity:.85}.xgplayer-skin-default .xgplayer-cssfullscreen-img:hover .xgplayer-tips,.xgplayer-skin-default .xgplayer-cssfullscreen:hover .xgplayer-tips{display:block}.xgplayer-skin-default.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen-img .xgplayer-icon .xgplayer-icon-requestfull,.xgplayer-skin-default.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen .xgplayer-icon .xgplayer-icon-requestfull{display:none}.xgplayer-skin-default.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen-img .xgplayer-icon .xgplayer-icon-exitfull,.xgplayer-skin-default.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen .xgplayer-icon .xgplayer-icon-exitfull{display:block}.xgplayer-skin-default.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen-img .xgplayer-tips,.xgplayer-skin-default.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen .xgplayer-tips{margin-left:-47px}.xgplayer-skin-default.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen-img .xgplayer-tips .xgplayer-tip-requestfull,.xgplayer-skin-default.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen .xgplayer-tips .xgplayer-tip-requestfull{display:none}.xgplayer-skin-default.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen-img .xgplayer-tips .xgplayer-tip-exitfull,.xgplayer-skin-default.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen .xgplayer-tips .xgplayer-tip-exitfull{display:block}.xgplayer-skin-default.xgplayer-is-fullscreen .xgplayer-cssfullscreen,.xgplayer-skin-default.xgplayer-is-fullscreen .xgplayer-cssfullscreen-img{display:none}.xgplayer-skin-default.xgplayer-is-cssfullscreen{position:fixed!important;left:0!important;top:0!important;width:100%!important;height:100%!important;z-index:99999!important}.xgplayer-lang-is-en .xgplayer-cssfullscreen-img .xgplayer-tips,.xgplayer-lang-is-en .xgplayer-cssfullscreen .xgplayer-tips,.xgplayer-lang-is-en.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen-img .xgplayer-tips,.xgplayer-lang-is-en.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen .xgplayer-tips{margin-left:-46px}.lang-is-jp .xgplayer-cssfullscreen-img .xgplayer-tips,.lang-is-jp .xgplayer-cssfullscreen .xgplayer-tips{margin-left:-120px}.lang-is-jp.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen-img .xgplayer-tips,.lang-is-jp.xgplayer-is-cssfullscreen .xgplayer-cssfullscreen .xgplayer-tips{margin-left:-60px}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=s(n(117)),o=s(n(118)),a=s(n(119));function s(e){return e&&e.__esModule?e:{default:e}}n(120);t.default={name:"s_volume",method:function(){var e=this,t=(0,r.createDom)("xg-volume",'<xg-icon class="xgplayer-icon">\n                                         <div class="xgplayer-icon-large">'+a.default+'</div>\n                                         <div class="xgplayer-icon-small">'+o.default+'</div>\n                                         <div class="xgplayer-icon-muted">'+i.default+'</div>\n                                       </xg-icon>\n                                       <xg-slider class="xgplayer-slider" tabindex="2">\n                                         <xg-bar class="xgplayer-bar">\n                                           <xg-drag class="xgplayer-drag"></xg-drag>\n                                         </xg-bar>\n                                       </xg-slider>',{},"xgplayer-volume");e.once("ready",function(){e.controls&&e.controls.appendChild(t)});var n=t.querySelector(".xgplayer-slider"),s=t.querySelector(".xgplayer-bar"),u=t.querySelector(".xgplayer-drag"),l=t.querySelector(".xgplayer-icon");u.style.height=100*e.config.volume+"%",n.volume=e.config.volume,s.addEventListener("mousedown",function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("volumeBarClick",t)}),["click","touchend"].forEach(function(t){l.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("volumeIconClick")})}),l.addEventListener("mouseenter",function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("volumeIconEnter")}),["blur","mouseleave"].forEach(function(n){t.addEventListener(n,function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("volumeIconLeave")})})}},e.exports=t.default},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28">\n  <path transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path transform="scale(0.0220625 0.0220625)" d="M920.4 439.808l-108.544-109.056-72.704 72.704 109.568 108.544-109.056 108.544 72.704 72.704 108.032-109.568 108.544 109.056 72.704-72.704-109.568-108.032 109.056-108.544-72.704-72.704-108.032 109.568z"></path>\n</svg>\n'},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28">\n  <path transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path transform="scale(0.0220625 0.0220625)" d="M795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n'},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28">\n  <path transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path transform="scale(0.0220625 0.0220625)" d="M940.632 837.632l-72.192-72.192c65.114-64.745 105.412-154.386 105.412-253.44s-40.299-188.695-105.396-253.424l-0.016-0.016 72.192-72.192c83.639 83.197 135.401 198.37 135.401 325.632s-51.762 242.434-135.381 325.612l-0.020 0.020zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n'},function(e,t,n){var r=n(121);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,'.xgplayer-skin-default .xgplayer-volume{outline:none;-webkit-order:4;-moz-box-ordinal-group:5;order:4;width:40px;height:40px;display:block;position:relative;z-index:18}.xgplayer-skin-default .xgplayer-volume .xgplayer-icon{margin-top:8px;cursor:pointer;position:absolute;bottom:-9px}.xgplayer-skin-default .xgplayer-volume .xgplayer-icon div{position:absolute}.xgplayer-skin-default .xgplayer-volume .xgplayer-icon .xgplayer-icon-large{display:block}.xgplayer-skin-default .xgplayer-volume .xgplayer-icon .xgplayer-icon-muted,.xgplayer-skin-default .xgplayer-volume .xgplayer-icon .xgplayer-icon-small{display:none}.xgplayer-skin-default .xgplayer-slider{display:none;position:absolute;width:28px;height:92px;background:rgba(0,0,0,.54);border-radius:1px;bottom:42px;outline:none}.xgplayer-skin-default .xgplayer-slider:after{content:" ";display:block;height:15px;width:28px;position:absolute;bottom:-15px;left:0;z-index:20}.xgplayer-skin-default .xgplayer-bar,.xgplayer-skin-default .xgplayer-drag{display:block;position:absolute;bottom:6px;left:12px;background:hsla(0,0%,100%,.3);border-radius:100px;width:4px;height:76px;outline:none;cursor:pointer}.xgplayer-skin-default .xgplayer-drag{bottom:0;left:0;background:#fa1f41;max-height:76px}.xgplayer-skin-default .xgplayer-drag:after{content:" ";display:inline-block;width:8px;height:8px;background:#fff;box-shadow:0 0 5px 0 rgba(0,0,0,.26);position:absolute;border-radius:50%;left:-2px;top:-6px}.xgplayer-skin-default.xgplayer-volume-active .xgplayer-slider,.xgplayer-skin-default.xgplayer-volume-large .xgplayer-volume .xgplayer-icon .xgplayer-icon-large{display:block}.xgplayer-skin-default.xgplayer-volume-large .xgplayer-volume .xgplayer-icon .xgplayer-icon-muted,.xgplayer-skin-default.xgplayer-volume-large .xgplayer-volume .xgplayer-icon .xgplayer-icon-small,.xgplayer-skin-default.xgplayer-volume-small .xgplayer-volume .xgplayer-icon .xgplayer-icon-large{display:none}.xgplayer-skin-default.xgplayer-volume-small .xgplayer-volume .xgplayer-icon .xgplayer-icon-small{display:block}.xgplayer-skin-default.xgplayer-volume-muted .xgplayer-volume .xgplayer-icon .xgplayer-icon-large,.xgplayer-skin-default.xgplayer-volume-muted .xgplayer-volume .xgplayer-icon .xgplayer-icon-small,.xgplayer-skin-default.xgplayer-volume-small .xgplayer-volume .xgplayer-icon .xgplayer-icon-muted{display:none}.xgplayer-skin-default.xgplayer-volume-muted .xgplayer-volume .xgplayer-icon .xgplayer-icon-muted{display:block}.xgplayer-skin-default.xgplayer-mobile .xgplayer-volume .xgplayer-slider{display:none}',""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(5),a=(r=o)&&r.__esModule?r:{default:r};n(123);t.default={name:"s_definition",method:function(){var e=this,t=e.root,n=void 0,r=(0,i.createDom)("xg-definition","",{tabindex:3},"xgplayer-definition");function o(){var n=e.definitionList,o=["<ul>"],a=e.config.url,s=document.createElement("a");e.switchURL?["mp4","hls","__flv__","dash"].every(function(t){return!e[t]||(e[t].url&&(s.href=e[t].url),"__flv__"===t&&(e[t]._options?s.href=e[t]._options.url:s.href=e[t]._mediaDataSource.url),"hls"===t&&(s.href=e[t].originUrl||e[t].url,a=s.href),a=s.href,!1)}):a=e.currentSrc||e.src,n.forEach(function(t){s.href=t.url,e.dash?o.push("<li url='"+t.url+"' cname='"+t.name+"' class='"+(t.selected?"selected":"")+"'>"+t.name+"</li>"):o.push("<li url='"+t.url+"' cname='"+t.name+"' class='"+(s.href===a?"selected":"")+"'>"+t.name+"</li>")});var u=n.filter(function(t){return s.href=t.url,e.dash?!0===t.selected:s.href===a});console.warn("cursrc:",u,"src:",a,"list:",n),o.push("</ul><p class='name'>"+(u[0]||{name:""}).name+"</p>");var l=t.querySelector(".xgplayer-definition");if(l){l.innerHTML=o.join("");var c=l.querySelector(".name");e.config.definitionActive&&"hover"!==e.config.definitionActive||c.addEventListener("mouseenter",function(t){t.preventDefault(),t.stopPropagation(),(0,i.addClass)(e.root,"xgplayer-definition-active"),l.focus()})}else{r.innerHTML=o.join("");var d=r.querySelector(".name");e.config.definitionActive&&"hover"!==e.config.definitionActive||d.addEventListener("mouseenter",function(t){t.preventDefault(),t.stopPropagation(),(0,i.addClass)(e.root,"xgplayer-definition-active"),r.focus()}),e.controls.appendChild(r)}}function s(n){e.definitionList=n,n&&n instanceof Array&&n.length>0&&((0,i.addClass)(t,"xgplayer-is-definition"),e.once("canplay",o))}function u(){if(e.currentTime=e.curTime,n)e.pause();else{var t=e.play();void 0!==t&&t&&t.catch(function(e){})}}function l(){e.once("timeupdate",u)}function c(){(0,i.removeClass)(t,"xgplayer-definition-active")}"mobile"===a.default.device&&(e.config.definitionActive="click"),e.on("resourceReady",s),["touchend","click"].forEach(function(t){r.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation();var o=e.definitionList,s=t.target||t.srcElement,c=document.createElement("a");if(s&&"li"===s.tagName.toLocaleLowerCase()){var d,f=void 0;if(Array.prototype.forEach.call(s.parentNode.childNodes,function(t){(0,i.hasClass)(t,"selected")&&(f=t.getAttribute("cname"),(0,i.removeClass)(t,"selected"),e.emit("beforeDefinitionChange",t.getAttribute("url")))}),e.dash&&o.forEach(function(e){e.selected=!1,e.name===s.innerHTML&&(e.selected=!0)}),(0,i.addClass)(s,"selected"),d=s.getAttribute("cname"),s.parentNode.nextSibling.innerHTML=""+s.getAttribute("cname"),c.href=s.getAttribute("url"),n=e.paused,e.switchURL){var p=document.createElement("a");["mp4","hls","__flv__","dash"].every(function(t){return!e[t]||(e[t].url&&(p.href=e[t].url),"__flv__"===t&&(e[t]._options?p.href=e[t]._options.url:p.href=e[t]._mediaDataSource.url),"hls"===t&&(p.href=e[t].originUrl||e[t].url),!1)}),p.href===c.href||e.ended||e.switchURL(c.href)}else e.hls&&(document.createElement("a"),e.hls.url),c.href!==e.currentSrc&&(e.curTime=e.currentTime,e.ended||(e.src=c.href));navigator.userAgent.toLowerCase().indexOf("android")>-1?e.once("timeupdate",l):e.once("loadedmetadata",u),e.emit("definitionChange",{from:f,to:d}),"mobile"===a.default.device&&(0,i.removeClass)(e.root,"xgplayer-definition-active")}else"click"!==e.config.definitionActive||!s||"p"!==s.tagName.toLocaleLowerCase()&&"em"!==s.tagName.toLocaleLowerCase()||("mobile"===a.default.device?(0,i.toggleClass)(e.root,"xgplayer-definition-active"):(0,i.addClass)(e.root,"xgplayer-definition-active"),r.focus());e.emit("focus")},!1)}),r.addEventListener("mouseleave",function(e){e.preventDefault(),e.stopPropagation(),(0,i.removeClass)(t,"xgplayer-definition-active")}),e.on("blur",c),e.once("destroy",function t(){e.off("resourceReady",s),e.off("canplay",o),navigator.userAgent.toLowerCase().indexOf("android")>-1?(e.off("timeupdate",l),e.off("timeupdate",u)):e.off("loadedmetadata",u),e.off("blur",c),e.off("destroy",t)}),e.getCurrentDefinition=function(){for(var t=e.controls.querySelectorAll(".xgplayer-definition ul li"),n=0;n<t.length;n++)if(t[n].className&&t[n].className.indexOf("selected")>-1)return{name:t[n].getAttribute("cname"),url:t[n].getAttribute("url")};return{name:t[0].getAttribute("cname"),url:t[0].getAttribute("url")}},e.switchDefinition=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.controls.querySelectorAll(".xgplayer-definition ul li"),r=0;r<n.length;r++)n[r].getAttribute("cname")!==t.name&&n[r].getAttribute("url")!==t.url&&r!==t.index||n[r].click()}}},e.exports=t.default},function(e,t,n){var r=n(124);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-definition{-webkit-order:5;-moz-box-ordinal-group:6;order:5;width:60px;height:150px;z-index:18;position:relative;outline:none;display:none;cursor:default;margin-left:10px;margin-top:-119px}.xgplayer-skin-default .xgplayer-definition ul{display:none;list-style:none;width:78px;background:rgba(0,0,0,.54);border-radius:1px;position:absolute;bottom:30px;left:0;text-align:center;white-space:nowrap;margin-left:-10px;z-index:26;cursor:pointer}.xgplayer-skin-default .xgplayer-definition ul li{opacity:.7;font-family:PingFangSC-Regular;font-size:11px;color:hsla(0,0%,100%,.8);padding:6px 13px}.xgplayer-skin-default .xgplayer-definition ul li.selected,.xgplayer-skin-default .xgplayer-definition ul li:hover{color:#fff;opacity:1}.xgplayer-skin-default .xgplayer-definition .name{text-align:center;font-family:PingFangSC-Regular;font-size:13px;cursor:pointer;color:hsla(0,0%,100%,.8);position:absolute;bottom:0;width:60px;height:20px;line-height:20px;background:rgba(0,0,0,.38);border-radius:10px;display:inline-block;vertical-align:middle}.xgplayer-skin-default.xgplayer-definition-active .xgplayer-definition ul,.xgplayer-skin-default.xgplayer-is-definition .xgplayer-definition{display:block}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(5),a=(r=o)&&r.__esModule?r:{default:r};n(126);t.default={name:"s_playbackRate",method:function(){var e=this,t=[];if(!e.config.playbackRate)return!1;(t=[].concat(e.config.playbackRate)).sort(function(e,t){return t-e});var n=void 0!==e.config.playbackRateUnit?e.config.playbackRateUnit:"x",r=(0,i.createDom)("xg-playbackrate"," ",{},"xgplayer-playbackrate");"mobile"===a.default.device&&(e.config.playbackRateActive="click");var o=[];t.forEach(function(e){o.push({name:""+e,rate:""+e+n,selected:!1})});var s=1,u=["<ul>"];o.forEach(function(t){e.config.defaultPlaybackRate&&e.config.defaultPlaybackRate.toString()===t.name?(t.selected=!0,s=e.config.defaultPlaybackRate,e.once("playing",function(){e.video.playbackRate=e.config.defaultPlaybackRate})):"1.0"!==t.name&&"1"!==t.name||e.config.defaultPlaybackRate&&1!==e.config.defaultPlaybackRate||(t.selected=!0),u.push("<li cname='"+t.name+"' class='"+(t.selected?"selected":"")+"'>"+t.rate+"</li>")}),u.push("</ul><p class='name'>"+s+n+"</p>");var l=e.root.querySelector(".xgplayer-playbackrate");if(l){l.innerHTML=u.join("");var c=l.querySelector(".name");e.config.playbackRateActive&&"hover"!==e.config.playbackRateActive||c.addEventListener("mouseenter",function(t){t.preventDefault(),t.stopPropagation(),(0,i.addClass)(e.root,"xgplayer-playbackrate-active"),l.focus()})}else{r.innerHTML=u.join("");var d=r.querySelector(".name");e.config.playbackRateActive&&"hover"!==e.config.playbackRateActive||d.addEventListener("mouseenter",function(t){t.preventDefault(),t.stopPropagation(),(0,i.addClass)(e.root,"xgplayer-playbackrate-active"),r.focus()}),e.once("ready",function(){e.controls.appendChild(r)})}["touchend","click"].forEach(function(t){r.addEventListener(t,function(t){t.stopPropagation(),t.preventDefault();var u=t.target;if(u&&"li"===u.tagName.toLocaleLowerCase()){var l,c=void 0;o.forEach(function(t){t.selected=!1,u.textContent.replace(/\s+/g,"")===t.rate&&(Array.prototype.forEach.call(u.parentNode.childNodes,function(e){(0,i.hasClass)(e,"selected")&&(c=Number(e.getAttribute("cname")),(0,i.removeClass)(e,"selected"))}),t.selected=!0,e.video.playbackRate=1*t.name,s=1*t.name)}),(0,i.addClass)(u,"selected"),l=Number(u.getAttribute("cname")),u.parentNode.nextSibling.innerHTML=""+u.getAttribute("cname")+n,e.emit("playbackrateChange",{from:c,to:l}),"mobile"===a.default.device&&(0,i.removeClass)(e.root,"xgplayer-playbackrate-active")}else"click"!==e.config.playbackRateActive||!u||"p"!==u.tagName.toLocaleLowerCase()&&"span"!==u.tagName.toLocaleLowerCase()||("mobile"===a.default.device?(0,i.toggleClass)(e.root,"xgplayer-playbackrate-active"):(0,i.addClass)(e.root,"xgplayer-playbackrate-active"),r.focus());e.emit("focus")},!1)}),r.addEventListener("mouseleave",function(t){t.preventDefault(),t.stopPropagation(),(0,i.removeClass)(e.root,"xgplayer-playbackrate-active")}),e.on("blur",function(){(0,i.removeClass)(e.root,"xgplayer-playbackrate-active")}),e.on("play",function(){e.video.playbackRate.toFixed(1)!==s.toFixed(1)&&(e.video.playbackRate=s)}),e.switchPlaybackRate=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.controls.querySelectorAll(".xgplayer-playbackrate ul li"),r=0;r<n.length;r++)(0,i.hasClass)(n[r],"selected")||n[r].getAttribute("cname")!==""+t.playbackRate&&r!==t.index||n[r].click()},e.on("ratechange",function(){e.switchPlaybackRate({playbackRate:e.playbackRate})})}},e.exports=t.default},function(e,t,n){var r=n(127);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-playbackrate{-webkit-order:8;-moz-box-ordinal-group:9;order:8;width:60px;height:150px;z-index:18;position:relative;display:inline-block;cursor:default;margin-top:-119px}.xgplayer-skin-default .xgplayer-playbackrate ul{display:none;list-style:none;width:78px;background:rgba(0,0,0,.54);border-radius:1px;position:absolute;bottom:30px;left:50%;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%);text-align:left;white-space:nowrap;z-index:26;cursor:pointer}.xgplayer-skin-default .xgplayer-playbackrate ul li{opacity:.7;font-family:PingFangSC-Regular;font-size:11px;color:hsla(0,0%,100%,.8);position:relative;padding:4px 0;text-align:center}.xgplayer-skin-default .xgplayer-playbackrate ul li.selected,.xgplayer-skin-default .xgplayer-playbackrate ul li:hover{color:#fff;opacity:1}.xgplayer-skin-default .xgplayer-playbackrate ul li:first-child{position:relative;margin-top:12px}.xgplayer-skin-default .xgplayer-playbackrate ul li:last-child{position:relative;margin-bottom:12px}.xgplayer-skin-default .xgplayer-playbackrate .name{width:60px;height:20px;position:absolute;bottom:0;text-align:center;font-family:PingFangSC-Regular;font-size:13px;background:rgba(0,0,0,.38);color:hsla(0,0%,100%,.8);border-radius:10px;line-height:20px}.xgplayer-skin-default .xgplayer-playbackrate span{position:relative;top:19px;font-weight:700;text-shadow:0 0 4px rgba(0,0,0,.6)}.xgplayer-skin-default .xgplayer-playbackrate:hover{opacity:1}.xgplayer-skin-default.xgplayer-playbackrate-active .xgplayer-playbackrate ul{display:block}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default={name:"s_localPreview",method:function(){var e=this;if(e.config.preview&&e.config.preview.uploadEl){var t=(0,r.createDom)("xg-preview",'<input type="file">',{},"xgplayer-preview"),n=t.querySelector("input");e.config.preview.uploadEl.appendChild(t),n.onchange=function(){e.emit("upload",n)}}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(130),a=(r=o)&&r.__esModule?r:{default:r};n(131);t.default={name:"s_download",method:function(){var e=this;if(e.config.download){var t=(0,i.createDom)("xg-download",'<xg-icon class="xgplayer-icon">'+a.default+"</xg-icon>",{},"xgplayer-download"),n=e.lang.DOWNLOAD_TIPS,r=(0,i.createDom)("xg-tips",'<span class="xgplayer-tip-download">'+n+"</span>",{},"xgplayer-tips");t.appendChild(r),e.once("ready",function(){e.controls.appendChild(t)}),["click","touchend"].forEach(function(n){t.addEventListener(n,function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("downloadBtnClick")})})}}},e.exports=t.default},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">\n  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n    <g transform="translate(-488.000000, -340.000000)" fill="#FFFFFF">\n      <g id="Group-2">\n        <g id="volme_big-copy" transform="translate(488.000000, 340.000000)">\n          <rect id="Rectangle-18" x="11" y="4" width="2" height="12" rx="1"></rect>\n          <rect id="Rectangle-2" x="3" y="18" width="18" height="2" rx="1"></rect>\n          <rect id="Rectangle-2" transform="translate(4.000000, 17.500000) rotate(90.000000) translate(-4.000000, -17.500000) " x="1.5" y="16.5" width="5" height="2" rx="1"></rect><rect id="Rectangle-2-Copy-3" transform="translate(20.000000, 17.500000) rotate(90.000000) translate(-20.000000, -17.500000) " x="17.5" y="16.5" width="5" height="2" rx="1"></rect>\n          <path d="M9.48791171,8.26502656 L9.48791171,14.2650266 C9.48791171,14.8173113 9.04019646,15.2650266 8.48791171,15.2650266 C7.93562696,15.2650266 7.48791171,14.8173113 7.48791171,14.2650266 L7.48791171,7.26502656 C7.48791171,6.71274181 7.93562696,6.26502656 8.48791171,6.26502656 L15.4879117,6.26502656 C16.0401965,6.26502656 16.4879117,6.71274181 16.4879117,7.26502656 C16.4879117,7.81731131 16.0401965,8.26502656 15.4879117,8.26502656 L9.48791171,8.26502656 Z" id="Combined-Shape" transform="translate(11.987912, 10.765027) scale(1, -1) rotate(45.000000) translate(-11.987912, -10.765027) "></path>\n        </g>\n      </g>\n    </g>\n  </g>\n</svg>\n'},function(e,t,n){var r=n(132);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-download{position:relative;-webkit-order:9;-moz-box-ordinal-group:10;order:9;display:block;cursor:pointer}.xgplayer-skin-default .xgplayer-download .xgplayer-icon{margin-top:3px}.xgplayer-skin-default .xgplayer-download .xgplayer-icon div{position:absolute}.xgplayer-skin-default .xgplayer-download .xgplayer-icon svg{position:relative;top:5px;left:5px}.xgplayer-skin-default .xgplayer-download .xgplayer-tips{margin-left:-20px}.xgplayer-skin-default .xgplayer-download .xgplayer-tips .xgplayer-tip-download{display:block}.xgplayer-skin-default .xgplayer-download:hover{opacity:.85}.xgplayer-skin-default .xgplayer-download:hover .xgplayer-tips{display:block}.xgplayer-lang-is-en .xgplayer-download .xgplayer-tips{margin-left:-32px}.xgplayer-lang-is-jp .xgplayer-download .xgplayer-tips{margin-left:-40px}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=a(n(134)),o=a(n(136));function a(e){return e&&e.__esModule?e:{default:e}}n(137);t.default={name:"s_danmu",method:function(){var e=this,t=e.root;if(e.config.danmu){var n=(0,r.createDom)("xg-danmu","",{},"xgplayer-danmu");e.once("ready",function(){t.appendChild(n)});var a=(0,r.deepCopy)({container:n,player:e.video,comments:[],area:{start:0,end:1}},e.config.danmu),s=void 0;e.config.danmu.panel&&(s=(0,r.createDom)("xg-panel",'<xg-panel-icon class="xgplayer-panel-icon">\n                                                '+o.default+'\n                                              </xg-panel-icon>\n                                              <xg-panel-slider class="xgplayer-panel-slider">\n                                                <xg-hidemode class="xgplayer-hidemode">\n                                                  <p class="xgplayer-hidemode-font">屏蔽类型</p>\n                                                  <ul class="xgplayer-hidemode-radio">\n                                                    <li class="xgplayer-hidemode-scroll" id="false">滚动</li><li class="xgplayer-hidemode-top" id="false">顶部</li><li class="xgplayer-hidemode-bottom" id="false">底部</li><li class="xgplayer-hidemode-color" id="false">色彩</li>\n                                                  </ul>\n                                                </xg-hidemode>\n                                                <xg-transparency class="xgplayer-transparency">\n                                                  <span>不透明度</span>\n                                                  <input class="xgplayer-transparency-line xgplayer-transparency-color xgplayer-transparency-bar xgplayer-transparency-gradient" type="range" min="0" max="100" step="0.1" value="50"></input>\n                                                </xg-transparency>\n                                                <xg-showarea class="xgplayer-showarea">\n                                                  <div class="xgplayer-showarea-name">显示区域</div>\n                                                  <div class="xgplayer-showarea-control">\n                                                    <div class="xgplayer-showarea-control-up">\n                                                      <span class="xgplayer-showarea-control-up-item xgplayer-showarea-onequarters">1/4</span>\n                                                      <span class="xgplayer-showarea-control-up-item xgplayer-showarea-twoquarters selected-color">1/2</span>\n                                                      <span class="xgplayer-showarea-control-up-item xgplayer-showarea-threequarters">3/4</span>\n                                                      <span class="xgplayer-showarea-control-up-item xgplayer-showarea-full">1</span>\n                                                    </div>\n                                                    <div class="xgplayer-showarea-control-down">\n                                                      <div class="xgplayer-showarea-control-down-dots">\n                                                        <span class="xgplayer-showarea-onequarters-dot"></span>\n                                                        <span class="xgplayer-showarea-twoquarters-dot"></span>\n                                                        <span class="xgplayer-showarea-threequarters-dot"></span>\n                                                        <span class="xgplayer-showarea-full-dot"></span>\n                                                      </div>\n                                                      <input class="xgplayer-showarea-line xgplayer-showarea-color xgplayer-showarea-bar xgplayer-gradient" type="range" min="1" max="4" step="1" value="1">\n                                                    </div>\n                                                  </div>\n                                                </xg-showarea>\n                                                <xg-danmuspeed class="xgplayer-danmuspeed">\n                                                  <div class="xgplayer-danmuspeed-name">弹幕速度</div>\n                                                  <div class="xgplayer-danmuspeed-control">\n                                                    <div class="xgplayer-danmuspeed-control-up">\n                                                      <span class="xgplayer-danmuspeed-control-up-item xgplayer-danmuspeed-small">慢</span>\n                                                      <span class="xgplayer-danmuspeed-control-up-item xgplayer-danmuspeed-middle selected-color">中</span>\n                                                      <span class="xgplayer-danmuspeed-control-up-item xgplayer-danmuspeed-large">快</span>\n                                                    </div>\n                                                    <div class="xgplayer-danmuspeed-control-down">\n                                                      <div class="xgplayer-danmuspeed-control-down-dots">\n                                                        <span class="xgplayer-danmuspeed-small-dot"></span>\n                                                        <span class="xgplayer-danmuspeed-middle-dot"></span>\n                                                        <span class="xgplayer-danmuspeed-large-dot"></span>\n                                                      </div>\n                                                      <input class="xgplayer-danmuspeed-line xgplayer-danmuspeed-color xgplayer-danmuspeed-bar xgplayer-gradient" type="range" min="50" max="150" step="50" value="100">\n                                                    </div>\n                                                  </div>\n                                                </xg-danmuspeed>\n                                                <xg-danmufont class="xgplayer-danmufont">\n                                                  <div class="xgplayer-danmufont-name">字体大小</div>\n                                                  <div class="xgplayer-danmufont-control">\n                                                    <div class="xgplayer-danmufont-control-up">\n                                                      <span class="xgplayer-danmufont-control-up-item xgplayer-danmufont-small">小</span>\n                                                      <span class="xgplayer-danmufont-control-up-item xgplayer-danmufont-middle">中</span>\n                                                      <span class="xgplayer-danmufont-control-up-item xgplayer-danmufont-large selected-color">大</span>\n                                                    </div>\n                                                    <div class="xgplayer-danmufont-control-down">\n                                                      <div class="xgplayer-danmufont-control-down-dots">\n                                                        <span class="xgplayer-danmufont-small-dot"></span>\n                                                        <span class="xgplayer-danmufont-middle-dot"></span>\n                                                        <span class="xgplayer-danmufont-large-dot"></span>\n                                                      </div>\n                                                      <input class="xgplayer-danmufont-line xgplayer-danmufont-color xgplayer-danmufont-bar xgplayer-gradient" type="range" min="20" max="30" step="5" value="25">\n                                                    </div>\n                                                  </div>\n                                                </xg-danmufont>\n                                              </xg-panel-slider>',{tabindex:7},"xgplayer-panel"),e.once("ready",function(){e.controls.appendChild(s)})),e.once("complete",function(){var t=new i.default(a);if(e.emit("initDefaultDanmu",t),e.danmu=t,e.config.danmu.panel){var n=s.querySelector(".xgplayer-panel-slider"),o=void 0;["mouseenter","touchend","click"].forEach(function(e){s.addEventListener(e,function(e){e.preventDefault(),e.stopPropagation(),(0,r.addClass)(n,"xgplayer-panel-active"),s.focus(),o=!0})}),s.addEventListener("mouseleave",function(e){e.preventDefault(),e.stopPropagation(),(0,r.removeClass)(n,"xgplayer-panel-active"),o=!1}),n.addEventListener("mouseleave",function(e){e.preventDefault(),e.stopPropagation(),!1===o&&(0,r.removeClass)(n,"xgplayer-panel-active")});var u=e.config.danmu,l={scroll:s.querySelector(".xgplayer-hidemode-scroll"),top:s.querySelector(".xgplayer-hidemode-top"),bottom:s.querySelector(".xgplayer-hidemode-bottom"),color:s.querySelector(".xgplayer-hidemode-color")},c=function(t){var n=t;["touchend","click"].forEach(function(t){l[n].addEventListener(t,function(t){"true"!==l[n].getAttribute("id")?(l[n].style.color="#f85959",l[n].setAttribute("id","true"),e.danmu.hide(n)):(l[n].style.color="#aaa",l[n].setAttribute("id","false"),e.danmu.show(n))})})};for(var d in l)c(d);var f=s.querySelector(".xgplayer-transparency-line"),p=s.querySelector(".xgplayer-transparency-gradient"),h=50;if(p.style.background="linear-gradient(to right, #f85959 0%, #f85959 "+h+"%, #aaa "+h+"%, #aaa)",f.addEventListener("input",function(e){e.preventDefault(),e.stopPropagation(),h=e.target.value,p.style.background="linear-gradient(to right, #f85959 0%, #f85959 "+h+"%, #aaa "+h+"%, #aaa)",u.comments.forEach(function(e){e.style.opacity=h/100})}),s.querySelector(".xgplayer-showarea-line").addEventListener("input",function(t){t.preventDefault(),t.stopPropagation();var n=t.target.value;e.danmu.config.area.end=n/100,e.config.danmu.area.end=n/100,e.danmu.bulletBtn.main.channel.resize()}),s.querySelector(".xgplayer-danmuspeed-line").addEventListener("input",function(e){e.preventDefault(),e.stopPropagation();var t=e.target.value;u.comments.forEach(function(e){e.duration=100*(200-t)})}),s.querySelector(".xgplayer-danmufont-line").addEventListener("input",function(e){e.preventDefault(),e.stopPropagation();var t=e.target.value;u.comments.forEach(function(e){e.style.fontSize=t+"px"})}),navigator.userAgent.indexOf("Firefox")>-1)for(var g=0;g<n.querySelectorAll("input").length;g++)n.querySelectorAll("input")[g].style.marginTop="10px"}})}}},e.exports=t.default},function(e,t,n){"use strict";(function(e){var n,r,i,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};window,o=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==(void 0===e?"undefined":a(e))&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){function r(e,t){return e.classList?Array.prototype.some.call(e.classList,function(e){return e===t}):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function i(e,t){e.classList?t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(t){t&&e.classList.add(t)}):r(e,t)||(e.className+=" "+t)}function o(e,t){e.classList?t.split(/\s+/g).forEach(function(t){e.classList.remove(t)}):r(e,t)&&t.split(/\s+/g).forEach(function(t){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")})}function a(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}Object.defineProperty(t,"__esModule",{value:!0}),t.createDom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=r,i.innerHTML=t,Object.keys(n).forEach(function(t){var r=t,o=n[t];"video"===e||"audio"===e?o&&i.setAttribute(r,o):i.setAttribute(r,o)}),i},t.hasClass=r,t.addClass=i,t.removeClass=o,t.toggleClass=function(e,t){t.split(/\s+/g).forEach(function(t){r(e,t)?o(e,t):i(e,t)})},t.findDom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=arguments[1],n=void 0;try{n=e.querySelector(t)}catch(r){t.startsWith("#")&&(n=e.getElementById(t.slice(1)))}return n},t.deepCopy=function e(t,n){if("Object"===a(n)&&"Object"===a(t))return Object.keys(n).forEach(function(r){"Object"!==a(n[r])||n[r]instanceof Node?"Array"===a(n[r])?t[r]="Array"===a(t[r])?t[r].concat(n[r]):n[r]:t[r]=n[r]:t[r]?e(t[r],n[r]):t[r]=n[r]}),t},t.typeOf=a,t.copyDom=function(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,function(e){t.setAttribute(e.name,e.value)}),e.innerHTML&&(t.innerHTML=e.innerHTML),t}return""},t.attachEventListener=function(e,t,n,r){r?(e.on(t,n),function(e,t,n,r){e.once(r,function i(){e.off(t,n),e.off(r,i)})}(e,t,n,r)):e.on(t,function r(i){n(i),e.off(t,r)})},t.styleUtil=function(e,t,n){var r=e.style;try{r[t]=n}catch(e){r.setProperty(t,n)}},t.isNumber=function(e){return"number"==typeof e&&!Number.isNaN(e)},t.throttle=function(e,t){var n=this,r=0;return function(){for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];clearTimeout(r),r=setTimeout(function(){return e.apply(n,o)},t)}},t.hasOwnProperty=Object.prototype.hasOwnProperty},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(r=n(26))&&r.__esModule?r:{default:r},a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"setLogger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.logger=new o.default(e+".js")}}]),e}();t.default=a,e.exports=t.default},function(e,t,n){var r=n(18)();e.exports=function(e){return e!==r&&null!==e}},function(e,t,n){e.exports=function(e){return null!=e}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=(r=n(5))&&r.__esModule?r:{default:r};n(34),t.default=i.default,e.exports=t.default},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DanmuJs=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=f(n(6)),o=n(25),s=f(n(1)),u=f(n(27)),l=f(n(32)),c=n(33),d=n(0);function f(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":a(t))&&"function"!=typeof t?e:t}var h=t.DanmuJs=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=n;r.setLogger("danmu"),r.logger&&r.logger.info("danmu.js version: "+o.version);var a=r.config={overlap:!1,area:{start:0,end:1,lines:void 0},live:!1,comments:[],direction:"r2l",needResizeObserver:!1,dropStaleComments:!1,channelSize:void 0,maxCommentsLength:void 0,bulletOffset:void 0,interval:2e3};if((0,d.deepCopy)(a,e),(0,i.default)(r),r.hideArr=[],r.domObj=new l.default,r.freezeId=null,a.comments.forEach(function(e){e.duration=e.duration?e.duration:5e3,e.mode||(e.mode="scroll")}),r.container=a.container&&1===a.container.nodeType?a.container:null,!r.container)return r.emit("error","container id can't be empty"),p(n,!1);if(a.containerStyle){var s=a.containerStyle;Object.keys(s).forEach(function(e){r.container.style[e]=s[e]})}return r.live=a.live,r.player=a.player,r.direction=a.direction,(0,d.addClass)(r.container,"danmu"),r.bulletBtn=new u.default(r),r.main=r.bulletBtn.main,r.isReady=!0,r.emit("ready"),n.logger&&n.logger.info("ready"),n.addResizeObserver(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),r(t,[{key:"addResizeObserver",value:function(){var e=this;this.config.needResizeObserver&&(0,c.addObserver)(this.container,function(){e.logger&&e.logger.info("needResizeObserver"),e.resize()})}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this.main.start()}},{key:"pause",value:function(){this.logger&&this.logger.info("pause"),this.main.pause()}},{key:"play",value:function(){this.logger&&this.logger.info("play"),this.main.play()}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this.main.stop()}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.main.clear()}},{key:"destroy",value:function(){for(var e in(0,c.unObserver)(this.container),this.logger&&this.logger.info("destroy"),this.stop(),this.bulletBtn.destroy(),this.domObj.destroy(),this)delete this[e];this.emit("destroy")}},{key:"sendComment",value:function(e){this.logger&&this.logger.info("sendComment: "+(e.txt||"[DOM Element]")),e.duration||(e.duration=15e3),e&&e.id&&e.duration&&(e.el||e.txt)&&(e.duration=e.duration?e.duration:5e3,e.style||(e.style={opacity:void 0,fontSize:void 0}),e.style&&(this.opacity&&this.opacity!==e.style.opacity&&(e.style.opacity=this.opacity),this.fontSize&&this.fontSize!==e.style.fontSize&&(e.style.fontSize=this.fontSize)),e.prior||e.realTime?(this.main.data.unshift(e),e.realTime&&(this.main.readData(),this.main.dataHandle())):this.main.data.push(e))}},{key:"setCommentID",value:function(e,t){var n=this;this.logger&&this.logger.info("setCommentID: oldID "+e+" newID "+t),e&&t&&(this.main.data.some(function(n){return n.id===e&&(n.id=t,!0)}),this.main.queue.some(function(r){return r.id===e&&(r.id=t,r.pauseMove(),"paused"!==n.main.status&&r.startMove(),!0)}))}},{key:"setCommentDuration",value:function(e,t){var n=this;this.logger&&this.logger.info("setCommentDuration: id "+e+" duration "+t),e&&t&&(t=t||5e3,this.main.data.some(function(n){return n.id===e&&(n.duration=t,!0)}),this.main.queue.some(function(r){return r.id===e&&(r.duration=t,r.pauseMove(),"paused"!==n.main.status&&r.startMove(),!0)}))}},{key:"setCommentLike",value:function(e,t){this.logger&&this.logger.info("setCommentLike: id "+e+" like "+t),e&&t&&(this.main.data.some(function(n){return n.id===e&&(n.like=t,!0)}),this.main.queue.some(function(n){return n.id===e&&(n.pauseMove(),n.setLikeDom(t.el,t.style),"paused"!==n.danmu.main.status&&n.startMove(),!0)}))}},{key:"restartComment",value:function(e){if(this.logger&&this.logger.info("restartComment: id "+e),e){var t=this.main;if(this._releaseCtrl(e),"closed"===t.status)return;t.queue.some(function(n){return n.id===e&&("paused"!==t.status?n.startMove(!0):n.status="paused",!0)})}}},{key:"_releaseCtrl",value:function(e){this.freezeId&&e===this.freezeId&&(this.mouseControl=!1,this.freezeId=null)}},{key:"_freezeCtrl",value:function(e){this.mouseControl=!0,this.freezeId=e}},{key:"freezeComment",value:function(e){this.logger&&this.logger.info("freezeComment: id "+e),e&&(this._freezeCtrl(e),this.main.queue.some(function(t){return t.id===e&&(t.status="forcedPause",t.pauseMove(),t.el&&t.el.style&&(0,d.styleUtil)(t.el,"zIndex",10),!0)}))}},{key:"removeComment",value:function(e){this.logger&&this.logger.info("removeComment: id "+e),e&&(this._releaseCtrl(e),this.main.queue.some(function(t){return t.id===e&&(t.remove(),!0)}),this.main.data=this.main.data.filter(function(t){return t.id!==e}))}},{key:"updateComments",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.config,r=this.main,i=this.player,o=[],a=0;if(this.logger&&this.logger.info("updateComments: "+e.length+", isClear "+t),"boolean"==typeof t&&t&&(r.data=[]),r.data=r.data.concat(e),r.sortData(),"number"==typeof n.maxCommentsLength&&r.data.length>n.maxCommentsLength){a=r.data.length-n.maxCommentsLength;for(var s,u=0;u<a;u++)(s=r.data[u]).prior&&!s.attached_&&o.push(r.data[u])}else if(n.dropStaleComments&&i&&i.currentTime){var l=Math.floor(1e3*i.currentTime)-n.interval;if(l>0)for(var c,d=0;d<r.data.length;d++)if((c=r.data[d]).prior&&!c.attached_&&o.push(r.data[d]),c.start>l){a=d;break}a>0&&(r.data.splice(0,a),r.data=o.concat(r.data))}}},{key:"willChange",value:function(){var e=this.container,t=this.main;e.style.willChange="opacity",t.willChanges.push("contents"),t.queue.forEach(function(e){e.willChange()})}},{key:"stopWillChange",value:function(){this.container.style.willChange="",this.main.willChanges.splice(0),this.main.queue.forEach(function(e){e.willChange()})}},{key:"setAllDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",t=this,n=arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.logger&&this.logger.info("setAllDuration: mode "+e+" duration "+n+" force "+r),n&&(n=n||5e3,r&&(this.main.forceDuration=n),this.main.data.forEach(function(t){e===t.mode&&(t.duration=n)}),this.main.queue.forEach(function(r){e===r.mode&&(r.duration=n,r.pauseMove(),"paused"!==t.main.status&&r.startMove())}))}},{key:"setPlayRate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",n=arguments[1];this.logger&&this.logger.info("setPlayRate: "+n),(0,d.isNumber)(n)&&n>0&&(this.main.playRate=n,this.main.queue.forEach(function(n){t===n.mode&&(n.pauseMove(),"paused"!==e.main.status&&n.startMove())}))}},{key:"setOpacity",value:function(e){this.logger&&this.logger.info("setOpacity: opacity "+e),this.container.style.opacity=e}},{key:"setFontSize",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{reflow:!0};this.logger&&this.logger.info("setFontSize: size "+e+" channelSize "+t),this.fontSize=e+"px",e&&(this.main.data.forEach(function(e){e.style&&(e.style.fontSize=n.fontSize)}),this.main.queue.forEach(function(e){e.options.style||(e.options.style={}),e.options.style.fontSize=n.fontSize,e.setFontSize(n.fontSize),t&&(e.top=e.channel_id[0]*t,e.topInit())})),t&&(this.config.channelSize=t,r.reflow&&this.main.channel.resizeSync())}},{key:"setArea",value:function(e){this.logger&&this.logger.info("setArea: area "+e),this.config.area=e,!1!==e.reflow&&this.main.channel.resizeSync()}},{key:"hide",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("hide: mode "+e),this.hideArr.indexOf(e)<0&&this.hideArr.push(e),this.main.queue.filter(function(t){return e===t.mode||"color"===e&&t.color}).forEach(function(e){return e.remove()})}},{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("show: mode "+e);var t=this.hideArr.indexOf(e);t>-1&&this.hideArr.splice(t,1)}},{key:"setDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"r2l";this.logger&&this.logger.info("setDirection: direction "+e),this.emit("changeDirection",e)}},{key:"resize",value:function(){this.logger&&this.logger.info("resize"),this.emit("channel_resize")}},{key:"status",get:function(){return this.main.status}},{key:"state",get:function(){var e=this.main;return{status:e.status,comments:e.data,bullets:e.queue}}},{key:"containerPos",get:function(){return this.main.channel.containerPos}}]),t}();t.default=h},function(e,t,n){var r,i,o,s,u,l,c,d=n(7),f=n(24),p=Function.prototype.apply,h=Function.prototype.call,g=Object.create,v=Object.defineProperty,m=Object.defineProperties,y=Object.prototype.hasOwnProperty,_={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var n,i;return f(t),i=this,r.call(this,e,n=function(){o.call(i,e,n),p.call(t,this,arguments)}),n.__eeOnceListener__=t,this},u={on:r=function(e,t){var n;return f(t),y.call(this,"__ee__")?n=this.__ee__:(n=_.value=g(null),v(this,"__ee__",_),_.value=null),n[e]?"object"==a(n[e])?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},once:i,off:o=function(e,t){var n,r,i,o;if(f(t),!y.call(this,"__ee__"))return this;if(!(n=this.__ee__)[e])return this;if("object"==a(r=n[e]))for(o=0;i=r[o];++o)i!==t&&i.__eeOnceListener__!==t||(2===r.length?n[e]=r[o?0:1]:r.splice(o,1));else r!==t&&r.__eeOnceListener__!==t||delete n[e];return this},emit:s=function(e){var t,n,r,i,o;if(y.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==(void 0===i?"undefined":a(i))){for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];for(i=i.slice(),t=0;r=i[t];++t)p.call(r,this,o)}else switch(arguments.length){case 1:h.call(i,this);break;case 2:h.call(i,this,arguments[1]);break;case 3:h.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];p.call(i,this,o)}}},l={on:d(r),once:d(i),off:d(o),emit:d(s)},c=m({},l),e.exports=t=function(e){return null==e?g(c):m(Object(e),l)},t.methods=u},function(e,t,n){var r=n(3),i=n(8),o=n(12),a=n(20),s=n(21);(e.exports=function(e,t){var n,i,u,l,c;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],r(e)?(n=s.call(e,"c"),i=s.call(e,"e"),u=s.call(e,"w")):(n=u=!0,i=!1),c={value:t,configurable:n,enumerable:i,writable:u},l?o(a(l),c):c}).gs=function(e,t,n){var u,l,c,d;return"string"!=typeof e?(c=n,n=t,t=e,e=null):c=arguments[3],r(t)?i(t)?r(n)?i(n)||(c=n,n=void 0):n=void 0:(c=t,t=n=void 0):t=void 0,r(e)?(u=s.call(e,"c"),l=s.call(e,"e")):(u=!0,l=!1),d={get:t,set:n,configurable:u,enumerable:l},c?o(a(c),d):d}},function(e,t,n){var r=n(9),i=/^\s*class[\s{/}]/,o=Function.prototype.toString;e.exports=function(e){return!!r(e)&&!i.test(o.call(e))}},function(e,t,n){var r=n(10);e.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(e){return!1}return!r(e)}},function(e,t,n){var r=n(11);e.exports=function(e){if(!r(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(e){return!1}}},function(e,t,n){var r=n(3),i={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!r(e)&&hasOwnProperty.call(i,void 0===e?"undefined":a(e))}},function(e,t,n){e.exports=n(13)()?Object.assign:n(14)},function(e,t,n){e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,n){var r=n(15),i=n(19),o=Math.max;e.exports=function(e,t){var n,a,s,u=o(arguments.length,2);for(e=Object(i(e)),s=function(r){try{e[r]=t[r]}catch(e){n||(n=e)}},a=1;a<u;++a)r(t=arguments[a]).forEach(s);if(void 0!==n)throw n;return e}},function(e,t,n){e.exports=n(16)()?Object.keys:n(17)},function(e,t,n){e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,n){var r=n(2),i=Object.keys;e.exports=function(e){return i(r(e)?Object(e):e)}},function(e,t,n){e.exports=function(){}},function(e,t,n){var r=n(2);e.exports=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,n){var r=n(2),i=Array.prototype.forEach,o=Object.create;e.exports=function(e){var t=o(null);return i.call(arguments,function(e){r(e)&&function(e,t){var n;for(n in e)t[n]=e[n]}(Object(e),t)}),t}},function(e,t,n){e.exports=n(22)()?String.prototype.contains:n(23)},function(e,t,n){var r="razdwatrzy";e.exports=function(){return"function"==typeof r.contains&&!0===r.contains("dwa")&&!1===r.contains("foo")}},function(e,t,n){var r=String.prototype.indexOf;e.exports=function(e){return r.call(this,e,arguments[1])>-1}},function(e,t,n){e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e){e.exports=JSON.parse('{"version":"1.1.2"}')},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="undefined"!=typeof window&&window.location.href.indexOf("danmu-debug")>-1,o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.constructorName=t||""}return r(e,[{key:"info",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];i&&(t=console).log.apply(t,["[Danmu Log]["+this.constructorName+"]",e].concat(r))}}]),e}();t.default=o,e.exports=t.default},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=u(n(1)),o=u(n(28)),s=n(0);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":a(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setLogger("control"),n.danmu=e,n.main=new o.default(e),e.config.defaultOff||n.main.start(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),r(t,[{key:"createSwitch",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.logger&&this.logger.info("createSwitch"),this.switchBtn=(0,s.createDom)("dk-switch",'<span class="txt">弹</span>',{},"danmu-switch "+(e?"danmu-switch-active":"")),this.switchBtn}},{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this.main.destroy(),this)s.hasOwnProperty.call(this,e)&&delete this[e]}}]),t}();t.default=l,e.exports=t.default},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=l(n(1)),o=l(n(29)),s=l(n(30)),u=n(0);function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":a(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.setLogger("main"),n.danmu=e,n.container=e.container,n.channel=new s.default(e),n.data=[].concat(e.config.comments),n.playedData=[],n.queue=[],n.timer=null,n.playRate=1,n.retryStatus="normal",n.interval=e.config.interval,n.willChanges=[],n._status="idle",(0,u.attachEventListener)(e,"bullet_remove",n.updateQueue.bind(n),"destroy"),(0,u.attachEventListener)(e,"changeDirection",function(e){n.danmu.direction=e},"destroy"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),r(t,[{key:"_cancelDataHandleTimer",value:function(){this.handleId&&(clearTimeout(this.handleId),this.handleId=null),this.handleTimer&&(clearTimeout(this.handleTimer),this.handleTimer=null)}},{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this._cancelDataHandleTimer(),this.channel.destroy(),this.data=[],this)delete this[e]}},{key:"updateQueue",value:function(e){this.logger&&this.logger.info("updateQueue");var t=this;t.queue.some(function(n,r){return n.id===e.bullet.id&&(t.queue.splice(r,1),!0)}),t.data.some(function(t){return t.id===e.bullet.id&&(t.attached_=!1,!0)})}},{key:"init",value:function(){var e=this;e.logger&&e.logger.info("init"),e.retryStatus="normal",e.sortData(),function t(){"closed"!==e._status||"stop"!==e.retryStatus?("playing"===e._status&&(e.readData(),e.dataHandle()),"stop"===e.retryStatus&&"paused"!==e._status||(e.handleTimer=setTimeout(function(){e.handleId=requestAnimationFrame(function(){t()})},250))):e._cancelDataHandleTimer()}()}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this._status="playing",this.queue=[],this.container.innerHTML="",this.channel.reset(),this.init()}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this._status="closed",this.retryStatus="stop",this.queue=[],this.container.innerHTML="",this.channel.reset()}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.channel.reset(),this.data=[],this.queue=[],this.container.innerHTML=""}},{key:"play",value:function(){var e=this;if("closed"!==this._status){this.logger&&this.logger.info("play"),this._status="playing";var t=this.channel.channels;t&&t.length>0&&["scroll","top","bottom"].forEach(function(n){e.queue.forEach(function(e){e.startMove(),e.resized=!0});for(var r=0;r<t.length;r++)t[r].queue[n].forEach(function(e){e.resized=!1})})}else this.logger&&this.logger.info("play ignored")}},{key:"pause",value:function(){if("closed"!==this._status){this.logger&&this.logger.info("pause"),this._status="paused";var e=this.channel.channels;e&&e.length>0&&this.queue.forEach(function(e){e.pauseMove()})}else this.logger&&this.logger.info("pause ignored")}},{key:"dataHandle",value:function(){"paused"!==this._status&&"closed"!==this._status&&this.queue.length&&this.queue.forEach(function(e){"waiting"===e.status&&e.startMove()})}},{key:"readData",value:function(){if(this.danmu.isReady){var e=this,t=this.danmu,n=t.player,r=e.interval,i=e.channel,a=void 0,s=void 0;if(n){var l=n.currentTime?Math.floor(1e3*n.currentTime):0;s=e.data.filter(function(t){return!t.start&&e.danmu.hideArr.indexOf(t.mode)<0&&(!t.color||e.danmu.hideArr.indexOf("color")<0)&&(t.start=l),!t.attached_&&e.danmu.hideArr.indexOf(t.mode)<0&&(!t.color||e.danmu.hideArr.indexOf("color")<0)&&t.start-r<=l&&l<=t.start+r}),t.live&&(e.data=[])}else 0===(s=e.data.splice(0,1)).length&&(s=e.playedData.splice(0,1));if(s.length>0){i.updatePos();var c=2;e:for(var d,f=0;f<s.length;f++)if(d=s[f],e.forceDuration&&e.forceDuration!==d.duration&&(d.duration=e.forceDuration),(a=new o.default(t,d))&&!a.bulletCreateFail)if(a.attach(),d.attached_=!0,i.addBullet(a).result)e.queue.push(a),a.topInit(),c=2;else{for(var p in a.detach(),a)u.hasOwnProperty.call(a,p)&&delete a[p];if(a=null,d.attached_=!1,d.noDiscard&&(d.prior?e.data.unshift(d):e.data.push(d)),0===c)break e;c--}else{if(0===c)break e;c--}}}}},{key:"sortData",value:function(){this.data.sort(function(e,t){return(e.start||-1)-(t.start||-1)})}},{key:"status",get:function(){return this._status}}]),t}();t.default=c,e.exports=t.default},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Bullet=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(r=n(1))&&r.__esModule?r:{default:r},s=n(0);function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":a(t))&&"function"!=typeof t?e:t}var l=t.Bullet=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=r,o=void 0;if(r.setLogger("bullet"),r.danmu=e,r.options=n,r.duration=n.duration,r.id=n.id,r.container=e.container,r.start=n.start,r.prior=n.prior,r.realTime=n.realTime,r.color=n.color,r.bookChannelId=n.bookChannelId,r.direction=e.direction,r.reuseDOM=!0,r.willChanges=[],r.domObj=e.domObj,n.el&&1===n.el.nodeType){if(n.el.parentNode)return u(r,{bulletCreateFail:!0});if(e.config.disableCopyDOM)o=n.el,r.reuseDOM=!1;else{o=r.domObj.use();var a=(0,s.copyDom)(n.el);n.eventListeners&&n.eventListeners.length>0&&n.eventListeners.forEach(function(e){a.addEventListener(e.event,e.listener,e.useCapture||!1)}),o.appendChild(a)}}else(o=r.domObj.use()).textContent=n.txt;if(r.onChangeDirection=function(e){i.direction=e},r.danmu.on("changeDirection",r.onChangeDirection),n.style){var l=n.style;Object.keys(l).forEach(function(e){(0,s.styleUtil)(o,e,l[e])})}"top"===n.mode||"bottom"===n.mode?r.mode=n.mode:r.mode="scroll",r.el=o,n.like&&n.like.el&&r.setLikeDom(n.like.el,n.like.style),r.status="waiting";var c=void 0;if((0,s.isNumber)(e.config.bulletOffset)&&e.config.bulletOffset>=0)c=e.config.bulletOffset;else{var d=e.containerPos;c=d.width/10>100?100:d.width/10}var f=n.realTime?0:Math.floor(Math.random()*c);return r.updateOffset(f),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"updateOffset",value:function(e){this.random=e,(0,s.styleUtil)(this.el,"left",this.danmu.containerPos.width+e+"px")}},{key:"attach",value:function(){var e=this.el;this.container.appendChild(e),this.elPos=e.getBoundingClientRect(),"b2t"===this.direction?(this.width=this.elPos.height,this.height=this.elPos.width):(this.width=this.elPos.width,this.height=this.elPos.height),this.moveV&&(this.duration=(this.danmu.containerPos.width+this.random+this.width)/this.moveV*1e3),this.danmu.config&&(this.danmu.config.mouseControl&&(this.mouseoverFunWrapper=this.mouseoverFun.bind(this),e.addEventListener("mouseover",this.mouseoverFunWrapper,!1)),this.danmu.config.mouseEnterControl&&(this.mouseEnterFunWrapper=this.mouseoverFun.bind(this),e.addEventListener("mouseenter",this.mouseEnterFunWrapper,!1))),e.addEventListener("transitionend",this._onTransitionEnd,!1)}},{key:"detach",value:function(){var e=this.el;if(e){var t=this.danmu.config;t&&(t.mouseControl&&e.removeEventListener("mouseover",this.mouseoverFunWrapper,!1),t.mouseEnterControl&&e.removeEventListener("mouseenter",this.mouseEnterFunWrapper,!1)),e.removeEventListener("transitionend",this._onTransitionEnd,!1),e.parentNode&&e.parentNode.removeChild(e),this.reuseDOM&&this.domObj.unused(e),this.el=null}this.elPos=void 0,this.danmu.off("changeDirection",this.onChangeDirection)}},{key:"willChange",value:function(){var e=this.danmu.main.willChanges.concat(this.willChanges).join();(0,s.styleUtil)(this.el,"willChange",e)}},{key:"mouseoverFun",value:function(e){this.danmu&&this.danmu.mouseControl&&this.danmu.config.mouseControlPause||"waiting"===this.status||"end"===this.status||this.danmu&&this.danmu.emit("bullet_hover",{bullet:this,event:e})}},{key:"_onTransitionEnd",value:function(){this.status="end",this.remove()}},{key:"topInit",value:function(){this.logger&&this.logger.info("topInit #"+(this.options.txt||"[DOM Element]")+"#"),"b2t"===this.direction?((0,s.styleUtil)(this.el,"transformOrigin","left top"),(0,s.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+this.danmu.containerPos.height+"px) translateZ(0px) rotate(90deg)"),(0,s.styleUtil)(this.el,"transition","transform 0s linear 0s")):(0,s.styleUtil)(this.el,"top",this.top+"px")}},{key:"pauseMove",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;if("paused"!==t.status&&("forcedPause"!==t.status&&(this.status="paused"),t._moveV=void 0,this.el))if(this.willChange(),"scroll"===this.mode){var n=t.danmu.containerPos;if(e){var r,i=((new Date).getTime()-t.moveTime)/1e3*this.moveV;r=t.moveMoreS-i>=0?"b2t"===this.direction?(t.moveMoreS-i)/t.moveContainerHeight*n.height:(t.moveMoreS-i)/t.moveContainerWidth*n.width:t.moveMoreS-i,"b2t"===this.direction?(0,s.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+r+"px) translateZ(0px) rotate(90deg)"):(0,s.styleUtil)(this.el,"left",r+"px")}else"b2t"===this.direction?(0,s.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+(this.el.getBoundingClientRect().top-n.top)+"px) translateZ(0px) rotate(90deg)"):(0,s.styleUtil)(this.el,"left",this.el.getBoundingClientRect().left-n.left+"px");"b2t"===this.direction||(0,s.styleUtil)(this.el,"transform","translateX(0px) translateY(0px) translateZ(0px)"),(0,s.styleUtil)(this.el,"transition","transform 0s linear 0s")}else this.pastDuration&&this.startTime?this.pastDuration=this.pastDuration+(new Date).getTime()-this.startTime:this.pastDuration=1}},{key:"startMove",value:function(e){if(this.hasMove||(this.danmu.emit("bullet_start",this),this.hasMove=!0),("forcedPause"!==this.status||e)&&this.el&&"start"!==this.status)if(this.status="start",this.willChanges=["transform","transition"],this.willChange(),(0,s.styleUtil)(this.el,"backface-visibility","hidden"),(0,s.styleUtil)(this.el,"perspective","500em"),"scroll"===this.mode){var t=this.danmu.containerPos;if("b2t"===this.direction){var n=(this.el.getBoundingClientRect().bottom-t.top)/this.moveV;(0,s.styleUtil)(this.el,"transition","transform "+n+"s linear 0s"),(0,s.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY(-"+this.height+"px) translateZ(0px) rotate(90deg)"),this.moveTime=(new Date).getTime(),this.moveMoreS=this.el.getBoundingClientRect().top-t.top,this.moveContainerHeight=t.height}else{if(!this.el)return;var r=this.el.getBoundingClientRect(),i=r.right-t.left,o=i/this.moveV;r.right>t.left?((0,s.styleUtil)(this.el,"transition","transform "+o+"s linear 0s"),(0,s.styleUtil)(this.el,"transform","translateX(-"+i+"px) translateY(0px) translateZ(0px)"),this.moveTime=(new Date).getTime(),this.moveMoreS=r.left-t.left,this.moveContainerWidth=t.width):(this.status="end",this.remove())}}else{var a=(new Date).getTime(),u=(this.startTime&&a-this.startTime>this.duration?a-this.startTime:this.duration)/1e3;(0,s.styleUtil)(this.el,"left","50%"),(0,s.styleUtil)(this.el,"margin","0 0 0 -"+this.width/2+"px"),(0,s.styleUtil)(this.el,"visibility","hidden"),(0,s.styleUtil)(this.el,"transition","visibility "+u+"s 0s"),this.pastDuration||(this.pastDuration=1),this.startTime=a}}},{key:"remove",value:function(){this.logger&&this.logger.info("remove #"+(this.options.txt||"[DOM Element]")+"#"),this.pauseMove(),this.el&&this.el.parentNode&&(this.willChanges=[],this.willChange(),this.detach(),this.options.el&&1===this.options.el.nodeType&&this.danmu.config.disableCopyDOM&&(0,s.styleUtil)(this.options.el,"transform","none"),this.danmu.emit("bullet_remove",{bullet:this}))}},{key:"setFontSize",value:function(e){this.el&&(this.el.style.fontSize=e)}},{key:"setLikeDom",value:function(e,t){if(e&&(Object.keys(t).forEach(function(n){e.style[n]=t[n]}),e.className="danmu-like",this.el)){var n=this.el.querySelector(".danmu-like");n&&this.el.removeChild(n),this.el.innerHTML=""+this.el.innerHTML+e.outerHTML}return e}},{key:"moveV",get:function(){var e=this._moveV;if(!e){if(this.options.moveV)e=this.options.moveV;else if(this.elPos){var t=this.danmu.containerPos;e=("b2t"===this.direction?t.height+this.height:t.width+this.width)/this.duration*1e3}e&&(e*=this.danmu.main.playRate,this._moveV=e)}return e}}]),t}();t.default=l},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(r=n(1))&&r.__esModule?r:{default:r},s=n(0),u=n(31),l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":a(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=n;return r.setLogger("channel"),r.danmu=e,r.reset(!0),r.direction=e.direction,r.channels=[],r.updatePos(),(0,s.attachEventListener)(n.danmu,"bullet_remove",function(e){r.removeBullet(e.bullet)},"destroy"),(0,s.attachEventListener)(n.danmu,"changeDirection",function(e){r.direction=e},"destroy"),(0,s.attachEventListener)(n.danmu,"channel_resize",function(){r.resize()},"destroy"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"updatePos",value:function(){var e=this.container.getBoundingClientRect();this.containerPos=e,this.containerWidth=e.width,this.containerHeight=e.height,this.containerTop=e.top,this.containerBottom=e.bottom,this.containerLeft=e.left,this.containerRight=e.right}},{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this.channels.splice(0,this.channels.length),this._cancelResizeTimer(),this)s.hasOwnProperty.call(this,e)&&delete this[e]}},{key:"addBullet",value:function(e){var t=this,n=this.danmu,r=this.channels,i=void 0,o=void 0,a=void 0;if("b2t"===t.direction?(o=this.channelWidth,a=Math.ceil(e.width/o)):(i=this.channelHeight,a=Math.ceil(e.height/i)),a>r.length)return{result:!1,message:"exceed channels.length, occupy="+a+",channelsSize="+r.length};for(var s=!0,u=void 0,l=-1,c=0,d=r.length;c<d;c++)if(r[c].queue[e.mode].some(function(t){return t.id===e.id}))return{result:!1,message:"exited, channelOrder="+c+",danmu_id="+e.id};if("scroll"===e.mode)for(var f=0,p=r.length-a;f<=p;f++){s=!0;for(var h=f;h<f+a;h++){if((u=r[h]).operating.scroll){s=!1;break}if(u.bookId.scroll&&u.bookId.scroll!==e.id){s=!1;break}u.operating.scroll=!0;var g=u.queue.scroll[0];if(g){var v=g.el.getBoundingClientRect();if("b2t"===t.direction){if(v.bottom>=t.containerPos.bottom){s=!1,u.operating.scroll=!1;break}}else if(v.right>=t.containerPos.right){s=!1,u.operating.scroll=!1;break}var m=void 0,y=g.moveV,_=void 0,b=e.moveV,S=void 0;if("b2t"===t.direction?(_=(m=v.bottom-t.containerTop)/y,S=t.containerHeight+e.random-m):(_=(m=v.right-t.containerLeft)/y,S=t.containerWidth+e.random-m),b>y){var k=S/(b-y);if(n.config.bOffset||(n.config.bOffset=0),_+n.config.bOffset>=k){var w=_*b-t.containerPos.width;w>0&&e.updateOffset(w+(1+Math.ceil(5*Math.random())))}}}u.operating.scroll=!1}if(s){l=f;break}}else if("top"===e.mode)for(var E=0,T=r.length-a;E<=T;E++){s=!0;for(var x=E;x<E+a;x++){if(x>Math.floor(r.length/2)){s=!1;break}if((u=r[x]).operating[e.mode]){s=!1;break}if((u.bookId[e.mode]||e.prior)&&u.bookId[e.mode]!==e.id){s=!1;break}if(u.operating[e.mode]=!0,u.queue[e.mode].length>0){s=!1,u.operating[e.mode]=!1;break}u.operating[e.mode]=!1}if(s){l=E;break}}else if("bottom"===e.mode)for(var C=r.length-a;C>=0;C--){s=!0;for(var I=C;I<C+a;I++){if(I<=Math.floor(r.length/2)){s=!1;break}if((u=r[I]).operating[e.mode]){s=!1;break}if((u.bookId[e.mode]||e.prior)&&u.bookId[e.mode]!==e.id){s=!1;break}if(u.operating[e.mode]=!0,u.queue[e.mode].length>0){s=!1,u.operating[e.mode]=!1;break}u.operating[e.mode]=!1}if(s){l=C;break}}if(-1!==l){for(var R=l,A=l+a;R<A;R++)(u=r[R]).operating[e.mode]=!0,u.queue[e.mode].unshift(e),e.prior&&(delete u.bookId[e.mode],t.logger&&t.logger.info(R+"号轨道恢复正常使用")),u.operating[e.mode]=!1;return e.prior&&(t.logger&&t.logger.info(e.id+"号优先弹幕运行完毕"),delete e.bookChannelId,n.player&&n.bulletBtn.main.data.some(function(t){return t.id===e.id&&(delete t.bookChannelId,!0)})),e.channel_id=[l,a],"b2t"===t.direction?(e.top=l*o,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerWidth*t.danmu.config.area.start)):(e.top=l*i,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerHeight*t.danmu.config.area.start)),{result:e,message:"success"}}if(e.options.realTime){var O=0,M=-1,D=null;if(t.danmu.bulletBtn.main.queue.forEach(function(e,n){!e.prior&&!e.options.realTime&&e.el&&e.el.getBoundingClientRect().left>t.containerPos.right&&e.start>=O&&(O=e.start,M=n,D=e)}),D){D.remove(),t.removeBullet(D),t.danmu.bulletBtn.main.queue.splice(M,1),e.channel_id=D.channel_id;for(var L=D.channel_id[0],P=D.channel_id[0]+D.channel_id[1];L<P;L++)(u=r[L]).operating[e.mode]=!0,u.queue[e.mode].unshift(e),e.prior&&delete u.bookId[e.mode],u.operating[e.mode]=!1;return e.top=D.top,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerHeight*t.danmu.config.area.start),{result:e,message:"success"}}}if(e.prior)if(e.bookChannelId||t.danmu.live)n.player&&n.bulletBtn.main.data.some(function(n){return n.id===e.id&&(t.logger&&t.logger.info(e.id+"号优先弹幕将于2秒后再次请求注册"),n.start+=2e3,!0)});else{l=-1;for(var N=0,U=r.length-a;N<=U;N++){s=!0;for(var F=N;F<N+a;F++)if(r[F].bookId[e.mode]){s=!1;break}if(s){l=N;break}}if(-1!==l){for(var j=l;j<l+a;j++)r[j].bookId[e.mode]=e.id,t.logger&&t.logger.info(j+"号轨道被"+e.id+"号优先弹幕预定");n.player&&n.bulletBtn.main.data.some(function(n){return n.id===e.id&&(t.logger&&t.logger.info(e.id+"号优先弹幕将于2秒后再次请求注册"),n.start+=2e3,n.bookChannelId=[l,a],t.logger&&t.logger.info(e.id+"号优先弹幕预定了"+l+"~"+(l+a-1)+"号轨道"),!0)})}}return{result:!1,message:"no surplus will right"}}},{key:"removeBullet",value:function(e){this.logger&&this.logger.info("removeBullet "+(e.options.txt||"[DOM Element]"));for(var t=this.channels,n=e.channel_id,r=void 0,i=n[0],o=n[0]+n[1];i<o;i++)if(r=t[i]){r.operating[e.mode]=!0;var a=-1;r.queue[e.mode].some(function(t,n){return t.id===e.id&&(a=n,!0)}),a>-1&&r.queue[e.mode].splice(a,1),r.operating[e.mode]=!1}e.options.loop&&this.danmu.bulletBtn.main.playedData.push(e.options)}},{key:"resizeSync",value:function(){this.resize(!0)}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger&&this.logger.info("resize");var t=this;function n(){var e=t.danmu,n=e.container,r=e.config,i=e.bulletBtn,o=void 0;if(t.updatePos(),t._cancelResizeTimer(),i.main.data&&i.main.data.forEach(function(e){e.bookChannelId&&(delete e.bookChannelId,t.logger&&t.logger.info("resize导致"+e.id+"号优先弹幕预定取消"))}),t.logger&&t.logger.info("resize导致所有轨道恢复正常使用"),t.width=t.containerWidth,t.height=t.containerHeight,r.area){var a=r.area,l=a.lines,c=a.start,d=a.end;(0,u.validAreaLineRule)(l)?o=l:c>=0&&d>=c&&("b2t"===t.direction?t.width=t.width*(d-c):t.height=t.height*(d-c))}t.container=n;var f=r.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12);(0,s.isNumber)(o)||(o="b2t"===t.direction?Math.floor(t.width/f):Math.floor(t.height/f));for(var p=[],h=0;h<o;h++)p[h]={id:h,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};if(t.channels&&t.channels.length<=p.length){for(var g=function(e){p[e]={id:e,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top"].forEach(function(n){t.channels[e].queue[n].forEach(function(t){t.el&&p[e].queue[n].push(t)})}),t.channels[e].queue.bottom.forEach(function(n){if(n.el&&(p[e+p.length-t.channels.length].queue.bottom.push(n),n.channel_id[0]+n.channel_id[1]-1===e)){var r=[].concat(n.channel_id);n.channel_id=[r[0]-t.channels.length+p.length,r[1]],n.top=n.channel_id[0]*f,t.danmu.config.area&&t.danmu.config.area.start&&(n.top+=t.containerHeight*t.danmu.config.area.start),n.topInit()}})},v=0;v<t.channels.length;v++)g(v);for(var m=function(e){["scroll","top","bottom"].forEach(function(t){p[e].queue[t].forEach(function(e){e.resized=!1})})},y=0;y<p.length;y++)m(y);t.channels=p,"b2t"===t.direction?t.channelWidth=f:t.channelHeight=f}else if(t.channels&&t.channels.length>p.length){for(var _=function(e){p[e]={id:e,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top","bottom"].forEach(function(n){if("top"===n&&e>Math.floor(p.length/2));else if("bottom"===n&&e<=Math.floor(p.length/2));else{var r="bottom"===n?e-p.length+t.channels.length:e;t.channels[r].queue[n].forEach(function(i,o){if(i.el&&(p[e].queue[n].push(i),"bottom"===n&&i.channel_id[0]+i.channel_id[1]-1===r)){var a=[].concat(i.channel_id);i.channel_id=[a[0]-t.channels.length+p.length,a[1]],i.top=i.channel_id[0]*f,t.danmu.config.area&&t.danmu.config.area.start&&(i.top+=t.containerHeight*t.danmu.config.area.start),i.topInit()}t.channels[r].queue[n].splice(o,1)})}})},b=0;b<p.length;b++)_(b);for(var S=function(e){["scroll","top","bottom"].forEach(function(t){p[e].queue[t].forEach(function(e){e.resized=!1})})},k=0;k<p.length;k++)S(k);t.channels=p,"b2t"===t.direction?t.channelWidth=f:t.channelHeight=f}t.resizing=!1}t.resizing||(t.resizing=!0,e?n():(this._cancelResizeTimer(),this.resizeId=requestAnimationFrame(n)))}},{key:"_cancelResizeTimer",value:function(){this.resizeId&&(cancelAnimationFrame(this.resizeId),this.resizeId=null)}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger&&this.logger.info("reset");var t=this,n=t.danmu,r=n.container,i=n.bulletBtn,o=n.config;function a(){var e=void 0,n=r.getBoundingClientRect();if(t.width=n.width,t.height=n.height,t.resetId&&(cancelAnimationFrame(t.resetId),t.resetId=null),o.area){var i=o.area,a=i.lines,l=i.start,c=i.end;(0,u.validAreaLineRule)(a)?e=a:l>=0&&c>=l&&("b2t"===t.direction?t.width=t.width*(c-l):t.height=t.height*(c-l))}var d=o.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12);(0,s.isNumber)(e)||(e="b2t"===t.direction?Math.floor(t.width/d):Math.floor(t.height/d));for(var f=[],p=0;p<e;p++)f[p]={id:p,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};t.channels=f,"b2t"===t.direction?t.channelWidth=d:t.channelHeight=d}t.container=r,i&&i.main&&i.main.queue.forEach(function(e){e.remove()}),t.channels&&t.channels.length>0&&["scroll","top","bottom"].forEach(function(e){for(var n=0;n<t.channels.length;n++)t.channels[n].queue[e].forEach(function(e){e.remove()})}),i&&i.main&&i.main.data&&i.main.data.forEach(function(e){e.attached_=!1}),e?this.resetId=requestAnimationFrame(a):a()}}]),t}();t.default=l,e.exports=t.default},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.validAreaLineRule=function(e){return"number"==typeof e&&e>=0&&Number.isInteger(e)}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t={initDOM:function(){return document.createElement("div")},initSize:10},this.init(t)}return r(e,[{key:"init",value:function(e){this.idleList=[],this.usingList=[],this._id=0,this.options=e,this._expand(e.initSize)}},{key:"use",value:function(){this.idleList.length||this._expand(1);var e=this.idleList.shift();return this.usingList.push(e),e}},{key:"unused",value:function(e){var t=this.usingList.indexOf(e);t<0||(this.usingList.splice(t,1),e.innerHTML="",e.textcontent="",this.clearElementStyle(e),this.idleList.push(e))}},{key:"_expand",value:function(e){for(var t=0;t<e;t++)this.idleList.push(this.options.initDOM(this._id++))}},{key:"destroy",value:function(){for(var e=0;e<this.idleList.length;e++)this.idleList[e].innerHTML="",this.idleList[e].textcontent="",this.clearElementStyle(this.idleList[e]);for(var t=0;t<this.usingList.length;t++)this.usingList[t].innerHTML="",this.usingList[t].textcontent="",this.clearElementStyle(this.usingList[t]);for(var n in this)i.hasOwnProperty.call(this,n)&&delete this[n]}},{key:"clearElementStyle",value:function(e){var t="undefined"!=typeof window?window.navigator.userAgent:null;t&&(t.indexOf("MSIE ")>-1||t.indexOf("Trident/")>-1?(0,i.styleUtil)(e,"transform","none"):e.setAttribute("style",""))}}]),e}();t.default=o,e.exports=t.default},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.destroyObserver=t.unObserver=t.addObserver=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0),o=new(function(){function e(){var t=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.__handlers=[],window.ResizeObserver)try{this.observer=new window.ResizeObserver((0,i.throttle)(function(e){t.__trigger(e)},100))}catch(e){}}return r(e,[{key:"addObserver",value:function(e,t){if(this.observer){this.observer&&this.observer.observe(e);for(var n=this.__handlers,r=-1,i=0;i<n.length;i++)n[i]&&e===n[i].target&&(r=i);r>-1?this.__handlers[r].handler.push(t):this.__handlers.push({target:e,handler:[t]})}}},{key:"unObserver",value:function(e){var t=-1;this.__handlers.map(function(n,r){e===n.target&&(t=r)}),this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e){for(var t=this.__handlers,n=0;n<t.length;n++)if(t[n]&&e===t[n].target){t[n].handler&&t[n].handler.map(function(e){try{e()}catch(e){console.error(e)}});break}}},{key:"__trigger",value:function(e){var t=this;e.map(function(e){t.__runHandler(e.target)})}}]),e}());t.addObserver=function(e,t){o.addObserver(e,t)},t.unObserver=function(e,t){o.unObserver(e,t)},t.destroyObserver=function(e,t){o.destroyObserver(e,t)}},function(e,t,n){var r=n(35);"string"==typeof r&&(r=[[e.i,r,""]]);n(37)(r,{hmr:!0,transform:void 0,insertInto:void 0}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(36)(!1)).push([e.i,".danmu{overflow:hidden;-webkit-user-select:none;-moz-user-select:none;user-select:none;-ms-user-select:none}.danmu>*{position:absolute;white-space:nowrap}.danmu-switch{width:32px;height:20px;border-radius:100px;background-color:#ccc;-webkit-box-sizing:border-box;box-sizing:border-box;outline:none;cursor:pointer;position:relative;text-align:center;margin:10px auto}.danmu-switch.danmu-switch-active{padding-left:12px;background-color:#f85959}.danmu-switch span.txt{width:20px;height:20px;line-height:20px;text-align:center;display:block;border-radius:100px;background-color:#fff;-webkit-box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);font-family:PingFangSC;font-size:10px;font-weight:500;color:#f44336}",""])},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n,r=e[1]||"",i=e[3];if(!i)return r;if(t&&"function"==typeof btoa){var o=(n=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */"),a=i.sources.map(function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"});return[r].concat(a).concat([o]).join("\n")}return[r].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(r[o]=!0)}for(i=0;i<e.length;i++){var a=e[i];"number"==typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},function(e,t,n){var r,i,o={},s=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=r.apply(this,arguments)),i}),u=function(e){var t={};return function(e){if("function"==typeof e)return e();if(void 0===t[e]){var n=function(e){return document.querySelector(e)}.call(this,e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),l=null,c=0,d=[],f=n(38);function p(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=o[r.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](r.parts[a]);for(;a<r.parts.length;a++)i.parts.push(_(r.parts[a],t))}else{var s=[];for(a=0;a<r.parts.length;a++)s.push(_(r.parts[a],t));o[r.id]={id:r.id,refs:1,parts:s}}}}function h(e,t){for(var n=[],r={},i=0;i<e.length;i++){var o=e[i],a=t.base?o[0]+t.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};r[a]?r[a].parts.push(s):n.push(r[a]={id:a,parts:[s]})}return n}function g(e,t){var n=u(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=d[d.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),d.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=a(e.insertAt)||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=u(e.insertInto+" "+e.insertAt.before);n.insertBefore(t,i)}}function v(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function m(e){var t=document.createElement("style");return void 0===e.attrs.type&&(e.attrs.type="text/css"),y(t,e.attrs),g(e,t),t}function y(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function _(e,t){var n,r,i,o;if(t.transform&&e.css){if(!(o=t.transform(e.css)))return function(){};e.css=o}if(t.singleton){var a=c++;n=l||(l=m(t)),r=k.bind(null,n,a,!1),i=k.bind(null,n,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",y(t,e.attrs),g(e,t),t}(t),r=function(e,t,n){var r=n.css,i=n.sourceMap,o=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||o)&&(r=f(r)),i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var a=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,n,t),i=function(){v(n),n.href&&URL.revokeObjectURL(n.href)}):(n=m(t),r=function(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),i=function(){v(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=("undefined"==typeof document?"undefined":a(document)))throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==a(t.attrs)?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=h(e,t);return p(n,t),function(e){for(var r=[],i=0;i<n.length;i++){var a=n[i];(s=o[a.id]).refs--,r.push(s)}for(e&&p(h(e,t),t),i=0;i<r.length;i++){var s;if(0===(s=r[i]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete o[s.id]}}}};var b,S=(b=[],function(e,t){return b[e]=t,b.filter(Boolean).join("\n")});function k(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=S(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var i,o=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?e:(i=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:r+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}}])},"object"==a(t)&&"object"==a(e)?e.exports=o():(r=[],void 0===(i="function"==typeof(n=o)?n.apply(t,r):n)||(e.exports=i))}).call(this,n(135)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" width="40" height="40">\n  <path fill="#f85959" transform="scale(0.8 0.8)" d="M36.5,18.73a1.19,1.19,0,0,0,1-1.14V16.33a1.2,1.2,0,0,0-1-1.13l-.61-.08a1.75,1.75,0,0,1-1.3-.86l-.21-.36-.2-.36A1.72,1.72,0,0,1,34,12l.23-.58a1.18,1.18,0,0,0-.5-1.42l-1.1-.62a1.18,1.18,0,0,0-1.47.3l-.39.51a1.82,1.82,0,0,1-1.41.72c-.44,0-1.88-.27-2.22-.7l-.39-.49a1.18,1.18,0,0,0-1.48-.28l-1.09.64a1.19,1.19,0,0,0-.47,1.43l.25.59a1.87,1.87,0,0,1-.08,1.58c-.26.37-1.17,1.5-1.71,1.58l-.63.09a1.19,1.19,0,0,0-1,1.14l0,1.27a1.17,1.17,0,0,0,1,1.12l.61.08a1.74,1.74,0,0,1,1.3.87l.21.36.2.35A1.69,1.69,0,0,1,24,22.08l-.23.59a1.19,1.19,0,0,0,.5,1.42l1.1.62a1.19,1.19,0,0,0,1.48-.31l.38-.5a1.83,1.83,0,0,1,1.41-.72c.44,0,1.88.25,2.22.69l.39.49a1.18,1.18,0,0,0,1.48.28L33.86,24a1.19,1.19,0,0,0,.47-1.43L34.09,22a1.84,1.84,0,0,1,.07-1.58c.26-.37,1.17-1.5,1.72-1.58ZM31,18.94a2.76,2.76,0,0,1-4.65-1.2A2.71,2.71,0,0,1,27,15.13a2.76,2.76,0,0,1,4.64,1.2A2.7,2.7,0,0,1,31,18.94Z"/>\n  <path fill="#f85959" transform="scale(0.8 0.8)" d="M32,0H3.59A3.59,3.59,0,0,0,0,3.59v17A3.59,3.59,0,0,0,3.59,24.2H19.72a12.59,12.59,0,0,1-.81-1.2A11.73,11.73,0,0,1,35.54,7.28V3.59A3.59,3.59,0,0,0,32,0ZM13,14.18H4.29a1.52,1.52,0,0,1,0-3H13a1.52,1.52,0,0,1,0,3ZM16.45,8H4.29a1.51,1.51,0,0,1,0-3H16.45a1.51,1.51,0,1,1,0,3Z"/>\n</svg>\n'},function(e,t,n){var r=n(138);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .danmu-switch{-webkit-order:6;-moz-box-ordinal-group:7;order:6;z-index:26}.xgplayer-skin-default .xgplayer-danmu{display:none;position:absolute;top:0;left:0;right:0;height:100%;overflow:hidden;z-index:9;outline:none}.xgplayer-skin-default .xgplayer-danmu>*{position:absolute;white-space:nowrap;z-index:9}.xgplayer-skin-default .xgplayer-danmu.xgplayer-has-danmu{display:block}.xgplayer-skin-default .xgplayer-panel{outline:none;-webkit-order:7;-moz-box-ordinal-group:8;order:7;width:40px;height:40px;display:inline-block;position:relative;font-family:PingFangSC-Regular;font-size:13px;color:hsla(0,0%,100%,.8);z-index:36}.xgplayer-skin-default .xgplayer-panel .xgplayer-panel-icon{cursor:pointer;position:absolute;margin-left:5px;top:10px}.xgplayer-skin-default .xgplayer-panel-active{display:block!important;bottom:30px}.xgplayer-skin-default .xgplayer-panel-slider{z-index:36;display:none;position:absolute;width:230px;height:230px;background:rgba(0,0,0,.54);border-radius:1px;padding:10px 20px;outline:none;left:-115px;bottom:40px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-hidemode{padding-bottom:10px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-hidemode-radio li{display:inline;list-style:none;cursor:pointer}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-hidemode ul{display:-webkit-flex;display:-moz-box;display:flex;-webkit-justify-content:space-around;justify-content:space-around}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-hidemode li{margin:0 12px;font-size:11px;color:#aaa}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-hidemode-font{margin-bottom:10px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-transparency{display:block;margin-top:10px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-transparency .xgplayer-transparency-line{-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;outline:none;width:150px;height:4px;background:#aaa;border-radius:4px;border-style:none;margin-left:10px;margin-top:-2px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-transparency .xgplayer-transparency-line::-moz-focus-outer{border:0!important}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-transparency .xgplayer-transparency-color::-webkit-slider-runnable-track{outline:none;width:150px;height:4px;border-radius:4px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-transparency .xgplayer-transparency-color::-moz-range-track{outline:none;background-color:#aaa;border-color:transparent;cursor:pointer;width:150px;height:4px;border-radius:4px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-transparency .xgplayer-transparency-color::-ms-track{outline:none;background-color:#aaa;color:transparent;border-color:transparent;width:150px;height:4px;border-radius:4px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-transparency .xgplayer-transparency-bar::-webkit-slider-thumb{outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:6px solid #f85959;height:6px;width:6px;margin-top:-4px;border-radius:6px;cursor:pointer}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-transparency .xgplayer-transparency-bar::-moz-range-thumb{outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:6px solid #f85959;height:0;width:0;border-radius:6px;cursor:pointer}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-transparency .xgplayer-transparency-bar::-ms-thumb{outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:6px solid #f85959;height:6px;width:6px;border-radius:6px;cursor:pointer}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-transparency .xgplayer-transparency-bar::-moz-range-progress{outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;height:4px;border-radius:4px;background:linear-gradient(90deg,#f85959,#f85959 100%,#aaa)}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea{display:block;margin-top:8px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea-name{display:inline-block;position:relative;top:-10px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea-control{display:inline-block}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea-control-up{width:150px;margin-left:10px;display:-moz-box;display:-webkit-flex;display:flex;-webkit-justify-content:space-between;-moz-box-pack:justify;justify-content:space-between;color:#aaa}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea-control-down{position:relative;top:-10px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea-control-down-dots{display:-webkit-flex;display:-moz-box;display:flex;width:150px;margin-left:10px;-webkit-justify-content:space-between;-moz-box-pack:justify;justify-content:space-between}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea-threequarters,.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea-twoquarters{margin-left:-6px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea-full{margin-right:3px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea .xgplayer-showarea-line{-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;outline:none;width:150px;height:4px;background:#aaa;border-radius:4px;border-style:none;margin-left:10px;margin-top:-2px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea .xgplayer-showarea-line::-moz-focus-outer{border:0!important}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea .xgplayer-showarea-color::-webkit-slider-runnable-track{outline:none;width:150px;height:4px;border-radius:4px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea .xgplayer-showarea-color::-moz-range-track{outline:none;background-color:#aaa;border-color:transparent;cursor:pointer;width:150px;height:4px;border-radius:4px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea .xgplayer-showarea-color::-ms-track{outline:none;background-color:#aaa;color:transparent;border-color:transparent;width:150px;height:4px;border-radius:4px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea .xgplayer-showarea-bar::-webkit-slider-thumb{outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:6px solid #f85959;height:6px;width:6px;margin-top:-4px;border-radius:6px;cursor:pointer}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea .xgplayer-showarea-bar::-moz-range-thumb{outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:6px solid #f85959;height:0;width:0;border-radius:6px;cursor:pointer}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea .xgplayer-showarea-bar::-ms-thumb{outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:6px solid #f85959;height:6px;width:6px;border-radius:6px;cursor:pointer}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea .xgplayer-showarea-full-dot,.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea .xgplayer-showarea-onequarters-dot,.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea .xgplayer-showarea-threequarters-dot,.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea .xgplayer-showarea-twoquarters-dot,.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-showarea .xgplayer-showarea-zero-dot{width:3px;height:3px;border:3px solid #aaa;border-radius:50%;background-color:#aaa;position:relative;top:16px;z-index:-1}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed{display:block}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed-name{display:inline-block;position:relative;top:-10px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed-control{display:inline-block}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed-control-up{width:150px;margin-left:10px;display:-moz-box;display:-webkit-flex;display:flex;-webkit-justify-content:space-between;-moz-box-pack:justify;justify-content:space-between;color:#aaa}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed-control-down{position:relative;top:-10px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed-control-down-dots{display:-webkit-flex;display:-moz-box;display:flex;width:150px;margin-left:10px;-webkit-justify-content:space-between;-moz-box-pack:justify;justify-content:space-between}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed .xgplayer-danmuspeed-line{-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;outline:none;width:150px;height:4px;background:#aaa;border-radius:4px;border-style:none;margin-left:10px;margin-top:-2px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed .xgplayer-danmuspeed-line::-moz-focus-outer{border:0!important}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed .xgplayer-danmuspeed-color::-webkit-slider-runnable-track{outline:none;width:150px;height:4px;border-radius:4px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed .xgplayer-danmuspeed-color::-moz-range-track{outline:none;background-color:#aaa;border-color:transparent;cursor:pointer;width:150px;height:4px;border-radius:4px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed .xgplayer-danmuspeed-color::-ms-track{outline:none;background-color:#aaa;color:transparent;border-color:transparent;width:150px;height:4px;border-radius:4px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed .xgplayer-danmuspeed-bar::-webkit-slider-thumb{outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:6px solid #f85959;height:6px;width:6px;margin-top:-4px;border-radius:6px;cursor:pointer}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed .xgplayer-danmuspeed-bar::-moz-range-thumb{outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:6px solid #f85959;height:0;width:0;border-radius:6px;cursor:pointer}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed .xgplayer-danmuspeed-bar::-ms-thumb{outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:6px solid #f85959;height:6px;width:6px;border-radius:6px;cursor:pointer}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed .xgplayer-danmuspeed-large-dot,.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed .xgplayer-danmuspeed-middle-dot,.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmuspeed .xgplayer-danmuspeed-small-dot{width:3px;height:3px;border:3px solid #aaa;border-radius:50%;background-color:#aaa;position:relative;top:16px;z-index:-1}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont{display:block}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont-name{display:inline-block;position:relative;top:-10px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont-control{display:inline-block}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont-control-up{width:150px;margin-left:10px;display:-moz-box;display:-webkit-flex;display:flex;-webkit-justify-content:space-between;-moz-box-pack:justify;justify-content:space-between;color:#aaa}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont-control-down{position:relative;top:-10px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont-control-down-dots{display:-webkit-flex;display:-moz-box;display:flex;width:150px;margin-left:10px;-webkit-justify-content:space-between;-moz-box-pack:justify;justify-content:space-between}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont .xgplayer-danmufont-line{-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;outline:none;width:150px;height:4px;background:#aaa;border-radius:4px;border-style:none;margin-left:10px;margin-top:-2px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont .xgplayer-danmufont-line::-moz-focus-outer{border:0!important}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont .xgplayer-danmufont-color::-webkit-slider-runnable-track{outline:none;width:150px;height:4px;border-radius:4px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont .xgplayer-danmufont-color::-moz-range-track{outline:none;background-color:#aaa;border-color:transparent;cursor:pointer;width:150px;height:4px;border-radius:4px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont .xgplayer-danmufont-color::-ms-track{outline:none;background-color:#aaa;color:transparent;border-color:transparent;width:150px;height:4px;border-radius:4px}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont .xgplayer-danmufont-bar::-webkit-slider-thumb{outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:6px solid #f85959;height:6px;width:6px;margin-top:-4px;border-radius:6px;cursor:pointer}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont .xgplayer-danmufont-bar::-moz-range-thumb{outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:6px solid #f85959;height:0;width:0;border-radius:6px;cursor:pointer}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont .xgplayer-danmufont-bar::-ms-thumb{outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:6px solid #f85959;height:6px;width:6px;border-radius:6px;cursor:pointer}.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont .xgplayer-danmufont-large-dot,.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont .xgplayer-danmufont-middle-dot,.xgplayer-skin-default .xgplayer-panel-slider .xgplayer-danmufont .xgplayer-danmufont-small-dot{width:3px;height:3px;border:3px solid #aaa;border-radius:50%;background-color:#aaa;position:relative;top:16px;z-index:-1}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(140);t.default={name:"s_pip",method:function(){var e=this;if(e.config.pip&&"function"==typeof e.video.requestPictureInPicture){var t=e.lang.PIP,n=(0,r.createDom)("xg-pip",'<p class="name"><span>'+t+"</span></p>",{tabindex:9},"xgplayer-pip");e.once("ready",function(){e.controls.appendChild(n)}),["click","touchend"].forEach(function(t){n.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("pipBtnClick")})})}}},e.exports=t.default},function(e,t,n){var r=n(141);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-pip{-webkit-order:9;-moz-box-ordinal-group:10;order:9;position:relative;outline:none;display:block;cursor:pointer;height:20px;top:10px}.xgplayer-skin-default .xgplayer-pip .name{text-align:center;font-family:PingFangSC-Regular;font-size:13px;line-height:20px;height:20px;color:hsla(0,0%,100%,.8)}.xgplayer-skin-default .xgplayer-pip .name span{width:60px;height:20px;line-height:20px;background:rgba(0,0,0,.38);border-radius:10px;display:inline-block;vertical-align:middle}.lang-is-jp .xgplayer-pip .name span{width:70px;height:20px}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(143);t.default={name:"s_miniplayer",method:function(){var e=this;if(e.config.miniplayer){var t=e.lang.MINIPLAYER,n=(0,r.createDom)("xg-miniplayer",'<p class="name"><span>'+t+"</span></p>",{tabindex:9},"xgplayer-miniplayer");e.once("ready",function(){e.controls.appendChild(n)}),["click","touchend"].forEach(function(t){n.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("miniplayerBtnClick")})})}}},e.exports=t.default},function(e,t,n){var r=n(144);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-miniplayer{-webkit-order:9;-moz-box-ordinal-group:10;order:9;position:relative;outline:none;display:block;cursor:pointer;height:20px;top:10px}.xgplayer-skin-default .xgplayer-miniplayer .name{text-align:center;font-family:PingFangSC-Regular;font-size:13px;line-height:20px;height:20px;color:hsla(0,0%,100%,.8)}.xgplayer-skin-default .xgplayer-miniplayer .name span{width:80px;height:20px;line-height:20px;background:rgba(0,0,0,.38);border-radius:10px;display:inline-block;vertical-align:middle}.xgplayer-skin-default .xgplayer-miniplayer-lay{position:absolute;top:26px;left:0;width:100%;height:100%;z-index:130;cursor:pointer;background-color:transparent;display:none}.xgplayer-skin-default .xgplayer-miniplayer-lay div{width:100%;height:100%}.xgplayer-skin-default .xgplayer-miniplayer-drag{cursor:move;position:absolute;top:0;left:0;width:100%;height:26px;line-height:26px;background-image:linear-gradient(rgba(0,0,0,.3),transparent);z-index:130;display:none}.xgplayer-skin-default .xgplayer-miniplayer-drag .drag-handle{width:100%}.xgplayer-skin-default.xgplayer-miniplayer-active{position:fixed;right:0;bottom:200px;width:320px;height:180px;z-index:110}.xgplayer-skin-default.xgplayer-miniplayer-active .xgplayer-controls,.xgplayer-skin-default.xgplayer-miniplayer-active .xgplayer-danmu{display:none}.xgplayer-skin-default.xgplayer-miniplayer-active .xgplayer-miniplayer-lay{display:block}.xgplayer-skin-default.xgplayer-miniplayer-active .xgplayer-miniplayer-drag{display:-webkit-flex;display:-moz-box;display:flex}.xgplayer-skin-default.xgplayer-inactive .xgplayer-miniplayer-drag{display:none}.lang-is-jp .xgplayer-miniplayer .name span{width:70px;height:20px}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(146),a=(r=o)&&r.__esModule?r:{default:r};n(147);t.default={name:"s_playNext",method:function(){var e=this,t=e.config.playNext;if(t&&t.urlList){var n=(0,i.createDom)("xg-playnext",'<xg-icon class="xgplayer-icon">'+a.default+"</xg-icon>",{},"xgplayer-playnext"),r=e.lang.PLAYNEXT_TIPS,o=(0,i.createDom)("xg-tips",'<span class="xgplayer-tip-playnext">'+r+"</span>",{},"xgplayer-tips");n.appendChild(o),e.once("ready",function(){e.controls.appendChild(n)}),["click","touchend"].forEach(function(t){n.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation(),(0,i.addClass)(e.root,"xgplayer-is-enter"),e.userGestureTrigEvent("playNextBtnClick")})});var s=function(){(0,i.addClass)(e.root,"xgplayer-playnext-inactive")};e.on("urlListEnd",s),e.once("destroy",function t(){e.off("urlListEnd",s),e.off("destroy",t)})}}},e.exports=t.default},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">\n  <path transform="scale(0.038 0.028)" d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z"></path>\n</svg>\n'},function(e,t,n){var r=n(148);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-playnext{position:relative;-webkit-order:1;-moz-box-ordinal-group:2;order:1;display:block;cursor:pointer;top:-2px}.xgplayer-skin-default .xgplayer-playnext .xgplayer-icon div{position:absolute}.xgplayer-skin-default .xgplayer-playnext .xgplayer-tips .xgplayer-tip-playnext{display:block}.xgplayer-skin-default .xgplayer-playnext:hover{opacity:.85}.xgplayer-skin-default .xgplayer-playnext:hover .xgplayer-tips{display:block}.xgplayer-lang-is-en .xgplayer-playnext .xgplayer-tips{margin-left:-25px}.xgplayer-lang-is-jp .xgplayer-playnext .xgplayer-tips{margin-left:-38px}.xgplayer-skin-default.xgplayer-playnext-inactive .xgplayer-playnext{display:none}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(150),a=(r=o)&&r.__esModule?r:{default:r};n(151);t.default={name:"s_rotate",method:function(){var e=this;if(e.config.rotate){var t=(0,i.createDom)("xg-rotate",'<xg-icon class="xgplayer-icon">'+a.default+"</xg-icon>",{},"xgplayer-rotate"),n=e.lang.ROTATE_TIPS,r=(0,i.createDom)("xg-tips",'<span class="xgplayer-tip-rotate">'+n+"</span>",{},"xgplayer-tips");t.appendChild(r),e.once("ready",function(){e.controls.appendChild(t)}),["click","touchend"].forEach(function(n){t.addEventListener(n,function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("rotateBtnClick")})})}}},e.exports=t.default},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 40 40" fill="none">\n  <g clip-path="url(#clip0)">\n    <path transform="scale(1.5 1.5)" d="M11.6665 9.16663H4.1665C2.78579 9.16663 1.6665 10.2859 1.6665 11.6666V15.8333C1.6665 17.214 2.78579 18.3333 4.1665 18.3333H11.6665C13.0472 18.3333 14.1665 17.214 14.1665 15.8333V11.6666C14.1665 10.2859 13.0472 9.16663 11.6665 9.16663Z" fill="white"/>\n    <path transform="scale(1.5 1.5)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88148 4.06298C3.75371 4.21005 3.67667 4.40231 3.67749 4.61242C3.67847 4.87253 3.79852 5.10435 3.98581 5.25646L6.99111 8.05895C7.32771 8.37283 7.85502 8.35443 8.16891 8.01782C8.48279 7.68122 8.46437 7.15391 8.12778 6.84003L6.62061 5.43457L9.8198 5.4224C9.82848 5.42239 9.8372 5.42221 9.84591 5.4219C10.9714 5.38233 12.0885 5.6285 13.0931 6.13744C14.0976 6.64635 14.957 7.40148 15.5908 8.33234C16.2246 9.2632 16.6122 10.3394 16.7177 11.4606C16.823 12.5819 16.6427 13.7115 16.1934 14.7442C16.0098 15.1661 16.203 15.6571 16.6251 15.8408C17.0471 16.0243 17.5381 15.8311 17.7216 15.4091C18.2833 14.1183 18.5087 12.7063 18.3771 11.3047C18.2453 9.90318 17.7607 8.55792 16.9684 7.39433C16.1761 6.23073 15.1021 5.28683 13.8463 4.65065C12.5946 4.01651 11.203 3.70872 9.80072 3.75583L6.43415 3.76862L7.96326 2.12885C8.27715 1.79225 8.25872 1.26494 7.92213 0.951061C7.58553 0.63718 7.05822 0.655585 6.74433 0.99219L3.90268 4.0395C3.89545 4.04724 3.88841 4.05509 3.88154 4.06303L3.88148 4.06298Z" fill="white"/>\n  </g>\n  <defs>\n    <clipPath id="clip0">\n      <rect width="40" height="40" fill="white"/>\n    </clipPath>\n  </defs>\n</svg>\n'},function(e,t,n){var r=n(152);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-rotate{position:relative;-webkit-order:10;-moz-box-ordinal-group:11;order:10;display:block;cursor:pointer}.xgplayer-skin-default .xgplayer-rotate .xgplayer-icon{margin-top:7px;width:26px}.xgplayer-skin-default .xgplayer-rotate .xgplayer-icon div{position:absolute}.xgplayer-skin-default .xgplayer-rotate .xgplayer-tips{margin-left:-22px}.xgplayer-skin-default .xgplayer-rotate .xgplayer-tips .xgplayer-tip-rotate{display:block}.xgplayer-skin-default .xgplayer-rotate:hover{opacity:.85}.xgplayer-skin-default .xgplayer-rotate:hover .xgplayer-tips{display:block}.xgplayer-lang-is-en .xgplayer-rotate .xgplayer-tips{margin-left:-26px}.xgplayer-lang-is-jp .xgplayer-rotate .xgplayer-tips{margin-left:-38px}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(154),a=(r=o)&&r.__esModule?r:{default:r};n(155);t.default={name:"s_reload",method:function(){var e=this;if(e.config.reload){var t=(0,i.createDom)("xg-reload",'<xg-icon class="xgplayer-icon">'+a.default+"</xg-icon>",{},"xgplayer-reload"),n=e.lang.RELOAD_TIPS,r=(0,i.createDom)("xg-tips",'<span class="xgplayer-tip-reload">'+n+"</span>",{},"xgplayer-tips");t.appendChild(r),e.once("ready",function(){e.controls.appendChild(t)}),["click","touchend"].forEach(function(n){t.addEventListener(n,function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("reloadBtnClick")})})}}},e.exports=t.default},function(e,t,n){"use strict";n.r(t),t.default='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28">\n    <path fill="#FFF" fill-opacity="1" fill-rule="nonzero" d="M18.17 19.988a7.182 7.182 0 0 1-4.256 1.318 7.806 7.806 0 0 1-.595-.03c-.08-.008-.16-.021-.242-.031a8.004 8.004 0 0 1-.458-.071c-.094-.018-.185-.042-.276-.063a7.743 7.743 0 0 1-.439-.113c-.068-.022-.136-.047-.205-.07a7.03 7.03 0 0 1-.492-.181c-.037-.015-.072-.032-.108-.049a7.295 7.295 0 0 1-.554-.269l-.025-.012a7.347 7.347 0 0 1-2.111-1.753c-.03-.036-.057-.074-.086-.11a7.305 7.305 0 0 1-1.594-4.557h1.686a.123.123 0 0 0 .108-.064.119.119 0 0 0-.006-.125L5.684 9.532a.123.123 0 0 0-.103-.056.123.123 0 0 0-.102.056l-2.834 4.276a.121.121 0 0 0-.005.125c.022.04.064.064.107.064h1.687c0 2.025.627 3.902 1.693 5.454.013.021.022.044.037.066.11.159.233.305.352.455.043.057.085.116.13.171.175.213.36.413.55.61.02.018.036.038.054.055a9.447 9.447 0 0 0 2.91 1.996c.058.026.115.054.175.079.202.084.41.158.619.228.098.034.196.069.296.1.183.054.37.1.558.145.125.029.249.06.376.085.052.01.102.027.155.035.177.032.355.05.533.071.064.007.128.018.19.026.32.03.639.052.956.052a9.46 9.46 0 0 0 5.47-1.746 1.16 1.16 0 0 0 .282-1.608 1.143 1.143 0 0 0-1.6-.283zm5.397-5.991a9.604 9.604 0 0 0-1.685-5.441c-.016-.027-.026-.054-.043-.078-.132-.19-.276-.366-.419-.543-.017-.022-.032-.044-.05-.065a9.467 9.467 0 0 0-3.571-2.7l-.114-.051a11.2 11.2 0 0 0-.673-.248c-.082-.027-.163-.057-.247-.082a9.188 9.188 0 0 0-.6-.156c-.113-.026-.224-.055-.337-.077-.057-.011-.109-.028-.164-.037-.151-.027-.304-.039-.455-.058-.104-.013-.208-.03-.313-.04a10.05 10.05 0 0 0-.759-.039c-.045 0-.09-.007-.136-.007l-.025.003a9.45 9.45 0 0 0-5.46 1.737 1.16 1.16 0 0 0-.284 1.608c.363.523 1.08.65 1.6.284a7.182 7.182 0 0 1 4.222-1.32c.217.002.429.013.639.033.065.007.129.017.193.025.173.021.344.046.513.08.075.014.149.033.221.05.166.037.331.077.494.127l.152.051c.185.061.366.127.545.201l.054.025a7.308 7.308 0 0 1 2.741 2.067l.013.018a7.302 7.302 0 0 1 1.652 4.633h-1.686a.123.123 0 0 0-.108.064.12.12 0 0 0 .006.124l2.834 4.277c.022.033.06.054.103.054.042 0 .08-.021.102-.054l2.833-4.277a.12.12 0 0 0 .005-.124.123.123 0 0 0-.108-.064h-1.685z"/>\n</svg>\n'},function(e,t,n){var r=n(156);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-reload{position:relative;-webkit-order:1;-moz-box-ordinal-group:2;order:1;display:block;width:40px;height:40px;cursor:pointer}.xgplayer-skin-default .xgplayer-reload .xgplayer-icon{margin-top:7px;width:26px}.xgplayer-skin-default .xgplayer-reload .xgplayer-icon div{position:absolute}.xgplayer-skin-default .xgplayer-reload .xgplayer-tips{margin-left:-22px}.xgplayer-skin-default .xgplayer-reload .xgplayer-tips .xgplayer-tip-reload{display:block}.xgplayer-skin-default .xgplayer-reload:hover{opacity:.85}.xgplayer-skin-default .xgplayer-reload:hover .xgplayer-tips{display:block}.xgplayer-lang-is-en .xgplayer-reload .xgplayer-tips{margin-left:-26px}.xgplayer-lang-is-jp .xgplayer-reload .xgplayer-tips{margin-left:-38px}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(158);t.default={name:"s_screenShot",method:function(){var e=this;if(e.config.screenShot&&!e.config.screenShot.hideButton){var t=e.lang.SCREENSHOT,n=(0,r.createDom)("xg-screenshot",'<p class="name"><span>'+(e.config.screenShot.iconText||t)+"</span></p>",{tabindex:11},"xgplayer-screenshot");e.once("ready",function(){e.controls.appendChild(n)}),["click","touchend"].forEach(function(t){n.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("screenShotBtnClick")})})}}},e.exports=t.default},function(e,t,n){var r=n(159);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-screenshot{-webkit-order:11;-moz-box-ordinal-group:12;order:11;position:relative;outline:none;display:block;cursor:pointer;height:20px;top:10px}.xgplayer-skin-default .xgplayer-screenshot .name{text-align:center;font-family:PingFangSC-Regular;font-size:13px;line-height:20px;height:20px;color:hsla(0,0%,100%,.8)}.xgplayer-skin-default .xgplayer-screenshot .name span{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;padding:0 10px;height:20px;line-height:20px;background:rgba(0,0,0,.38);border-radius:10px;display:inline-block;vertical-align:middle}.xgplayer-lang-is-en .xgplayer-screenshot .name span,.xgplayer-lang-is-jp .xgplayer-screenshot .name span{width:75px;height:20px}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(9),o=(r=i)&&r.__esModule?r:{default:r};n(78);t.default={name:"s_nativeTextTrack",method:function(){if(this.config.nativeTextTrack){var e=this,t=e.root,n=o.default.util,r=n.createDom("xg-texttrack","",{tabindex:7},"xgplayer-texttrack"),i=e.config.nativeTextTrack;i&&Array.isArray(i)&&i.length>0&&(n.addClass(e.root,"xgplayer-is-texttrack"),e.once("canplay",function(){var o=this,a=["<ul>"];a.push("<li class='"+(this.textTrackShowDefault?"":"selected")+"'}'>"+e.lang.OFF+"</li>"),i.forEach(function(e){a.push("<li class='"+(e.default&&o.textTrackShowDefault?"selected":"")+"'>"+e.label+"</li>")});var s=e.lang.TEXTTRACK;a.push('</ul><p class="name">'+s+"</p>");var u=t.querySelector(".xgplayer-texttrack");if(u){u.innerHTML=a.join("");var l=u.querySelector(".name");e.config.textTrackActive&&"hover"!==e.config.textTrackActive||l.addEventListener("mouseenter",function(e){e.preventDefault(),e.stopPropagation(),n.addClass(t,"xgplayer-texttrack-active"),u.focus()})}else{r.innerHTML=a.join("");var c=r.querySelector(".name");e.config.textTrackActive&&"hover"!==e.config.textTrackActive||c.addEventListener("mouseenter",function(t){t.preventDefault(),t.stopPropagation(),n.addClass(e.root,"xgplayer-texttrack-active"),r.focus()}),e.controls.appendChild(r)}})),["touchend","click"].forEach(function(t){r.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation();var o=t.target||t.srcElement;if(o&&"li"===o.tagName.toLocaleLowerCase()){Array.prototype.forEach.call(o.parentNode.childNodes,function(e){n.removeClass(e,"selected")}),n.addClass(o,"selected");var a=e.root.getElementsByTagName("Track");o.innerHTML===e.lang.OFF?(a[0].track.mode="hidden",a[0].src="",n.removeClass(e.root,"xgplayer-texttrack-active")):(a[0].style.display="block",n.addClass(e.root,"xgplayer-texttrack-active"),a[0].track.mode="showing",i.some(function(e){if(e.label===o.innerHTML)return a[0].src=e.src,e.kind&&(a[0].kind=e.kind),a[0].label=e.label,e.srclang&&(a[0].srclang=e.srclang),!0}),e.emit("textTrackChange",o.innerHTML))}else"click"!==e.config.textTrackActive||!o||"p"!==o.tagName.toLocaleLowerCase()&&"em"!==o.tagName.toLocaleLowerCase()||(n.addClass(e.root,"xgplayer-texttrack-active"),r.focus())},!1)}),e.on("play",function(){var r=t.querySelector(".xgplayer-texttrack ul"),o=t.getElementsByTagName("Track");e.hls&&r&&o&&(o[0].src="",Array.prototype.forEach.call(r.childNodes,function(t){n.hasClass(t,"selected")&&(t.innerHTML===e.lang.OFF?(o[0].track.mode="hidden",o[0].src=""):(o[0].track.mode="hidden",i.some(function(e){if(e.label!==t.innerHTML)return o[0].src=e.src,e.kind&&(o[0].kind=e.kind),o[0].label=e.label,e.srclang&&(o[0].srclang=e.srclang),!0}),i.some(function(e){if(e.label===t.innerHTML)return setTimeout(function(){o[0].src=e.src,e.kind&&(o[0].kind=e.kind),o[0].label=e.label,e.srclang&&(o[0].srclang=e.srclang),o[0].track.mode="showing"}),!0})))}),n.removeClass(e.root,"xgplayer-texttrack-active"))}),r.addEventListener("mouseleave",function(t){t.preventDefault(),t.stopPropagation(),n.removeClass(e.root,"xgplayer-texttrack-active")})}}},e.exports=t.default},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-texttrack{-webkit-order:7;-moz-box-ordinal-group:8;order:7;width:60px;height:150px;z-index:18;position:relative;outline:none;display:none;cursor:default;margin-top:-119px}.xgplayer-skin-default .xgplayer-texttrack ul{display:none;list-style:none;min-width:78px;background:rgba(0,0,0,.54);border-radius:1px;position:absolute;bottom:30px;text-align:center;white-space:nowrap;left:50%;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%);width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;z-index:26;cursor:pointer}.xgplayer-skin-default .xgplayer-texttrack ul li{opacity:.7;font-family:PingFangSC-Regular;font-size:11px;color:hsla(0,0%,100%,.8);width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;margin:auto;padding:6px 13px}.xgplayer-skin-default .xgplayer-texttrack ul li.selected,.xgplayer-skin-default .xgplayer-texttrack ul li:hover{color:#fff;opacity:1}.xgplayer-skin-default .xgplayer-texttrack .name{text-align:center;font-family:PingFangSC-Regular;font-size:13px;cursor:pointer;color:hsla(0,0%,100%,.8);position:absolute;bottom:0;width:60px;height:20px;line-height:20px;background:rgba(0,0,0,.38);border-radius:10px;display:inline-block;vertical-align:middle}.xgplayer-skin-default .xgplayer-texttrack.xgplayer-texttrack-hide{display:none}xg-text-track{transition:bottom .3s ease}.xgplayer-skin-default.xgplayer-is-texttrack .xgplayer-texttrack,.xgplayer-skin-default.xgplayer-texttrack-active .xgplayer-texttrack ul{display:block}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);function i(e,t,n,r){if(0!==t.length){var i=[];i.push('<li data-type="off" class="'+(r?"":"selected")+'">'+n+"</li>"),t.forEach(function(e){i.push("<li data-id="+e.id+" data-language="+e.language+' class="'+(e.isDefault&&r?"selected":"")+'">'+e.label+"</li>")}),e.innerHTML=i.join("")}else e.innerHTML=""}n(78);t.default={name:"s_textTrack",method:function(){var e=this;if(this.config.textTrack){var t=this.config.textTrack,n=e.lang.TEXTTRACK,o=(0,r.createDom)("xg-texttrack",'<ul></ul><p class="name">'+n+"</p>",{tabindex:7},"xgplayer-texttrack");t&&Array.isArray(t)&&(t.length>0&&(0,r.addClass)(e.root,"xgplayer-is-texttrack"),e.once("canplay",function(){if(!e.root.querySelector(".xgplayer-texttrack")){e.controls.appendChild(o);var n=o.querySelector(".name");e.config.textTrackActive&&"hover"!==e.config.textTrackActive?n.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),(0,r.hasClass)(e.root,"xgplayer-texttrack-active")?(0,r.removeClass)(e.root,"xgplayer-texttrack-active"):(0,r.addClass)(e.root,"xgplayer-texttrack-active")}):(n.addEventListener("mouseenter",function(t){t.preventDefault(),t.stopPropagation(),(0,r.addClass)(e.root,"xgplayer-texttrack-active"),o.focus()}),o.addEventListener("mouseleave",function(t){t.preventDefault(),t.stopPropagation(),(0,r.removeClass)(e.root,"xgplayer-texttrack-active")}))}["touchend","click"].forEach(function(t){o.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation();var n=t.target||t.srcElement;if(n&&"li"===n.tagName.toLocaleLowerCase()){var i=n.getAttribute("data-id"),o=n.getAttribute("data-type"),a=n.getAttribute("data-language");Array.prototype.forEach.call(n.parentNode.childNodes,function(e){(0,r.removeClass)(e,"selected")}),(0,r.addClass)(n,"selected"),"off"===o?(e.switchOffSubtile(),(0,r.removeClass)(e.root,"xgplayer-texttrack-active")):(e.switchSubTitle({id:i,language:a}),(0,r.addClass)(e.root,"xgplayer-texttrack-active"))}})}),i(o.getElementsByTagName("ul")[0],t,e.lang.OFF,e.textTrackShowDefault),0===t.length?(0,r.addClass)(o,"xgplayer-texttrack-hide"):(0,r.removeClass)(o,"xgplayer-texttrack-hide")}),e.on("subtitle_change",function(n){if(n.isListUpdate){var a=o.getElementsByTagName("ul")[0];t=n.list,i(a,n.list,e.lang.OFF,e.textTrackShowDefault),n.list.length>0?(0,r.addClass)(e.root,"xgplayer-is-texttrack"):(0,r.removeClass)(e.root,"xgplayer-is-texttrack"),0===n.list.length?(0,r.addClass)(o,"xgplayer-texttrack-hide"):(0,r.removeClass)(o,"xgplayer-texttrack-hide")}}))}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(164);t.default={name:"s_error",method:function(){var e=this,t=e.root,n=(0,r.createDom)("xg-error",'<span class="xgplayer-error-text">请<span class="xgplayer-error-refresh">刷新</span>试试</span>',{},"xgplayer-error");e.once("ready",function(){t.appendChild(n)});var i=n.querySelector(".xgplayer-error-text");e.config.lang&&"zh-cn"===e.config.lang?i.innerHTML=e.config.errorTips||'请<span class="xgplayer-error-refresh">刷新</span>试试':i.innerHTML=e.config.errorTips||'please try to <span class="xgplayer-error-refresh">refresh</span>';var o=null;function a(){(0,r.addClass)(e.root,"xgplayer-is-error"),(o=n.querySelector(".xgplayer-error-refresh"))&&["touchend","click"].forEach(function(t){o.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation(),e.autoplay=!0;var n=e.currentTime;e.once("playing",function(){e.currentTime=n,(0,r.removeClass)(e.root,"xgplayer-is-error")}),e.src=e.config.url})})}e.on("error",a),e.once("destroy",function t(){e.off("error",a),e.off("destroy",t)})}},e.exports=t.default},function(e,t,n){var r=n(165);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-error{background:#000;display:none;position:absolute;left:0;top:0;width:100%;height:100%;z-index:125;font-family:PingFangSC-Regular;font-size:14px;color:#fff;text-align:center;line-height:100%;-webkit-justify-content:center;-moz-box-pack:center;justify-content:center;-webkit-align-items:center;-moz-box-align:center;align-items:center}.xgplayer-skin-default .xgplayer-error .xgplayer-error-refresh{color:#fa1f41;padding:0 3px;cursor:pointer}.xgplayer-skin-default .xgplayer-error .xgplayer-error-text{line-height:18px;margin:auto 6px}.xgplayer-skin-default.xgplayer-is-error .xgplayer-error{display:-webkit-flex;display:-moz-box;display:flex}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(167);t.default={name:"s_memoryPlay",method:function(){var e=this,t=e.config.lastPlayTime||0,n=e.config.lastPlayTimeHideDelay||0,i=null;if(!(t<=0)){(i=(0,r.createDom)("xg-memoryplay",'<div class="xgplayer-memoryplay-spot"><div class="xgplayer-progress-tip">您上次观看到 <span class="xgplayer-lasttime">'+(0,r.format)(t)+'</span> ，为您自动续播 <span class="btn-close"><svg viewBox="64 64 896 896" focusable="false" class="" data-icon="close" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 0 0 203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z"></path></svg></span></div></div>',{},"xgplayer-memoryplay")).addEventListener("mouseover",function(e){e.stopPropagation()});var o=function(){i&&i.parentNode&&i.parentNode.removeChild(i),i=null};i.querySelector(".xgplayer-progress-tip .btn-close").addEventListener("click",o),e.once("playing",function(){n>0&&e.root.appendChild(i),e.emit("memoryPlayStart",t),n>0&&setTimeout(function(){o()},1e3*n)}),e.once("ended",o)}}},e.exports=t.default},function(e,t,n){var r=n(168);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-memoryplay-spot{position:absolute;height:32px;left:10px;bottom:46px;background:rgba(0,0,0,.5);border-radius:32px;line-height:32px;color:#ddd;z-index:15;padding:0 32px 0 16px}.xgplayer-skin-default .xgplayer-memoryplay-spot .xgplayer-lasttime{color:red;font-weight:700}.xgplayer-skin-default .xgplayer-memoryplay-spot .btn-close{position:absolute;width:16px;height:16px;right:10px;top:2px;cursor:pointer;color:#fff;font-size:16px}",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(170),a=(r=o)&&r.__esModule?r:{default:r};n(171);t.default={name:"s_airplay",method:function(){var e=this;if(e.config.airplay&&window.WebKitPlaybackTargetAvailabilityEvent){var t=(0,i.createDom)("xg-airplay",'<xg-icon class="xgplayer-icon">\n    <div class="xgplayer-icon-airplay">'+a.default+"</div>\n  </xg-icon>",{},"xgplayer-airplay"),n=(0,i.createDom)("xg-tips",'<span class="xgplayer-tip-airplay">'+e.lang.AIRPLAY_TIPS+"</span>",{},"xgplayer-tips");t.appendChild(n),e.once("ready",function(){e.controls.appendChild(t),e.video.addEventListener("webkitplaybacktargetavailabilitychanged",function(e){switch(e.availability){case"available":t.hidden=!1,t.disabled=!1;break;case"not-available":t.hidden=!0,t.disabled=!0}})}),["click","touchend"].forEach(function(n){t.addEventListener(n,function(t){t.preventDefault(),t.stopPropagation(),e.userGestureTrigEvent("airplayBtnClick")})})}}},e.exports=t.default},function(e,t,n){"use strict";n.r(t),t.default='<svg t="1600422191774" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3100" width="28" height="28"><path d="M256 938.666667h512L512 597.333333 256 938.666667z m170.666667-85.333334l85.333333-113.781333L597.333333 853.333333H426.666667zM853.333333 85.333333H170.666667C99.946667 85.333333 42.666667 142.613333 42.666667 213.333333v426.666667c0 70.72 57.28 128 128 128h106.666666l64-85.333333H170.666667c-23.573333 0-42.666667-19.093333-42.666667-42.666667V213.333333c0-23.573333 19.093333-42.666667 42.666667-42.666666h682.666666c23.573333 0 42.666667 19.093333 42.666667 42.666666v426.666667c0 23.573333-19.093333 42.666667-42.666667 42.666667H682.666667l64 85.333333h106.666666c70.72 0 128-57.28 128-128V213.333333c0-70.72-57.28-128-128-128z" p-id="3101" fill="#ffffff"></path></svg>'},function(e,t,n){var r=n(172);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".xgplayer-skin-default .xgplayer-airplay{position:relative;-webkit-order:11;-moz-box-ordinal-group:12;order:11;display:block;cursor:pointer;margin-left:5px;margin-right:3px}.xgplayer-skin-default .xgplayer-airplay .xgplayer-icon{margin-top:6px;margin-left:6px}.xgplayer-skin-default .xgplayer-airplay .xgplayer-icon div{position:absolute}.xgplayer-skin-default .xgplayer-airplay .xgplayer-icon .xgplayer-icon-airplay{display:block}.xgplayer-skin-default .xgplayer-airplay .xgplayer-tips{position:absolute;right:0;left:auto}.xgplayer-skin-default .xgplayer-airplay .xgplayer-tips .xgplayer-tip-airplay{display:block}.xgplayer-skin-default .xgplayer-airplay:hover{opacity:.85}.xgplayer-skin-default .xgplayer-airplay:hover .xgplayer-tips{display:block}",""])}])},e.exports=r()},1163:function(e,t,n){var r;window,r=function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=31)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.enableLogs=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(5);function o(){}var a={trace:o,debug:o,log:o,warn:o,info:o,error:o},s=a;var u=(0,i.getSelfScope)();function l(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach(function(t){s[t]=e[t]?e[t].bind(e):function(e){var t=u.console[e];return t?function(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];r[0]&&(r[0]=function(e,t){return t="["+e+"] > "+t}(e,r[0])),t.apply(u.console,r)}:o}(t)})}t.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":r(e))){l(e,"debug","log","info","warn","error");try{s.log()}catch(e){s=a}}else s=a},t.logger=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},t.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),s=n(2),u=n(1),l=(r=u)&&r.__esModule?r:{default:r};var c={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}return o(e,[{key:"destroy",value:function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()}},{key:"onHandlerDestroying",value:function(){}},{key:"onHandlerDestroyed",value:function(){}},{key:"isEventHandler",value:function(){return"object"===i(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(c[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)},this)}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){try{(function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)}).call(this,e,t).call()}catch(t){a.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}}}]),e}();t.default=d,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.BufferHelper=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"isBuffered",value:function(e,t){try{if(e)for(var n=e.buffered,r=0;r<n.length;r++)if(t>=n.start(r)&&t<=n.end(r))return!0}catch(e){}return!1}},{key:"bufferInfo",value:function(e,t,n){try{if(e){var r=e.buffered,i=[],o=void 0;for(o=0;o<r.length;o++)i.push({start:r.start(o),end:r.end(o)});return this.bufferedInfo(i,t,n)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,n){var r=[],i=void 0,o=void 0,a=void 0,s=void 0,u=void 0;for(e.sort(function(e,t){var n=e.start-t.start;return n||t.end-e.end}),u=0;u<e.length;u++){var l=r.length;if(l){var c=r[l-1].end;e[u].start-c<n?e[u].end>c&&(r[l-1].end=e[u].end):r.push(e[u])}else r.push(e[u])}for(u=0,i=0,o=a=t;u<r.length;u++){var d=r[u].start,f=r[u].end;if(t+n>=d&&t<f)o=d,i=(a=f)-t;else if(t+n<d){s=d;break}}return{len:i,start:o,end:a,nextStart:s}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelfScope=function(){return"undefined"==typeof window?self:window}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FragmentTracker=t.FragmentState=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=a(n(3)),o=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=t.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};t.FragmentTracker=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o.default.BUFFER_APPENDED,o.default.FRAG_BUFFERED,o.default.FRAG_LOADED));return n.bufferPadding=.2,n.fragments=Object.create(null),n.timeRanges=Object.create(null),n.config=e.config,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),r(t,[{key:"destroy",value:function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,i.default.prototype.destroy.call(this),function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"getBufferedFrag",value:function(e,t){var n=this.fragments,r=Object.keys(n).filter(function(r){var i=n[r];if(i.body.type!==t)return!1;if(!i.buffered)return!1;var o=i.body;return o.startPTS<=e&&e<=o.endPTS});if(0===r.length)return null;var i=r.pop();return n[i].body}},{key:"detectEvictedFragments",value:function(e,t){var n=this,r=void 0,i=void 0;Object.keys(this.fragments).forEach(function(o){var a=n.fragments[o];if(!0===a.buffered){var s=a.range[e];if(s){r=s.time;for(var u=0;u<r.length;u++)if(i=r[u],!1===n.isTimeBuffered(i.startPTS,i.endPTS,t)){n.removeFragment(a.body);break}}}})}},{key:"detectPartialFragments",value:function(e){var t=this,n=this.getFragmentKey(e),r=this.fragments[n];r&&(r.buffered=!0,Object.keys(this.timeRanges).forEach(function(n){if(e.hasElementaryStream(n)){var i=t.timeRanges[n];r.range[n]=t.getBufferedTimes(e.startPTS,e.endPTS,i)}}))}},{key:"getBufferedTimes",value:function(e,t,n){for(var r=[],i=void 0,o=void 0,a=!1,s=0;s<n.length;s++){if(i=n.start(s)-this.bufferPadding,o=n.end(s)+this.bufferPadding,e>=i&&t<=o){r.push({startPTS:Math.max(e,n.start(s)),endPTS:Math.min(t,n.end(s))});break}if(e<o&&t>i)r.push({startPTS:Math.max(e,n.start(s)),endPTS:Math.min(t,n.end(s))}),a=!0;else if(t<=i)break}return{time:r,partial:a}}},{key:"getFragmentKey",value:function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}},{key:"getPartialFragment",value:function(e){var t=this,n=void 0,r=void 0,i=void 0,o=null,a=0;return Object.keys(this.fragments).forEach(function(s){var u=t.fragments[s];t.isPartial(u)&&(r=u.body.startPTS-t.bufferPadding,i=u.body.endPTS+t.bufferPadding,e>=r&&e<=i&&(n=Math.min(e-r,i-e),a<=n&&(o=u.body,a=n)))}),o}},{key:"getState",value:function(e){var t=this.getFragmentKey(e),n=this.fragments[t],r=s.NOT_LOADED;return void 0!==n&&(r=n.buffered?!0===this.isPartial(n)?s.PARTIAL:s.OK:s.APPENDING),r}},{key:"isPartial",value:function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)}},{key:"isTimeBuffered",value:function(e,t,n){for(var r=void 0,i=void 0,o=0;o<n.length;o++){if(r=n.start(o)-this.bufferPadding,i=n.end(o)+this.bufferPadding,e>=r&&t<=i)return!0;if(t<=r)return!1}return!1}},{key:"onFragLoaded",value:function(e){var t=e.frag;Number.isFinite(t.sn)&&!t.bitrateTest&&(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})}},{key:"onBufferAppended",value:function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(e){var n=t.timeRanges[e];t.detectEvictedFragments(e,n)})}},{key:"onFragBuffered",value:function(e){this.detectPartialFragments(e.frag)}},{key:"hasFragment",value:function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]}},{key:"removeFragment",value:function(e){var t=this.getFragmentKey(e);delete this.fragments[t]}},{key:"removeAllFragments",value:function(){this.fragments=Object.create(null)}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addGroupId=function(e,t,n){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(n);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(n)}},t.updatePTS=i,t.updateFragPTSDTS=o,t.mergeDetails=function(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var n=0,i=void 0;if(a(e,t,function(e,r){n=e.cc-r.cc,Number.isFinite(e.startPTS)&&(r.start=r.startPTS=e.startPTS,r.endPTS=e.endPTS,r.duration=e.duration,r.backtracked=e.backtracked,r.dropped=e.dropped,i=r),t.PTSKnown=!0}),!t.PTSKnown)return;if(n){r.logger.log("discontinuity sliding from playlist, take drift into account");for(var u=t.fragments,l=0;l<u.length;l++)u[l].cc+=n}i?o(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):s(e,t);t.PTSKnown=e.PTSKnown},t.mergeSubtitlePlaylists=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=-1;a(e,t,function(e,t,n){t.start=e.start,r=n});var i=t.fragments;if(r<0)return void i.forEach(function(e){e.start+=n});for(var o=r+1;o<i.length;o++)i[o].start=i[o-1].start+i[o-1].duration},t.mapFragmentIntersection=a,t.adjustSliding=s,t.computeReloadInterval=function(e,t,n){var r=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),i=r/2;e&&t.endSN===e.endSN&&(r=i);n&&(r=Math.max(i,r-(window.performance.now()-n)));return Math.round(r)};var r=n(0);function i(e,t,n){var i=e[t],o=e[n],a=o.startPTS;Number.isFinite(a)?n>t?(i.duration=a-i.start,i.duration<0&&r.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(o.duration=i.start-a,o.duration<0&&r.logger.warn("negative duration computed for frag "+o.sn+",level "+o.level+", there should be some duration drift between playlist and fragment!")):o.start=n>t?i.start+i.duration:Math.max(i.start-o.duration,0)}function o(e,t,n,r,o,a){var s=n;if(Number.isFinite(t.startPTS)){var u=Math.abs(t.startPTS-n);Number.isFinite(t.deltaPTS)?t.deltaPTS=Math.max(u,t.deltaPTS):t.deltaPTS=u,s=Math.max(n,t.startPTS),n=Math.min(n,t.startPTS),r=Math.max(r,t.endPTS),o=Math.min(o,t.startDTS),a=Math.max(a,t.endDTS)}var l=n-t.start;t.start=t.startPTS=n,t.maxStartPTS=s,t.endPTS=r,t.startDTS=o,t.endDTS=a,t.duration=r-n;var c=t.sn;if(!e||c<e.startSN||c>e.endSN)return 0;var d,f=void 0,p=void 0;for(d=c-e.startSN,(f=e.fragments)[d]=t,p=d;p>0;p--)i(f,p,p-1);for(p=d;p<f.length-1;p++)i(f,p,p+1);return e.PTSKnown=!0,l}function a(e,t,n){if(e&&t)for(var r=Math.max(e.startSN,t.startSN)-t.startSN,i=Math.min(e.endSN,t.endSN)-t.startSN,o=t.startSN-e.startSN,a=r;a<=i;a++){var s=e.fragments[o+a],u=t.fragments[a];if(!s||!u)break;n(s,u,a)}}function s(e,t){var n=t.startSN-e.startSN,r=e.fragments,i=t.fragments;if(!(n<0||n>r.length))for(var o=0;o<i.length;o++)i[o].start+=r[n].start}},function(e,t,n){var r,i,o,a,s;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,i=/^([^\/?#]*)(.*)$/,o=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var r=s.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var o=s.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return n.alwaysNormalize?(o.path=s.normalizePath(o.path),s.buildURLFromParts(o)):t;var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var u=i.exec(a.path);a.netLoc=u[1],a.path=u[2]}a.netLoc&&!a.path&&(a.path="/");var l={scheme:a.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(l.netLoc=a.netLoc,"/"!==o.path[0]))if(o.path){var c=a.path,d=c.substring(0,c.lastIndexOf("/")+1)+o.path;l.path=s.normalizePath(d)}else l.path=a.path,o.params||(l.params=a.params,o.query||(l.query=a.query));return null===l.path&&(l.path=n.alwaysNormalize?s.normalizePath(o.path):o.path),s.buildURLFromParts(l)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(o,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={search:function(e,t){for(var n=0,r=e.length-1,i=null,o=null;n<=r;){var a=t(o=e[i=(n+r)/2|0]);if(a>0)n=i+1;else{if(!(a<0))return o;r=i-1}}return null}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"isHeader",value:function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}},{key:"isFooter",value:function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}},{key:"getID3Data",value:function(t,n){for(var r=n,i=0;e.isHeader(t,n);){i+=10,i+=e._readSize(t,n+6),e.isFooter(t,n+10)&&(i+=10),n+=i}if(i>0)return t.subarray(r,r+i)}},{key:"_readSize",value:function(e,t){var n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3]}},{key:"getTimeStamp",value:function(t){for(var n=e.getID3Frames(t),r=0;r<n.length;r++){var i=n[r];if(e.isTimeStampFrame(i))return e._readTimeStamp(i)}}},{key:"isTimeStampFrame",value:function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}},{key:"_getFrameData",value:function(t){var n=String.fromCharCode(t[0],t[1],t[2],t[3]),r=e._readSize(t,4);return{type:n,size:r,data:t.subarray(10,10+r)}}},{key:"getID3Frames",value:function(t){for(var n=0,r=[];e.isHeader(t,n);){for(var i=e._readSize(t,n+6),o=(n+=10)+i;n+8<o;){var a=e._getFrameData(t.subarray(n)),s=e._decodeFrame(a);s&&r.push(s),n+=a.size+10}e.isFooter(t,n)&&(n+=10)}return r}},{key:"_decodeFrame",value:function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"T"===t.type[0]?e._decodeTextFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):void 0}},{key:"_readTimeStamp",value:function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),n=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}}},{key:"_decodePrivFrame",value:function(t){if(!(t.size<2)){var n=e._utf8ArrayToStr(t.data,!0),r=new Uint8Array(t.data.subarray(n.length+1));return{key:t.type,info:n,data:r.buffer}}}},{key:"_decodeTextFrame",value:function(t){if(!(t.size<2)){if("TXXX"===t.type){var n=1,r=e._utf8ArrayToStr(t.data.subarray(n));n+=r.length+1;var i=e._utf8ArrayToStr(t.data.subarray(n));return{key:t.type,info:r,data:i}}var o=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:o}}}},{key:"_decodeURLFrame",value:function(t){if("WXXX"===t.type){if(t.size<2)return;var n=1,r=e._utf8ArrayToStr(t.data.subarray(n));n+=r.length+1;var i=e._utf8ArrayToStr(t.data.subarray(n));return{key:t.type,info:r,data:i}}var o=e._utf8ArrayToStr(t.data);return{key:t.type,data:o}}},{key:"_utf8ArrayToStr",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.length,r=void 0,i=void 0,o=void 0,a="",s=0;s<n;){if(0===(r=e[s++])&&t)return a;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:i=e[s++],a+=String.fromCharCode((31&r)<<6|63&i);break;case 14:i=e[s++],o=e[s++],a+=String.fromCharCode((15&r)<<12|(63&i)<<6|(63&o)<<0)}}return a}}]),e}(),o=i._utf8ArrayToStr;t.default=i,t.utf8ArrayToStr=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(8)),a=n(17),s=(r=a)&&r.__esModule?r:{default:r};function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=(u(t={},e.ElementaryStreamTypes.AUDIO,!1),u(t,e.ElementaryStreamTypes.VIDEO,!1),t)}return i(e,[{key:"addElementaryStream",value:function(e){this._elementaryStreams[e]=!0}},{key:"hasElementaryStream",value:function(e){return!0===this._elementaryStreams[e]}},{key:"createInitializationVector",value:function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}},{key:"fragmentDecryptdataFromLevelkey",value:function(e,t){var n=e;return e&&e.method&&e.uri&&!e.iv&&((n=new s.default).method=e.method,n.baseuri=e.baseuri,n.reluri=e.reluri,n.iv=this.createInitializationVector(t)),n}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=o.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var e=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var n=this.lastByteRangeEndOffset;e[0]=n||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0],this._byteRange=e}return e}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}},{key:"endProgramDateTime",get:function(){if(!Number.isFinite(this.programDateTime))return null;var e=Number.isFinite(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}],[{key:"ElementaryStreamTypes",get:function(){return{AUDIO:"audio",VIDEO:"video"}}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=c(n(42)),o=c(n(43)),a=c(n(44)),s=n(2),u=n(0),l=c(n(1));function c(e){return e&&e.__esModule?e:{default:e}}var d=(0,n(5).getSelfScope)(),f=function(){function e(t,n){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).removePKCS7Padding,i=void 0===r||r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.logEnabled=!0,this.observer=t,this.config=n,this.removePKCS7Padding=i,i)try{var o=d.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}return r(e,[{key:"isSync",value:function(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function(e,t,n,r){var s=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(u.logger.log("JS AES decrypt"),this.logEnabled=!1);var l=this.decryptor;l||(this.decryptor=l=new a.default),l.expandKey(t),r(l.decrypt(e,0,n,this.removePKCS7Padding))}else{this.logEnabled&&(u.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var c=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new o.default(c,t)),this.fastAesKey.expandKey().then(function(o){new i.default(c,n).decrypt(e,o).catch(function(i){s.onWebCryptoError(i,e,t,n,r)}).then(function(e){r(e)})}).catch(function(i){s.onWebCryptoError(i,e,t,n,r)})}}},{key:"onWebCryptoError",value:function(e,t,n,r,i){this.config.enableSoftwareAES?(u.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,n,r,i)):(u.logger.error("decrypting error : "+e.message),this.observer.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}},{key:"destroy",value:function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)}}]),e}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMediaSource=function(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(28),a=(r=o)&&r.__esModule?r:{default:r},s=n(6),u=n(4),l=n(0);var c=t.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},d=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"doTick",value:function(){}},{key:"startLoad",value:function(){}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=c.STOPPED}},{key:"_streamEnded",value:function(e,t){var n=this.fragCurrent,r=this.fragmentTracker;if(!t.live&&n&&!n.backtracked&&n.sn===t.endSN&&!e.nextStart){var i=r.getState(n);return i===s.FragmentState.PARTIAL||i===s.FragmentState.OK}return!1}},{key:"onMediaSeeking",value:function(){var e=this.config,t=this.media,n=this.mediaBuffer,r=this.state,i=t?t.currentTime:null,o=u.BufferHelper.bufferInfo(n||t,i,this.config.maxBufferHole);if(Number.isFinite(i)&&l.logger.log("media seeking to "+i.toFixed(3)),r===c.FRAG_LOADING){var a=this.fragCurrent;if(0===o.len&&a){var s=e.maxFragLookUpTolerance,d=a.start-s,f=a.start+a.duration+s;i<d||i>f?(a.loader&&(l.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=c.IDLE):l.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else r===c.ENDED&&(0===o.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=c.IDLE);t&&(this.lastCurrentTime=i),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=i),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onHandlerDestroying",value:function(){this.stopLoad(),function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onHandlerDestroying",this).call(this)}},{key:"onHandlerDestroyed",value:function(){this.state=c.STOPPED,this.fragmentTracker=null}}]),t}();t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=c(n(1)),o=c(n(3)),a=n(2),s=n(0),u=c(n(16)),l=c(n(35));function c(e){return e&&e.__esModule?e:{default:e}}var d=window.performance,f={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},p={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.default.MANIFEST_LOADING,i.default.LEVEL_LOADING,i.default.AUDIO_TRACK_LOADING,i.default.SUBTITLE_TRACK_LOADING));return n.loaders={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"createInternalLoader",value:function(e){var t=this.hls.config,n=t.pLoader,r=t.loader,i=new(n||r)(t);return e.loader=i,this.loaders[e.type]=i,i}},{key:"getInternalLoader",value:function(e){return this.loaders[e.type]}},{key:"resetInternalLoader",value:function(e){this.loaders[e]&&delete this.loaders[e]}},{key:"destroyInternalLoaders",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}},{key:"destroy",value:function(){this.destroyInternalLoaders(),function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,{type:f.MANIFEST,level:0,id:null})}},{key:"onLevelLoading",value:function(e){this.load(e.url,{type:f.LEVEL,level:e.level,id:e.id})}},{key:"onAudioTrackLoading",value:function(e){this.load(e.url,{type:f.AUDIO_TRACK,level:null,id:e.id})}},{key:"onSubtitleTrackLoading",value:function(e){this.load(e.url,{type:f.SUBTITLE_TRACK,level:null,id:e.id})}},{key:"load",value:function(e,t){var n=this.hls.config;s.logger.debug("Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var r=this.getInternalLoader(t);if(r){var i=r.context;if(i&&i.url===e)return s.logger.trace("playlist request ongoing"),!1;s.logger.warn("aborting previous loader for type: "+t.type),r.abort()}var o=void 0,a=void 0,u=void 0,l=void 0;switch(t.type){case f.MANIFEST:o=n.manifestLoadingMaxRetry,a=n.manifestLoadingTimeOut,u=n.manifestLoadingRetryDelay,l=n.manifestLoadingMaxRetryTimeout;break;case f.LEVEL:o=0,a=n.levelLoadingTimeOut;break;default:o=n.levelLoadingMaxRetry,a=n.levelLoadingTimeOut,u=n.levelLoadingRetryDelay,l=n.levelLoadingMaxRetryTimeout}r=this.createInternalLoader(t),t.url=e,t.responseType=t.responseType||"";var c={timeout:a,maxRetry:o,retryDelay:u,maxRetryDelay:l},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return s.logger.debug("Calling internal loader delegate for URL: "+e),r.load(t,c,d),!0}},{key:"loadsuccess",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(n.isSidxRequest)return this._handleSidxRequest(e,n),void this._handlePlaylistLoaded(e,t,n,r);this.resetInternalLoader(n.type);var i=e.data;t.tload=d.now(),0===i.indexOf("#EXTM3U")?i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,n,r):this._handleMasterPlaylist(e,t,n,r):this._handleManifestParsingError(e,n,"no EXTM3U delimiter",r)}},{key:"loaderror",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,n,!1,e)}},{key:"loadtimeout",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,n,!0)}},{key:"_handleMasterPlaylist",value:function(e,n,r,o){var a=this.hls,u=e.data,c=t.getResponseUrl(e,r),d=l.default.parseMasterPlaylist(u,c);if(d.length){var f=d.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),p=l.default.parseMasterPlaylistMedia(u,c,"AUDIO",f),h=l.default.parseMasterPlaylistMedia(u,c,"SUBTITLES");if(p.length){var g=!1;p.forEach(function(e){e.url||(g=!0)}),!1===g&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(s.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main"}))}a.trigger(i.default.MANIFEST_LOADED,{levels:d,audioTracks:p,subtitles:h,url:c,stats:n,networkDetails:o})}else this._handleManifestParsingError(e,r,"no level found in manifest",o)}},{key:"_handleTrackOrLevelPlaylist",value:function(e,n,r,o){var a=this.hls,s=r.id,u=r.level,c=r.type,p=t.getResponseUrl(e,r),h=Number.isFinite(s)?s:0,g=Number.isFinite(u)?u:h,v=t.mapContextToLevelType(r),m=l.default.parseLevelPlaylist(e.data,p,g,v,h);if(m.tload=n.tload,c===f.MANIFEST){var y={url:p,details:m};a.trigger(i.default.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:p,stats:n,networkDetails:o})}if(n.tparsed=d.now(),m.needSidxRanges){var _=m.initSegment.url;this.load(_,{isSidxRequest:!0,type:c,level:u,levelDetails:m,id:s,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else r.levelDetails=m,this._handlePlaylistLoaded(e,n,r,o)}},{key:"_handleSidxRequest",value:function(e,t){var n=u.default.parseSegmentIndex(new Uint8Array(e.data));if(n){var r=n.references,i=t.levelDetails;r.forEach(function(e,t){var n=e.info,r=i.fragments[t];0===r.byteRange.length&&(r.rawByteRange=String(1+n.end-n.start)+"@"+String(n.start))}),i.initSegment.rawByteRange=String(n.moovEndOffset)+"@0"}}},{key:"_handleManifestParsingError",value:function(e,t,n,r){this.hls.trigger(i.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:n,networkDetails:r})}},{key:"_handleNetworkError",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;s.logger.info("A network error occured while loading a "+e.type+"-type playlist");var o=void 0,u=void 0,l=this.getInternalLoader(e);switch(e.type){case f.MANIFEST:o=n?a.ErrorDetails.MANIFEST_LOAD_TIMEOUT:a.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case f.LEVEL:o=n?a.ErrorDetails.LEVEL_LOAD_TIMEOUT:a.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case f.AUDIO_TRACK:o=n?a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;default:u=!1}l&&(l.abort(),this.resetInternalLoader(e.type));var c={type:a.ErrorTypes.NETWORK_ERROR,details:o,fatal:u,url:l.url,loader:l,context:e,networkDetails:t};r&&(c.response=r),this.hls.trigger(i.default.ERROR,c)}},{key:"_handlePlaylistLoaded",value:function(e,n,r,o){var a=r.type,s=r.level,u=r.id,l=r.levelDetails;if(l.targetduration)if(t.canHaveQualityLevels(r.type))this.hls.trigger(i.default.LEVEL_LOADED,{details:l,level:s||0,id:u||0,stats:n,networkDetails:o});else switch(a){case f.AUDIO_TRACK:this.hls.trigger(i.default.AUDIO_TRACK_LOADED,{details:l,id:u,stats:n,networkDetails:o});break;case f.SUBTITLE_TRACK:this.hls.trigger(i.default.SUBTITLE_TRACK_LOADED,{details:l,id:u,stats:n,networkDetails:o})}else this._handleManifestParsingError(e,r,"invalid target duration",o)}}],[{key:"canHaveQualityLevels",value:function(e){return e!==f.AUDIO_TRACK&&e!==f.SUBTITLE_TRACK}},{key:"mapContextToLevelType",value:function(e){switch(e.type){case f.AUDIO_TRACK:return p.AUDIO;case f.SUBTITLE_TRACK:return p.SUBTITLE;default:return p.MAIN}}},{key:"getResponseUrl",value:function(e,t){var n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n}},{key:"ContextType",get:function(){return f}},{key:"LevelType",get:function(){return p}}]),t}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),a=n(1),s=(r=a)&&r.__esModule?r:{default:r};var u=Math.pow(2,32)-1,l=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.remuxer=n}return i(e,[{key:"resetTimeStamp",value:function(e){this.initPTS=e}},{key:"resetInitSegment",value:function(t,n,r,i){if(t&&t.byteLength){var o=this.initData=e.parseInitSegment(t);null==n&&(n="mp4a.40.5"),null==r&&(r="avc1.42e01e");var a={};o.audio&&o.video?a.audiovideo={container:"video/mp4",codec:n+","+r,initSegment:i?t:null}:(o.audio&&(a.audio={container:"audio/mp4",codec:n,initSegment:i?t:null}),o.video&&(a.video={container:"video/mp4",codec:r,initSegment:i?t:null})),this.observer.trigger(s.default.FRAG_PARSING_INIT_SEGMENT,{tracks:a})}else n&&(this.audioCodec=n),r&&(this.videoCodec=r)}},{key:"append",value:function(t,n,r,i){var o=this.initData;o||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),o=this.initData);var a,u=this.initPTS;if(void 0===u){var l=e.getStartDTS(o,t);this.initPTS=u=l-n,this.observer.trigger(s.default.INIT_PTS_FOUND,{initPTS:u})}e.offsetStartDTS(o,t,u),a=e.getStartDTS(o,t),this.remuxer.remux(o.audio,o.video,null,null,a,r,i,t)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0}},{key:"bin2str",value:function(e){return String.fromCharCode.apply(null,e)}},{key:"readUint16",value:function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<8|e[t+1];return n<0?65536+n:n}},{key:"readUint32",value:function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return n<0?4294967296+n:n}},{key:"writeUint32",value:function(e,t,n){e.data&&(t+=e.start,e=e.data),e[t]=n>>24,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n}},{key:"findBox",value:function(t,n){var r=[],i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,l=void 0;if(t.data?(u=t.start,a=t.end,t=t.data):(u=0,a=t.byteLength),!n.length)return null;for(i=u;i<a;)l=(o=e.readUint32(t,i))>1?i+o:a,e.bin2str(t.subarray(i+4,i+8))===n[0]&&(1===n.length?r.push({data:t,start:i+8,end:l}):(s=e.findBox({data:t,start:i+8,end:l},n.slice(1))).length&&(r=r.concat(s))),i=l;return r}},{key:"parseSegmentIndex",value:function(t){var n=e.findBox(t,["moov"])[0],r=n?n.end:null,i=0,o=e.findBox(t,["sidx"]),a=void 0;if(!o||!o[0])return null;a=[];var s=(o=o[0]).data[0];i=0===s?8:16;var u=e.readUint32(o,i);i+=4;i+=0===s?8:16,i+=2;var l=o.end+0,c=e.readUint16(o,i);i+=2;for(var d=0;d<c;d++){var f=i,p=e.readUint32(o,f);f+=4;var h=2147483647&p;if(1===(2147483648&p)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var g=e.readUint32(o,f);f+=4,a.push({referenceSize:h,subsegmentDuration:g,info:{duration:g/u,start:l,end:l+h-1}}),l+=h,i=f+=4}return{earliestPresentationTime:0,timescale:u,version:s,referencesCount:c,references:a,moovEndOffset:r}}},{key:"parseInitSegment",value:function(t){var n=[];return e.findBox(t,["moov","trak"]).forEach(function(t){var r=e.findBox(t,["tkhd"])[0];if(r){var i=r.data[r.start],a=0===i?12:20,s=e.readUint32(r,a),u=e.findBox(t,["mdia","mdhd"])[0];if(u){a=0===(i=u.data[u.start])?12:20;var l=e.readUint32(u,a),c=e.findBox(t,["mdia","hdlr"])[0];if(c){var d={soun:"audio",vide:"video"}[e.bin2str(c.data.subarray(c.start+8,c.start+12))];if(d){var f=e.findBox(t,["mdia","minf","stbl","stsd"]);if(f.length){f=f[0];var p=e.bin2str(f.data.subarray(f.start+12,f.start+16));o.logger.log("MP4Demuxer:"+d+":"+p+" found")}n[s]={timescale:l,type:d},n[d]={timescale:l,id:s}}}}}}),n}},{key:"getStartDTS",value:function(t,n){var r,i,o=void 0;return o=e.findBox(n,["moof","traf"]),r=[].concat.apply([],o.map(function(n){return e.findBox(n,["tfhd"]).map(function(r){var i,o;return i=e.readUint32(r,4),o=t[i].timescale||9e4,e.findBox(n,["tfdt"]).map(function(t){var n,r=void 0;return n=t.data[t.start],r=e.readUint32(t,4),1===n&&(r*=Math.pow(2,32),r+=e.readUint32(t,8)),r})[0]/o})})),i=Math.min.apply(null,r),isFinite(i)?i:0}},{key:"offsetStartDTS",value:function(t,n,r){e.findBox(n,["moof","traf"]).map(function(n){return e.findBox(n,["tfhd"]).map(function(i){var o=e.readUint32(i,4),a=t[o].timescale||9e4;e.findBox(n,["tfdt"]).map(function(t){var n=t.data[t.start],i=e.readUint32(t,4);if(0===n)e.writeUint32(t,4,i-r*a);else{i*=Math.pow(2,32),i+=e.readUint32(t,8),i-=r*a,i=Math.max(i,0);var o=Math.floor(i/(u+1)),s=Math.floor(i%(u+1));e.writeUint32(t,4,o),e.writeUint32(t,8,s)}})})})}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(8));var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return r(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=i.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}();t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};t.isCodecType=function(e,t){var n=r[t];return!!n&&!0===n[e.slice(0,4)]},t.isCodecSupportedInMp4=function(e,t){return window.MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(n(20),function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(41))),o=f(n(1)),a=f(n(21)),s=n(0),u=n(2),l=n(13),c=n(5),d=n(24);function f(e){return e&&e.__esModule?e:{default:e}}var p=(0,c.getSelfScope)(),h=(0,l.getMediaSource)(),g=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hls=t,this.id=n;var l=this.observer=new d.Observer,c=t.config,f=function(e,n){(n=n||{}).frag=r.frag,n.id=r.id,t.trigger(e,n)};l.on(o.default.FRAG_DECRYPTED,f),l.on(o.default.FRAG_PARSING_INIT_SEGMENT,f),l.on(o.default.FRAG_PARSING_DATA,f),l.on(o.default.FRAG_PARSED,f),l.on(o.default.ERROR,f),l.on(o.default.FRAG_PARSING_METADATA,f),l.on(o.default.FRAG_PARSING_USERDATA,f),l.on(o.default.INIT_PTS_FOUND,f);var g={mp4:h.isTypeSupported("video/mp4"),mpeg:h.isTypeSupported("audio/mpeg"),mp3:h.isTypeSupported('audio/mp4; codecs="mp3"')},v=navigator.vendor;if(c.enableWorker&&"undefined"!=typeof Worker){s.logger.log("demuxing in webworker");var m=void 0;try{m=this.w=i(55),this.onwmsg=this.onWorkerMessage.bind(this),m.addEventListener("message",this.onwmsg),m.onerror=function(e){t.trigger(o.default.ERROR,{type:u.ErrorTypes.OTHER_ERROR,details:u.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},m.postMessage({cmd:"init",typeSupported:g,vendor:v,id:n,config:JSON.stringify(c)})}catch(e){s.logger.warn("Error in worker:",e),s.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),m&&p.URL.revokeObjectURL(m.objectURL),this.demuxer=new a.default(l,g,c,v),this.w=void 0}}else this.demuxer=new a.default(l,g,c,v)}return r(e,[{key:"destroy",value:function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var n=this.observer;n&&(n.removeAllListeners(),this.observer=null)}},{key:"push",value:function(e,t,n,r,i,o,a,u){var l=this.w,c=Number.isFinite(i.startPTS)?i.startPTS:i.start,d=i.decryptdata,f=this.frag,p=!(f&&i.cc===f.cc),h=!(f&&i.level===f.level),g=f&&i.sn===f.sn+1,v=!h&&g;if(p&&s.logger.log(this.id+":discontinuity detected"),h&&s.logger.log(this.id+":switch detected"),this.frag=i,l)l.postMessage({cmd:"demux",data:e,decryptdata:d,initSegment:t,audioCodec:n,videoCodec:r,timeOffset:c,discontinuity:p,trackSwitch:h,contiguous:v,duration:o,accurateTimeOffset:a,defaultInitPTS:u},e instanceof ArrayBuffer?[e]:[]);else{var m=this.demuxer;m&&m.push(e,d,t,n,r,c,p,h,v,o,a,u)}}},{key:"onWorkerMessage",value:function(e){var t=e.data,n=this.hls;switch(t.event){case"init":p.URL.revokeObjectURL(this.w.objectURL);break;case o.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data)}}}]),e}();t.default=g,e.exports=t.default},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise(function(n,r){function i(){void 0!==o&&e.removeListener("error",o),n([].slice.call(arguments))}var o;"error"!==t&&(o=function(n){e.removeListener(t,i),r(n)},e.once("error",o)),e.once(t,i)})},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var u=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var i,o,a,s;if(l(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=c(e))>0&&a.length>i&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,console&&console.warn&&console.warn(s)}return e}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):g(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var u=i[e];if(void 0===u)return!1;if("function"==typeof u)o(u,this,t);else{var l=u.length,c=g(u,l);for(n=0;n<l;++n)o(c[n],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return l(t),this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,o,a;if(l(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return p(this,e,!0)},s.prototype.rawListeners=function(e){return p(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},s.prototype.listenerCount=h,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=g(n(1)),o=n(2),a=g(n(12)),s=g(n(45)),u=g(n(16)),l=g(n(46)),c=g(n(49)),d=g(n(50)),f=g(n(53)),p=n(5),h=n(0);function g(e){return e&&e.__esModule?e:{default:e}}var v=(0,p.getSelfScope)(),m=void 0;try{m=v.performance.now.bind(v.performance)}catch(e){h.logger.debug("Unable to use Performance API on this environment"),m=v.Date.now}var y=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.typeSupported=n,this.config=r,this.vendor=i}return r(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,t,n,r,o,s,u,l,c,d,f,p){var h=this;if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var g=this.decrypter;null==g&&(g=this.decrypter=new a.default(this.observer,this.config));var v=m();g.decrypt(e,t.key.buffer,t.iv.buffer,function(e){var a=m();h.observer.trigger(i.default.FRAG_DECRYPTED,{stats:{tstart:v,tdecrypt:a}}),h.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),r,o,s,u,l,c,d,f,p)})}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),r,o,s,u,l,c,d,f,p)}},{key:"pushDecrypted",value:function(e,t,n,r,a,p,h,g,v,m,y,_){var b=this.demuxer;if(!b||(h||g)&&!this.probe(e)){for(var S=this.observer,k=this.typeSupported,w=this.config,E=[{demux:l.default,remux:d.default},{demux:u.default,remux:f.default},{demux:s.default,remux:d.default},{demux:c.default,remux:d.default}],T=0,x=E.length;T<x;T++){var C=E[T],I=C.demux.probe;if(I(e)){var R=this.remuxer=new C.remux(S,w,k,this.vendor);b=new C.demux(S,R,w,k),this.probe=I;break}}if(!b)return void S.trigger(i.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=b}var A=this.remuxer;(h||g)&&(b.resetInitSegment(n,r,a,m),A.resetInitSegment()),h&&(b.resetTimeStamp(_),A.resetTimeStamp(_)),"function"==typeof b.setDecryptData&&b.setDecryptData(t),b.append(e,p,v,y)}}]),e}();t.default=y,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAudioConfig=u,t.isHeaderPattern=l,t.getHeaderLength=c,t.getFullFrameLength=d,t.isHeader=function(e,t){if(t+1<e.length&&l(e,t))return!0;return!1},t.probe=function(e,t){if(t+1<e.length&&l(e,t)){var n=c(e,t),r=n;t+5<e.length&&(r=d(e,t));var i=t+r;if(i===e.length||i+1<e.length&&l(e,i))return!0}return!1},t.initTrackConfig=function(e,t,n,r,o){if(!e.samplerate){var a=u(t,n,r,o);e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,i.logger.log("parsed codec:"+e.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount)}},t.getFrameDuration=f,t.parseFrameHeader=p,t.appendFrame=function(e,t,n,r,i){var o=f(e.samplerate),a=p(t,n,r,i,o);if(a){var s=a.stamp,u=a.headerLength,l=a.frameLength,c={unit:t.subarray(n+u,n+u+l),pts:s,dts:s};return e.samples.push(c),e.len+=l,{sample:c,length:l+u}}return};var r,i=n(0),o=n(2),a=n(1),s=(r=a)&&r.__esModule?r:{default:r};n(5);function u(e,t,n,r){var a,u=void 0,l=void 0,c=void 0,d=void 0,f=navigator.userAgent.toLowerCase(),p=r,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(u=1+((192&t[n+2])>>>6),!((a=(60&t[n+2])>>>2)>h.length-1))return c=(1&t[n+2])<<2,c|=(192&t[n+3])>>>6,i.logger.log("manifest codec:"+r+",ADTS data:type:"+u+",sampleingIndex:"+a+"["+h[a]+"Hz],channelConfig:"+c),/firefox/i.test(f)?a>=6?(u=5,d=new Array(4),l=a-3):(u=2,d=new Array(2),l=a):-1!==f.indexOf("android")?(u=2,d=new Array(2),l=a):(u=5,d=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&a>=6?l=a-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(a>=6&&1===c||/vivaldi/i.test(f))||!r&&1===c)&&(u=2,d=new Array(2)),l=a)),d[0]=u<<3,d[0]|=(14&a)>>1,d[1]|=(1&a)<<7,d[1]|=c<<3,5===u&&(d[1]|=(14&l)>>1,d[2]=(1&l)<<7,d[2]|=8,d[3]=0),{config:d,samplerate:h[a],channelCount:c,codec:"mp4a.40."+u,manifestCodec:p};e.trigger(s.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+a})}function l(e,t){return 255===e[t]&&240==(246&e[t+1])}function c(e,t){return 1&e[t+1]?7:9}function d(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function f(e){return 9216e4/e}function p(e,t,n,r,i){var o,a=void 0,s=e.length;if(o=c(e,t),a=d(e,t),(a-=o)>0&&t+o+a<=s)return{headerLength:o,frameLength:a,stamp:n+r*i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,n,r,i){if(!(n+24>t.length)){var o=this.parseHeader(t,n);if(o&&n+o.frameLength<=t.length){var a=r+i*(9e4*o.samplesPerFrame/o.sampleRate),s={unit:t.subarray(n,n+o.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=o.channelCount,e.samplerate=o.sampleRate,e.samples.push(s),e.len+=o.frameLength,{sample:s,length:o.frameLength}}}},parseHeader:function(e,t){var n=e[t+1]>>3&3,i=e[t+1]>>1&3,o=e[t+2]>>4&15,a=e[t+2]>>2&3,s=e[t+2]>>1&1;if(1!==n&&0!==o&&15!==o&&3!==a){var u=3===n?3-i:3===i?3:4,l=1e3*r.BitratesMap[14*u+o-1],c=3===n?0:2===n?1:2,d=r.SamplingRateMap[3*c+a],f=e[t+3]>>6==3?1:2,p=r.SamplesCoefficients[n][i],h=r.BytesInSlot[i],g=8*p*h;return{sampleRate:d,channelCount:f,frameLength:parseInt(p*l/d+s,10)*h,samplesPerFrame:g}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var n=this.parseHeader(e,t),r=4;n&&n.frameLength&&(r=n.frameLength);var i=t+r;if(i===e.length||i+1<e.length&&this.isHeaderPattern(e,i))return!0}return!1}};t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Observer=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(54);t.Observer=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.EventEmitter),r(t,[{key:"trigger",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.emit.apply(this,[e,e].concat(n))}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={toString:function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findFirstFragWithCC=s,t.findFragWithCC=function(e,t){return o.default.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})},t.shouldAlignOnDiscontinuities=u,t.findDiscontinuousReferenceFrag=l,t.adjustPts=c,t.alignStream=function(e,t,n){d(e,n,t),!n.PTSKnown&&t&&f(n,t.details)},t.alignDiscontinuities=d,t.alignPDT=f;var r,i=n(9),o=(r=i)&&r.__esModule?r:{default:r},a=n(0);function s(e,t){for(var n=null,r=0;r<e.length;r+=1){var i=e[r];if(i&&i.cc===t){n=i;break}}return n}function u(e,t,n){var r=!1;return t&&t.details&&n&&(n.endCC>n.startCC||e&&e.cc<n.startCC)&&(r=!0),r}function l(e,t){var n=e.fragments,r=t.fragments;if(r.length&&n.length){var i=s(n,r[0].cc);if(i&&(!i||i.startPTS))return i;a.logger.log("No frag in previous level to align on")}else a.logger.log("No fragments to align")}function c(e,t){t.fragments.forEach(function(t){if(t){var n=t.start+e;t.start=t.startPTS=n,t.endPTS=n+t.duration}}),t.PTSKnown=!0}function d(e,t,n){if(u(e,n,t)){var r=l(n.details,t);r&&(a.logger.log("Adjusting PTS using last level due to CC increase within current level"),c(r.start,t))}}function f(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var n=t.fragments[0].programDateTime,r=(e.fragments[0].programDateTime-n)/1e3+t.fragments[0].start;Number.isFinite(r)&&(a.logger.log("adjusting PTS using programDateTime delta, sliding:"+r.toFixed(3)),c(r,e))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findFragmentByPDT=function(e,t,n){if(!Array.isArray(e)||!e.length||!Number.isFinite(t))return null;if(t<e[0].programDateTime)return null;if(t>=e[e.length-1].endProgramDateTime)return null;n=n||0;for(var r=0;r<e.length;++r){var i=e[r];if(s(t,n,i))return i}return null},t.findFragmentByPTS=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=e?t[e.sn-t[0].sn+1]:null;if(i&&!a(n,r,i))return i;return o.default.search(t,a.bind(null,n,r))},t.fragmentWithinToleranceTest=a,t.pdtWithinToleranceTest=s;var r,i=n(9),o=(r=i)&&r.__esModule?r:{default:r};function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments[2],r=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=e?1:n.start-r>e&&n.start?-1:0}function s(e,t,n){var r=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.endProgramDateTime-r>e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3),a=(r=o)&&r.__esModule?r:{default:r};var s=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n=t.__proto__||Object.getPrototypeOf(t)).call.apply(n,[this,e].concat(i)));return a._tickInterval=null,a._tickTimer=null,a._tickCallCount=0,a._boundTick=a.tick.bind(a),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"onHandlerDestroying",value:function(){this.clearNextTick(),this.clearInterval()}},{key:"hasInterval",value:function(){return!!this._tickInterval}},{key:"hasNextTick",value:function(){return!!this._tickTimer}},{key:"setInterval",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,e),!0)})},{key:"clearInterval",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)})},{key:"clearNextTick",value:function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)}},{key:"tick",value:function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)}},{key:"doTick",value:function(){}}]),t}();t.default=s,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendAddTrackEvent=function(e,t){var n=null;try{n=new window.Event("addtrack")}catch(e){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)},t.clearCurrentCues=function(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fixLineBreaks=void 0;var r,i=n(71),o=(r=i)&&r.__esModule?r:{default:r};var a=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};function s(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new a,this.regionList=[]}function u(){this.values=Object.create(null)}function l(e,t,n,r){var i=r?e.split(r):[e];for(var o in i)if("string"==typeof i[o]){var a=i[o].split(n);if(2===a.length)t(a[0],a[1])}}u.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var c=new o.default(0,0,0),d="middle"===c.align?"middle":"center";function f(e,t,n){var r=e;function i(){var t=function(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+(0|r)/1e3}var n=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function o(){e=e.replace(/^\s+/,"")}if(o(),t.startTime=i(),o(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.substr(3),o(),t.endTime=i(),o(),function(e,t){var r=new u;l(e,function(e,t){switch(e){case"region":for(var i=n.length-1;i>=0;i--)if(n[i].id===t){r.set(e,n[i].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":var o=t.split(","),a=o[0];r.integer(e,a),r.percent(e,a)&&r.set("snapToLines",!1),r.alt(e,a,["auto"]),2===o.length&&r.alt("lineAlign",o[1],["start",d,"end"]);break;case"position":o=t.split(","),r.percent(e,o[0]),2===o.length&&r.alt("positionAlign",o[1],["start",d,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",d,"end","left","right"])}},/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");var i=r.get("line","auto");"auto"===i&&-1===c.line&&(i=-1),t.line=i,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",d);var o=r.get("position","auto");"auto"===o&&50===c.position&&(o="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=o}(e,t)}function p(e){return e.replace(/<br(?: \/)?>/gi,"\n")}s.prototype={parse:function(e){var t=this;function n(){var e=t.buffer,n=0;for(e=p(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var r=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var r=void 0;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var i=(r=n()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:r=n(),t.state){case"HEADER":/:/.test(r)?l(r,function(e,t){},/:/):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new o.default(0,0,""),t.state="CUE",-1===r.indexOf("--\x3e")){t.cue.id=r;continue}case"CUE":try{f(r,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var s=-1!==r.indexOf("--\x3e");if(!r||s&&(a=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=r;continue;case"BADCUE":r||(t.state="ID");continue}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}},t.fixLineBreaks=p,t.default=s},function(e,t,n){e.exports=n(32)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=u(n(33)),a=u(n(34)),s=u(n(80));function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.hlsOpts=e.hlsOpts||{};var r=o.default.util,i=n;if(i.once("complete",function(){if(i.config.isLive&&(r.addClass(i.root,"xgplayer-is-live"),!r.findDom(i.controls,".xgplayer-live"))){var e=r.createDom("xg-live","正在直播",{},"xgplayer-live");i.controls.appendChild(e)}}),n.browser=s.default.getBrowserVersion(),void 0===i.config.useHls){if("mobile"===o.default.sniffer.device&&"MacIntel"!==navigator.platform&&"Win32"!==navigator.platform||n.browser.indexOf("Safari")>-1)return l(n)}else if(!i.config.useHls)return l(n);Number.isFinite=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)};var u=void 0;return u=new a.default(n.hlsOpts),n.hls=u,Object.defineProperty(i,"src",{get:function(){return i.currentSrc},set:function(e){r.removeClass(i.root,"xgplayer-is-live");var t=document.querySelector(".xgplayer-live");t&&t.parentNode.removeChild(t),i.autoplay=!0,i.paused||i.pause(),i.hls.stopLoad(),i.hls.detachMedia(),i.hls.destroy(),i.hls=new a.default(i.hlsOpts),i.register(e),i.once("canplay",function(){i.play().catch(function(e){})}),i.hls.loadSource(e),i.hls.attachMedia(i.video)},configurable:!0}),n.register(n.config.url),n.once("complete",function(){u.attachMedia(i.video),i.once("canplay",function(){i.play().catch(function(e){})})}),n.once("destroy",function(){u.stopLoad()}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),i(t,[{key:"switchURL",value:function(e){var t=this;t.url=e,t.config.url=e;var n=t.currentTime;o.default.util.addClass(t.root,"xgplayer-is-enter"),t.once("playing",function(){o.default.util.removeClass(t.root,"xgplayer-is-enter")}),t.once("canplay",function(){t.currentTime=n,t.play()}),"object"===r(t.hls)&&(t.hls.originUrl=e),t.src=e}},{key:"register",value:function(e){var t=this.hls,n=o.default.util,r=this;t.on(a.default.Events.MEDIA_ATTACHED,function(){t.loadSource(e)}),t.on(a.default.Events.LEVEL_LOADED,function(e,i){if(!t.inited&&(t.inited=!0,i&&i.details&&i.details.live&&(n.addClass(r.root,"xgplayer-is-live"),!n.findDom(r.root,".xgplayer-live")))){var o=n.createDom("xg-live","正在直播",{},"xgplayer-live");r.controls.appendChild(o)}}),t.on(a.default.Events.ERROR,function(e,n){if(r.emit("HLS_ERROR",{errorType:n.type,errorDetails:n.details,errorFatal:n.fatal}),n.fatal)switch(n.type){case a.default.ErrorTypes.NETWORK_ERROR:t.startLoad();break;case a.default.ErrorTypes.MEDIA_ERROR:t.recoverMediaError();break;default:r.emit("error",n)}}),this._statistics()}},{key:"_statistics",value:function(){var e={speed:0,playerType:"HlsPlayer"},t={videoDataRate:0,audioDataRate:0},n=this.hls,r=this;n.on(a.default.Events.FRAG_LOAD_PROGRESS,function(t,n){e.speed=n.stats.loaded/1e3}),n.on(a.default.Events.FRAG_PARSING_DATA,function(e,n){"video"===n.type&&(t.fps=parseInt(n.nb/(n.endPTS-n.startPTS)))}),n.on(a.default.Events.FRAG_PARSING_INIT_SEGMENT,function(e,n){if(t.hasAudio=!!(n&&n.tracks&&n.tracks.audio),t.hasVideo=!!(n&&n.tracks&&n.tracks.video),t.hasAudio&&n.tracks.audio){var i=n.tracks.audio;t.audioChannelCount=i.metadata&&i.metadata.channelCount?i.metadata.channelCount:0,t.audioCodec=i.codec}if(t.hasVideo&&n.tracks.video){var o=n.tracks.video;t.videoCodec=o.codec,t.width=o.metadata&&o.metadata.width?o.metadata.width:0,t.height=o.metadata&&o.metadata.height?o.metadata.height:0}t.duration=n.frag&&n.frag.duration?n.frag.duration:0,t.level=n.frag&&n.frag.level?n.frag.level:0,(t.videoCodec||t.audioCodec)&&(t.mimeType='video/hls; codecs="'+t.videoCodec+";"+t.audioCodec+'"'),r.mediainfo=t,r.emit("media_info",t)}),this._statisticsTimmer=setInterval(function(){r.emit("statistics_info",e),e.speed=0},1e3)}},{key:"destroy",value:function(){(function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),clearInterval(this._statisticsTimmer)}}]),t}();c.isSupported=a.default.isSupported,t.default=c,e.exports=t.default},function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(8)),o=n(2),a=y(n(15)),s=y(n(38)),u=y(n(39)),l=n(6),c=y(n(40)),d=y(n(57)),f=y(n(58)),p=n(59),h=n(0),g=n(60),v=y(n(1)),m=n(24);function y(e){return e&&e.__esModule?e:{default:e}}var _=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=t.DefaultConfig;if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var i in r)i in e||(e[i]=r[i]);if(void 0!==e.liveMaxLatencyDurationCount&&e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(e.liveMaxLatencyDuration<=e.liveSyncDuration||void 0===e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,h.enableLogs)(e.debug),n.config=e,n._autoLevelCapping=-1;var o=n.abrController=new e.abrController(n),p=new e.bufferController(n),g=new e.capLevelController(n),v=new e.fpsController(n),m=new a.default(n),y=new s.default(n),_=new u.default(n),b=new f.default(n),S=n.levelController=new d.default(n),k=new l.FragmentTracker(n),w=[S,n.streamController=new c.default(n,k)],E=e.audioStreamController;E&&w.push(new E(n,k)),n.networkControllers=w;var T=[m,y,_,o,p,g,v,b,k];if(E=e.audioTrackController){var x=new E(n);n.audioTrackController=x,T.push(x)}if(E=e.subtitleTrackController){var C=new E(n);n.subtitleTrackController=C,w.push(C)}if(E=e.emeController){var I=new E(n);n.emeController=I,T.push(I)}return(E=e.subtitleStreamController)&&w.push(new E(n,k)),(E=e.timelineController)&&T.push(new E(n)),n.coreComponents=T,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,m.Observer),r(t,null,[{key:"isSupported",value:function(){return(0,p.isSupported)()}},{key:"version",get:function(){return __VERSION__}},{key:"Events",get:function(){return v.default}},{key:"ErrorTypes",get:function(){return o.ErrorTypes}},{key:"ErrorDetails",get:function(){return o.ErrorDetails}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:g.hlsDefaultConfig},set:function(e){t.defaultConfig=e}}]),r(t,[{key:"destroy",value:function(){h.logger.log("destroy"),this.trigger(v.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1}},{key:"attachMedia",value:function(e){h.logger.log("attachMedia"),this.media=e,this.trigger(v.default.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){h.logger.log("detachMedia"),this.trigger(v.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){e=i.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),h.logger.log("loadSource:"+e),this.url=e,this.trigger(v.default.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;h.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})}},{key:"stopLoad",value:function(){h.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})}},{key:"swapAudioCodec",value:function(){h.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){h.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){h.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){h.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){h.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){h.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){h.logger.log("set startLevel:"+e);-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){h.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,n=e?e.length:0,r=0;r<n;r++){if((e[r].realBitrate?Math.max(e[r].realBitrate,e[r].bitrate):e[r].bitrate)>t)return r}return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),t}();t.default=_,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(8)),o=d(n(11)),a=d(n(36)),s=d(n(17)),u=d(n(37)),l=n(0),c=n(18);function d(e){return e&&e.__esModule?e:{default:e}}var f=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,p=/#EXT-X-MEDIA:(.*)/g,h=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),g=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,v=/\.(mp4|m4s|m4v|m4a)$/i,m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"findGroup",value:function(e,t){if(!e)return null;for(var n=null,r=0;r<e.length;r++){var i=e[r];i.id===t&&(n=i)}return n}},{key:"convertAVC1ToAVCOTI",value:function(e){var t=void 0,n=e.split(".");return n.length>2?(t=n.shift()+".",t+=parseInt(n.shift()).toString(16),t+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):t=e,t}},{key:"resolve",value:function(e,t){return i.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function(t,n){var r=[],i=void 0;function o(e,t){["video","audio"].forEach(function(n){var r=e.filter(function(e){return(0,c.isCodecType)(e,n)});if(r.length){var i=r.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});t[n+"Codec"]=i.length>0?i[0]:r[0],e=e.filter(function(e){return-1===r.indexOf(e)})}}),t.unknownCodecs=e}for(f.lastIndex=0;null!=(i=f.exec(t));){var a={},s=a.attrs=new u.default(i[1]);a.url=e.resolve(i[2],n);var l=s.decimalResolution("RESOLUTION");l&&(a.width=l.width,a.height=l.height),a.bitrate=s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),a.name=s.NAME,o([].concat((s.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=e.convertAVC1ToAVCOTI(a.videoCodec)),r.push(a)}return r}},{key:"parseMasterPlaylistMedia",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=void 0,a=[],s=0;for(p.lastIndex=0;null!==(o=p.exec(t));){var l={},c=new u.default(o[1]);if(c.TYPE===r){if(l.groupId=c["GROUP-ID"],l.name=c.NAME,l.type=r,l.default="YES"===c.DEFAULT,l.autoselect="YES"===c.AUTOSELECT,l.forced="YES"===c.FORCED,c.URI&&(l.url=e.resolve(c.URI,n)),l.lang=c.LANGUAGE,l.name||(l.name=l.lang),i.length){var d=e.findGroup(i,l.groupId);l.audioCodec=d?d.codec:i[0].codec}l.id=s++,a.push(l)}}return a}},{key:"parseLevelPlaylist",value:function(e,t,n,r,i){var c=0,d=0,f=new a.default(t),p=new s.default,m=0,_=null,b=new o.default,S=void 0,k=void 0,w=null;for(h.lastIndex=0;null!==(S=h.exec(e));){var E=S[1];if(E){b.duration=parseFloat(E);var T=(" "+S[2]).slice(1);b.title=T||null,b.tagList.push(T?["INF",E,T]:["INF",E])}else if(S[3]){if(Number.isFinite(b.duration)){var x=c++;b.type=r,b.start=d,b.levelkey=p,b.sn=x,b.level=n,b.cc=m,b.urlId=i,b.baseurl=t,b.relurl=(" "+S[3]).slice(1),y(b,_),f.fragments.push(b),_=b,d+=b.duration,b=new o.default}}else if(S[4]){if(b.rawByteRange=(" "+S[4]).slice(1),_){var C=_.byteRangeEndOffset;C&&(b.lastByteRangeEndOffset=C)}}else if(S[5])b.rawProgramDateTime=(" "+S[5]).slice(1),b.tagList.push(["PROGRAM-DATE-TIME",b.rawProgramDateTime]),null===w&&(w=f.fragments.length);else{for(S=S[0].match(g),k=1;k<S.length&&void 0===S[k];k++);var I=(" "+S[k+1]).slice(1),R=(" "+S[k+2]).slice(1);switch(S[k]){case"#":b.tagList.push(R?[I,R]:[I]);break;case"PLAYLIST-TYPE":f.type=I.toUpperCase();break;case"MEDIA-SEQUENCE":c=f.startSN=parseInt(I);break;case"TARGETDURATION":f.targetduration=parseFloat(I);break;case"VERSION":f.version=parseInt(I);break;case"EXTM3U":break;case"ENDLIST":f.live=!1;break;case"DIS":m++,b.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":m=parseInt(I);break;case"KEY":var A=I,O=new u.default(A),M=O.enumeratedString("METHOD"),D=O.URI,L=O.hexadecimalInteger("IV");M&&(p=new s.default,D&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(M)>=0&&(p.method=M,p.baseuri=t,p.reluri=D,p.key=null,p.iv=L));break;case"START":var P=I,N=new u.default(P).decimalFloatingPoint("TIME-OFFSET");Number.isFinite(N)&&(f.startTimeOffset=N);break;case"MAP":var U=new u.default(I);b.relurl=U.URI,b.rawByteRange=U.BYTERANGE,b.baseurl=t,b.level=n,b.type=r,b.sn="initSegment",f.initSegment=b,(b=new o.default).rawProgramDateTime=f.initSegment.rawProgramDateTime;break;default:l.logger.warn("line parsed but not handled: "+S)}}}return(b=_)&&!b.relurl&&(f.fragments.pop(),d-=b.duration),f.totalduration=d,f.averagetargetduration=d/f.fragments.length,f.endSN=c-1,f.startCC=f.fragments[0]?f.fragments[0].cc:0,f.endCC=m,!f.initSegment&&f.fragments.length&&f.fragments.every(function(e){return v.test(e.relurl)})&&(l.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(b=new o.default).relurl=f.fragments[0].relurl,b.baseurl=t,b.level=n,b.type=r,b.sn="initSegment",f.initSegment=b,f.needSidxRanges=!0),w&&function(e,t){for(var n=e[t],r=t-1;r>=0;r--){var i=e[r];i.programDateTime=n.programDateTime-1e3*i.duration,n=i}}(f.fragments,w),f}}]),e}();function y(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Number.isFinite(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}t.default=m,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=t,this.version=null}return r(e,[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Number.isFinite(this.fragments[0].programDateTime))}}]),e}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=/^(\d+)x(\d+)$/,o=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,a=function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(n)&&(this[n]=t[n])}return r(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=i.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){var t=void 0,n={};for(o.lastIndex=0;null!==(t=o.exec(e));){var r=t[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n}}]),e}();t.default=a,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=u(n(1)),o=u(n(3)),a=n(2),s=n(0);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.default.FRAG_LOADING));return n.loaders={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"destroy",value:function(){var e=this.loaders;for(var n in e){var r=e[n];r&&r.destroy()}this.loaders={},function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag,n=t.type,r=this.loaders,i=this.hls.config,o=i.fLoader,a=i.loader;t.loaded=0;var u=r[n];u&&(s.logger.warn("abort previous fragment loader for type: "+n),u.abort()),u=r[n]=t.loader=i.fLoader?new o(i):new a(i);var l,c,d=void 0;d={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var f=t.byteRangeStartOffset,p=t.byteRangeEndOffset;Number.isFinite(f)&&Number.isFinite(p)&&(d.rangeStart=f,d.rangeEnd=p),l={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},u.load(d,l,c)}},{key:"loadsuccess",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=e.data,a=n.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(i.default.FRAG_LOADED,{payload:o,frag:a,stats:t,networkDetails:r})}},{key:"loaderror",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.frag,o=r.loader;o&&o.abort(),this.loaders[r.type]=void 0,this.hls.trigger(i.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:n})}},{key:"loadtimeout",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.frag,o=r.loader;o&&o.abort(),this.loaders[r.type]=void 0,this.hls.trigger(i.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:n})}},{key:"loadprogress",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=t.frag;o.loaded=e.loaded,this.hls.trigger(i.default.FRAG_LOAD_PROGRESS,{frag:o,stats:e,networkDetails:r})}}]),t}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=u(n(1)),o=u(n(3)),a=n(2),s=n(0);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.default.KEY_LOADING));return n.loaders={},n.decryptkey=null,n.decrypturl=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},o.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(e){var t=e.frag,n=t.type,r=this.loaders[n],o=t.decryptdata,a=o.uri;if(a!==this.decrypturl||null===this.decryptkey){var u=this.hls.config;r&&(s.logger.warn("abort previous key loader for type:"+n),r.abort()),t.loader=this.loaders[n]=new u.loader(u),this.decrypturl=a,this.decryptkey=null;var l,c,d;l={url:a,frag:t,responseType:"arraybuffer"},c={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(l,c,d)}else this.decryptkey&&(o.key=this.decryptkey,this.hls.trigger(i.default.KEY_LOADED,{frag:t}))}},{key:"loadsuccess",value:function(e,t,n){var r=n.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(i.default.KEY_LOADED,{frag:r})}},{key:"loaderror",value:function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(i.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})}},{key:"loadtimeout",value:function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(i.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})}}]),t}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=b(n(9)),o=n(4),a=b(n(19)),s=b(n(1)),u=n(6),l=b(n(11)),c=b(n(15)),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(7)),f=b(n(25)),p=n(2),h=n(0),g=n(26),v=n(27),m=b(n(56)),y=n(14),_=b(y);function b(e){return e&&e.__esModule?e:{default:e}}var S=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s.default.MEDIA_ATTACHED,s.default.MEDIA_DETACHING,s.default.MANIFEST_LOADING,s.default.MANIFEST_PARSED,s.default.LEVEL_LOADED,s.default.KEY_LOADED,s.default.FRAG_LOADED,s.default.FRAG_LOAD_EMERGENCY_ABORTED,s.default.FRAG_PARSING_INIT_SEGMENT,s.default.FRAG_PARSING_DATA,s.default.FRAG_PARSED,s.default.ERROR,s.default.AUDIO_TRACK_SWITCHING,s.default.AUDIO_TRACK_SWITCHED,s.default.BUFFER_CREATED,s.default.BUFFER_APPENDED,s.default.BUFFER_FLUSHED));return r.fragmentTracker=n,r.config=e.config,r.audioCodecSwap=!1,r._state=y.State.STOPPED,r.stallReported=!1,r.gapController=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,_.default),r(t,[{key:"startLoad",value:function(e){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(r=0,this.bitrateTest=!0),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}t>0&&-1===e&&(h.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=y.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=y.State.STOPPED}},{key:"stopLoad",value:function(){this.forceStartLoad=!1,function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stopLoad",this).call(this)}},{key:"doTick",value:function(){switch(this.state){case y.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case y.State.IDLE:this._doTickIdle();break;case y.State.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=y.State.IDLE);break;case y.State.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),n=this.retryDate;(!n||t>=n||this.media&&this.media.seeking)&&(h.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=y.State.IDLE);break;case y.State.ERROR:case y.State.STOPPED:case y.State.FRAG_LOADING:case y.State.PARSING:case y.State.PARSED:case y.State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var e=this.hls,t=e.config,n=this.media;if(void 0!==this.levelLastLoaded&&(n||!this.startFragRequested&&t.startFragPrefetch)){var r=void 0;r=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var i=e.nextLoadLevel,a=this.levels[i];if(a){var u=a.bitrate,l=void 0;l=u?Math.max(8*t.maxBufferSize/u,t.maxBufferLength):t.maxBufferLength,l=Math.min(l,t.maxMaxBufferLength);var c=o.BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,r,t.maxBufferHole),d=c.len;if(!(d>=l)){h.logger.trace("buffer length of "+d.toFixed(3)+" is below max of "+l.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i;var f=a.details;if(!f||f.live&&this.levelLastLoaded!==i)this.state=y.State.WAITING_LEVEL;else{if(this._streamEnded(c,f)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(s.default.BUFFER_EOS,p),void(this.state=y.State.ENDED)}this._fetchPayloadOrEos(r,c,f)}}}}}},{key:"_fetchPayloadOrEos",value:function(e,t,n){var r=this.fragPrevious,i=this.level,o=n.fragments,a=o.length;if(0!==a){var s=o[0].start,u=o[a-1].start+o[a-1].duration,l=t.end,c=void 0;if(n.initSegment&&!n.initSegment.data)c=n.initSegment;else if(n.live){var d=this.config.initialLiveManifestSize;if(a<d)return void h.logger.warn("Can not start playback of a level, reason: not enough fragments "+a+" < "+d);if(null===(c=this._ensureFragmentAtLivePoint(n,l,s,u,r,o,a)))return}else l<s&&(c=o[0]);c||(c=this._findFragment(s,r,a,o,l,u,n)),c&&(c.encrypted?(h.logger.log("Loading key for "+c.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+i),this._loadKey(c)):(h.logger.log("Loading "+c.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+i+", currentTime:"+e.toFixed(3)+",bufferEnd:"+l.toFixed(3)),this._loadFragment(c)))}}},{key:"_ensureFragmentAtLivePoint",value:function(e,t,n,r,o,a,s){var u=this.hls.config,l=this.media,c=void 0,d=void 0!==u.liveMaxLatencyDuration?u.liveMaxLatencyDuration:u.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(n-u.maxFragLookUpTolerance,r-d)){var f=this.liveSyncPosition=this.computeLivePosition(n,e);h.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+f.toFixed(3)),t=f,l&&l.readyState&&l.duration>f&&(l.currentTime=f),this.nextLoadPosition=f}if(e.PTSKnown&&t>r&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(o)if(e.hasProgramDateTime)h.logger.log("live playlist, switching playlist, load frag with same PDT: "+o.programDateTime),c=(0,v.findFragmentByPDT)(a,o.endProgramDateTime,u.maxFragLookUpTolerance);else{var p=o.sn+1;if(p>=e.startSN&&p<=e.endSN){var g=a[p-e.startSN];o.cc===g.cc&&(c=g,h.logger.log("live playlist, switching playlist, load frag with next SN: "+c.sn))}c||(c=i.default.search(a,function(e){return o.cc-e.cc}))&&h.logger.log("live playlist, switching playlist, load frag with same CC: "+c.sn)}c||(c=a[Math.min(s-1,Math.round(s/2))],h.logger.log("live playlist, switching playlist, unknown, load middle frag : "+c.sn))}return c}},{key:"_findFragment",value:function(e,t,n,r,i,o,a){var s=this.hls.config,u=void 0;if(i<o){var l=i>o-s.maxFragLookUpTolerance?0:s.maxFragLookUpTolerance;u=(0,v.findFragmentByPTS)(t,r,i,l)}else u=r[n-1];if(u){var c=u.sn-a.startSN,d=t&&u.level===t.level,f=r[c-1],p=r[c+1];if(t&&u.sn===t.sn)if(d&&!u.backtracked)if(u.sn<a.endSN){var g=t.deltaPTS;g&&g>s.maxBufferHole&&t.dropped&&c?(u=f,h.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(u=p,h.logger.log("SN just loaded, load next one: "+u.sn,u))}else u=null;else u.backtracked&&(p&&p.backtracked?(h.logger.warn("Already backtracked from fragment "+p.sn+", will not backtrack to fragment "+u.sn+". Loading fragment "+p.sn),u=p):(h.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),u.dropped=0,f?(u=f).backtracked=!0:c&&(u=null)))}return u}},{key:"_loadKey",value:function(e){this.state=y.State.KEY_LOADING,this.hls.trigger(s.default.KEY_LOADING,{frag:e})}},{key:"_loadFragment",value:function(e){var t=this.fragmentTracker.getState(e);this.fragCurrent=e,this.startFragRequested=!0,Number.isFinite(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||t===u.FragmentState.NOT_LOADED||t===u.FragmentState.PARTIAL?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(s.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new a.default(this.hls,"main")),this.state=y.State.FRAG_LOADING):t===u.FragmentState.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)}},{key:"getBufferedFrag",value:function(e){return this.fragmentTracker.getBufferedFrag(e,c.default.LevelType.MAIN)}},{key:"followingBufferedFrag",value:function(e){return e?this.getBufferedFrag(e.endPTS+.5):null}},{key:"_checkFragmentChanged",value:function(){var e=void 0,t=void 0,n=this.media;if(n&&n.readyState&&!1===n.seeking&&((t=n.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),o.BufferHelper.isBuffered(n,t)?e=this.getBufferedFrag(t):o.BufferHelper.isBuffered(n,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var r=e;if(r!==this.fragPlaying){this.hls.trigger(s.default.FRAG_CHANGED,{frag:r});var i=r.level;this.fragPlaying&&this.fragPlaying.level===i||this.hls.trigger(s.default.LEVEL_SWITCHED,{level:i}),this.fragPlaying=r}}}},{key:"immediateLevelSwitch",value:function(){if(h.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,o.BufferHelper.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var e=this.media;if(e&&e.readyState){var t,n=void 0,r=void 0;if((t=this.getBufferedFrag(e.currentTime))&&t.startPTS>1&&this.flushMainBuffer(0,t.startPTS-1),e.paused)n=0;else{var i=this.hls.nextLoadLevel,o=this.levels[i],a=this.fragLastKbps;n=a&&this.fragCurrent?this.fragCurrent.duration*o.bitrate/(1e3*a)+1:0}if((r=this.getBufferedFrag(e.currentTime+n))&&(r=this.followingBufferedFrag(r))){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(r.maxStartPTS,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(e,t){this.state=y.State.BUFFER_FLUSHING;var n={startOffset:e,endOffset:t};this.altAudio&&(n.type="video"),this.hls.trigger(s.default.BUFFER_FLUSHING,n)}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition),this.gapController=new m.default(n,t,this.fragmentTracker,this.hls)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(h.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeked",value:function(){var e=this.media,t=e?e.currentTime:void 0;Number.isFinite(t)&&h.logger.log("media seeked to "+t.toFixed(3)),this.tick()}},{key:"onManifestLoading",value:function(){h.logger.log("trigger BUFFER_RESET"),this.hls.trigger(s.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(e){var t=!1,n=!1,r=void 0;e.levels.forEach(function(e){(r=e.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(t=!0),-1!==r.indexOf("mp4a.40.5")&&(n=!0))}),this.audioCodecSwitch=t&&n,this.audioCodecSwitch&&h.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1;var i=this.config;(i.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(i.startPosition)}},{key:"onLevelLoaded",value:function(e){var t=e.details,n=e.level,r=this.levels[this.levelLastLoaded],i=this.levels[n],o=t.totalduration,a=0;if(h.logger.log("level "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+o),t.live){var u=i.details;u&&t.fragments.length>0?(d.mergeDetails(u,t),a=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,u),t.PTSKnown&&Number.isFinite(a)?h.logger.log("live playlist sliding:"+a.toFixed(3)):(h.logger.log("live playlist - outdated PTS, unknown sliding"),(0,g.alignStream)(this.fragPrevious,r,t))):(h.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,(0,g.alignStream)(this.fragPrevious,r,t))}else t.PTSKnown=!1;if(i.details=t,this.levelLastLoaded=n,this.hls.trigger(s.default.LEVEL_UPDATED,{details:t,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var l=t.startTimeOffset;Number.isFinite(l)?(l<0&&(h.logger.log("negative start time offset "+l+", count from end of last fragment"),l=a+o+l),h.logger.log("start time offset found in playlist, adjust startPosition to "+l),this.startPosition=l):t.live?(this.startPosition=this.computeLivePosition(a,t),h.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===y.State.WAITING_LEVEL&&(this.state=y.State.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===y.State.KEY_LOADING&&(this.state=y.State.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent,n=this.hls,r=this.levels,i=this.media,o=e.frag;if(this.state===y.State.FRAG_LOADING&&t&&"main"===o.type&&o.level===t.level&&o.sn===t.sn){var u=e.stats,l=r[t.level],c=l.details;if(this.bitrateTest=!1,this.stats=u,h.logger.log("Loaded "+t.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+t.level),o.bitrateTest&&n.nextLoadLevel)this.state=y.State.IDLE,this.startFragRequested=!1,u.tparsed=u.tbuffered=window.performance.now(),n.trigger(s.default.FRAG_BUFFERED,{stats:u,frag:t,id:"main"}),this.tick();else if("initSegment"===o.sn)this.state=y.State.IDLE,u.tparsed=u.tbuffered=window.performance.now(),c.initSegment.data=e.payload,n.trigger(s.default.FRAG_BUFFERED,{stats:u,frag:t,id:"main"}),this.tick();else{h.logger.log("Parsing "+t.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+t.level+", cc "+t.cc),this.state=y.State.PARSING,this.pendingBuffering=!0,this.appended=!1,o.bitrateTest&&(o.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:o}));var d=!(i&&i.seeking)&&(c.PTSKnown||!c.live),f=c.initSegment?c.initSegment.data:[],p=this._getAudioCodec(l);(this.demuxer=this.demuxer||new a.default(this.hls,"main")).push(e.payload,f,p,l.videoCodec,t,c.totalduration,d)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent,n=e.frag;if(t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===y.State.PARSING){var r=e.tracks,i=void 0,o=void 0;if(r.audio&&this.altAudio&&delete r.audio,o=r.audio){var a=this.levels[this.level].audioCodec,u=navigator.userAgent.toLowerCase();a&&this.audioCodecSwap&&(h.logger.log("swapping playlist audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==o.metadata.channelCount&&-1===u.indexOf("firefox")&&(a="mp4a.40.5"),-1!==u.indexOf("android")&&"audio/mpeg"!==o.container&&(a="mp4a.40.2",h.logger.log("Android: force audio codec to "+a)),o.levelCodec=a,o.id=e.id}for(i in(o=r.video)&&(o.levelCodec=this.levels[this.level].videoCodec,o.id=e.id),this.hls.trigger(s.default.BUFFER_CODECS,r),r){o=r[i],h.logger.log("main track:"+i+",container:"+o.container+",codecs[level/parsed]=["+o.levelCodec+"/"+o.codec+"]");var l=o.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(s.default.BUFFER_APPENDING,{type:i,data:l,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"main"===e.id&&r.sn===n.sn&&r.level===n.level&&("audio"!==e.type||!this.altAudio)&&this.state===y.State.PARSING){var i=this.levels[this.level],o=n;if(Number.isFinite(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),!0===e.hasAudio&&o.addElementaryStream(l.default.ElementaryStreamTypes.AUDIO),!0===e.hasVideo&&o.addElementaryStream(l.default.ElementaryStreamTypes.VIDEO),h.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(o.dropped=e.dropped,o.dropped)if(o.backtracked)h.logger.warn("Already backtracked on this fragment, appending with the gap",o.sn);else{var a=i.details;if(!a||o.sn!==a.startSN)return h.logger.warn("missing video frame(s), backtracking fragment",o.sn),this.fragmentTracker.removeFragment(o),o.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=y.State.IDLE,this.fragPrevious=o,void this.tick();h.logger.warn("missing video frame(s) on first frag, appending with gap",o.sn)}else o.backtracked=!1;var u=d.updateFragPTSDTS(i.details,o,e.startPTS,e.endPTS,e.startDTS,e.endDTS),c=this.hls;c.trigger(s.default.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:u,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(n){n&&n.length&&t.state===y.State.PARSING&&(t.appended=!0,t.pendingBuffering=!0,c.trigger(s.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent,n=e.frag;t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===y.State.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=y.State.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url,n=e.id;if(!t){if(this.mediaBuffer!==this.media){h.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var r=this.fragCurrent;r.loader&&(h.logger.log("switching to main audio track, cancel main fragment load"),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.State.IDLE}var i=this.hls;i.trigger(s.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),i.trigger(s.default.AUDIO_TRACK_SWITCHED,{id:n}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(e){var t=e.id,n=!!this.hls.audioTracks[t].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(h.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()}},{key:"onBufferCreated",value:function(e){var t=e.tracks,n=void 0,r=void 0,i=!1;for(var o in t){var a=t[o];"main"===a.id?(r=o,n=a,"video"===o&&(this.videoBuffer=t[o].buffer)):i=!0}i&&n?(h.logger.log("alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(e){if("main"===e.parent){var t=this.state;t!==y.State.PARSING&&t!==y.State.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==y.State.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;h.logger.log("main buffered : "+f.default.toString(t.buffered)),this.fragPrevious=e;var n=this.stats;n.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*n.total/(n.tbuffered-n.tfirst)),this.hls.trigger(s.default.FRAG_BUFFERED,{stats:n,frag:e,id:"main"}),this.state=y.State.IDLE}this.tick()}}},{key:"onError",value:function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var n=!!this.media&&o.BufferHelper.isBuffered(this.media,this.media.currentTime)&&o.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var r=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);h.logger.warn("mediaController: frag loading failed, retry in "+r+" ms"),this.retryDate=window.performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=y.State.FRAG_LOADING_WAITING_RETRY}else h.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=y.State.ERROR;break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==y.State.ERROR&&(e.fatal?(this.state=y.State.ERROR,h.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==y.State.WAITING_LEVEL||(this.state=y.State.IDLE));break;case p.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==y.State.PARSING&&this.state!==y.State.PARSED||(n?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=y.State.IDLE):(h.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,h.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)}},{key:"_checkBuffer",value:function(){var e=this.media;if(e&&0!==e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t)}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=y.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;e&&this.fragmentTracker.detectEvictedFragments(l.default.ElementaryStreamTypes.VIDEO,e.buffered),this.state=y.State.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(e,t){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-n)}},{key:"_seekToStartPos",value:function(){var e=this.media,t=e.currentTime,n=e.seeking?t:this.startPosition;t!==n&&(h.logger.log("target start position not buffered, seek to buffered.start(0) "+n+" from current time "+t+" "),e.currentTime=n)}},{key:"_getAudioCodec",value:function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(h.logger.log("swapping playlist audio codec"),t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,h.logger.log("main stream:"+t+"->"+e),this.hls.trigger(s.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}();t.default=S,e.exports=t.default},function(e,t,n){function r(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n.oe=function(e){throw console.error(e),e};var r=n(n.s=ENTRY_MODULE);return r.default||r}var i="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+i+").*?\\)";function a(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t,r){var s={};s[r]=[];var u=t.toString(),l=u.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return s;for(var c,d=l[1],f=new RegExp("(\\\\n|\\W)"+a(d)+o,"g");c=f.exec(u);)"dll-reference"!==c[3]&&s[r].push(c[3]);for(f=new RegExp("\\("+a(d)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+o,"g");c=f.exec(u);)e[c[2]]||(s[r].push(c[1]),e[c[2]]=n(c[1]).m),s[c[2]]=s[c[2]]||[],s[c[2]].push(c[4]);for(var p,h=Object.keys(s),g=0;g<h.length;g++)for(var v=0;v<s[h[g]].length;v++)p=s[h[g]][v],isNaN(1*p)||(s[h[g]][v]=1*s[h[g]][v]);return s}function u(e){return Object.keys(e).reduce(function(t,n){return t||e[n].length>0},!1)}e.exports=function(e,t){t=t||{};var i={main:n.m},o=t.all?{main:Object.keys(i.main)}:function(e,t){for(var n={main:[t]},r={main:[]},i={main:{}};u(n);)for(var o=Object.keys(n),a=0;a<o.length;a++){var l=o[a],c=n[l].pop();if(i[l]=i[l]||{},!i[l][c]&&e[l][c]){i[l][c]=!0,r[l]=r[l]||[],r[l].push(c);for(var d=s(e,e[l][c],l),f=Object.keys(d),p=0;p<f.length;p++)n[f[p]]=n[f[p]]||[],n[f[p]]=n[f[p]].concat(d[f[p]])}}return r}(i,e),a="";Object.keys(o).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;o[e][t];)t++;o[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map(function(t){return JSON.stringify(t)+": "+i[e][t].toString()}).join(",")+"});\n"}),a=a+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map(function(e){return JSON.stringify(e)+": "+i.main[e].toString()}).join(",")+"}))(self);";var l=new window.Blob([a],{type:"text/javascript"});if(t.bare)return l;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(l),d=new window.Worker(c);return d.objectURL=c,d}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subtle=t,this.aesIV=n}return r(e,[{key:"decrypt",value:function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}]),e}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subtle=t,this.key=n}return r(e,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),e}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e){var t=e.byteLength,n=t&&new DataView(e).getUint8(t-1);return n?e.slice(0,t-n):e}t.removePadding=i;var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return r(e,[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<4;r++)n[r]=t.getUint32(4*r);return n}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],i=n[1],o=n[2],a=n[3],s=this.invSubMix,u=s[0],l=s[1],c=s[2],d=s[3],f=new Uint32Array(256),p=0,h=0,g=0;for(g=0;g<256;g++)f[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var v=h^h<<1^h<<2^h<<3^h<<4;v=v>>>8^255&v^99,e[p]=v,t[v]=p;var m=f[p],y=f[m],_=f[y],b=257*f[v]^16843008*v;r[p]=b<<24|b>>>8,i[p]=b<<16|b>>>16,o[p]=b<<8|b>>>24,a[p]=b,b=16843009*_^65537*y^257*m^16843008*p,u[v]=b<<24|b>>>8,l[v]=b<<16|b>>>16,c[v]=b<<8|b>>>24,d[v]=b,p?(p=m^f[f[f[_^m]]],h^=f[f[h]]):p=h=1}}},{key:"expandKey",value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var o=this.ksRows=4*(i+6+1),a=void 0,s=void 0,u=this.keySchedule=new Uint32Array(o),l=this.invKeySchedule=new Uint32Array(o),c=this.sBox,d=this.rcon,f=this.invSubMix,p=f[0],h=f[1],g=f[2],v=f[3],m=void 0,y=void 0;for(a=0;a<o;a++)a<i?m=u[a]=t[a]:(y=m,a%i==0?(y=c[(y=y<<8|y>>>24)>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y],y^=d[a/i|0]<<24):i>6&&a%i==4&&(y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y]),u[a]=m=(u[a-i]^y)>>>0);for(s=0;s<o;s++)a=o-s,y=3&s?u[a]:u[a-4],l[s]=s<4||a<=4?y:p[c[y>>>24]]^h[c[y>>>16&255]]^g[c[y>>>8&255]]^v[c[255&y]],l[s]=l[s]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,n,r){for(var o=this.keySize+6,a=this.invKeySchedule,s=this.invSBox,u=this.invSubMix,l=u[0],c=u[1],d=u[2],f=u[3],p=this.uint8ArrayToUint32Array_(n),h=p[0],g=p[1],v=p[2],m=p[3],y=new Int32Array(e),_=new Int32Array(y.length),b=void 0,S=void 0,k=void 0,w=void 0,E=void 0,T=void 0,x=void 0,C=void 0,I=void 0,R=void 0,A=void 0,O=void 0,M=void 0,D=void 0,L=this.networkToHostOrderSwap;t<y.length;){for(I=L(y[t]),R=L(y[t+1]),A=L(y[t+2]),O=L(y[t+3]),E=I^a[0],T=O^a[1],x=A^a[2],C=R^a[3],M=4,D=1;D<o;D++)b=l[E>>>24]^c[T>>16&255]^d[x>>8&255]^f[255&C]^a[M],S=l[T>>>24]^c[x>>16&255]^d[C>>8&255]^f[255&E]^a[M+1],k=l[x>>>24]^c[C>>16&255]^d[E>>8&255]^f[255&T]^a[M+2],w=l[C>>>24]^c[E>>16&255]^d[T>>8&255]^f[255&x]^a[M+3],E=b,T=S,x=k,C=w,M+=4;b=s[E>>>24]<<24^s[T>>16&255]<<16^s[x>>8&255]<<8^s[255&C]^a[M],S=s[T>>>24]<<24^s[x>>16&255]<<16^s[C>>8&255]<<8^s[255&E]^a[M+1],k=s[x>>>24]<<24^s[C>>16&255]<<16^s[E>>8&255]<<8^s[255&T]^a[M+2],w=s[C>>>24]<<24^s[E>>16&255]<<16^s[T>>8&255]<<8^s[255&x]^a[M+3],M+=3,_[t]=L(b^h),_[t+1]=L(w^g),_[t+2]=L(k^v),_[t+3]=L(S^m),h=I,g=R,v=A,m=O,t+=4}return r?i(_.buffer):_.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(22)),a=n(0),s=n(10),u=(r=s)&&r.__esModule?r:{default:r};var l=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=r,this.remuxer=n}return i(e,[{key:"resetInitSegment",value:function(e,t,n,r){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(e,t,n,r){for(var i=this._audioTrack,s=u.default.getID3Data(e,0)||[],l=u.default.getTimeStamp(s),c=Number.isFinite(l)?90*l:9e4*t,d=0,f=c,p=e.length,h=s.length,g=[{pts:f,dts:f,data:s}];h<p-1;)if(o.isHeader(e,h)&&h+5<p){o.initTrackConfig(i,this.observer,e,h,i.manifestCodec);var v=o.appendFrame(i,e,h,c,d);if(!v){a.logger.log("Unable to parse AAC frame");break}h+=v.length,f=v.sample.pts,d++}else u.default.isHeader(e,h)?(s=u.default.getID3Data(e,h),g.push({pts:f,dts:f,data:s}),h+=s.length):h++;this.remuxer.remux(i,{samples:[]},{samples:g,inputTimeScale:9e4},{samples:[]},t,n,r)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){if(!e)return!1;for(var t=(u.default.getID3Data(e,0)||[]).length,n=e.length;t<n;t++)if(o.probe(e,t))return a.logger.log("ADTS sync word found !"),!0;return!1}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(22)),o=d(n(23)),a=d(n(1)),s=d(n(47)),u=d(n(48)),l=n(0),c=n(2);function d(e){return e&&e.__esModule?e:{default:e}}var f={video:1,audio:2,id3:3,text:4},p=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=r,this.typeSupported=i,this.remuxer=n,this.sampleAes=null}return r(e,[{key:"setDecryptData",value:function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new u.default(this.observer,this.config,e,this.discardEPB):this.sampleAes=null}},{key:"resetInitSegment",value:function(t,n,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",i),this._audioTrack=e.createTrack("audio",i),this._id3Track=e.createTrack("id3",i),this._txtTrack=e.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=n,this.videoCodec=r,this._duration=i}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(t,n,r,i){var o=void 0,s=t.length,u=void 0,d=void 0,f=void 0,p=void 0,h=!1;this.contiguous=r;var g=this.pmtParsed,v=this._avcTrack,m=this._audioTrack,y=this._id3Track,_=v.pid,b=m.pid,S=y.pid,k=this._pmtId,w=v.pesData,E=m.pesData,T=y.pesData,x=this._parsePAT,C=this._parsePMT,I=this._parsePES,R=this._parseAVCPES.bind(this),A=this._parseAACPES.bind(this),O=this._parseMPEGPES.bind(this),M=this._parseID3PES.bind(this),D=e._syncOffset(t);for(s-=(s+D)%188,o=D;o<s;o+=188)if(71===t[o]){if(u=!!(64&t[o+1]),d=((31&t[o+1])<<8)+t[o+2],(48&t[o+3])>>4>1){if((f=o+5+t[o+4])===o+188)continue}else f=o+4;switch(d){case _:u&&(w&&(p=I(w))&&void 0!==p.pts&&R(p,!1),w={data:[],size:0}),w&&(w.data.push(t.subarray(f,o+188)),w.size+=o+188-f);break;case b:u&&(E&&(p=I(E))&&void 0!==p.pts&&(m.isAAC?A(p):O(p)),E={data:[],size:0}),E&&(E.data.push(t.subarray(f,o+188)),E.size+=o+188-f);break;case S:u&&(T&&(p=I(T))&&void 0!==p.pts&&M(p),T={data:[],size:0}),T&&(T.data.push(t.subarray(f,o+188)),T.size+=o+188-f);break;case 0:u&&(f+=t[f]+1),k=this._pmtId=x(t,f);break;case k:u&&(f+=t[f]+1);var L=C(t,f,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(_=L.avc)>0&&(v.pid=_),(b=L.audio)>0&&(m.pid=b,m.isAAC=L.isAAC),(S=L.id3)>0&&(y.pid=S),h&&!g&&(l.logger.log("reparse from beginning"),h=!1,o=D-188),g=this.pmtParsed=!0;break;case 17:case 8191:break;default:h=!0}}else this.observer.trigger(a.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});w&&(p=I(w))&&void 0!==p.pts?(R(p,!0),v.pesData=null):v.pesData=w,E&&(p=I(E))&&void 0!==p.pts?(m.isAAC?A(p):O(p),m.pesData=null):(E&&E.size&&l.logger.log("last AAC PES packet truncated,might overlap between fragments"),m.pesData=E),T&&(p=I(T))&&void 0!==p.pts?(M(p),y.pesData=null):y.pesData=T,null==this.sampleAes?this.remuxer.remux(m,v,y,this._txtTrack,n,r,i):this.decryptAndRemux(m,v,y,this._txtTrack,n,r,i)}},{key:"decryptAndRemux",value:function(e,t,n,r,i,o,a){if(e.samples&&e.isAAC){var s=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){s.decryptAndRemuxAvc(e,t,n,r,i,o,a)})}else this.decryptAndRemuxAvc(e,t,n,r,i,o,a)}},{key:"decryptAndRemuxAvc",value:function(e,t,n,r,i,o,a){if(t.samples){var s=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){s.remuxer.remux(e,t,n,r,i,o,a)})}else this.remuxer.remux(e,t,n,r,i,o,a)}},{key:"destroy",value:function(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){return(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t,n,r){var i,o=void 0,a={audio:-1,avc:-1,id3:-1,isAAC:!0};for(i=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<i;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!r){l.logger.log("unkown stream type:"+e[t]);break}case 15:-1===a.audio&&(a.audio=o);break;case 21:-1===a.id3&&(a.id3=o);break;case 219:if(!r){l.logger.log("unkown stream type:"+e[t]);break}case 27:-1===a.avc&&(a.avc=o);break;case 3:case 4:n?-1===a.audio&&(a.audio=o,a.isAAC=!1):l.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:l.logger.warn("HEVC stream type found, not supported for now");break;default:l.logger.log("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return a}},{key:"_parsePES",value:function(e){var t=0,n=void 0,r=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,d=e.data;if(!e||0===e.size)return null;for(;d[0].length<19&&d.length>1;){var f=new Uint8Array(d[0].length+d[1].length);f.set(d[0]),f.set(d[1],d[0].length),d[0]=f,d.splice(1,1)}if(1===((n=d[0])[0]<<16)+(n[1]<<8)+n[2]){if((i=(n[4]<<8)+n[5])&&i>e.size-6)return null;192&(r=n[7])&&((s=536870912*(14&n[9])+4194304*(255&n[10])+16384*(254&n[11])+128*(255&n[12])+(254&n[13])/2)>4294967295&&(s-=8589934592),64&r?((u=536870912*(14&n[14])+4194304*(255&n[15])+16384*(254&n[16])+128*(255&n[17])+(254&n[18])/2)>4294967295&&(u-=8589934592),s-u>54e5&&(l.logger.warn(Math.round((s-u)/9e4)+"s delta between PTS and DTS, align them"),s=u)):u=s),c=(o=n[8])+9,e.size-=c,a=new Uint8Array(e.size);for(var p=0,h=d.length;p<h;p++){var g=(n=d[p]).byteLength;if(c){if(c>g){c-=g;continue}n=n.subarray(c),g-=c,c=0}a.set(n,t),t+=g}return i&&(i-=o+3),{data:a,pts:s,dts:u,len:i}}return null}},{key:"pushAccesUnit",value:function(e,t){if(e.units.length&&e.frame){var n=t.samples,r=n.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(r||this.contiguous)?(e.id=r,n.push(e)):t.dropped++}e.debug.length&&l.logger.log(e.pts+"/"+e.dts+":"+e.debug)}},{key:"_parseAVCPES",value:function(e,t){var n=this,r=this._avcTrack,i=this._parseAVCNALu(e.data),o=void 0,a=this.avcSample,u=void 0,l=!1,c=void 0,d=this.pushAccesUnit.bind(this),f=function(e,t,n,r){return{key:e,pts:t,dts:n,units:[],debug:r}};e.data=null,a&&i.length&&!r.audFound&&(d(a,r),a=this.avcSample=f(!1,e.pts,e.dts,"")),i.forEach(function(t){switch(t.type){case 1:u=!0,a||(a=n.avcSample=f(!0,e.pts,e.dts,"")),a.frame=!0;var i=t.data;if(l&&i.length>4){var p=new s.default(i).readSliceType();2!==p&&4!==p&&7!==p&&9!==p||(a.key=!0)}break;case 5:u=!0,a||(a=n.avcSample=f(!0,e.pts,e.dts,"")),a.key=!0,a.frame=!0;break;case 6:u=!0,(o=new s.default(n.discardEPB(t.data))).readUByte();for(var h=0,g=0,v=!1,m=0;!v&&o.bytesAvailable>1;){h=0;do{h+=m=o.readUByte()}while(255===m);g=0;do{g+=m=o.readUByte()}while(255===m);if(4===h&&0!==o.bytesAvailable){if(v=!0,181===o.readUByte())if(49===o.readUShort())if(1195456820===o.readUInt())if(3===o.readUByte()){var y=o.readUByte(),_=31&y,b=[y,o.readUByte()];for(c=0;c<_;c++)b.push(o.readUByte()),b.push(o.readUByte()),b.push(o.readUByte());n._insertSampleInOrder(n._txtTrack.samples,{type:3,pts:e.pts,bytes:b})}}else if(g<o.bytesAvailable)for(c=0;c<g;c++)o.readUByte()}break;case 7:if(u=!0,l=!0,!r.sps){var S=(o=new s.default(t.data)).readSPS();r.width=S.width,r.height=S.height,r.pixelRatio=S.pixelRatio,r.sps=[t.data],r.duration=n._duration;var k=t.data.subarray(1,4),w="avc1.";for(c=0;c<3;c++){var E=k[c].toString(16);E.length<2&&(E="0"+E),w+=E}r.codec=w}break;case 8:u=!0,r.pps||(r.pps=[t.data]);break;case 9:u=!1,r.audFound=!0,a&&d(a,r),a=n.avcSample=f(!1,e.pts,e.dts,"");break;case 12:u=!1;break;default:u=!1,a&&(a.debug+="unknown NAL "+t.type+" ")}a&&u&&a.units.push(t)}),t&&a&&(d(a,r),this.avcSample=null)}},{key:"_insertSampleInOrder",value:function(e,t){var n=e.length;if(n>0){if(t.pts>=e[n-1].pts)e.push(t);else for(var r=n-1;r>=0;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)}},{key:"_getLastNalUnit",value:function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.length){var n=this._avcTrack.samples;e=n[n.length-1]}if(e){var r=e.units;t=r[r.length-1]}return t}},{key:"_parseAVCNALu",value:function(e){var t=0,n=e.byteLength,r=void 0,i=void 0,o=this._avcTrack,a=o.naluState||0,s=a,u=[],l=void 0,c=-1,d=void 0;for(-1===a&&(c=0,d=31&e[0],a=0,t=1);t<n;)if(r=e[t++],a)if(1!==a)if(r)if(1===r){if(c>=0)l={data:e.subarray(c,t-a-1),type:d},u.push(l);else{var f=this._getLastNalUnit();if(f&&(s&&t<=4-s&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-s)),(i=t-a-1)>0)){var p=new Uint8Array(f.data.byteLength+i);p.set(f.data,0),p.set(e.subarray(0,i),f.data.byteLength),f.data=p}}t<n?(c=t,d=31&e[t],a=0):a=-1}else a=0;else a=3;else a=r?0:2;else a=r?0:1;if(c>=0&&a>=0&&(l={data:e.subarray(c,n),type:d,state:a},u.push(l)),0===u.length){var h=this._getLastNalUnit();if(h){var g=new Uint8Array(h.data.byteLength+e.byteLength);g.set(h.data,0),g.set(e,h.data.byteLength),h.data=g}}return o.naluState=a,u}},{key:"discardEPB",value:function(e){for(var t,n=e.byteLength,r=[],i=1,o=void 0;i<n-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return e;t=n-r.length,o=new Uint8Array(t);var a=0;for(i=0;i<t;a++,i++)a===r[0]&&(a++,r.shift()),o[i]=e[a];return o}},{key:"_parseAACPES",value:function(e){var t,n,r=this._audioTrack,o=e.data,s=e.pts,u=this.aacOverFlow,d=this.aacLastPTS,f=void 0,p=void 0,h=void 0;if(u){var g=new Uint8Array(u.byteLength+o.byteLength);g.set(u,0),g.set(o,u.byteLength),o=g}for(p=0,n=o.length;p<n-1&&!i.isHeader(o,p);p++);if(p){var v=void 0,m=void 0;if(p<n-1?(v="AAC PES did not start with ADTS header,offset:"+p,m=!1):(v="no ADTS header found in AAC PES",m=!0),l.logger.warn("parsing error:"+v),this.observer.trigger(a.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:m,reason:v}),m)return}if(i.initTrackConfig(r,this.observer,o,p,this.audioCodec),f=0,t=i.getFrameDuration(r.samplerate),u&&d){var y=d+t;Math.abs(y-s)>1&&(l.logger.log("AAC: align PTS for overlapping frames by "+Math.round((y-s)/90)),s=y)}for(;p<n;)if(i.isHeader(o,p)&&p+5<n){var _=i.appendFrame(r,o,p,s,f);if(!_)break;p+=_.length,h=_.sample.pts,f++}else p++;u=p<n?o.subarray(p,n):null,this.aacOverFlow=u,this.aacLastPTS=h}},{key:"_parseMPEGPES",value:function(e){for(var t=e.data,n=t.length,r=0,i=0,a=e.pts;i<n;)if(o.default.isHeader(t,i)){var s=o.default.appendFrame(this._audioTrack,t,i,a,r);if(!s)break;i+=s.length,r++}else i++}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(t){var n=e._syncOffset(t);return!(n<0)&&(n&&l.logger.warn("MPEG2-TS detected but first sync word found @ offset "+n+", junk ahead ?"),!0)}},{key:"_syncOffset",value:function(e){for(var t=Math.min(1e3,e.length-564),n=0;n<t;){if(71===e[n]&&71===e[n+188]&&71===e[n+376])return n;n++}return-1}},{key:"createTrack",value:function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:f[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}}}]),e}();t.default=p,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0);var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return r(e,[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(e){var t=void 0;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&i.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?n<<t|this.readBits(t):n}},{key:"skipLZ",value:function(){var e=void 0;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t=8,n=8,r=void 0;for(r=0;r<e;r++)0!==n&&(n=(t+this.readEG()+256)%256),t=0===n?t:n}},{key:"readSPS",value:function(){var e,t,n,r,i=0,o=0,a=0,s=0,u=void 0,l=void 0,c=void 0,d=this.readUByte.bind(this),f=this.readBits.bind(this),p=this.readUEG.bind(this),h=this.readBoolean.bind(this),g=this.skipBits.bind(this),v=this.skipEG.bind(this),m=this.skipUEG.bind(this),y=this.skipScalingList.bind(this);if(d(),e=d(),f(5),g(3),d(),m(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var _=p();if(3===_&&g(1),m(),m(),g(1),h())for(l=3!==_?8:12,c=0;c<l;c++)h()&&y(c<6?16:64)}m();var b=p();if(0===b)p();else if(1===b)for(g(1),v(),v(),u=p(),c=0;c<u;c++)v();m(),g(1),t=p(),n=p(),0===(r=f(1))&&g(1),g(1),h()&&(i=p(),o=p(),a=p(),s=p());var S=[1,1];if(h()&&h())switch(d()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[d()<<8|d(),d()<<8|d()]}return{width:Math.ceil(16*(t+1)-2*i-2*o),height:(2-r)*(n+1)*16-(r?2:4)*(a+s),pixelRatio:S}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(12),a=(r=o)&&r.__esModule?r:{default:r};var s=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.decryptdata=r,this.discardEPB=i,this.decrypter=new a.default(t,n,{removePKCS7Padding:!1})}return i(e,[{key:"decryptBuffer",value:function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)}},{key:"decryptAacSample",value:function(e,t,n,r){var i=e[t].unit,o=i.subarray(16,i.length-i.length%16),a=o.buffer.slice(o.byteOffset,o.byteOffset+o.length),s=this;this.decryptBuffer(a,function(o){o=new Uint8Array(o),i.set(o,16),r||s.decryptAacSamples(e,t+1,n)})}},{key:"decryptAacSamples",value:function(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(e,t,n,r),!r)return}}}},{key:"getAvcEncryptedData",value:function(e){for(var t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t),r=0,i=32;i<=e.length-16;i+=160,r+=16)n.set(e.subarray(i,i+16),r);return n}},{key:"getAvcDecryptedUnit",value:function(e,t){t=new Uint8Array(t);for(var n=0,r=32;r<=e.length-16;r+=160,n+=16)e.set(t.subarray(n,n+16),r);return e}},{key:"decryptAvcSample",value:function(e,t,n,r,i,o){var a=this.discardEPB(i.data),s=this.getAvcEncryptedData(a),u=this;this.decryptBuffer(s.buffer,function(s){i.data=u.getAvcDecryptedUnit(a,s),o||u.decryptAvcSamples(e,t,n+1,r)})}},{key:"decryptAvcSamples",value:function(e,t,n,r){for(;;t++,n=0){if(t>=e.length)return void r();for(var i=e[t].units;!(n>=i.length);n++){var o=i[n];if(!(o.length<=48||1!==o.type&&5!==o.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(e,t,n,r,o,a),!a)return}}}}}]),e}();t.default=s,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=s(n(10)),o=n(0),a=s(n(23));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=r,this.remuxer=n}return r(e,[{key:"resetInitSegment",value:function(e,t,n,r){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(e,t,n,r){for(var o=i.default.getID3Data(e,0),s=i.default.getTimeStamp(o),u=s?90*s:9e4*t,l=o.length,c=e.length,d=0,f=0,p=this._audioTrack,h=[{pts:u,dts:u,data:o}];l<c;)if(a.default.isHeader(e,l)){var g=a.default.appendFrame(p,e,l,u,d);if(!g)break;l+=g.length,f=g.sample.pts,d++}else i.default.isHeader(e,l)?(o=i.default.getID3Data(e,l),h.push({pts:f,dts:f,data:o}),l+=o.length):l++;this.remuxer.remux(p,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},t,n,r)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){var t=void 0,n=void 0,r=i.default.getID3Data(e,0);if(r&&void 0!==i.default.getTimeStamp(r))for(t=r.length,n=Math.min(e.length-1,t+100);t<n;t++)if(a.default.probe(e,t))return o.logger.log("MPEG Audio sync word found !"),!0;return!1}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=l(n(51)),o=l(n(52)),a=l(n(1)),s=n(2),u=n(0);function l(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t,this.config=n,this.typeSupported=r;var o=navigator.userAgent;this.isSafari=i&&i.indexOf("Apple")>-1&&o&&!o.match("CriOS"),this.ISGenerated=!1}return r(e,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(e){this._initPTS=this._initDTS=e}},{key:"resetInitSegment",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,n,r,i,o,s){if(this.ISGenerated||this.generateIS(e,t,i),this.ISGenerated){var l=e.samples.length,c=t.samples.length,d=i,f=i;if(l&&c){var p=(e.samples[0].pts-t.samples[0].pts)/t.inputTimeScale;d+=Math.max(0,p),f+=Math.max(0,-p)}if(l){e.timescale||(u.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,i));var h=this.remuxAudio(e,d,o,s);if(c){var g=void 0;h&&(g=h.endPTS-h.startPTS),t.timescale||(u.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,i)),this.remuxVideo(t,f,o,g,s)}}else if(c){var v=this.remuxVideo(t,f,o,0,s);v&&e.codec&&this.remuxEmptyAudio(e,d,o,v)}}n.samples.length&&this.remuxID3(n,i),r.samples.length&&this.remuxText(r,i),this.observer.trigger(a.default.FRAG_PARSED)}},{key:"generateIS",value:function(e,t,n){var r=this.observer,i=e.samples,l=t.samples,c=this.typeSupported,d="audio/mp4",f={},p={tracks:f},h=void 0===this._initPTS,g=void 0,v=void 0;if(h&&(g=v=1/0),e.config&&i.length&&(e.timescale=e.samplerate,u.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(c.mpeg?(d="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3")),f.audio={container:d,codec:e.codec,initSegment:!e.isAAC&&c.mpeg?new Uint8Array:o.default.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(g=v=i[0].pts-e.inputTimeScale*n)),t.sps&&t.pps&&l.length){var m=t.inputTimeScale;t.timescale=m,f.video={container:"video/mp4",codec:t.codec,initSegment:o.default.initSegment([t]),metadata:{width:t.width,height:t.height}},h&&(g=Math.min(g,l[0].pts-m*n),v=Math.min(v,l[0].dts-m*n),this.observer.trigger(a.default.INIT_PTS_FOUND,{initPTS:g}))}Object.keys(f).length?(r.trigger(a.default.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,h&&(this._initPTS=g,this._initDTS=v)):r.trigger(a.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,n,r,i){var l,c,d,f=8,p=void 0,h=void 0,g=void 0,v=void 0,m=e.timescale,y=e.samples,_=[],b=y.length,S=this._PTSNormalize,k=this._initPTS,w=this.nextAvcDts,E=this.isSafari;if(0!==b){E&&(n|=y.length&&w&&(i&&Math.abs(t-w/m)<.1||Math.abs(y[0].pts-w-k)<m/5)),n||(w=t*m),y.forEach(function(e){e.pts=S(e.pts-k,w),e.dts=S(e.dts-k,w)}),y.sort(function(e,t){var n=e.dts-t.dts,r=e.pts-t.pts;return n||r||e.id-t.id});var T=y.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(T<0){u.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(T/90)+" ms to overcome this issue");for(var x=0;x<y.length;x++)y[x].dts+=T}var C=y[0];v=Math.max(C.dts,0),g=Math.max(C.pts,0);var I=Math.round((v-w)/90);n&&I&&(I>1?u.logger.log("AVC:"+I+" ms hole between fragments detected,filling it"):I<-1&&u.logger.log("AVC:"+-I+" ms overlapping between fragments detected"),v=w,y[0].dts=v,g=Math.max(g-I,w),y[0].pts=g,u.logger.log("Video/PTS/DTS adjusted: "+Math.round(g/90)+"/"+Math.round(v/90)+",delta:"+I+" ms")),C=y[y.length-1],d=Math.max(C.dts,0),c=Math.max(C.pts,0,d),E&&(p=Math.round((d-v)/(y.length-1)));for(var R=0,A=0,O=0;O<b;O++){for(var M=y[O],D=M.units,L=D.length,P=0,N=0;N<L;N++)P+=D[N].data.length;A+=P,R+=L,M.length=P,M.dts=E?v+O*p:Math.max(M.dts,v),M.pts=Math.max(M.pts,M.dts)}var U=A+4*R+8;try{h=new Uint8Array(U)}catch(e){return void this.observer.trigger(a.default.ERROR,{type:s.ErrorTypes.MUX_ERROR,details:s.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:U,reason:"fail allocating video mdat "+U})}var F=new DataView(h.buffer);F.setUint32(0,U),h.set(o.default.types.mdat,4);for(var j=0;j<b;j++){for(var G=y[j],B=G.units,V=0,q=void 0,H=0,z=B.length;H<z;H++){var K=B[H],W=K.data,Y=K.data.byteLength;F.setUint32(f,Y),f+=4,h.set(W,f),f+=Y,V+=4+Y}if(E)q=Math.max(0,p*Math.round((G.pts-G.dts)/p));else{if(j<b-1)p=y[j+1].dts-G.dts;else{var J=this.config,X=G.dts-y[j>0?j-1:j].dts;if(J.stretchShortVideoTrack){var Q=J.maxBufferHole,Z=Math.floor(Q*m),$=(r?g+r*m:this.nextAudioPts)-G.pts;$>Z?((p=$-X)<0&&(p=X),u.logger.log("It is approximately "+$/90+" ms to the next segment; using duration "+p/90+" ms for the last video frame.")):p=X}else p=X}q=Math.round(G.pts-G.dts)}_.push({size:V,duration:p,cts:q,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:G.key?2:1,isNonSync:G.key?0:1}})}this.nextAvcDts=d+p;var ee=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,_.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var te=_[0].flags;te.dependsOn=2,te.isNonSync=0}e.samples=_,l=o.default.moof(e.sequenceNumber++,v,e),e.samples=[];var ne={data1:l,data2:h,startPTS:g/m,endPTS:(c+p)/m,startDTS:v/m,endDTS:this.nextAvcDts/m,type:"video",hasAudio:!1,hasVideo:!0,nb:_.length,dropped:ee};return this.observer.trigger(a.default.FRAG_PARSING_DATA,ne),ne}}},{key:"remuxAudio",value:function(e,t,n,r){var l=e.inputTimeScale,c=e.timescale,d=l/c,f=(e.isAAC?1024:1152)*d,p=this._PTSNormalize,h=this._initPTS,g=!e.isAAC&&this.typeSupported.mpeg,v=void 0,m=void 0,y=void 0,_=void 0,b=void 0,S=void 0,k=void 0,w=e.samples,E=[],T=this.nextAudioPts;if(n|=w.length&&T&&(r&&Math.abs(t-T/l)<.1||Math.abs(w[0].pts-T-h)<20*f),w.forEach(function(e){e.pts=e.dts=p(e.pts-h,t*l)}),0!==(w=w.filter(function(e){return e.pts>=0})).length){if(n||(T=r?t*l:w[0].pts),e.isAAC)for(var x=this.config.maxAudioFramesDrift,C=0,I=T;C<w.length;){var R,A=w[C];R=A.pts-I;var O=Math.abs(1e3*R/l);if(R<=-x*f)u.logger.warn("Dropping 1 audio frame @ "+(I/l).toFixed(3)+"s due to "+Math.round(O)+" ms overlap."),w.splice(C,1),e.len-=A.unit.length;else if(R>=x*f&&O<1e4&&I){var M=Math.round(R/f);u.logger.warn("Injecting "+M+" audio frame @ "+(I/l).toFixed(3)+"s due to "+Math.round(1e3*R/l)+" ms gap.");for(var D=0;D<M;D++){var L=Math.max(I,0);(y=i.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(u.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),y=A.unit.subarray()),w.splice(C,0,{unit:y,pts:L,dts:L}),e.len+=y.length,I+=f,C++}A.pts=A.dts=I,I+=f,C++}else Math.abs(R),A.pts=A.dts=I,I+=f,C++}for(var P=0,N=w.length;P<N;P++){var U=w[P],F=U.unit,j=U.pts;if(void 0!==k)m.duration=Math.round((j-k)/d);else{var G=Math.round(1e3*(j-T)/l),B=0;if(n&&e.isAAC&&G){if(G>0&&G<1e4)B=Math.round((j-T)/f),u.logger.log(G+" ms hole between AAC samples detected,filling it"),B>0&&((y=i.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(y=F.subarray()),e.len+=B*y.length);else if(G<-12){u.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(T/l).toFixed(3)+"s/"+(j/l).toFixed(3)+"s/"+-G+"ms"),e.len-=F.byteLength;continue}j=T}if(S=j,!(e.len>0))return;var V=g?e.len:e.len+8;v=g?0:8;try{_=new Uint8Array(V)}catch(e){return void this.observer.trigger(a.default.ERROR,{type:s.ErrorTypes.MUX_ERROR,details:s.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:V,reason:"fail allocating audio mdat "+V})}g||(new DataView(_.buffer).setUint32(0,V),_.set(o.default.types.mdat,4));for(var q=0;q<B;q++)(y=i.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(u.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),y=F.subarray()),_.set(y,v),v+=y.byteLength,m={size:y.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(m)}_.set(F,v);var H=F.byteLength;v+=H,m={size:H,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(m),k=j}var z=0,K=E.length;if(K>=2&&(z=E[K-2].duration,m.duration=z),K){this.nextAudioPts=T=k+d*z,e.len=0,e.samples=E,b=g?new Uint8Array:o.default.moof(e.sequenceNumber++,S/d,e),e.samples=[];var W=S/l,Y=T/l,J={data1:b,data2:_,startPTS:W,endPTS:Y,startDTS:W,endDTS:Y,type:"audio",hasAudio:!0,hasVideo:!1,nb:K};return this.observer.trigger(a.default.FRAG_PARSING_DATA,J),J}return null}}},{key:"remuxEmptyAudio",value:function(e,t,n,r){var o=e.inputTimeScale,a=o/(e.samplerate?e.samplerate:o),s=this.nextAudioPts,l=(void 0!==s?s:r.startDTS*o)+this._initDTS,c=r.endDTS*o+this._initDTS,d=1024*a,f=Math.ceil((c-l)/d),p=i.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(u.logger.warn("remux empty Audio"),p){for(var h=[],g=0;g<f;g++){var v=l+g*d;h.push({unit:p,pts:v,dts:v}),e.len+=p.length}e.samples=h,this.remuxAudio(e,t,n)}else u.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")}},{key:"remuxID3",value:function(e){var t=e.samples.length,n=void 0,r=e.inputTimeScale,i=this._initPTS,o=this._initDTS;if(t){for(var s=0;s<t;s++)(n=e.samples[s]).pts=(n.pts-i)/r,n.dts=(n.dts-o)/r;this.observer.trigger(a.default.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[]}},{key:"remuxText",value:function(e){e.samples.sort(function(e,t){return e.pts-t.pts});var t=e.samples.length,n=void 0,r=e.inputTimeScale,i=this._initPTS;if(t){for(var o=0;o<t;o++)(n=e.samples[o]).pts=(n.pts-i)/r;this.observer.trigger(a.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]}},{key:"_PTSNormalize",value:function(e,t){var n=void 0;if(void 0===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=Math.pow(2,32)-1,o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t=void 0;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=o,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,a,u,a,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))}},{key:"box",value:function(e){for(var t=Array.prototype.slice.call(arguments,1),n=8,r=t.length,i=r,o=void 0;r--;)n+=t[r].byteLength;for((o=new Uint8Array(n))[0]=n>>24&255,o[1]=n>>16&255,o[2]=n>>8&255,o[3]=255&n,o.set(e,4),r=0,n=8;r<i;r++)o.set(t[r],n),n+=t[r].byteLength;return o}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,n){n*=t;var r=Math.floor(n/(i+1)),o=Math.floor(n%(i+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))}},{key:"moov",value:function(t){for(var n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))}},{key:"mvhd",value:function(t,n){n*=t;var r=Math.floor(n/(i+1)),o=Math.floor(n%(i+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)}},{key:"sdtp",value:function(t){var n=t.samples||[],r=new Uint8Array(4+n.length),i=void 0,o=void 0;for(o=0;o<n.length;o++)i=n[o].flags,r[o+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,r)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var n=[],r=[],i=void 0,o=void 0,a=void 0;for(i=0;i<t.sps.length;i++)a=(o=t.sps[i]).byteLength,n.push(a>>>8&255),n.push(255&a),n=n.concat(Array.prototype.slice.call(o));for(i=0;i<t.pps.length;i++)a=(o=t.pps[i]).byteLength,r.push(a>>>8&255),r.push(255&a),r=r.concat(Array.prototype.slice.call(o));var s=e.box(e.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|t.sps.length].concat(n).concat([t.pps.length]).concat(r))),u=t.width,l=t.height,c=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var n=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){var n=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))}},{key:"stsd",value:function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var n=t.id,r=t.duration*t.timescale,o=t.width,a=t.height,s=Math.floor(r/(i+1)),u=Math.floor(r%(i+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,u>>24,u>>16&255,u>>8&255,255&u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(t,n){var r=e.sdtp(t),o=t.id,a=Math.floor(n/(i+1)),s=Math.floor(n%(i+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,r.length+16+20+8+16+8+8),r)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,n){var r=t.samples||[],i=r.length,o=12+16*i,a=new Uint8Array(o),s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,f=void 0;for(n+=8+o,a.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),s=0;s<i;s++)l=(u=r[s]).duration,c=u.size,d=u.flags,f=u.cts,a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,61440&d.degradPrio,15&d.degradPrio,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*s);return e.box(e.types.trun,a)}},{key:"initSegment",value:function(t){e.types||e.init();var n=e.moov(t),r=void 0;return(r=new Uint8Array(e.FTYP.byteLength+n.byteLength)).set(e.FTYP),r.set(n,e.FTYP.byteLength),r}}]),e}();t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1),a=(r=o)&&r.__esModule?r:{default:r};var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.observer=t}return i(e,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(){}},{key:"remux",value:function(e,t,n,r,i,o,s,u){var l=this.observer,c="";e&&(c+="audio"),t&&(c+="video"),l.trigger(a.default.FRAG_PARSING_DATA,{data1:u,startPTS:i,startDTS:i,type:c,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),l.trigger(a.default.FRAG_PARSED)}}]),e}();t.default=s,e.exports=t.default},function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||e,o),u=i?i+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function l(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),l.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},l.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},l.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},l.prototype.emit=function(e,t,n,r,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,o),!0;case 6:return c.fn.call(c.context,t,n,r,o,a),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;case 4:c[l].fn.call(c[l].context,t,n,r);break;default:if(!u)for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},l.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},l.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},l.prototype.removeListener=function(e,t,n,r){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return u(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||u(this,o);else{for(var s=0,l=[],c=a.length;s<c;s++)(a[s].fn!==t||r&&!a[s].once||n&&a[s].context!==n)&&l.push(a[s]);l.length?this._events[o]=1===l.length?l[0]:l:u(this,o)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&u(this,t)):(this._events=new o,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=i,l.EventEmitter=l,e.exports=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(21)),i=s(n(1)),o=n(0),a=n(20);function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=new a.EventEmitter;t.trigger=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.removeListener.apply(t,[e].concat(r))};var n=function(t,n){e.postMessage({event:t,data:n})};e.addEventListener("message",function(i){var a=i.data;switch(a.cmd){case"init":var s=JSON.parse(a.config);e.demuxer=new r.default(t,a.typeSupported,s,a.vendor),(0,o.enableLogs)(s.debug),n("init",null);break;case"demux":e.demuxer.push(a.data,a.decryptdata,a.initSegment,a.audioCodec,a.videoCodec,a.timeOffset,a.discontinuity,a.trackSwitch,a.contiguous,a.duration,a.accurateTimeOffset,a.defaultInitPTS)}}),t.on(i.default.FRAG_DECRYPTED,n),t.on(i.default.FRAG_PARSING_INIT_SEGMENT,n),t.on(i.default.FRAG_PARSED,n),t.on(i.default.ERROR,n),t.on(i.default.FRAG_PARSING_METADATA,n),t.on(i.default.FRAG_PARSING_USERDATA,n),t.on(i.default.INIT_PTS_FOUND,n),t.on(i.default.FRAG_PARSING_DATA,function(t,n){var r=[],i={event:t,data:n};n.data1&&(i.data1=n.data1.buffer,r.push(n.data1.buffer),delete n.data1),n.data2&&(i.data2=n.data2.buffer,r.push(n.data2.buffer),delete n.data2),e.postMessage(i,r)})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4),a=n(2),s=n(1),u=(r=s)&&r.__esModule?r:{default:r},l=n(0);var c=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.media=n,this.fragmentTracker=r,this.hls=i,this.stallReported=!1}return i(e,[{key:"poll",value:function(e,t){var n=this.config,r=this.media,i=r.currentTime,a=window.performance.now();if(i!==e)return this.stallReported&&(l.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(a-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(r.ended||!r.buffered.length||r.readyState>2||r.seeking&&o.BufferHelper.isBuffered(r,i))){var s=a-this.stalled,u=o.BufferHelper.bufferInfo(r,i,n.maxBufferHole);this.stalled?(s>=1e3&&this._reportStall(u.len),this._tryFixBufferStall(u,s)):this.stalled=a}}},{key:"_tryFixBufferStall",value:function(e,t){var n=this.config,r=this.fragmentTracker,i=this.media.currentTime,o=r.getPartialFragment(i);o&&this._trySkipBufferHole(o),e.len>.5&&t>1e3*n.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())}},{key:"_reportStall",value:function(e){var t=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,l.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer"),t.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))}},{key:"_trySkipBufferHole",value:function(e){for(var t=this.hls,n=this.media,r=n.currentTime,i=0,o=0;o<n.buffered.length;o++){var s=n.buffered.start(o);if(r>=i&&r<s)return n.currentTime=Math.max(s,n.currentTime+.1),l.logger.warn("skipping hole, adjusting currentTime from "+r+" to "+n.currentTime),this.stalled=null,void t.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+r+" to "+n.currentTime,frag:e});i=n.buffered.end(o)}}},{key:"_tryNudgeBuffer",value:function(){var e=this.config,t=this.hls,n=this.media,r=n.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<e.nudgeMaxRetry){var o=r+i*e.nudgeOffset;l.logger.log("adjust currentTime from "+r+" to "+o),n.currentTime=o,t.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else l.logger.error("still stuck in high buffer @"+r+" after "+e.nudgeMaxRetry+", raise fatal error"),t.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=d(n(1)),a=d(n(3)),s=n(0),u=n(2),l=n(18),c=n(7);function d(e){return e&&e.__esModule?e:{default:e}}window.performance;var f=void 0,p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o.default.MANIFEST_LOADED,o.default.LEVEL_LOADED,o.default.AUDIO_TRACK_SWITCHED,o.default.FRAG_LOADED,o.default.ERROR));return n.canload=!1,n.currentLevelIndex=null,n.manualLevelIndex=-1,n.timer=null,f=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),i(t,[{key:"onHandlerDestroying",value:function(){this.clearTimer(),this.manualLevelIndex=-1}},{key:"clearTimer",value:function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}},{key:"startLoad",value:function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(e){var t=[],n=[],r=void 0,i={},a=null,d=!1,p=!1;if(e.levels.forEach(function(e){var n=e.attrs;e.loadError=0,e.fragmentError=!1,d=d||!!e.videoCodec,p=p||!!e.audioCodec,f&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(a=i[e.bitrate])?a.url.push(e.url):(e.url=[e.url],e.urlId=0,i[e.bitrate]=e,t.push(e)),n&&(n.AUDIO&&(p=!0,(0,c.addGroupId)(a||e,"audio",n.AUDIO)),n.SUBTITLES&&(0,c.addGroupId)(a||e,"text",n.SUBTITLES))}),d&&p&&(t=t.filter(function(e){return!!e.videoCodec})),t=t.filter(function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||(0,l.isCodecSupportedInMp4)(t,"audio"))&&(!n||(0,l.isCodecSupportedInMp4)(n,"video"))}),e.audioTracks&&(n=e.audioTracks.filter(function(e){return!e.audioCodec||(0,l.isCodecSupportedInMp4)(e.audioCodec,"audio")})).forEach(function(e,t){e.id=t}),t.length>0){r=t[0].bitrate,t.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=t;for(var h=0;h<t.length;h++)if(t[h].bitrate===r){this._firstLevel=h,s.logger.log("manifest loaded,"+t.length+" level(s) found, first bitrate:"+r);break}this.hls.trigger(o.default.MANIFEST_PARSED,{levels:t,audioTracks:n,firstLevel:this._firstLevel,stats:e.stats,audio:p,video:d,altAudio:n.some(function(e){return!!e.url})})}else this.hls.trigger(o.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(e){var t=this._levels,n=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){s.logger.log("switching to level "+e),this.currentLevelIndex=e;var r=t[e];r.level=e,n.trigger(o.default.LEVEL_SWITCHING,r)}var i=t[e],a=i.details;if(!a||a.live){var l=i.urlId;n.trigger(o.default.LEVEL_LOADING,{url:i.url[l],level:e,id:l})}}else n.trigger(o.default.ERROR,{type:u.ErrorTypes.OTHER_ERROR,details:u.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(e){if(e.fatal)e.type===u.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t=!1,n=!1,r=void 0;switch(e.details){case u.ErrorDetails.FRAG_LOAD_ERROR:case u.ErrorDetails.FRAG_LOAD_TIMEOUT:case u.ErrorDetails.KEY_LOAD_ERROR:case u.ErrorDetails.KEY_LOAD_TIMEOUT:r=e.frag.level,n=!0;break;case u.ErrorDetails.LEVEL_LOAD_ERROR:case u.ErrorDetails.LEVEL_LOAD_TIMEOUT:r=e.context.level,t=!0;break;case u.ErrorDetails.REMUX_ALLOC_ERROR:r=e.level,t=!0}void 0!==r&&this.recoverLevel(e,r,t,n)}}},{key:"recoverLevel",value:function(e,t,n,r){var i=this,o=this.hls.config,a=e.details,u=this._levels[t],l=void 0,c=void 0,d=void 0;if(u.loadError++,u.fragmentError=r,n){if(!(this.levelRetryCount+1<=o.levelLoadingMaxRetry))return s.logger.error("level controller, cannot recover from "+a+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);c=Math.min(Math.pow(2,this.levelRetryCount)*o.levelLoadingRetryDelay,o.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return i.loadLevel()},c),e.levelRetry=!0,this.levelRetryCount++,s.logger.warn("level controller, "+a+", retry in "+c+" ms, current retry count is "+this.levelRetryCount)}(n||r)&&((l=u.url.length)>1&&u.loadError<l?(u.urlId=(u.urlId+1)%l,u.details=void 0,s.logger.warn("level controller, "+a+" for level "+t+": switching to redundant URL-id "+u.urlId)):-1===this.manualLevelIndex?(d=0===t?this._levels.length-1:t-1,s.logger.warn("level controller, "+a+": switch to "+d),this.hls.nextAutoLevel=this.currentLevelIndex=d):r&&(s.logger.warn("level controller, "+a+": reload a fragment"),this.currentLevelIndex=null))}},{key:"onFragLoaded",value:function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var n=this._levels[t.level];void 0!==n&&(n.fragmentError=!1,n.loadError=0,this.levelRetryCount=0)}}},{key:"onLevelLoaded",value:function(e){var t=this,n=e.level,r=e.details;if(n===this.currentLevelIndex){var i=this._levels[n];if(i.fragmentError||(i.loadError=0,this.levelRetryCount=0),r.live){var o=(0,c.computeReloadInterval)(i.details,r,e.stats.trequest);s.logger.log("live playlist, reload in "+Math.round(o)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},o)}else this.clearTimer()}}},{key:"onAudioTrackSwitched",value:function(e){var t=this.hls.audioTracks[e.id].groupId,n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var r=-1,i=0;i<n.audioGroupIds.length;i++)if(n.audioGroupIds[i]===t){r=i;break}r!==n.urlId&&(n.urlId=r,this.startLoad())}}},{key:"loadLevel",value:function(){if(s.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"===(void 0===e?"undefined":r(e))&&e.url.length>0){var t=this.currentLevelIndex,n=e.urlId,i=e.url[n];s.logger.log("Attempt loading level index "+t+" with URL-id "+n),this.hls.trigger(o.default.LEVEL_LOADING,{url:i,level:t,id:n})}}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),t}();t.default=p,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=u(n(1)),o=u(n(3)),a=u(n(10)),s=n(29);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.default.MEDIA_ATTACHED,i.default.MEDIA_DETACHING,i.default.FRAG_PARSING_METADATA));return n.id3Track=void 0,n.media=void 0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"destroy",value:function(){o.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(e){this.media=e.media,this.media}},{key:"onMediaDetaching",value:function(){(0,s.clearCurrentCues)(this.id3Track),this.id3Track=void 0,this.media=void 0}},{key:"getID3Track",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];if("metadata"===n.kind&&"id3"===n.label)return(0,s.sendAddTrackEvent)(n,this.media),n}return this.media.addTextTrack("metadata","id3")}},{key:"onFragParsingMetadata",value:function(e){var t=e.frag,n=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var r=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<n.length;i++){var o=a.default.getID3Frames(n[i].data);if(o){var s=n[i].pts,u=i<n.length-1?n[i+1].pts:t.endPTS;s===u&&(u+=1e-4);for(var l=0;l<o.length;l++){var c=o[l];if(!a.default.isTimeStampFrame(c)){var d=new r(s,u,"");d.value=c,this.id3Track.addCue(d)}}}}}}]),t}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSupported=function(){var e=(0,r.getMediaSource)(),t=window.SourceBuffer||window.WebKitSourceBuffer,n=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!n&&!!i};var r=n(13)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hlsDefaultConfig=void 0;var r=v(n(61)),i=v(n(64)),o=v(n(65)),a=v(n(66)),s=v(n(67)),u=v(n(68)),l=v(n(69)),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(70)),d=v(n(72)),f=v(n(76)),p=n(77),h=v(n(78)),g=n(79);function v(e){return e&&e.__esModule?e:{default:e}}var m=t.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:s.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:r.default,bufferController:i.default,capLevelController:o.default,fpsController:a.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:g.requestMediaKeySystemAccess};m.subtitleStreamController=p.SubtitleStreamController,m.subtitleTrackController=f.default,m.timelineController=d.default,m.cueHandler=c,m.enableCEA708Captions=!0,m.enableWebVTT=!0,m.captionsTextTrack1Label="English",m.captionsTextTrack1LanguageCode="en",m.captionsTextTrack2Label="Spanish",m.captionsTextTrack2LanguageCode="es",m.audioStreamController=l.default,m.audioTrackController=u.default,m.emeController=h.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=c(n(1)),o=c(n(3)),a=n(4),s=n(2),u=n(0),l=c(n(62));function c(e){return e&&e.__esModule?e:{default:e}}var d=window.performance,f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.default.FRAG_LOADING,i.default.FRAG_LOADED,i.default.FRAG_BUFFERED,i.default.ERROR));return n.lastLoadedFragLevel=0,n._nextAutoLevel=-1,n.hls=e,n.timer=null,n._bwEstimator=null,n.onCheck=n._abandonRulesCheck.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"destroy",value:function(){this.clearTimer(),o.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var n=this.hls,r=n.config,i=t.level,o=void 0,a=void 0;n.levels[i].details.live?(o=r.abrEwmaFastLive,a=r.abrEwmaSlowLive):(o=r.abrEwmaFastVoD,a=r.abrEwmaSlowVoD),this._bwEstimator=new l.default(n,a,o,r.abrEwmaDefaultEstimate)}}},{key:"_abandonRulesCheck",value:function(){var e=this.hls,t=e.media,n=this.fragCurrent;if(n){var r=n.loader,o=e.minAutoLevel;if(!r||r.stats&&r.stats.aborted)return u.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var s=r.stats;if(t&&s&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&n.autoLevel&&n.level){var l=d.now()-s.trequest,c=Math.abs(t.playbackRate);if(l>500*n.duration/c){var f=e.levels,p=Math.max(1,s.bw?s.bw/8:1e3*s.loaded/l),h=f[n.level],g=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,v=s.total?s.total:Math.max(s.loaded,Math.round(n.duration*g/8)),m=t.currentTime,y=(v-s.loaded)/p,_=(a.BufferHelper.bufferInfo(t,m,e.config.maxBufferHole).end-m)/c;if(_<2*n.duration/c&&y>_){var b=void 0,S=void 0;for(S=n.level-1;S>o;S--){var k=f[S].realBitrate?Math.max(f[S].realBitrate,f[S].bitrate):f[S].bitrate;if((b=n.duration*k/(6.4*p))<_)break}b<y&&(u.logger.warn("loading too slow, abort fragment loading and switch to level "+S+":fragLoadedDelay["+S+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+b.toFixed(1)+"<"+y.toFixed(1)+":"+_.toFixed(1)),e.nextLoadLevel=S,this._bwEstimator.sample(l,s.loaded),r.abort(),this.clearTimer(),e.trigger(i.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:s}))}}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if("main"===t.type&&Number.isFinite(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n=this.hls.levels[t.level],r=(n.loaded?n.loaded.bytes:0)+e.stats.loaded,i=(n.loaded?n.loaded.duration:0)+e.frag.duration;n.loaded={bytes:r,duration:i},n.realBitrate=Math.round(8*r/i)}if(e.frag.bitrateTest){var o=e.stats;o.tparsed=o.tbuffered=o.tload,this.onFragBuffered(e)}}}},{key:"onFragBuffered",value:function(e){var t=e.stats,n=e.frag;if(!0!==t.aborted&&"main"===n.type&&Number.isFinite(n.sn)&&(!n.bitrateTest||t.tload===t.tbuffered)){var r=t.tparsed-t.trequest;u.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(r,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(e){switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){clearInterval(this.timer),this.timer=null}},{key:"_findBestLevel",value:function(e,t,n,r,i,o,a,s,l){for(var c=i;c>=r;c--){var d=l[c];if(d){var f=d.details,p=f?f.totalduration/f.fragments.length:t,h=!!f&&f.live,g=void 0;g=c<=e?a*n:s*n;var v=l[c].realBitrate?Math.max(l[c].realBitrate,l[c].bitrate):l[c].bitrate,m=v*p/g;if(u.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+c+"/"+Math.round(g)+"/"+v+"/"+p+"/"+o+"/"+m),g>v&&(!m||h&&!this.bitrateTestDelay||m<o))return c}}return-1}},{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var n=this._nextABRAutoLevel;return-1!==e&&(n=Math.min(e,n)),n},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,n=e.levels,r=e.config,i=e.minAutoLevel,o=e.media,s=this.lastLoadedFragLevel,l=this.fragCurrent?this.fragCurrent.duration:0,c=o?o.currentTime:0,d=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,f=this._bwEstimator?this._bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,p=(a.BufferHelper.bufferInfo(o,c,r.maxBufferHole).end-c)/d,h=this._findBestLevel(s,l,f,i,t,p,r.abrBandWidthFactor,r.abrBandWidthUpFactor,n);if(h>=0)return h;u.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var g=l?Math.min(l,r.maxStarvationDelay):r.maxStarvationDelay,v=r.abrBandWidthFactor,m=r.abrBandWidthUpFactor;if(0===p){var y=this.bitrateTestDelay;if(y)g=(l?Math.min(l,r.maxLoadingDelay):r.maxLoadingDelay)-y,u.logger.trace("bitrate test took "+Math.round(1e3*y)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),v=m=1}return h=this._findBestLevel(s,l,f,i,t,p+g,v,m,n),Math.max(h,0)}}]),t}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(63),a=(r=o)&&r.__esModule?r:{default:r};var s=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hls=t,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new a.default(n),this.fast_=new a.default(r)}return i(e,[{key:"sample",value:function(e,t){var n=8e3*t/(e=Math.max(e,this.minDelayMs_)),r=e/1e3;this.fast_.sample(r,n),this.slow_.sample(r,n)}},{key:"canEstimate",value:function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),e}();t.default=s,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return r(e,[{key:"sample",value:function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_}}]),e}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=u(n(1)),o=u(n(3)),a=n(0),s=n(2);function u(e){return e&&e.__esModule?e:{default:e}}var l=(0,n(13).getMediaSource)(),c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.default.MEDIA_ATTACHING,i.default.MEDIA_DETACHING,i.default.MANIFEST_PARSED,i.default.BUFFER_RESET,i.default.BUFFER_APPENDING,i.default.BUFFER_CODECS,i.default.BUFFER_EOS,i.default.BUFFER_FLUSHING,i.default.LEVEL_PTS_UPDATED,i.default.LEVEL_UPDATED));return n._msDuration=null,n._levelDuration=null,n._levelTargetDuration=10,n._live=null,n._objectUrl=null,n.bufferCodecEventsExpected=0,n.onsbue=n.onSBUpdateEnd.bind(n),n.onsbe=n.onSBUpdateError.bind(n),n.pendingTracks={},n.tracks={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"destroy",value:function(){o.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(e){var t=e.type,n=this.tracks.audio;if("audio"===t&&n&&"audio/mpeg"===n.container){var r=this.sourceBuffer.audio;if(Math.abs(r.timestampOffset-e.start)>.1){var i=r.updating;try{r.abort()}catch(e){a.logger.warn("can not abort audio buffer: "+e)}i?this.audioTimestampOffset=e.start:(a.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+e.start),r.timestampOffset=e.start)}}}},{key:"onManifestParsed",value:function(e){this.bufferCodecEventsExpected=e.altAudio?2:1,a.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;if(t){var n=this.mediaSource=new l;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener("sourceopen",this.onmso),n.addEventListener("sourceended",this.onmse),n.addEventListener("sourceclose",this.onmsc),t.src=window.URL.createObjectURL(n),this._objectUrl=t.src}}},{key:"onMediaDetaching",value:function(){a.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){a.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):a.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(i.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){a.logger.log("media source opened"),this.hls.trigger(i.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,n=Object.keys(t).length;(n&&!e||2===n)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){a.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){a.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;a.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,n=this.segments.reduce(function(e,n){return n.parent===t?e+1:e},0),r={},o=this.sourceBuffer;for(var s in o)r[s]=o[s].buffered;if(!1===this._paused&&r.video&&r.video.length>0&&r.audio&&r.audio.length>0)if(r.video.end(0)-r.video.start(0)>1&&r.audio.end(0)-r.audio.start(0)>1){var u=Math.max(r.video.start(0),r.audio.start(0));this.media.currentTime=u,this.media.play(),delete this._paused}else{var l=Math.max(r.video.end(0),r.audio.end(0));this.media.currentTime=l,this.media.play()}this.hls.trigger(i.default.BUFFER_APPENDED,{parent:t,pending:n,timeRanges:r}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration(),0===n&&this.flushLiveBackBuffer()}},{key:"onSBUpdateError",value:function(e){a.logger.error("sourceBuffer error:",e),this.hls.trigger(i.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;for(var t in e){var n=e[t];try{this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this.onsbue),n.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){var t=this;Object.keys(e).forEach(function(n){t.pendingTracks[n]=e[n]});var n=this.mediaSource;this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),n&&"open"===n.readyState&&this.checkPendingTracks()}},{key:"createSourceBuffers",value:function(e){var t=this.sourceBuffer,n=this.mediaSource;for(var r in e)if(!t[r]){var o=e[r],u=o.levelCodec||o.codec,c=o.container+";codecs="+u;a.logger.log("creating sourceBuffer("+c+")");try{var d=t[r]=n.addSourceBuffer(c);d.addEventListener("updateend",this.onsbue),d.addEventListener("error",this.onsbe),this.tracks[r]={codec:u,container:o.container},o.buffer=d}catch(e){if(22==e.code){a.logger.log("Found new track, try to rebuild"),this._paused=!1;var f=this.mediaSource=new l;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this);for(var p=0;p<Object.keys(this.tracks).length;p++){var h=this.tracks[Object.keys(this.tracks)[p]];this.pendingTracks[Object.keys(this.tracks)[p]]=h}this.tracks={},this.sourceBuffer={},f.addEventListener("sourceopen",this.onmso),f.addEventListener("sourceended",this.onmse),f.addEventListener("sourceclose",this.onmsc),this.media.src=window.URL.createObjectURL(f),this._objectUrl=media.src}else a.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(i.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:c})}}this.hls.trigger(i.default.BUFFER_CREATED,{tracks:e})}},{key:"onBufferAppending",value:function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())}},{key:"onBufferAppendFail",value:function(e){a.logger.error("sourceBuffer error:",e.event),this.hls.trigger(i.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferEos",value:function(e){var t=this.sourceBuffer,n=e.type;for(var r in t)n&&r!==n||t[r].ended||(t[r].ended=!0,a.logger.log(r+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var n in e){var r=e[n];if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}a.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){a.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"flushLiveBackBuffer",value:function(){if(this._live){var e=this.hls.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))for(var t=this.media.currentTime,n=this.sourceBuffer,r=Object.keys(n),i=t-Math.max(e,this._levelTargetDuration),o=r.length-1;o>=0;o--){var a=r[o],s=n[a].buffered;s.length>0&&i>s.start(0)&&this.removeBufferRange(a,n[a],0,i)}}}},{key:"onLevelUpdated",value:function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var e,t=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var n in this.sourceBuffer)if(!0===this.sourceBuffer[n].updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(a.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!Number.isFinite(e))&&(a.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var r in n)t+=n[r].buffered.length}catch(e){a.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(i.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var e=this.hls,t=this.segments,n=this.sourceBuffer;if(Object.keys(n).length){if(this.media.error)return this.segments=[],void a.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(t&&t.length){var r=t.shift();try{var o=n[r.type];o?o.updating?t.unshift(r):(o.ended=!1,this.parent=r.parent,o.appendBuffer(r.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(n){a.logger.error("error while trying to append buffer:"+n.message),t.unshift(r);var u={type:s.ErrorTypes.MEDIA_ERROR,parent:r.parent};22!==n.code?(this.appendError?this.appendError++:this.appendError=1,u.details=s.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry?(a.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],u.fatal=!0,e.trigger(i.default.ERROR,u)):(u.fatal=!1,e.trigger(i.default.ERROR,u))):(this.segments=[],u.details=s.ErrorDetails.BUFFER_FULL_ERROR,u.fatal=!1,e.trigger(i.default.ERROR,u))}}}}},{key:"flushBuffer",value:function(e,t,n){var r=void 0,i=this.sourceBuffer;if(Object.keys(i).length){if(a.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var o in i)if(!n||o===n){if((r=i[o]).ended=!1,r.updating)return a.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(o,r,e,t))return this.flushBufferCounter++,!1}}else a.logger.warn("abort flushing too many retries");a.logger.log("buffer flushed")}return!0}},{key:"removeBufferRange",value:function(e,t,n,r){try{for(var i=0;i<t.buffered.length;i++){var o=t.buffered.start(i),s=t.buffered.end(i),u=Math.max(o,n),l=Math.min(s,r);if(Math.min(l,s)-u>.5)return a.logger.log("sb remove "+e+" ["+u+","+l+"], of ["+o+","+s+"], pos:"+this.media.currentTime),t.remove(u,l),!0}}catch(e){a.logger.warn("removeBufferRange failed",e)}return!1}}]),t}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=a(n(1)),o=a(n(3));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.default.FPS_DROP_LEVEL_CAPPING,i.default.MEDIA_ATTACHING,i.default.MANIFEST_PARSED,i.default.BUFFER_CODECS,i.default.MEDIA_DETACHING));return n.autoLevelCapping=Number.POSITIVE_INFINITY,n.firstLevel=null,n.levels=[],n.media=null,n.restrictedLevels=[],n.timer=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())}},{key:"onFpsDropLevelCapping",value:function(e){t.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this._startCapping()}},{key:"onBufferCodecs",value:function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this._startCapping()}},{key:"onLevelsUpdated",value:function(e){this.levels=e.levels}},{key:"onMediaDetaching",value:function(){this._stopCapping()}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(e){var n=this;if(!this.levels)return-1;var r=this.levels.filter(function(r,i){return t.isLevelAllowed(i,n.restrictedLevels)&&i<=e});return t.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}},{key:"_startCapping",value:function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"_stopCapping",value:function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)}},{key:"mediaWidth",get:function(){var e=void 0,n=this.media;return n&&(e=n.width||n.clientWidth||n.offsetWidth,e*=t.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0,n=this.media;return n&&(e=n.height||n.clientHeight||n.offsetHeight,e*=t.contentScaleFactor),e}}],[{key:"isLevelAllowed",value:function(e){return-1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).indexOf(e)}},{key:"getMaxLevelByMediaSize",value:function(e,t,n){if(!e||e&&!e.length)return-1;for(var r,i,o=e.length-1,a=0;a<e.length;a+=1){var s=e[a];if((s.width>=t||s.height>=n)&&(r=s,!(i=e[a+1])||r.width!==i.width||r.height!==i.height)){o=a;break}}return o}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}]),t}();t.default=s,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=s(n(1)),o=s(n(3)),a=n(0);function s(e){return e&&e.__esModule?e:{default:e}}var u=window.performance,l=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.default.MEDIA_ATTACHING))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))}},{key:"checkFPS",value:function(e,t,n){var r=u.now();if(t){if(this.lastTime){var o=r-this.lastTime,s=n-this.lastDroppedFrames,l=t-this.lastDecodedFrames,c=1e3*s/o,d=this.hls;if(d.trigger(i.default.FPS_DROP,{currentDropped:s,currentDecoded:l,totalDroppedFrames:n}),c>0&&s>d.config.fpsDroppedMonitoringThreshold*l){var f=d.currentLevel;a.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(-1===d.autoLevelCapping||d.autoLevelCapping>=f)&&(f-=1,d.trigger(i.default.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:d.currentLevel}),d.autoLevelCapping=f,d.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}},{key:"checkFPSInterval",value:function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}]),t}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0);var o=window,a=o.performance,s=o.XMLHttpRequest,u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return r(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:a.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e=void 0,t=this.context;e=this.loader=new s;var n=this.stats;n.tfirst=0,n.loaded=0;var r=this.xhrSetup;try{if(r)try{r(e,t.url)}catch(n){e.open("GET",t.url,!0),r(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(n){return void this.callbacks.onError({code:e.status,text:n.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()}},{key:"readystatechange",value:function(e){var t=e.currentTarget,n=t.readyState,r=this.stats,o=this.context,s=this.config;if(!r.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(a.now(),r.trequest)),4===n){var u=t.status;if(u>=200&&u<300){r.tload=Math.max(r.tfirst,a.now());var l=void 0,c=void 0;c="arraybuffer"===o.responseType?(l=t.response).byteLength:(l=t.responseText).length,r.loaded=r.total=c;var d={url:t.responseURL,data:l};this.callbacks.onSuccess(d,r,o,t)}else r.retry>=s.maxRetry||u>=400&&u<499?(i.logger.error(u+" while loading "+o.url),this.callbacks.onError({code:u,text:t.statusText},o,t)):(i.logger.warn(u+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout)}},{key:"loadtimeout",value:function(){i.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)}},{key:"loadprogress",value:function(e){var t=e.currentTarget,n=this.stats;n.loaded=e.loaded,e.lengthComputable&&(n.total=e.total);var r=this.callbacks.onProgress;r&&r(n,this.context,null,t)}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=u(n(1)),o=u(n(28)),a=n(0),s=n(2);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.default.MANIFEST_LOADING,i.default.MANIFEST_PARSED,i.default.AUDIO_TRACK_LOADED,i.default.AUDIO_TRACK_SWITCHED,i.default.LEVEL_LOADED,i.default.ERROR));return n._trackId=-1,n._selectDefaultTrack=!0,n.tracks=[],n.trackIdBlacklist=Object.create(null),n.audioGroupId=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"onManifestLoading",value:function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0}},{key:"onManifestParsed",value:function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(i.default.AUDIO_TRACKS_UPDATED,{audioTracks:t})}},{key:"onAudioTrackLoaded",value:function(e){if(e.id>=this.tracks.length)a.logger.warn("Invalid audio track id:",e.id);else{if(a.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}}},{key:"onAudioTrackSwitched",value:function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)}},{key:"onLevelLoaded",value:function(e){var t=this.hls.levels[e.level];if(t.audioGroupIds){var n=t.audioGroupIds[t.urlId];this.audioGroupId!==n&&(this.audioGroupId=n,this._selectInitialAudioTrack())}}},{key:"onError",value:function(e){e.type===s.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(a.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))}},{key:"_setAudioTrack",value:function(e){if(this._trackId===e&&this.tracks[this._trackId].details)a.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)a.logger.warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];a.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var n=t.url,r=t.type,o=t.id;this.hls.trigger(i.default.AUDIO_TRACK_SWITCHING,{id:o,type:r,url:n}),this._loadTrackDetailsIfNeeded(t)}}},{key:"doTick",value:function(){this._updateTrack(this._trackId)}},{key:"_selectInitialAudioTrack",value:function(){var e=this,t=this.tracks;if(t.length){var n=this.tracks[this._trackId],r=null;if(n&&(r=n.name),this._selectDefaultTrack){var o=t.filter(function(e){return e.default});o.length?t=o:a.logger.warn("No default audio tracks defined")}var u=!1,l=function(){t.forEach(function(t){u||e.audioGroupId&&t.groupId!==e.audioGroupId||r&&r!==t.name||(e._setAudioTrack(t.id),u=!0)})};l(),u||(r=null,l()),u||(a.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(i.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}}},{key:"_needsTrackLoading",value:function(e){var t=e.details,n=e.url;return!(t&&!t.live)&&!!n}},{key:"_loadTrackDetailsIfNeeded",value:function(e){if(this._needsTrackLoading(e)){var t=e.url,n=e.id;a.logger.log("loading audio-track playlist for id: "+n),this.hls.trigger(i.default.AUDIO_TRACK_LOADING,{url:t,id:n})}}},{key:"_updateTrack",value:function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,a.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}}},{key:"_handleLoadError",value:function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],n=t.name,r=t.language,i=t.groupId;a.logger.warn("Loading failed on audio track id: "+e+", group-id: "+i+', name/language: "'+n+'" / "'+r+'"');for(var o=e,s=0;s<this.tracks.length;s++){if(!this.trackIdBlacklist[s])if(this.tracks[s].name===n){o=s;break}}o!==e?(a.logger.log("Attempting audio-track fallback id:",o,"group-id:",this.tracks[o].groupId),this._setAudioTrack(o)):a.logger.warn('No fallback audio-track found for name/language: "'+n+'" / "'+r+'"')}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}]),t}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=m(n(9)),o=n(4),a=m(n(19)),s=m(n(1)),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(7)),l=m(n(25)),c=n(2),d=n(0),f=n(26),p=n(6),h=m(n(11)),g=n(14),v=m(g);function m(e){return e&&e.__esModule?e:{default:e}}var y=window.performance,_=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s.default.MEDIA_ATTACHED,s.default.MEDIA_DETACHING,s.default.AUDIO_TRACKS_UPDATED,s.default.AUDIO_TRACK_SWITCHING,s.default.AUDIO_TRACK_LOADED,s.default.KEY_LOADED,s.default.FRAG_LOADED,s.default.FRAG_PARSING_INIT_SEGMENT,s.default.FRAG_PARSING_DATA,s.default.FRAG_PARSED,s.default.ERROR,s.default.BUFFER_RESET,s.default.BUFFER_CREATED,s.default.BUFFER_APPENDED,s.default.BUFFER_FLUSHED,s.default.INIT_PTS_FOUND));return r.fragmentTracker=n,r.config=e.config,r.audioCodecSwap=!1,r._state=g.State.STOPPED,r.initPTS=[],r.waitingFragment=null,r.videoTrackCC=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,v.default),r(t,[{key:"onInitPtsFound",value:function(e){var t=e.id,n=e.frag.cc,r=e.initPTS;"main"===t&&(this.initPTS[n]=r,this.videoTrackCC=n,d.logger.log("InitPTS for cc: "+n+" found from video track: "+r),this.state===g.State.WAITING_INIT_PTS&&this.tick())}},{key:"startLoad",value:function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(d.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=g.State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=g.State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=g.State.STOPPED}},{key:"doTick",value:function(){var e=void 0,t=void 0,n=void 0,r=this.hls,a=r.config;switch(this.state){case g.State.ERROR:case g.State.PAUSED:case g.State.BUFFER_FLUSHING:break;case g.State.STARTING:this.state=g.State.WAITING_TRACK,this.loadedmetadata=!1;break;case g.State.IDLE:var u=this.tracks;if(!u)break;if(!this.media&&(this.startFragRequested||!a.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var l=this.mediaBuffer?this.mediaBuffer:this.media,c=this.videoBuffer?this.videoBuffer:this.media,h=o.BufferHelper.bufferInfo(l,e,a.maxBufferHole),v=o.BufferHelper.bufferInfo(c,e,a.maxBufferHole),m=h.len,_=h.end,b=this.fragPrevious,S=Math.min(a.maxBufferLength,a.maxMaxBufferLength),k=Math.max(S,v.len),w=this.audioSwitch,E=this.trackId;if((m<k||w)&&E<u.length){if(void 0===(n=u[E].details)){this.state=g.State.WAITING_TRACK;break}if(!w&&this._streamEnded(h,n))return this.hls.trigger(s.default.BUFFER_EOS,{type:"audio"}),void(this.state=g.State.ENDED);var T=n.fragments,x=T.length,C=T[0].start,I=T[x-1].start+T[x-1].duration,R=void 0;if(w)if(n.live&&!n.PTSKnown)d.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),_=0;else if(_=e,n.PTSKnown&&e<C){if(!(h.end>C||h.nextStart))return;d.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=C+.05}if(n.initSegment&&!n.initSegment.data)R=n.initSegment;else if(_<=C){if(R=T[0],null!==this.videoTrackCC&&R.cc!==this.videoTrackCC&&(R=(0,f.findFragWithCC)(T,this.videoTrackCC)),n.live&&R.loadIdx&&R.loadIdx===this.fragLoadIdx){var A=h.nextStart?h.nextStart:C;return d.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(A+.05)),void(this.media.currentTime=A+.05)}}else{var O=void 0,M=a.maxFragLookUpTolerance,D=b?T[b.sn-T[0].sn+1]:void 0,L=function(e){var t=Math.min(M,e.duration);return e.start+e.duration-t<=_?1:e.start-t>_&&e.start?-1:0};_<I?(_>I-M&&(M=0),O=D&&!L(D)?D:i.default.search(T,L)):O=T[x-1],O&&(R=O,C=O.start,b&&R.level===b.level&&R.sn===b.sn&&(R.sn<n.endSN?(R=T[R.sn+1-n.startSN],d.logger.log("SN just loaded, load next one: "+R.sn)):R=null))}R&&(R.encrypted?(d.logger.log("Loading key for "+R.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+E),this.state=g.State.KEY_LOADING,r.trigger(s.default.KEY_LOADING,{frag:R})):(d.logger.log("Loading "+R.sn+", cc: "+R.cc+" of ["+n.startSN+" ,"+n.endSN+"],track "+E+", currentTime:"+e+",bufferEnd:"+_.toFixed(3)),this.fragCurrent=R,(w||this.fragmentTracker.getState(R)===p.FragmentState.NOT_LOADED)&&(this.startFragRequested=!0,Number.isFinite(R.sn)&&(this.nextLoadPosition=R.start+R.duration),r.trigger(s.default.FRAG_LOADING,{frag:R}),this.state=g.State.FRAG_LOADING)))}break;case g.State.WAITING_TRACK:(t=this.tracks[this.trackId])&&t.details&&(this.state=g.State.IDLE);break;case g.State.FRAG_LOADING_WAITING_RETRY:var P=y.now(),N=this.retryDate,U=(l=this.media)&&l.seeking;(!N||P>=N||U)&&(d.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=g.State.IDLE);break;case g.State.WAITING_INIT_PTS:var F=this.videoTrackCC;if(void 0===this.initPTS[F])break;var j=this.waitingFragment;if(j){var G=j.frag.cc;F!==G?(t=this.tracks[this.trackId]).details&&t.details.live&&(d.logger.warn("Waiting fragment CC ("+G+") does not match video track CC ("+F+")"),this.waitingFragment=null,this.state=g.State.IDLE):(this.state=g.State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=g.State.IDLE;break;case g.State.STOPPED:case g.State.FRAG_LOADING:case g.State.PARSING:case g.State.PARSED:case g.State.ENDED:}}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(d.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onAudioTracksUpdated",value:function(e){d.logger.log("audio tracks updated"),this.tracks=e.audioTracks}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=g.State.PAUSED,this.waitingFragment=null,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=g.State.IDLE),this.tick()}},{key:"onAudioTrackLoaded",value:function(e){var t=e.details,n=e.id,r=this.tracks[n],i=t.totalduration,o=0;if(d.logger.log("track "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),t.live){var a=r.details;a&&t.fragments.length>0?(u.mergeDetails(a,t),o=t.fragments[0].start,t.PTSKnown?d.logger.log("live audio playlist sliding:"+o.toFixed(3)):d.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,d.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,!this.startFragRequested){if(-1===this.startPosition){var s=t.startTimeOffset;Number.isFinite(s)?(d.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===g.State.WAITING_TRACK&&(this.state=g.State.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===g.State.KEY_LOADING&&(this.state=g.State.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent,n=e.frag;if(this.state===g.State.FRAG_LOADING&&t&&"audio"===n.type&&n.level===t.level&&n.sn===t.sn){var r=this.tracks[this.trackId],i=r.details,o=i.totalduration,u=t.level,l=t.sn,c=t.cc,f=this.config.defaultAudioCodec||r.audioCodec||"mp4a.40.2",p=this.stats=e.stats;if("initSegment"===l)this.state=g.State.IDLE,p.tparsed=p.tbuffered=y.now(),i.initSegment.data=e.payload,this.hls.trigger(s.default.FRAG_BUFFERED,{stats:p,frag:t,id:"audio"}),this.tick();else{this.state=g.State.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new a.default(this.hls,"audio"));var h=this.initPTS[c],v=i.initSegment?i.initSegment.data:[];if(i.initSegment||void 0!==h){this.pendingBuffering=!0,d.logger.log("Demuxing "+l+" of ["+i.startSN+" ,"+i.endSN+"],track "+u);this.demuxer.push(e.payload,v,f,null,t,o,!1,h)}else d.logger.log("unknown video PTS for continuity counter "+c+", waiting for video PTS before demuxing audio frag "+l+" of ["+i.startSN+" ,"+i.endSN+"],track "+u),this.waitingFragment=e,this.state=g.State.WAITING_INIT_PTS}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent,n=e.frag;if(t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===g.State.PARSING){var r=e.tracks,i=void 0;if(r.video&&delete r.video,i=r.audio){i.levelCodec=i.codec,i.id=e.id,this.hls.trigger(s.default.BUFFER_CODECS,r),d.logger.log("audio track:audio,container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var o=i.initSegment;if(o){var a={type:"audio",data:o,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[a]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(s.default.BUFFER_APPENDING,a))}this.tick()}}}},{key:"onFragParsingData",value:function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"audio"===e.id&&"audio"===e.type&&r.sn===n.sn&&r.level===n.level&&this.state===g.State.PARSING){var i=this.trackId,o=this.tracks[i],a=this.hls;Number.isFinite(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),n.addElementaryStream(h.default.ElementaryStreamTypes.AUDIO),d.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),u.updateFragPTSDTS(o.details,n,e.startPTS,e.endPTS);var l=this.audioSwitch,f=this.media,p=!1;if(l&&f)if(f.readyState){var v=f.currentTime;d.logger.log("switching audio track : currentTime:"+v),v>=e.startPTS&&(d.logger.log("switching audio track : flushing all audio"),this.state=g.State.BUFFER_FLUSHING,a.trigger(s.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),p=!0,this.audioSwitch=!1,a.trigger(s.default.AUDIO_TRACK_SWITCHED,{id:i}))}else this.audioSwitch=!1,a.trigger(s.default.AUDIO_TRACK_SWITCHED,{id:i});var m=this.pendingData;if(!m)return d.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void a.trigger(s.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&m.push({type:e.type,data:t,parent:"audio",content:"data"})}),!p&&m.length&&(m.forEach(function(e){t.state===g.State.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(s.default.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent,n=e.frag;t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===g.State.PARSING&&(this.stats.tparsed=y.now(),this.state=g.State.PARSED,this._checkAppendedParsed())}},{key:"onBufferReset",value:function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}},{key:"onBufferCreated",value:function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)}},{key:"onBufferAppended",value:function(e){if("audio"===e.parent){var t=this.state;t!==g.State.PARSING&&t!==g.State.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==g.State.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,n=this.hls;if(e){this.fragPrevious=e,t.tbuffered=y.now(),n.trigger(s.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;d.logger.log("audio buffered : "+l.default.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(s.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=g.State.IDLE}this.tick()}}},{key:"onError",value:function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:var n=e.frag;if(n&&"audio"!==n.type)break;if(!e.fatal){var r=this.fragLoadError;r?r++:r=1;var i=this.config;if(r<=i.fragLoadingMaxRetry){this.fragLoadError=r;var a=Math.min(Math.pow(2,r-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);d.logger.warn("AudioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=y.now()+a,this.state=g.State.FRAG_LOADING_WAITING_RETRY}else d.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=g.State.ERROR}break;case c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case c.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==g.State.ERROR&&(this.state=e.fatal?g.State.ERROR:g.State.IDLE,d.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case c.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===g.State.PARSING||this.state===g.State.PARSED)){var u=this.mediaBuffer,l=this.media.currentTime;if(u&&o.BufferHelper.isBuffered(u,l)&&o.BufferHelper.isBuffered(u,l+.5)){var f=this.config;f.maxMaxBufferLength>=f.maxBufferLength&&(f.maxMaxBufferLength/=2,d.logger.warn("AudioStreamController: reduce max buffer length to "+f.maxMaxBufferLength+"s")),this.state=g.State.IDLE}else d.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=g.State.BUFFER_FLUSHING,this.hls.trigger(s.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}}},{key:"onBufferFlushed",value:function(){var e=this,t=this.pendingData;t&&t.length?(d.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach(function(t){e.hls.trigger(s.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=g.State.PARSED):(this.state=g.State.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,d.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),t}();t.default=_,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newCue=function(e,t,n,i){for(var o=void 0,a=void 0,s=void 0,u=void 0,l=void 0,c=window.VTTCue||window.TextTrackCue,d=0;d<i.rows.length;d++)if(o=i.rows[d],s=!0,u=0,l="",!o.isEmpty()){for(var f=0;f<o.chars.length;f++)o.chars[f].uchar.match(/\s/)&&s?u++:(l+=o.chars[f].uchar,s=!1);o.cueStartTime=t,t===n&&(n+=1e-4),a=new c(t,n,(0,r.fixLineBreaks)(l.trim())),u>=16?u--:u++,navigator.userAgent.match(/Firefox\//)?a.line=d+1:a.line=d>7?d-2:d+1,a.align="left",a.position=Math.max(0,Math.min(100,u/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(a)}};var r=n(30)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e="auto",t={"":!0,lr:!0,rl:!0},n={start:!0,middle:!0,end:!0,left:!0,right:!0};function r(e){return"string"==typeof e&&(!!n[e.toLowerCase()]&&e.toLowerCase())}function i(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}function o(n,o,a){var s=this,u=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),l={};u?s=document.createElement("custom"):l.enumerable=!0,s.hasBeenReset=!1;var c="",d=!1,f=n,p=o,h=a,g=null,v="",m=!0,y="auto",_="start",b=50,S="middle",k=50,w="middle";if(Object.defineProperty(s,"id",i({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(s,"pauseOnExit",i({},l,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(s,"startTime",i({},l,{get:function(){return f},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");f=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",i({},l,{get:function(){return p},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");p=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",i({},l,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",i({},l,{get:function(){return g},set:function(e){g=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",i({},l,{get:function(){return v},set:function(e){var n=function(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");v=n,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",i({},l,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",i({},l,{get:function(){return y},set:function(t){if("number"!=typeof t&&t!==e)throw new SyntaxError("An invalid number or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",i({},l,{get:function(){return _},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",i({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",i({},l,{get:function(){return S},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");S=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",i({},l,{get:function(){return k},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");k=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",i({},l,{get:function(){return w},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");w=t,this.hasBeenReset=!0}})),s.displayState=void 0,u)return s}return o.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},o}(),e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=d(n(1)),o=d(n(3)),a=d(n(73)),s=d(n(74)),u=d(n(75)),l=n(0),c=n(29);function d(e){return e&&e.__esModule?e:{default:e}}function f(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}var p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.default.MEDIA_ATTACHING,i.default.MEDIA_DETACHING,i.default.FRAG_PARSING_USERDATA,i.default.FRAG_DECRYPTED,i.default.MANIFEST_LOADING,i.default.MANIFEST_LOADED,i.default.FRAG_LOADED,i.default.LEVEL_SWITCHING,i.default.INIT_PTS_FOUND));if(n.hls=e,n.config=e.config,n.enabled=!0,n.Cues=e.config.cueHandler,n.textTracks=[],n.tracks=[],n.unparsedVttFrags=[],n.initPTS=[],n.cueRanges=[],n.captionsTracks={},n.captionsProperties={textTrack1:{label:n.config.captionsTextTrack1Label,languageCode:n.config.captionsTextTrack1LanguageCode},textTrack2:{label:n.config.captionsTextTrack2Label,languageCode:n.config.captionsTextTrack2LanguageCode}},n.config.enableCEA708Captions){var r=new s.default(n,"textTrack1"),o=new s.default(n,"textTrack2");n.cea608Parser=new a.default(0,r,o)}return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"addCues",value:function(e,t,n,r){for(var i,o,a,s,u=this.cueRanges,l=!1,c=u.length;c--;){var d=u[c],f=(i=d[0],o=d[1],a=t,s=n,Math.min(o,s)-Math.max(i,a));if(f>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],n),l=!0,f/(n-t)>.5))return}l||u.push([t,n]),this.Cues.newCue(this.captionsTracks[e],t,n,r)}},{key:"onInitPtsFound",value:function(e){var t=this;if("main"===e.id&&(this.initPTS[e.frag.cc]=e.initPTS),this.unparsedVttFrags.length){var n=this.unparsedVttFrags;this.unparsedVttFrags=[],n.forEach(function(e){t.onFragLoaded(e)})}}},{key:"getExistingTrack",value:function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var r=t.textTracks[n];if(r[e])return r}return null}},{key:"createCaptionsTrack",value:function(e){var t=this.captionsProperties[e],n=t.label,r=t.languageCode,i=this.captionsTracks;if(!i[e]){var o=this.getExistingTrack(e);if(o)i[e]=o,(0,c.clearCurrentCues)(i[e]),(0,c.sendAddTrackEvent)(i[e],this.media);else{var a=this.createTextTrack("captions",n,r);a&&(a[e]=!0,i[e]=a)}}}},{key:"createTextTrack",value:function(e,t,n){var r=this.media;if(r)return r.addTextTrack(e,t,n)}},{key:"destroy",value:function(){o.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){this.media=e.media,this._cleanTracks()}},{key:"onMediaDetaching",value:function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){(0,c.clearCurrentCues)(e[t]),delete e[t]})}},{key:"onManifestLoading",value:function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks()}},{key:"_cleanTracks",value:function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var n=0;n<t.length;n++)(0,c.clearCurrentCues)(t[n])}}},{key:"onManifestLoaded",value:function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var n=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,r){var i=void 0;if(r<n.length){for(var o=null,a=0;a<n.length;a++)if(f(n[a],e)){o=n[a];break}o&&(i=o)}i||(i=t.createTextTrack("subtitles",e.name,e.lang)),e.default?i.mode=t.hls.subtitleDisplay?"showing":"hidden":i.mode="disabled",t.textTracks.push(i)})}}},{key:"onLevelSwitching",value:function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions}},{key:"onFragLoaded",value:function(e){var t=e.frag,n=e.payload;if("main"===t.type){var r=t.sn;if(r!==this.lastSn+1){var o=this.cea608Parser;o&&o.reset()}this.lastSn=r}else if("subtitle"===t.type)if(n.byteLength){if(!Number.isFinite(this.initPTS[t.cc]))return this.unparsedVttFrags.push(e),void(this.initPTS.length&&this.hls.trigger(i.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}));var a=t.decryptdata;null!=a&&null!=a.key&&"AES-128"===a.method||this._parseVTTs(t,n)}else this.hls.trigger(i.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})}},{key:"_parseVTTs",value:function(e,t){var n=this.vttCCs;n[e.cc]||(n[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);var r=this.textTracks,o=this.hls;u.default.parse(t,this.initPTS[e.cc],n,e.cc,function(t){var n=r[e.level];"disabled"!==n.mode?(t.forEach(function(e){if(!n.cues.getCueById(e.id))try{n.addCue(e)}catch(r){var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,n.addCue(t)}}),o.trigger(i.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})):o.trigger(i.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},function(t){l.logger.log("Failed to parse VTT cue: "+t),o.trigger(i.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})}},{key:"onFragDecrypted",value:function(e){var t=e.payload,n=e.frag;if("subtitle"===n.type){if(!Number.isFinite(this.initPTS[n.cc]))return void this.unparsedVttFrags.push(e);this._parseVTTs(n,t)}}},{key:"onFragParsingUserdata",value:function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var n=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,n)}}},{key:"extractCea608Data",value:function(e){for(var t=31&e[0],n=2,r=void 0,i=void 0,o=void 0,a=[],s=0;s<t;s++)r=e[n++],i=127&e[n++],o=127&e[n++],0===i&&0===o||0!=(4&r)&&0===(3&r)&&(a.push(i),a.push(o));return a}}]),t}();t.default=p,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},a=function(e){var t=e;return o.hasOwnProperty(e)&&(t=o[e]),String.fromCharCode(t)},s=15,u=100,l={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},c={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},p=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],h={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){this.verboseFilter[e];this.verboseLevel}},g=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},v=function(){function e(t,n,r,o,a){i(this,e),this.foreground=t||"white",this.underline=n||!1,this.italics=r||!1,this.background=o||"black",this.flash=a||!1}return r(e,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),m=function(){function e(t,n,r,o,a,s){i(this,e),this.uchar=t||" ",this.penState=new v(n,r,o,a,s)}return r(e,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),y=function(){function e(){i(this,e),this.chars=[];for(var t=0;t<u;t++)this.chars.push(new m);this.pos=0,this.currPenState=new v}return r(e,[{key:"equals",value:function(e){for(var t=!0,n=0;n<u;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<u;t++)this.chars[t].copy(e.chars[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<u;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(h.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>u&&(h.log("ERROR","Too large cursor position "+this.pos),this.pos=u)}},{key:"moveCursor",value:function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){e>=144&&this.backSpace();var t=a(e);this.pos>=u?h.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}},{key:"clearFromPos",value:function(e){var t=void 0;for(t=e;t<u;t++)this.chars[t].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],t=!0,n=0;n<u;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}]),e}(),_=function(){function e(){i(this,e),this.rows=[];for(var t=0;t<s;t++)this.rows.push(new y);this.currRow=s-1,this.nrRollUpRows=null,this.reset()}return r(e,[{key:"reset",value:function(){for(var e=0;e<s;e++)this.rows[e].clear();this.currRow=s-1}},{key:"equals",value:function(e){for(var t=!0,n=0;n<s;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<s;t++)this.rows[t].copy(e.rows[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<s;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){this.rows[this.currRow].backSpace()}},{key:"clearToEndOfRow",value:function(){this.rows[this.currRow].clearToEndOfRow()}},{key:"insertChar",value:function(e){this.rows[this.currRow].insertChar(e)}},{key:"setPen",value:function(e){this.rows[this.currRow].setPenStyles(e)}},{key:"moveCursor",value:function(e){this.rows[this.currRow].moveCursor(e)}},{key:"setCursor",value:function(e){h.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)}},{key:"setPAC",value:function(e){h.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var n=0;n<s;n++)this.rows[n].clear();var r=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var o=i.rows[r].cueStartTime;if(o&&o<h.time)for(var a=0;a<this.nrRollUpRows;a++)this.rows[t-this.nrRollUpRows+a+1].copy(i.rows[r+a])}}this.currRow=t;var u=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,c=Math.max(l-1,0);u.setCursor(e.indent),e.color=u.chars[c].penState.foreground}var d={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(d)}},{key:"setBkgData",value:function(e){h.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){if(null!==this.nrRollUpRows){h.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),h.log("INFO","Rolling up")}else h.log("DEBUG","roll_up but nrRollUpRows not set yet")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var t=[],n="",r=-1,i=0;i<s;i++){var o=this.rows[i].getTextString();o&&(r=i+1,e?t.push("Row "+r+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}},{key:"getTextAndFormat",value:function(){return this.rows}}]),e}(),b=function(){function e(t,n){i(this,e),this.chNr=t,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new _,this.nonDisplayedMemory=new _,this.lastOutputScreen=new _,this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return r(e,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,h.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";h.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(h.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){h.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){h.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){h.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){h.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){h.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){h.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){h.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){h.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){h.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}},{key:"ccCR",value:function(){h.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}},{key:"ccENM",value:function(){h.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(h.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,h.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}},{key:"ccTO",value:function(e){h.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}h.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=h.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),!0===e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),e}(),S=function(){function e(t,n,r){i(this,e),this.field=t||1,this.outputs=[n,r],this.channels=[new b(1,n),new b(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return r(e,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(e,t){var n=void 0,r=void 0,i=void 0,o=!1;this.lastTime=e,h.setTime(e);for(var a=0;a<t.length;a+=2)if(r=127&t[a],i=127&t[a+1],0!==r||0!==i){if(h.log("DATA","["+g([t[a],t[a+1]])+"] -> ("+g([r,i])+")"),(n=this.parseCmd(r,i))||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),!n)if(o=this.parseChars(r,i))if(this.currChNr&&this.currChNr>=0)this.channels[this.currChNr-1].insertChars(o);else h.log("WARNING","No channel found yet. TEXT-MODE?");n?this.dataCounters.cmd+=2:o?this.dataCounters.char+=2:(this.dataCounters.other+=2,h.log("WARNING","Couldn't parse cleaned data "+g([r,i])+" orig: "+g([t[a],t[a+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(e,t){var n=null;if(!((20===e||28===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,h.log("DEBUG","Repeated command ("+g([e,t])+") is dropped"),!0;n=20===e||23===e?1:2;var r=this.channels[n-1];return 20===e||28===e?32===t?r.ccRCL():33===t?r.ccBS():34===t?r.ccAOF():35===t?r.ccAON():36===t?r.ccDER():37===t?r.ccRU(2):38===t?r.ccRU(3):39===t?r.ccRU(4):40===t?r.ccFON():41===t?r.ccRDC():42===t?r.ccTR():43===t?r.ccRTD():44===t?r.ccEDM():45===t?r.ccCR():46===t?r.ccENM():47===t&&r.ccEOC():r.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0}},{key:"parseMidrow",value:function(e,t){var n=null;return(17===e||25===e)&&t>=32&&t<=47&&((n=17===e?1:2)!==this.currChNr?(h.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[n-1].ccMIDROW(t),h.log("DEBUG","MIDROW ("+g([e,t])+")"),!0))}},{key:"parsePAC",value:function(e,t){var n,r=null;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;n=e<=23?1:2,r=t>=64&&t<=95?1===n?l[e]:d[e]:1===n?c[e]:f[e];var i=this.interpretPAC(r,t);return this.channels[n-1].setPAC(i),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0}},{key:"interpretPAC",value:function(e,t){var n=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r}},{key:"parseChars",value:function(e,t){var n=null,r=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),i>=17&&i<=19){var o=t;o=17===i?t+80:18===i?t+112:t+144,h.log("INFO","Special char '"+a(o)+"' in channel "+n),r=[o]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);if(r){var s=g(r);h.log("DEBUG","Char codes =  "+s.join(",")),this.lastCmdA=null,this.lastCmdB=null}return r}},{key:"parseBackgroundAttributes",value:function(e,t){var n,r=void 0,i=void 0;return((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47)&&(r={},16===e||24===e?(i=Math.floor((t-32)/2),r.background=p[i],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0)),n=e<24?1:2,this.channels[n-1].setBkgData(r),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}}]),e}();t.default=S,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timelineController=t,this.trackName=n,this.startTime=null,this.endTime=null,this.screen=null}return r(e,[{key:"dispatchCue",value:function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)}},{key:"newCue",value:function(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}}]),e}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(30),o=(r=i)&&r.__esModule?r:{default:r},a=n(10);var s=function(e,t,n){return e.substr(n||0,t.length)===t},u=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()},l={parse:function(e,t,n,r,i,l){var c=(0,a.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),d="00:00.000",f=0,p=0,h=0,g=[],v=void 0,m=!0,y=new o.default;y.oncue=function(e){var t=n[r],i=n.ccOffset;t&&t.new&&(void 0!==p?i=n.ccOffset=t.start:function(e,t,n){var r=e[t],i=e[r.prevCC];if(!i||!i.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;i&&i.new;)e.ccOffset+=r.start-i.start,r.new=!1,i=e[(r=i).prevCC];e.presentationOffset=n}(n,r,h)),h&&(i=h-n.presentationOffset),e.startTime+=i-p,e.endTime+=i-p,e.id=u(e.startTime.toString())+u(e.endTime.toString())+u(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&g.push(e)},y.onparsingerror=function(e){v=e},y.onflush=function(){v&&l?l(v):i(g)},c.forEach(function(e){if(m){if(s(e,"X-TIMESTAMP-MAP=")){m=!1,e.substr(16).split(",").forEach(function(e){s(e,"LOCAL:")?d=e.substr(6):s(e,"MPEGTS:")&&(f=parseInt(e.substr(7)))});try{t+(9e4*n[r].start||0)<0&&(t+=8589934592),f-=t,i=d,o=parseInt(i.substr(-3)),a=parseInt(i.substr(-6,2)),u=parseInt(i.substr(-9,2)),l=i.length>9?parseInt(i.substr(0,i.indexOf(":"))):0,p=(Number.isFinite(o)&&Number.isFinite(a)&&Number.isFinite(u)&&Number.isFinite(l)?(o+=1e3*a,o+=6e4*u,o+=36e5*l):-1)/1e3,h=f/9e4,-1===p&&(v=new Error("Malformed X-TIMESTAMP-MAP: "+e))}catch(t){v=new Error("Malformed X-TIMESTAMP-MAP: "+e)}return}""===e&&(m=!1)}var i,o,a,u,l;y.parse(e+"\n")}),y.flush()}};t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=u(n(1)),o=u(n(3)),a=n(0),s=n(7);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.default.MEDIA_ATTACHED,i.default.MEDIA_DETACHING,i.default.MANIFEST_LOADED,i.default.SUBTITLE_TRACK_LOADED));return n.tracks=[],n.trackId=-1,n.media=null,n.stopped=!0,n.subtitleDisplay=!0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"destroy",value:function(){o.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(e){var t=this;this.media=e.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))}},{key:"onMediaDetaching",value:function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)}},{key:"onManifestLoaded",value:function(e){var t=this,n=e.subtitles||[];this.tracks=n,this.hls.trigger(i.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:n}),n.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})}},{key:"onSubtitleTrackLoaded",value:function(e){var t=this,n=e.id,r=e.details,i=this.trackId,o=this.tracks,u=o[i];if(n>=o.length||n!==i||!u||this.stopped)this._clearReloadTimer();else if(a.logger.log("subtitle track "+n+" loaded"),r.live){var l=(0,s.computeReloadInterval)(u.details,r,e.stats.trequest);a.logger.log("Reloading live subtitle playlist in "+l+"ms"),this.timer=setTimeout(function(){t._loadCurrentTrack()},l)}else this._clearReloadTimer()}},{key:"startLoad",value:function(){this.stopped=!1,this._loadCurrentTrack()}},{key:"stopLoad",value:function(){this.stopped=!0,this._clearReloadTimer()}},{key:"_clearReloadTimer",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}},{key:"_loadCurrentTrack",value:function(){var e=this.trackId,t=this.tracks,n=this.hls,r=t[e];e<0||!r||r.details&&!r.details.live||(a.logger.log("Loading subtitle track "+e),n.trigger(i.default.SUBTITLE_TRACK_LOADING,{url:r.url,id:e}))}},{key:"_toggleTrackModes",value:function(e){var t=this.media,n=this.subtitleDisplay,r=this.trackId;if(t){var i=c(t.textTracks);if(-1===e)[].slice.call(i).forEach(function(e){e.mode="disabled"});else{var o=i[r];o&&(o.mode="disabled")}var a=i[e];a&&(a.mode=n?"showing":"hidden")}}},{key:"_setSubtitleTrackInternal",value:function(e){var t=this.hls,n=this.tracks;!Number.isFinite(e)||e<-1||e>=n.length||(this.trackId=e,a.logger.log("Switching to subtitle track "+e),t.trigger(i.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())}},{key:"_onTextTracksChanged",value:function(){if(this.media){for(var e=-1,t=c(this.media.textTracks),n=0;n<t.length;n++)if("hidden"===t[n].mode)e=n;else if("showing"===t[n].mode){e=n;break}this.subtitleTrack=e}}},{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}]),t}();function c(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"subtitles"===r.kind&&r.label&&t.push(e[n])}return t}t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubtitleStreamController=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=p(n(1)),o=n(0),a=p(n(12)),s=n(4),u=n(27),l=n(6),c=n(14),d=p(c),f=n(7);function p(e){return e&&e.__esModule?e:{default:e}}var h=window.performance;t.SubtitleStreamController=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.default.MEDIA_ATTACHED,i.default.MEDIA_DETACHING,i.default.ERROR,i.default.KEY_LOADED,i.default.FRAG_LOADED,i.default.SUBTITLE_TRACKS_UPDATED,i.default.SUBTITLE_TRACK_SWITCH,i.default.SUBTITLE_TRACK_LOADED,i.default.SUBTITLE_FRAG_PROCESSED,i.default.LEVEL_UPDATED));return r.fragmentTracker=n,r.config=e.config,r.state=c.State.STOPPED,r.tracks=[],r.tracksBuffered=[],r.currentTrackId=-1,r.decrypter=new a.default(e,e.config),r.lastAVStart=0,r._onMediaSeeking=r.onMediaSeeking.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d.default),r(t,[{key:"onSubtitleFragProcessed",value:function(e){var t=e.frag,n=e.success;if(this.fragPrevious=t,this.state=c.State.IDLE,n){var r=this.tracksBuffered[this.currentTrackId];if(r){for(var i=void 0,o=t.start,a=0;a<r.length;a++)if(o>=r[a].start&&o<=r[a].end){i=r[a];break}var s=t.start+t.duration;i?i.end=s:(i={start:o,end:s},r.push(i))}}}},{key:"onMediaAttached",value:function(e){var t=e.media;this.media=t,t.addEventListener("seeking",this._onMediaSeeking),this.state=c.State.IDLE}},{key:"onMediaDetaching",value:function(){this.media.removeEventListener("seeking",this._onMediaSeeking),this.media=null,this.state=c.State.STOPPED}},{key:"onError",value:function(e){var t=e.frag;t&&"subtitle"===t.type&&(this.state=c.State.IDLE)}},{key:"onSubtitleTracksUpdated",value:function(e){var t=this;o.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach(function(e){t.tracksBuffered[e.id]=[]})}},{key:"onSubtitleTrackSwitch",value:function(e){if(this.currentTrackId=e.id,this.tracks&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(500)}else this.clearInterval()}},{key:"onSubtitleTrackLoaded",value:function(e){var t=e.id,n=e.details,r=this.currentTrackId,i=this.tracks,o=i[r];t>=i.length||t!==r||!o||(n.live&&(0,f.mergeSubtitlePlaylists)(o.details,n,this.lastAVStart),o.details=n,this.setInterval(500))}},{key:"onKeyLoaded",value:function(){this.state===c.State.KEY_LOADING&&(this.state=c.State.IDLE)}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent,n=e.frag.decryptdata,r=e.frag,o=this.hls;if(this.state===c.State.FRAG_LOADING&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&e.payload.byteLength>0&&n&&n.key&&"AES-128"===n.method){var a=h.now();this.decrypter.decrypt(e.payload,n.key.buffer,n.iv.buffer,function(e){var t=h.now();o.trigger(i.default.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:a,tdecrypt:t}})})}}},{key:"onLevelUpdated",value:function(e){var t=e.details.fragments;this.lastAVStart=t.length?t[0].start:0}},{key:"doTick",value:function(){if(this.media)switch(this.state){case c.State.IDLE:var e=this.config,t=this.currentTrackId,n=this.fragmentTracker,r=this.media,a=this.tracks;if(!a||!a[t]||!a[t].details)break;var d=e.maxBufferHole,f=e.maxFragLookUpTolerance,p=Math.min(e.maxBufferLength,e.maxMaxBufferLength),h=s.BufferHelper.bufferedInfo(this._getBuffered(),r.currentTime,d),g=h.end,v=h.len,m=a[t].details,y=m.fragments,_=y.length,b=y[_-1].start+y[_-1].duration;if(v>p)return;var S=void 0,k=this.fragPrevious;g<b?(k&&m.hasProgramDateTime&&(S=(0,u.findFragmentByPDT)(y,k.endProgramDateTime,f)),S||(S=(0,u.findFragmentByPTS)(k,y,g,f))):S=y[_-1],S&&S.encrypted?(o.logger.log("Loading key for "+S.sn),this.state=c.State.KEY_LOADING,this.hls.trigger(i.default.KEY_LOADING,{frag:S})):S&&n.getState(S)===l.FragmentState.NOT_LOADED&&(this.fragCurrent=S,this.state=c.State.FRAG_LOADING,this.hls.trigger(i.default.FRAG_LOADING,{frag:S}))}else this.state=c.State.IDLE}},{key:"stopLoad",value:function(){this.lastAVStart=0,function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stopLoad",this).call(this)}},{key:"_getBuffered",value:function(){return this.tracksBuffered[this.currentTrackId]||[]}},{key:"onMediaSeeking",value:function(){this.fragPrevious=null}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=u(n(3)),o=u(n(1)),a=n(2),s=n(0);function u(e){return e&&e.__esModule?e:{default:e}}var l=window.XMLHttpRequest,c="com.widevine.alpha",d="com.microsoft.playready",f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o.default.MEDIA_ATTACHED,o.default.MANIFEST_PARSED));return n._widevineLicenseUrl=e.config.widevineLicenseUrl,n._licenseXhrSetup=e.config.licenseXhrSetup,n._emeEnabled=e.config.emeEnabled,n._requestMediaKeySystemAccess=e.config.requestMediaKeySystemAccessFunc,n._mediaKeysList=[],n._media=null,n._hasSetMediaKeys=!1,n._isMediaEncrypted=!1,n._requestLicenseFailureCount=0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),r(t,[{key:"getLicenseServerUrl",value:function(e){var t=void 0;switch(e){case c:t=this._widevineLicenseUrl;break;default:t=null}return t||(s.logger.error('No license server URL configured for key-system "'+e+'"'),this.hls.trigger(o.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),t}},{key:"_attemptKeySystemAccess",value:function(e,t,n){var r=this,i=function(e,t,n){switch(e){case c:return function(e,t,n){var r={videoCapabilities:[]};return t.forEach(function(e){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})}),[r]}(0,n);default:throw Error("Unknown key-system: "+e)}}(e,0,n);i?(s.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(e,i).then(function(t){r._onMediaKeySystemAccessObtained(e,t)}).catch(function(t){s.logger.error('Failed to obtain key-system "'+e+'" access:',t)})):s.logger.warn("Can not create config for key-system (maybe because platform is not supported):",e)}},{key:"_onMediaKeySystemAccessObtained",value:function(e,t){var n=this;s.logger.log('Access for key-system "'+e+'" obtained');var r={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(r),t.createMediaKeys().then(function(t){r.mediaKeys=t,s.logger.log('Media-keys created for key-system "'+e+'"'),n._onMediaKeysCreated()}).catch(function(e){s.logger.error("Failed to create media-keys:",e)})}},{key:"_onMediaKeysCreated",value:function(){var e=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))})}},{key:"_onNewMediaKeySession",value:function(e){var t=this;s.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",function(n){t._onKeySessionMessage(e,n.message)},!1)}},{key:"_onKeySessionMessage",value:function(e,t){s.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(t){s.logger.log("Received license data, updating key-session"),e.update(t)})}},{key:"_onMediaEncrypted",value:function(e,t){s.logger.log('Media is encrypted using "'+e+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=e,this._mediaEncryptionInitData=t,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()}},{key:"_attemptSetMediaKeys",value:function(){if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return s.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(o.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});s.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}}},{key:"_generateRequestWithPreferredKeySession",value:function(){var e=this,t=this._mediaKeysList[0];if(!t)return s.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(o.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(t.mediaKeysSessionInitialized)s.logger.warn("Key-Session already initialized but requested again");else{var n=t.mediaKeysSession;n||(s.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(o.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}));var r=this._mediaEncryptionInitDataType,i=this._mediaEncryptionInitData;s.logger.log('Generating key-session request for "'+r+'" init data type'),t.mediaKeysSessionInitialized=!0,n.generateRequest(r,i).then(function(){s.logger.debug("Key-session generation succeeded")}).catch(function(t){s.logger.error("Error generating key-session request:",t),e.hls.trigger(o.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}}},{key:"_createLicenseXhr",value:function(e,t,n){var r=new l,i=this._licenseXhrSetup;try{if(i)try{i(r,e)}catch(t){r.open("POST",e,!0),i(r,e)}r.readyState||r.open("POST",e,!0)}catch(e){return s.logger.error("Error setting up key-system license XHR",e),void this.hls.trigger(o.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,e,t,n),r}},{key:"_onLicenseRequestReadyStageChange",value:function(e,t,n,r){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,s.logger.log("License request succeeded"),r(e.response);else{if(s.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount<=3){var i=3-this._requestLicenseFailureCount+1;return s.logger.warn("Retrying license request, "+i+" attempts left"),void this._requestLicense(n,r)}this.hls.trigger(o.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}}},{key:"_generateLicenseRequestChallenge",value:function(e,t){var n=void 0;return e.mediaKeySystemDomain===d?s.logger.error("PlayReady is not supported (yet)"):e.mediaKeySystemDomain===c?n=t:s.logger.error("Unsupported key-system:",e.mediaKeySystemDomain),n}},{key:"_requestLicense",value:function(e,t){s.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return s.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(o.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});var r=this.getLicenseServerUrl(n.mediaKeySystemDomain),i=this._createLicenseXhr(r,e,t);s.logger.log("Sending license request to URL: "+r),i.send(this._generateLicenseRequestChallenge(n,e))}},{key:"onMediaAttached",value:function(e){var t=this;if(this._emeEnabled){var n=e.media;this._media=n,n.addEventListener("encrypted",function(e){t._onMediaEncrypted(e.initDataType,e.initData)})}}},{key:"onManifestParsed",value:function(e){if(this._emeEnabled){var t=e.levels.map(function(e){return e.audioCodec}),n=e.levels.map(function(e){return e.videoCodec});this._attemptKeySystemAccess(c,t,n)}}},{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),t}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;t.requestMediaKeySystemAccess=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={getBrowserVersion:function(){var e=navigator.userAgent;if(e.toLowerCase().indexOf("mobile")>-1)return"Unknown";if(e.indexOf("Firefox")>-1)return"Firefox "+e.match(/firefox\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("Edge")>-1)return"Edge "+e.match(/edge\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("rv:11")>-1)return"IE 11";if(e.indexOf("Opera")>-1||e.indexOf("OPR")>-1){if(e.indexOf("Opera")>-1)return"Opera "+e.match(/opera\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("OPR")>-1)return"Opera "+e.match(/opr\/[\d.]+/gi)[0].match(/[\d]+/)[0]}else{if(e.indexOf("Chrome")>-1)return"Chrome "+e.match(/chrome\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("Safari")>-1)return"Safari "+e.match(/safari\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(!(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1))return"Unknown";if(e.indexOf("MSIE")>-1)return"IE "+e.match(/msie [\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("Trident")>-1){var t=e.match(/trident\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"IE "+(parseInt(t)+4)}}}};t.default=r,e.exports=t.default}])},e.exports=r(n(1103))},1166:function(e,t,n){(function(t){e.exports=function(e,n){function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=r(e),o=r(n);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){s(o,r,i,a,u,"next",e)}function u(e){s(o,r,i,a,u,"throw",e)}a(void 0)})}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach(function(t){f(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var g={MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",ENTER_ROOM_SUCCESS:"JoinedSuccess",ALREADY_IN_ROOM:"AlreadyInGroup"},v="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};function m(e,t){return e(t={exports:{}},t.exports),t.exports}var y=function(e){return e&&e.Math==Math&&e},_=y("object"==typeof globalThis&&globalThis)||y("object"==typeof window&&window)||y("object"==typeof self&&self)||y("object"==typeof v&&v)||Function("return this")(),b=function(e){try{return!!e()}catch(e){return!0}},S=!b(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),k={}.propertyIsEnumerable,w=Object.getOwnPropertyDescriptor,E={f:w&&!k.call({1:2},1)?function(e){var t=w(this,e);return!!t&&t.enumerable}:k},T=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},x={}.toString,C=function(e){return x.call(e).slice(8,-1)},I="".split,R=b(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==C(e)?I.call(e,""):Object(e)}:Object,A=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},O=function(e){return R(A(e))},M=function(e){return"object"==typeof e?null!==e:"function"==typeof e},D=function(e,t){if(!M(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!M(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!M(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!M(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},L={}.hasOwnProperty,P=function(e,t){return L.call(e,t)},N=_.document,U=M(N)&&M(N.createElement),F=function(e){return U?N.createElement(e):{}},j=!S&&!b(function(){return 7!=Object.defineProperty(F("div"),"a",{get:function(){return 7}}).a}),G=Object.getOwnPropertyDescriptor,B={f:S?G:function(e,t){if(e=O(e),t=D(t,!0),j)try{return G(e,t)}catch(e){}if(P(e,t))return T(!E.f.call(e,t),e[t])}},V=function(e){if(!M(e))throw TypeError(String(e)+" is not an object");return e},q=Object.defineProperty,H={f:S?q:function(e,t,n){if(V(e),t=D(t,!0),V(n),j)try{return q(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},z=S?function(e,t,n){return H.f(e,t,T(1,n))}:function(e,t,n){return e[t]=n,e},K=function(e,t){try{z(_,e,t)}catch(n){_[e]=t}return t},W=_["__core-js_shared__"]||K("__core-js_shared__",{}),Y=Function.toString;"function"!=typeof W.inspectSource&&(W.inspectSource=function(e){return Y.call(e)});var J,X,Q,Z=W.inspectSource,$=_.WeakMap,ee="function"==typeof $&&/native code/.test(Z($)),te=m(function(e){(e.exports=function(e,t){return W[e]||(W[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})}),ne=0,re=Math.random(),ie=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++ne+re).toString(36)},oe=te("keys"),ae=function(e){return oe[e]||(oe[e]=ie(e))},se={},ue=_.WeakMap;if(ee){var le=new ue,ce=le.get,de=le.has,fe=le.set;J=function(e,t){return fe.call(le,e,t),t},X=function(e){return ce.call(le,e)||{}},Q=function(e){return de.call(le,e)}}else{var pe=ae("state");se[pe]=!0,J=function(e,t){return z(e,pe,t),t},X=function(e){return P(e,pe)?e[pe]:{}},Q=function(e){return P(e,pe)}}var he,ge,ve={set:J,get:X,has:Q,enforce:function(e){return Q(e)?X(e):J(e,{})},getterFor:function(e){return function(t){var n;if(!M(t)||(n=X(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},me=m(function(e){var t=ve.get,n=ve.enforce,r=String(String).split("String");(e.exports=function(e,t,i,o){var a=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable,u=!!o&&!!o.noTargetGet;"function"==typeof i&&("string"!=typeof t||P(i,"name")||z(i,"name",t),n(i).source=r.join("string"==typeof t?t:"")),e!==_?(a?!u&&e[t]&&(s=!0):delete e[t],s?e[t]=i:z(e,t,i)):s?e[t]=i:K(t,i)})(Function.prototype,"toString",function(){return"function"==typeof this&&t(this).source||Z(this)})}),ye=_,_e=function(e){return"function"==typeof e?e:void 0},be=function(e,t){return arguments.length<2?_e(ye[e])||_e(_[e]):ye[e]&&ye[e][t]||_[e]&&_[e][t]},Se=Math.ceil,ke=Math.floor,we=function(e){return isNaN(e=+e)?0:(e>0?ke:Se)(e)},Ee=Math.min,Te=function(e){return e>0?Ee(we(e),9007199254740991):0},xe=Math.max,Ce=Math.min,Ie=function(e,t){var n=we(e);return n<0?xe(n+t,0):Ce(n,t)},Re=function(e){return function(t,n,r){var i,o=O(t),a=Te(o.length),s=Ie(r,a);if(e&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},Ae={includes:Re(!0),indexOf:Re(!1)},Oe=Ae.indexOf,Me=function(e,t){var n,r=O(e),i=0,o=[];for(n in r)!P(se,n)&&P(r,n)&&o.push(n);for(;t.length>i;)P(r,n=t[i++])&&(~Oe(o,n)||o.push(n));return o},De=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Le=De.concat("length","prototype"),Pe={f:Object.getOwnPropertyNames||function(e){return Me(e,Le)}},Ne={f:Object.getOwnPropertySymbols},Ue=be("Reflect","ownKeys")||function(e){var t=Pe.f(V(e)),n=Ne.f;return n?t.concat(n(e)):t},Fe=function(e,t){for(var n=Ue(t),r=H.f,i=B.f,o=0;o<n.length;o++){var a=n[o];P(e,a)||r(e,a,i(t,a))}},je=/#|\.prototype\./,Ge=function(e,t){var n=Ve[Be(e)];return n==He||n!=qe&&("function"==typeof t?b(t):!!t)},Be=Ge.normalize=function(e){return String(e).replace(je,".").toLowerCase()},Ve=Ge.data={},qe=Ge.NATIVE="N",He=Ge.POLYFILL="P",ze=Ge,Ke=B.f,We=function(e,t){var n,r,i,o,a,s=e.target,u=e.global,l=e.stat;if(n=u?_:l?_[s]||K(s,{}):(_[s]||{}).prototype)for(r in t){if(o=t[r],i=e.noTargetGet?(a=Ke(n,r))&&a.value:n[r],!ze(u?r:s+(l?".":"#")+r,e.forced)&&void 0!==i){if(typeof o==typeof i)continue;Fe(o,i)}(e.sham||i&&i.sham)&&z(o,"sham",!0),me(n,r,o,e)}},Ye=Array.isArray||function(e){return"Array"==C(e)},Je=function(e){return Object(A(e))},Xe=function(e,t,n){var r=D(t);r in e?H.f(e,r,T(0,n)):e[r]=n},Qe=!!Object.getOwnPropertySymbols&&!b(function(){return!String(Symbol())}),Ze=Qe&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,$e=te("wks"),et=_.Symbol,tt=Ze?et:et&&et.withoutSetter||ie,nt=function(e){return P($e,e)||(Qe&&P(et,e)?$e[e]=et[e]:$e[e]=tt("Symbol."+e)),$e[e]},rt=nt("species"),it=function(e,t){var n;return Ye(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!Ye(n.prototype)?M(n)&&null===(n=n[rt])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},ot=be("navigator","userAgent")||"",at=_.process,st=at&&at.versions,ut=st&&st.v8;ut?ge=(he=ut.split("."))[0]+he[1]:ot&&(!(he=ot.match(/Edge\/(\d+)/))||he[1]>=74)&&(he=ot.match(/Chrome\/(\d+)/))&&(ge=he[1]);var lt=ge&&+ge,ct=nt("species"),dt=function(e){return lt>=51||!b(function(){var t=[];return(t.constructor={})[ct]=function(){return{foo:1}},1!==t[e](Boolean).foo})},ft=nt("isConcatSpreadable"),pt=lt>=51||!b(function(){var e=[];return e[ft]=!1,e.concat()[0]!==e}),ht=dt("concat"),gt=function(e){if(!M(e))return!1;var t=e[ft];return void 0!==t?!!t:Ye(e)};We({target:"Array",proto:!0,forced:!pt||!ht},{concat:function(e){var t,n,r,i,o,a=Je(this),s=it(a,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(gt(o=-1===t?a:arguments[t])){if(u+(i=Te(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<i;n++,u++)n in o&&Xe(s,u,o[n])}else{if(u>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Xe(s,u++,o)}return s.length=u,s}});var vt=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},mt=function(e,t,n){if(vt(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},yt=[].push,_t=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=5==e||o;return function(s,u,l,c){for(var d,f,p=Je(s),h=R(p),g=mt(u,l,3),v=Te(h.length),m=0,y=c||it,_=t?y(s,v):n?y(s,0):void 0;v>m;m++)if((a||m in h)&&(f=g(d=h[m],m,p),e))if(t)_[m]=f;else if(f)switch(e){case 3:return!0;case 5:return d;case 6:return m;case 2:yt.call(_,d)}else if(i)return!1;return o?-1:r||i?i:_}},bt={forEach:_t(0),map:_t(1),filter:_t(2),some:_t(3),every:_t(4),find:_t(5),findIndex:_t(6)},St=function(e,t){var n=[][e];return!!n&&b(function(){n.call(null,t||function(){throw 1},1)})},kt=Object.defineProperty,wt={},Et=function(e){throw e},Tt=function(e,t){if(P(wt,e))return wt[e];t||(t={});var n=[][e],r=!!P(t,"ACCESSORS")&&t.ACCESSORS,i=P(t,0)?t[0]:Et,o=P(t,1)?t[1]:void 0;return wt[e]=!!n&&!b(function(){if(r&&!S)return!0;var e={length:-1};r?kt(e,1,{enumerable:!0,get:Et}):e[1]=1,n.call(e,i,o)})},xt=bt.forEach,Ct=St("forEach"),It=Tt("forEach"),Rt=Ct&&It?[].forEach:function(e){return xt(this,e,arguments.length>1?arguments[1]:void 0)};We({target:"Array",proto:!0,forced:[].forEach!=Rt},{forEach:Rt});var At,Ot=Object.keys||function(e){return Me(e,De)},Mt=S?Object.defineProperties:function(e,t){V(e);for(var n,r=Ot(t),i=r.length,o=0;i>o;)H.f(e,n=r[o++],t[n]);return e},Dt=be("document","documentElement"),Lt=ae("IE_PROTO"),Pt=function(){},Nt=function(e){return"<script>"+e+"<\/script>"},Ut=function(){try{At=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;Ut=At?function(e){e.write(Nt("")),e.close();var t=e.parentWindow.Object;return e=null,t}(At):((t=F("iframe")).style.display="none",Dt.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Nt("document.F=Object")),e.close(),e.F);for(var n=De.length;n--;)delete Ut.prototype[De[n]];return Ut()};se[Lt]=!0;var Ft=Object.create||function(e,t){var n;return null!==e?(Pt.prototype=V(e),n=new Pt,Pt.prototype=null,n[Lt]=e):n=Ut(),void 0===t?n:Mt(n,t)},jt=nt("unscopables"),Gt=Array.prototype;null==Gt[jt]&&H.f(Gt,jt,{configurable:!0,value:Ft(null)});var Bt=function(e){Gt[jt][e]=!0},Vt=Ae.includes,qt=Tt("indexOf",{ACCESSORS:!0,1:0});We({target:"Array",proto:!0,forced:!qt},{includes:function(e){return Vt(this,e,arguments.length>1?arguments[1]:void 0)}}),Bt("includes");var Ht=[].join,zt=R!=Object,Kt=St("join",",");We({target:"Array",proto:!0,forced:zt||!Kt},{join:function(e){return Ht.call(O(this),void 0===e?",":e)}});var Wt=[].slice,Yt={},Jt=Function.bind||function(e){var t=vt(this),n=Wt.call(arguments,1),r=function(){var i=n.concat(Wt.call(arguments));return this instanceof r?function(e,t,n){if(!(t in Yt)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";Yt[t]=Function("C,a","return new C("+r.join(",")+")")}return Yt[t](e,n)}(t,i.length,i):t.apply(e,i)};return M(t.prototype)&&(r.prototype=t.prototype),r};We({target:"Function",proto:!0},{bind:Jt});var Xt={};Xt[nt("toStringTag")]="z";var Qt="[object z]"===String(Xt),Zt=nt("toStringTag"),$t="Arguments"==C(function(){return arguments}()),en=Qt?C:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Zt))?n:$t?C(t):"Object"==(r=C(t))&&"function"==typeof t.callee?"Arguments":r},tn=Qt?{}.toString:function(){return"[object "+en(this)+"]"};Qt||me(Object.prototype,"toString",tn,{unsafe:!0});var nn="\t\n\v\f\r                　\u2028\u2029\ufeff",rn="["+nn+"]",on=RegExp("^"+rn+rn+"*"),an=RegExp(rn+rn+"*$"),sn=function(e){return function(t){var n=String(A(t));return 1&e&&(n=n.replace(on,"")),2&e&&(n=n.replace(an,"")),n}},un={start:sn(1),end:sn(2),trim:sn(3)},ln=un.trim,cn=_.parseInt,dn=/^[+-]?0[Xx]/,fn=8!==cn(nn+"08")||22!==cn(nn+"0x16")?function(e,t){var n=ln(String(e));return cn(n,t>>>0||(dn.test(n)?16:10))}:cn;We({global:!0,forced:parseInt!=fn},{parseInt:fn});var pn=_.Promise,hn=function(e,t,n){for(var r in t)me(e,r,t[r],n);return e},gn=H.f,vn=nt("toStringTag"),mn=function(e,t,n){e&&!P(e=n?e:e.prototype,vn)&&gn(e,vn,{configurable:!0,value:t})},yn=nt("species"),_n=function(e){var t=be(e),n=H.f;S&&t&&!t[yn]&&n(t,yn,{configurable:!0,get:function(){return this}})},bn=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},Sn={},kn=nt("iterator"),wn=Array.prototype,En=function(e){return void 0!==e&&(Sn.Array===e||wn[kn]===e)},Tn=nt("iterator"),xn=function(e){if(null!=e)return e[Tn]||e["@@iterator"]||Sn[en(e)]},Cn=function(e,t,n,r){try{return r?t(V(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&V(i.call(e)),t}},In=m(function(e){var t=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,n,r,i,o){var a,s,u,l,c,d,f,p=mt(n,r,i?2:1);if(o)a=e;else{if("function"!=typeof(s=xn(e)))throw TypeError("Target is not iterable");if(En(s)){for(u=0,l=Te(e.length);l>u;u++)if((c=i?p(V(f=e[u])[0],f[1]):p(e[u]))&&c instanceof t)return c;return new t(!1)}a=s.call(e)}for(d=a.next;!(f=d.call(a)).done;)if("object"==typeof(c=Cn(a,p,f.value,i))&&c&&c instanceof t)return c;return new t(!1)}).stop=function(e){return new t(!0,e)}}),Rn=nt("iterator"),An=!1;try{var On=0,Mn={next:function(){return{done:!!On++}},return:function(){An=!0}};Mn[Rn]=function(){return this},Array.from(Mn,function(){throw 2})}catch(e){}var Dn,Ln,Pn,Nn=function(e,t){if(!t&&!An)return!1;var n=!1;try{var r={};r[Rn]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Un=nt("species"),Fn=function(e,t){var n,r=V(e).constructor;return void 0===r||null==(n=V(r)[Un])?t:vt(n)},jn=/(iphone|ipod|ipad).*applewebkit/i.test(ot),Gn=_.location,Bn=_.setImmediate,Vn=_.clearImmediate,qn=_.process,Hn=_.MessageChannel,zn=_.Dispatch,Kn=0,Wn={},Yn=function(e){if(Wn.hasOwnProperty(e)){var t=Wn[e];delete Wn[e],t()}},Jn=function(e){return function(){Yn(e)}},Xn=function(e){Yn(e.data)},Qn=function(e){_.postMessage(e+"",Gn.protocol+"//"+Gn.host)};Bn&&Vn||(Bn=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return Wn[++Kn]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Dn(Kn),Kn},Vn=function(e){delete Wn[e]},"process"==C(qn)?Dn=function(e){qn.nextTick(Jn(e))}:zn&&zn.now?Dn=function(e){zn.now(Jn(e))}:Hn&&!jn?(Pn=(Ln=new Hn).port2,Ln.port1.onmessage=Xn,Dn=mt(Pn.postMessage,Pn,1)):!_.addEventListener||"function"!=typeof postMessage||_.importScripts||b(Qn)||"file:"===Gn.protocol?Dn="onreadystatechange"in F("script")?function(e){Dt.appendChild(F("script")).onreadystatechange=function(){Dt.removeChild(this),Yn(e)}}:function(e){setTimeout(Jn(e),0)}:(Dn=Qn,_.addEventListener("message",Xn,!1)));var Zn,$n,er,tr,nr,rr,ir,or,ar={set:Bn,clear:Vn},sr=B.f,ur=ar.set,lr=_.MutationObserver||_.WebKitMutationObserver,cr=_.process,dr=_.Promise,fr="process"==C(cr),pr=sr(_,"queueMicrotask"),hr=pr&&pr.value;hr||(Zn=function(){var e,t;for(fr&&(e=cr.domain)&&e.exit();$n;){t=$n.fn,$n=$n.next;try{t()}catch(e){throw $n?tr():er=void 0,e}}er=void 0,e&&e.enter()},fr?tr=function(){cr.nextTick(Zn)}:lr&&!jn?(nr=!0,rr=document.createTextNode(""),new lr(Zn).observe(rr,{characterData:!0}),tr=function(){rr.data=nr=!nr}):dr&&dr.resolve?(ir=dr.resolve(void 0),or=ir.then,tr=function(){or.call(ir,Zn)}):tr=function(){ur.call(_,Zn)});var gr,vr,mr,yr,_r=hr||function(e){var t={fn:e,next:void 0};er&&(er.next=t),$n||($n=t,tr()),er=t},br=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=vt(t),this.reject=vt(n)},Sr={f:function(e){return new br(e)}},kr=function(e,t){if(V(e),M(t)&&t.constructor===e)return t;var n=Sr.f(e);return(0,n.resolve)(t),n.promise},wr=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Er=ar.set,Tr=nt("species"),xr="Promise",Cr=ve.get,Ir=ve.set,Rr=ve.getterFor(xr),Ar=pn,Or=_.TypeError,Mr=_.document,Dr=_.process,Lr=be("fetch"),Pr=Sr.f,Nr=Pr,Ur="process"==C(Dr),Fr=!!(Mr&&Mr.createEvent&&_.dispatchEvent),jr=ze(xr,function(){if(Z(Ar)===String(Ar)){if(66===lt)return!0;if(!Ur&&"function"!=typeof PromiseRejectionEvent)return!0}if(lt>=51&&/native code/.test(Ar))return!1;var e=Ar.resolve(1),t=function(e){e(function(){},function(){})};return(e.constructor={})[Tr]=t,!(e.then(function(){})instanceof t)}),Gr=jr||!Nn(function(e){Ar.all(e).catch(function(){})}),Br=function(e){var t;return!(!M(e)||"function"!=typeof(t=e.then))&&t},Vr=function(e,t,n){if(!t.notified){t.notified=!0;var r=t.reactions;_r(function(){for(var i=t.value,o=1==t.state,a=0;r.length>a;){var s,u,l,c=r[a++],d=o?c.ok:c.fail,f=c.resolve,p=c.reject,h=c.domain;try{d?(o||(2===t.rejection&&Kr(e,t),t.rejection=1),!0===d?s=i:(h&&h.enter(),s=d(i),h&&(h.exit(),l=!0)),s===c.promise?p(Or("Promise-chain cycle")):(u=Br(s))?u.call(s,f,p):f(s)):p(i)}catch(e){h&&!l&&h.exit(),p(e)}}t.reactions=[],t.notified=!1,n&&!t.rejection&&Hr(e,t)})}},qr=function(e,t,n){var r,i;Fr?((r=Mr.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),_.dispatchEvent(r)):r={promise:t,reason:n},(i=_["on"+e])?i(r):"unhandledrejection"===e&&function(e,t){var n=_.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},Hr=function(e,t){Er.call(_,function(){var n,r=t.value;if(zr(t)&&(n=wr(function(){Ur?Dr.emit("unhandledRejection",r,e):qr("unhandledrejection",e,r)}),t.rejection=Ur||zr(t)?2:1,n.error))throw n.value})},zr=function(e){return 1!==e.rejection&&!e.parent},Kr=function(e,t){Er.call(_,function(){Ur?Dr.emit("rejectionHandled",e):qr("rejectionhandled",e,t.value)})},Wr=function(e,t,n,r){return function(i){e(t,n,i,r)}},Yr=function(e,t,n,r){t.done||(t.done=!0,r&&(t=r),t.value=n,t.state=2,Vr(e,t,!0))},Jr=function(e,t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(e===n)throw Or("Promise can't be resolved itself");var i=Br(n);i?_r(function(){var r={done:!1};try{i.call(n,Wr(Jr,e,r,t),Wr(Yr,e,r,t))}catch(n){Yr(e,r,n,t)}}):(t.value=n,t.state=1,Vr(e,t,!1))}catch(n){Yr(e,{done:!1},n,t)}}};jr&&(Ar=function(e){bn(this,Ar,xr),vt(e),gr.call(this);var t=Cr(this);try{e(Wr(Jr,this,t),Wr(Yr,this,t))}catch(e){Yr(this,t,e)}},(gr=function(e){Ir(this,{type:xr,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=hn(Ar.prototype,{then:function(e,t){var n=Rr(this),r=Pr(Fn(this,Ar));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Ur?Dr.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Vr(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),vr=function(){var e=new gr,t=Cr(e);this.promise=e,this.resolve=Wr(Jr,e,t),this.reject=Wr(Yr,e,t)},Sr.f=Pr=function(e){return e===Ar||e===mr?new vr(e):Nr(e)},"function"==typeof pn&&(yr=pn.prototype.then,me(pn.prototype,"then",function(e,t){var n=this;return new Ar(function(e,t){yr.call(n,e,t)}).then(e,t)},{unsafe:!0}),"function"==typeof Lr&&We({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return kr(Ar,Lr.apply(_,arguments))}}))),We({global:!0,wrap:!0,forced:jr},{Promise:Ar}),mn(Ar,xr,!1),_n(xr),mr=be(xr),We({target:xr,stat:!0,forced:jr},{reject:function(e){var t=Pr(this);return t.reject.call(void 0,e),t.promise}}),We({target:xr,stat:!0,forced:jr},{resolve:function(e){return kr(this,e)}}),We({target:xr,stat:!0,forced:Gr},{all:function(e){var t=this,n=Pr(t),r=n.resolve,i=n.reject,o=wr(function(){var n=vt(t.resolve),o=[],a=0,s=1;In(e,function(e){var u=a++,l=!1;o.push(void 0),s++,n.call(t,e).then(function(e){l||(l=!0,o[u]=e,--s||r(o))},i)}),--s||r(o)});return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=Pr(t),r=n.reject,i=wr(function(){var i=vt(t.resolve);In(e,function(e){i.call(t,e).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var Xr=function(){var e=V(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t};function Qr(e,t){return RegExp(e,t)}var Zr={UNSUPPORTED_Y:b(function(){var e=Qr("a","y");return e.lastIndex=2,null!=e.exec("abcd")}),BROKEN_CARET:b(function(){var e=Qr("^r","gy");return e.lastIndex=2,null!=e.exec("str")})},$r=RegExp.prototype.exec,ei=String.prototype.replace,ti=$r,ni=function(){var e=/a/,t=/b*/g;return $r.call(e,"a"),$r.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),ri=Zr.UNSUPPORTED_Y||Zr.BROKEN_CARET,ii=void 0!==/()??/.exec("")[1];(ni||ii||ri)&&(ti=function(e){var t,n,r,i,o=this,a=ri&&o.sticky,s=Xr.call(o),u=o.source,l=0,c=e;return a&&(-1===(s=s.replace("y","")).indexOf("g")&&(s+="g"),c=String(e).slice(o.lastIndex),o.lastIndex>0&&(!o.multiline||o.multiline&&"\n"!==e[o.lastIndex-1])&&(u="(?: "+u+")",c=" "+c,l++),n=new RegExp("^(?:"+u+")",s)),ii&&(n=new RegExp("^"+u+"$(?!\\s)",s)),ni&&(t=o.lastIndex),r=$r.call(a?n:o,c),a?r?(r.input=r.input.slice(l),r[0]=r[0].slice(l),r.index=o.lastIndex,o.lastIndex+=r[0].length):o.lastIndex=0:ni&&r&&(o.lastIndex=o.global?r.index+r[0].length:t),ii&&r&&r.length>1&&ei.call(r[0],n,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)}),r});var oi=ti;We({target:"RegExp",proto:!0,forced:/./.exec!==oi},{exec:oi});var ai=nt("species"),si=!b(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),ui="$0"==="a".replace(/./,"$0"),li=nt("replace"),ci=!!/./[li]&&""===/./[li]("a","$0"),di=!b(function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}),fi=function(e,t,n,r){var i=nt(e),o=!b(function(){var t={};return t[i]=function(){return 7},7!=""[e](t)}),a=o&&!b(function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[ai]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t});if(!o||!a||"replace"===e&&(!si||!ui||ci)||"split"===e&&!di){var s=/./[i],u=n(i,""[e],function(e,t,n,r,i){return t.exec===oi?o&&!i?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}},{REPLACE_KEEPS_$0:ui,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:ci}),l=u[0],c=u[1];me(String.prototype,e,l),me(RegExp.prototype,i,2==t?function(e,t){return c.call(e,this,t)}:function(e){return c.call(e,this)})}r&&z(RegExp.prototype[i],"sham",!0)},pi=nt("match"),hi=function(e){var t;return M(e)&&(void 0!==(t=e[pi])?!!t:"RegExp"==C(e))},gi=function(e){return function(t,n){var r,i,o=String(A(t)),a=we(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=o.charCodeAt(a))<55296||r>56319||a+1===s||(i=o.charCodeAt(a+1))<56320||i>57343?e?o.charAt(a):r:e?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}},vi={codeAt:gi(!1),charAt:gi(!0)},mi=vi.charAt,yi=function(e,t,n){return t+(n?mi(e,t).length:1)},_i=function(e,t){var n=e.exec;if("function"==typeof n){var r=n.call(e,t);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==C(e))throw TypeError("RegExp#exec called on incompatible receiver");return oi.call(e,t)},bi=[].push,Si=Math.min,ki=!b(function(){return!RegExp(4294967295,"y")});fi("split",2,function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=String(A(this)),i=void 0===n?4294967295:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!hi(e))return t.call(r,e,i);for(var o,a,s,u=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),c=0,d=new RegExp(e.source,l+"g");(o=oi.call(d,r))&&!((a=d.lastIndex)>c&&(u.push(r.slice(c,o.index)),o.length>1&&o.index<r.length&&bi.apply(u,o.slice(1)),s=o[0].length,c=a,u.length>=i));)d.lastIndex===o.index&&d.lastIndex++;return c===r.length?!s&&d.test("")||u.push(""):u.push(r.slice(c)),u.length>i?u.slice(0,i):u}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=A(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=n(r,e,this,i,r!==t);if(o.done)return o.value;var a=V(e),s=String(this),u=Fn(a,RegExp),l=a.unicode,c=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(ki?"y":"g"),d=new u(ki?a:"^(?:"+a.source+")",c),f=void 0===i?4294967295:i>>>0;if(0===f)return[];if(0===s.length)return null===_i(d,s)?[s]:[];for(var p=0,h=0,g=[];h<s.length;){d.lastIndex=ki?h:0;var v,m=_i(d,ki?s:s.slice(h));if(null===m||(v=Si(Te(d.lastIndex+(ki?0:h)),s.length))===p)h=yi(s,h,l);else{if(g.push(s.slice(p,h)),g.length===f)return g;for(var y=1;y<=m.length-1;y++)if(g.push(m[y]),g.length===f)return g;h=p=v}}return g.push(s.slice(p)),g}]},!ki);var wi,Ei=function(e){if(hi(e))throw TypeError("The method doesn't accept regular expressions");return e},Ti=nt("match"),xi=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[Ti]=!1,"/./"[e](t)}catch(e){}}return!1},Ci=B.f,Ii="".startsWith,Ri=Math.min,Ai=xi("startsWith"),Oi=!(Ai||(wi=Ci(String.prototype,"startsWith"),!wi||wi.writable));We({target:"String",proto:!0,forced:!Oi&&!Ai},{startsWith:function(e){var t=String(A(this));Ei(e);var n=Te(Ri(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return Ii?Ii.call(t,r,n):t.slice(n,n+r.length)===r}});var Mi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0};for(var Di in Mi){var Li=_[Di],Pi=Li&&Li.prototype;if(Pi&&Pi.forEach!==Rt)try{z(Pi,"forEach",Rt)}catch(e){Pi.forEach=Rt}}m(function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof d?t:d,o=Object.create(i.prototype),a=new w(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===c)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,a),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var c={};function d(){}function f(){}function p(){}var h={};h[i]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g(E([])));v&&v!==t&&n.call(v,i)&&(h=v);var m=p.prototype=d.prototype=Object.create(h);function y(e){["next","throw","return"].forEach(function(t){s(e,t,function(e){return this._invoke(t,e)})})}function _(e,t){var r;this._invoke=function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=l(e[i],e,o);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(d).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function E(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=m.constructor=p,p.constructor=f,f.displayName=s(p,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,s(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(_.prototype),_.prototype[o]=function(){return this},e.AsyncIterator=_,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new _(u(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},y(m),s(m,a,"Generator"),m[i]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,c):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}});const Ni=Function.prototype.apply,Ui=new WeakMap;function Fi(e){return Ui.has(e)||Ui.set(e,{}),Ui.get(e)}class ji{constructor(e=null,t=console){const n=Fi(this);return n._events=new Set,n._callbacks={},n._console=t,n._maxListeners=null===e?null:parseInt(e,10),this}_addCallback(e,t,n,r){return this._getCallbacks(e).push({callback:t,context:n,weight:r}),this._getCallbacks(e).sort((e,t)=>e.weight>t.weight),this}_getCallbacks(e){return Fi(this)._callbacks[e]}_getCallbackIndex(e,t){return this._has(e)?this._getCallbacks(e).findIndex(e=>e.callback===t):null}_achieveMaxListener(e){return null!==Fi(this)._maxListeners&&Fi(this)._maxListeners<=this.listenersNumber(e)}_callbackIsExists(e,t,n){const r=this._getCallbackIndex(e,t),i=-1!==r?this._getCallbacks(e)[r]:void 0;return-1!==r&&i&&i.context===n}_has(e){return Fi(this)._events.has(e)}on(e,t,n=null,r=1){const i=Fi(this);if("function"!=typeof t)throw new TypeError(t+" is not a function");return this._has(e)?(this._achieveMaxListener(e)&&i._console.warn(`Max listeners (${i._maxListeners}) for event "${e}" is reached!`),this._callbackIsExists(...arguments)&&i._console.warn(`Event "${e}" already has the callback ${t}.`)):(i._events.add(e),i._callbacks[e]=[]),this._addCallback(...arguments),this}once(e,t,n=null,r=1){const i=(...r)=>(this.off(e,i),Ni.call(t,n,r));return this.on(e,i,n,r)}off(e,t=null){const n=Fi(this);let r;return this._has(e)&&(null===t?(n._events.delete(e),n._callbacks[e]=null):-1!==(r=this._getCallbackIndex(e,t))&&(n._callbacks[e].splice(r,1),this.off(...arguments))),this}emit(e,...t){return this._has(e)&&this._getCallbacks(e).forEach(e=>Ni.call(e.callback,e.context,t)),this}clear(){const e=Fi(this);return e._events.clear(),e._callbacks={},this}listenersNumber(e){return this._has(e)?this._getCallbacks(e).length:null}}var Gi=function(e){var t,n,r,i,o,a,s=Je(e),u="function"==typeof this?this:Array,l=arguments.length,c=l>1?arguments[1]:void 0,d=void 0!==c,f=xn(s),p=0;if(d&&(c=mt(c,l>2?arguments[2]:void 0,2)),null==f||u==Array&&En(f))for(n=new u(t=Te(s.length));t>p;p++)a=d?c(s[p],p):s[p],Xe(n,p,a);else for(o=(i=f.call(s)).next,n=new u;!(r=o.call(i)).done;p++)a=d?Cn(i,c,[r.value,p],!0):r.value,Xe(n,p,a);return n.length=p,n},Bi=!Nn(function(e){Array.from(e)});We({target:"Array",stat:!0,forced:Bi},{from:Gi});var Vi=Ae.indexOf,qi=[].indexOf,Hi=!!qi&&1/[1].indexOf(1,-0)<0,zi=St("indexOf"),Ki=Tt("indexOf",{ACCESSORS:!0,1:0});We({target:"Array",proto:!0,forced:Hi||!zi||!Ki},{indexOf:function(e){return Hi?qi.apply(this,arguments)||0:Vi(this,e,arguments.length>1?arguments[1]:void 0)}});var Wi,Yi,Ji,Xi=!b(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Qi=ae("IE_PROTO"),Zi=Object.prototype,$i=Xi?Object.getPrototypeOf:function(e){return e=Je(e),P(e,Qi)?e[Qi]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Zi:null},eo=nt("iterator"),to=!1;[].keys&&("next"in(Ji=[].keys())?(Yi=$i($i(Ji)))!==Object.prototype&&(Wi=Yi):to=!0),null==Wi&&(Wi={}),P(Wi,eo)||z(Wi,eo,function(){return this});var no={IteratorPrototype:Wi,BUGGY_SAFARI_ITERATORS:to},ro=no.IteratorPrototype,io=function(){return this},oo=function(e,t,n){var r=t+" Iterator";return e.prototype=Ft(ro,{next:T(1,n)}),mn(e,r,!1),Sn[r]=io,e},ao=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return V(n),function(e){if(!M(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),so=no.IteratorPrototype,uo=no.BUGGY_SAFARI_ITERATORS,lo=nt("iterator"),co=function(){return this},fo=function(e,t,n,r,i,o,a){oo(n,t,r);var s,u,l,c=function(e){if(e===i&&g)return g;if(!uo&&e in p)return p[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",f=!1,p=e.prototype,h=p[lo]||p["@@iterator"]||i&&p[i],g=!uo&&h||c(i),v="Array"==t&&p.entries||h;if(v&&(s=$i(v.call(new e)),so!==Object.prototype&&s.next&&($i(s)!==so&&(ao?ao(s,so):"function"!=typeof s[lo]&&z(s,lo,co)),mn(s,d,!0))),"values"==i&&h&&"values"!==h.name&&(f=!0,g=function(){return h.call(this)}),p[lo]!==g&&z(p,lo,g),Sn[t]=g,i)if(u={values:c("values"),keys:o?g:c("keys"),entries:c("entries")},a)for(l in u)(uo||f||!(l in p))&&me(p,l,u[l]);else We({target:t,proto:!0,forced:uo||f},u);return u},po=ve.set,ho=ve.getterFor("Array Iterator"),go=fo(Array,"Array",function(e,t){po(this,{type:"Array Iterator",target:O(e),index:0,kind:t})},function(){var e=ho(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values");Sn.Arguments=Sn.Array,Bt("keys"),Bt("values"),Bt("entries");var vo=H.f,mo=Function.prototype,yo=mo.toString,_o=/^\s*function ([^ (]*)/;S&&!("name"in mo)&&vo(mo,"name",{configurable:!0,get:function(){try{return yo.call(this).match(_o)[1]}catch(e){return""}}});var bo=!b(function(){return Object.isExtensible(Object.preventExtensions({}))}),So=m(function(e){var t=H.f,n=ie("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},a=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!M(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!P(e,n)){if(!i(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!P(e,n)){if(!i(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return bo&&a.REQUIRED&&i(e)&&!P(e,n)&&o(e),e}};se[n]=!0}),ko=(So.REQUIRED,So.fastKey,So.getWeakData,So.onFreeze,function(e,t,n){var r,i;return ao&&"function"==typeof(r=t.constructor)&&r!==n&&M(i=r.prototype)&&i!==n.prototype&&ao(e,i),e}),wo=H.f,Eo=So.fastKey,To=ve.set,xo=ve.getterFor,Co=(function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",a=_[e],s=a&&a.prototype,u=a,l={},c=function(e){var t=s[e];me(s,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!M(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!M(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!M(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(ze(e,"function"!=typeof a||!(i||s.forEach&&!b(function(){(new a).entries().next()}))))u=n.getConstructor(t,e,r,o),So.REQUIRED=!0;else if(ze(e,!0)){var d=new u,f=d[o](i?{}:-0,1)!=d,p=b(function(){d.has(1)}),h=Nn(function(e){new a(e)}),g=!i&&b(function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)});h||((u=t(function(t,n){bn(t,u,e);var i=ko(new a,t,u);return null!=n&&In(n,i[o],i,r),i})).prototype=s,s.constructor=u),(p||g)&&(c("delete"),c("has"),r&&c("get")),(g||f)&&c(o),i&&s.clear&&delete s.clear}l[e]=u,We({global:!0,forced:u!=a},l),mn(u,e),i||n.setStrong(u,e,r)}("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(e,t,n,r){var i=e(function(e,o){bn(e,i,t),To(e,{type:t,index:Ft(null),first:void 0,last:void 0,size:0}),S||(e.size=0),null!=o&&In(o,e[r],e,n)}),o=xo(t),a=function(e,t,n){var r,i,a=o(e),u=s(e,t);return u?u.value=n:(a.last=u={index:i=Eo(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=u),r&&(r.next=u),S?a.size++:e.size++,"F"!==i&&(a.index[i]=u)),e},s=function(e,t){var n,r=o(e),i=Eo(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return hn(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,S?e.size=0:this.size=0},delete:function(e){var t=o(this),n=s(this,e);if(n){var r=n.next,i=n.previous;delete t.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),t.first==n&&(t.first=r),t.last==n&&(t.last=i),S?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=o(this),r=mt(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!s(this,e)}}),hn(i.prototype,n?{get:function(e){var t=s(this,e);return t&&t.value},set:function(e,t){return a(this,0===e?0:e,t)}}:{add:function(e){return a(this,e=0===e?0:e,e)}}),S&&wo(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=xo(t),o=xo(r);fo(e,t,function(e,t){To(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})},n?"entries":"values",!n,!0),_n(t)}}),b(function(){Ot(1)}));We({target:"Object",stat:!0,forced:Co},{keys:function(e){return Ot(Je(e))}});var Io=E.f,Ro=function(e){return function(t){for(var n,r=O(t),i=Ot(r),o=i.length,a=0,s=[];o>a;)n=i[a++],S&&!Io.call(r,n)||s.push(e?[n,r[n]]:r[n]);return s}},Ao=(Ro(!0),Ro(!1));We({target:"Object",stat:!0},{values:function(e){return Ao(e)}});var Oo=vi.charAt,Mo=ve.set,Do=ve.getterFor("String Iterator");fo(String,"String",function(e){Mo(this,{type:"String Iterator",string:String(e),index:0})},function(){var e,t=Do(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=Oo(n,r),t.index+=e.length,{value:e,done:!1})});var Lo=nt("iterator"),Po=nt("toStringTag"),No=go.values;for(var Uo in Mi){var Fo=_[Uo],jo=Fo&&Fo.prototype;if(jo){if(jo[Lo]!==No)try{z(jo,Lo,No)}catch(e){jo[Lo]=No}if(jo[Po]||z(jo,Po,Uo),Mi[Uo])for(var Go in go)if(jo[Go]!==go[Go])try{z(jo,Go,go[Go])}catch(e){jo[Go]=go[Go]}}}var Bo=dt("splice"),Vo=Tt("splice",{ACCESSORS:!0,0:0,1:2}),qo=Math.max,Ho=Math.min;We({target:"Array",proto:!0,forced:!Bo||!Vo},{splice:function(e,t){var n,r,i,o,a,s,u=Je(this),l=Te(u.length),c=Ie(e,l),d=arguments.length;if(0===d?n=r=0:1===d?(n=0,r=l-c):(n=d-2,r=Ho(qo(we(t),0),l-c)),l+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(i=it(u,r),o=0;o<r;o++)(a=c+o)in u&&Xe(i,o,u[a]);if(i.length=r,n<r){for(o=c;o<l-r;o++)s=o+n,(a=o+r)in u?u[s]=u[a]:delete u[s];for(o=l;o>l-r+n;o--)delete u[o-1]}else if(n>r)for(o=l-r;o>c;o--)s=o+n-1,(a=o+r-1)in u?u[s]=u[a]:delete u[s];for(o=0;o<n;o++)u[o+c]=arguments[o+2];return u.length=l-r+n,i}});var zo=Date.prototype,Ko=zo.toString,Wo=zo.getTime;new Date(NaN)+""!="Invalid Date"&&me(zo,"toString",function(){var e=Wo.call(this);return e==e?Ko.call(this):"Invalid Date"});var Yo=RegExp.prototype,Jo=Yo.toString,Xo=b(function(){return"/a/b"!=Jo.call({source:"a",flags:"b"})}),Qo="toString"!=Jo.name;(Xo||Qo)&&me(RegExp.prototype,"toString",function(){var e=V(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in Yo)?Xr.call(e):n)},{unsafe:!0});var Zo,$o,ea=void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};Zo="undefined"!=typeof console?console:void 0!==ea&&ea.console?ea.console:"undefined"!=typeof window&&window.console?window.console:{};for(var ta=function(){},na=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],ra=na.length;ra--;)$o=na[ra],console[$o]||(Zo[$o]=ta);Zo.methods=na;var ia=Zo,oa=bt.find,aa=!0,sa=Tt("find");"find"in[]&&Array(1).find(function(){aa=!1}),We({target:"Array",proto:!0,forced:aa||!sa},{find:function(e){return oa(this,e,arguments.length>1?arguments[1]:void 0)}}),Bt("find"),We({target:"Array",stat:!0},{isArray:Ye});var ua=dt("slice"),la=Tt("slice",{ACCESSORS:!0,0:0,1:2}),ca=nt("species"),da=[].slice,fa=Math.max;We({target:"Array",proto:!0,forced:!ua||!la},{slice:function(e,t){var n,r,i,o=O(this),a=Te(o.length),s=Ie(e,a),u=Ie(void 0===t?a:t,a);if(Ye(o)&&("function"!=typeof(n=o.constructor)||n!==Array&&!Ye(n.prototype)?M(n)&&null===(n=n[ca])&&(n=void 0):n=void 0,n===Array||void 0===n))return da.call(o,s,u);for(r=new(void 0===n?Array:n)(fa(u-s,0)),i=0;s<u;s++,i++)s in o&&Xe(r,i,o[s]);return r.length=i,r}}),We({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}});var pa="".repeat||function(e){var t=String(A(this)),n="",r=we(e);if(r<0||1/0==r)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n},ha=Math.ceil,ga=function(e){return function(t,n,r){var i,o,a=String(A(t)),s=a.length,u=void 0===r?" ":String(r),l=Te(n);return l<=s||""==u?a:(i=l-s,(o=pa.call(u,ha(i/u.length))).length>i&&(o=o.slice(0,i)),e?a+o:o+a)}},va=[ga(!1),ga(!0)][0],ma=Math.abs,ya=Date.prototype,_a=ya.getTime,ba=ya.toISOString,Sa=b(function(){return"0385-07-25T07:06:39.999Z"!=ba.call(new Date(-50000000000001))})||!b(function(){ba.call(new Date(NaN))})?function(){if(!isFinite(_a.call(this)))throw RangeError("Invalid time value");var e=this.getUTCFullYear(),t=this.getUTCMilliseconds(),n=e<0?"-":e>9999?"+":"";return n+va(ma(e),n?6:4,0)+"-"+va(this.getUTCMonth()+1,2,0)+"-"+va(this.getUTCDate(),2,0)+"T"+va(this.getUTCHours(),2,0)+":"+va(this.getUTCMinutes(),2,0)+":"+va(this.getUTCSeconds(),2,0)+"."+va(t,3,0)+"Z"}:ba;We({target:"Date",proto:!0,forced:Date.prototype.toISOString!==Sa},{toISOString:Sa});var ka=Pe.f,wa=B.f,Ea=H.f,Ta=un.trim,xa=_.Number,Ca=xa.prototype,Ia="Number"==C(Ft(Ca)),Ra=function(e){var t,n,r,i,o,a,s,u,l=D(e,!1);if("string"==typeof l&&l.length>2)if(43===(t=(l=Ta(l)).charCodeAt(0))||45===t){if(88===(n=l.charCodeAt(2))||120===n)return NaN}else if(48===t){switch(l.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+l}for(a=(o=l.slice(2)).length,s=0;s<a;s++)if((u=o.charCodeAt(s))<48||u>i)return NaN;return parseInt(o,r)}return+l};if(ze("Number",!xa(" 0o1")||!xa("0b1")||xa("+0x1"))){for(var Aa,Oa=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof Oa&&(Ia?b(function(){Ca.valueOf.call(n)}):"Number"!=C(n))?ko(new xa(Ra(t)),n,Oa):Ra(t)},Ma=S?ka(xa):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Da=0;Ma.length>Da;Da++)P(xa,Aa=Ma[Da])&&!P(Oa,Aa)&&Ea(Oa,Aa,wa(xa,Aa));Oa.prototype=Ca,Ca.constructor=Oa,me(_,"Number",Oa)}We({target:"Object",stat:!0,sham:!S},{create:Ft});var La=Pe.f,Pa={}.toString,Na="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Ua={f:function(e){return Na&&"[object Window]"==Pa.call(e)?function(e){try{return La(e)}catch(e){return Na.slice()}}(e):La(O(e))}},Fa=Ua.f,ja=b(function(){return!Object.getOwnPropertyNames(1)});We({target:"Object",stat:!0,forced:ja},{getOwnPropertyNames:Fa});var Ga=b(function(){$i(1)});We({target:"Object",stat:!0,forced:Ga,sham:!Xi},{getPrototypeOf:function(e){return $i(Je(e))}}),We({target:"String",proto:!0,forced:!xi("includes")},{includes:function(e){return!!~String(A(this)).indexOf(Ei(e),arguments.length>1?arguments[1]:void 0)}}),fi("match",1,function(e,t,n){return[function(t){var n=A(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;var i=V(e),o=String(this);if(!i.global)return _i(i,o);var a=i.unicode;i.lastIndex=0;for(var s,u=[],l=0;null!==(s=_i(i,o));){var c=String(s[0]);u[l]=c,""===c&&(i.lastIndex=yi(o,Te(i.lastIndex),a)),l++}return 0===l?null:u}]});var Ba=Math.max,Va=Math.min,qa=Math.floor,Ha=/\$([$&'`]|\d\d?|<[^>]*>)/g,za=/\$([$&'`]|\d\d?)/g;fi("replace",2,function(e,t,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o=r.REPLACE_KEEPS_$0,a=i?"$":"$0";return[function(n,r){var i=A(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!i&&o||"string"==typeof r&&-1===r.indexOf(a)){var u=n(t,e,this,r);if(u.done)return u.value}var l=V(e),c=String(this),d="function"==typeof r;d||(r=String(r));var f=l.global;if(f){var p=l.unicode;l.lastIndex=0}for(var h=[];;){var g=_i(l,c);if(null===g)break;if(h.push(g),!f)break;""===String(g[0])&&(l.lastIndex=yi(c,Te(l.lastIndex),p))}for(var v,m="",y=0,_=0;_<h.length;_++){g=h[_];for(var b=String(g[0]),S=Ba(Va(we(g.index),c.length),0),k=[],w=1;w<g.length;w++)k.push(void 0===(v=g[w])?v:String(v));var E=g.groups;if(d){var T=[b].concat(k,S,c);void 0!==E&&T.push(E);var x=String(r.apply(void 0,T))}else x=s(b,c,S,k,E,r);S>=y&&(m+=c.slice(y,S)+x,y=S+b.length)}return m+c.slice(y)}];function s(e,n,r,i,o,a){var s=r+e.length,u=i.length,l=za;return void 0!==o&&(o=Je(o),l=Ha),t.call(a,l,function(t,a){var l;switch(a.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,r);case"'":return n.slice(s);case"<":l=o[a.slice(1,-1)];break;default:var c=+a;if(0===c)return t;if(c>u){var d=qa(c/10);return 0===d?t:d<=u?void 0===i[d-1]?a.charAt(1):i[d-1]+a.charAt(1):t}l=i[c-1]}return void 0===l?"":l})}});var Ka=un.trim,Wa=_.parseFloat,Ya=1/Wa(nn+"-0")!=-1/0?function(e){var t=Ka(String(e)),n=Wa(t);return 0===n&&"-"==t.charAt(0)?-0:n}:Wa;We({global:!0,forced:parseFloat!=Ya},{parseFloat:Ya});var Ja="undefined"!=typeof window,Xa=("undefined"!=typeof wx&&wx.getSystemInfoSync,Ja&&window.navigator&&window.navigator.userAgent||""),Qa=/AppleWebKit\/([\d.]+)/i.exec(Xa),Za=(Qa&&parseFloat(Qa.pop()),/iPad/i.test(Xa),/iPhone/i.test(Xa),/iPod/i.test(Xa),function(){var e=Xa.match(/OS (\d+)_/i);e&&e[1]&&e[1]}(),/Android/i.test(Xa)),$a=(function(){var e=Xa.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);t&&n&&parseFloat(e[1]+"."+e[2])}(),Za&&/webkit/i.test(Xa),/Firefox/i.test(Xa),!/Edge/i.test(Xa)&&/Chrome/i.test(Xa),function(){var e=Xa.match(/Chrome\/(\d+)/);e&&e[1]&&parseFloat(e[1])}(),/MSIE/.test(Xa),/MSIE\s8\.0/.test(Xa),function(){var e=/MSIE\s(\d+)\.\d/.exec(Xa),t=e&&parseFloat(e[1]);!t&&/Trident\/7.0/i.test(Xa)&&/rv:11.0/.test(Xa)&&(t=11)}(),/Safari/i.test(Xa),/TBS\/\d+/i.test(Xa)),es=(function(){var e=Xa.match(/TBS\/(\d+)/i);e&&e[1]&&e[1]}(),!$a&&/MQQBrowser\/\d+/i.test(Xa),!$a&&/ QQBrowser\/\d+/i.test(Xa),/(micromessenger|webbrowser)/i.test(Xa),/Windows/i.test(Xa),/MAC OS X/i.test(Xa),/MicroMessenger/i.test(Xa),function(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"===a(e)&&e.constructor===Number)}),ts=function(e){return"string"==typeof e},ns=function(e){if("object"!==a(e)||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var n=t;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n},rs=function(e){return function(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===os(e)}(e)||function(e){return null!==e&&"object"===a(e)}(e)},is=function(e){return"boolean"==typeof e},os=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},as=0;Date.now||(Date.now=function(){return(new Date).getTime()});var ss=function(){0===as&&(as=Date.now()-1);var e=Date.now()-as;return e>4294967295?(as+=4294967295,Date.now()-as):e},us=0,ls=new Map;function cs(){var e=new Date;return"TWebLive ".concat(e.toLocaleTimeString("en-US",{hour12:!1}),".").concat(function(e){var t;switch(e.toString().length){case 1:t="00".concat(e);break;case 2:t="0".concat(e);break;default:t=e}return t}(e.getMilliseconds()),":")}var ds={_data:[],_length:0,_visible:!1,arguments2String:function(e){var t,n;if(1===e.length)t=cs()+e[0];else{t=cs();for(var r=0,i=e.length;r<i;r++)rs(e[r])?e[r]instanceof Error?t+=(n=e[r],JSON.stringify(n,["message","code"])):t+=JSON.stringify(e[r]):t+=e[r],t+=" "}return t},debug:function(){if(us<=-1){var e=this.arguments2String(arguments);ds.record(e,"debug"),ia.debug(e)}},log:function(){if(us<=0){var e=this.arguments2String(arguments);ds.record(e,"log"),ia.log(e)}},info:function(){if(us<=1){var e=this.arguments2String(arguments);ds.record(e,"info"),ia.info(e)}},warn:function(){if(us<=2){var e=this.arguments2String(arguments);ds.record(e,"warn"),ia.warn(e)}},error:function(){if(us<=3){var e=this.arguments2String(arguments);ds.record(e,"error"),ia.error(e)}},time:function(e){ls.set(e,ss())},timeEnd:function(e){if(ls.has(e)){var t=ss()-ls.get(e);return ls.delete(e),t}return ia.warn("未找到对应label: ".concat(e,", 请在调用 logger.timeEnd 前，调用 logger.time")),0},setLevel:function(e){e<4&&ia.log("".concat(cs()," set level from ").concat(us," to ").concat(e)),us=e},record:function(e,t){1100===ds._length&&(ds._data.splice(0,100),ds._length=1e3),ds._length++,ds._data.push("".concat(e," [").concat(t,"] \n"))},getLog:function(){return ds._data}},fs={IM_READY:"t_im_ready",IM_NOT_READY:"t_im_not_ready",IM_TEXT_MESSAGE_RECEIVED:"t_text_message_received",IM_CUSTOM_MESSAGE_RECEIVED:"t_custom_message_received",IM_IMAGE_MESSAGE_RECEIVED:"t_image_message_received",IM_REMOTE_USER_JOIN:"t_remote_user_join",IM_REMOTE_USER_LEAVE:"t_remote_user_leave",IM_KICKED_OUT:"t_kicked_out",IM_NET_STATE_CHANGED:"t_net_state_change",IM_PUSH_STOPPED:"t_push_stopped",PLAYER_PLAYING:"t_playing",PLAYER_PAUSE:"t_pause",PLAYER_WAITING:"t_waiting",PLAYER_TIMEUPDATE:"t_timeupdate",PLAYER_ERROR:"t_error",PLAYER_AUTOPLAY_NOT_ALLOWED:"t_autoplay_not_allowed",RTC_CONNECTION_STATE_CHANGED:"t_connection_state_changed",RTC_CLIENT_BANNED:"t_client_banned",RTC_SCREEN_CAPTURE_STOPPED:"t_screen_capture_stopped",RTC_NETWORK_QUALITY:"t_network-quality",RTC_CLIENT_ERROR:"t_rtc_client_error"},ps=function(){function e(){l(this,e),this._funcMap=new Map}return d(e,[{key:"defense",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if("string"!=typeof e)return null;if(0===e.length)return null;if("function"!=typeof t)return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);var r=null;return this._funcMap.get(e).has(t)?r=this._funcMap.get(e).get(t):(r=this._pack(e,t,n),this._funcMap.get(e).set(t,r)),r}},{key:"defenseOnce",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return"function"!=typeof t?null:this._pack(e,t,n)}},{key:"find",value:function(e,t){return"string"!=typeof e||0===e.length||"function"!=typeof t?null:this._funcMap.has(e)?this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(ds.log("SafetyCallback.find: 找不到 func —— ".concat(e,"/").concat(""!==t.name?t.name:"[anonymous]")),null):(ds.log("SafetyCallback.find: 找不到 eventName-".concat(e," 对应的 func")),null)}},{key:"delete",value:function(e,t){return"function"==typeof t&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),0===this._funcMap.get(e).size&&this._funcMap.delete(e),!0)}},{key:"_pack",value:function(e,t,n){return function(){try{t.apply(n,Array.from(arguments))}catch(t){var r=Object.values(fs).indexOf(e),i=Object.keys(fs)[r];ds.error("接入侧事件 EVENT.".concat(i," 对应的回调函数逻辑存在问题，请检查！"),t)}}}}]),e}(),hs=Object.prototype.hasOwnProperty;function gs(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(ns(e)){for(var t in e)if(hs.call(e,t))return!1;return!0}return!("map"!==os(e)&&!function(e){return"set"===os(e)}(e)&&!function(e){return"file"===os(e)}(e))&&0===e.size}function vs(e){return e=window.localStorage?localStorage.getItem(e)||sessionStorage.getItem(e):(e=document.cookie.match(new RegExp("(?:^|;\\s)"+e+"=(.*?)(?:;\\s|$)")))?e[1]:""}function ms(e,t,n){if(window.localStorage)try{n?localStorage.setItem(e,t):sessionStorage.setItem(e,t)}catch(e){}else document.cookie=e+"="+t+";path=/;domain="+function(){var e=window.location.host,t=e.split(".");return 2<t.length&&(e=({"com.cn":1,"js.cn":1,"net.cn":1,"gov.cn":1,"com.hk":1,"co.nz":1}[t.slice(-2).join(".")]?t.slice(-3):t.slice(-2)).join(".")),e}()+(n?";expires="+n:"")}function ys(e,t){var n,r={};if(void 0===t)var i=window.location,o=i.host,a=i.pathname,s=i.search.substr(1),u=i.hash;else o=(i=t.match(/\w+:\/\/((?:[\w-]+\.)+\w+)(?::\d+)?(\/[^\?\\"'\|:<>]*)?(?:\?([^'"\\<>#]*))?(?:#(\w+))?/i)||[])[1],a=i[2],s=i[3],u=i[4];return void 0!==u&&(u=u.replace(/"|'|<|>/gi,"M")),s&&function(){for(var e=s.split("&"),t=0,n=e.length;t<n;t++)if(-1!=e[t].indexOf("=")){var i=e[t].indexOf("="),o=e[t].slice(0,i);i=e[t].slice(i+1),r[o]=i}}(),s=function(){if(void 0===s)return s;for(var t=s.split("&"),n=[],r=0,i=t.length;r<i;r++)if(-1!=t[r].indexOf("=")){var o=t[r].indexOf("="),a=t[r].slice(0,o);o=t[r].slice(o+1),e.ignoreParams&&-1!=e.ignoreParams.indexOf(a)||n.push(a+"="+o)}return n.join("&")}(),u&&function(){for(var e=0==u.indexOf("#")?u.substr(1).split("&"):u.split("&"),t=0,r=e.length;t<r;t++)if(-1!=e[t].indexOf("=")){var i=e[t].indexOf("="),o=e[t].slice(0,i);if(i=e[t].slice(i+1),"adtag"===o.toLowerCase()){n=i;break}}}(),{host:o,path:a,search:s,hash:u,param:r,adtag:n}}function _s(e){var t,n=ys(e),r={dm:n.host,pvi:"",si:"",url:n.path,arg:encodeURIComponent(n.search||"").substr(0,512),ty:0};return r.pvi=function(){var t=new Date((new Date).getTime()+63072e6).toGMTString();if(e.userReport){var n=vs("pgv_uid");n&&n==e.user.user_id||(r.ty=1,ms("pgv_uid",e.user.user_id,t)),n=e.user.user_id}else(n=vs("pgv_pvi"))||(r.ty=1,ms("pgv_pvi",n=bs(),t));return n}(),r.si=((t=vs("pgv_si"))||ms("pgv_si",t=bs("s")),t),r.url=function(){var t=n.path;return e.senseQuery&&(t+=n.search?"?"+encodeURIComponent(n.search||"").substr(0,512):""),e.senseHash&&(t+=n.hash?encodeURIComponent(n.hash):""),t}(),r}function bs(e){for(var t=[0,1,2,3,4,5,6,7,8,9],n=10;1<n;n--){var r=Math.floor(10*Math.random()),i=t[r];t[r]=t[n-1],t[n-1]=i}for(n=r=0;5>n;n++)r=10*r+t[n];return(e||"")+(r+"")+ +new Date}function Ss(e){return{r2:e.sid}}function ks(e){var t={};if(e){var n,r=[];for(n in e)e.hasOwnProperty(n)&&r.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));e=r.join(";"),t.ext=e}return t}function ws(e){var t=ys(e,document.referrer);return e=ys(e),{rdm:t.host,rurl:t.path,rarg:encodeURIComponent(t.search||"").substr(0,512),adt:e.param.ADTAG||e.param.adtag||e.param.CKTAG||e.param.cktag||e.param.PTAG||e.param.ptag||e.adtag}}function Es(){try{var e=navigator,t=screen||{width:"",height:"",colorDepth:""},n={scr:t.width+"x"+t.height,scl:t.colorDepth+"-bit",lg:(e.language||e.userLanguage).toLowerCase(),tz:(new Date).getTimezoneOffset()/60}}catch(e){return{}}return n}var Ts={conf:{},version:"2.0.19",init:function(e){var t={sid:0,cid:0,autoReport:0,senseHash:0,senseQuery:0,userReport:0,performanceMonitor:0,ignoreParams:[]};if(e)for(var n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)&&(t[n]=e[n]);this.conf=t,this.conf.autoReport&&this.pgv()},pgv:function(){var e=this.conf,t=[],n=this.version;if(e.sid)if(!e.userReport||e.user&&e.user.user_id&&!parseInt(e.user.user_id,10)!==conf.user.user_id){for(var r=0,i=[_s(e),ws(e),Ss(e),Es(),ks({version:n}),{random:+new Date}],o=i.length;r<o;r++)for(var a in i[r])i[r].hasOwnProperty(a)&&t.push(a+"="+(void 0===i[r][a]?"":i[r][a]));var s=function(e){e="https://pingtas.qq.com/webview/pingd?"+e.join("&").toLowerCase();var t=new Image;t.onload=t.onerror=t.onabort=function(){t=t.onload=t.onerror=t.onabort=null},t.src=e};s(t),e.performanceMonitor&&(t=function(){for(var t=function(){if(window.performance){var e=window.performance.timing,t={value:e.domainLookupEnd-e.domainLookupStart},n={value:e.connectEnd-e.connectStart},r={value:e.responseStart-(e.requestStart||e.responseStart+1)},i=e.responseEnd-e.responseStart;e.domContentLoadedEventStart?0>i&&(i=0):i=-1,e={domainLookupTime:t,connectTime:n,requestTime:r,resourcesLoadedTime:{value:i},domParsingTime:{value:e.domContentLoadedEventStart?e.domInteractive-e.domLoading:-1},domContentLoadedTime:{value:e.domContentLoadedEventStart?e.domContentLoadedEventStart-e.fetchStart:-1}}}else e="";return e}(),r=[],i=[],o=0,a=[_s(e),{r2:e.cid},Es(),{random:+new Date}],u=a.length;o<u;o++)for(var l in a[o])a[o].hasOwnProperty(l)&&i.push(l+"="+(void 0===a[o][l]?"":a[o][l]));for(l in t)t.hasOwnProperty(l)&&("domContentLoadedTime"==l?i.push("r3="+t[l].value):r.push(t[l].value));t=ks({pfm:r.join("_"),version:n}),i.push("ext="+t.ext),s(i)},void 0!==window.performance&&void 0!==window.performance.timing&&0!=window.performance.timing.loadEventEnd?t():window.attachEvent?window.attachEvent("onload",t):window.addEventListener&&window.addEventListener("load",t,!1))}else console.log("MTA H5分析错误提示：您选择了用户统计uv，请设置业务的user_id，需为int类型");else console.log("MTA H5分析错误提示：您没有设置sid")},clickStat:function(e,t){var n=this.conf,r=[],i=_s(n),o=Ss(n);if(n.cid){i.dm="taclick",i.url=e,o.r2=n.cid,o.r5=function(e){e=void 0===e?{}:e;var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t+"="+encodeURIComponent(e[t]));return n.join(";")}(t);var a=0;for(i=(n=[i,ws(n),o,Es(),ks({version:this.version}),{random:+new Date}]).length;a<i;a++)for(var s in n[a])n[a].hasOwnProperty(s)&&r.push(s+"="+(void 0===n[a][s]?"":n[a][s]));r="https://pingtas.qq.com/webview/pingd?"+r.join("&");var u=new Image;u.onload=u.onerror=u.onabort=function(){u=u.onload=u.onerror=u.onabort=null},u.src=r}else console.log("MTA H5分析错误提示：您没有设置cid,请到管理台开通自定义事件并更新统计代码")},clickShare:function(e){var t,n,r=this.conf,i=ys(r),o=void 0===(i=i.param.CKTAG||i.param.ckatg)?[]:i.split(".");if(r.cid){i=[];var a=_s(r),s=Ss(r);for(a.dm="taclick_share",a.url="mtah5-share-"+e,s.r2=r.cid,s.r5=(n=[],2===(t=o).length&&"mtah5_share"==t[0]&&n.push(t[0]+"="+t[1]),n.join(";")),e=0,a=(r=[a,ws(r),s,Es(),ks({version:this.version}),{random:+new Date}]).length;e<a;e++)for(var u in r[e])r[e].hasOwnProperty(u)&&i.push(u+"="+(void 0===r[e][u]?"":r[e][u]));u="https://pingtas.qq.com/webview/pingd?"+i.join("&");var l=new Image;l.onload=l.onerror=l.onabort=function(){l=l.onload=l.onerror=l.onabort=null},l.src=u}else console.log("MTA H5分析错误提示：您没有设置cid,请到管理台开通自定义事件并更新统计代码")}};Ts.init({sid:"500720070",cid:"500720078",autoReport:0,senseHash:0,senseQuery:0,performanceMonitor:0,ignoreParams:[]});var xs=["480p","480p_2","720p","720p_2","1080p","1080p_2"],Cs=function(){function e(t){if(l(this,e),gs(t))throw new Error("请填入 pusher 配置！");var n=t.userID,r=t.screenCapture;if(this._screenCapture=!1,!0===r){if(!i.default.isScreenShareSupported())throw new Error("当前浏览器不支持屏幕分享！");this._screenCapture=!0}this._client=null,this._liveDomainName="",this._streamID="",this._stream=null,this._userID=n,this._roomID=null,this._isJoined=!1,this._isPushing=!1,this._videoProfile="",this._safetyCallbackFactory=new ps,this._outerEmitter=new ji,this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(e,t){var n=arguments[0],r=[n,{name:arguments[0],data:arguments[1]}];this._outerEmitter._emit.apply(this._outerEmitter,r)}.bind(this),this.setLogLevel(1)}var t,n,r,o,a,s,c,f,p,h,g,v,m,y,_,b;return d(e,[{key:"_initListeners",value:function(){var e=this;this._client.on("connection-state-changed",function(t){e._outerEmitter.emit(fs.RTC_CONNECTION_STATE_CHANGED,t)}),this._client.on("client-banned",function(t){e._outerEmitter.emit(fs.RTC_CLIENT_BANNED,t)}),this._client.on("error",function(t){e._outerEmitter.emit(fs.RTC_ERROR,t)}),this._client.on("network-quality",function(t){e._outerEmitter.emit(fs.RTC_NETWORK_QUALITY,t)}),this._client.on("stream-added",function(t){var n=t.stream;n.getUserId()==="screen-".concat(e._userID)?e._client.unsubscribe(n):e._client.subscribe(n)})}},{key:"on",value:function(e,t,n){this._outerEmitter.on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"off",value:function(e,t,n){this._outerEmitter.off(e,t,n)}},{key:"setLogLevel",value:function(e){-1===e?i.default.Logger.setLogLevel(i.default.Logger.LogLevel.TRACE):0===e?i.default.Logger.setLogLevel(i.default.Logger.LogLevel.DEBUG):1===e?i.default.Logger.setLogLevel(i.default.Logger.LogLevel.INFO):2===e?i.default.Logger.setLogLevel(i.default.Logger.LogLevel.WARN):3===e?i.default.Logger.setLogLevel(i.default.Logger.LogLevel.ERROR):4===e&&i.default.Logger.setLogLevel(i.default.Logger.LogLevel.NONE)}},{key:"checkSystemRequirements",value:(b=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.default.checkSystemRequirements();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(){return b.apply(this,arguments)})},{key:"getCameraList",value:(_=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.default.getCameras();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(){return _.apply(this,arguments)})},{key:"getCurrentCamera",value:function(){if(this._stream)return this._stream.getCameraId()}},{key:"setCurrentCamera",value:(y=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._stream){e.next=4;break}return e.next=3,this._stream.switchDevice("video",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"getMicrophoneList",value:(m=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.default.getMicrophones();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(){return m.apply(this,arguments)})},{key:"getCurrentMicrophone",value:function(){if(this._stream)return this._stream.getMicrophoneId()}},{key:"setCurrentMicrophone",value:(v=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._stream){e.next=4;break}return e.next=3,this._stream.switchDevice("audio",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"setRenderView",value:(g=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!gs(t)){e.next=2;break}throw new Error("请传入配置");case 2:if(this._stream&&(this._stream.stop(),this._stream.close(),this._stream=null),!this._screenCapture){e.next=8;break}return e.next=6,this._createScreenStream(t);case 6:e.next=10;break;case 8:return e.next=10,this._createCameraStream(t);case 10:return e.next=12,this._stream.initialize();case 12:return this._screenCapture&&this._stream.setVideoContentHint("detail"),e.next=15,this._stream.play(t.elementID,{objectFit:t.objectFit||"cover",muted:!0});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"_createScreenStream",value:(h=u(regeneratorRuntime.mark(function e(t){var n,r,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="1080p",r=!1,!0===t.systemAudio&&(r=!0),ts(t.screenProfile)&&xs.includes(t.screenProfile)&&(n=t.screenProfile),e.next=6,i.default.createStream({audio:!r,screenAudio:r,screen:!0});case 6:this._stream=e.sent,this._stream.setScreenProfile(n),ds.info("Pusher._createScreenStream screenProfile:",n),this._stream.on("screen-sharing-stopped",function(e){o.stopPush(),o._outerEmitter.emit(fs.RTC_SCREEN_CAPTURE_STOPPED,e)});case 10:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"_createCameraStream",value:(p=u(regeneratorRuntime.mark(function e(t){var n,r,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!0,r=!0,ts(t.audio)?"high"===t.audio&&(o="high"):is(t.audio)&&(n=t.audio)&&(o="standard"),ts(t.video)?xs.includes(t.video)&&(a=t.video):ns(t.video)?a=t.video:is(t.video)&&(r=t.video)&&(a="720p"),e.next=6,i.default.createStream({userId:this._userID,audio:n,video:r,microphoneId:t.microphoneID||void 0,cameraId:t.cameraID||void 0});case 6:this._stream=e.sent,o&&this._stream.setAudioProfile(o),a&&(this._videoProfile=a,this._stream.setVideoProfile(a)),ds.info("Pusher._createCameraStream audioProfile:",o,"videoProfile:",this._videoProfile);case 10:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"startPush",value:(f=u(regeneratorRuntime.mark(function e(t){var n,r,o,a,s,u,l,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n="room://",t.startsWith(n)){e.next=3;break}throw new Error("Unsupported protocol!");case 3:if(t.substring(n.length).split("&").forEach(function(e){e.startsWith("roomid=")?r=parseInt(e.substring("roomid=".length)):e.startsWith("sdkappid=")?o=parseInt(e.substring("sdkappid=".length)):e.startsWith("userid=")?a=e.substring("userid=".length):e.startsWith("usersig=")?s=e.substring("usersig=".length):e.startsWith("streamid=")?u=e.substring("streamid=".length):e.startsWith("livedomainname=")&&(l=e.substring("livedomainname=".length))}),this._liveDomainName=l,this._streamID=u,this._roomID=r,this._userID===a){e.next=10;break}throw new Error("userID 与 createPusher() 时传入的 userID 不匹配！");case 10:if(ds.log("Pusher.startPush roomID:".concat(r," SDKAppID:").concat(o," userID:").concat(a," streamID:").concat(u," liveDomainName:").concat(l)),Ts.clickStat("start_push",{value:o}),null===this._client&&(this._client=i.default.createClient({sdkAppId:o,userId:a,userSig:s,mode:"live",streamId:u}),this._screenCapture&&this._client.setDefaultMuteRemoteStreams(!0),this._initListeners()),this._isJoined){e.next=17;break}return e.next=16,this._client.join({roomId:this._roomID,role:"anchor"});case 16:this._isJoined=!0;case 17:return e.next=19,this._client.publish(this._stream);case 19:return c=e.sent,this._isPushing=!0,e.abrupt("return",c);case 22:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"isPushing",value:function(){return this._isPushing}},{key:"startCamera",value:(c=u(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._screenCapture){e.next=2;break}return e.abrupt("return");case 2:if(!this._stream||this._stream.hasVideo()){e.next=11;break}return(t=i.default.createStream({userId:this._userID,audio:!1,video:!0})).setVideoProfile(this._videoProfile),e.next=7,t.initialize();case 7:return n=t.getVideoTrack(),e.next=10,this._stream.addTrack(n);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"stopCamera",value:(s=u(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._screenCapture){e.next=2;break}return e.abrupt("return");case 2:if(!this._stream||!this._stream.hasVideo()){e.next=10;break}if(!(t=this._stream.getVideoTrack())){e.next=10;break}return e.next=7,this._stream.removeTrack(t);case 7:return n=e.sent,t.stop(),e.abrupt("return",n);case 10:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"startMicrophone",value:(a=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._screenCapture){e.next=2;break}return e.abrupt("return");case 2:if(!this._stream){e.next=7;break}if(!0!==this._stream.unmuteAudio()){e.next=6;break}return e.abrupt("return",Promise.resolve());case 6:return e.abrupt("return",Promise.reject(new Error("No Audio Track!")));case 7:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"stopMicrophone",value:(o=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._screenCapture){e.next=2;break}return e.abrupt("return");case 2:if(!this._stream){e.next=7;break}if(!0!==this._stream.muteAudio()){e.next=6;break}return e.abrupt("return",Promise.resolve());case 6:return e.abrupt("return",Promise.reject(new Error("No Audio Track!")));case 7:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"startScreenCapture",value:(r=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"stopScreenCapture",value:(n=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})},{key:"stopPush",value:(t=u(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._client&&this._isPushing){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._client.unpublish(this._stream);case 4:return t=e.sent,e.next=7,this._client.leave({roomId:this._roomID,role:"anchor"});case 7:return this._isPushing=!1,this._isJoined=!1,e.abrupt("return",t);case 10:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"getLiveStreamURL",value:function(){return"https://".concat(this._liveDomainName,"/live/").concat(this._streamID,".flv")}}]),e}(),Is={f:nt},Rs=H.f,As=function(e){var t=ye.Symbol||(ye.Symbol={});P(t,e)||Rs(t,e,{value:Is.f(e)})},Os=bt.forEach,Ms=ae("hidden"),Ds=nt("toPrimitive"),Ls=ve.set,Ps=ve.getterFor("Symbol"),Ns=Object.prototype,Us=_.Symbol,Fs=be("JSON","stringify"),js=B.f,Gs=H.f,Bs=Ua.f,Vs=E.f,qs=te("symbols"),Hs=te("op-symbols"),zs=te("string-to-symbol-registry"),Ks=te("symbol-to-string-registry"),Ws=te("wks"),Ys=_.QObject,Js=!Ys||!Ys.prototype||!Ys.prototype.findChild,Xs=S&&b(function(){return 7!=Ft(Gs({},"a",{get:function(){return Gs(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=js(Ns,t);r&&delete Ns[t],Gs(e,t,n),r&&e!==Ns&&Gs(Ns,t,r)}:Gs,Qs=function(e,t){var n=qs[e]=Ft(Us.prototype);return Ls(n,{type:"Symbol",tag:e,description:t}),S||(n.description=t),n},Zs=Ze?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof Us},$s=function(e,t,n){e===Ns&&$s(Hs,t,n),V(e);var r=D(t,!0);return V(n),P(qs,r)?(n.enumerable?(P(e,Ms)&&e[Ms][r]&&(e[Ms][r]=!1),n=Ft(n,{enumerable:T(0,!1)})):(P(e,Ms)||Gs(e,Ms,T(1,{})),e[Ms][r]=!0),Xs(e,r,n)):Gs(e,r,n)},eu=function(e,t){V(e);var n=O(t),r=Ot(n).concat(iu(n));return Os(r,function(t){S&&!tu.call(n,t)||$s(e,t,n[t])}),e},tu=function(e){var t=D(e,!0),n=Vs.call(this,t);return!(this===Ns&&P(qs,t)&&!P(Hs,t))&&(!(n||!P(this,t)||!P(qs,t)||P(this,Ms)&&this[Ms][t])||n)},nu=function(e,t){var n=O(e),r=D(t,!0);if(n!==Ns||!P(qs,r)||P(Hs,r)){var i=js(n,r);return!i||!P(qs,r)||P(n,Ms)&&n[Ms][r]||(i.enumerable=!0),i}},ru=function(e){var t=Bs(O(e)),n=[];return Os(t,function(e){P(qs,e)||P(se,e)||n.push(e)}),n},iu=function(e){var t=e===Ns,n=Bs(t?Hs:O(e)),r=[];return Os(n,function(e){!P(qs,e)||t&&!P(Ns,e)||r.push(qs[e])}),r};if(Qe||(me((Us=function(){if(this instanceof Us)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=ie(e),n=function(e){this===Ns&&n.call(Hs,e),P(this,Ms)&&P(this[Ms],t)&&(this[Ms][t]=!1),Xs(this,t,T(1,e))};return S&&Js&&Xs(Ns,t,{configurable:!0,set:n}),Qs(t,e)}).prototype,"toString",function(){return Ps(this).tag}),me(Us,"withoutSetter",function(e){return Qs(ie(e),e)}),E.f=tu,H.f=$s,B.f=nu,Pe.f=Ua.f=ru,Ne.f=iu,Is.f=function(e){return Qs(nt(e),e)},S&&(Gs(Us.prototype,"description",{configurable:!0,get:function(){return Ps(this).description}}),me(Ns,"propertyIsEnumerable",tu,{unsafe:!0}))),We({global:!0,wrap:!0,forced:!Qe,sham:!Qe},{Symbol:Us}),Os(Ot(Ws),function(e){As(e)}),We({target:"Symbol",stat:!0,forced:!Qe},{for:function(e){var t=String(e);if(P(zs,t))return zs[t];var n=Us(t);return zs[t]=n,Ks[n]=t,n},keyFor:function(e){if(!Zs(e))throw TypeError(e+" is not a symbol");if(P(Ks,e))return Ks[e]},useSetter:function(){Js=!0},useSimple:function(){Js=!1}}),We({target:"Object",stat:!0,forced:!Qe,sham:!S},{create:function(e,t){return void 0===t?Ft(e):eu(Ft(e),t)},defineProperty:$s,defineProperties:eu,getOwnPropertyDescriptor:nu}),We({target:"Object",stat:!0,forced:!Qe},{getOwnPropertyNames:ru,getOwnPropertySymbols:iu}),We({target:"Object",stat:!0,forced:b(function(){Ne.f(1)})},{getOwnPropertySymbols:function(e){return Ne.f(Je(e))}}),Fs){var ou=!Qe||b(function(){var e=Us();return"[null]"!=Fs([e])||"{}"!=Fs({a:e})||"{}"!=Fs(Object(e))});We({target:"JSON",stat:!0,forced:ou},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(M(t)||void 0!==e)&&!Zs(e))return Ye(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Zs(t))return t}),i[1]=t,Fs.apply(null,i)}})}Us.prototype[Ds]||z(Us.prototype,Ds,Us.prototype.valueOf),mn(Us,"Symbol"),se[Ms]=!0;var au=H.f,su=_.Symbol;if(S&&"function"==typeof su&&(!("description"in su.prototype)||void 0!==su().description)){var uu={},lu=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof lu?new su(e):void 0===e?su():su(e);return""===e&&(uu[t]=!0),t};Fe(lu,su);var cu=lu.prototype=su.prototype;cu.constructor=lu;var du=cu.toString,fu="Symbol(test)"==String(su("test")),pu=/^Symbol\((.*)\)[^)]+$/;au(cu,"description",{configurable:!0,get:function(){var e=M(this)?this.valueOf():this,t=du.call(e);if(P(uu,e))return"";var n=fu?t.slice(7,-1):t.replace(pu,"$1");return""===n?void 0:n}}),We({global:!0,forced:!0},{Symbol:lu})}var hu=bt.filter,gu=dt("filter"),vu=Tt("filter");We({target:"Array",proto:!0,forced:!gu||!vu},{filter:function(e){return hu(this,e,arguments.length>1?arguments[1]:void 0)}});var mu=function(){function e(t){if(l(this,e),gs(t)||gs(t.SDKAppID))throw new Error("请传入 IM 配置！");this._imSDKAppID=t.SDKAppID,this._isAnonymousUser=!0,this._tim=o.default.create({SDKAppID:t.SDKAppID,scene:"tweblive"}),this._initListeners(),this._safetyCallbackFactory=new ps,this._outerEmitter=new ji,this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(e,t){var n=arguments[0],r=[n,{name:arguments[0],data:arguments[1]}];this._outerEmitter._emit.apply(this._outerEmitter,r)}.bind(this)}var t,n,r,i,a,s,c;return d(e,[{key:"_initListeners",value:function(){this._tim.on(o.default.EVENT.SDK_READY,this._onIMReady,this),this._tim.on(o.default.EVENT.SDK_NOT_READY,this._onIMNotReady,this),this._tim.on(o.default.EVENT.MESSAGE_RECEIVED,this._onMessageReceived,this),this._tim.on(o.default.EVENT.KICKED_OUT,this._onKickedOut,this),this._tim.on(o.default.EVENT.NET_STATE_CHANGE,this._onNetStateChange,this)}},{key:"_stat",value:function(){Ts.clickStat("sdkappid",{value:this._imSDKAppID}),Ts.clickStat("tweblive_version",{value:"1.1.0"}),Ts.clickStat("is_anonymous_user",{value:this._isAnonymousUser?1:0}),Ts.pgv()}},{key:"_onIMReady",value:function(e){this._stat(),this._outerEmitter.emit(fs.IM_READY)}},{key:"_onIMNotReady",value:function(e){this._outerEmitter.emit(fs.IM_NOT_READY)}},{key:"_onMessageReceived",value:function(e){var t=this,n=e.data,r=n.filter(function(e){return e.type===o.default.TYPES.MSG_TEXT&&e.to===t._roomID});gs(r)||this._outerEmitter.emit(fs.IM_TEXT_MESSAGE_RECEIVED,r);var i=n.filter(function(e){return e.type===o.default.TYPES.MSG_CUSTOM&&e.to===t._roomID&&("push_stopped"!==e.payload.data||(t._outerEmitter.emit(fs.IM_PUSH_STOPPED,e.payload.description),!1))});gs(i)||this._outerEmitter.emit(fs.IM_CUSTOM_MESSAGE_RECEIVED,i);var a=n.filter(function(e){return e.type===o.default.TYPES.MSG_IMAGE&&e.to===t._roomID});gs(a)||this._outerEmitter.emit(fs.IM_IMAGE_MESSAGE_RECEIVED,a);var s=n.filter(function(e){return e.type===o.default.TYPES.MSG_GRP_TIP&&e.payload.operationType===o.default.TYPES.GRP_TIP_MBR_JOIN&&e.to===t._roomID});gs(s)||this._outerEmitter.emit(fs.IM_REMOTE_USER_JOIN,s);var u=n.filter(function(e){return e.type===o.default.TYPES.MSG_GRP_TIP&&e.payload.operationType===o.default.TYPES.GRP_TIP_MBR_QUIT&&e.to===t._roomID});gs(u)||this._outerEmitter.emit(fs.IM_REMOTE_USER_LEAVE,u)}},{key:"_onKickedOut",value:function(e){this._outerEmitter.emit(fs.IM_KICKED_OUT,e.data.type)}},{key:"_onNetStateChange",value:function(e){this._outerEmitter.emit(fs.IM_NET_STATE_CHANGED,e.data.state)}},{key:"on",value:function(e,t,n){this._outerEmitter.on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"off",value:function(e,t,n){this._outerEmitter.off(e,t,n)}},{key:"setLogLevel",value:function(e){this._tim.setLogLevel(e)}},{key:"createRoom",value:(c=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._tim.createGroup({groupID:t.roomID+"",name:t.name,notification:t.notification||"",introduction:t.introduction||"",avatar:t.avatar||"",type:o.default.TYPES.GRP_AVCHATROOM});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"enterRoom",value:function(e){var t=this;return this._roomID=e+"",this._tim.joinGroup({groupID:this._roomID}).then(function(n){if(n.data.status===g.ENTER_ROOM_SUCCESS){var r=n.data.group?n.data.group.type:o.default.TYPES.GRP_AVCHATROOM;ds.log("IM.enterRoom ok. roomID:".concat(e," type:").concat(r))}else ds.log("IM.enterRoom already in room. roomID:".concat(e));return t._isAnonymousUser&&t._stat(),n})}},{key:"exitRoom",value:(s=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._roomID="",e.next=3,this._tim.quitGroup(t+"");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"login",value:function(e){var t=this;return this._tim.login(e).then(function(){t._isAnonymousUser=!1})}},{key:"logout",value:function(){var e=this;return this._tim.logout().then(function(){e._isAnonymousUser=!0})}},{key:"setMyProfile",value:(a=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._tim.updateMyProfile(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"getMyProfile",value:function(){return this._tim.getMyProfile().then(function(e){return{code:0,data:{nick:e.data.nick,avatar:e.data.avatar}}})}},{key:"sendTextMessage",value:(i=u(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._tim.createTextMessage({to:t.roomID+"",conversationType:o.default.TYPES.CONV_GROUP,priority:t.priority||o.default.TYPES.MSG_PRIORITY_NORMAL,payload:{text:t.text}}),e.next=3,this._tim.sendMessage(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"sendCustomMessage",value:(r=u(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._tim.createCustomMessage({to:t.roomID+"",conversationType:o.default.TYPES.CONV_GROUP,priority:t.priority||o.default.TYPES.MSG_PRIORITY_NORMAL,payload:{data:t.data||"",description:t.description||"",extension:t.extension||""}}),e.next=3,this._tim.sendMessage(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"sendImageMessage",value:(n=u(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._tim.createImageMessage({to:t.roomID+"",conversationType:o.default.TYPES.CONV_GROUP,priority:t.priority||o.default.TYPES.MSG_PRIORITY_NORMAL,payload:{file:t.file}}),e.next=3,this._tim.sendMessage(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"stopPush",value:(t=u(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._tim.createCustomMessage({to:t.roomID+"",conversationType:o.default.TYPES.CONV_GROUP,priority:o.default.TYPES.MSG_PRIORITY_HIGH,payload:{data:"push_stopped",description:t.postscript||"",extension:""}}),e.next=3,this._tim.sendMessage(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})}]),e}(),yu=Object.assign,_u=Object.defineProperty,bu=!yu||b(function(){if(S&&1!==yu({b:1},yu(_u({},"a",{enumerable:!0,get:function(){_u(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach(function(e){t[e]=e}),7!=yu({},e)[n]||"abcdefghijklmnopqrst"!=Ot(yu({},t)).join("")})?function(e,t){for(var n=Je(e),r=arguments.length,i=1,o=Ne.f,a=E.f;r>i;)for(var s,u=R(arguments[i++]),l=o?Ot(u).concat(o(u)):Ot(u),c=l.length,d=0;c>d;)s=l[d++],S&&!a.call(u,s)||(n[s]=u[s]);return n}:yu;We({target:"Object",stat:!0,forced:Object.assign!==bu},{assign:bu}),As("iterator");var Su=1..toFixed,ku=Math.floor,wu=function(e,t,n){return 0===t?n:t%2==1?wu(e,t-1,n*e):wu(e*e,t/2,n)},Eu=Su&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!b(function(){Su.call({})});We({target:"Number",proto:!0,forced:Eu},{toFixed:function(e){var t,n,r,i,o=function(e){if("number"!=typeof e&&"Number"!=C(e))throw TypeError("Incorrect invocation");return+e}(this),a=we(e),s=[0,0,0,0,0,0],u="",l="0",c=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*s[n],s[n]=r%1e7,r=ku(r/1e7)},d=function(e){for(var t=6,n=0;--t>=0;)n+=s[t],s[t]=ku(n/e),n=n%e*1e7},f=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==s[e]){var n=String(s[e]);t=""===t?n:t+pa.call("0",7-n.length)+n}return t};if(a<0||a>20)throw RangeError("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return String(o);if(o<0&&(u="-",o=-o),o>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(o*wu(2,69,1))-69)<0?o*wu(2,-t,1):o/wu(2,t,1),n*=4503599627370496,(t=52-t)>0){for(c(0,n),r=a;r>=7;)c(1e7,0),r-=7;for(c(wu(10,r,1),0),r=t-1;r>=23;)d(1<<23),r-=23;d(1<<r),c(1,1),d(2),l=f()}else c(0,n),c(1<<-t,0),l=f()+pa.call("0",a);return l=a>0?u+((i=l.length)<=a?"0."+pa.call("0",a-i)+l:l.slice(0,i-a)+"."+l.slice(i-a)):u+l}}),We({target:"Object",stat:!0},{setPrototypeOf:ao});var Tu=H.f,xu=Pe.f,Cu=ve.set,Iu=nt("match"),Ru=_.RegExp,Au=Ru.prototype,Ou=/a/g,Mu=/a/g,Du=new Ru(Ou)!==Ou,Lu=Zr.UNSUPPORTED_Y;if(S&&ze("RegExp",!Du||Lu||b(function(){return Mu[Iu]=!1,Ru(Ou)!=Ou||Ru(Mu)==Mu||"/a/i"!=Ru(Ou,"i")}))){for(var Pu=function(e,t){var n,r=this instanceof Pu,i=hi(e),o=void 0===t;if(!r&&i&&e.constructor===Pu&&o)return e;Du?i&&!o&&(e=e.source):e instanceof Pu&&(o&&(t=Xr.call(e)),e=e.source),Lu&&(n=!!t&&t.indexOf("y")>-1)&&(t=t.replace(/y/g,""));var a=ko(Du?new Ru(e,t):Ru(e,t),r?this:Au,Pu);return Lu&&n&&Cu(a,{sticky:n}),a},Nu=function(e){e in Pu||Tu(Pu,e,{configurable:!0,get:function(){return Ru[e]},set:function(t){Ru[e]=t}})},Uu=xu(Ru),Fu=0;Uu.length>Fu;)Nu(Uu[Fu++]);Au.constructor=Pu,Pu.prototype=Au,me(_,"RegExp",Pu)}_n("RegExp"),We({target:"String",proto:!0,forced:b(function(){var e="".sub('"');return e!==e.toLowerCase()||e.split('"').length>3})},{sub:function(){return"<sub>"+String(A(this))+"</sub>"}});var ju=[].slice,Gu=/MSIE .\./.test(ot),Bu=function(e){return function(t,n){var r=arguments.length>2,i=r?ju.call(arguments,2):void 0;return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};We({global:!0,bind:!0,forced:Gu},{setTimeout:Bu(_.setTimeout),setInterval:Bu(_.setInterval)});var Vu=nt("iterator"),qu=!b(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach(function(e,r){t.delete("b"),n+=r+e}),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[Vu]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host}),Hu=/[^\0-\u007E]/,zu=/[.\u3002\uFF0E\uFF61]/g,Ku="Overflow: input needs wider integers to process",Wu=Math.floor,Yu=String.fromCharCode,Ju=function(e){return e+22+75*(e<26)},Xu=function(e,t,n){var r=0;for(e=n?Wu(e/700):e>>1,e+=Wu(e/t);e>455;r+=36)e=Wu(e/35);return Wu(r+36*e/(e+38))},Qu=function(e){var t,n,r=[],i=(e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=e.charCodeAt(n++);56320==(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),n--)}else t.push(i)}return t}(e)).length,o=128,a=0,s=72;for(t=0;t<e.length;t++)(n=e[t])<128&&r.push(Yu(n));var u=r.length,l=u;for(u&&r.push("-");l<i;){var c=2147483647;for(t=0;t<e.length;t++)(n=e[t])>=o&&n<c&&(c=n);var d=l+1;if(c-o>Wu((2147483647-a)/d))throw RangeError(Ku);for(a+=(c-o)*d,o=c,t=0;t<e.length;t++){if((n=e[t])<o&&++a>2147483647)throw RangeError(Ku);if(n==o){for(var f=a,p=36;;p+=36){var h=p<=s?1:p>=s+26?26:p-s;if(f<h)break;var g=f-h,v=36-h;r.push(Yu(Ju(h+g%v))),f=Wu(g/v)}r.push(Yu(Ju(f))),s=Xu(a,d,l==u),a=0,++l}}++a,++o}return r.join("")},Zu=function(e){var t=xn(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return V(t.call(e))},$u=be("fetch"),el=be("Headers"),tl=nt("iterator"),nl=ve.set,rl=ve.getterFor("URLSearchParams"),il=ve.getterFor("URLSearchParamsIterator"),ol=/\+/g,al=Array(4),sl=function(e){return al[e-1]||(al[e-1]=RegExp("((?:%[\\da-f]{2}){"+e+"})","gi"))},ul=function(e){try{return decodeURIComponent(e)}catch(t){return e}},ll=function(e){var t=e.replace(ol," "),n=4;try{return decodeURIComponent(t)}catch(e){for(;n;)t=t.replace(sl(n--),ul);return t}},cl=/[!'()~]|%20/g,dl={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},fl=function(e){return dl[e]},pl=function(e){return encodeURIComponent(e).replace(cl,fl)},hl=function(e,t){if(t)for(var n,r,i=t.split("&"),o=0;o<i.length;)(n=i[o++]).length&&(r=n.split("="),e.push({key:ll(r.shift()),value:ll(r.join("="))}))},gl=function(e){this.entries.length=0,hl(this.entries,e)},vl=function(e,t){if(e<t)throw TypeError("Not enough arguments")},ml=oo(function(e,t){nl(this,{type:"URLSearchParamsIterator",iterator:Zu(rl(e).entries),kind:t})},"Iterator",function(){var e=il(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n}),yl=function(){bn(this,yl,"URLSearchParams");var e,t,n,r,i,o,a,s,u,l=arguments.length>0?arguments[0]:void 0,c=[];if(nl(this,{type:"URLSearchParams",entries:c,updateURL:function(){},updateSearchParams:gl}),void 0!==l)if(M(l))if("function"==typeof(e=xn(l)))for(n=(t=e.call(l)).next;!(r=n.call(t)).done;){if((a=(o=(i=Zu(V(r.value))).next).call(i)).done||(s=o.call(i)).done||!o.call(i).done)throw TypeError("Expected sequence with length 2");c.push({key:a.value+"",value:s.value+""})}else for(u in l)P(l,u)&&c.push({key:u,value:l[u]+""});else hl(c,"string"==typeof l?"?"===l.charAt(0)?l.slice(1):l:l+"")},_l=yl.prototype;hn(_l,{append:function(e,t){vl(arguments.length,2);var n=rl(this);n.entries.push({key:e+"",value:t+""}),n.updateURL()},delete:function(e){vl(arguments.length,1);for(var t=rl(this),n=t.entries,r=e+"",i=0;i<n.length;)n[i].key===r?n.splice(i,1):i++;t.updateURL()},get:function(e){vl(arguments.length,1);for(var t=rl(this).entries,n=e+"",r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){vl(arguments.length,1);for(var t=rl(this).entries,n=e+"",r=[],i=0;i<t.length;i++)t[i].key===n&&r.push(t[i].value);return r},has:function(e){vl(arguments.length,1);for(var t=rl(this).entries,n=e+"",r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){vl(arguments.length,1);for(var n,r=rl(this),i=r.entries,o=!1,a=e+"",s=t+"",u=0;u<i.length;u++)(n=i[u]).key===a&&(o?i.splice(u--,1):(o=!0,n.value=s));o||i.push({key:a,value:s}),r.updateURL()},sort:function(){var e,t,n,r=rl(this),i=r.entries,o=i.slice();for(i.length=0,n=0;n<o.length;n++){for(e=o[n],t=0;t<n;t++)if(i[t].key>e.key){i.splice(t,0,e);break}t===n&&i.push(e)}r.updateURL()},forEach:function(e){for(var t,n=rl(this).entries,r=mt(e,arguments.length>1?arguments[1]:void 0,3),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new ml(this,"keys")},values:function(){return new ml(this,"values")},entries:function(){return new ml(this,"entries")}},{enumerable:!0}),me(_l,tl,_l.entries),me(_l,"toString",function(){for(var e,t=rl(this).entries,n=[],r=0;r<t.length;)e=t[r++],n.push(pl(e.key)+"="+pl(e.value));return n.join("&")},{enumerable:!0}),mn(yl,"URLSearchParams"),We({global:!0,forced:!qu},{URLSearchParams:yl}),qu||"function"!=typeof $u||"function"!=typeof el||We({global:!0,enumerable:!0,forced:!0},{fetch:function(e){var t,n,r,i=[e];return arguments.length>1&&(M(t=arguments[1])&&(n=t.body,"URLSearchParams"===en(n)&&((r=t.headers?new el(t.headers):new el).has("content-type")||r.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),t=Ft(t,{body:T(0,String(n)),headers:T(0,r)}))),i.push(t)),$u.apply(this,i)}});var bl,Sl={URLSearchParams:yl,getState:rl},kl=vi.codeAt,wl=_.URL,El=Sl.URLSearchParams,Tl=Sl.getState,xl=ve.set,Cl=ve.getterFor("URL"),Il=Math.floor,Rl=Math.pow,Al=/[A-Za-z]/,Ol=/[\d+-.A-Za-z]/,Ml=/\d/,Dl=/^(0x|0X)/,Ll=/^[0-7]+$/,Pl=/^\d+$/,Nl=/^[\dA-Fa-f]+$/,Ul=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,Fl=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,jl=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,Gl=/[\u0009\u000A\u000D]/g,Bl=function(e,t){var n,r,i;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return"Invalid host";if(!(n=ql(t.slice(1,-1))))return"Invalid host";e.host=n}else if(Ql(e)){if(t=function(e){var t,n,r=[],i=e.toLowerCase().replace(zu,".").split(".");for(t=0;t<i.length;t++)n=i[t],r.push(Hu.test(n)?"xn--"+Qu(n):n);return r.join(".")}(t),Ul.test(t))return"Invalid host";if(null===(n=Vl(t)))return"Invalid host";e.host=n}else{if(Fl.test(t))return"Invalid host";for(n="",r=Gi(t),i=0;i<r.length;i++)n+=Jl(r[i],zl);e.host=n}},Vl=function(e){var t,n,r,i,o,a,s,u=e.split(".");if(u.length&&""==u[u.length-1]&&u.pop(),(t=u.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=u[r]))return e;if(o=10,i.length>1&&"0"==i.charAt(0)&&(o=Dl.test(i)?16:8,i=i.slice(8==o?1:2)),""===i)a=0;else{if(!(10==o?Pl:8==o?Ll:Nl).test(i))return e;a=parseInt(i,o)}n.push(a)}for(r=0;r<t;r++)if(a=n[r],r==t-1){if(a>=Rl(256,5-t))return null}else if(a>255)return null;for(s=n.pop(),r=0;r<n.length;r++)s+=n[r]*Rl(256,3-r);return s},ql=function(e){var t,n,r,i,o,a,s,u=[0,0,0,0,0,0,0,0],l=0,c=null,d=0,f=function(){return e.charAt(d)};if(":"==f()){if(":"!=e.charAt(1))return;d+=2,c=++l}for(;f();){if(8==l)return;if(":"!=f()){for(t=n=0;n<4&&Nl.test(f());)t=16*t+parseInt(f(),16),d++,n++;if("."==f()){if(0==n)return;if(d-=n,l>6)return;for(r=0;f();){if(i=null,r>0){if(!("."==f()&&r<4))return;d++}if(!Ml.test(f()))return;for(;Ml.test(f());){if(o=parseInt(f(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;d++}u[l]=256*u[l]+i,2!=++r&&4!=r||l++}if(4!=r)return;break}if(":"==f()){if(d++,!f())return}else if(f())return;u[l++]=t}else{if(null!==c)return;d++,c=++l}}if(null!==c)for(a=l-c,l=7;0!=l&&a>0;)s=u[l],u[l--]=u[c+a-1],u[c+--a]=s;else if(8!=l)return;return u},Hl=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)t.unshift(e%256),e=Il(e/256);return t.join(".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,o=0;o<8;o++)0!==e[o]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=e[n].toString(16),n<7&&(t+=":")));return"["+t+"]"}return e},zl={},Kl=bu({},zl,{" ":1,'"':1,"<":1,">":1,"`":1}),Wl=bu({},Kl,{"#":1,"?":1,"{":1,"}":1}),Yl=bu({},Wl,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Jl=function(e,t){var n=kl(e,0);return n>32&&n<127&&!P(t,e)?e:encodeURIComponent(e)},Xl={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Ql=function(e){return P(Xl,e.scheme)},Zl=function(e){return""!=e.username||""!=e.password},$l=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},ec=function(e,t){var n;return 2==e.length&&Al.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)},tc=function(e){var t;return e.length>1&&ec(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},nc=function(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&ec(t[0],!0)||t.pop()},rc=function(e){return"."===e||"%2e"===e.toLowerCase()},ic={},oc={},ac={},sc={},uc={},lc={},cc={},dc={},fc={},pc={},hc={},gc={},vc={},mc={},yc={},_c={},bc={},Sc={},kc={},wc={},Ec={},Tc=function(e,t,n,r){var i,o,a,s,u,l=n||ic,c=0,d="",f=!1,p=!1,h=!1;for(n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(jl,"")),t=t.replace(Gl,""),i=Gi(t);c<=i.length;){switch(o=i[c],l){case ic:if(!o||!Al.test(o)){if(n)return"Invalid scheme";l=ac;continue}d+=o.toLowerCase(),l=oc;break;case oc:if(o&&(Ol.test(o)||"+"==o||"-"==o||"."==o))d+=o.toLowerCase();else{if(":"!=o){if(n)return"Invalid scheme";d="",l=ac,c=0;continue}if(n&&(Ql(e)!=P(Xl,d)||"file"==d&&(Zl(e)||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=d,n)return void(Ql(e)&&Xl[e.scheme]==e.port&&(e.port=null));d="","file"==e.scheme?l=mc:Ql(e)&&r&&r.scheme==e.scheme?l=sc:Ql(e)?l=dc:"/"==i[c+1]?(l=uc,c++):(e.cannotBeABaseURL=!0,e.path.push(""),l=kc)}break;case ac:if(!r||r.cannotBeABaseURL&&"#"!=o)return"Invalid scheme";if(r.cannotBeABaseURL&&"#"==o){e.scheme=r.scheme,e.path=r.path.slice(),e.query=r.query,e.fragment="",e.cannotBeABaseURL=!0,l=Ec;break}l="file"==r.scheme?mc:lc;continue;case sc:if("/"!=o||"/"!=i[c+1]){l=lc;continue}l=fc,c++;break;case uc:if("/"==o){l=pc;break}l=Sc;continue;case lc:if(e.scheme=r.scheme,o==bl)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query;else if("/"==o||"\\"==o&&Ql(e))l=cc;else if("?"==o)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query="",l=wc;else{if("#"!=o){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.path.pop(),l=Sc;continue}e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query,e.fragment="",l=Ec}break;case cc:if(!Ql(e)||"/"!=o&&"\\"!=o){if("/"!=o){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,l=Sc;continue}l=pc}else l=fc;break;case dc:if(l=fc,"/"!=o||"/"!=d.charAt(c+1))continue;c++;break;case fc:if("/"!=o&&"\\"!=o){l=pc;continue}break;case pc:if("@"==o){f&&(d="%40"+d),f=!0,a=Gi(d);for(var g=0;g<a.length;g++){var v=a[g];if(":"!=v||h){var m=Jl(v,Yl);h?e.password+=m:e.username+=m}else h=!0}d=""}else if(o==bl||"/"==o||"?"==o||"#"==o||"\\"==o&&Ql(e)){if(f&&""==d)return"Invalid authority";c-=Gi(d).length+1,d="",l=hc}else d+=o;break;case hc:case gc:if(n&&"file"==e.scheme){l=_c;continue}if(":"!=o||p){if(o==bl||"/"==o||"?"==o||"#"==o||"\\"==o&&Ql(e)){if(Ql(e)&&""==d)return"Invalid host";if(n&&""==d&&(Zl(e)||null!==e.port))return;if(s=Bl(e,d))return s;if(d="",l=bc,n)return;continue}"["==o?p=!0:"]"==o&&(p=!1),d+=o}else{if(""==d)return"Invalid host";if(s=Bl(e,d))return s;if(d="",l=vc,n==gc)return}break;case vc:if(!Ml.test(o)){if(o==bl||"/"==o||"?"==o||"#"==o||"\\"==o&&Ql(e)||n){if(""!=d){var y=parseInt(d,10);if(y>65535)return"Invalid port";e.port=Ql(e)&&y===Xl[e.scheme]?null:y,d=""}if(n)return;l=bc;continue}return"Invalid port"}d+=o;break;case mc:if(e.scheme="file","/"==o||"\\"==o)l=yc;else{if(!r||"file"!=r.scheme){l=Sc;continue}if(o==bl)e.host=r.host,e.path=r.path.slice(),e.query=r.query;else if("?"==o)e.host=r.host,e.path=r.path.slice(),e.query="",l=wc;else{if("#"!=o){tc(i.slice(c).join(""))||(e.host=r.host,e.path=r.path.slice(),nc(e)),l=Sc;continue}e.host=r.host,e.path=r.path.slice(),e.query=r.query,e.fragment="",l=Ec}}break;case yc:if("/"==o||"\\"==o){l=_c;break}r&&"file"==r.scheme&&!tc(i.slice(c).join(""))&&(ec(r.path[0],!0)?e.path.push(r.path[0]):e.host=r.host),l=Sc;continue;case _c:if(o==bl||"/"==o||"\\"==o||"?"==o||"#"==o){if(!n&&ec(d))l=Sc;else if(""==d){if(e.host="",n)return;l=bc}else{if(s=Bl(e,d))return s;if("localhost"==e.host&&(e.host=""),n)return;d="",l=bc}continue}d+=o;break;case bc:if(Ql(e)){if(l=Sc,"/"!=o&&"\\"!=o)continue}else if(n||"?"!=o)if(n||"#"!=o){if(o!=bl&&(l=Sc,"/"!=o))continue}else e.fragment="",l=Ec;else e.query="",l=wc;break;case Sc:if(o==bl||"/"==o||"\\"==o&&Ql(e)||!n&&("?"==o||"#"==o)){if(".."===(u=(u=d).toLowerCase())||"%2e."===u||".%2e"===u||"%2e%2e"===u?(nc(e),"/"==o||"\\"==o&&Ql(e)||e.path.push("")):rc(d)?"/"==o||"\\"==o&&Ql(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&ec(d)&&(e.host&&(e.host=""),d=d.charAt(0)+":"),e.path.push(d)),d="","file"==e.scheme&&(o==bl||"?"==o||"#"==o))for(;e.path.length>1&&""===e.path[0];)e.path.shift();"?"==o?(e.query="",l=wc):"#"==o&&(e.fragment="",l=Ec)}else d+=Jl(o,Wl);break;case kc:"?"==o?(e.query="",l=wc):"#"==o?(e.fragment="",l=Ec):o!=bl&&(e.path[0]+=Jl(o,zl));break;case wc:n||"#"!=o?o!=bl&&("'"==o&&Ql(e)?e.query+="%27":e.query+="#"==o?"%23":Jl(o,zl)):(e.fragment="",l=Ec);break;case Ec:o!=bl&&(e.fragment+=Jl(o,Kl))}c++}},xc=function(e){var t,n,r=bn(this,xc,"URL"),i=arguments.length>1?arguments[1]:void 0,o=String(e),a=xl(r,{type:"URL"});if(void 0!==i)if(i instanceof xc)t=Cl(i);else if(n=Tc(t={},String(i)))throw TypeError(n);if(n=Tc(a,o,null,t))throw TypeError(n);var s=a.searchParams=new El,u=Tl(s);u.updateSearchParams(a.query),u.updateURL=function(){a.query=String(s)||null},S||(r.href=Ic.call(r),r.origin=Rc.call(r),r.protocol=Ac.call(r),r.username=Oc.call(r),r.password=Mc.call(r),r.host=Dc.call(r),r.hostname=Lc.call(r),r.port=Pc.call(r),r.pathname=Nc.call(r),r.search=Uc.call(r),r.searchParams=Fc.call(r),r.hash=jc.call(r))},Cc=xc.prototype,Ic=function(){var e=Cl(this),t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,a=e.path,s=e.query,u=e.fragment,l=t+":";return null!==i?(l+="//",Zl(e)&&(l+=n+(r?":"+r:"")+"@"),l+=Hl(i),null!==o&&(l+=":"+o)):"file"==t&&(l+="//"),l+=e.cannotBeABaseURL?a[0]:a.length?"/"+a.join("/"):"",null!==s&&(l+="?"+s),null!==u&&(l+="#"+u),l},Rc=function(){var e=Cl(this),t=e.scheme,n=e.port;if("blob"==t)try{return new URL(t.path[0]).origin}catch(e){return"null"}return"file"!=t&&Ql(e)?t+"://"+Hl(e.host)+(null!==n?":"+n:""):"null"},Ac=function(){return Cl(this).scheme+":"},Oc=function(){return Cl(this).username},Mc=function(){return Cl(this).password},Dc=function(){var e=Cl(this),t=e.host,n=e.port;return null===t?"":null===n?Hl(t):Hl(t)+":"+n},Lc=function(){var e=Cl(this).host;return null===e?"":Hl(e)},Pc=function(){var e=Cl(this).port;return null===e?"":String(e)},Nc=function(){var e=Cl(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},Uc=function(){var e=Cl(this).query;return e?"?"+e:""},Fc=function(){return Cl(this).searchParams},jc=function(){var e=Cl(this).fragment;return e?"#"+e:""},Gc=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(S&&Mt(Cc,{href:Gc(Ic,function(e){var t=Cl(this),n=String(e),r=Tc(t,n);if(r)throw TypeError(r);Tl(t.searchParams).updateSearchParams(t.query)}),origin:Gc(Rc),protocol:Gc(Ac,function(e){var t=Cl(this);Tc(t,String(e)+":",ic)}),username:Gc(Oc,function(e){var t=Cl(this),n=Gi(String(e));if(!$l(t)){t.username="";for(var r=0;r<n.length;r++)t.username+=Jl(n[r],Yl)}}),password:Gc(Mc,function(e){var t=Cl(this),n=Gi(String(e));if(!$l(t)){t.password="";for(var r=0;r<n.length;r++)t.password+=Jl(n[r],Yl)}}),host:Gc(Dc,function(e){var t=Cl(this);t.cannotBeABaseURL||Tc(t,String(e),hc)}),hostname:Gc(Lc,function(e){var t=Cl(this);t.cannotBeABaseURL||Tc(t,String(e),gc)}),port:Gc(Pc,function(e){var t=Cl(this);$l(t)||(""==(e=String(e))?t.port=null:Tc(t,e,vc))}),pathname:Gc(Nc,function(e){var t=Cl(this);t.cannotBeABaseURL||(t.path=[],Tc(t,e+"",bc))}),search:Gc(Uc,function(e){var t=Cl(this);""==(e=String(e))?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",Tc(t,e,wc)),Tl(t.searchParams).updateSearchParams(t.query)}),searchParams:Gc(Fc),hash:Gc(jc,function(e){var t=Cl(this);""!=(e=String(e))?("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",Tc(t,e,Ec)):t.fragment=null})}),me(Cc,"toJSON",function(){return Ic.call(this)},{enumerable:!0}),me(Cc,"toString",function(){return Ic.call(this)},{enumerable:!0}),wl){var Bc=wl.createObjectURL,Vc=wl.revokeObjectURL;Bc&&me(xc,"createObjectURL",function(e){return Bc.apply(wl,arguments)}),Vc&&me(xc,"revokeObjectURL",function(e){return Vc.apply(wl,arguments)})}mn(xc,"URL"),We({global:!0,forced:!qu,sham:!S},{URL:xc});var qc,Hc=m(function(e,t){e.exports=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="//imgcache.qq.com/open/qcloud/video/vcplayer/",t(0)}([function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){for(var t={urls:{m3u8:{od:e.m3u8||"",hd:e.m3u8_hd||"",sd:e.m3u8_sd||""},flv:{od:e.flv||"",hd:e.flv_hd||"",sd:e.flv_sd||""},mp4:{od:e.mp4||"",hd:e.mp4_hd||"",sd:e.mp4_sd||""},rtmp:{od:e.rtmp||"",hd:e.rtmp_hd||"",sd:e.rtmp_sd||""}},isClarity:function(e){var n=t.urls;return!!(n.m3u8[e]||n.flv[e]||n.mp4[e]||n.rtmp[e])},isFormat:function(e){var n=t.urls;return!!n[e].od||!!n[e].hd||!!n[e].sd},hasUrl:function(){return this.isFormat("rtmp")||this.isFormat("flv")||this.isFormat("m3u8")||this.isFormat("mp4")},definitions:[]},n=0;n<h.length;n++)t.isClarity(h[n])&&t.definitions.push(h[n]);!function(e,t){if(s.IS_MOBILE?(e.flash=!1,(s.IS_X5TBS&&e.x5_player||s.IS_ENABLED_MSE&&e.h5_flv)&&(p.mobile=["flv","m3u8","mp4"])):(e.flash=!!t.isFormat("rtmp")||e.flash,t.isFormat("flv")&&null==e.flash&&(e.flash=!0),e.flash?s.IS_ENABLED_FLASH||(e.flash=!1,s.IS_ENABLED_MSE?e.h5_flv&&(s.IS_SAFARI&&l.compareVersion(s.SAFARI_VERSION,"10.1")>-1||!s.IS_SAFARI)?p.pc=["flv","m3u8","mp4"]:p.pc=["m3u8","mp4"]:p.pc=["mp4"]):s.IS_ENABLED_MSE?e.h5_flv&&(s.IS_SAFARI&&l.compareVersion(s.SAFARI_VERSION,"10.1")>-1||!s.IS_SAFARI)?p.pc=["flv","m3u8","mp4"]:p.pc=["m3u8","mp4"]:s.IS_ENABLED_FLASH?e.flash=!0:p.pc=["mp4"]),e.clarity){var n=h.indexOf(e.clarity);h.splice(n,1),h.unshift(e.clarity)}}(e,t);var r=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p,n=void 0,r="",i=e.urls,a=s.IS_MOBILE?t.mobile:t.pc,u=0;u<a.length;u++)if(r=a[u],e.isFormat(r)){(n=o(i,r)).format=r;break}return n}(t);return r&&(t.curUrl=r.url,t.curDef=r.definition,t.curFormat=r.format),t}function o(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h,r="",i=0;i<n.length;i++)if(r=n[i],e[t][r])return{definition:r,url:e[t][r]}}t.__esModule=!0,t.TcPlayer=void 0;var s=r(n(1)),u=(r(n(2)),n(3)),l=r(u),c=r(n(4)),d=n(5),f=c.MSG,p={mobile:["m3u8","mp4"],pc:["rtmp","flv","m3u8","mp4"]},h=["od","hd","sd"];t.TcPlayer=function(e){function t(n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=i(r);h=["od","hd","sd"];var s={owner:n,videoSource:o,src:o.curUrl,autoplay:r.autoplay,live:r.live,flash:r.flash,flashUrl:r.flashUrl,poster:r.poster,width:r.width,height:r.height,volume:r.volume,listener:r.listener,wording:r.wording,controls:r.controls,clarity:r.clarity,clarityLabel:r.clarityLabel,showLoading:"boolean"!=typeof r.showLoading||r.showLoading,pausePosterEnabled:void 0===r.pausePosterEnabled||r.pausePosterEnabled,fullscreenEnabled:void 0===r.fuScrnEnabled||r.fuScrnEnabled,systemFullscreen:r.systemFullscreen||!1,hls:r.hls||"0.12.4",h5_flv:r.h5_flv,x5_player:!1!==r.x5_player,x5_type:r.x5_type,x5_fullscreen:r.x5_fullscreen,x5_orientation:r.x5_orientation,x5_playsinline:r.x5_playsinline,preload:r.preload||"auto",hlsConfig:r.hlsConfig,flvConfig:r.flvConfig};return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,s))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._switchClarity=function(e){e=e||"od";var t=this.currentTime(),n=this.options.videoSource,r=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p,i="",o=void 0;n=n||(s.IS_MOBILE?r.mobile:r.pc);for(var a=0;a<n.length;a++)if(e[i=n[a]][t]){o={definition:t,url:e[i][t],format:i};break}return o}(n.urls,e),i=this.playing();this.load(r.url),n.curUrl=r.url,n.curDef=r.definition,n.curFormat=r.format;var o=l.bind(this,function(){parseInt(this.duration()-t)>0&&!this.options.live&&this.currentTime(t),i&&this.play(!0),c.unsub(f.MetaLoaded,"*",o,this)});c.sub(f.MetaLoaded,"*",o,this)},t.prototype.switchClarity=function(e){this.claritySwitcher?this.claritySwitcher.setClarity(e):this._switchClarity(e)},t.prototype.handleMsg=function(t){e.prototype.handleMsg.call(this,t)},t}(d.Player)},function(e,t){t.__esModule=!0;var n=window.navigator.userAgent,r=/AppleWebKit\/([\d.]+)/i.exec(n),i=r?parseFloat(r.pop()):null,o=t.IS_IPAD=/iPad/i.test(n),a=t.IS_IPHONE=/iPhone/i.test(n)&&!o,s=t.IS_IPOD=/iPod/i.test(n),u=t.IS_IOS=a||o||s,l=(t.IOS_VERSION=function(){var e=n.match(/OS (\d+)_/i);if(e&&e[1])return e[1]}(),t.IS_MAC=/Mac/i.test(n),t.IS_ANDROID=/Android/i.test(n)),c=t.ANDROID_VERSION=function(){var e,t,r=n.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);return r?(e=r[1]&&parseFloat(r[1]),t=r[2]&&parseFloat(r[2]),e&&t?parseFloat(r[1]+"."+r[2]):e||null):null}(),d=(t.IS_OLD_ANDROID=l&&/webkit/i.test(n)&&c<2.3,t.IS_NATIVE_ANDROID=l&&c<5&&i<537,t.IS_FIREFOX=/Firefox/i.test(n),t.IS_EDGE=/Edge/i.test(n)),f=t.IS_CHROME=!d&&/Chrome/i.test(n),p=t.IS_SAFARI=!d&&!f&&/Safari/i.test(n),h=(t.SAFARI_VERSION=function(){if(!p)return null;var e=n.match(/version\/([\d.]+)/i);return e?e[1]:void 0}(),t.IS_IE8=/MSIE\s8\.0/.test(n),t.IS_IE9=/MSIE\s9\.0/.test(n),t.IS_IE=/(msie\s|trident.*rv:)([\w.]+)/i.test(n)),g=(t.IE_VERSION=function(){var e=n.match(/(msie\s|trident.*rv:)([\w.]+)/i);return e?e[2]:null}(),t.TOUCH_ENABLED=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),t.BACKGROUND_SIZE_SUPPORTED="backgroundSize"in document.createElement("video").style,t.HASVIDEO=!!document.createElement("video").canPlayType,t.IS_X5TBS=/TBS\/\d+/i.test(n)),v=(t.TBS_VERSION=function(){var e=n.match(/TBS\/(\d+)/i);if(e&&e[1])return e[1]}(),t.IS_MQQB=!g&&/MQQBrowser\/\d+/i.test(n),t.IS_QQB=!g&&/ QQBrowser\/\d+/i.test(n),t.IS_WECHAT=/(micromessenger|webbrowser)/i.test(n),t.IS_MQQ=/ QQ\/\d+/i.test(n),t.IS_MOBILE=l||u,t.IS_FILE_PROTOCOL=/file:/.test(location.protocol),t.FLASH_VERSION=null);t.IS_ENABLED_FLASH=function(){var e;if(document.all||h)try{if(e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))return t.FLASH_VERSION=v=e.GetVariable("$version").split(" ")[1].replace(/,/g,"."),window.console&&console.log("FLASH_VERSION",v),!0}catch(e){return!1}else try{if(navigator.plugins&&navigator.plugins.length>0&&(e=navigator.plugins["Shockwave Flash"])){for(var n=e.description.split(" "),r=0;r<n.length;++r)isNaN(parseInt(n[r]))||(t.FLASH_VERSION=v=n[r],window.console&&console.log("FLASH_VERSION",parseInt(n[r])));return!0}}catch(e){return!1}return!1}(),t.IS_ENABLED_MSE=function(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource,t=window.SourceBuffer=window.SourceBuffer||window.WebKitSourceBuffer,n=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;if(!u)return n&&r}(),t.BROWSER_TYPE=n.indexOf("Edge")>-1?"Edge":n.indexOf(".NET")>-1?"IE":n.indexOf("QQBrowser")>-1?"QQBrowser":n.indexOf("Mac OS")>-1?"safari":n.indexOf("Chrome")>-1?"chrome":"other"},function(e,t){function n(e,t){e.classList?e.classList.add(t):i(e,t)||(e.className=e.className+" "+t)}function r(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(o(t)," ")}function i(e,t){return e.classList?e.classList.contains(t):o(t).test(e.className)}function o(e){return new RegExp("(^|\\s)"+e+"($|\\s)")}function a(e){var t=void 0;if(e.getBoundingClientRect&&e.parentNode&&(t=e.getBoundingClientRect()),!t)return{left:0,top:0};var n=document.documentElement,r=document.body,i=n.clientLeft||r.clientLeft||0,o=window.pageXOffset||r.scrollLeft,a=t.left+o-i,s=n.clientTop||r.clientTop||0,u=window.pageYOffset||r.scrollTop,l=t.top+u-s;return{left:Math.round(a),top:Math.round(l)}}t.__esModule=!0,t.on=function(e,t,n){return e?(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),n):console.warn("element not exists")},t.off=function(e,t,n){return e?void(e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)):console.warn("element not exists")},t.createEl=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=document.createElement(e);for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];null===o?r.removeAttribute(o):r.setAttribute(i,o)}for(var a in n)n.hasOwnProperty(a)&&(r[a]=n[a]);return r},t.get=function(e){return document.getElementById(e)},t.addClass=n,t.removeClass=r,t.toggleClass=function(e,t,i){i?n(e,t):r(e,t)},t.hasClass=i,t.findElPosition=a,t.getPointerPosition=function(e,t,n){var r={},i=n||a(e),o=e.offsetWidth,s=e.offsetHeight,u=i.top,l=i.left,c=t.pageY||t.clientY,d=t.pageX||t.clientX;return t.changedTouches&&(d=t.changedTouches[0].pageX,c=t.changedTouches[0].pageY),r.y=Math.max(0,Math.min(1,(u-c+s)/s)),r.x=Math.max(0,Math.min(1,(d-l)/o)),r},t.loadScript=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=document.createElement("script");if(i.onload=i.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||("function"==typeof t&&t(),i.onload=i.onreadystatechange=null,i.parentNode&&!r&&i.parentNode.removeChild(i))},n)for(var o in n)if(n.hasOwnProperty(o)){var a=n[o];null===a?i.removeAttribute(a):i.setAttribute(o,a)}i.src=e,document.getElementsByTagName("head")[0].appendChild(i)},t.getViewportSize=function(){var e=document,t=e.documentElement,n=e.body;return{width:t&&t.clientWidth||n&&n.offsetWidth||window.innerWidth||0,height:t&&t.clientHeight||n&&n.offsetHeight||window.innerHeight||0}}},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(){return h++}function o(e){l.__isFullscreen=!!document[g.fullscreenElement],l.__isFullscreen||(p.IS_X5TBS&&c.off(l.player.video.el,"x5videoexitfullscreen",a),c.off(document,g.fullscreenchange,o)),f.pub({type:d.MSG.FullScreen,src:"util",ts:e.timeStamp,detail:{isFullscreen:l.__isFullscreen}},l.player)}function a(e){"x5videoexitfullscreen"===e.type&&(l.__isFullscreen=!1,c.off(document,g.fullscreenchange,o),c.off(l.player.video.el,"x5videoexitfullscreen",a),f.pub({type:d.MSG.FullScreen,src:"util",ts:e.timeStamp,detail:{isFullscreen:!1}},l.player))}function s(e){"webkitbeginfullscreen"==e.type?(c.off(l.player.video.el,"webkitbeginfullscreen",s),c.on(l.player.video.el,"webkitendfullscreen",s),f.pub({type:d.MSG.FullScreen,src:"util",ts:e.timeStamp,detail:{isFullscreen:!0}},l.player)):"webkitendfullscreen"==e.type&&(c.off(l.player.video.el,"webkitendfullscreen",s),f.pub({type:d.MSG.FullScreen,src:"util",ts:e.timeStamp,detail:{isFullscreen:!1}},l.player))}function u(e){27===e.keyCode&&l(l.player,!1)}function l(e,t,n){if(void 0===t)return l.__isFullscreen||!1;var r=e.options.systemFullscreen;l.player=e,g.requestFullscreen?t?(p.IS_X5TBS&&c.on(e.video.el,"x5videoexitfullscreen",a),c.on(document,g.fullscreenchange,o),n&&n[g.requestFullscreen]()):document[g.exitFullscreen]():r&&e.video.el.webkitEnterFullScreen?(c.on(e.video.el,"webkitbeginfullscreen",s),t?e.video.el.webkitEnterFullScreen():e.video.el.webkitExitFullscreen()):(l.__isFullscreen=t,l.__isFullscreen?(l.__origOverflow=document.documentElement.style.overflow,document.documentElement.style.overflow="hidden",c.on(document,"keydown",u)):(document.documentElement.style.overflow=l.__origOverflow,c.off(document,"keydown",u)),c.toggleClass(document.body,"vcp-full-window",t),f.pub({type:d.MSG.FullScreen,src:"util",detail:{isFullscreen:l.__isFullscreen}},l.player))}t.__esModule=!0,t.supportStyle=t.console=t.VideoType=t.CDNPath=t.FullscreenApi=void 0,t.guid=i,t.bind=function(e,t,n){t.guid||(t.guid=i());var r=function(){t.apply(e,arguments)};return r.guid=n?n+"_"+t.guid:t.guid,r},t.isEmpty=function(e){if(e instanceof Array)return 0===e.length;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},t.convertTime=function(e){var t=3600,n=(e|=0)/t|0,r=(e-n*t)/60|0,i=e-n*t-60*r;return n=n>0?n+":":"",r=r>0?r+":":"00:",i=i>0?i+"":n.length>0||r.length>0?"00":"00:00",(n=2==n.length?"0"+n:n)+(r=2==r.length?"0"+r:r)+(i=1==i.length?"0"+i:i)},t.doFullscreen=l,t.extend=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0;i<n.length;i++){var o=n[i];for(var a in o)o.hasOwnProperty(a)&&(e[a]=e[a]||o[a])}return e},t.store=function(e,t){return void 0===t?JSON.parse(localStorage[e]||"null"):void(localStorage[e]=JSON.stringify(t))},t.compareVersion=function(e,t){if((e=e||"0.0.0")==(t=t||"0.0.0"))return 0;for(var n=e.split("."),r=t.split("."),i=Math.max(n.length,r.length),o=0;o<i;o++){var a=~~r[o],s=~~n[o];if(a<s)return 1;if(a>s)return-1}return-1},t.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;").replace(/\//g,"&#x2F;")},t.getFormat=function(e){var t="unknown";return e.isFormat("rtmp")?t="rtmp":e.isFormat("flv")?t="flv":e.isFormat("m3u8")?t="m3u8":e.isFormat("mp4")&&(t="mp4"),t},t.unifyProtocol=function(e,t){e=e.replace(/^(http|https):/,"");var n=window.location.protocol;return"http:"!=n&&"https:"!=n&&(n=t||"https:"),n+e};for(var c=r(n(2)),d=n(4),f=r(d),p=r(n(1)),h=1,g=t.FullscreenApi={requestFullscreen:null,exitFullscreen:null,fullscreenElement:null,fullscreenEnabled:null,fullscreenchange:null,fullscreenerror:null},v=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],m=v[0],y=void 0,_=0;_<v.length;_++)if(v[_][1]in document){y=v[_];break}if(y)for(var b=0;b<y.length;b++)g[m[b]]=y[b];t.CDNPath="https://imgcache.qq.com/open/qcloud/video/vcplayer/",t.VideoType={RTMP:"rtmp",FLV:"flv",M3U8:"m3u8"},t.console={log:function(){window.console&&window.console.log.apply(window.console,arguments)},warn:function(){window.console&&window.console.warn.apply(window.console,arguments)},error:function(){window.console&&window.console.error.apply(window.console,arguments)}},t.supportStyle=function(){var e=document.createElement("div"),t="Khtml O Moz Webkit".split(" "),n=t.length;return function(r){if(r in e.style)return!0;if("-ms-"+r in e.style)return!0;for(r=r.replace(/^[a-z]/,function(e){return e.toUpperCase()});n--;)if(t[n]+r in e.style)return!0;return!1}}()},function(e,t,n){function r(e){var t=e.guid;return t?(s[t]=s[t]||{},s[t]):(console.error(e," has no guid."),{})}function i(e){var t=e.guid;return t?(u[t]=u[t]||{},u[t]):(console.error(e," has no guid."),{})}function o(e,t,n){try{var o=r(n),a=i(n);if(!o[e])return;var s=o[e];for(var u in s)if(s.hasOwnProperty(u)){var l=s[u],c=a[u];if("function"!=typeof c)return!1;for(var d=0;d<l.length;d++){var f=l[d];"*"!==f&&f!==t.src||c(t)}}}catch(e){window.console&&console.error&&console.error(e.stack||e)}}t.__esModule=!0,t.MSG=void 0,t.pub=function(e,t){o(e.type,e,t),o("*",e,t)},t.sub=function(e,t,n,o){var a=r(o),s=i(o);return n.guid?(s[n.guid]=n,a[e]=a[e]||{},a[e][n.guid]=a[e][n.guid]||[],a[e][n.guid].push(t),n):console.error("callback function need guid")},t.unsub=function(e,t,n,o){var s=r(o),u=i(o);if(("*"==e||s[e])&&("*"==e||s[e][n.guid]))for(var l in s)if(("*"===e||l==e)&&s.hasOwnProperty(l))if("*"!==n){var c=s[l][n.guid];"*"===t&&(c=[]);for(var d=0;d<c.length;)c[d]===t?c.splice(d,1):d++;0==c.length&&delete s[l][n.guid],a.isEmpty(s[l])&&delete s[l]}else{for(var f in s[l])delete u[f];delete s[l]}};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(3)),s=(t.MSG={Error:"error",TimeUpdate:"timeupdate",Load:"load",MetaLoaded:"loadedmetadata",Loaded:"loadeddata",Progress:"progress",FullScreen:"fullscreen",Play:"play",Playing:"playing",Pause:"pause",Ended:"ended",Seeking:"seeking",Seeked:"seeked",Resize:"resize",VolumeChange:"volumechange"},{}),u={}},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0,t.Player=t.dom=t.util=t.browser=t.MSG=void 0,n(6);var o=i(n(1)),a=i(n(2)),s=i(n(3)),u=i(n(4)),l=r(n(23)),c=r(n(26)),d=r(n(27)),f=r(n(35)),p=r(n(36)),h=r(n(37)),g=r(n(38)),v=r(n(39));window.console||(window.console={log:function(){},error:function(){},debug:function(){},info:function(){}});var m=t.MSG=u.MSG,y=t.browser=o,_=t.util=s,b=t.dom=a;t.Player=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.options=t,this.ready=!1,this.hasPlay=!1;var n=t.owner;return n?(this.guid=_.guid(),this.listener=this.options.listener,u.sub("*","*",_.bind(this,this.handleMsg),this),n=b.get(n),this.mtaReport=new v.default(this,this.options),void this.render(n)):console.error("Player need a container")}return e.prototype.render=function(e){var t="vcp-player";if(y.TOUCH_ENABLED&&(t+=" touchable"),this.el=b.createEl("div",{class:t}),e.appendChild(this.el),this.errortips=new g.default(this),this.errortips.render(this.el),this.loading=new h.default(this),this.loading.render(this.el),this.options.width=this.options.width||e.offsetWidth,this.options.height=this.options.height||e.offsetHeight,this.size(this.options.width,this.options.height),!this.verifyOptions())return this.listener({type:"error",code:5}),_.console.error("create failed");if(!this.options.flash&&y.HASVIDEO){var n=new l.default(this);n.render(this.el),this.video=n}else{var r=new c.default(this);r.render(this.el),this.video=r}if(!this.video)return _.console.error("create video failed");this.poster=new p.default(this),this.poster.render(this.el),(y.IS_SAFARI&&parseInt(y.SAFARI_VERSION)>10||y.IOS_VERSION>10)&&"system"==this.options.controls||(this.bigplay=new f.default(this),this.bigplay.render(this.el)),!(this.options.controls&&"default"!=this.options.controls&&(!this.options.flash||"system"!=this.options.controls))&&(this.panel=new d.default(this),this.panel.render(this.el)),this.setup()},e.prototype.verifyOptions=function(){return y.IE_VERSION&&-1==_.compareVersion(y.IE_VERSION,"8.0")?(this.errortips.show({code:5}),!1):!!this.options.src||(this.options.videoSource.hasUrl()?(y.IS_IE||y.IS_ENABLED_FLASH,this.errortips.show({code:5})):this.errortips.show({code:12}),!1)},e.prototype.size=function(e,t,n){n=n||"cover";var r=/^\d+\.?\d{0,2}%$/,i=void 0,o=void 0;if(r.test(e)||r.test(t))i=e,o=t;else{var a=this.video?this.video.videoWidth():this.options.width,s=this.video?this.video.videoHeight():this.options.height;i=e,o=t,a&&s&&"fit"==n&&(o=(i=e)/(a/s))>t&&(i*=t/o,o=t);var u=b.getViewportSize();u.width>0&&i>u.width&&(i=u.width)}i+=r.test(i)?"":"px",o+=r.test(o)?"":"px",this.el.style.width=i,this.el.style.height=o,this.video&&(this.video.width(i),this.video.height(o)),this.width=i,this.height=o},e.prototype.setup=function(){if(this.__handleEvent=_.bind(this,this.handleEvent),y.IS_MOBILE){if(this.options.autoplay){var e=this;document.addEventListener("WeixinJSBridgeReady",function(){e.play()})}}else this.loading.show()},e.prototype.destroy=function(){this.video&&this.video.destroy(),this.panel&&this.panel.destroy(),this.bigplay&&this.bigplay.destroy(),this.loading&&this.loading.destroy(),u.unsub("*","*",this.handleMsg,this),this.video=this.panel=this.bigplay=this.loading=null,this.el.parentNode.removeChild(this.el)},e.prototype.setListener=function(e){this.listener=e},e.prototype.handleEvent=function(e){switch(e.type){case"mousemove":if(this.__lastmove&&new Date-this.__lastmove<100)break;var t=this;if(this.__movecnt=this.__movecnt||0,this.__movecnt++,this.__movecnt<5){setTimeout(function(){t.__movecnt=0},500);break}this.__movecnt=0,this.__lastmove=+new Date,clearTimeout(this.__moveid),t.panel&&t.panel.show(),this.__moveid=setTimeout(function(){t.playing()&&t.panel&&t.panel.hide()},3e3)}},e.prototype.handleMsg=function(e){switch(e.type){case m.Load:b.removeClass(this.el,"vcp-playing"),("none"===this.options.preload||this.options.hlsConfig&&!1===this.options.hlsConfig.autoStartLoad)&&this.loading.hide();break;case m.Play:if(!this.playing())break;!this.hasPlay&&this.options.flash&&(this.mtaReport.reportFlash(),this.hasPlay=!0),b.addClass(this.el,"vcp-playing"),this.video.type()==_.VideoType.RTMP&&(this.__wait=!0,this.loading.show()),b.on(this.el,"mousemove",this.__handleEvent);break;case m.Playing:this.loading.hide();break;case m.TimeUpdate:this.__wait&&(this.__wait=!1,this.loading.hide());break;case m.Pause:b.off(this.el,"mousemove",this.__handleEvent),b.removeClass(this.el,"vcp-playing");break;case m.Ended:b.off(this.el,"mousemove",this.__handleEvent),this.panel&&this.panel.show(),b.removeClass(this.el,"vcp-playing");break;case m.MetaLoaded:this.loading.hide(),this.mtaReport.report(),this.size(this.options.width,this.options.height);break;case m.Seeking:this.loading.show();break;case m.Seeked:this.loading.hide();break;case m.FullScreen:var t=this;setTimeout(function(){b.toggleClass(t.el,"vcp-fullscreen",e.detail.isFullscreen)},0);break;case m.Error:this.loading.hide(),this.errortips.show(e.detail),this.panel&&this.panel.show();try{var n=this.options.videoSource,r=_.getFormat(n);y.IS_X5TBS?MtaH5.clickStat("x5_err",{format:r}):MtaH5.clickStat("error",{format:r})}catch(e){}}!e.private&&this.listener&&this.listener(e)},e.prototype.currentTime=function(e){return this.video.currentTime(e)},e.prototype.duration=function(){return this.video.duration()},e.prototype.percent=function(e){return this.video.duration()?void 0===e?this.video.currentTime()/this.video.duration():void this.video.currentTime(this.video.duration()*e):0},e.prototype.buffered=function(){return this.video.duration()?this.video.buffered()/this.video.duration():0},e.prototype.pause=function(){this.video.pause()},e.prototype.play=function(){var e;this.errortips.clear(),(e=this.video).play.apply(e,arguments)},e.prototype.togglePlay=function(){this.errortips.clear(),this.video.togglePlay()},e.prototype.stop=function(){this.video.stop()},e.prototype.mute=function(e){return this.video.mute(e)},e.prototype.volume=function(e){return this.video.volume(e)},e.prototype.fullscreen=function(e){return this.video.fullscreen(e)},e.prototype.load=function(e,t){this.errortips.clear(),this.loading.show(),this.video.load(e||this.options.src,t)},e.prototype.playing=function(){return this.video&&this.video.playing()},e.prototype.paused=function(){return this.video&&this.video.paused()},e}()},function(e,t,n){var r=n(7);"string"==typeof r&&(r=[[e.id,r,""]]),n(22)(r,{}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(8)()).push([e.id,".vcp-player{position:relative;z-index:0;font-family:Tahoma,\\\\5FAE\\8F6F\\96C5\\9ED1,\\u5b8b\\u4f53,Verdana,Arial,sans-serif;background-color:#000}.vcp-player video{display:block;overflow:hidden}.vcp-fullscreen.vcp-player,.vcp-fullscreen video,body.vcp-full-window{width:100%!important;height:100%!important}body.vcp-full-window{overflow-y:auto}.vcp-full-window .vcp-player{position:fixed;left:0;top:0;z-index:2147483647}.vcp-pre-flash,.vcp-video{width:100%;height:100%}.vcp-pre-flash{z-index:999;background:#000;position:absolute;top:0;left:0}.vcp-controls-panel{position:absolute;bottom:0;width:100%;font-size:16px;height:3em;z-index:1000}.vcp-controls-panel.show{animation:fadeIn ease .8s;animation-fill-mode:forwards;-webkit-animation-fill-mode:forwards}.vcp-controls-panel.hide{animation:fadeOut ease .8s;animation-fill-mode:forwards;-webkit-animation-fill-mode:forwards}.vcp-panel-bg{width:100%;height:100%;position:absolute;left:0;top:0;background-color:#242424;opacity:.8;filter:alpha(opacity=80);z-index:1000}.vcp-playtoggle{cursor:pointer;position:relative;z-index:1001;width:3em;height:100%;float:left;background-image:url("+n(9)+");background-image:url("+n(10)+")\\0}.vcp-playtoggle:focus,.vcp-playtoggle:hover{background-color:#708090;opacity:.9;filter:alpha(opacity=90)}.touchable .vcp-playtoggle:hover{background-color:transparent;opacity:1}.vcp-playing .vcp-playtoggle{background-image:url("+n(11)+");background-image:url("+n(12)+")\\0}.vcp-bigplay{width:100%;height:80%;position:absolute;background-color:white\\0;filter:alpha(opacity=0);opacity:0;z-index:1000;top:0;left:0}.vcp-slider{position:relative;z-index:1001;float:left;background:#c4c4c4;height:10px;opacity:.8;filter:alpha(opacity=80);cursor:pointer}.vcp-slider .vcp-slider-track{width:0;height:100%;margin-top:0;opacity:1;filter:alpha(opacity=100);background-color:#1e90ff}.vcp-slider .vcp-slider-thumb{cursor:pointer;background-color:#fff;position:absolute;top:0;left:0;border-radius:1em!important;height:10px;margin-left:-5px;width:10px}.vcp-slider-vertical{position:relative;width:.5em;height:8em;top:-5.6em;z-index:1001;background-color:#1c1c1c;opacity:.9;filter:alpha(opacity=90);cursor:pointer}.vcp-slider-vertical .vcp-slider-track{background-color:#1275cf;width:.5em;height:100%;opacity:.8;filter:alpha(opacity=80)}.vcp-slider-vertical .vcp-slider-thumb{cursor:pointer;position:absolute;background-color:#f0f8ff;width:.8em;height:.8em;border-radius:.8em!important;margin-top:-.4em;top:0;left:-.15em}.vcp-timeline{top:-10px;left:0;height:10px;position:absolute;z-index:1001;width:100%}.vcp-timeline .vcp-slider-thumb{top:-4px}.vcp-timeline .vcp-slider{margin-top:8px;height:2px;width:100%}.vcp-timeline:hover .vcp-slider{margin-top:0;height:10px}.vcp-timeline:hover .vcp-slider-thumb{display:block;width:16px;height:16px;top:-3px;margin-left:-8px}.vcp-timelabel{display:inline-block;line-height:3em;float:left;color:#fff;padding:0 9px}.vcp-timelabel,.vcp-volume{height:3em;z-index:1001;position:relative}.vcp-volume{width:3em;cursor:pointer;float:right;background-color:transparent;opacity:.9;filter:alpha(opacity=90)}.vcp-volume-icon{background-image:url("+n(13)+");background-image:url("+n(14)+")\\0;display:inline-block;width:3em;height:3em;position:absolute;left:0;top:0}.vcp-volume-muted .vcp-volume-icon{background-image:url("+n(15)+");background-image:url("+n(16)+")\\0}.vcp-volume .vcp-slider-vertical{top:-8.4em;left:1em;display:none}.vcp-volume .vcp-slider-track{position:absolute;bottom:0}.vcp-volume:hover .vcp-slider-vertical{display:block}.vcp-volume .vcp-volume-bg{height:8.8em;width:2em;position:absolute;left:.25em;top:-8.8em;background:#242424;display:none}.vcp-volume:hover .vcp-slider-vertical,.vcp-volume:hover .vcp-volume-bg{display:block}.vcp-fullscreen-toggle{position:relative;width:3em;height:3em;float:right;cursor:pointer;z-index:1001;background-image:url("+n(17)+");background-image:url("+n(18)+")\\0}.vcp-fullscreen .vcp-fullscreen-toggle{background-image:url("+n(19)+");background-image:url("+n(20)+')\\0}.vcp-loading{box-sizing:border-box;background-clip:padding-box;width:50px;height:50px;display:none;position:absolute;top:50%;left:50%;margin:-25px 0 0 -25px;text-indent:-9999em}.vcp-loading:before{box-sizing:inherit;content:"";display:block;width:100%;height:100%;border-radius:50%;border:3px solid hsla(0,0%,100%,0);border-left-color:#fff;border-right-color:#fff;transform:translateZ(0);animation:load8 1.1s infinite linear}@keyframes load8{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.vcp-poster{position:absolute;left:0;top:0;overflow:hidden;z-index:1000;width:100%;height:100%;display:none}.vcp-poster-pic{position:relative}.vcp-poster-pic.cover,.vcp-poster-pic.default{left:50%;top:50%;transform:translate(-50%,-50%)}.vcp-poster-pic.cover{width:100%}.vcp-poster-pic.stretch{width:100%;height:100%}.vcp-error-tips{position:absolute;z-index:1001;width:100%;height:4.5em;left:0;top:50%;color:#ff4500;margin-top:-5.25em;text-align:center;display:none}.vcp-clarityswitcher{height:3em;width:3em;cursor:pointer;position:relative;z-index:1001;float:right;background-color:transparent;opacity:.9}.vcp-vertical-switcher-container{width:3em;position:absolute;left:0;bottom:2.4em;background:#242424;display:none}.vcp-vertical-switcher-current{display:block;color:#fff;text-align:center;line-height:3em}.vcp-vertical-switcher-item{display:block;color:#fff;text-align:center;line-height:2em}.vcp-vertical-switcher-item.current{color:#888}.vcp-share>a{width:3em;height:3em;cursor:pointer;background-image:url('+n(21)+");opacity:.9;display:block}.vcp-share{width:3em;height:3em;position:relative;float:right;z-index:1001}.vcp-vertical-share-container{width:auto;height:auto;position:absolute;background:rgba(36,36,36,.8);padding:.5em;overflow:hidden;display:none}@keyframes fadeOut{0%{opacity:1}to{opacity:0}}.fadeOut{animation:fadeOut ease .8s;animation-fill-mode:forwards;-webkit-animation-fill-mode:forwards}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.fadeIn{animation:fadeIn ease .8s;animation-fill-mode:forwards;-webkit-animation-fill-mode:forwards}",""])},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];n[2]?e.push("@media "+n[2]+"{"+n[1]+"}"):e.push(n[1])}return e.join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(r[o]=!0)}for(i=0;i<t.length;i++){var a=t[i];"number"==typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMzYgMzYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogICAgPHBhdGggZD0iTTExLDEwIEwxOCwxMy43NCAxOCwyMi4yOCAxMSwyNiBNMTgsMTMuNzQgTDI2LDE4IDI2LDE4IDE4LDIyLjI4IiBmaWxsPSIjZmZmIj48L3BhdGg+DQo8L3N2Zz4="},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAAAFoAAABaAHAjuH0AAAAHdElNRQfgBRQSOydLEdPXAAABmUlEQVRYw+2Wu0oDQRhGz2oIEhAtBEHRQpIIXtAH0M7Kd7DQQl/BV/BlFEEsBO9IUAmI8X5Bi6RQoqgYJYr5LMISE5LdmZhyT7mzO9/8Z3b/WQgICAjwxak9JLPbfGiqfwGNCBhkmj4cECqryJyQ52iMWeIccsI9eVfav4tyEZrSjwpKaUHj6lKLHFnXEvIZd3CI080k6yyRJGdryi8AIEyYdtoYZJ9NEnzYyDIJKM7VQw8DROnnmGseihJNY6oiNKWCyvnRq5Y1o6jaFXJ3xMuaaQUuTbQywSgXLLLGXeMU/ZUVoZcOOhljj23OXVnVVdkHFIkwwgBDxEhwRpq3OuaougeV5HWsefXX3ge/XmQiOezloV5FAN+cssEB52QaH/DBNanSJjcyQHySrXxNa39stgEF3tlimR2yvJs8YBfwRIJ1klzyWLro3SpMA0SaG5LssMuL2dTmAV/kyJS3a/MG5xcg4IpVVrjlmbz9uekdkOOILRKkikemuRgjhIY1p7ia7Q/KEn7/RY6t80r8elF9yw4ICAiw4xcxfsNvJiWE7gAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNi0wNS0yMFQxODo1OToxOCswODowMJKBy7cAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTYtMDUtMjBUMTg6NTk6MzkrMDg6MDAHjn/CAAAAPHRFWHRzdmc6YmFzZS11cmkAZmlsZTovLy9EOi9zcGFjZS92Y19wbGF5ZXIvc3JjL2ltZy9wbGF5X2J0bi5zdmedrkudAAAAAElFTkSuQmCC"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMzYgMzYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogICAgPHBhdGggZD0iTTExLDEwIEwxNywxMCAxNywyNiAxMSwyNiBNMjAsMTAgTDI2LDEwIDI2LDI2IDIwLDI2IiBmaWxsPSIjZmZmIj48L3BhdGg+DQo8L3N2Zz4="},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAAAFoAAABaAHAjuH0AAAAHdElNRQfgBRQTADNsu4KlAAAAfklEQVRYw+2WsQ2AMAwEPyiZimloWIqOhjHYg1VAMi1Ejo2l0P2VH/kvnQ0QQohLaj9Jl6ocnBInDwpGzI+qgh0LxMhjCGSSN5skaeY6g+m4qn+dTh4WdIACCiiggAIKfEGulntxcrXC4sBaLXc7V/DuosDZolf9fngRQsgHbrk8P6SPYKxbAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE2LTA1LTIwVDE5OjAwOjI0KzA4OjAwi3r4LQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNi0wNS0yMFQxOTowMDo1MSswODowMKLaZi8AAAA8dEVYdHN2ZzpiYXNlLXVyaQBmaWxlOi8vL0Q6L3NwYWNlL3ZjX3BsYXllci9zcmMvaW1nL3N0b3BfYnRuLnN2Z0xvOgsAAAAASUVORK5CYII="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMzYgMzYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogICAgPHBhdGggZD0iTTEyLjM5LDE1LjU0IEwxMCwxNS41NCBMMTAsMjAuNDQgTDEyLjQsMjAuNDQgTDE3LDI1LjUwIEwxNywxMC40OCBMMTIuMzksMTUuNTQgWiIgb3BhY2l0eT0iMSIgZmlsbD0iI2ZmZiI+PC9wYXRoPg0KICAgIDxwYXRoIGQ9Ik0xMi4zOSwxNS41NCBMMTAsMTUuNTQgTDEwLDIwLjQ0IEwxMi40LDIwLjQ0IEwxNywyNS41MCBMMTcsMTAuNDggTDEyLjM5LDE1LjU0IFoiIG9wYWNpdHk9IjEiIGZpbGw9IiNmZmYiPjwvcGF0aD4NCiAgICA8cGF0aCBkPSJNMjIsMTcuOTkgQzIyLDE2LjQgMjAuNzQsMTUuMDUgMTksMTQuNTQgTDE5LDIxLjQ0IEMyMC43NCwyMC45MyAyMiwxOS41OSAyMiwxNy45OSBaIiBvcGFjaXR5PSIxIiBmaWxsPSIjZmZmIj48L3BhdGg+DQogICAgPHBhdGggZD0iTTIyLDE3Ljk5IEMyMiwxNi40IDIwLjc0LDE1LjA1IDE5LDE0LjU0IEwxOSwyMS40NCBDMjAuNzQsMjAuOTMgMjIsMTkuNTkgMjIsMTcuOTkgWiIgb3BhY2l0eT0iMSIgZmlsbD0iI2ZmZiI+PC9wYXRoPg0KPC9zdmc+"},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAAAFoAAABaAHAjuH0AAAAHdElNRQfgBR8OMR9bwV7WAAABiElEQVRYw+2WvS9DURiHn9sSbUMrrTZSsYgYSATBIkRYLI0JsfkDjCb+B4mFxeJjNVsMEkwmMRhMNloShg5K+zO4lV4ft6e9DJL7nO3c97zPOe/JOeeCj4+PT1UsszDVPsQm8NcrMBLY84+T+BOBnT7CDFM11sckud2aNalT7cuS96TfCBo1qhNJe7ULGgyKAyOsMFTuKPeaVesHgWOewyyRqYhsp0juPaa6xG0FMSJAhGUWHHFjtHBEloK3ElnMMQF00EfIsbRp5jljjSuKXgQwwCwFmmn61B8lwTjLbHFRXeB2DmJEaSP0pdAlIMYs3SYlchPIdVySsFeBOyWzsECd30rckjcRuG1yjiwvtBL+pAoC9xxw7VVwToAgXfSTdmz0E3ccs2km+AEhFFVKKXVqQzm9sytLKKNFpdUoPFx8qmy9Wle+QpBUvPzNM3aiQe3o8UPwW8kdK+nRoV5//bqu4IZVgvVMsYrAwj7Qz1yyXU9djF6Nj0ff4qHW35b//1/k4+PjY8AbQVScfN4fNOAAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTYtMDUtMzFUMTQ6NDk6MDYrMDg6MDB87oydAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE2LTA1LTMxVDE0OjQ5OjMxKzA4OjAwRpsNTAAAADp0RVh0c3ZnOmJhc2UtdXJpAGZpbGU6Ly8vRDovc3BhY2UvdmNfcGxheWVyL3NyYy9pbWcvdm9sdW1uLnN2Z7m8k5MAAAAASUVORK5CYII="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMzYgMzYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogICAgPHBhdGggZD0iTTEyLjM5LDE1LjU0IEwxMCwxNS41NCBMMTAsMjAuNDQgTDEyLjQsMjAuNDQgTDE3LDI1LjUwIEwxNywxMC40OCBMMTIuMzksMTUuNTQgWiIgb3BhY2l0eT0iMSIgZmlsbD0iI2ZmZiI+PC9wYXRoPg0KICAgIDxwYXRoIGQ9Ik0xMi4zOSwxNS41NCBMMTAsMTUuNTQgTDEwLDIwLjQ0IEwxMi40LDIwLjQ0IEwxNywyNS41MCBMMTcsMTAuNDggTDEyLjM5LDE1LjU0IFoiIG9wYWNpdHk9IjEiIGZpbGw9IiNmZmYiPjwvcGF0aD4NCiAgICA8cGF0aCBkPSJNMTkuNjMsMTUuOTIgTDIwLjY4LDE0LjkzIEwyMi44MSwxNi45NCBMMjQuOTQsMTQuOTMgTDI2LDE1LjkyIEwyMy44NiwxNy45MyBMMjYsMTkuOTMgTDI0Ljk0LDIwLjkyIEwyMi44MSwxOC45MiBMMjAuNjgsMjAuOTIgTDE5LjYzLDE5LjkzIEwyMS43NiwxNy45MyBMMTkuNjMsMTUuOTIgWiIgb3BhY2l0eT0iMSIgZmlsbD0iI2ZmZiI+PC9wYXRoPg0KICAgIDxwYXRoIGQ9Ik0xOS42MywxNS45MiBMMjAuNjgsMTQuOTMgTDIyLjgxLDE2Ljk0IEwyNC45NCwxNC45MyBMMjYsMTUuOTIgTDIzLjg2LDE3LjkzIEwyNiwxOS45MyBMMjQuOTQsMjAuOTIgTDIyLjgxLDE4LjkyIEwyMC42OCwyMC45MiBMMTkuNjMsMTkuOTMgTDIxLjc2LDE3LjkzIEwxOS42MywxNS45MiBaIiBvcGFjaXR5PSIxIiBmaWxsPSIjZmZmIj48L3BhdGg+DQo8L3N2Zz4="},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAAAFoAAABaAHAjuH0AAAAHdElNRQfgBR8OMx9p9zxUAAAB3UlEQVRYw+2Wz0sVURTHP+PMw3joG39jWRGFLpQnIhZBEGEEuZBoERK0aNUqWrXyL3AVtWjnKjVaqOBChKJV8UJatAgraBUkgo8Cn2kk8b4uHMN5zcybO+pCmM/ZnXvv+Z5z7g8upKSkpFTFijdN5ks8ag67glgCXv5NNB+KgBc+y3UGDfsTJ7hndbqit5qUpf0HDRDI6ILeSJowF3BiNAfO85D+XUeQRHjnQgR8QQa4y3D1VIJFopa5ZIEs9xnxzbNxaaBEiS0ytGNT4qd5iyxucRnooIdjvpFGbnOHlzznM6cZ4zgzPEamAtDHDbaoo7bC/xuHPC04fOci1yhGHd7oFuUC/ZssMs0QNylzkmXmKSQTUKi/wBqdDOBQosAUH8KDJHuLamnGxQEynKMhampUBWHiLle5xxnesU6ebh7gMhdWb1QFRVZZZoPyf2u6uMQSUzzlBb/oI5+sgvfUYHOWXk74zsk6X3nFLK9ZYZEyOb4YN1kI5dSmNp3SExW1wzNZQqheHcrJFrLVqnbVC8M3SnutW4+04RMINKM9sDwD4BMTTLNWOVZpifiXX5cW9PfAn+s9fGMUO0mKVQQsvAv9h4+Mm+7kboQYjQKgCYsfpt+Wo/8vSklJSYnBNtEBsGU3qz6oAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE2LTA1LTMxVDE0OjUxOjA1KzA4OjAwn18JNAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNi0wNS0zMVQxNDo1MTozMSswODowMJTCkngAAAA5dEVYdHN2ZzpiYXNlLXVyaQBmaWxlOi8vL0Q6L3NwYWNlL3ZjX3BsYXllci9zcmMvaW1nL211dGVkLnN2Z6SDmFIAAAAASUVORK5CYII="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMzYgMzYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogICAgPHBhdGggZD0iTTcsMTYgTDEwLDE2IEwxMCwxMyBMMTMsMTMgTDEzLDEwIEw3LDEwIEw3LDE2IFoiIG9wYWN0aXk9IjEiIGZpbGw9IiNmZmYiPjwvcGF0aD4NCiAgICA8cGF0aCBkPSJNMjMsMTAgTDIzLDEzIEwyNiwxMyBMMjYsMTYgTDI5LDE2IEwyOSwxMCBMMjMsMTAgWiIgb3BhY3RpeT0iMSIgZmlsbD0iI2ZmZiI+PC9wYXRoPg0KICAgIDxwYXRoIGQ9Ik0yMywyMyBMMjMsMjYgTDI5LDI2IEwyOSwyMCBMMjYsMjAgTDI2LDIzIEwyMywyMyBaIiBvcGFjdGl5PSIxIiBmaWxsPSIjZmZmIj48L3BhdGg+DQogICAgPHBhdGggZD0iTTEwLDIwIEw3LDIwIEw3LDI2IEwxMywyNiBMMTMsMjMgTDEwLDIzIEwxMCwyMCBaIiBvcGFjdGl5PSIxIiBmaWxsPSIjZmZmIj48L3BhdGg+DQo8L3N2Zz4="},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAAAFoAAABaAHAjuH0AAAAHdElNRQfgBR8TICc05PV7AAABZUlEQVRYw+2WPXKDMBSEPwXsg6TIJVxxEBcunEPFld04t6DiEi58EGyyKSAOED1JZCZFZrQVmtl9f/tGAjIyMjKicNOj0mgLuGVCNCtSErf0SPZU3EaSNxoj/IbXUYoVNYdgOSDkdNYUO1nc3Yx5lptznzzK2+zcmfV0EaWRYFQi0AWaFt2DZ6AMiA/UrJHpADTscLRU7L2LFkwANe+EceU6fO2Xd+BYY5U1EL5aZW0TfR70E+0iCzdVdCOlt4xx7A0vdIiGq4vGBsEzGxwFF5p5yMhVkZhgseY/4c9H5FvTkcmJZU5MjlQjp6Mk6a5t2p4KbXWXJB3TLru+x2LBOjgKa6Khu6j9nm/kRWvRb+6iCobLzvKin31LldyrkNNpeD4+9BHy4jH7nidJp58ehDqIe9HPPuiVz+TV7FyY6iKiNDqoYfLoX8wEF06zR98Ywyga3l8Rc4ui3NJSJmIJNyMjI8PCJz46uKC8JLnTAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE2LTA1LTMxVDE3OjQ1OjU3KzA4OjAwNY8FDQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNi0wNS0zMVQxOTozMjozOSswODowMOODzSEAAAA+dEVYdHN2ZzpiYXNlLXVyaQBmaWxlOi8vL0Q6L3NwYWNlL3ZjX3BsYXllci9zcmMvaW1nL2Z1bGxzY3JlZW4uc3ZnTGxUBwAAAABJRU5ErkJggg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMzYgMzYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogICAgPGRlZnM+DQogICAgICAgIDxwYXRoIGQ9Ik0xMywxMCBMMTAsMTAgTDEwLDEzIEw3LDEzIEw3LDE2IEwxMywxNiBMMTMsMTAgWiIgaWQ9InN2Zy1xdWl0LTEiPjwvcGF0aD4NCiAgICAgICAgPHBhdGggZD0iTTI5LDE2IEwyOSwxMyBMMjYsMTMgTDI2LDEwIEwyMywxMCBMMjMsMTYgTDI5LDE2IFoiIGlkPSJzdmctcXVpdC0yIj48L3BhdGg+DQogICAgICAgIDxwYXRoIGQ9Ik0yOSwyMyBMMjksMjAgTDIzLDIwIEwyMywyNiBMMjYsMjYgTDI2LDIzIEwyOSwyMyBaIiBpZD0ic3ZnLXF1aXQtMyI+PC9wYXRoPg0KICAgICAgICA8cGF0aCBkPSJNMTAsMjYgTDEzLDI2IEwxMywyMCBMNywyMCBMNywyMyBMMTAsMjMgTDEwLDI2IFoiIGlkPSJzdmctcXVpdC00Ij48L3BhdGg+DQogICAgPC9kZWZzPg0KICAgIDx1c2Ugc3Ryb2tlPSIjMDAwIiBzdHJva2Utb3BhY2l0eT0iLjE1IiBzdHJva2Utd2lkdGg9IjJweCIgeGxpbms6aHJlZj0iI3N2Zy1xdWl0LTEiPjwvdXNlPg0KICAgIDx1c2Ugc3Ryb2tlPSIjMDAwIiBzdHJva2Utb3BhY2l0eT0iLjE1IiBzdHJva2Utd2lkdGg9IjJweCIgeGxpbms6aHJlZj0iI3N2Zy1xdWl0LTIiPjwvdXNlPg0KICAgIDx1c2Ugc3Ryb2tlPSIjMDAwIiBzdHJva2Utb3BhY2l0eT0iLjE1IiBzdHJva2Utd2lkdGg9IjJweCIgeGxpbms6aHJlZj0iI3N2Zy1xdWl0LTMiPjwvdXNlPg0KICAgIDx1c2Ugc3Ryb2tlPSIjMDAwIiBzdHJva2Utb3BhY2l0eT0iLjE1IiBzdHJva2Utd2lkdGg9IjJweCIgeGxpbms6aHJlZj0iI3N2Zy1xdWl0LTQiPjwvdXNlPg0KICAgIDx1c2UgZmlsbD0iI2ZmZiIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhsaW5rOmhyZWY9IiNzdmctcXVpdC0xIj48L3VzZT4NCiAgICA8dXNlIGZpbGw9IiNmZmYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bGluazpocmVmPSIjc3ZnLXF1aXQtMiI+PC91c2U+DQogICAgPHVzZSBmaWxsPSIjZmZmIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeGxpbms6aHJlZj0iI3N2Zy1xdWl0LTMiPjwvdXNlPg0KICAgIDx1c2UgZmlsbD0iI2ZmZiIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhsaW5rOmhyZWY9IiNzdmctcXVpdC00Ij48L3VzZT4NCjwvc3ZnPg=="},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwEAQAAACtm+1PAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAAAFoAAABaAHAjuH0AAAAHdElNRQfgBR8RLwr1J2GvAAAFUklEQVRo3u2Yf0iUdxzHX889z915levSmBbpNS8NlSCcrY7+iJq2H8ZNYQwyguZYMBhBUK1iKeWgX46xGAaFzWEYtYHXUZJaiTB2mSaCTSG7QpPVxJbN8rzHu/vuj9PSqfeczkHBveD55/l+vu/v5/P9fD7P830eiBAhQoQIESK8HhjDtJNmODaTtaaHdBcnKDtBuQCKFZR0UFaAMiRb5JwwFzYGbZWhkbnpI1oXQNkZXCN8lOkYi2VKPQvilxryDANKGjE48fAQn/c45f7cv09CXw7QpiGT4u9acFJ2vFFu3I2PRcjYifG1M6BWqUvFskf14PtfEgAoFwwFSWUtK4pq+lKqE3tPXXT3xjuKKwe3xEHsALAqDJFVEDtQObglrjfeUdx76qK7L6U6sWVFUY2hIKksmInZYZJykLPmlCbF9CVUJ4sxNBXuN4N5LZAZhm4mmNc2Fe43j9XoS6hOnlOaFANyVni+BNGFWMg7vublLFAKPFbRFrCrZS+smkVH4JJ/JZA9jc3JDlzyr6RZdIzeCNjVMo9VtIFSMLLW2J7wTiUUsgfG1XwmLR6r+MncYLgvZTF3Gs6GhZTFXHOD4X5/zeJ1Jrf0pa85vJ7QamKbIc8wcKNp65LEutWxAbvqlrKYO/9ExhC5sxvA/BMZQ3d2HDUJJ26d0xDbbW5csiavokc9gw34bqYB7FPSiEn8dfWfsd0fdL24mws8o4550yqbqXlGnf56QvZCEoLaP3CH5ViUtIo4Ff4KNVWnIR2FE09g13D9hJFR59MlD5vIBzzTcDk4J13yjNMaQ2DXcD1OPEBUKCGtDOh4iI9CUcnnfD226V44Xx54IDYLG4fon0YAsWKzsFEecLNNB78L07jRTCmVQlFJNH4tH7UCaPIep/zqxp+LkotufjvytHnJJvLFZmG7fKD1XTBY0c5ocFMwVF0+0FpC8b5r0hHJxSUqxxlskls773UZvbUcJJdtobIQ8mwiW+Qcf9eCkyAWgP99Jj4qPUAsGKr0Nu+nw66nh4H7GgG8pbfN3zfsMv4Iah7wGDD9y6YO5CsgPZEtT77wd/kvzyiAkXHDyM4KDTsfMBxGBgD0BLOvpRkA1FB24aT8lSZkD8gW+cPXvISUIdmRWF6x0VaUfMTiDdXExb+0WqHXD9zUCOAdeFM+8PFKd07xymvSuSmaeG+XcWut66A/t3sb+KKYGcqKOclJqb3xjuLgqS3QPu4aFLdEqd9xo2NPG5iPEf5h7tiNjj1totTvEIPi1gRdIURvvKN4TnJSavCbIYSHGosFWITMbik/uLSUOsFimw7piOQiWArh8lg6J7nYq3sbExlkTlIIh6R8znKeTgKhhLSaeAg7Jl2Jfv2EkWfUAcGXULAETIRPcM7oC2xUa6xjJfr12DEBQ6GEtDJw2NfOQLexcQmJpATsatnoYU5/PWF2zkEA88ge3vDgt6c7WqLEVZ7rnIbPus2Np33t9ADRwCczDcClVqlL1+RV9CiZFY89VmE1Nxju39lx1LSQhFnzH+DpjpaolKavPP121WpKlx77mulRq9RnwO0ZZ0C661svlj2qV89gU8+IDFAa+msWrxNO3LN9nBZXed5vV63ivT8aBvFlgBQN3A76MPVxOhSvxSdlqAxM8hknbfc1M9BtblzCciyBXcP1FIrKzntdRg7JV4ANYQQggXylc2/XMsuii99wSMrXlejXd5sbT/ua6RnZ+avavmgHMBkveyKtIo6zfEQ0fm8tB0F6gsYTY4QhkJ5srXUdNEa7vucs59lOnK89vJr/T7yKP7amw+v/azFChAgRIkSIMMv8A/Qifkc5vn6XAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE2LTA1LTMxVDE3OjQ2OjUxKzA4OjAwvWiLNAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNi0wNS0zMVQxNzo0NzoxMCswODowMAHKXfgAAABDdEVYdHN2ZzpiYXNlLXVyaQBmaWxlOi8vL0Q6L3NwYWNlL3ZjX3BsYXllci9zcmMvaW1nL2Z1bGxzY3JlZW5fZXhpdC5zdmeq7hYiAAAAAElFTkSuQmCC"},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAjVJREFUeNrsmDtoFUEUhr+rJkiCSEyRQhHRCCohBAlioRIECxtBQRBL8VHYWFmIhXaijY2gRCGIFlbpLASFYDAiPoiPYFBBRBQFkRA0PmI+m3MhhORe3ZDNXpgfplh2mZlv5/zn7NmSSi1rATWuBJAAEkACSAAJIAHMpxbluFYbcBDYCiwBvgODQDdwD5jINKuax+hSB51ew+p+tS7L3HlsvlW9b2UNqGuyzJ+HBzqBjVWeaQIai2ri31XiewK4BbwvmgdK6k71tjo+Q+j8UbvVlqzrlOagIysBHcAxYDfwDOgB1sV1c5zKa+B63BvNvNgsABqApcBIpESAlcBh4Ehsqge4DHwIsPVAK/AtwD7P+m1lBNgCHAJWAa+AG8By4ATQAlwFLgIv5txhGeJuh/p2Six/UkfUXnVzTrUlUx1Yq/bPYMibakOem89SB9piTKePk7xQ2I+5p8CjCsWoqegAb4AzYdyyRoEnYezeSJUNeQFkzUKdwL54433AXWATcDJCrBc4D/RPU4UXR0odm0+AsuqiKJW1AjgAHI1TuAZcAJ4Dq4FdQHuc/BBwB3iYdxr9l9GhXlLH1CH1nNqn/pqUtcYjHR9XG/NKo/8z6tXtFdJuWT/V02pzUfuBveqPKhBf1FNF7Qfqw7SVtAzYVtR+4DEwXMt/JV4CZ4GvVSCvFLmpXxheeDAl9sej4emKZwrR0FRSO7AH2BAFbiCK3rv5KmTpz1wCSAAJIAEkgASQAGpZfwcAT9esWbDao2gAAAAASUVORK5CYII="},function(e,t,n){function r(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=d[r.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](r.parts[o]);for(;o<r.parts.length;o++)i.parts.push(l(r.parts[o],t))}else{var a=[];for(o=0;o<r.parts.length;o++)a.push(l(r.parts[o],t));d[r.id]={id:r.id,refs:1,parts:a}}}}function i(e){for(var t=[],n={},r=0;r<e.length;r++){var i=e[r],o=i[0],a={css:i[1],media:i[2],sourceMap:i[3]};n[o]?n[o].parts.push(a):t.push(n[o]={id:o,parts:[a]})}return t}function o(e,t){var n=h(),r=m[m.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),m.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(t)}}function a(e){e.parentNode.removeChild(e);var t=m.indexOf(e);t>=0&&m.splice(t,1)}function s(e){var t=document.createElement("style");return t.type="text/css",o(e,t),t}function u(e){var t=document.createElement("link");return t.rel="stylesheet",o(e,t),t}function l(e,t){var n,r,i;if(t.singleton){var o=v++;n=g||(g=s(t)),r=c.bind(null,n,o,!1),i=c.bind(null,n,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=u(t),r=function(e,t){var n=t.css,r=t.sourceMap;r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var i=new Blob([n],{type:"text/css"}),o=e.href;e.href=URL.createObjectURL(i),o&&URL.revokeObjectURL(o)}.bind(null,n),i=function(){a(n),n.href&&URL.revokeObjectURL(n.href)}):(n=s(t),r=function(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),i=function(){a(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}function c(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=y(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}var d={},f=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}},p=f(function(){return/msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase())}),h=f(function(){return document.head||document.getElementsByTagName("head")[0]}),g=null,v=0,m=[];e.exports=function(e,t){void 0===(t=t||{}).singleton&&(t.singleton=p()),void 0===t.insertAt&&(t.insertAt="bottom");var n=i(e);return r(n,t),function(e){for(var o=[],a=0;a<n.length;a++){var s=n[a];(u=d[s.id]).refs--,o.push(u)}for(e&&r(i(e),t),a=0;a<o.length;a++){var u;if(0===(u=o[a]).refs){for(var l=0;l<u.parts.length;l++)u.parts[l]();delete d[u.id]}}}};var y=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0;var i="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)},o=function(e){return e&&e.__esModule?e:{default:e}}(n(24)),s=r(n(2)),u=r(n(3)),l=n(4),c=r(n(25)),d=r(n(1)),f=(u.FullscreenApi,{"0.7.1":"libs/hls.js","0.7min":"libs/hls.min.js","0.8.1":"libs/hls0.8.js","0.8.9":"libs/hls.min.0.8.9.js","0.12.4":"libs/hls.min.0.12.4.js"}),p=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"H5Video"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(t){var n=this.player.options,r="system"==n.controls?"":null,o=!!n.autoplay||null;return n.poster&&"object"==i(n.poster)?n.poster.src:"string"==typeof n.poster&&n.poster,this.createEl("video",{controls:r,preload:n.preload||"auto",autoplay:o,"webkit-playsinline":"",playsinline:"","x-webkit-airplay":"allow","x5-video-player-type":"h5-page"==n.x5_type?"h5-page":null,"x5-video-player-fullscreen":!!n.x5_fullscreen||null,"x5-video-orientation":["landscape","portrait","landscape|portrait"][n.x5_orientation]||null,"x5-playsinline":1==!!n.x5_playsinline?n.x5_playsinline:null,"x5-mse-live-streaming":n.live?"":null}),this.el.style.width=this.player.width,this.el.style.height=this.player.height,e.prototype.render.call(this,t)},t.prototype.__hlsLoaded=function(e){if(!Hls.isSupported())return this.notify({type:"error",code:5,timeStamp:+new Date});this.hls&&this.hls.destroy();var t=new Hls(this.options.hlsConfig);t.loadSource(e),t.attachMedia(this.el),t.on(Hls.Events.MANIFEST_PARSED,function(e,t){}),t.on(Hls.Events.MEDIA_DETACHED,function(){}),t.on(Hls.Events.ERROR,u.bind(this,this.__hlsOnError)),this.hls=t},t.prototype.__hlsOnManifestParsed=function(e,t){this.metaDataLoaded=!0},t.prototype.__hlsOnError=function(e,t){var n=t.type,r=t.details,i=t.fatal,o=this.hls;if(i)switch(n){case Hls.ErrorTypes.NETWORK_ERROR:r.indexOf("TimeOut")>0?u.console.error("加载视频文件超时"):u.console.error("无法加载视频文件，请检查网络，以及视频文件是否允许跨域请求访问，m3u8文件是否存在 "+(t.response&&t.response.status?"netstatus:"+t.response.status:"")),this.notify({type:"error",code:2,timeStamp:+new Date}),o.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:o.recoverMediaError();break;default:o.destroy()}},t.prototype.__flvLoaded=function(e){if(!flvjs.isSupported())return this.notify({type:"error",code:5,timeStamp:+new Date});this.flv&&this.flv.destroy();var t=flvjs.createPlayer({type:"flv",isLive:this.player.options.live,url:e},this.options.flvConfig);t.attachMediaElement(this.el),t.on(flvjs.Events.ERROR,u.bind(this,function(e,t,n){var r={type:"error"};e==flvjs.ErrorTypes.NETWORK_ERROR&&(r.code=2),e==flvjs.ErrorTypes.MEDIA_ERROR&&(r.code=1002),flvjs.ErrorTypes.OTHER_ERROR,r.timeStamp=+new Date,this.notify(r)})),t.on(flvjs.Events.MEDIA_INFO,u.bind(this,function(e,t){})),t.on(flvjs.Events.STATISTICS_INFO,u.bind(this,function(e,t){})),this.flv=t,t.load()},t.prototype.setup=function(){this.playState=c.PlayStates.IDLE,this.seekState=c.SeekStates.IDLE,this.metaDataLoaded=!1,this.__timebase=+new Date,this.on(l.MSG.MetaLoaded,this.notify),this.on(l.MSG.Loaded,this.notify),this.on(l.MSG.Progress,this.notify),this.on(l.MSG.Play,this.notify),this.on(l.MSG.Playing,this.notify),this.on(l.MSG.Pause,this.notify),this.on(l.MSG.Error,this.notify),this.on(l.MSG.TimeUpdate,this.notify),this.on(l.MSG.Ended,this.notify),this.on(l.MSG.Seeking,this.notify),this.on(l.MSG.Seeked,this.notify),this.on(l.MSG.VolumeChange,this.notify),this.on("durationchange",this.notify),this.load(this.options.src,this.options.m3u8?u.VideoType.M3U8:"")},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.hls&&this.hls.destroy(),this.flv&&this.flv.destroy()},t.prototype.notify=function(e){var t={type:e.type,src:this,ts:+new Date,timeStamp:e.timeStamp};switch(e.type){case l.MSG.MetaLoaded:this.metaDataLoaded=!0;break;case l.MSG.Error:t.detail=this.el&&this.el.error||{code:e.code},t.detail.reason={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"}[t.detail.code];break;case l.MSG.Ended:this.pause(),this.playState=c.PlayStates.STOP;break;case"durationchange":0!=this.videoHeight()&&(t.type=l.MSG.Resize);break;case l.MSG.Playing:this.playState=e.type.toUpperCase();break;case l.MSG.Pause:this.playState=c.PlayStates.PAUSED;break;case l.MSG.Seeking:case l.MSG.Seeked:this.seekState=e.type.toUpperCase()}e.type,this.pub(t)},t.prototype.videoWidth=function(){return this.el.videoWidth},t.prototype.videoHeight=function(){return this.el.videoHeight},t.prototype.width=function(e){return e?void(this.el.style.width=e):this.el.width},t.prototype.height=function(e){return e?void(this.el.style.height=e):this.el.height},t.prototype.play=function(){this.options.hlsConfig&&!1===this.options.hlsConfig.autoStartLoad&&this.hls&&this.hls.startLoad(-1),this.el.play()},t.prototype.togglePlay=function(){this.paused()?this.play():this.pause()},t.prototype.pause=function(){this.el.pause()},t.prototype.stop=function(){this.el.pause(),this.el.currentTime=0},t.prototype.paused=function(){return this.el.paused},t.prototype.buffered=function(){return this.el.buffered.length>=1?this.el.buffered.end(this.el.buffered.length-1):0},t.prototype.currentTime=function(e){return void 0===e?this.el.currentTime:this.el.currentTime=e},t.prototype.duration=function(){return this.el.duration||0},t.prototype.mute=function(e){return void 0===e?this.el.muted:(this.volume(e?0:this.__lastVol),this.el.muted=e)},t.prototype.volume=function(e){return void 0===e?this.el.volume:(e<0&&(e=0),e>1&&(e=1),0!=e&&(this.__lastVol=e),this.el.muted=0==e,this.options.volume=e,this.el.volume=e)},t.prototype.fullscreen=function(e){return u.doFullscreen(this.player,e,this.owner)},t.prototype.load=function(e,t){this.pub({type:l.MSG.Load,src:this,ts:+new Date,detail:{src:e,type:t}});var n=e.indexOf(".m3u8")>-1||t==u.VideoType.M3U8,r=e.indexOf(".flv")>-1;if(!d.IS_ENABLED_MSE||!n&&!r||d.IS_X5TBS&&this.player.options.x5_player||n&&d.IS_MAC&&d.IS_SAFARI&&!d.IS_IOS)this.__type=t,this.el.src=e;else{var i=this,o=f[this.options.hls]||f["0.7.1"];n?(this.__type=u.VideoType.M3U8,void 0===window.Hls?s.loadScript(u.unifyProtocol(u.CDNPath+o),function(){i.__hlsLoaded.call(i,e)}):this.__hlsLoaded(e)):r&&(this.__type=u.VideoType.FLV,void 0===window.flvjs?s.loadScript(u.unifyProtocol(u.CDNPath+"libs/flv.min.1.5.js"),function(){i.__flvLoaded.call(i,e)}):this.__flvLoaded(e))}},t.prototype.playing=function(){return!this.el.paused},t.prototype.type=function(){return this.__type},t}(o.default);t.default=p},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){return t+"_"+e}function o(e,t){return t.guid&&-1==String(t.guid).indexOf("_")?e+"_"+t.guid:t.guid}t.__esModule=!0;var a=r(n(2)),s=r(n(3)),u=r(n(4)),l=r(n(1)),c=function(){function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.name=n,this.player=t,this.options=t.options,this.fnCache={},this.guid=s.guid()}return e.prototype.createEl=function(e,t,n){return this.el=a.createEl(e,t,n)},e.prototype.render=function(e){return e&&this.el&&(this.owner=e,e.appendChild(this.el),this.setup()),this.el},e.prototype.on=function(e,t,n){"string"==typeof e&&(n=t,t=e,e=this.el),this.cbs=this.cbs||{};var r=o(this.guid,n),u=!r,l=r&&!this.fnCache[r];return u||l?(n=s.bind(this,n,this.guid),this.fnCache[n.guid]=n,r=n.guid):n=this.fnCache[r],a.on(e,t,n),this.cbs[i(r,t)]={guid:r,el:e,type:t},n},e.prototype.off=function(e,t,n){"string"==typeof e&&(n=t,t=e,e=this.el),l.IS_MOBILE&&"click"==t&&(t="touchend");var r=o(this.guid,n);this.fnCache[r]&&(n=this.fnCache[r]),a.off(e,t,n),delete this.cbs[i(r,t)]},e.prototype.pub=function(e){var t=this;setTimeout(function(){u.pub(e,t.player)},0)},e.prototype.sub=function(e,t,n){u.sub(e,t,n,this.player)},e.prototype.unsub=function(e,t,n){u.unsub(e,t,n,this.player)},e.prototype.handleMsg=function(){},e.prototype.setup=function(){},e.prototype.destroy=function(){if(this.handleMsg&&this.unsub("*","*",this.handleMsg),this.cbs){for(var e in this.cbs)if(this.cbs.hasOwnProperty(e)){var t=this.cbs[e];a.off(t.el,t.type,this.fnCache[t.guid]),delete this.cbs[e]}this.fnCache=null,this.cbs=null;try{this.el.parentNode.removeChild(this.el)}catch(e){}}},e}();t.default=c},function(e,t){t.__esModule=!0,t.PlayStates={IDLE:"IDLE",PLAYING:"PLAYING",PAUSED:"PAUSED",STOP:"STOP"},t.SeekStates={IDLE:"IDLE",SEEKING:"SEEKING",SEEKED:"SEEKED"},t.ControlsStates={DEFAULT:"default",NONE:"none",SYSTEM:""}},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n(24)),o=n(4),s=r(n(2)),u=r(n(3)),l=r(n(25)),c=r(n(1)),d=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"FlashVideo")),i="vcpFlashCB_"+r.guid;return r.__flashCB=i,window[i]||(window[i]=function(e,t){t=t&&t[0];var n=window[i].fnObj&&window[i].fnObj[t.objectID];n&&n(e,t)},window[i].fnObj={}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(e){this.__timebase=+new Date;var t=this.player.options,n=u.unifyProtocol(t.flashUrl||"//imgcache.qq.com/open/qcloud/video/player/release/QCPlayer.swf"),r="opaque",i="obj_vcplayer_"+this.player.guid,o=this.__flashCB;this.__id=i;var a=s.createEl("div",{class:"vcp-video"});a.innerHTML='\n\t\t<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="" id="'+i+'" width="100%" height="100%">\n            <param name="movie"  value="'+n+'" />\n            <param name="quality" value="autohigh" />\n            <param name="swliveconnect" value="true" />\n            <param name="allowScriptAccess" value="always" />\n            <param name="bgcolor" value="#000" />\n            <param name="allowFullScreen" value="true" />\n            <param name="wmode" value="'+r+'" />\n            <param name="FlashVars" value="cbName='+o+'" />\n\n            <embed src="'+n+'" width="100%" height="100%" name="'+i+'"\n                   quality="autohigh"\n                   bgcolor="#000"\n                   align="middle" allowFullScreen="true"\n                   allowScriptAccess="always"\n                   type="application/x-shockwave-flash"\n                   swliveconnect="true"\n                   wmode="'+r+'"\n                   FlashVars="cbName='+o+'"\n                   pluginspage="http://www.macromedia.com/go/getflashplayer" >\n            </embed>\n        </object>\n\t\t',this.container=a,this.owner=e,this.owner.appendChild(a),this.cover=s.createEl("div",{class:"vcp-pre-flash"}),this.owner.appendChild(this.cover),window[this.__flashCB].fnObj[this.__id]=u.bind(this,this.notify)},t.prototype.setup=function(){this.on("error",this.notify),this.playState=l.PlayStates.IDLE,this.seekState=l.SeekStates.IDLE,this.metaDataLoaded=!1},t.prototype.doPolling=function(){this.options.live||(clearInterval(this.__timer),this.__timer=setInterval(this.interval.bind(this),1e3))},t.prototype.endPolling=function(){clearInterval(this.__timer)},t.prototype.interval=function(){var e;try{e=this.el.getState()}catch(e){return void this.endPolling()}if(this.__m3u8){var t=this.currentTime()+e.bufferLength;this.__buffered!==t&&(this.__buffered=t,this.pub({type:o.MSG.Progress,src:this,ts:+new Date})),this.__buffered>=this.duration()&&this.endPolling()}else this.__rtmp||(this.__bytesloaded!=e.bytesLoaded&&(this.__bytesloaded=e.bytesLoaded,this.pub({type:o.MSG.Progress,src:this,ts:+new Date})),this.__bytesloaded>=this.__bytesTotal&&this.endPolling())},t.prototype.destroy=function(){void 0!==this.el&&void 0!==this.el.destroy&&this.el.destroy(),this.endPolling(),delete window[this.__flashCB].fnObj[this.__id],e.prototype.destroy.call(this)},t.prototype.notify=function(e,t){var n={type:e,ts:+new Date};try{switch(this.options.debug&&this.pub({type:n.type,src:this,ts:n.ts,detail:u.extend({debug:!0},t)}),n.type){case"ready":if(this.el=function(e){return window.document[e]?window.document[e]:-1!=navigator.appName.indexOf("Microsoft Internet")?document.getElementById(e):document.embeds&&document.embeds[e]?document.embeds[e]:void 0}(this.__id),this.setup(),c.IS_FIREFOX){var r=this;setTimeout(function(){r.el.setAutoPlay(!!r.options.autoplay),r.__timebase=new Date-t.time,r.load(r.options.src)},0)}else{try{this.el.setAutoPlay(!!this.options.autoplay)}catch(e){console.warn("Flash 调用失败，请检查Flash是否启用成功")}this.__timebase=new Date-t.time,this.load(this.options.src)}return;case"metaData":if(n.type=o.MSG.MetaLoaded,this.__videoWidth=t.videoWidth,this.__videoHeight=t.videoHeight,this.__duration=t.duration,this.__bytesTotal=t.bytesTotal,this.__prevPlayState=null,this.__m3u8=t.type===u.VideoType.M3U8,this.__rtmp=t.type===u.VideoType.RTMP,this.__type=t.type,this.__metaloaded=!0,this.metaDataLoaded=!0,this.doPolling(),!(r=this).cover)break;setTimeout(function(){r.cover&&(r.owner.removeChild(r.cover),r.cover=null)},500);break;case"playState":this.playState=t.playState,t.playState==l.PlayStates.PLAYING?(this.__playing=!0,this.__stopped=!1,n.type=o.MSG.Play):t.playState==l.PlayStates.PAUSED?(this.__playing=!1,this.__stopped=!1,n.type=o.MSG.Pause):t.playState==l.PlayStates.STOP?(this.__playing=!1,this.__stopped=!0,n.type=o.MSG.Ended,this.__prevPlayState=null,this.options.live&&(this.metaDataLoaded=!1)):t.playState==l.PlayStates.IDLE&&(this.__playing=!1,this.__stopped=!0,n.type=o.MSG.Ended);break;case"seekState":if(this.seekState=t.seekState,!this.__metaloaded)return;if(t.seekState==l.SeekStates.SEEKING)n.type=o.MSG.Seeking;else{if(t.seekState!=l.SeekStates.SEEKED)return;this.__m3u8||this.options.live||t.playState!=l.PlayStates.STOP||(this.play(),this.__prevPlayState=t.playState),this.__m3u8&&(n.type=o.MSG.Seeked)}break;case"netStatus":this.options.live||("NetStream.Buffer.Full"==t.code?(this.__prevPlayState==l.PlayStates.PAUSED||(this.__prevPlayState,l.PlayStates.STOP),this.__prevPlayState=null,n.type=o.MSG.Seeked):t.code),"NetConnection.Connect.Closed"==t.code&&(this.options.src.indexOf("rtmp://")>-1?this.playState==l.PlayStates.STOP?(n.type="error",t={code:13,reason:t.code}):(n.type="error",t={code:1002,reason:t.code}):this.playState=l.PlayStates.IDLE),"NetStream.Play.Stop"!=t.code&&"NetConnection.Connect.Success"!=t.code&&"NetConnection.Connect.Failed"!=t.code||(this.playState=l.PlayStates.IDLE);break;case"mediaTime":this.__videoWidth=t.videoWidth,this.__videoHeight=t.videoHeight,n.type=o.MSG.TimeUpdate;break;case"error":if("NetStream.Seek.InvalidTime"==t.code)return this.currentTime(t.details),!1;"NetStream.Play.StreamNotFound"==t.code&&this.pub({type:"netStatus",src:this,ts:n.ts,detail:t});var i=isNaN(parseInt(t.code))?1002:t.code,a=isNaN(parseInt(t.code))?t.code:t.msg,s=a.match(/#(\d+)/);s&&s[1]&&(i=s[1]),t={code:i,reason:a||""},this.metaDataLoaded=!1}"printLog"!=e&&"canPlay"!=e&&this.pub({type:n.type,src:this,ts:n.ts,detail:t})}catch(t){u.console.error(e+" "+n.type,t)}},t.prototype.handleMsg=function(e){},t.prototype.videoWidth=function(){return this.__videoWidth},t.prototype.videoHeight=function(){return this.__videoHeight},t.prototype.width=function(e){return void 0===e?this.el&&this.el.width:(e="100%",this.el&&(this.el.width=e))},t.prototype.height=function(e){return void 0===e?this.el&&this.el.height:(e="100%",this.el&&(this.el.height=e))},t.prototype.play=function(e){this.playState==l.PlayStates.PAUSED||this.playState==l.PlayStates.PLAYING||e?this.el.playerResume():this.playState!=l.PlayStates.PLAYING&&this.el.playerPlay()},t.prototype.togglePlay=function(){if(this.metaDataLoaded)if(this.playState==l.PlayStates.PAUSED)this.el.playerResume();else if(this.playState==l.PlayStates.PLAYING)this.el.playerPause();else if(this.playState==l.PlayStates.STOP)this.currentTime(0),this.el.playerResume();else try{this.el.playerPlay()}catch(e){console.warn("Flash 调用失败，请检查Flash是否启用成功")}else this.player.load()},t.prototype.pause=function(){this.el.playerPause()},t.prototype.stop=function(){this.el.playerStop()},t.prototype.paused=function(){return!this.__playing},t.prototype.buffered=function(){var e;return this.__m3u8?this.__buffered||0:(e=(this.__bytesloaded||0)/(this.__bytesTotal||1),this.duration()*e)},t.prototype.currentTime=function(e){return void 0===e?this.el.getPosition():void this.el.playerSeek(e)},t.prototype.duration=function(){return this.__duration},t.prototype.mute=function(e){return void 0===e?0==this.volume():void this.volume(e?0:this.__lastVol)},t.prototype.volume=function(e){return void 0===e?this.el&&this.el.getState().volume:(this.el&&this.el.playerVolume(e),0!=e&&(this.__lastVol=e),this.options.volume=e,void this.pub({type:o.MSG.VolumeChange,src:this,ts:+new Date}))},t.prototype.fullscreen=function(e){return u.doFullscreen(this.player,e,this.owner)},t.prototype.load=function(e,t){this.pub({type:o.MSG.Load,src:this,ts:+new Date,detail:{src:e,type:t}}),this.el&&this.el.playerLoad(e)},t.prototype.playing=function(){return this.el&&this.el.getState&&this.el.getState().playState===l.PlayStates.PLAYING},t.prototype.type=function(){return this.__type},t.prototype.state=function(){return this.playState},t}(i.default);t.default=d},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var o=i(n(24)),s=i(n(28)),u=i(n(29)),l=n(30),c=i(n(31)),d=i(n(32)),f=i(n(33)),p=i(n(34)),h=n(4),g=r(n(2)),v=r(n(3)),m=r(n(1)),y=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"Panel"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(t){return this.createEl("div",{class:"vcp-controls-panel"}),this.el.appendChild(g.createEl("div",{class:"vcp-panel-bg"})),this.playToggle=new s.default(this.player),this.playToggle.render(this.el),this.timelabel=new d.default(this.player),this.timelabel.render(this.el),this.timeline=new c.default(this.player),this.timeline.render(this.el),!0===this.options.fullscreenEnabled&&(this.fullscreen=new u.default(this.player),this.fullscreen.render(this.el)),m.IS_MOBILE||(this.volume=new f.default(this.player),this.volume.render(this.el)),this.options.videoSource&&this.options.videoSource.definitions.length>1&&!m.IS_MOBILE&&(this.claritySwitcher=new p.default(this.player),this.claritySwitcher.render(this.el)),e.prototype.render.call(this,t)},t.prototype.setup=function(){var e=v.bind(this,this.handleMsg);this.sub(l.MSG.Changing,this.volume,e),this.sub(l.MSG.Changed,this.timeline.progress,e),this.sub(h.MSG.TimeUpdate,this.player.video,e),this.sub(h.MSG.Progress,this.player.video,e),this.sub(h.MSG.MetaLoaded,this.player.video,e),this.sub(h.MSG.Pause,this.player.video,e),this.sub(h.MSG.Play,this.player.video,e),this.sub(h.MSG.Ended,this.player.video,e)},t.prototype.handleMsg=function(e){switch(e.type){case h.MSG.MetaLoaded:this.timeline.percent(this.player.percent()),this.timeline.buffered(this.player.buffered()),this.player.volume(void 0===this.options.volume?.5:this.options.volume),!this.options.autoplay&&this.show();break;case h.MSG.TimeUpdate:this.timeline.scrubbing||this.timeline.percent(this.player.percent());break;case h.MSG.Pause:this.show();break;case h.MSG.Play:this.hide();break;case h.MSG.Progress:this.timeline.buffered(this.player.buffered());break;case l.MSG.Changed:e.src===this.timeline.progress&&this.player.percent(this.timeline.percent());break;case h.MSG.Ended:this.show()}},t.prototype.toggle=function(){g.hasClass(this.el,"show")?this.hide():this.show()},t.prototype.show=function(){g.hasClass(this.el,"hide")&&(g.removeClass(this.el,"hide"),g.addClass(this.el,"show"))},t.prototype.hide=function(){g.removeClass(this.el,"show"),g.addClass(this.el,"hide")},t}(o.default);t.default=y},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n(24)),o=(r(n(2)),n(4)),s=(r(o),n(3)),u=(r(s),n(25)),l=(r(u),function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"PlayToggle"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(t){return this.createEl("div",{class:"vcp-playtoggle"}),e.prototype.render.call(this,t)},t.prototype.setup=function(){this.on("click",this.onClick)},t.prototype.onClick=function(){this.player.togglePlay()},t.prototype.handleMsg=function(e){console.log("@"+this.name,e)},t}(i.default));t.default=l},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n(24)),o=(r(n(2)),n(4)),s=(r(o),n(3)),u=r(s),l=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"FullscreenToggle"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(t){return this.createEl("div",{class:"vcp-fullscreen-toggle"}),window.fsApi=u.FullscreenApi,e.prototype.render.call(this,t)},t.prototype.setup=function(){this.on("click",this.onClick)},t.prototype.onClick=function(){this.player.fullscreen(!this.player.fullscreen())},t.prototype.handleMsg=function(e){console.log(t.name,e)},t}(i.default);t.default=l},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0,t.MSG=void 0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n(24)),o=r(n(2)),s=(r(n(4)),n(3)),u=(r(s),t.MSG={Changing:"sliderchanging",Changed:"sliderchanged"}),l=function(e){function t(n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"Slider"));return i.vertical=r||!1,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(t,n){var r=this.vertical?"vcp-slider-vertical":"vcp-slider";return this.createEl("div",{class:r}),this.track=o.createEl("div",{class:"vcp-slider-track"}),this.thumb=o.createEl("div",{class:"vcp-slider-thumb"}),this.el.appendChild(this.track),this.el.appendChild(this.thumb),this.enabled=void 0===n||n,e.prototype.render.call(this,t)},t.prototype.setup=function(){this.enabled&&(this.ownerDoc=document.body.ownerDocument,this.on("mousedown",this.mousedown),this.on("touchstart",this.mousedown))},t.prototype.handleMsg=function(e){},t.prototype.mousedown=function(e){return e.preventDefault&&e.preventDefault(),this.pos=o.findElPosition(this.el),this.on(this.ownerDoc,"mouseup",this.mouseup),this.on(this.ownerDoc,"mousemove",this.mousemove),this.on(this.ownerDoc,"touchend",this.mouseup),this.on(this.ownerDoc,"touchmove",this.mousemove),this.mousemove(e),!1},t.prototype.mouseup=function(e){e.target||e.srcElement,this.off(this.ownerDoc,"mouseup",this.mouseup),this.off(this.ownerDoc,"mousemove",this.mousemove),this.off(this.ownerDoc,"touchend",this.mouseup),this.off(this.ownerDoc,"touchmove",this.mousemove),this.pub({type:u.Changed,src:this,private:!0})},t.prototype.mousemove=function(e){var t=o.getPointerPosition(this.el,e,this.pos);this.vertical?(this.__percent=1-t.y,this.thumb.style.top=100*this.__percent+"%"):(this.__percent=t.x,this.thumb.style.left=100*this.__percent+"%"),this.__percent=Number(this.__percent.toFixed(3)),this.pub({type:u.Changing,src:this,private:!0})},t.prototype.percent=function(e){return e||0==e?(this.__percent=e,void(this.vertical?this.thumb.style.top=100*this.__percent+"%":this.thumb.style.left=100*this.__percent+"%")):this.__percent},t}(i.default);t.default=l},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var o=n(30),s=i(o),u=i(n(24)),l=(r(n(2)),n(3)),c=r(l),d=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"Timeline"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(t){return this.enabled=!this.options.live,this.createEl("div",{class:"vcp-timeline"}),this.progress=new s.default(this.player,!1),this.progress.render(this.el,this.enabled),this.track=this.progress.track,this.enabled||(this.el.style.display="none"),e.prototype.render.call(this,t)},t.prototype.setup=function(){this.enabled&&(this.sub(o.MSG.Changing,this.progress,c.bind(this,this.handleMsg)),this.sub(o.MSG.Changed,this.progress,c.bind(this,this.handleMsg)))},t.prototype.handleMsg=function(e){e.type===o.MSG.Changing?(this.scrubbing=!0,this.syncLabel(this.percent())):e.type===o.MSG.Changed&&(this.scrubbing=!1)},t.prototype.syncLabel=function(e){var t=this.player.duration();e=Math.min(e,1);var n="";t&&(n=c.convertTime(e*t)+" / "+c.convertTime(t)),this.pub({type:"timelabel",src:"timeline",label:n,private:!0})},t.prototype.buffered=function(e){this.enabled&&(e=Math.min(e,1),this.__buffered=e,this.track.style.width=100*e+"%")},t.prototype.percent=function(e){if(this.enabled)return void 0===e?this.progress.percent()||0:(e=Math.min(e,1),this.syncLabel(e),this.__buffered<e&&this.buffered(this.player.buffered()),this.progress.percent(e))},t}(u.default);t.default=d},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var o=(i(n(30)),n(24)),s=i(o),u=(r(n(2)),n(3)),l=r(u),c=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"Timelabel"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(t){return this.createEl("span",{class:"vcp-timelabel"}),e.prototype.render.call(this,t)},t.prototype.setup=function(){this.sub("timelabel","timeline",l.bind(this,this.handleMsg))},t.prototype.handleMsg=function(e){this.el.innerHTML=e.label},t}(s.default);t.default=c},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var o=n(30),s=i(o),u=i(n(24)),l=r(n(2)),c=r(n(3)),d=n(4),f=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"Volume"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(t){return this.createEl("div",{class:"vcp-volume"}),this.bg=l.createEl("div",{class:"vcp-volume-bg"}),this.el.appendChild(this.bg),this.volume=new s.default(this.player,!0),this.volume.render(this.el),this.track=this.volume.track,this.icon=l.createEl("span",{class:"vcp-volume-icon"}),this.el.appendChild(this.icon),e.prototype.render.call(this,t)},t.prototype.setup=function(){this.sub(o.MSG.Changing,this.volume,c.bind(this,this.handleMsg)),this.sub(o.MSG.Changed,this.volume,c.bind(this,this.handleMsg)),this.sub(d.MSG.VolumeChange,this.player.video,c.bind(this,this.handleMsg)),this.on(this.icon,"click",this.toggleMute)},t.prototype.handleMsg=function(e){switch(e.type){case o.MSG.Changing:this.syncTrack(this.percent());break;case o.MSG.Changed:this.percent(this.percent());break;case d.MSG.VolumeChange:var t=this.player.volume();this.syncTrack(t),0==t?this.syncMute(!0):t>0&&this.__muted&&this.syncMute(!1)}},t.prototype.toggleMute=function(e){var t=!this.player.mute();this.player.mute(t)},t.prototype.syncMute=function(e){e?l.addClass(this.el,"vcp-volume-muted"):l.removeClass(this.el,"vcp-volume-muted"),this.__muted=e},t.prototype.syncTrack=function(e){this.track.style.height=100*e+"%",this.volume.percent(1-e)},t.prototype.percent=function(e){return void 0===e?1-this.volume.percent()||0:(this.player.volume(e),e)},t}(u.default);t.default=f},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n(24)),o=r(n(2)),s=r(n(3)),u={od:"超清",hd:"高清",sd:"标清"},l=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"ClaritySwitcher"));return u=s.extend({},n.options.clarityLabel,u),n.claritySwitcher=r,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(t){this.show=!1,this.createEl("div",{class:"vcp-clarityswitcher"}),this.current=o.createEl("a",{class:"vcp-vertical-switcher-current"}),this.container=o.createEl("div",{class:"vcp-vertical-switcher-container"}),this.items=[],this.currentItem="";var n=this.options.videoSource;this.current.innerHTML=u[n.curDef],this.el.appendChild(this.current);for(var r=0;r<n.definitions.length;r++){var i=o.createEl("a",{class:"vcp-vertical-switcher-item"});i.innerHTML=u[n.definitions[r]],n.definitions[r]==n.curDef&&(o.addClass(i,"current"),this.currentItem=i),i.setAttribute("data-def",n.definitions[r]),this.items.push(i),this.container.appendChild(i)}return this.el.appendChild(this.container),e.prototype.render.call(this,t)},t.prototype.setup=function(){this.on("click",this.onClick),this.on("mouseenter",this.onMouseEnter),this.on("mouseleave",this.onMouseLeave)},t.prototype.onClick=function(e){var t=e.target.getAttribute("data-def");t?(this.current.innerHTML=u[t],o.removeClass(this.currentItem,"current"),o.addClass(e.target,"current"),this.currentItem=e.target,this.player._switchClarity(t)):this.show},t.prototype.onMouseLeave=function(){this.container.style.display="none",this.show=!1},t.prototype.onMouseEnter=function(){this.container.style.display="block",this.show=!0},t.prototype.setClarity=function(e){e&&(this.current.innerHTML=u[e],o.removeClass(document.querySelector(".vcp-vertical-switcher-item.current"),"current"),o.addClass(document.querySelector('.vcp-vertical-switcher-item[data-def="'+e+'"]'),"current"),this.currentItem=document.querySelector('.vcp-vertical-switcher-item[data-def="'+e+'"]'),this.player._switchClarity(e))},t}(i.default);t.default=l},function(e,t,n){t.__esModule=!0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n(24)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(1)),o=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"BigPlay"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(t){return this.createEl("div",{class:"vcp-bigplay"}),e.prototype.render.call(this,t)},t.prototype.setup=function(){this.on("click",this.onClick)},t.prototype.onClick=function(){var e=this.player.video;return i.IS_MOBILE&&!e.paused()?this.player.panel&&this.player.panel.toggle():void this.player.togglePlay()},t.prototype.handleMsg=function(e){console.log("@"+this.name,e)},t}(r.default);t.default=o},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0;var i="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)},o=function(e){return e&&e.__esModule?e:{default:e}}(n(24)),s=r(n(2)),u=r(n(3)),l=r(n(1)),c=n(4),d=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"Poster"));return r.options.poster&&"object"==i(r.options.poster)?r.poster=r.options.poster:"string"==typeof r.options.poster?r.poster={src:r.options.poster}:r.poster={},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(t){if(this.createEl("div",{class:"vcp-poster"}),this.hide(),this.poster){switch(this.pic=s.createEl("img",{class:"vcp-poster-pic"}),this.poster.style){case"stretch":s.addClass(this.pic,"stretch");break;case"cover":s.addClass(this.pic,"cover");break;default:s.addClass(this.pic,"default")}this.el.appendChild(this.pic)}return e.prototype.render.call(this,t)},t.prototype.setup=function(){this.on("click",this.onClick),this.sub(c.MSG.Load,this.player.video,u.bind(this,this.handleMsg)),this.sub(c.MSG.MetaLoaded,this.player.video,u.bind(this,this.handleMsg)),this.sub(c.MSG.Play,this.player.video,u.bind(this,this.handleMsg)),this.sub(c.MSG.Pause,this.player.video,u.bind(this,this.handleMsg)),this.sub(c.MSG.Ended,this.player.video,u.bind(this,this.handleMsg)),this.sub(c.MSG.Error,this.player.video,u.bind(this,this.handleMsg))},t.prototype.onClick=function(){this.pub({type:"click",src:this}),(l.IS_SAFARI&&parseInt(l.SAFARI_VERSION)>10||l.IOS_VERSION>10)&&"system"==this.player.options.controls&&this.player.togglePlay()},t.prototype.handleMsg=function(e){switch(e.type){case c.MSG.Load:this.__loaded=!1,this.setPoster(this.poster.start);break;case c.MSG.MetaLoaded:if(this.__loaded=!0,!this.player.playing())break;this.hide();case c.MSG.Play:if(!this.__loaded)break;this.hide();break;case c.MSG.Pause:if(!this.__loaded)break;!0===this.options.pausePosterEnabled&&this.setPoster(this.poster.pause);break;case c.MSG.Ended:if(!this.__loaded)break;break;case c.MSG.Error:if(!this.__loaded)break}},t.prototype.setPoster=function(e){if(e=e||this.poster.src){this.__preload&&(this.__preload.onload=null),this.__preload=new Image;var t=this.__preload;this.hide();var n=this;t.onload=function(){if(n.pic.src!==t.src&&(n.pic.src=t.src,n.show(),!u.supportStyle("transform"))){if("stretch"==n.poster.style)return;var e="cover"==n.poster.style?n.options.width/(t.width/t.height):t.height,r="-"+n.options.width/2+"px",i="-"+e/2+"px";n.pic.style.cssText="left: 50%; top: 50%; margin-left: "+r+"; margin-top: "+i+";"}},t.src=e}},t.prototype.toggle=function(e){clearTimeout(this.__tid);var t=this;this.__tid=setTimeout(function(){t.el.style.display=e},100)},t.prototype.hide=function(){this.__preload&&(this.__preload.onload=null),this.toggle("none")},t.prototype.show=function(){this.toggle("block")},t}(o.default);t.default=d},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n(24)),o=(r(n(2)),n(4)),s=(r(o),n(3)),u=(r(s),function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"Loading"));return r.timeSeed=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(t){return this.createEl("div",{class:"vcp-loading"}),e.prototype.render.call(this,t)},t.prototype.setup=function(){},t.prototype.handleMsg=function(e){},t.prototype.show=function(){if(!1!==this.options.showLoading){var e=this;this.timeSeed=setTimeout(function(){e.el.style.display="block"},500)}},t.prototype.hide=function(){this.timeSeed&&(clearTimeout(this.timeSeed),this.timeSeed=null),this.el.style.display="none"},t}(i.default));t.default=u},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n(24)),o=(r(n(2)),n(4)),s=(r(o),n(3)),u=r(s),l={EnvError:"当前系统环境不支持播放该视频格式",EnvFlashError:"当前系统环境不支持播放该视频格式",VideoSourceError:"获取视频失败，请检查播放链接是否有效",NetworkError:"网络错误，请检查网络配置或者播放链接是否正确",VideoDecodeError:"视频解码错误",ArgumentError:"使用参数有误，请检查播放器调用代码",UrlEmpty:"请填写视频播放地址",FileProtocol:"请勿在file协议下使用播放器，可能会导致视频无法播放",LiveFinish:"直播已结束,请稍后再来",CrossDomainError:"无法加载视频文件，跨域访问被拒绝",Ie9IframeFullscreenError:"在IE9中用iframe引用的实例无法支持全屏"},c={FileProtocol:[10],ArgumentError:[11],UrlEmpty:[12],LiveFinish:[13],VideoSourceError:[1002,2032],EnvError:[4,5],NetworkError:[1001,1,2],VideoDecodeError:[3],CrossDomainError:[2048],Ie9IframeFullscreenError:[10001]},d=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=a(t)&&"function"!=typeof t?e:t}(this,e.call(this,n,"ErrorTips"));for(var i in r.customTips=u.extend({},l,r.options.wording),c)for(var o=0;o<c[i].length;o++){var s=c[i][o];r.customTips[s]=r.customTips[s]||r.customTips[i]}return r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+a(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(t){return this.createEl("div",{class:"vcp-error-tips"}),e.prototype.render.call(this,t)},t.prototype.setup=function(){},t.prototype.handleMsg=function(e){},t.prototype.show=function(e){this.el.style.display="block";var t=void 0;if("string"==typeof e)t=e;else{var n=this.customTips[e.code]||e.reason;t="["+e.code+"]"+n}this.el.innerHTML=u.escapeHTML(t)},t.prototype.hide=function(){this.el.style.display="none"},t.prototype.clear=function(){this.el.innerHTML="",this.hide()},t}(i.default);t.default=d},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0;var i=r(n(1)),o=r(n(2)),a=n(3),s=function(){function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.player=t,this.options=n,this.load()}return e.prototype.load=function(){o.loadScript((0,a.unifyProtocol)("//pingjs.qq.com/h5/stats.js?v2.0.4"),null,{name:"MTAH5",sid:"500376528",cid:"500383222"},!0)},e.prototype.report=function(){window.MtaH5&&(0==this.player.duration()||this.player.duration()==1/0?MtaH5.clickStat("live",{live:"true"}):MtaH5.clickStat("vod",{vod:"true"}))},e.prototype.reportFlash=function(){if(window.MtaH5){var e=this.options.videoSource,t=(0,a.getFormat)(e),n={browser:i.BROWSER_TYPE,mse:!!i.IS_ENABLED_MSE,format:t};MtaH5.clickStat("flash",n)}},e}();t.default=s}])});(qc=Hc)&&qc.__esModule&&Object.prototype.hasOwnProperty.call(qc,"default")&&qc.default;var zc=Hc.TcPlayer,Kc=function(){function e(t){l(this,e),this._holder=t,this._player=null,this._elementID="",this._isPlaying=!1,this._loadTS=0}var t,n,r,i;return d(e,[{key:"setLogLevel",value:function(){}},{key:"setRenderView",value:function(e){this._elementID=e}},{key:"startPlay",value:function(e){this._player&&this.stop(),this._player=new zc(this._elementID,h({listener:this._playerListener.bind(this),preload:"auto",flash:!1,live:!0,h5_flv:!0,x5_player:!0,x5_type:"h5-page"},e)),!0===e.autoplay&&this._player.play(),this.setVolume(1)}},{key:"isPlaying",value:function(){return this._isPlaying}},{key:"_playerListener",value:function(e){switch(e.type){case"load":ds.log("CdnStreamPlayer._playerListener load"),0===this._loadTS&&(this._loadTS=Date.now());break;case"loadeddata":var t=Date.now()-this._loadTS;ds.log("CdnStreamPlayer._playerListener loadeddata, firstFrameTime=".concat(t,"ms")),this._isPlaying=!0;break;case"ended":break;case"error":this._isPlaying=!1,this._holder.emit(fs.PLAYER_ERROR,e.detail);break;case"play":case"playing":this._isPlaying=!0,this._holder.emit(fs.PLAYER_PLAYING);break;case"pause":this._isPlaying=!1,this._holder.emit(fs.PLAYER_PAUSE);break;case"waiting":this._holder.emit(fs.PLAYER_WAITING)}}},{key:"pauseVideo",value:(i=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._player&&(this._player.pause(),this._isPlaying=!1);case 1:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"resumeVideo",value:(r=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._player&&(this._player.play(),this._isPlaying=!0);case 1:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"muteAudio",value:(n=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._player&&this._player.mute(!0);case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"unmuteAudio",value:(t=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._player&&this._player.mute(!1);case 1:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"setVolume",value:function(e){this._player&&this._player.volume(e)}},{key:"stop",value:function(){this._player&&(this._player.stop(),this._player=null,this._loadTS=0);var e=document.getElementById(this._elementID);if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}}]),e}(),Wc=function(){function e(t){l(this,e),this._holder=t,this._client=null,this._stream=null,this._elementID="",this._remoteStream=null,this._isJoined=!1,this._isPlaying=!1}var t,n,r,o,a;return d(e,[{key:"setLogLevel",value:function(e){-1===e?i.default.Logger.setLogLevel(i.default.Logger.LogLevel.TRACE):0===e?i.default.Logger.setLogLevel(i.default.Logger.LogLevel.DEBUG):1===e?i.default.Logger.setLogLevel(i.default.Logger.LogLevel.INFO):2===e?i.default.Logger.setLogLevel(i.default.Logger.LogLevel.WARN):3===e?i.default.Logger.setLogLevel(i.default.Logger.LogLevel.ERROR):4===e&&i.default.Logger.setLogLevel(i.default.Logger.LogLevel.NONE)}},{key:"_initListeners",value:function(){var e=this;this._client.on("stream-added",function(t){var n=t.stream;ds.log("WebrtcStreamPlayer stream-added: "+n.getId()),e._client.subscribe(n)}),this._client.on("stream-subscribed",function(t){e._remoteStream=t.stream,e._remoteStream.on("player-state-changed",function(t){"PAUSED"===t.state&&e._remoteStream.resume()}),ds.log("WebrtcStreamPlayer stream-subscribed: "+e._remoteStream.getId());var n=document.getElementById(e._elementID);if(n)for(;n.firstChild;)n.removeChild(n.firstChild);e._remoteStream.play(e._elementID).then(function(){e._isPlaying=!0}).catch(function(t){16451===t.getCode()&&e._holder.emit(fs.PLAYER_AUTOPLAY_NOT_ALLOWED)})}),this._client.on("connection-state-changed",function(t){e._holder.emit(fs.RTC_CONNECTION_STATE_CHANGED,t)}),this._client.on("client-banned",function(t){e._holder.emit(fs.RTC_CLIENT_BANNED,t)}),this._client.on("error",function(t){e._holder.emit(fs.RTC_ERROR,t)}),this._client.on("network-quality",function(t){e._holder.emit(fs.RTC_NETWORK_QUALITY,t)})}},{key:"setRenderView",value:function(e){this._elementID=e}},{key:"startPlay",value:(a=u(regeneratorRuntime.mark(function e(t){var n,r,o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.substring("room://".length).split("&").forEach(function(e){e.startsWith("roomid=")?n=parseInt(e.substring("roomid=".length)):e.startsWith("sdkappid=")?r=parseInt(e.substring("sdkappid=".length)):e.startsWith("userid=")?o=e.substring("userid=".length):e.startsWith("usersig=")&&(a=e.substring("usersig=".length))}),this._userID=o,ds.log("WebrtcStreamPlayer.startPlay roomID:".concat(n," SDKAppID:").concat(r," userID:").concat(o)),null===this._client&&(this._client=i.default.createClient({sdkAppId:r,userId:o,userSig:a,mode:"live"}),this._initListeners()),!this._isJoined||!this._remoteStream||this._isPlaying){e.next=11;break}return e.next=8,this._remoteStream.play(this._elementID);case 8:return s=e.sent,this._isPlaying=!0,e.abrupt("return",s);case 11:return e.next=13,this._client.join({roomId:n,role:"audience"});case 13:return u=e.sent,this._isJoined=!0,e.abrupt("return",u);case 16:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"isPlaying",value:function(){return this._isPlaying}},{key:"muteAudio",value:(o=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._remoteStream){e.next=4;break}if(!0===this._remoteStream.muteAudio()){e.next=4;break}return e.abrupt("return",Promise.reject(new Error("No Audio Track!")));case 4:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"unmuteAudio",value:(r=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._remoteStream){e.next=4;break}if(!0===this._remoteStream.unmuteAudio()){e.next=4;break}return e.abrupt("return",Promise.reject(new Error("No Audio Track!")));case 4:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"pauseVideo",value:(n=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._remoteStream){e.next=6;break}if(!0!==this._remoteStream.muteVideo()){e.next=5;break}return this._isPlaying=!1,e.abrupt("return");case 5:return e.abrupt("return",Promise.reject(new Error("No Video Track!")));case 6:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"resumeVideo",value:(t=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._remoteStream){e.next=6;break}if(!0!==this._remoteStream.unmuteVideo()){e.next=5;break}return this._isPlaying=!0,e.abrupt("return");case 5:return e.abrupt("return",Promise.reject(new Error("No Video Track!")));case 6:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"setVolume",value:function(e){this._remoteStream&&this._remoteStream.setAudioVolume(e)}},{key:"stop",value:function(){this._remoteStream&&(this._remoteStream.stop(),this._isPlaying=!1)}}]),e}(),Yc=function(){function e(){l(this,e),this._player=null,this._elementID="",this._customConfig={},this._logLevel=1,this._safetyCallbackFactory=new ps,this._outerEmitter=new ji,this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(e,t){var n=arguments[0],r=[n,{name:arguments[0],data:arguments[1]}];this._outerEmitter._emit.apply(this._outerEmitter,r)}.bind(this)}var t,n,r,i,o;return d(e,[{key:"on",value:function(e,t,n){this._outerEmitter.on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"off",value:function(e,t,n){this._outerEmitter.off(e,t,n)}},{key:"emit",value:function(e,t){this._outerEmitter.emit(e,t)}},{key:"setLogLevel",value:function(e){this._logLevel=e,this._player&&this._player.setLogLevel(e)}},{key:"setCustomConfig",value:function(e){Object.assign(this._customConfig,e),ds.log("Player.setCustomConfig customConfig:",this._customConfig)}},{key:"setRenderView",value:function(e){this._elementID=e.elementID}},{key:"startPlay",value:(o=u(regeneratorRuntime.mark(function e(t){var n,r,i,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ds.log("Player.startPlay url:".concat(t)),!t.startsWith("room://")){e.next=7;break}return null===this._player&&(this._player=new Wc(this),this._player.setLogLevel(this._logLevel),this._player.setRenderView(this._elementID)),Ts.clickStat("start_play",{value:1}),e.next=6,this._player.startPlay(t);case 6:return e.abrupt("return",e.sent);case 7:if(!t.startsWith("https://")){e.next=23;break}return null===this._player&&(this._player=new Kc(this),this._player.setLogLevel(this._logLevel),this._player.setRenderView(this._elementID)),Ts.clickStat("start_play",{value:2}),n=t.substring("https://".length),r="",i="",n.startsWith("flv=")?(o=n.split("&hls="),i=decodeURIComponent(o[0].substring("flv=".length)),o.length>1&&(r=decodeURIComponent(o[1]))):n.startsWith("hls=")&&(a=n.split("&flv="),r=decodeURIComponent(a[0].substring("hls=".length)),a.length>1&&(i=decodeURIComponent(a[1]))),ds.log("Player.startPlay flv:".concat(i,", hls:").concat(r)),s={},ns(this._customConfig.wording)&&(s.wording=this._customConfig.wording),ts(this._customConfig.poster)&&(s.poster=this._customConfig.poster),es(this._customConfig.width)&&(s.width=this._customConfig.width),es(this._customConfig.height)&&(s.height=this._customConfig.height),is(this._customConfig.autoplay)&&(s.autoplay=this._customConfig.autoplay),this._player.startPlay(h({flv:i,m3u8:r},s)),e.abrupt("return",Promise.resolve());case 23:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"isPlaying",value:function(){if(this._player)return this._player.isPlaying()}},{key:"pauseAudio",value:(i=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._player){e.next=4;break}return e.next=3,this._player.muteAudio();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"resumeAudio",value:(r=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._player){e.next=4;break}return e.next=3,this._player.unmuteAudio();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"pauseVideo",value:(n=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._player){e.next=4;break}return e.next=3,this._player.pauseVideo();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"resumeVideo",value:(t=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._player){e.next=4;break}return e.next=3,this._player.resumeVideo();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"setPlayoutVolume",value:function(e){es(e)||(e=100),this._player&&this._player.setVolume(e/100)}},{key:"stopPlay",value:function(){this._player&&this._player.stop()}}]),e}();console.info("TWebLive Version: ".concat("1.1.0"));var Jc=null;return function(){function e(){l(this,e)}return d(e,null,[{key:"createPusher",value:function(e){return console.warn("TWebLive v1.1.0起，createPusher 前接入侧需要手动安装依赖 trtc-js-sdk，详细请参考：https://webim-1252463788.cos.ap-shanghai.myqcloud.com/tweblive/TWebLive.html"),new Cs(e)}},{key:"createPlayer",value:function(e){return new Yc(e)}},{key:"createIM",value:function(e){return console.warn("TWebLive v1.1.0起，createIM 前接入侧需要手动安装依赖 tim-js-sdk，详细请参考：https://webim-1252463788.cos.ap-shanghai.myqcloud.com/tweblive/TWebLive.html"),null===Jc&&(Jc=new mu(e)),Jc}},{key:"EVENT",get:function(){return fs}},{key:"TYPES",get:function(){return g}}]),e}()}(n(1504),n(1193))}).call(this,n(61))},1193:function(e,t,n){(function(t){e.exports=function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};function n(e,t){return e(t={exports:{}},t.exports),t.exports}var r=function(e){return e&&e.Math==Math&&e},i=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof e&&e)||Function("return this")(),o=function(e){try{return!!e()}catch(e){return!0}},a=!o(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),s={}.propertyIsEnumerable,u=Object.getOwnPropertyDescriptor,l={f:u&&!s.call({1:2},1)?function(e){var t=u(this,e);return!!t&&t.enumerable}:s},c=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},d={}.toString,f=function(e){return d.call(e).slice(8,-1)},p="".split,h=o(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==f(e)?p.call(e,""):Object(e)}:Object,g=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},v=function(e){return h(g(e))},m=function(e){return"object"==typeof e?null!==e:"function"==typeof e},y=function(e,t){if(!m(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!m(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!m(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!m(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},_={}.hasOwnProperty,b=function(e,t){return _.call(e,t)},S=i.document,k=m(S)&&m(S.createElement),w=function(e){return k?S.createElement(e):{}},E=!a&&!o(function(){return 7!=Object.defineProperty(w("div"),"a",{get:function(){return 7}}).a}),T=Object.getOwnPropertyDescriptor,x={f:a?T:function(e,t){if(e=v(e),t=y(t,!0),E)try{return T(e,t)}catch(e){}if(b(e,t))return c(!l.f.call(e,t),e[t])}},C=function(e){if(!m(e))throw TypeError(String(e)+" is not an object");return e},I=Object.defineProperty,R={f:a?I:function(e,t,n){if(C(e),t=y(t,!0),C(n),E)try{return I(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},A=a?function(e,t,n){return R.f(e,t,c(1,n))}:function(e,t,n){return e[t]=n,e},O=function(e,t){try{A(i,e,t)}catch(n){i[e]=t}return t},M=i["__core-js_shared__"]||O("__core-js_shared__",{}),D=Function.toString;"function"!=typeof M.inspectSource&&(M.inspectSource=function(e){return D.call(e)});var L,P,N,U=M.inspectSource,F=i.WeakMap,j="function"==typeof F&&/native code/.test(U(F)),G=n(function(e){(e.exports=function(e,t){return M[e]||(M[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})}),B=0,V=Math.random(),q=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++B+V).toString(36)},H=G("keys"),z=function(e){return H[e]||(H[e]=q(e))},K={},W=i.WeakMap;if(j){var Y=new W,J=Y.get,X=Y.has,Q=Y.set;L=function(e,t){return Q.call(Y,e,t),t},P=function(e){return J.call(Y,e)||{}},N=function(e){return X.call(Y,e)}}else{var Z=z("state");K[Z]=!0,L=function(e,t){return A(e,Z,t),t},P=function(e){return b(e,Z)?e[Z]:{}},N=function(e){return b(e,Z)}}var $,ee,te={set:L,get:P,has:N,enforce:function(e){return N(e)?P(e):L(e,{})},getterFor:function(e){return function(t){var n;if(!m(t)||(n=P(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},ne=n(function(e){var t=te.get,n=te.enforce,r=String(String).split("String");(e.exports=function(e,t,o,a){var s=!!a&&!!a.unsafe,u=!!a&&!!a.enumerable,l=!!a&&!!a.noTargetGet;"function"==typeof o&&("string"!=typeof t||b(o,"name")||A(o,"name",t),n(o).source=r.join("string"==typeof t?t:"")),e!==i?(s?!l&&e[t]&&(u=!0):delete e[t],u?e[t]=o:A(e,t,o)):u?e[t]=o:O(t,o)})(Function.prototype,"toString",function(){return"function"==typeof this&&t(this).source||U(this)})}),re=i,ie=function(e){return"function"==typeof e?e:void 0},oe=function(e,t){return arguments.length<2?ie(re[e])||ie(i[e]):re[e]&&re[e][t]||i[e]&&i[e][t]},ae=Math.ceil,se=Math.floor,ue=function(e){return isNaN(e=+e)?0:(e>0?se:ae)(e)},le=Math.min,ce=function(e){return e>0?le(ue(e),9007199254740991):0},de=Math.max,fe=Math.min,pe=function(e,t){var n=ue(e);return n<0?de(n+t,0):fe(n,t)},he=function(e){return function(t,n,r){var i,o=v(t),a=ce(o.length),s=pe(r,a);if(e&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},ge={includes:he(!0),indexOf:he(!1)},ve=ge.indexOf,me=function(e,t){var n,r=v(e),i=0,o=[];for(n in r)!b(K,n)&&b(r,n)&&o.push(n);for(;t.length>i;)b(r,n=t[i++])&&(~ve(o,n)||o.push(n));return o},ye=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],_e=ye.concat("length","prototype"),be={f:Object.getOwnPropertyNames||function(e){return me(e,_e)}},Se={f:Object.getOwnPropertySymbols},ke=oe("Reflect","ownKeys")||function(e){var t=be.f(C(e)),n=Se.f;return n?t.concat(n(e)):t},we=function(e,t){for(var n=ke(t),r=R.f,i=x.f,o=0;o<n.length;o++){var a=n[o];b(e,a)||r(e,a,i(t,a))}},Ee=/#|\.prototype\./,Te=function(e,t){var n=Ce[xe(e)];return n==Re||n!=Ie&&("function"==typeof t?o(t):!!t)},xe=Te.normalize=function(e){return String(e).replace(Ee,".").toLowerCase()},Ce=Te.data={},Ie=Te.NATIVE="N",Re=Te.POLYFILL="P",Ae=Te,Oe=x.f,Me=function(e,t){var n,r,o,a,s,u=e.target,l=e.global,c=e.stat;if(n=l?i:c?i[u]||O(u,{}):(i[u]||{}).prototype)for(r in t){if(a=t[r],o=e.noTargetGet?(s=Oe(n,r))&&s.value:n[r],!Ae(l?r:u+(c?".":"#")+r,e.forced)&&void 0!==o){if(typeof a==typeof o)continue;we(a,o)}(e.sham||o&&o.sham)&&A(a,"sham",!0),ne(n,r,a,e)}},De=Array.isArray||function(e){return"Array"==f(e)},Le=function(e){return Object(g(e))},Pe=function(e,t,n){var r=y(t);r in e?R.f(e,r,c(0,n)):e[r]=n},Ne=!!Object.getOwnPropertySymbols&&!o(function(){return!String(Symbol())}),Ue=Ne&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Fe=G("wks"),je=i.Symbol,Ge=Ue?je:je&&je.withoutSetter||q,Be=function(e){return b(Fe,e)||(Ne&&b(je,e)?Fe[e]=je[e]:Fe[e]=Ge("Symbol."+e)),Fe[e]},Ve=Be("species"),qe=function(e,t){var n;return De(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!De(n.prototype)?m(n)&&null===(n=n[Ve])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},He=oe("navigator","userAgent")||"",ze=i.process,Ke=ze&&ze.versions,We=Ke&&Ke.v8;We?ee=($=We.split("."))[0]+$[1]:He&&(!($=He.match(/Edge\/(\d+)/))||$[1]>=74)&&($=He.match(/Chrome\/(\d+)/))&&(ee=$[1]);var Ye=ee&&+ee,Je=Be("species"),Xe=function(e){return Ye>=51||!o(function(){var t=[];return(t.constructor={})[Je]=function(){return{foo:1}},1!==t[e](Boolean).foo})},Qe=Be("isConcatSpreadable"),Ze=Ye>=51||!o(function(){var e=[];return e[Qe]=!1,e.concat()[0]!==e}),$e=Xe("concat"),et=function(e){if(!m(e))return!1;var t=e[Qe];return void 0!==t?!!t:De(e)};Me({target:"Array",proto:!0,forced:!Ze||!$e},{concat:function(e){var t,n,r,i,o,a=Le(this),s=qe(a,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(et(o=-1===t?a:arguments[t])){if(u+(i=ce(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<i;n++,u++)n in o&&Pe(s,u,o[n])}else{if(u>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Pe(s,u++,o)}return s.length=u,s}});var nt=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},rt=function(e,t,n){if(nt(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},it=[].push,ot=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=5==e||o;return function(s,u,l,c){for(var d,f,p=Le(s),g=h(p),v=rt(u,l,3),m=ce(g.length),y=0,_=c||qe,b=t?_(s,m):n?_(s,0):void 0;m>y;y++)if((a||y in g)&&(f=v(d=g[y],y,p),e))if(t)b[y]=f;else if(f)switch(e){case 3:return!0;case 5:return d;case 6:return y;case 2:it.call(b,d)}else if(i)return!1;return o?-1:r||i?i:b}},at={forEach:ot(0),map:ot(1),filter:ot(2),some:ot(3),every:ot(4),find:ot(5),findIndex:ot(6)},st=function(e,t){var n=[][e];return!!n&&o(function(){n.call(null,t||function(){throw 1},1)})},ut=Object.defineProperty,lt={},ct=function(e){throw e},dt=function(e,t){if(b(lt,e))return lt[e];t||(t={});var n=[][e],r=!!b(t,"ACCESSORS")&&t.ACCESSORS,i=b(t,0)?t[0]:ct,s=b(t,1)?t[1]:void 0;return lt[e]=!!n&&!o(function(){if(r&&!a)return!0;var e={length:-1};r?ut(e,1,{enumerable:!0,get:ct}):e[1]=1,n.call(e,i,s)})},ft=at.forEach,pt=st("forEach"),ht=dt("forEach"),gt=pt&&ht?[].forEach:function(e){return ft(this,e,arguments.length>1?arguments[1]:void 0)};Me({target:"Array",proto:!0,forced:[].forEach!=gt},{forEach:gt});var vt=function(e,t,n,r){try{return r?t(C(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&C(i.call(e)),t}},mt={},yt=Be("iterator"),_t=Array.prototype,bt=function(e){return void 0!==e&&(mt.Array===e||_t[yt]===e)},St={};St[Be("toStringTag")]="z";var kt="[object z]"===String(St),wt=Be("toStringTag"),Et="Arguments"==f(function(){return arguments}()),Tt=kt?f:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),wt))?n:Et?f(t):"Object"==(r=f(t))&&"function"==typeof t.callee?"Arguments":r},xt=Be("iterator"),Ct=function(e){if(null!=e)return e[xt]||e["@@iterator"]||mt[Tt(e)]},It=function(e){var t,n,r,i,o,a,s=Le(e),u="function"==typeof this?this:Array,l=arguments.length,c=l>1?arguments[1]:void 0,d=void 0!==c,f=Ct(s),p=0;if(d&&(c=rt(c,l>2?arguments[2]:void 0,2)),null==f||u==Array&&bt(f))for(n=new u(t=ce(s.length));t>p;p++)a=d?c(s[p],p):s[p],Pe(n,p,a);else for(o=(i=f.call(s)).next,n=new u;!(r=o.call(i)).done;p++)a=d?vt(i,c,[r.value,p],!0):r.value,Pe(n,p,a);return n.length=p,n},Rt=Be("iterator"),At=!1;try{var Ot=0,Mt={next:function(){return{done:!!Ot++}},return:function(){At=!0}};Mt[Rt]=function(){return this},Array.from(Mt,function(){throw 2})}catch(e){}var Dt=function(e,t){if(!t&&!At)return!1;var n=!1;try{var r={};r[Rt]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Lt=!Dt(function(e){Array.from(e)});Me({target:"Array",stat:!0,forced:Lt},{from:It});var Pt,Nt=Object.keys||function(e){return me(e,ye)},Ut=a?Object.defineProperties:function(e,t){C(e);for(var n,r=Nt(t),i=r.length,o=0;i>o;)R.f(e,n=r[o++],t[n]);return e},Ft=oe("document","documentElement"),jt=z("IE_PROTO"),Gt=function(){},Bt=function(e){return"<script>"+e+"<\/script>"},Vt=function(){try{Pt=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;Vt=Pt?function(e){e.write(Bt("")),e.close();var t=e.parentWindow.Object;return e=null,t}(Pt):((t=w("iframe")).style.display="none",Ft.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Bt("document.F=Object")),e.close(),e.F);for(var n=ye.length;n--;)delete Vt.prototype[ye[n]];return Vt()};K[jt]=!0;var qt=Object.create||function(e,t){var n;return null!==e?(Gt.prototype=C(e),n=new Gt,Gt.prototype=null,n[jt]=e):n=Vt(),void 0===t?n:Ut(n,t)};Me({target:"Object",stat:!0,sham:!a},{create:qt});var Ht=o(function(){Nt(1)});Me({target:"Object",stat:!0,forced:Ht},{keys:function(e){return Nt(Le(e))}});var zt,Kt,Wt,Yt=function(e){return function(t,n){var r,i,o=String(g(t)),a=ue(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=o.charCodeAt(a))<55296||r>56319||a+1===s||(i=o.charCodeAt(a+1))<56320||i>57343?e?o.charAt(a):r:e?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}},Jt={codeAt:Yt(!1),charAt:Yt(!0)},Xt=!o(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Qt=z("IE_PROTO"),Zt=Object.prototype,$t=Xt?Object.getPrototypeOf:function(e){return e=Le(e),b(e,Qt)?e[Qt]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Zt:null},en=Be("iterator"),tn=!1;[].keys&&("next"in(Wt=[].keys())?(Kt=$t($t(Wt)))!==Object.prototype&&(zt=Kt):tn=!0),null==zt&&(zt={}),b(zt,en)||A(zt,en,function(){return this});var nn={IteratorPrototype:zt,BUGGY_SAFARI_ITERATORS:tn},rn=R.f,on=Be("toStringTag"),an=function(e,t,n){e&&!b(e=n?e:e.prototype,on)&&rn(e,on,{configurable:!0,value:t})},sn=nn.IteratorPrototype,un=function(){return this},ln=function(e,t,n){var r=t+" Iterator";return e.prototype=qt(sn,{next:c(1,n)}),an(e,r,!1),mt[r]=un,e},cn=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return C(n),function(e){if(!m(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),dn=nn.IteratorPrototype,fn=nn.BUGGY_SAFARI_ITERATORS,pn=Be("iterator"),hn=function(){return this},gn=function(e,t,n,r,i,o,a){ln(n,t,r);var s,u,l,c=function(e){if(e===i&&g)return g;if(!fn&&e in p)return p[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",f=!1,p=e.prototype,h=p[pn]||p["@@iterator"]||i&&p[i],g=!fn&&h||c(i),v="Array"==t&&p.entries||h;if(v&&(s=$t(v.call(new e)),dn!==Object.prototype&&s.next&&($t(s)!==dn&&(cn?cn(s,dn):"function"!=typeof s[pn]&&A(s,pn,hn)),an(s,d,!0))),"values"==i&&h&&"values"!==h.name&&(f=!0,g=function(){return h.call(this)}),p[pn]!==g&&A(p,pn,g),mt[t]=g,i)if(u={values:c("values"),keys:o?g:c("keys"),entries:c("entries")},a)for(l in u)(fn||f||!(l in p))&&ne(p,l,u[l]);else Me({target:t,proto:!0,forced:fn||f},u);return u},vn=Jt.charAt,mn=te.set,yn=te.getterFor("String Iterator");gn(String,"String",function(e){mn(this,{type:"String Iterator",string:String(e),index:0})},function(){var e,t=yn(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=vn(n,r),t.index+=e.length,{value:e,done:!1})});var _n={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0};for(var bn in _n){var Sn=i[bn],kn=Sn&&Sn.prototype;if(kn&&kn.forEach!==gt)try{A(kn,"forEach",gt)}catch(e){kn.forEach=gt}}var wn={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_SYSTEM_NOTICE_RECEIVED:"receiveGroupSystemNotice",PROFILE_UPDATED:"onProfileUpdated",BLACKLIST_UPDATED:"blacklistUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",SDK_RELOAD:"sdkReload"},En={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_SYSTEM:"@TIM#SYSTEM",GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected"},Tn=at.map,xn=Xe("map"),Cn=dt("map");Me({target:"Array",proto:!0,forced:!xn||!Cn},{map:function(e){return Tn(this,e,arguments.length>1?arguments[1]:void 0)}});var In=[].slice,Rn={},An=Function.bind||function(e){var t=nt(this),n=In.call(arguments,1),r=function(){var i=n.concat(In.call(arguments));return this instanceof r?function(e,t,n){if(!(t in Rn)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";Rn[t]=Function("C,a","return new C("+r.join(",")+")")}return Rn[t](e,n)}(t,i.length,i):t.apply(e,i)};return m(t.prototype)&&(r.prototype=t.prototype),r};function On(e){return(On="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mn(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function Dn(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){Mn(o,r,i,a,s,"next",e)}function s(e){Mn(o,r,i,a,s,"throw",e)}a(void 0)})}}function Ln(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Nn(e,t,n){return t&&Pn(e.prototype,t),n&&Pn(e,n),e}function Un(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Fn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function jn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fn(Object(n),!0).forEach(function(t){Un(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fn(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Gn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vn(e,t)}function Bn(e){return(Bn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vn(e,t){return(Vn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function Hn(e,t,n){return(Hn=qn()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Vn(i,n.prototype),i}).apply(null,arguments)}function zn(e){var t="function"==typeof Map?new Map:void 0;return(zn=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return Hn(e,arguments,Bn(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Vn(r,e)})(e)}function Kn(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Wn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yn(e){var t=qn();return function(){var n,r=Bn(e);if(t){var i=Bn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?Wn(e):t}(this,n)}}function Jn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(e,t)||Qn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xn(e){return function(e){if(Array.isArray(e))return Zn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Qn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qn(e,t){if(e){if("string"==typeof e)return Zn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zn(e,t):void 0}}function Zn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $n(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Qn(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}Me({target:"Function",proto:!0},{bind:An});var er=function(){function e(){Ln(this,e),this.cache=[],this.options=null}return Nn(e,[{key:"use",value:function(e){if("function"!=typeof e)throw"middleware must be a function";return this.cache.push(e),this}},{key:"next",value:function(e){if(this.middlewares&&this.middlewares.length>0)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(e){return this.middlewares=this.cache.map(function(e){return e}),this.options=e,this.next()}}]),e}(),tr=R.f,nr=Function.prototype,rr=nr.toString,ir=/^\s*function ([^ (]*)/;a&&!("name"in nr)&&tr(nr,"name",{configurable:!0,get:function(){try{return rr.call(this).match(ir)[1]}catch(e){return""}}});var or=n(function(t,n){var r,i,o,a,s,u,l,c,d,f,p,h,g,v,m,y,_,b;t.exports=(r="function"==typeof Promise,i="object"==typeof self?self:e,o="undefined"!=typeof Symbol,a="undefined"!=typeof Map,s="undefined"!=typeof Set,u="undefined"!=typeof WeakMap,l="undefined"!=typeof WeakSet,c="undefined"!=typeof DataView,d=o&&void 0!==Symbol.iterator,f=o&&void 0!==Symbol.toStringTag,p=s&&"function"==typeof Set.prototype.entries,h=a&&"function"==typeof Map.prototype.entries,g=p&&Object.getPrototypeOf((new Set).entries()),v=h&&Object.getPrototypeOf((new Map).entries()),m=d&&"function"==typeof Array.prototype[Symbol.iterator],y=m&&Object.getPrototypeOf([][Symbol.iterator]()),_=d&&"function"==typeof String.prototype[Symbol.iterator],b=_&&Object.getPrototypeOf(""[Symbol.iterator]()),function(e){var t=typeof e;if("object"!==t)return t;if(null===e)return"null";if(e===i)return"global";if(Array.isArray(e)&&(!1===f||!(Symbol.toStringTag in e)))return"Array";if("object"==typeof window&&null!==window){if("object"==typeof window.location&&e===window.location)return"Location";if("object"==typeof window.document&&e===window.document)return"Document";if("object"==typeof window.navigator){if("object"==typeof window.navigator.mimeTypes&&e===window.navigator.mimeTypes)return"MimeTypeArray";if("object"==typeof window.navigator.plugins&&e===window.navigator.plugins)return"PluginArray"}if(("function"==typeof window.HTMLElement||"object"==typeof window.HTMLElement)&&e instanceof window.HTMLElement){if("BLOCKQUOTE"===e.tagName)return"HTMLQuoteElement";if("TD"===e.tagName)return"HTMLTableDataCellElement";if("TH"===e.tagName)return"HTMLTableHeaderCellElement"}}var n=f&&e[Symbol.toStringTag];if("string"==typeof n)return n;var o=Object.getPrototypeOf(e);return o===RegExp.prototype?"RegExp":o===Date.prototype?"Date":r&&o===Promise.prototype?"Promise":s&&o===Set.prototype?"Set":a&&o===Map.prototype?"Map":l&&o===WeakSet.prototype?"WeakSet":u&&o===WeakMap.prototype?"WeakMap":c&&o===DataView.prototype?"DataView":a&&o===v?"Map Iterator":s&&o===g?"Set Iterator":m&&o===y?"Array Iterator":_&&o===b?"String Iterator":null===o?"Object":Object.prototype.toString.call(e).slice(8,-1)})});Me({target:"Array",stat:!0},{isArray:De});var ar=Be("unscopables"),sr=Array.prototype;null==sr[ar]&&R.f(sr,ar,{configurable:!0,value:qt(null)});var ur=function(e){sr[ar][e]=!0},lr=at.find,cr=!0,dr=dt("find");"find"in[]&&Array(1).find(function(){cr=!1}),Me({target:"Array",proto:!0,forced:cr||!dr},{find:function(e){return lr(this,e,arguments.length>1?arguments[1]:void 0)}}),ur("find");var fr=ge.includes,pr=dt("indexOf",{ACCESSORS:!0,1:0});Me({target:"Array",proto:!0,forced:!pr},{includes:function(e){return fr(this,e,arguments.length>1?arguments[1]:void 0)}}),ur("includes");var hr=ge.indexOf,gr=[].indexOf,vr=!!gr&&1/[1].indexOf(1,-0)<0,mr=st("indexOf"),yr=dt("indexOf",{ACCESSORS:!0,1:0});Me({target:"Array",proto:!0,forced:vr||!mr||!yr},{indexOf:function(e){return vr?gr.apply(this,arguments)||0:hr(this,e,arguments.length>1?arguments[1]:void 0)}});var _r=te.set,br=te.getterFor("Array Iterator"),Sr=gn(Array,"Array",function(e,t){_r(this,{type:"Array Iterator",target:v(e),index:0,kind:t})},function(){var e=br(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values");mt.Arguments=mt.Array,ur("keys"),ur("values"),ur("entries");var kr=[].join,wr=h!=Object,Er=st("join",",");Me({target:"Array",proto:!0,forced:wr||!Er},{join:function(e){return kr.call(v(this),void 0===e?",":e)}});var Tr=Xe("slice"),xr=dt("slice",{ACCESSORS:!0,0:0,1:2}),Cr=Be("species"),Ir=[].slice,Rr=Math.max;Me({target:"Array",proto:!0,forced:!Tr||!xr},{slice:function(e,t){var n,r,i,o=v(this),a=ce(o.length),s=pe(e,a),u=pe(void 0===t?a:t,a);if(De(o)&&("function"!=typeof(n=o.constructor)||n!==Array&&!De(n.prototype)?m(n)&&null===(n=n[Cr])&&(n=void 0):n=void 0,n===Array||void 0===n))return Ir.call(o,s,u);for(r=new(void 0===n?Array:n)(Rr(u-s,0)),i=0;s<u;s++,i++)s in o&&Pe(r,i,o[s]);return r.length=i,r}}),Me({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}});var Ar="".repeat||function(e){var t=String(g(this)),n="",r=ue(e);if(r<0||1/0==r)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n},Or=Math.ceil,Mr=function(e){return function(t,n,r){var i,o,a=String(g(t)),s=a.length,u=void 0===r?" ":String(r),l=ce(n);return l<=s||""==u?a:(i=l-s,(o=Ar.call(u,Or(i/u.length))).length>i&&(o=o.slice(0,i)),e?a+o:o+a)}},Dr=[Mr(!1),Mr(!0)][0],Lr=Math.abs,Pr=Date.prototype,Nr=Pr.getTime,Ur=Pr.toISOString,Fr=o(function(){return"0385-07-25T07:06:39.999Z"!=Ur.call(new Date(-50000000000001))})||!o(function(){Ur.call(new Date(NaN))})?function(){if(!isFinite(Nr.call(this)))throw RangeError("Invalid time value");var e=this.getUTCFullYear(),t=this.getUTCMilliseconds(),n=e<0?"-":e>9999?"+":"";return n+Dr(Lr(e),n?6:4,0)+"-"+Dr(this.getUTCMonth()+1,2,0)+"-"+Dr(this.getUTCDate(),2,0)+"T"+Dr(this.getUTCHours(),2,0)+":"+Dr(this.getUTCMinutes(),2,0)+":"+Dr(this.getUTCSeconds(),2,0)+"."+Dr(t,3,0)+"Z"}:Ur;Me({target:"Date",proto:!0,forced:Date.prototype.toISOString!==Fr},{toISOString:Fr});var jr=Date.prototype,Gr=jr.toString,Br=jr.getTime;new Date(NaN)+""!="Invalid Date"&&ne(jr,"toString",function(){var e=Br.call(this);return e==e?Gr.call(this):"Invalid Date"});var Vr=function(e,t,n){var r,i;return cn&&"function"==typeof(r=t.constructor)&&r!==n&&m(i=r.prototype)&&i!==n.prototype&&cn(e,i),e},qr="\t\n\v\f\r                　\u2028\u2029\ufeff",Hr="["+qr+"]",zr=RegExp("^"+Hr+Hr+"*"),Kr=RegExp(Hr+Hr+"*$"),Wr=function(e){return function(t){var n=String(g(t));return 1&e&&(n=n.replace(zr,"")),2&e&&(n=n.replace(Kr,"")),n}},Yr={start:Wr(1),end:Wr(2),trim:Wr(3)},Jr=be.f,Xr=x.f,Qr=R.f,Zr=Yr.trim,$r=i.Number,ei=$r.prototype,ti="Number"==f(qt(ei)),ni=function(e){var t,n,r,i,o,a,s,u,l=y(e,!1);if("string"==typeof l&&l.length>2)if(43===(t=(l=Zr(l)).charCodeAt(0))||45===t){if(88===(n=l.charCodeAt(2))||120===n)return NaN}else if(48===t){switch(l.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+l}for(a=(o=l.slice(2)).length,s=0;s<a;s++)if((u=o.charCodeAt(s))<48||u>i)return NaN;return parseInt(o,r)}return+l};if(Ae("Number",!$r(" 0o1")||!$r("0b1")||$r("+0x1"))){for(var ri,ii=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof ii&&(ti?o(function(){ei.valueOf.call(n)}):"Number"!=f(n))?Vr(new $r(ni(t)),n,ii):ni(t)},oi=a?Jr($r):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),ai=0;oi.length>ai;ai++)b($r,ri=oi[ai])&&!b(ii,ri)&&Qr(ii,ri,Xr($r,ri));ii.prototype=ei,ei.constructor=ii,ne(i,"Number",ii)}var si=be.f,ui={}.toString,li="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ci={f:function(e){return li&&"[object Window]"==ui.call(e)?function(e){try{return si(e)}catch(e){return li.slice()}}(e):si(v(e))}},di=ci.f,fi=o(function(){return!Object.getOwnPropertyNames(1)});Me({target:"Object",stat:!0,forced:fi},{getOwnPropertyNames:di});var pi=o(function(){$t(1)});Me({target:"Object",stat:!0,forced:pi,sham:!Xt},{getPrototypeOf:function(e){return $t(Le(e))}});var hi=kt?{}.toString:function(){return"[object "+Tt(this)+"]"};kt||ne(Object.prototype,"toString",hi,{unsafe:!0});var gi=Yr.trim,vi=i.parseInt,mi=/^[+-]?0[Xx]/,yi=8!==vi(qr+"08")||22!==vi(qr+"0x16")?function(e,t){var n=gi(String(e));return vi(n,t>>>0||(mi.test(n)?16:10))}:vi;Me({global:!0,forced:parseInt!=yi},{parseInt:yi});var _i,bi,Si,ki=i.Promise,wi=function(e,t,n){for(var r in t)ne(e,r,t[r],n);return e},Ei=Be("species"),Ti=function(e){var t=oe(e),n=R.f;a&&t&&!t[Ei]&&n(t,Ei,{configurable:!0,get:function(){return this}})},xi=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},Ci=n(function(e){var t=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,n,r,i,o){var a,s,u,l,c,d,f,p=rt(n,r,i?2:1);if(o)a=e;else{if("function"!=typeof(s=Ct(e)))throw TypeError("Target is not iterable");if(bt(s)){for(u=0,l=ce(e.length);l>u;u++)if((c=i?p(C(f=e[u])[0],f[1]):p(e[u]))&&c instanceof t)return c;return new t(!1)}a=s.call(e)}for(d=a.next;!(f=d.call(a)).done;)if("object"==typeof(c=vt(a,p,f.value,i))&&c&&c instanceof t)return c;return new t(!1)}).stop=function(e){return new t(!0,e)}}),Ii=Be("species"),Ri=function(e,t){var n,r=C(e).constructor;return void 0===r||null==(n=C(r)[Ii])?t:nt(n)},Ai=/(iphone|ipod|ipad).*applewebkit/i.test(He),Oi=i.location,Mi=i.setImmediate,Di=i.clearImmediate,Li=i.process,Pi=i.MessageChannel,Ni=i.Dispatch,Ui=0,Fi={},ji=function(e){if(Fi.hasOwnProperty(e)){var t=Fi[e];delete Fi[e],t()}},Gi=function(e){return function(){ji(e)}},Bi=function(e){ji(e.data)},Vi=function(e){i.postMessage(e+"",Oi.protocol+"//"+Oi.host)};Mi&&Di||(Mi=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return Fi[++Ui]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},_i(Ui),Ui},Di=function(e){delete Fi[e]},"process"==f(Li)?_i=function(e){Li.nextTick(Gi(e))}:Ni&&Ni.now?_i=function(e){Ni.now(Gi(e))}:Pi&&!Ai?(Si=(bi=new Pi).port2,bi.port1.onmessage=Bi,_i=rt(Si.postMessage,Si,1)):!i.addEventListener||"function"!=typeof postMessage||i.importScripts||o(Vi)||"file:"===Oi.protocol?_i="onreadystatechange"in w("script")?function(e){Ft.appendChild(w("script")).onreadystatechange=function(){Ft.removeChild(this),ji(e)}}:function(e){setTimeout(Gi(e),0)}:(_i=Vi,i.addEventListener("message",Bi,!1)));var qi,Hi,zi,Ki,Wi,Yi,Ji,Xi,Qi={set:Mi,clear:Di},Zi=x.f,$i=Qi.set,eo=i.MutationObserver||i.WebKitMutationObserver,to=i.process,no=i.Promise,ro="process"==f(to),io=Zi(i,"queueMicrotask"),oo=io&&io.value;oo||(qi=function(){var e,t;for(ro&&(e=to.domain)&&e.exit();Hi;){t=Hi.fn,Hi=Hi.next;try{t()}catch(e){throw Hi?Ki():zi=void 0,e}}zi=void 0,e&&e.enter()},ro?Ki=function(){to.nextTick(qi)}:eo&&!Ai?(Wi=!0,Yi=document.createTextNode(""),new eo(qi).observe(Yi,{characterData:!0}),Ki=function(){Yi.data=Wi=!Wi}):no&&no.resolve?(Ji=no.resolve(void 0),Xi=Ji.then,Ki=function(){Xi.call(Ji,qi)}):Ki=function(){$i.call(i,qi)});var ao,so,uo,lo,co=oo||function(e){var t={fn:e,next:void 0};zi&&(zi.next=t),Hi||(Hi=t,Ki()),zi=t},fo=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=nt(t),this.reject=nt(n)},po={f:function(e){return new fo(e)}},ho=function(e,t){if(C(e),m(t)&&t.constructor===e)return t;var n=po.f(e);return(0,n.resolve)(t),n.promise},go=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},vo=Qi.set,mo=Be("species"),yo="Promise",_o=te.get,bo=te.set,So=te.getterFor(yo),ko=ki,wo=i.TypeError,Eo=i.document,To=i.process,xo=oe("fetch"),Co=po.f,Io=Co,Ro="process"==f(To),Ao=!!(Eo&&Eo.createEvent&&i.dispatchEvent),Oo=Ae(yo,function(){if(U(ko)===String(ko)){if(66===Ye)return!0;if(!Ro&&"function"!=typeof PromiseRejectionEvent)return!0}if(Ye>=51&&/native code/.test(ko))return!1;var e=ko.resolve(1),t=function(e){e(function(){},function(){})};return(e.constructor={})[mo]=t,!(e.then(function(){})instanceof t)}),Mo=Oo||!Dt(function(e){ko.all(e).catch(function(){})}),Do=function(e){var t;return!(!m(e)||"function"!=typeof(t=e.then))&&t},Lo=function(e,t,n){if(!t.notified){t.notified=!0;var r=t.reactions;co(function(){for(var i=t.value,o=1==t.state,a=0;r.length>a;){var s,u,l,c=r[a++],d=o?c.ok:c.fail,f=c.resolve,p=c.reject,h=c.domain;try{d?(o||(2===t.rejection&&Fo(e,t),t.rejection=1),!0===d?s=i:(h&&h.enter(),s=d(i),h&&(h.exit(),l=!0)),s===c.promise?p(wo("Promise-chain cycle")):(u=Do(s))?u.call(s,f,p):f(s)):p(i)}catch(e){h&&!l&&h.exit(),p(e)}}t.reactions=[],t.notified=!1,n&&!t.rejection&&No(e,t)})}},Po=function(e,t,n){var r,o;Ao?((r=Eo.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),i.dispatchEvent(r)):r={promise:t,reason:n},(o=i["on"+e])?o(r):"unhandledrejection"===e&&function(e,t){var n=i.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},No=function(e,t){vo.call(i,function(){var n,r=t.value;if(Uo(t)&&(n=go(function(){Ro?To.emit("unhandledRejection",r,e):Po("unhandledrejection",e,r)}),t.rejection=Ro||Uo(t)?2:1,n.error))throw n.value})},Uo=function(e){return 1!==e.rejection&&!e.parent},Fo=function(e,t){vo.call(i,function(){Ro?To.emit("rejectionHandled",e):Po("rejectionhandled",e,t.value)})},jo=function(e,t,n,r){return function(i){e(t,n,i,r)}},Go=function(e,t,n,r){t.done||(t.done=!0,r&&(t=r),t.value=n,t.state=2,Lo(e,t,!0))},Bo=function(e,t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(e===n)throw wo("Promise can't be resolved itself");var i=Do(n);i?co(function(){var r={done:!1};try{i.call(n,jo(Bo,e,r,t),jo(Go,e,r,t))}catch(n){Go(e,r,n,t)}}):(t.value=n,t.state=1,Lo(e,t,!1))}catch(n){Go(e,{done:!1},n,t)}}};Oo&&(ko=function(e){xi(this,ko,yo),nt(e),ao.call(this);var t=_o(this);try{e(jo(Bo,this,t),jo(Go,this,t))}catch(e){Go(this,t,e)}},(ao=function(e){bo(this,{type:yo,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=wi(ko.prototype,{then:function(e,t){var n=So(this),r=Co(Ri(this,ko));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Ro?To.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Lo(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),so=function(){var e=new ao,t=_o(e);this.promise=e,this.resolve=jo(Bo,e,t),this.reject=jo(Go,e,t)},po.f=Co=function(e){return e===ko||e===uo?new so(e):Io(e)},"function"==typeof ki&&(lo=ki.prototype.then,ne(ki.prototype,"then",function(e,t){var n=this;return new ko(function(e,t){lo.call(n,e,t)}).then(e,t)},{unsafe:!0}),"function"==typeof xo&&Me({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return ho(ko,xo.apply(i,arguments))}}))),Me({global:!0,wrap:!0,forced:Oo},{Promise:ko}),an(ko,yo,!1),Ti(yo),uo=oe(yo),Me({target:yo,stat:!0,forced:Oo},{reject:function(e){var t=Co(this);return t.reject.call(void 0,e),t.promise}}),Me({target:yo,stat:!0,forced:Oo},{resolve:function(e){return ho(this,e)}}),Me({target:yo,stat:!0,forced:Mo},{all:function(e){var t=this,n=Co(t),r=n.resolve,i=n.reject,o=go(function(){var n=nt(t.resolve),o=[],a=0,s=1;Ci(e,function(e){var u=a++,l=!1;o.push(void 0),s++,n.call(t,e).then(function(e){l||(l=!0,o[u]=e,--s||r(o))},i)}),--s||r(o)});return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=Co(t),r=n.reject,i=go(function(){var i=nt(t.resolve);Ci(e,function(e){i.call(t,e).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var Vo=function(){var e=C(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t};function qo(e,t){return RegExp(e,t)}var Ho,zo,Ko={UNSUPPORTED_Y:o(function(){var e=qo("a","y");return e.lastIndex=2,null!=e.exec("abcd")}),BROKEN_CARET:o(function(){var e=qo("^r","gy");return e.lastIndex=2,null!=e.exec("str")})},Wo=RegExp.prototype.exec,Yo=String.prototype.replace,Jo=Wo,Xo=(Ho=/a/,zo=/b*/g,Wo.call(Ho,"a"),Wo.call(zo,"a"),0!==Ho.lastIndex||0!==zo.lastIndex),Qo=Ko.UNSUPPORTED_Y||Ko.BROKEN_CARET,Zo=void 0!==/()??/.exec("")[1];(Xo||Zo||Qo)&&(Jo=function(e){var t,n,r,i,o=this,a=Qo&&o.sticky,s=Vo.call(o),u=o.source,l=0,c=e;return a&&(-1===(s=s.replace("y","")).indexOf("g")&&(s+="g"),c=String(e).slice(o.lastIndex),o.lastIndex>0&&(!o.multiline||o.multiline&&"\n"!==e[o.lastIndex-1])&&(u="(?: "+u+")",c=" "+c,l++),n=new RegExp("^(?:"+u+")",s)),Zo&&(n=new RegExp("^"+u+"$(?!\\s)",s)),Xo&&(t=o.lastIndex),r=Wo.call(a?n:o,c),a?r?(r.input=r.input.slice(l),r[0]=r[0].slice(l),r.index=o.lastIndex,o.lastIndex+=r[0].length):o.lastIndex=0:Xo&&r&&(o.lastIndex=o.global?r.index+r[0].length:t),Zo&&r&&r.length>1&&Yo.call(r[0],n,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)}),r});var $o=Jo;Me({target:"RegExp",proto:!0,forced:/./.exec!==$o},{exec:$o});var ea=RegExp.prototype,ta=ea.toString,na=o(function(){return"/a/b"!=ta.call({source:"a",flags:"b"})}),ra="toString"!=ta.name;(na||ra)&&ne(RegExp.prototype,"toString",function(){var e=C(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in ea)?Vo.call(e):n)},{unsafe:!0});var ia=Be("match"),oa=function(e){var t;return m(e)&&(void 0!==(t=e[ia])?!!t:"RegExp"==f(e))},aa=function(e){if(oa(e))throw TypeError("The method doesn't accept regular expressions");return e},sa=Be("match"),ua=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[sa]=!1,"/./"[e](t)}catch(e){}}return!1};Me({target:"String",proto:!0,forced:!ua("includes")},{includes:function(e){return!!~String(g(this)).indexOf(aa(e),arguments.length>1?arguments[1]:void 0)}});var la=Be("species"),ca=!o(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),da="$0"==="a".replace(/./,"$0"),fa=Be("replace"),pa=!!/./[fa]&&""===/./[fa]("a","$0"),ha=!o(function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}),ga=function(e,t,n,r){var i=Be(e),a=!o(function(){var t={};return t[i]=function(){return 7},7!=""[e](t)}),s=a&&!o(function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[la]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t});if(!a||!s||"replace"===e&&(!ca||!da||pa)||"split"===e&&!ha){var u=/./[i],l=n(i,""[e],function(e,t,n,r,i){return t.exec===$o?a&&!i?{done:!0,value:u.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}},{REPLACE_KEEPS_$0:da,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:pa}),c=l[0],d=l[1];ne(String.prototype,e,c),ne(RegExp.prototype,i,2==t?function(e,t){return d.call(e,this,t)}:function(e){return d.call(e,this)})}r&&A(RegExp.prototype[i],"sham",!0)},va=Jt.charAt,ma=function(e,t,n){return t+(n?va(e,t).length:1)},ya=function(e,t){var n=e.exec;if("function"==typeof n){var r=n.call(e,t);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==f(e))throw TypeError("RegExp#exec called on incompatible receiver");return $o.call(e,t)};ga("match",1,function(e,t,n){return[function(t){var n=g(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;var i=C(e),o=String(this);if(!i.global)return ya(i,o);var a=i.unicode;i.lastIndex=0;for(var s,u=[],l=0;null!==(s=ya(i,o));){var c=String(s[0]);u[l]=c,""===c&&(i.lastIndex=ma(o,ce(i.lastIndex),a)),l++}return 0===l?null:u}]});var _a=Math.max,ba=Math.min,Sa=Math.floor,ka=/\$([$&'`]|\d\d?|<[^>]*>)/g,wa=/\$([$&'`]|\d\d?)/g;ga("replace",2,function(e,t,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o=r.REPLACE_KEEPS_$0,a=i?"$":"$0";return[function(n,r){var i=g(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!i&&o||"string"==typeof r&&-1===r.indexOf(a)){var u=n(t,e,this,r);if(u.done)return u.value}var l=C(e),c=String(this),d="function"==typeof r;d||(r=String(r));var f=l.global;if(f){var p=l.unicode;l.lastIndex=0}for(var h=[];;){var g=ya(l,c);if(null===g)break;if(h.push(g),!f)break;""===String(g[0])&&(l.lastIndex=ma(c,ce(l.lastIndex),p))}for(var v,m="",y=0,_=0;_<h.length;_++){g=h[_];for(var b=String(g[0]),S=_a(ba(ue(g.index),c.length),0),k=[],w=1;w<g.length;w++)k.push(void 0===(v=g[w])?v:String(v));var E=g.groups;if(d){var T=[b].concat(k,S,c);void 0!==E&&T.push(E);var x=String(r.apply(void 0,T))}else x=s(b,c,S,k,E,r);S>=y&&(m+=c.slice(y,S)+x,y=S+b.length)}return m+c.slice(y)}];function s(e,n,r,i,o,a){var s=r+e.length,u=i.length,l=wa;return void 0!==o&&(o=Le(o),l=ka),t.call(a,l,function(t,a){var l;switch(a.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,r);case"'":return n.slice(s);case"<":l=o[a.slice(1,-1)];break;default:var c=+a;if(0===c)return t;if(c>u){var d=Sa(c/10);return 0===d?t:d<=u?void 0===i[d-1]?a.charAt(1):i[d-1]+a.charAt(1):t}l=i[c-1]}return void 0===l?"":l})}});var Ea=Be("iterator"),Ta=Be("toStringTag"),xa=Sr.values;for(var Ca in _n){var Ia=i[Ca],Ra=Ia&&Ia.prototype;if(Ra){if(Ra[Ea]!==xa)try{A(Ra,Ea,xa)}catch(e){Ra[Ea]=xa}if(Ra[Ta]||A(Ra,Ta,Ca),_n[Ca])for(var Aa in Sr)if(Ra[Aa]!==Sr[Aa])try{A(Ra,Aa,Sr[Aa])}catch(e){Ra[Aa]=Sr[Aa]}}}var Oa=Yr.trim,Ma=i.parseFloat,Da=1/Ma(qr+"-0")!=-1/0?function(e){var t=Oa(String(e)),n=Ma(t);return 0===n&&"-"==t.charAt(0)?-0:n}:Ma;Me({global:!0,forced:parseFloat!=Da},{parseFloat:Da});var La,Pa,Na,Ua="undefined"!=typeof window,Fa="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync,ja="undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync,Ga="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync,Ba="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync,Va="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync,qa=Fa||ja||Ga||Ba||Va,Ha=ja?qq:Ga?tt:Ba?swan:Va?my:Fa?wx:{},za=(La="web",ns?La="wechat":ja?La="qqmp":Ga?La="ttmp":Ba?La="baidump":Va?La="alipaymp":Fa&&(La="wxmp"),La),Ka=Ua&&window.navigator&&window.navigator.userAgent||"",Wa=/AppleWebKit\/([\d.]+)/i.exec(Ka),Ya=(Wa&&parseFloat(Wa.pop()),/iPad/i.test(Ka)),Ja=/iPhone/i.test(Ka)&&!Ya,Xa=/iPod/i.test(Ka),Qa=Ja||Ya||Xa,Za=(function(){var e=Ka.match(/OS (\d+)_/i);e&&e[1]&&e[1]}(),/Android/i.test(Ka)),$a=(function(){var e=Ka.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);t&&n&&parseFloat(e[1]+"."+e[2])}(),Za&&/webkit/i.test(Ka),/Firefox/i.test(Ka),!/Edge/i.test(Ka)&&/Chrome/i.test(Ka),function(){var e=Ka.match(/Chrome\/(\d+)/);e&&e[1]&&parseFloat(e[1])}(),/MSIE/.test(Ka)),es=(/MSIE\s8\.0/.test(Ka),function(){var e=/MSIE\s(\d+)\.\d/.exec(Ka),t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(Ka)&&/rv:11.0/.test(Ka)&&(t=11),t}()),ts=(/Safari/i.test(Ka),/TBS\/\d+/i.test(Ka)),ns=(function(){var e=Ka.match(/TBS\/(\d+)/i);e&&e[1]&&e[1]}(),!ts&&/MQQBrowser\/\d+/i.test(Ka),!ts&&/ QQBrowser\/\d+/i.test(Ka),/(micromessenger|webbrowser)/i.test(Ka)),rs=/Windows/i.test(Ka),is=/MAC OS X/i.test(Ka),os=(/MicroMessenger/i.test(Ka),!o(function(){return Object.isExtensible(Object.preventExtensions({}))})),as=n(function(e){var t=R.f,n=q("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},a=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!m(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!b(e,n)){if(!i(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!b(e,n)){if(!i(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return os&&a.REQUIRED&&i(e)&&!b(e,n)&&o(e),e}};K[n]=!0}),ss=(as.REQUIRED,as.fastKey,as.getWeakData,as.onFreeze,R.f),us=as.fastKey,ls=te.set,cs=te.getterFor,ds=(function(e,t,n){var r=-1!==e.indexOf("Map"),a=-1!==e.indexOf("Weak"),s=r?"set":"add",u=i[e],l=u&&u.prototype,c=u,d={},f=function(e){var t=l[e];ne(l,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(a&&!m(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return a&&!m(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(a&&!m(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(Ae(e,"function"!=typeof u||!(a||l.forEach&&!o(function(){(new u).entries().next()}))))c=n.getConstructor(t,e,r,s),as.REQUIRED=!0;else if(Ae(e,!0)){var p=new c,h=p[s](a?{}:-0,1)!=p,g=o(function(){p.has(1)}),v=Dt(function(e){new u(e)}),y=!a&&o(function(){for(var e=new u,t=5;t--;)e[s](t,t);return!e.has(-0)});v||((c=t(function(t,n){xi(t,c,e);var i=Vr(new u,t,c);return null!=n&&Ci(n,i[s],i,r),i})).prototype=l,l.constructor=c),(g||y)&&(f("delete"),f("has"),r&&f("get")),(y||h)&&f(s),a&&l.clear&&delete l.clear}d[e]=c,Me({global:!0,forced:c!=u},d),an(c,e),a||n.setStrong(c,e,r)}("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(e,t,n,r){var i=e(function(e,o){xi(e,i,t),ls(e,{type:t,index:qt(null),first:void 0,last:void 0,size:0}),a||(e.size=0),null!=o&&Ci(o,e[r],e,n)}),o=cs(t),s=function(e,t,n){var r,i,s=o(e),l=u(e,t);return l?l.value=n:(s.last=l={index:i=us(t,!0),key:t,value:n,previous:r=s.last,next:void 0,removed:!1},s.first||(s.first=l),r&&(r.next=l),a?s.size++:e.size++,"F"!==i&&(s.index[i]=l)),e},u=function(e,t){var n,r=o(e),i=us(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return wi(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,a?e.size=0:this.size=0},delete:function(e){var t=o(this),n=u(this,e);if(n){var r=n.next,i=n.previous;delete t.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),t.first==n&&(t.first=r),t.last==n&&(t.last=i),a?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=o(this),r=rt(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!u(this,e)}}),wi(i.prototype,n?{get:function(e){var t=u(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),a&&ss(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=cs(t),o=cs(r);gn(e,t,function(e,t){ls(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})},n?"entries":"values",!n,!0),Ti(t)}}),void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});Pa="undefined"!=typeof console?console:void 0!==ds&&ds.console?ds.console:"undefined"!=typeof window&&window.console?window.console:{};for(var fs=function(){},ps=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],hs=ps.length;hs--;)Na=ps[hs],console[Na]||(Pa[Na]=fs);Pa.methods=ps;var gs=Pa,vs=0,ms=new Map;function ys(){var e=new Date;return"TIM "+e.toLocaleTimeString("en-US",{hour12:!1})+"."+function(e){var t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(e.getMilliseconds())+":"}var _s={arguments2String:function(e){var t;if(1===e.length)t=ys()+e[0];else{t=ys();for(var n=0,r=e.length;n<r;n++)Cs(e[n])?Rs(e[n])?t+=Ps(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" "}return t},debug:function(){if(vs<=-1){var e=this.arguments2String(arguments);gs.debug(e)}},log:function(){if(vs<=0){var e=this.arguments2String(arguments);gs.log(e)}},info:function(){if(vs<=1){var e=this.arguments2String(arguments);gs.info(e)}},warn:function(){if(vs<=2){var e=this.arguments2String(arguments);gs.warn(e)}},error:function(){if(vs<=3){var e=this.arguments2String(arguments);gs.error(e)}},time:function(e){ms.set(e,Ds.now())},timeEnd:function(e){if(ms.has(e)){var t=Ds.now()-ms.get(e);return ms.delete(e),t}return gs.warn("未找到对应label: ".concat(e,", 请在调用 logger.timeEnd 前，调用 logger.time")),0},setLevel:function(e){e<4&&gs.log(ys()+"set level from "+vs+" to "+e),vs=e}},bs=function(e){return"file"===As(e)},Ss=function(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"===On(e)&&e.constructor===Number)},ks=function(e){return"string"==typeof e},ws=function(e){return null!==e&&"object"===On(e)},Es=function(e){if("object"!==On(e)||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var n=t;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n},Ts=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===As(e)},xs=function(e){return void 0===e},Cs=function(e){return Ts(e)||ws(e)},Is=function(e){return"function"==typeof e},Rs=function(e){return e instanceof Error},As=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},Os=function(e){if("string"!=typeof e)return!1;var t=e[0];return!/[^a-zA-Z0-9]/.test(t)},Ms=0;Date.now||(Date.now=function(){return(new Date).getTime()});var Ds={now:function(){0===Ms&&(Ms=Date.now()-1);var e=Date.now()-Ms;return e>4294967295?(Ms+=4294967295,Date.now()-Ms):e},utc:function(){return Math.round(Date.now()/1e3)}},Ls=function e(t,n,r,i){if(!Cs(t)||!Cs(n))return 0;for(var o,a=0,s=Object.keys(n),u=0,l=s.length;u<l;u++)if(o=s[u],!(xs(n[o])||r&&r.includes(o)))if(Cs(t[o])&&Cs(n[o]))a+=e(t[o],n[o],r,i);else{if(i&&i.includes(n[o]))continue;t[o]!==n[o]&&(t[o]=n[o],a+=1)}return a},Ps=function(e){return JSON.stringify(e,["message","code"])},Ns=function(){var e=new Date,t=e.toISOString(),n=e.getTimezoneOffset()/60,r="";return r=n<0?n>-10?"+0"+Math.abs(100*n):"+"+Math.abs(100*n):n>=10?"-"+100*n:"-0"+100*n,t.replace("Z",r)},Us=function(e){if(0===e.length)return 0;for(var t=0,n=0,r="undefined"!=typeof document&&void 0!==document.characterSet?document.characterSet:"UTF-8";void 0!==e[t];)n+=e[t++].charCodeAt[t]<=255?1:!1===r?3:2;return n},Fs=function(e){var t=e||99999999;return Math.round(Math.random()*t)},js="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",Gs=js.length,Bs=function(e,t){for(var n in e)if(e[n]===t)return!0;return!1},Vs={},qs=function(){if(qa)return"https:";var e=window.location.protocol;return["http:","https:"].indexOf(e)<0&&(e="http:"),e},Hs=function(e){return-1===e.indexOf("http://")||-1===e.indexOf("https://")?"https://"+e:e.replace(/https|http/,"https")};function zs(e,t){Ts(e)&&Ts(t)?t.forEach(function(t){var n=t.key,r=t.value,i=e.find(function(e){return e.key===n});i?i.value=r:e.push({key:n,value:r})}):_s.warn("updateCustomField target 或 source 不是数组，忽略此次更新。")}var Ks=function(e){return e===En.GRP_WORK},Ws=function(e){return e===En.GRP_PUBLIC},Ys=function(e){return e===En.GRP_MEETING},Js=function(e){return e===En.GRP_AVCHATROOM},Xs=function(e){return ks(e)&&e===En.CONV_SYSTEM};function Qs(e,t){var n={};return Object.keys(e).forEach(function(r){n[r]=t(e[r],r)}),n}function Zs(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(e()+e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e())}function $s(e){var t=e.originUrl,n=void 0===t?void 0:t,r=e.originWidth,i=e.originHeight,o=e.min,a=void 0===o?198:o,s=parseInt(r),u=parseInt(i),l={url:void 0,width:0,height:0};return(s<=u?s:u)<=a?(l.url=n,l.width=s,l.height=u):(u<=s?(l.width=Math.ceil(s*a/u),l.height=a):(l.width=a,l.height=Math.ceil(u*a/s)),l.url="".concat(n,198===a?"?imageView2/3/w/198/h/198":"?imageView2/3/w/720/h/720")),xs(n)?Kn(l,["url"]):l}function eu(e){var t=e[2];e[2]=e[1],e[1]=t;for(var n=0;n<e.length;n++)e[n].setSizeType(n+1),e[n].setType(n)}var tu=Object.prototype.hasOwnProperty;function nu(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(Es(e)){for(var t in e)if(tu.call(e,t))return!1;return!0}return!("map"!==As(e)&&!function(e){return"set"===As(e)}(e)&&!bs(e))&&0===e.size}function ru(e,t,n,r){if(void 0===t)return!0;var i=!0;return t.required&&nu(e)&&(gs.error("TIM [".concat(n,'] Missing required params: "').concat(r,'".')),i=!1),nu(e)||or(e).toLowerCase()===t.type.toLowerCase()||(gs.error("TIM [".concat(n,'] Invalid params: type check failed for "').concat(r,'".Expected ').concat(t.type,".")),i=!1),t.validator&&!t.validator(e)&&(gs.error("TIM [".concat(n,"] Invalid params: custom validator check failed for params.")),i=!1),i}var iu={f:Be},ou=R.f,au=at.forEach,su=z("hidden"),uu=Be("toPrimitive"),lu=te.set,cu=te.getterFor("Symbol"),du=Object.prototype,fu=i.Symbol,pu=oe("JSON","stringify"),hu=x.f,gu=R.f,vu=ci.f,mu=l.f,yu=G("symbols"),_u=G("op-symbols"),bu=G("string-to-symbol-registry"),Su=G("symbol-to-string-registry"),ku=G("wks"),wu=i.QObject,Eu=!wu||!wu.prototype||!wu.prototype.findChild,Tu=a&&o(function(){return 7!=qt(gu({},"a",{get:function(){return gu(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=hu(du,t);r&&delete du[t],gu(e,t,n),r&&e!==du&&gu(du,t,r)}:gu,xu=function(e,t){var n=yu[e]=qt(fu.prototype);return lu(n,{type:"Symbol",tag:e,description:t}),a||(n.description=t),n},Cu=Ue?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof fu},Iu=function(e,t,n){e===du&&Iu(_u,t,n),C(e);var r=y(t,!0);return C(n),b(yu,r)?(n.enumerable?(b(e,su)&&e[su][r]&&(e[su][r]=!1),n=qt(n,{enumerable:c(0,!1)})):(b(e,su)||gu(e,su,c(1,{})),e[su][r]=!0),Tu(e,r,n)):gu(e,r,n)},Ru=function(e,t){C(e);var n=v(t),r=Nt(n).concat(Du(n));return au(r,function(t){a&&!Au.call(n,t)||Iu(e,t,n[t])}),e},Au=function(e){var t=y(e,!0),n=mu.call(this,t);return!(this===du&&b(yu,t)&&!b(_u,t))&&(!(n||!b(this,t)||!b(yu,t)||b(this,su)&&this[su][t])||n)},Ou=function(e,t){var n=v(e),r=y(t,!0);if(n!==du||!b(yu,r)||b(_u,r)){var i=hu(n,r);return!i||!b(yu,r)||b(n,su)&&n[su][r]||(i.enumerable=!0),i}},Mu=function(e){var t=vu(v(e)),n=[];return au(t,function(e){b(yu,e)||b(K,e)||n.push(e)}),n},Du=function(e){var t=e===du,n=vu(t?_u:v(e)),r=[];return au(n,function(e){!b(yu,e)||t&&!b(du,e)||r.push(yu[e])}),r};if(Ne||(ne((fu=function(){if(this instanceof fu)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=q(e),n=function(e){this===du&&n.call(_u,e),b(this,su)&&b(this[su],t)&&(this[su][t]=!1),Tu(this,t,c(1,e))};return a&&Eu&&Tu(du,t,{configurable:!0,set:n}),xu(t,e)}).prototype,"toString",function(){return cu(this).tag}),ne(fu,"withoutSetter",function(e){return xu(q(e),e)}),l.f=Au,R.f=Iu,x.f=Ou,be.f=ci.f=Mu,Se.f=Du,iu.f=function(e){return xu(Be(e),e)},a&&(gu(fu.prototype,"description",{configurable:!0,get:function(){return cu(this).description}}),ne(du,"propertyIsEnumerable",Au,{unsafe:!0}))),Me({global:!0,wrap:!0,forced:!Ne,sham:!Ne},{Symbol:fu}),au(Nt(ku),function(e){!function(e){var t=re.Symbol||(re.Symbol={});b(t,e)||ou(t,e,{value:iu.f(e)})}(e)}),Me({target:"Symbol",stat:!0,forced:!Ne},{for:function(e){var t=String(e);if(b(bu,t))return bu[t];var n=fu(t);return bu[t]=n,Su[n]=t,n},keyFor:function(e){if(!Cu(e))throw TypeError(e+" is not a symbol");if(b(Su,e))return Su[e]},useSetter:function(){Eu=!0},useSimple:function(){Eu=!1}}),Me({target:"Object",stat:!0,forced:!Ne,sham:!a},{create:function(e,t){return void 0===t?qt(e):Ru(qt(e),t)},defineProperty:Iu,defineProperties:Ru,getOwnPropertyDescriptor:Ou}),Me({target:"Object",stat:!0,forced:!Ne},{getOwnPropertyNames:Mu,getOwnPropertySymbols:Du}),Me({target:"Object",stat:!0,forced:o(function(){Se.f(1)})},{getOwnPropertySymbols:function(e){return Se.f(Le(e))}}),pu){var Lu=!Ne||o(function(){var e=fu();return"[null]"!=pu([e])||"{}"!=pu({a:e})||"{}"!=pu(Object(e))});Me({target:"JSON",stat:!0,forced:Lu},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(m(t)||void 0!==e)&&!Cu(e))return De(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Cu(t))return t}),i[1]=t,pu.apply(null,i)}})}fu.prototype[uu]||A(fu.prototype,uu,fu.prototype.valueOf),an(fu,"Symbol"),K[su]=!0;var Pu=R.f,Nu=i.Symbol;if(a&&"function"==typeof Nu&&(!("description"in Nu.prototype)||void 0!==Nu().description)){var Uu={},Fu=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Fu?new Nu(e):void 0===e?Nu():Nu(e);return""===e&&(Uu[t]=!0),t};we(Fu,Nu);var ju=Fu.prototype=Nu.prototype;ju.constructor=Fu;var Gu=ju.toString,Bu="Symbol(test)"==String(Nu("test")),Vu=/^Symbol\((.*)\)[^)]+$/;Pu(ju,"description",{configurable:!0,get:function(){var e=m(this)?this.valueOf():this,t=Gu.call(e);if(b(Uu,e))return"";var n=Bu?t.slice(7,-1):t.replace(Vu,"$1");return""===n?void 0:n}}),Me({global:!0,forced:!0},{Symbol:Fu})}var qu=l.f,Hu=function(e){return function(t){for(var n,r=v(t),i=Nt(r),o=i.length,s=0,u=[];o>s;)n=i[s++],a&&!qu.call(r,n)||u.push(e?[n,r[n]]:r[n]);return u}},zu=(Hu(!0),Hu(!1));Me({target:"Object",stat:!0},{values:function(e){return zu(e)}});var Ku={SUCCESS:"JoinedSuccess",WAIT_APPROVAL:"WaitAdminApproval"},Wu={SUCCESS:0},Yu={IS_LOGIN:1,IS_NOT_LOGIN:0},Ju={UNSEND:"unSend",SUCCESS:"success",FAIL:"fail"},Xu={NOT_START:"notStart",PENDING:"pengding",RESOLVED:"resolved",REJECTED:"rejected"},Qu=function(){function e(t){Ln(this,e),this.type=En.MSG_TEXT,this.content={text:t.text||""}}return Nn(e,[{key:"setText",value:function(e){this.content.text=e}},{key:"sendable",value:function(){return 0!==this.content.text.length}}]),e}(),Zu=Object.assign,$u=Object.defineProperty,el=!Zu||o(function(){if(a&&1!==Zu({b:1},Zu($u({},"a",{enumerable:!0,get:function(){$u(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach(function(e){t[e]=e}),7!=Zu({},e)[n]||"abcdefghijklmnopqrst"!=Nt(Zu({},t)).join("")})?function(e,t){for(var n=Le(e),r=arguments.length,i=1,o=Se.f,s=l.f;r>i;)for(var u,c=h(arguments[i++]),d=o?Nt(c).concat(o(c)):Nt(c),f=d.length,p=0;f>p;)u=d[p++],a&&!s.call(c,u)||(n[u]=c[u]);return n}:Zu;Me({target:"Object",stat:!0,forced:Object.assign!==el},{assign:el});var tl=Be("iterator"),nl=!o(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach(function(e,r){t.delete("b"),n+=r+e}),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[tl]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host}),rl=/[^\0-\u007E]/,il=/[.\u3002\uFF0E\uFF61]/g,ol="Overflow: input needs wider integers to process",al=Math.floor,sl=String.fromCharCode,ul=function(e){return e+22+75*(e<26)},ll=function(e,t,n){var r=0;for(e=n?al(e/700):e>>1,e+=al(e/t);e>455;r+=36)e=al(e/35);return al(r+36*e/(e+38))},cl=function(e){var t,n,r=[],i=(e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=e.charCodeAt(n++);56320==(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),n--)}else t.push(i)}return t}(e)).length,o=128,a=0,s=72;for(t=0;t<e.length;t++)(n=e[t])<128&&r.push(sl(n));var u=r.length,l=u;for(u&&r.push("-");l<i;){var c=2147483647;for(t=0;t<e.length;t++)(n=e[t])>=o&&n<c&&(c=n);var d=l+1;if(c-o>al((2147483647-a)/d))throw RangeError(ol);for(a+=(c-o)*d,o=c,t=0;t<e.length;t++){if((n=e[t])<o&&++a>2147483647)throw RangeError(ol);if(n==o){for(var f=a,p=36;;p+=36){var h=p<=s?1:p>=s+26?26:p-s;if(f<h)break;var g=f-h,v=36-h;r.push(sl(ul(h+g%v))),f=al(g/v)}r.push(sl(ul(f))),s=ll(a,d,l==u),a=0,++l}}++a,++o}return r.join("")},dl=function(e){var t=Ct(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return C(t.call(e))},fl=oe("fetch"),pl=oe("Headers"),hl=Be("iterator"),gl=te.set,vl=te.getterFor("URLSearchParams"),ml=te.getterFor("URLSearchParamsIterator"),yl=/\+/g,_l=Array(4),bl=function(e){return _l[e-1]||(_l[e-1]=RegExp("((?:%[\\da-f]{2}){"+e+"})","gi"))},Sl=function(e){try{return decodeURIComponent(e)}catch(t){return e}},kl=function(e){var t=e.replace(yl," "),n=4;try{return decodeURIComponent(t)}catch(e){for(;n;)t=t.replace(bl(n--),Sl);return t}},wl=/[!'()~]|%20/g,El={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Tl=function(e){return El[e]},xl=function(e){return encodeURIComponent(e).replace(wl,Tl)},Cl=function(e,t){if(t)for(var n,r,i=t.split("&"),o=0;o<i.length;)(n=i[o++]).length&&(r=n.split("="),e.push({key:kl(r.shift()),value:kl(r.join("="))}))},Il=function(e){this.entries.length=0,Cl(this.entries,e)},Rl=function(e,t){if(e<t)throw TypeError("Not enough arguments")},Al=ln(function(e,t){gl(this,{type:"URLSearchParamsIterator",iterator:dl(vl(e).entries),kind:t})},"Iterator",function(){var e=ml(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n}),Ol=function(){xi(this,Ol,"URLSearchParams");var e,t,n,r,i,o,a,s,u,l=arguments.length>0?arguments[0]:void 0,c=[];if(gl(this,{type:"URLSearchParams",entries:c,updateURL:function(){},updateSearchParams:Il}),void 0!==l)if(m(l))if("function"==typeof(e=Ct(l)))for(n=(t=e.call(l)).next;!(r=n.call(t)).done;){if((a=(o=(i=dl(C(r.value))).next).call(i)).done||(s=o.call(i)).done||!o.call(i).done)throw TypeError("Expected sequence with length 2");c.push({key:a.value+"",value:s.value+""})}else for(u in l)b(l,u)&&c.push({key:u,value:l[u]+""});else Cl(c,"string"==typeof l?"?"===l.charAt(0)?l.slice(1):l:l+"")},Ml=Ol.prototype;wi(Ml,{append:function(e,t){Rl(arguments.length,2);var n=vl(this);n.entries.push({key:e+"",value:t+""}),n.updateURL()},delete:function(e){Rl(arguments.length,1);for(var t=vl(this),n=t.entries,r=e+"",i=0;i<n.length;)n[i].key===r?n.splice(i,1):i++;t.updateURL()},get:function(e){Rl(arguments.length,1);for(var t=vl(this).entries,n=e+"",r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){Rl(arguments.length,1);for(var t=vl(this).entries,n=e+"",r=[],i=0;i<t.length;i++)t[i].key===n&&r.push(t[i].value);return r},has:function(e){Rl(arguments.length,1);for(var t=vl(this).entries,n=e+"",r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){Rl(arguments.length,1);for(var n,r=vl(this),i=r.entries,o=!1,a=e+"",s=t+"",u=0;u<i.length;u++)(n=i[u]).key===a&&(o?i.splice(u--,1):(o=!0,n.value=s));o||i.push({key:a,value:s}),r.updateURL()},sort:function(){var e,t,n,r=vl(this),i=r.entries,o=i.slice();for(i.length=0,n=0;n<o.length;n++){for(e=o[n],t=0;t<n;t++)if(i[t].key>e.key){i.splice(t,0,e);break}t===n&&i.push(e)}r.updateURL()},forEach:function(e){for(var t,n=vl(this).entries,r=rt(e,arguments.length>1?arguments[1]:void 0,3),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new Al(this,"keys")},values:function(){return new Al(this,"values")},entries:function(){return new Al(this,"entries")}},{enumerable:!0}),ne(Ml,hl,Ml.entries),ne(Ml,"toString",function(){for(var e,t=vl(this).entries,n=[],r=0;r<t.length;)e=t[r++],n.push(xl(e.key)+"="+xl(e.value));return n.join("&")},{enumerable:!0}),an(Ol,"URLSearchParams"),Me({global:!0,forced:!nl},{URLSearchParams:Ol}),nl||"function"!=typeof fl||"function"!=typeof pl||Me({global:!0,enumerable:!0,forced:!0},{fetch:function(e){var t,n,r,i=[e];return arguments.length>1&&(m(t=arguments[1])&&(n=t.body,"URLSearchParams"===Tt(n)&&((r=t.headers?new pl(t.headers):new pl).has("content-type")||r.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),t=qt(t,{body:c(0,String(n)),headers:c(0,r)}))),i.push(t)),fl.apply(this,i)}});var Dl,Ll={URLSearchParams:Ol,getState:vl},Pl=Jt.codeAt,Nl=i.URL,Ul=Ll.URLSearchParams,Fl=Ll.getState,jl=te.set,Gl=te.getterFor("URL"),Bl=Math.floor,Vl=Math.pow,ql=/[A-Za-z]/,Hl=/[\d+-.A-Za-z]/,zl=/\d/,Kl=/^(0x|0X)/,Wl=/^[0-7]+$/,Yl=/^\d+$/,Jl=/^[\dA-Fa-f]+$/,Xl=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,Ql=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,Zl=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,$l=/[\u0009\u000A\u000D]/g,ec=function(e,t){var n,r,i;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return"Invalid host";if(!(n=nc(t.slice(1,-1))))return"Invalid host";e.host=n}else if(cc(e)){if(t=function(e){var t,n,r=[],i=e.toLowerCase().replace(il,".").split(".");for(t=0;t<i.length;t++)n=i[t],r.push(rl.test(n)?"xn--"+cl(n):n);return r.join(".")}(t),Xl.test(t))return"Invalid host";if(null===(n=tc(t)))return"Invalid host";e.host=n}else{if(Ql.test(t))return"Invalid host";for(n="",r=It(t),i=0;i<r.length;i++)n+=uc(r[i],ic);e.host=n}},tc=function(e){var t,n,r,i,o,a,s,u=e.split(".");if(u.length&&""==u[u.length-1]&&u.pop(),(t=u.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=u[r]))return e;if(o=10,i.length>1&&"0"==i.charAt(0)&&(o=Kl.test(i)?16:8,i=i.slice(8==o?1:2)),""===i)a=0;else{if(!(10==o?Yl:8==o?Wl:Jl).test(i))return e;a=parseInt(i,o)}n.push(a)}for(r=0;r<t;r++)if(a=n[r],r==t-1){if(a>=Vl(256,5-t))return null}else if(a>255)return null;for(s=n.pop(),r=0;r<n.length;r++)s+=n[r]*Vl(256,3-r);return s},nc=function(e){var t,n,r,i,o,a,s,u=[0,0,0,0,0,0,0,0],l=0,c=null,d=0,f=function(){return e.charAt(d)};if(":"==f()){if(":"!=e.charAt(1))return;d+=2,c=++l}for(;f();){if(8==l)return;if(":"!=f()){for(t=n=0;n<4&&Jl.test(f());)t=16*t+parseInt(f(),16),d++,n++;if("."==f()){if(0==n)return;if(d-=n,l>6)return;for(r=0;f();){if(i=null,r>0){if(!("."==f()&&r<4))return;d++}if(!zl.test(f()))return;for(;zl.test(f());){if(o=parseInt(f(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;d++}u[l]=256*u[l]+i,2!=++r&&4!=r||l++}if(4!=r)return;break}if(":"==f()){if(d++,!f())return}else if(f())return;u[l++]=t}else{if(null!==c)return;d++,c=++l}}if(null!==c)for(a=l-c,l=7;0!=l&&a>0;)s=u[l],u[l--]=u[c+a-1],u[c+--a]=s;else if(8!=l)return;return u},rc=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)t.unshift(e%256),e=Bl(e/256);return t.join(".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,o=0;o<8;o++)0!==e[o]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=e[n].toString(16),n<7&&(t+=":")));return"["+t+"]"}return e},ic={},oc=el({},ic,{" ":1,'"':1,"<":1,">":1,"`":1}),ac=el({},oc,{"#":1,"?":1,"{":1,"}":1}),sc=el({},ac,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),uc=function(e,t){var n=Pl(e,0);return n>32&&n<127&&!b(t,e)?e:encodeURIComponent(e)},lc={ftp:21,file:null,http:80,https:443,ws:80,wss:443},cc=function(e){return b(lc,e.scheme)},dc=function(e){return""!=e.username||""!=e.password},fc=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},pc=function(e,t){var n;return 2==e.length&&ql.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)},hc=function(e){var t;return e.length>1&&pc(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},gc=function(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&pc(t[0],!0)||t.pop()},vc=function(e){return"."===e||"%2e"===e.toLowerCase()},mc={},yc={},_c={},bc={},Sc={},kc={},wc={},Ec={},Tc={},xc={},Cc={},Ic={},Rc={},Ac={},Oc={},Mc={},Dc={},Lc={},Pc={},Nc={},Uc={},Fc=function(e,t,n,r){var i,o,a,s,u,l=n||mc,c=0,d="",f=!1,p=!1,h=!1;for(n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(Zl,"")),t=t.replace($l,""),i=It(t);c<=i.length;){switch(o=i[c],l){case mc:if(!o||!ql.test(o)){if(n)return"Invalid scheme";l=_c;continue}d+=o.toLowerCase(),l=yc;break;case yc:if(o&&(Hl.test(o)||"+"==o||"-"==o||"."==o))d+=o.toLowerCase();else{if(":"!=o){if(n)return"Invalid scheme";d="",l=_c,c=0;continue}if(n&&(cc(e)!=b(lc,d)||"file"==d&&(dc(e)||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=d,n)return void(cc(e)&&lc[e.scheme]==e.port&&(e.port=null));d="","file"==e.scheme?l=Ac:cc(e)&&r&&r.scheme==e.scheme?l=bc:cc(e)?l=Ec:"/"==i[c+1]?(l=Sc,c++):(e.cannotBeABaseURL=!0,e.path.push(""),l=Pc)}break;case _c:if(!r||r.cannotBeABaseURL&&"#"!=o)return"Invalid scheme";if(r.cannotBeABaseURL&&"#"==o){e.scheme=r.scheme,e.path=r.path.slice(),e.query=r.query,e.fragment="",e.cannotBeABaseURL=!0,l=Uc;break}l="file"==r.scheme?Ac:kc;continue;case bc:if("/"!=o||"/"!=i[c+1]){l=kc;continue}l=Tc,c++;break;case Sc:if("/"==o){l=xc;break}l=Lc;continue;case kc:if(e.scheme=r.scheme,o==Dl)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query;else if("/"==o||"\\"==o&&cc(e))l=wc;else if("?"==o)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query="",l=Nc;else{if("#"!=o){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.path.pop(),l=Lc;continue}e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query,e.fragment="",l=Uc}break;case wc:if(!cc(e)||"/"!=o&&"\\"!=o){if("/"!=o){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,l=Lc;continue}l=xc}else l=Tc;break;case Ec:if(l=Tc,"/"!=o||"/"!=d.charAt(c+1))continue;c++;break;case Tc:if("/"!=o&&"\\"!=o){l=xc;continue}break;case xc:if("@"==o){f&&(d="%40"+d),f=!0,a=It(d);for(var g=0;g<a.length;g++){var v=a[g];if(":"!=v||h){var m=uc(v,sc);h?e.password+=m:e.username+=m}else h=!0}d=""}else if(o==Dl||"/"==o||"?"==o||"#"==o||"\\"==o&&cc(e)){if(f&&""==d)return"Invalid authority";c-=It(d).length+1,d="",l=Cc}else d+=o;break;case Cc:case Ic:if(n&&"file"==e.scheme){l=Mc;continue}if(":"!=o||p){if(o==Dl||"/"==o||"?"==o||"#"==o||"\\"==o&&cc(e)){if(cc(e)&&""==d)return"Invalid host";if(n&&""==d&&(dc(e)||null!==e.port))return;if(s=ec(e,d))return s;if(d="",l=Dc,n)return;continue}"["==o?p=!0:"]"==o&&(p=!1),d+=o}else{if(""==d)return"Invalid host";if(s=ec(e,d))return s;if(d="",l=Rc,n==Ic)return}break;case Rc:if(!zl.test(o)){if(o==Dl||"/"==o||"?"==o||"#"==o||"\\"==o&&cc(e)||n){if(""!=d){var y=parseInt(d,10);if(y>65535)return"Invalid port";e.port=cc(e)&&y===lc[e.scheme]?null:y,d=""}if(n)return;l=Dc;continue}return"Invalid port"}d+=o;break;case Ac:if(e.scheme="file","/"==o||"\\"==o)l=Oc;else{if(!r||"file"!=r.scheme){l=Lc;continue}if(o==Dl)e.host=r.host,e.path=r.path.slice(),e.query=r.query;else if("?"==o)e.host=r.host,e.path=r.path.slice(),e.query="",l=Nc;else{if("#"!=o){hc(i.slice(c).join(""))||(e.host=r.host,e.path=r.path.slice(),gc(e)),l=Lc;continue}e.host=r.host,e.path=r.path.slice(),e.query=r.query,e.fragment="",l=Uc}}break;case Oc:if("/"==o||"\\"==o){l=Mc;break}r&&"file"==r.scheme&&!hc(i.slice(c).join(""))&&(pc(r.path[0],!0)?e.path.push(r.path[0]):e.host=r.host),l=Lc;continue;case Mc:if(o==Dl||"/"==o||"\\"==o||"?"==o||"#"==o){if(!n&&pc(d))l=Lc;else if(""==d){if(e.host="",n)return;l=Dc}else{if(s=ec(e,d))return s;if("localhost"==e.host&&(e.host=""),n)return;d="",l=Dc}continue}d+=o;break;case Dc:if(cc(e)){if(l=Lc,"/"!=o&&"\\"!=o)continue}else if(n||"?"!=o)if(n||"#"!=o){if(o!=Dl&&(l=Lc,"/"!=o))continue}else e.fragment="",l=Uc;else e.query="",l=Nc;break;case Lc:if(o==Dl||"/"==o||"\\"==o&&cc(e)||!n&&("?"==o||"#"==o)){if(".."===(u=(u=d).toLowerCase())||"%2e."===u||".%2e"===u||"%2e%2e"===u?(gc(e),"/"==o||"\\"==o&&cc(e)||e.path.push("")):vc(d)?"/"==o||"\\"==o&&cc(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&pc(d)&&(e.host&&(e.host=""),d=d.charAt(0)+":"),e.path.push(d)),d="","file"==e.scheme&&(o==Dl||"?"==o||"#"==o))for(;e.path.length>1&&""===e.path[0];)e.path.shift();"?"==o?(e.query="",l=Nc):"#"==o&&(e.fragment="",l=Uc)}else d+=uc(o,ac);break;case Pc:"?"==o?(e.query="",l=Nc):"#"==o?(e.fragment="",l=Uc):o!=Dl&&(e.path[0]+=uc(o,ic));break;case Nc:n||"#"!=o?o!=Dl&&("'"==o&&cc(e)?e.query+="%27":e.query+="#"==o?"%23":uc(o,ic)):(e.fragment="",l=Uc);break;case Uc:o!=Dl&&(e.fragment+=uc(o,oc))}c++}},jc=function(e){var t,n,r=xi(this,jc,"URL"),i=arguments.length>1?arguments[1]:void 0,o=String(e),s=jl(r,{type:"URL"});if(void 0!==i)if(i instanceof jc)t=Gl(i);else if(n=Fc(t={},String(i)))throw TypeError(n);if(n=Fc(s,o,null,t))throw TypeError(n);var u=s.searchParams=new Ul,l=Fl(u);l.updateSearchParams(s.query),l.updateURL=function(){s.query=String(u)||null},a||(r.href=Bc.call(r),r.origin=Vc.call(r),r.protocol=qc.call(r),r.username=Hc.call(r),r.password=zc.call(r),r.host=Kc.call(r),r.hostname=Wc.call(r),r.port=Yc.call(r),r.pathname=Jc.call(r),r.search=Xc.call(r),r.searchParams=Qc.call(r),r.hash=Zc.call(r))},Gc=jc.prototype,Bc=function(){var e=Gl(this),t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,a=e.path,s=e.query,u=e.fragment,l=t+":";return null!==i?(l+="//",dc(e)&&(l+=n+(r?":"+r:"")+"@"),l+=rc(i),null!==o&&(l+=":"+o)):"file"==t&&(l+="//"),l+=e.cannotBeABaseURL?a[0]:a.length?"/"+a.join("/"):"",null!==s&&(l+="?"+s),null!==u&&(l+="#"+u),l},Vc=function(){var e=Gl(this),t=e.scheme,n=e.port;if("blob"==t)try{return new URL(t.path[0]).origin}catch(e){return"null"}return"file"!=t&&cc(e)?t+"://"+rc(e.host)+(null!==n?":"+n:""):"null"},qc=function(){return Gl(this).scheme+":"},Hc=function(){return Gl(this).username},zc=function(){return Gl(this).password},Kc=function(){var e=Gl(this),t=e.host,n=e.port;return null===t?"":null===n?rc(t):rc(t)+":"+n},Wc=function(){var e=Gl(this).host;return null===e?"":rc(e)},Yc=function(){var e=Gl(this).port;return null===e?"":String(e)},Jc=function(){var e=Gl(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},Xc=function(){var e=Gl(this).query;return e?"?"+e:""},Qc=function(){return Gl(this).searchParams},Zc=function(){var e=Gl(this).fragment;return e?"#"+e:""},$c=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(a&&Ut(Gc,{href:$c(Bc,function(e){var t=Gl(this),n=String(e),r=Fc(t,n);if(r)throw TypeError(r);Fl(t.searchParams).updateSearchParams(t.query)}),origin:$c(Vc),protocol:$c(qc,function(e){var t=Gl(this);Fc(t,String(e)+":",mc)}),username:$c(Hc,function(e){var t=Gl(this),n=It(String(e));if(!fc(t)){t.username="";for(var r=0;r<n.length;r++)t.username+=uc(n[r],sc)}}),password:$c(zc,function(e){var t=Gl(this),n=It(String(e));if(!fc(t)){t.password="";for(var r=0;r<n.length;r++)t.password+=uc(n[r],sc)}}),host:$c(Kc,function(e){var t=Gl(this);t.cannotBeABaseURL||Fc(t,String(e),Cc)}),hostname:$c(Wc,function(e){var t=Gl(this);t.cannotBeABaseURL||Fc(t,String(e),Ic)}),port:$c(Yc,function(e){var t=Gl(this);fc(t)||(""==(e=String(e))?t.port=null:Fc(t,e,Rc))}),pathname:$c(Jc,function(e){var t=Gl(this);t.cannotBeABaseURL||(t.path=[],Fc(t,e+"",Dc))}),search:$c(Xc,function(e){var t=Gl(this);""==(e=String(e))?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",Fc(t,e,Nc)),Fl(t.searchParams).updateSearchParams(t.query)}),searchParams:$c(Qc),hash:$c(Zc,function(e){var t=Gl(this);""!=(e=String(e))?("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",Fc(t,e,Uc)):t.fragment=null})}),ne(Gc,"toJSON",function(){return Bc.call(this)},{enumerable:!0}),ne(Gc,"toString",function(){return Bc.call(this)},{enumerable:!0}),Nl){var ed=Nl.createObjectURL,td=Nl.revokeObjectURL;ed&&ne(jc,"createObjectURL",function(e){return ed.apply(Nl,arguments)}),td&&ne(jc,"revokeObjectURL",function(e){return td.apply(Nl,arguments)})}an(jc,"URL"),Me({global:!0,forced:!nl,sham:!a},{URL:jc});var nd={JSON:{TYPE:{C2C:{NOTICE:1,COMMON:9,EVENT:10},GROUP:{COMMON:3,TIP:4,SYSTEM:5,TIP2:6},FRIEND:{NOTICE:7},PROFILE:{NOTICE:8}},SUBTYPE:{C2C:{COMMON:0,READED:92,KICKEDOUT:96},GROUP:{COMMON:0,LOVEMESSAGE:1,TIP:2,REDPACKET:3}},OPTIONS:{GROUP:{JOIN:1,QUIT:2,KICK:3,SET_ADMIN:4,CANCEL_ADMIN:5,MODIFY_GROUP_INFO:6,MODIFY_MEMBER_INFO:7}}},PROTOBUF:{},IMAGE_TYPES:{ORIGIN:1,LARGE:2,SMALL:3},IMAGE_FORMAT:{JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255}},rd={NICK:"Tag_Profile_IM_Nick",GENDER:"Tag_Profile_IM_Gender",BIRTHDAY:"Tag_Profile_IM_BirthDay",LOCATION:"Tag_Profile_IM_Location",SELFSIGNATURE:"Tag_Profile_IM_SelfSignature",ALLOWTYPE:"Tag_Profile_IM_AllowType",LANGUAGE:"Tag_Profile_IM_Language",AVATAR:"Tag_Profile_IM_Image",MESSAGESETTINGS:"Tag_Profile_IM_MsgSettings",ADMINFORBIDTYPE:"Tag_Profile_IM_AdminForbidType",LEVEL:"Tag_Profile_IM_Level",ROLE:"Tag_Profile_IM_Role"},id={UNKNOWN:"Gender_Type_Unknown",FEMALE:"Gender_Type_Female",MALE:"Gender_Type_Male"},od={NONE:"AdminForbid_Type_None",SEND_OUT:"AdminForbid_Type_SendOut"},ad={NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_ANY:"AllowType_Type_AllowAny",DENY_ANY:"AllowType_Type_DenyAny"},sd=function(){function e(t){Ln(this,e),this._imageMemoryURL="",this._file=t.file,qa?this.createImageDataASURLInWXMiniApp(t.file):this.createImageDataASURLInWeb(t.file),this._initImageInfoModel(),this.type=En.MSG_IMAGE,this._percent=0,this.content={imageFormat:t.imageFormat||nd.IMAGE_FORMAT.UNKNOWN,uuid:t.uuid,imageInfoArray:[]},this.initImageInfoArray(t.imageInfoArray),this._defaultImage="http://imgcache.qq.com/open/qcloud/video/act/webim-images/default.jpg",this._autoFixUrl()}return Nn(e,[{key:"_initImageInfoModel",value:function(){var e=this;this._ImageInfoModel=function(t){this.instanceID=Fs(9999999),this.sizeType=t.type||0,this.type=0,this.size=t.size||0,this.width=t.width||0,this.height=t.height||0,this.imageUrl=t.url||"",this.url=t.url||e._imageMemoryURL||e._defaultImage},this._ImageInfoModel.prototype={setSizeType:function(e){this.sizeType=e},setType:function(e){this.type=e},setImageUrl:function(e){e&&(this.imageUrl=e)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(e){for(var t=0,n=null,r=null;t<=2;)r=xs(e)||xs(e[t])?{type:0,size:0,width:0,height:0,url:""}:e[t],(n=new this._ImageInfoModel(r)).setSizeType(t+1),n.setType(t),this.addImageInfo(n),t++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(e){for(var t,n=this.content.imageInfoArray.length,r=0;r<n;r++)t=this.content.imageInfoArray[r],e[r].size&&(t.size=e[r].size),e[r].url&&t.setImageUrl(e[r].url),e[r].width&&(t.width=e[r].width),e[r].height&&(t.height=e[r].height)}},{key:"_autoFixUrl",value:function(){for(var e=this.content.imageInfoArray.length,t="",n="",r=["http","https"],i=null,o=0;o<e;o++)this.content.imageInfoArray[o].url&&""!==(i=this.content.imageInfoArray[o]).imageUrl&&(n=i.imageUrl.slice(0,i.imageUrl.indexOf("://")+1),t=i.imageUrl.slice(i.imageUrl.indexOf("://")+1),r.indexOf(n)<0&&(n="https:"),this.content.imageInfoArray[o].setImageUrl([n,t].join("")))}},{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateImageFormat",value:function(e){this.content.imageFormat=nd.IMAGE_FORMAT[e.toUpperCase()]||nd.IMAGE_FORMAT.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(e){void 0!==e&&e.files.length>0&&(this._imageMemoryURL=window.URL.createObjectURL(e.files[0]))}},{key:"createImageDataASURLInWXMiniApp",value:function(e){e&&e.url&&(this._imageMemoryURL=e.url)}},{key:"replaceImageInfo",value:function(e,t){this.content.imageInfoArray[t]instanceof this._ImageInfoModel||(this.content.imageInfoArray[t]=e)}},{key:"addImageInfo",value:function(e){this.content.imageInfoArray.length>=3||this.content.imageInfoArray.push(e)}},{key:"updateAccessSideImageInfoArray",value:function(){var e=this.content.imageInfoArray,t=e[0],n=t.width,r=void 0===n?0:n,i=t.height,o=void 0===i?0:i;0!==r&&0!==o&&(eu(e),Object.assign(e[2],$s({originWidth:r,originHeight:o,min:720})))}},{key:"sendable",value:function(){return 0!==this.content.imageInfoArray.length&&""!==this.content.imageInfoArray[0].imageUrl&&0!==this.content.imageInfoArray[0].size}}]),e}(),ud=function(){function e(t){Ln(this,e),this.type=En.MSG_FACE,this.content=t||null}return Nn(e,[{key:"sendable",value:function(){return null!==this.content}}]),e}(),ld=function(){function e(t){Ln(this,e),this.type=En.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:t.second,size:t.size,url:t.url,remoteAudioUrl:"",uuid:t.uuid}}return Nn(e,[{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateAudioUrl",value:function(e){this.content.remoteAudioUrl=e}},{key:"sendable",value:function(){return""!==this.content.remoteAudioUrl}}]),e}();Me({target:"Object",stat:!0,forced:!a,sham:!a},{defineProperty:R.f});var cd={from:!0,groupID:!0,groupName:!0,to:!0},dd=function(){function e(t){Ln(this,e),this.type=En.MSG_GRP_TIP,this.content={},this._initContent(t)}return Nn(e,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach(function(n){switch(n){case"remarkInfo":break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;case"operatorInfo":case"memberInfoList":break;case"msgMemberInfo":t.content.memberList=e[n],Object.defineProperty(t.content,"msgMemberInfo",{get:function(){return _s.warn("!!! 禁言的群提示消息中的 payload.msgMemberInfo 属性即将废弃，请使用 payload.memberList 属性替代。 \n","msgMemberInfo 中的 shutupTime 属性对应更改为 memberList 中的 muteTime 属性，表示禁言时长。 \n","参考：群提示消息 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/Message.html#.GroupTipPayload"),t.content.memberList.map(function(e){return{userID:e.userID,shutupTime:e.muteTime}})}});break;case"onlineMemberInfo":break;case"memberNum":t.content[n]=e[n],t.content.memberCount=e[n];break;default:t.content[n]=e[n]}}),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var r=t[n];cd[r]&&(this.content.groupProfile[r]=e[r])}}}]),e}(),fd={from:!0,groupID:!0,name:!0,to:!0},pd=function(){function e(t){Ln(this,e),this.type=En.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(t)}return Nn(e,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach(function(n){switch(n){case"memberInfoList":break;case"remarkInfo":t.content.handleMessage=e[n];break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;default:t.content[n]=e[n]}})}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var r=t[n];fd[r]&&(this.content.groupProfile[r]=e[r])}}}]),e}(),hd=Math.min,gd=[].lastIndexOf,vd=!!gd&&1/[1].lastIndexOf(1,-0)<0,md=st("lastIndexOf"),yd=dt("indexOf",{ACCESSORS:!0,1:0}),_d=!vd&&md&&yd?gd:function(e){if(vd)return gd.apply(this,arguments)||0;var t=v(this),n=ce(t.length),r=n-1;for(arguments.length>1&&(r=hd(r,ue(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1};Me({target:"Array",proto:!0,forced:_d!==[].lastIndexOf},{lastIndexOf:_d});var bd="https://cloud.tencent.com/document/product/",Sd="您可以在即时通信 IM 控制台的【开发辅助工具(https://console.cloud.tencent.com/im-detail/tool-usersig)】页面校验 UserSig。",kd="UserSig 非法，请使用官网提供的 API 重新生成 UserSig(".concat(bd,"269/32688)。"),wd={70001:"UserSig 已过期，请重新生成。建议 UserSig 有效期设置不小于24小时。",70002:"UserSig 长度为0，请检查传入的 UserSig 是否正确。",70003:kd,70005:kd,70009:"UserSig 验证失败，可能因为生成 UserSig 时混用了其他 SDKAppID 的私钥或密钥导致，请使用对应 SDKAppID 下的私钥或密钥重新生成 UserSig(".concat(bd,"269/32688)。"),70013:"请求中的 UserID 与生成 UserSig 时使用的 UserID 不匹配。".concat(Sd),70014:"请求中的 SDKAppID 与生成 UserSig 时使用的 SDKAppID 不匹配。".concat(Sd),70016:"密钥不存在，UserSig 验证失败，请在即时通信 IM 控制台获取密钥(".concat(bd,"269/32578#.E8.8E.B7.E5.8F.96.E5.AF.86.E9.92.A5)。"),70020:"SDKAppID 未找到，请在即时通信 IM 控制台确认应用信息。",70050:"UserSig 验证次数过于频繁。请检查 UserSig 是否正确，并于1分钟后重新验证。".concat(Sd),70051:"帐号被拉入黑名单。",70052:"UserSig 已经失效，请重新生成，再次尝试。",70107:"因安全原因被限制登录，请不要频繁登录。",70169:"请求的用户帐号不存在。",70114:"".concat("服务端内部超时，请稍后重试。"),70202:"".concat("服务端内部超时，请稍后重试。"),70206:"请求中批量数量不合法。",70402:"参数非法，请检查必填字段是否填充，或者字段的填充是否满足协议要求。",70403:"请求失败，需要 App 管理员权限。",70398:"帐号数超限。如需创建多于100个帐号，请将应用升级为专业版，具体操作指引请参见购买指引(".concat(bd,"269/32458)。"),70500:"".concat("服务端内部错误，请重试。"),71000:"删除帐号失败。仅支持删除体验版帐号，您当前应用为专业版，暂不支持帐号删除。",20001:"请求包非法。",20002:"UserSig 或 A2 失效。",20003:"消息发送方或接收方 UserID 无效或不存在，请检查 UserID 是否已导入即时通信 IM。",20004:"网络异常，请重试。",20005:"".concat("服务端内部错误，请重试。"),20006:"触发发送".concat("单聊消息","之前回调，App 后台返回禁止下发该消息。"),20007:"发送".concat("单聊消息","，被对方拉黑，禁止发送。消息发送状态默认展示为失败，您可以登录控制台修改该场景下的消息发送状态展示结果，具体操作请参见消息保留设置(").concat(bd,"269/38656)。"),20009:"消息发送双方互相不是好友，禁止发送（配置".concat("单聊消息","校验好友关系才会出现）。"),20010:"发送".concat("单聊消息","，自己不是对方的好友（单向关系），禁止发送。"),20011:"发送".concat("单聊消息","，对方不是自己的好友（单向关系），禁止发送。"),20012:"发送方被禁言，该条消息被禁止发送。",20016:"消息撤回超过了时间限制（默认2分钟）。",20018:"删除漫游内部错误。",90001:"JSON 格式解析失败，请检查请求包是否符合 JSON 规范。",90002:"".concat("JSON 格式请求包体","中 MsgBody 不符合消息格式描述，或者 MsgBody 不是 Array 类型，请参考 TIMMsgElement 对象的定义(").concat(bd,"269/2720#.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0-timmsgelement)。"),90003:"".concat("JSON 格式请求包体","中缺少 To_Account 字段或者 To_Account 帐号不存在。"),90005:"".concat("JSON 格式请求包体","中缺少 MsgRandom 字段或者 MsgRandom 字段不是 Integer 类型。"),90006:"".concat("JSON 格式请求包体","中缺少 MsgTimeStamp 字段或者 MsgTimeStamp 字段不是 Integer 类型。"),90007:"".concat("JSON 格式请求包体","中 MsgBody 类型不是 Array 类型，请将其修改为 Array 类型。"),90008:"".concat("JSON 格式请求包体","中缺少 From_Account 字段或者 From_Account 帐号不存在。"),90009:"请求需要 App 管理员权限。",90010:"".concat("JSON 格式请求包体","不符合消息格式描述，请参考 TIMMsgElement 对象的定义(").concat(bd,"269/2720#.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0-timmsgelement)。"),90011:"批量发消息目标帐号超过500，请减少 To_Account 中目标帐号数量。",90012:"To_Account 没有注册或不存在，请确认 To_Account 是否导入即时通信 IM 或者是否拼写错误。",90026:"消息离线存储时间错误（最多不能超过7天）。",90031:"".concat("JSON 格式请求包体","中 SyncOtherMachine 字段不是 Integer 类型。"),90044:"".concat("JSON 格式请求包体","中 MsgLifeTime 字段不是 Integer 类型。"),90048:"请求的用户帐号不存在。",90054:"撤回请求中的 MsgKey 不合法。",90994:"".concat("服务端内部错误，请重试。"),90995:"".concat("服务端内部错误，请重试。"),91000:"".concat("服务端内部错误，请重试。"),90992:"".concat("服务端内部错误，请重试。","如果所有请求都返回该错误码，且 App 配置了第三方回调，请检查 App 服务端是否正常向即时通信 IM 后台服务端返回回调结果。"),93000:"JSON 数据包超长，消息包体请不要超过8k。",91101:"Web 端长轮询被踢（Web 端同时在线实例个数超出限制）。",10002:"".concat("服务端内部错误，请重试。"),10003:"请求中的接口名称错误，请核对接口名称并重试。",10004:"参数非法，请根据错误描述检查请求是否正确。",10005:"请求包体中携带的帐号数量过多。",10006:"操作频率限制，请尝试降低调用的频率。",10007:"操作权限不足，例如 Work ".concat("群组","中普通成员尝试执行踢人操作，但只有 App 管理员才有权限。"),10008:"请求非法，可能是请求中携带的签名信息验证不正确，请再次尝试。",10009:"该群不允许群主主动退出。",10010:"".concat("群组","不存在，或者曾经存在过，但是目前已经被解散。"),10011:"解析 JSON 包体失败，请检查包体的格式是否符合 JSON 格式。",10012:"发起操作的 UserID 非法，请检查发起操作的用户 UserID 是否填写正确。",10013:"被邀请加入的用户已经是群成员。",10014:"群已满员，无法将请求中的用户加入".concat("群组","，如果是批量加人，可以尝试减少加入用户的数量。"),10015:"找不到指定 ID 的".concat("群组","。"),10016:"App 后台通过第三方回调拒绝本次操作。",10017:"因被禁言而不能发送消息，请检查发送者是否被设置禁言。",10018:"应答包长度超过最大包长（1MB），请求的内容过多，请尝试减少单次请求的数据量。",10019:"请求的用户帐号不存在。",10021:"".concat("群组"," ID 已被使用，请选择其他的").concat("群组"," ID。"),10023:"发消息的频率超限，请延长两次发消息时间的间隔。",10024:"此邀请或者申请请求已经被处理。",10025:"".concat("群组"," ID 已被使用，并且操作者为群主，可以直接使用。"),10026:"该 SDKAppID 请求的命令字已被禁用。",10030:"请求撤回的消息不存在。",10031:"消息撤回超过了时间限制（默认2分钟）。",10032:"请求撤回的消息不支持撤回操作。",10033:"".concat("群组","类型不支持消息撤回操作。"),10034:"该消息类型不支持删除操作。",10035:"直播群和在线成员广播大群不支持删除消息。",10036:"直播群创建数量超过了限制，请参考价格说明(".concat(bd,"269/11673)购买预付费套餐“IM直播群”。"),10037:"单个用户可创建和加入的".concat("群组","数量超过了限制，请参考价格说明(").concat(bd,"269/11673)购买或升级预付费套餐“单人可创建与加入").concat("群组","数”。"),10038:"群成员数量超过限制，请参考价格说明(".concat(bd,"269/11673)购买或升级预付费套餐“扩展群人数上限”。"),10041:"该应用（SDKAppID）已配置不支持群消息撤回。"},Ed=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;return Ln(this,n),(r=t.call(this)).code=e.code,r.message=wd[e.code]||e.message,r.data=e.data||{},r}return n}(zn(Error)),Td={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,COS_UNDETECTED:2040,MESSAGE_SEND_FAIL:2100,MESSAGE_LIST_CONSTRUCTOR_NEED_OPTIONS:2103,MESSAGE_SEND_NEED_MESSAGE_INSTANCE:2105,MESSAGE_SEND_INVALID_CONVERSATION_TYPE:2106,MESSAGE_FILE_IS_EMPTY:2108,MESSAGE_ONPROGRESS_FUNCTION_ERROR:2109,MESSAGE_REVOKE_FAIL:2110,MESSAGE_IMAGE_SELECT_FILE_FIRST:2251,MESSAGE_IMAGE_TYPES_LIMIT:2252,MESSAGE_IMAGE_SIZE_LIMIT:2253,MESSAGE_AUDIO_UPLOAD_FAIL:2300,MESSAGE_AUDIO_SIZE_LIMIT:2301,MESSAGE_VIDEO_UPLOAD_FAIL:2350,MESSAGE_VIDEO_SIZE_LIMIT:2351,MESSAGE_VIDEO_TYPES_LIMIT:2352,MESSAGE_FILE_UPLOAD_FAIL:2400,MESSAGE_FILE_SELECT_FILE_FIRST:2401,MESSAGE_FILE_SIZE_LIMIT:2402,MESSAGE_FILE_URL_IS_EMPTY:2403,CONVERSATION_NOT_FOUND:2500,USER_OR_GROUP_NOT_FOUND:2501,CONVERSATION_UN_RECORDED_TYPE:2502,ILLEGAL_GROUP_TYPE:2600,CANNOT_JOIN_WORK:2601,CANNOT_CHANGE_OWNER_IN_AVCHATROOM:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,CANNOT_DISMISS_Work:2622,JOIN_GROUP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AVCHATROOM:2661,CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN:2662,CANNOT_KICK_MEMBER_IN_AVCHATROOM:2680,NOT_OWNER:2681,CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM:2682,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,DEL_FRIEND_INVALID_PARAM:2700,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,ADD_BLACKLIST_INVALID_PARAM:2740,DEL_BLACKLIST_INVALID_PARAM:2741,CANNOT_ADD_SELF_TO_BLACKLIST:2742,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NETWORK_BASE_OPTIONS_NO_URL:2802,NETWORK_UNDEFINED_SERVER_NAME:2803,NETWORK_PACKAGE_UNDEFINED:2804,NO_NETWORK:2805,CONVERTOR_IRREGULAR_PARAMS:2900,NOTICE_RUNLOOP_UNEXPECTED_CONDITION:2901,NOTICE_RUNLOOP_OFFSET_LOST:2902,UNCAUGHT_ERROR:2903,GET_LONGPOLL_ID_FAILED:2904,INVALID_OPERATION:2905,SDK_IS_NOT_READY:2999,LONG_POLL_KICK_OUT:91101,MESSAGE_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,LONG_POLL_API_PARAM_ERROR:90001},xd="消息发送失败",Cd="MessageController.constructor() 需要参数 options",Id="无法发送空文件",Rd="回调函数运行时遇到错误，请检查接入侧代码",Ad="文件大小超过100M，无法发送 ",Od="AVChatRoom 类型的群不支持邀请群成员",Md="updateMyProfile 无标配资料字段或自定义资料字段",Dd="不规范的参数名称",Ld="接口需要 SDK 处于 ready 状态后才能调用",Pd=["jpg","jpeg","gif","png","bmp"],Nd=["mp4"],Ud=function(){function e(t){Ln(this,e);var n=this._check(t);if(n instanceof Ed)throw n;this.type=En.MSG_FILE,this._percent=0;var r=this._getFileInfo(t);this.content={downloadFlag:2,fileUrl:t.url||"",uuid:t.uuid,fileName:r.name||"",fileSize:r.size||0}}return Nn(e,[{key:"_getFileInfo",value:function(e){if(e.fileName&&e.fileSize)return{size:e.fileSize,name:e.fileName};if(qa)return{};var t=e.file.files[0];return{size:t.size,name:t.name,type:t.type.slice(t.type.lastIndexOf("/")+1).toLowerCase()}}},{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateFileUrl",value:function(e){this.content.fileUrl=e}},{key:"_check",value:function(e){if(e.size>104857600)return new Ed({code:Td.MESSAGE_FILE_SIZE_LIMIT,message:"".concat(Ad,": ").concat(104857600," bytes")})}},{key:"sendable",value:function(){return""!==this.content.fileUrl&&""!==this.content.fileName&&0!==this.content.fileSize}}]),e}(),Fd=function(){function e(t){Ln(this,e),this.type=En.MSG_CUSTOM,this.content={data:t.data||"",description:t.description||"",extension:t.extension||""}}return Nn(e,[{key:"setData",value:function(e){return this.content.data=e,this}},{key:"setDescription",value:function(e){return this.content.description=e,this}},{key:"setExtension",value:function(e){return this.content.extension=e,this}},{key:"sendable",value:function(){return 0!==this.content.data.length||0!==this.content.description.length||0!==this.content.extension.length}}]),e}(),jd=function(){function e(t){Ln(this,e),this.type=En.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:t.remoteVideoUrl,videoFormat:t.videoFormat,videoSecond:parseInt(t.videoSecond,10),videoSize:t.videoSize,videoUrl:t.videoUrl,videoDownloadFlag:2,videoUUID:t.videoUUID,thumbUUID:t.thumbUUID,thumbFormat:t.thumbFormat,thumbWidth:t.thumbWidth,thumbHeight:t.thumbHeight,thumbSize:t.thumbSize,thumbDownloadFlag:2,thumbUrl:t.thumbUrl}}return Nn(e,[{key:"updatePercent",value:function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{key:"updateVideoUrl",value:function(e){e&&(this.content.remoteVideoUrl=e)}},{key:"sendable",value:function(){return""!==this.content.remoteVideoUrl}}]),e}(),Gd=function e(t){Ln(this,e),this.type=En.MSG_GEO,this.content=t},Bd={1:En.MSG_PRIORITY_HIGH,2:En.MSG_PRIORITY_NORMAL,3:En.MSG_PRIORITY_LOW,4:En.MSG_PRIORITY_LOWEST},Vd=function(){function e(t){Ln(this,e),this.ID="",this.conversationID=t.conversationID||null,this.conversationType=t.conversationType||En.CONV_C2C,this.conversationSubType=t.conversationSubType,this.time=t.time||Math.ceil(Date.now()/1e3),this.sequence=t.sequence||0,this.clientSequence=t.clientSequence||t.sequence||0,this.random=t.random||Fs(),this.priority=this._computePriority(t.priority),this.nick="",this.avatar="",this.isPeerRead=!1,this._elements=[],this.isPlaceMessage=t.isPlaceMessage||0,this.isRevoked=2===t.isPlaceMessage||8===t.msgFlagBits,this.geo={},this.from=t.from||null,this.to=t.to||null,this.flow="",this.isSystemMessage=t.isSystemMessage||!1,this.protocol=t.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=t.status||Ju.SUCCESS,this._onlineOnlyFlag=!1,this.reInitialize(t.currentUser),this.extractGroupInfo(t.groupProfile||null)}return Nn(e,[{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(e){null!==e&&(ks(e.fromAccountNick)&&(this.nick=e.fromAccountNick),ks(e.fromAccountHeadurl)&&(this.avatar=e.fromAccountHeadurl))}},{key:"_initProxy",value:function(){this.payload=this._elements[0].content,this.type=this._elements[0].type}},{key:"reInitialize",value:function(e){e&&(this.status=this.from?Ju.SUCCESS:Ju.UNSEND,!this.from&&(this.from=e)),this._initFlow(e),this._initielizeSequence(e),this._concactConversationID(e),this.generateMessageID(e)}},{key:"isSendable",value:function(){return 0!==this._elements.length&&("function"!=typeof this._elements[0].sendable?(_s.warn("".concat(this._elements[0].type,' need "boolean : sendable()" method')),!1):this._elements[0].sendable())}},{key:"_initTo",value:function(e){this.conversationType===En.CONV_GROUP&&(this.to=e.groupID)}},{key:"_initielizeSequence",value:function(e){0===this.clientSequence&&e&&(this.clientSequence=function(e){if(!e)return _s.error("autoincrementIndex(string: key) need key parameter"),!1;if(void 0===Vs[e]){var t=new Date,n="3".concat(t.getHours()).slice(-2),r="0".concat(t.getMinutes()).slice(-2),i="0".concat(t.getSeconds()).slice(-2);Vs[e]=parseInt([n,r,i,"0001"].join("")),n=null,r=null,i=null,_s.warn("utils.autoincrementIndex() create new sequence : ".concat(e," = ").concat(Vs[e]))}return Vs[e]++}(e)),0===this.sequence&&this.conversationType===En.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(e){var t=e===this.from?1:0,n=this.sequence>0?this.sequence:this.clientSequence;this.ID="".concat(this.conversationID,"-").concat(n,"-").concat(this.random,"-").concat(t)}},{key:"_initFlow",value:function(e){""!==e&&(e===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concactConversationID",value:function(e){var t=this.to,n="",r=this.conversationType;r!==En.CONV_SYSTEM?(n=r===En.CONV_C2C?e===this.from?t:this.from:this.to,this.conversationID="".concat(r).concat(n)):this.conversationID=En.CONV_SYSTEM}},{key:"isElement",value:function(e){return e instanceof Qu||e instanceof sd||e instanceof ud||e instanceof ld||e instanceof Ud||e instanceof jd||e instanceof dd||e instanceof pd||e instanceof Fd||e instanceof Gd}},{key:"setElement",value:function(e){var t=this;if(this.isElement(e))return this._elements=[e],void this._initProxy();var n=function(e){switch(e.type){case En.MSG_TEXT:t.setTextElement(e.content);break;case En.MSG_IMAGE:t.setImageElement(e.content);break;case En.MSG_AUDIO:t.setAudioElement(e.content);break;case En.MSG_FILE:t.setFileElement(e.content);break;case En.MSG_VIDEO:t.setVideoElement(e.content);break;case En.MSG_CUSTOM:t.setCustomElement(e.content);break;case En.MSG_GEO:t.setGEOElement(e.content);break;case En.MSG_GRP_TIP:t.setGroupTipElement(e.content);break;case En.MSG_GRP_SYS_NOTICE:t.setGroupSystemNoticeElement(e.content);break;case En.MSG_FACE:t.setFaceElement(e.content);break;default:_s.warn(e.type,e.content,"no operation......")}};if(Array.isArray(e))for(var r=0;r<e.length;r++)n(e[r]);else n(e);this._initProxy()}},{key:"setTextElement",value:function(e){var t="string"==typeof e?e:e.text,n=new Qu({text:t});this._elements.push(n)}},{key:"setImageElement",value:function(e){var t=new sd(e);this._elements.push(t)}},{key:"setAudioElement",value:function(e){var t=new ld(e);this._elements.push(t)}},{key:"setFileElement",value:function(e){var t=new Ud(e);this._elements.push(t)}},{key:"setVideoElement",value:function(e){var t=new jd(e);this._elements.push(t)}},{key:"setGEOElement",value:function(e){var t=new Gd(e);this._elements.push(t)}},{key:"setCustomElement",value:function(e){var t=new Fd(e);this._elements.push(t)}},{key:"setGroupTipElement",value:function(e){var t={},n=e.operationType;nu(e.memberInfoList)||n!==En.GRP_TIP_MBR_JOIN&&n!==En.GRP_TIP_MBR_KICKED_OUT?e.operatorInfo&&(t=e.operatorInfo):t=e.memberInfoList[0];var r=t,i=r.nick,o=r.avatar;ks(i)&&(this.nick=i),ks(o)&&(this.avatar=o);var a=new dd(e);this._elements.push(a)}},{key:"setGroupSystemNoticeElement",value:function(e){var t=new pd(e);this._elements.push(t)}},{key:"setFaceElement",value:function(e){var t=new ud(e);this._elements.push(t)}},{key:"setIsRead",value:function(e){this.isRead=e}},{key:"setOnlineOnlyFlag",value:function(e){this._onlineOnlyFlag=e}},{key:"getOnlineOnlyFlag",value:function(){return this._onlineOnlyFlag}},{key:"_computePriority",value:function(e){if(xs(e))return En.MSG_PRIORITY_NORMAL;if(ks(e)&&-1!==Object.values(Bd).indexOf(e))return e;if(Ss(e)){var t=""+e;if(-1!==Object.keys(Bd).indexOf(t))return Bd[t]}return En.MSG_PRIORITY_NORMAL}},{key:"elements",get:function(){return _s.warn("！！！Message 实例的 elements 属性即将废弃，请尽快修改。使用 type 和 payload 属性处理单条消息，兼容组合消息使用 _elements 属性！！！"),this._elements}}]),e}(),qd=function(e){return!(!e||!(function(e){return ks(e)&&e.slice(0,3)===En.CONV_C2C}(e)||function(e){return ks(e)&&e.slice(0,5)===En.CONV_GROUP}(e)||Xs(e))&&(console.warn("非法的会话 ID:".concat(e,"。会话 ID 组成方式：C2C + userID（单聊）GROUP + groupID（群聊）@TIM#SYSTEM（系统通知会话）")),1))},Hd="请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#",zd=function(e){return e.param?"".concat(e.api," ").concat(e.param," ").concat(e.desc,"。").concat(Hd).concat(e.api):"".concat(e.api," ").concat(e.desc,"。").concat(Hd).concat(e.api)},Kd={type:"String",required:!0},Wd={type:"Array",required:!0},Yd={type:"Object",required:!0},Jd={login:{userID:Kd,userSig:Kd},addToBlacklist:{userIDList:Wd},on:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(console.warn(zd({api:"on",param:"eventName",desc:"类型必须为 String，且不能为空"})),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(console.warn(zd({api:"on",param:"handler",desc:"参数必须为 Function"})),!1):(""===e.name&&console.warn("on 接口的 handler 参数推荐使用具名函数。具名函数可以使用 off 接口取消订阅，匿名函数无法取消订阅。"),!0)}}],once:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(console.warn(zd({api:"once",param:"eventName",desc:"类型必须为 String，且不能为空"})),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(console.warn(zd({api:"once",param:"handler",desc:"参数必须为 Function"})),!1):(""===e.name&&console.warn("once 接口的 handler 参数推荐使用具名函数。"),!0)}}],off:[{name:"eventName",type:"String",validator:function(e){return"string"==typeof e&&0!==e.length||(console.warn(zd({api:"off",param:"eventName",desc:"类型必须为 String，且不能为空"})),!1)}},{name:"handler",type:"Function",validator:function(e){return"function"!=typeof e?(console.warn(zd({api:"off",param:"handler",desc:"参数必须为 Function"})),!1):(""===e.name&&console.warn("off 接口无法为匿名函数取消监听事件。"),!0)}}],sendMessage:[jn({name:"message"},Yd)],getMessageList:{conversationID:jn(jn({},Kd),{},{validator:function(e){return qd(e)}}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(e){return!(!xs(e)&&!/^[1-9][0-9]*$/.test(e)&&(console.warn(zd({api:"getMessageList",param:"count",desc:"必须为正整数"})),1))}}},setMessageRead:{conversationID:jn(jn({},Kd),{},{validator:function(e){return qd(e)}})},getConversationProfile:[jn(jn({name:"conversationID"},Kd),{},{validator:function(e){return qd(e)}})],deleteConversation:[jn(jn({name:"conversationID"},Kd),{},{validator:function(e){return qd(e)}})],getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:Kd,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:Wd},createGroup:{name:Kd},joinGroup:{groupID:Kd,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[jn({name:"groupID"},Kd)],handleApplication:{message:Yd,handleAction:Kd,handleMessage:{type:"String"}},changeGroupOwner:{groupID:Kd,newOwnerID:Kd},updateGroupProfile:{groupID:Kd,muteAllMembers:{type:"Boolean"}},dismissGroup:[jn({name:"groupID"},Kd)],searchGroupByID:[jn({name:"groupID"},Kd)],getGroupMemberList:{groupID:Kd,offset:{type:"Number"},count:{type:"Number"}},getGroupMemberProfile:{groupID:Kd,userIDList:Wd,memberCustomFieldFilter:{type:"Array"}},addGroupMemeber:{groupID:Kd,userIDList:Wd},setGroupMemberRole:{groupID:Kd,userID:Kd,role:Kd},setGroupMemberMuteTime:{groupID:Kd,userID:Kd,muteTime:{type:"Number",validator:function(e){return e>=0}}},setGroupMemberNameCard:{groupID:Kd,userID:{type:"String"},nameCard:jn(jn({},Kd),{},{validator:function(e){return!0!==/^\s+$/.test(e)}})},setMessageRemindType:{groupID:Kd,messageRemindType:Kd},setGroupMemberCustomField:{groupID:Kd,userID:{type:"String"},memberCustomField:Wd},deleteGroupMember:{groupID:Kd},createTextMessage:{to:Kd,conversationType:Kd,payload:jn(jn({},Yd),{},{validator:function(e){return Es(e)?ks(e.text)?0!==e.text.length||(console.warn(zd({api:"createTextMessage",desc:"消息内容不能为空"})),!1):(console.warn(zd({api:"createTextMessage",param:"payload.text",desc:"类型必须为 String"})),!1):(console.warn(zd({api:"createTextMessage",param:"payload",desc:"类型必须为 plain object"})),!1)}})},createCustomMessage:{to:Kd,conversationType:Kd,payload:jn(jn({},Yd),{},{validator:function(e){return Es(e)?e.data&&!ks(e.data)?(console.warn(zd({api:"createCustomMessage",param:"payload.data",desc:"类型必须为 String"})),!1):e.description&&!ks(e.description)?(console.warn(zd({api:"createCustomMessage",param:"payload.description",desc:"类型必须为 String"})),!1):!(e.extension&&!ks(e.extension)&&(console.warn(zd({api:"createCustomMessage",param:"payload.extension",desc:"类型必须为 String"})),1)):(console.warn(zd({api:"createCustomMessage",param:"payload",desc:"类型必须为 plain object"})),!1)}})},createImageMessage:{to:Kd,conversationType:Kd,payload:jn(jn({},Yd),{},{validator:function(e){if(!Es(e))return console.warn(zd({api:"createImageMessage",param:"payload",desc:"类型必须为 plain object"})),!1;if(xs(e.file))return console.warn(zd({api:"createImageMessage",param:"payload.file",desc:"不能为 undefined"})),!1;if(Ua){if(!(e.file instanceof HTMLInputElement||bs(e.file)))return console.warn(zd({api:"createImageMessage",param:"payload.file",desc:"类型必须是 HTMLInputElement 或 File"})),!1;if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return console.warn(zd({api:"createImageMessage",param:"payload.file",desc:"您没有选择文件，无法发送"})),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(e){return xs(e)&&console.warn(zd({api:"createImageMessage",desc:"没有 onProgress 回调，您将无法获取上传进度"})),!0}}})},createAudioMessage:{to:Kd,conversationType:Kd,payload:jn(jn({},Yd),{},{validator:function(e){return!!Es(e)||(console.warn(zd({api:"createAudioMessage",param:"payload",desc:"类型必须为 plain object"})),!1)}}),onProgress:{type:"Function",required:!1,validator:function(e){return xs(e)&&console.warn(zd({api:"createAudioMessage",desc:"没有 onProgress 回调，您将无法获取上传进度"})),!0}}},createVideoMessage:{to:Kd,conversationType:Kd,payload:jn(jn({},Yd),{},{validator:function(e){if(!Es(e))return console.warn(zd({api:"createVideoMessage",param:"payload",desc:"类型必须为 plain object"})),!1;if(xs(e.file))return console.warn(zd({api:"createVideoMessage",param:"payload.file",desc:"不能为 undefined"})),!1;if(Ua){if(!(e.file instanceof HTMLInputElement||bs(e.file)))return console.warn(zd({api:"createVideoMessage",param:"payload.file",desc:"类型必须是 HTMLInputElement 或 File"})),!1;if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return console.warn(zd({api:"createVideoMessage",param:"payload.file",desc:"您没有选择文件，无法发送"})),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e){return xs(e)&&console.warn(zd({api:"createVideoMessage",desc:"没有 onProgress 回调，您将无法获取上传进度"})),!0}}},createFaceMessage:{to:Kd,conversationType:Kd,payload:jn(jn({},Yd),{},{validator:function(e){return Es(e)?Ss(e.index)?!!ks(e.data)||(console.warn(zd({api:"createFaceMessage",param:"payload.data",desc:"类型必须为 String"})),!1):(console.warn(zd({api:"createFaceMessage",param:"payload.index",desc:"类型必须为 Number"})),!1):(console.warn(zd({api:"createFaceMessage",param:"payload",desc:"类型必须为 plain object"})),!1)}})},createFileMessage:{to:Kd,conversationType:Kd,payload:jn(jn({},Yd),{},{validator:function(e){if(!Es(e))return console.warn(zd({api:"createFileMessage",param:"payload",desc:"类型必须为 plain object"})),!1;if(xs(e.file))return console.warn(zd({api:"createFileMessage",param:"payload.file",desc:"不能为 undefined"})),!1;if(Ua){if(!(e.file instanceof HTMLInputElement||bs(e.file)))return console.warn(zd({api:"createFileMessage",param:"payload.file",desc:"类型必须是 HTMLInputElement 或 File"})),!1;if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return console.warn(zd({api:"createFileMessage",desc:"您没有选择文件，无法发送"})),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e){return xs(e)&&console.warn(zd({api:"createFileMessage",desc:"没有 onProgress 回调，您将无法获取上传进度"})),!0}}},revokeMessage:[jn(jn({name:"message"},Yd),{},{validator:function(e){return e instanceof Vd?e.conversationType===En.CONV_SYSTEM?(console.warn("revokeMessage 不能撤回系统会话消息，只能撤回单聊消息或群消息"),!1):!0!==e.isRevoked||(console.warn("revokeMessage 消息已经被撤回，请勿重复操作"),!1):(console.warn("revokeMessage 参数 message 必须为 Message(".concat(Hd,"Message.html) 实例。")),!1)}})],getUserProfile:{userIDList:{type:"Array",validator:function(e){return Ts(e)?(0===e.length&&console.warn(zd({api:"getUserProfile",param:"userIDList",desc:"不能为空数组"})),!0):(console.warn(zd({api:"getUserProfile",param:"userIDList",desc:"必须为数组"})),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(e){return!!xs(e)||!!Ts(e)||(console.warn(zd({api:"updateMyProfile",param:"profileCustomField",desc:"必须为数组"})),!1)}}}},Xd={login:"login",logout:"logout",on:"on",once:"once",off:"off",setLogLevel:"setLogLevel",registerPlugin:"registerPlugin",destroy:"destroy",createTextMessage:"createTextMessage",createImageMessage:"createImageMessage",createAudioMessage:"createAudioMessage",createVideoMessage:"createVideoMessage",createCustomMessage:"createCustomMessage",createFaceMessage:"createFaceMessage",createFileMessage:"createFileMessage",sendMessage:"sendMessage",resendMessage:"resendMessage",getMessageList:"getMessageList",setMessageRead:"setMessageRead",revokeMessage:"revokeMessage",getConversationList:"getConversationList",getConversationProfile:"getConversationProfile",deleteConversation:"deleteConversation",getGroupList:"getGroupList",getGroupProfile:"getGroupProfile",createGroup:"createGroup",joinGroup:"joinGroup",updateGroupProfile:"updateGroupProfile",quitGroup:"quitGroup",dismissGroup:"dismissGroup",changeGroupOwner:"changeGroupOwner",searchGroupByID:"searchGroupByID",setMessageRemindType:"setMessageRemindType",handleGroupApplication:"handleGroupApplication",getGroupMemberProfile:"getGroupMemberProfile",getGroupMemberList:"getGroupMemberList",addGroupMember:"addGroupMember",deleteGroupMember:"deleteGroupMember",setGroupMemberNameCard:"setGroupMemberNameCard",setGroupMemberMuteTime:"setGroupMemberMuteTime",setGroupMemberRole:"setGroupMemberRole",setGroupMemberCustomField:"setGroupMemberCustomField",getGroupOnlineMemberCount:"getGroupOnlineMemberCount",getMyProfile:"getMyProfile",getUserProfile:"getUserProfile",updateMyProfile:"updateMyProfile",getBlacklist:"getBlacklist",addToBlacklist:"addToBlacklist",removeFromBlacklist:"removeFromBlacklist",getFriendList:"getFriendList",callExperimentalAPI:"callExperimentalAPI"},Qd=!!ki&&o(function(){ki.prototype.finally.call({then:function(){}},function(){})});Me({target:"Promise",proto:!0,real:!0,forced:Qd},{finally:function(e){var t=Ri(this,oe("Promise")),n="function"==typeof e;return this.then(n?function(n){return ho(t,e()).then(function(){return n})}:e,n?function(n){return ho(t,e()).then(function(){throw n})}:e)}}),"function"!=typeof ki||ki.prototype.finally||ne(ki.prototype,"finally",oe("Promise").prototype.finally),n(function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof d?t:d,o=Object.create(i.prototype),a=new w(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===c)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,a),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var c={};function d(){}function f(){}function p(){}var h={};h[i]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g(E([])));v&&v!==t&&n.call(v,i)&&(h=v);var m=p.prototype=d.prototype=Object.create(h);function y(e){["next","throw","return"].forEach(function(t){s(e,t,function(e){return this._invoke(t,e)})})}function _(e,t){var r;this._invoke=function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=l(e[i],e,o);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(d).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function E(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=m.constructor=p,p.constructor=f,f.displayName=s(p,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,s(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(_.prototype),_.prototype[o]=function(){return this},e.AsyncIterator=_,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new _(u(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},y(m),s(m,a,"Generator"),m[i]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,c):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}});var Zd="1.7.3",$d="537048168",ef="10",tf="protobuf",nf="json",rf=4,of={HOST:{CURRENT:{COMMON:"https://webim.tim.qq.com",PIC:"https://pic.tim.qq.com",COS:"https://yun.tim.qq.com"},PRODUCTION:{COMMON:"https://webim.tim.qq.com",PIC:"https://pic.tim.qq.com",COS:"https://yun.tim.qq.com"},OVERSEA_PRODUCTION:{COMMON:"https://api.im.qcloud.com",PIC:"https://api.im.qcloud.com",COS:"https://api.im.qcloud.com"},SANDBOX:{COMMON:"https://events.tim.qq.com",PIC:"https://pic.tim.qq.com",COS:"https://yun.tim.qq.com"},TEST:{COMMON:"https://test.tim.qq.com",PIC:"https://pic.tim.qq.com",COS:"https://test.tim.qq.com"},setCurrent:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;1===e?this.CURRENT=this.SANDBOX:2===e?this.CURRENT=this.TEST:3===e?this.CURRENT=this.PRODUCTION:e===rf&&(this.CURRENT=this.OVERSEA_PRODUCTION)}},NAME:{OPEN_IM:"openim",GROUP:"group_open_http_svc",FRIEND:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GROUP_NO_AUTH:"group_open_http_noauth_svc",BIG_GROUP_LONG_POLLING:"group_open_long_polling_http_svc",BIG_GROUP_LONG_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr"},CMD:{ACCESS_LAYER:"accesslayer",LOGIN:"login",LOGOUT_LONG_POLL:"longpollinglogout",LOGOUT_ALL:"logout",PORTRAIT_GET:"portrait_get_all",PORTRAIT_SET:"portrait_set",GET_LONG_POLL_ID:"getlongpollingid",LONG_POLL:"longpolling",AVCHATROOM_LONG_POLL:"get_msg",FRIEND_ADD:"friend_add",FRIEND_GET_ALL:"friend_get_all",FRIEND_DELETE:"friend_delete",RESPONSE_PENDENCY:"friend_response",GET_PENDENCY:"pendency_get",DELETE_PENDENCY:"pendency_delete",GET_GROUP_PENDENCY:"get_pendency",GET_BLACKLIST:"black_list_get",ADD_BLACKLIST:"black_list_add",DELETE_BLACKLIST:"black_list_delete",CREATE_GROUP:"create_group",GET_JOINED_GROUPS:"get_joined_group_list",SEND_MESSAGE:"sendmsg",REVOKE_C2C_MESSAGE:"msgwithdraw",SEND_GROUP_MESSAGE:"send_group_msg",REVOKE_GROUP_MESSAGE:"group_msg_recall",GET_GROUP_INFO:"get_group_info",GET_GROUP_MEMBER_INFO:"get_specified_group_member_info",GET_GROUP_MEMBER_LIST:"get_group_member_info",QUIT_GROUP:"quit_group",CHANGE_GROUP_OWNER:"change_group_owner",DESTROY_GROUP:"destroy_group",ADD_GROUP_MEMBER:"add_group_member",DELETE_GROUP_MEMBER:"delete_group_member",SEARCH_GROUP_BY_ID:"get_group_public_info",APPLY_JOIN_GROUP:"apply_join_group",HANDLE_APPLY_JOIN_GROUP:"handle_apply_join_group",MODIFY_GROUP_INFO:"modify_group_base_info",MODIFY_GROUP_MEMBER_INFO:"modify_group_member_info",DELETE_GROUP_SYSTEM_MESSAGE:"deletemsg",GET_CONVERSATION_LIST:"get",PAGING_GET_CONVERSATION_LIST:"page_get",DELETE_CONVERSATION:"delete",GET_MESSAGES:"getmsg",GET_C2C_ROAM_MESSAGES:"getroammsg",GET_GROUP_ROAM_MESSAGES:"group_msg_get",SET_C2C_MESSAGE_READ:"msgreaded",GET_PEER_READ_TIME:"get_peer_read_time",SET_GROUP_MESSAGE_READ:"msg_read_report",FILE_READ_AND_WRITE_AUTHKEY:"authkey",FILE_UPLOAD:"pic_up",COS_SIGN:"cos",TIM_WEB_REPORT:"tim_web_report",BIG_DATA_HALLWAY_AUTH_KEY:"authkey",GET_ONLINE_MEMBER_NUM:"get_online_member_num"},CHANNEL:{SOCKET:1,XHR:2,AUTO:0},NAME_VERSION:{openim:"v4",group_open_http_svc:"v4",sns:"v4",profile:"v4",recentcontact:"v4",openpic:"v4",group_open_http_noauth_svc:"v4",group_open_long_polling_http_svc:"v4",group_open_long_polling_http_noauth_svc:"v4",imopenstat:"v4",im_cos_sign_svr:"v4",webim:"v4"}};of.HOST.setCurrent(3);var af={request:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",avatar:"FaceUrl"},response:{GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",GroupWithdrawInfoArray:"revokedInfos",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupName:"name",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension"},ignoreKeyWord:["C2C","ID","USP"]},sf="_contextWasUpdated",uf="_contextWasReset",lf="_a2KeyAndTinyIDUpdated",cf="_specifiedConfigUpdated",df="_noticeIsSynchronizing",ff="_noticeIsSynchronized",pf="_messageSent",hf="_syncMessageProcessing",gf="_syncMessageFinished",vf="_receiveInstantMessage",mf="_receiveGroupInstantMessage",yf="_receveGroupSystemNotice",_f="_messageRevoked",bf="_longPollGetIDFailed",Sf="_longPollRequestFailed",kf="_longPollResponseOK",wf="_longPollKickedOut",Ef="_longPollMitipuleDeviceKickedOut",Tf="_longPollGetNewC2CNotice",xf="_longPollGetNewGroupMessages",Cf="_longPollGetNewGroupTips",If="_longPollGetNewGroupNotice",Rf="_longPollGetNewFriendMessages",Af="_longPollProfileModified",Of=" _longpollGroupMessageRevoked",Mf="_longpollC2CMessageRevoked",Df="_longpollC2CMessageReadReceipt",Lf="_avlongPollRequestFailed",Pf="_avlongPollResponseOK",Nf="_onGroupListUpdated",Uf="_loginSuccess",Ff="_signLogoutExcuting",jf="_logoutSuccess",Gf="_a2keyExpired",Bf="_errorHasBeenDetected",Vf="_onConversationListUpdated",qf="_onConversationListProfileUpdated",Hf="_conversationDeleted",zf="onProfileUpdated",Kf="joinAVChatRoomSuccess",Wf="joinAVChatRoomSuccessNoAuth",Yf="_sdkStateReady",Jf="_sdkReload",Xf=at.filter,Qf=Xe("filter"),Zf=dt("filter");Me({target:"Array",proto:!0,forced:!Qf||!Zf},{filter:function(e){return Xf(this,e,arguments.length>1?arguments[1]:void 0)}});var $f=Yr.trim;function ep(e,t){if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");var n;return t=Object.assign({pascalCase:!1},t),0===(e=Array.isArray(e)?e.map(function(e){return e.trim()}).filter(function(e){return e.length}).join("-"):e.trim()).length?"":1===e.length?t.pascalCase?e.toUpperCase():e.toLowerCase():(e!==e.toLowerCase()&&(e=tp(e)),e=e.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,function(e,t){return t.toUpperCase()}).replace(/\d+(\w|$)/g,function(e){return e.toUpperCase()}),n=e,t.pascalCase?n.charAt(0).toUpperCase()+n.slice(1):n)}Me({target:"String",proto:!0,forced:function(e){return o(function(){return!!qr[e]()||"​᠎"!="​᠎"[e]()||qr[e].name!==e})}("trim")},{trim:function(){return $f(this)}});var tp=function(e){for(var t=!1,n=!1,r=!1,i=0;i<e.length;i++){var o=e[i];t&&/[a-zA-Z]/.test(o)&&o.toUpperCase()===o?(e=e.slice(0,i)+"-"+e.slice(i),t=!1,r=n,n=!0,i++):n&&r&&/[a-zA-Z]/.test(o)&&o.toLowerCase()===o?(e=e.slice(0,i-1)+"-"+e.slice(i-1),r=n,n=!1,t=!0):(t=o.toLowerCase()===o&&o.toUpperCase()!==o,r=n,n=o.toUpperCase()===o&&o.toLowerCase()!==o)}return e};function np(e,t,n){var r=[],i=0,o=function e(t,n){if(++i>10)return i--,t;if(Ts(t)){var o=t.map(function(t){return ws(t)?e(t,n):t});return i--,o}if(ws(t)){var a=(s=t,u=function(e,t){if(!Os(t))return!1;if((a=t)!==ep(a)){for(var i=!0,o=0;o<af.ignoreKeyWord.length;o++)if(t.includes(af.ignoreKeyWord[o])){i=!1;break}i&&r.push(t)}var a;return xs(n[t])?function(e){return"OPPOChannelID"===e?e:e[0].toUpperCase()+ep(e).slice(1)}(t):n[t]},l=Object.create(null),Object.keys(s).forEach(function(e){var t=u(s[e],e);t&&(l[t]=s[e])}),l);return a=Qs(a,function(t,r){return Ts(t)||ws(t)?e(t,n):t}),i--,a}var s,u,l}(e,t=jn(jn({},af.request),t));return r.length>0&&n.innerEmitter.emit(Bf,{code:Td.CONVERTOR_IRREGULAR_PARAMS,message:Dd}),o}var rp=function(){function e(t){var n=this;Ln(this,e),this.url="",this.requestData=null,this.method=t.method||"POST",this.callback=function(e){return function e(t,n){if(n=jn(jn({},af.response),n),Ts(t))return t.map(function(t){return ws(t)?e(t,n):t});if(ws(t)){var r=(i=t,o=function(e,t){return xs(n[t])?ep(t):n[t]},a={},Object.keys(i).forEach(function(e){a[o(i[e],e)]=i[e]}),a);return r=Qs(r,function(t){return Ts(t)||ws(t)?e(t,n):t})}var i,o,a}(e=t.decode(e),n._getResponseMap(t))},this._initializeServerMap(),this._initializeURL(t),this._initializeRequestData(t)}return Nn(e,[{key:"_initializeServerMap",value:function(){this._serverMap=Object.create(null);var e="";for(var t in of.NAME)if(Object.prototype.hasOwnProperty.call(of.NAME,t))switch(e=of.NAME[t]){case of.NAME.PIC:this._serverMap[e]=of.HOST.CURRENT.PIC;break;case of.NAME.IM_COS_SIGN:this._serverMap[e]=of.HOST.CURRENT.COS;break;default:this._serverMap[e]=of.HOST.CURRENT.COMMON}}},{key:"_getHost",value:function(e){if(void 0!==this._serverMap[e])return this._serverMap[e];throw new Ed({code:Td.NETWORK_UNDEFINED_SERVER_NAME,message:"打包错误，未定义的 serverName"})}},{key:"_initializeURL",value:function(e){var t=e.serverName,n=e.cmd,r=this._getHost(t),i="".concat(r,"/").concat(of.NAME_VERSION[t],"/").concat(t,"/").concat(n);i+="?".concat(this._getQueryString(e.queryString)),this.url=i}},{key:"getUrl",value:function(){return this.url.replace(/&reqtime=(\d+)/,"&reqtime=".concat(Math.ceil(+new Date/1e3)))}},{key:"_initializeRequestData",value:function(e){var t,n=e.requestData;t=this._requestDataCleaner(n),this.requestData=e.encode(t)}},{key:"_requestDataCleaner",value:function(e){var t=Array.isArray(e)?[]:Object.create(null);for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&Os(n)&&null!==e[n]&&("object"!==On(e[n])?t[n]=e[n]:t[n]=this._requestDataCleaner.bind(this)(e[n]));return t}},{key:"_getQueryString",value:function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&("function"!=typeof e[n]?t.push("".concat(n,"=").concat(e[n])):t.push("".concat(n,"=").concat(e[n]())));return t.join("&")}},{key:"_getResponseMap",value:function(e){if(e.keyMaps&&e.keyMaps.response&&Object.keys(e.keyMaps.response).length>0)return e.keyMaps.response}}]),e}(),ip=[].slice,op=/MSIE .\./.test(He),ap=function(e){return function(t,n){var r=arguments.length>2,i=r?ip.call(arguments,2):void 0;return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};function sp(e){this.mixin(e)}Me({global:!0,bind:!0,forced:op},{setTimeout:ap(i.setTimeout),setInterval:ap(i.setInterval)}),sp.mixin=function(e){var t=e.prototype||e;t._isReady=!1,t.ready=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return this._isReady?void(t?e.call(this):setTimeout(e,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(e))},t.triggerReady=function(){var e=this;this._isReady=!0,setTimeout(function(){var t=e._readyQueue;e._readyQueue=[],t&&t.length>0&&t.forEach(function(e){e.call(this)},e)},1)},t.resetReady=function(){this._isReady=!1,this._readyQueue=[]},t.isReady=function(){return this._isReady}};var up=function(){function e(t){Ln(this,e),sp.mixin(this),this.tim=t}return Nn(e,[{key:"isLoggedIn",value:function(){return this.tim.context.login===Yu.IS_LOGIN||!!this.tim.context.a2Key}},{key:"createTransportCapsule",value:function(e){var t=this.tim.packageConfig.get(e);return t?new rp(t):null}},{key:"request",value:function(e){var t=this.createTransportCapsule(e);return t||_s.error("unknown transport capsule, please check!",e),this.tim.connectionController.request(t)}},{key:"emitInnerEvent",value:function(e,t){this.tim.innerEmitter.emit(e,t)}},{key:"emitOuterEvent",value:function(e,t){this.tim.outerEmitter.emit(e,t)}},{key:"reset",value:function(){_s.warn(["method: IMController.reset() method must be implemented"].join())}},{key:"probeNetwork",value:function(){return this.tim.netMonitor.probe()}},{key:"getNetworkType",value:function(){return this.tim.netMonitor.getNetworkType()}},{key:"getPlatform",value:function(){return za}}]),e}(),lp=function(){function e(t,n){Ln(this,e),this.data=t,this._innerEmitter=n,this.defaultData={},Object.assign(this.defaultData,t),this.initGetterAndSetter()}return Nn(e,[{key:"initGetterAndSetter",value:function(){var e=this,t=function(t){Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return e.data[t]},set:function(n){e.data[t]!==n&&(e.data[t]=n,e.onChange.bind(e)(t,n))}})};for(var n in e.data)Object.prototype.hasOwnProperty.call(e.data,n)&&t(n)}},{key:"onChange",value:function(e,t){this._innerEmitter.emit(sf,{key:e,value:t})}},{key:"reset",value:function(){for(var e in _s.log("Context.reset"),this.data)Object.prototype.hasOwnProperty.call(this.data,e)&&(this.data[e]=this.defaultData.hasOwnProperty(e)?this.defaultData[e]:null)}}]),e}(),cp=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;Ln(this,n);var i=(r=t.call(this,e)).tim.loginInfo;return r._context=new lp({login:Yu.IS_NOT_LOGIN,SDKAppID:i.SDKAppID,appIDAt3rd:null,accountType:i.accountType,identifier:i.identifier,tinyID:null,identifierNick:i.identifierNick,userSig:i.userSig,a2Key:null,contentType:"json",apn:1,unlimitedAVChatRoom:i.unlimitedAVChatRoom,scene:i.scene,oversea:i.oversea,instanceID:i.instanceID},r.tim.innerEmitter),r._initListener(),r}return Nn(n,[{key:"reset",value:function(){this._context.reset(),this.emitInnerEvent(uf)}},{key:"_initListener",value:function(){this.tim.innerEmitter.on(sf,this._onContextMemberChange,this),this.tim.innerEmitter.on(Uf,this._updateA2KeyAndTinyID,this)}},{key:"_updateA2KeyAndTinyID",value:function(e){var t=e.data,n=t.a2Key,r=t.tinyID;this._context.a2Key=n,this._context.tinyID=r,this.emitInnerEvent(lf),this.triggerReady()}},{key:"getContext",value:function(){return this._context}},{key:"_onContextMemberChange",value:function(e){var t=e.data,n=t.key,r=t.value;("tinyID"===n||"a2Key"===n)&&(r.length<=0?this._context.login=Yu.IS_NOT_LOGIN:this._context.login=null!==this._context.a2Key?Yu.IS_LOGIN:Yu.IS_NOT_LOGIN)}}]),n}(up),dp=function e(t){Ln(this,e),this.code=0,this.data=t||{}},fp=null,pp=function(e){return e instanceof dp?(_s.warn("IMPromise.resolve 此函数会自动用options创建IMResponse实例，调用侧不需创建，建议修改！"),Promise.resolve(e)):Promise.resolve(new dp(e))},hp=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e instanceof Ed)return t&&null!==fp&&fp.emit(wn.ERROR,e),Promise.reject(e);if(e instanceof Error){var n=new Ed({code:Td.UNCAUGHT_ERROR,message:e.message});return t&&null!==fp&&fp.emit(wn.ERROR,n),Promise.reject(n)}if(xs(e)||xs(e.code)||xs(e.message))_s.error("IMPromise.reject 必须指定code(错误码)和message(错误信息)!!!");else{if(Ss(e.code)&&ks(e.message)){var r=new Ed(e);return t&&null!==fp&&fp.emit(wn.ERROR,r),Promise.reject(r)}_s.error("IMPromise.reject code(错误码)必须为数字，message(错误信息)必须为字符串!!!")}},gp="sdkReady",vp="longpolling",mp="longpollingAV",yp="sendMessage",_p="sendMessageC2C",bp="sendMessageGroupWork",Sp="sendMessageGroupPublic",kp="sendMessageGroupMeeting",wp="sendMessageGroupAV",Ep="messageReceived",Tp="messageReceivedAV",xp="initGroupList",Cp=function(){function e(t){Ln(this,e),this.SDKAppID="",this.version="",this.tinyID="",this.userID="",this.platform="",this.method=t,this.time="",this.startts=Date.now(),this.endts=0,this.timespan=0,this.codeint=0,this.message="",this.text="",this.msgType="",this.networkType="",this.platform="",this.scene="",this._sentFlag=!1,this.instanceID="",this.host=function(){var e="unknown";if(is&&(e="mac"),rs&&(e="windows"),Qa&&(e="ios"),Za&&(e="android"),qa)try{var t=Ha.getSystemInfoSync().platform;void 0!==t&&(e=t)}catch(e){}return e}(),this.mpLibVersion=function(){if(qa)try{var e;return void 0===(e=Va?my.getSystemInfoSync().version:Ha.getSystemInfoSync().SDKVersion)?"-":e}catch(e){return"-"}return"-"}()}return Nn(e,[{key:"setCommonInfo",value:function(e){var t=e.SDKAppID,n=e.version,r=e.tinyID,i=e.userID,o=e.platform,a=e.scene,s=e.instanceID;this.SDKAppID="".concat(t),this.version="".concat(n),this.tinyID=r,this.userID=i,this.platform=o,this.scene=a,this.time=Ns(),this.instanceID=s,this.startts&&this.endts&&!this.timespan&&(this.timespan=Math.abs(this.endts-this.startts))}},{key:"setEnd",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._sentFlag||(this.endts=Date.now(),t?(this._sentFlag=!0,this._eventStatController.pushIn(this)):setTimeout(function(){e._sentFlag=!0,e._eventStatController.pushIn(e)},0))}},{key:"setError",value:function(e,t,n){return e instanceof Error?(this._sentFlag||(this.setNetworkType(n),t?(e.code&&this.setCode(e.code),e.message&&this.setMessage(e.message)):(this.setCode(Td.NO_NETWORK),this.setMessage("未连接到网络"))),this):(_s.warn("SSOLogData.setError value not instanceof Error, please check!"),this)}},{key:"setCode",value:function(e){return xs(e)||this._sentFlag||("ECONNABORTED"===e&&(this.codeint=103),Ss(e)?this.codeint=e:_s.warn("SSOLogData.setCode value not a number, please check!",e,On(e))),this}},{key:"setMessage",value:function(e){return xs(e)||this._sentFlag?this:ks(e)?(this.message=e,this):this}},{key:"setText",value:function(e){return Ss(e)?this.text=e.toString():ks(e)&&(this.text=e),this}},{key:"setMessageType",value:function(e){return this.msgType=e,this}},{key:"setNetworkType",value:function(e){return xs(e)?_s.warn("SSOLogData.setNetworkType value is undefined, please check!"):this.networkType=e,this}}],[{key:"bindController",value:function(t){e.prototype._eventStatController=t}}]),e}(),Ip="sdkConstruct",Rp="kickedOut",Ap="applyJoinGroup",Op="longPollingError",Mp=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;return Ln(this,n),!0===(r=t.call(this,e)).tim.context.oversea&&of.HOST.setCurrent(rf),r._initializeListener(),r}return Nn(n,[{key:"login",value:function(e){if(this.isLoggedIn()){var t="您已经登录账号".concat(e.identifier,"！如需切换账号登录，请先调用 logout 接口登出，再调用 login 接口登录。");return _s.warn(t),pp({actionStatus:"OK",errorCode:0,errorInfo:t,repeatLogin:!0})}_s.log("SignController.login userID=".concat(e.identifier)),_s.time("login");var n=this._checkLoginInfo(e);return nu(n)?(this.tim.context.identifier=e.identifier,this.tim.context.userSig=e.userSig,this.tim.context.identifier&&this.tim.context.userSig?this._accessLayer():void 0):hp(n)}},{key:"_isLoginCurrentUser",value:function(e){return this.tim.context.identifier===e}},{key:"_initializeListener",value:function(){var e=this.tim.innerEmitter;e.on(wf,this._onMultipleAccountKickedOut,this),e.on(Ef,this._onMultipleDeviceKickedOut,this),e.on(Gf,this._onUserSigExpired,this)}},{key:"_accessLayer",value:function(){var e=this,t=new Cp("accessLayer");return _s.log("SignController._accessLayer."),this.request({name:"accessLayer",action:"query"}).then(function(n){return t.setNetworkType(e.getNetworkType()).setText(n.data.webImAccessLayer).setEnd(),_s.log("SignController._accessLayer ok. webImAccessLayer=".concat(n.data.webImAccessLayer)),e.tim.context.oversea||1!==n.data.webImAccessLayer||of.HOST.setCurrent(n.data.webImAccessLayer),e._login()}).catch(function(n){return e.probeNetwork().then(function(r){var i=Jn(r,2),o=i[0],a=i[1];t.setError(n,o,a).setEnd(!0),e.tim.eventStatController.reportAtOnce()}),_s.error("SignController._accessLayer failed. error:",n),hp(n)})}},{key:"_login",value:function(){var e=this,t=new Cp("login");return this.request({name:"login",action:"query"}).then(function(n){var r=null;if(!n.data.tinyID)throw r=new Ed({code:Td.NO_TINYID,message:"无 tinyID"}),t.setError(r,!0,e.getNetworkType()).setEnd(),r;if(!n.data.a2Key)throw r=new Ed({code:Td.NO_A2KEY,message:"无 a2key"}),t.setError(r,!0,e.getNetworkType()).setEnd(),r;return t.setNetworkType(e.getNetworkType()).setText("".concat(e.tim.loginInfo.identifier)).setEnd(),_s.log("SignController.login ok. userID=".concat(e.tim.loginInfo.identifier," loginCost=").concat(_s.timeEnd("login"),"ms")),e.emitInnerEvent(Uf,{a2Key:n.data.a2Key,tinyID:n.data.tinyID}),pp(n.data)}).catch(function(n){return e.probeNetwork().then(function(e){var r=Jn(e,2),i=r[0],o=r[1];t.setError(n,i,o).setEnd(!0)}),_s.error("SignController.login failed. error:",n),hp(n)})}},{key:"logout",value:function(){return this.isLoggedIn()?(new Cp("logout").setNetworkType(this.getNetworkType()).setText("userID=".concat(this.tim.loginInfo.identifier," type=").concat("longPollLogout")).setEnd(!0),_s.info("SignController.logout"),this.emitInnerEvent(Ff),this._logout(1).then(this._emitLogoutSuccess.bind(this)).catch(this._emitLogoutSuccess.bind(this))):hp({code:Td.USER_NOT_LOGGED_IN,message:"用户未登录"})}},{key:"_logout",value:function(e){var t=this.tim.notificationController,n=0===e?"logout":"longPollLogout",r=0===e?{name:n,action:"query"}:{name:n,action:"query",param:{longPollID:t.getLongPollID()}};return this.request(r).catch(function(e){return _s.error("SignController._logout error:",e),hp(e)})}},{key:"_checkLoginInfo",value:function(e){var t=0,n="";return null===e.SDKAppID?(t=Td.NO_SDKAPPID,n="无 SDKAppID"):null===e.accountType?(t=Td.NO_ACCOUNT_TYPE,n="无 accountType"):null===e.identifier?(t=Td.NO_IDENTIFIER,n="无 userID"):null===e.userSig&&(t=Td.NO_USERSIG,n="无 userSig"),nu(t)||nu(n)?{}:{code:t,message:n}}},{key:"_emitLogoutSuccess",value:function(){return this.emitInnerEvent(jf),pp({})}},{key:"_onMultipleAccountKickedOut",value:function(){var e=this;new Cp(Rp).setNetworkType(this.getNetworkType()).setText(En.KICKED_OUT_MULT_ACCOUNT).setEnd(!0),_s.warn("SignController._onMultipleAccountKickedOut kicked out. userID=".concat(this.tim.loginInfo.identifier)),this.tim.logout().then(function(){e.emitOuterEvent(wn.KICKED_OUT,{type:En.KICKED_OUT_MULT_ACCOUNT})})}},{key:"_onMultipleDeviceKickedOut",value:function(){var e=this;new Cp(Rp).setNetworkType(this.getNetworkType()).setText(En.KICKED_OUT_MULT_DEVICE).setEnd(!0),_s.warn("SignController._onMultipleDeviceKickedOut kicked out. userID=".concat(this.tim.loginInfo.identifier)),this.tim.logout().then(function(){e.emitOuterEvent(wn.KICKED_OUT,{type:En.KICKED_OUT_MULT_DEVICE})})}},{key:"_onUserSigExpired",value:function(){new Cp(Rp).setNetworkType(this.getNetworkType()).setText(En.KICKED_OUT_USERSIG_EXPIRED).setEnd(!0),_s.warn("SignController._onUserSigExpired: userSig 签名过期被踢下线"),this.emitOuterEvent(wn.KICKED_OUT,{type:En.KICKED_OUT_USERSIG_EXPIRED}),this.tim.resetSDK()}},{key:"reset",value:function(){_s.info("SignController.reset")}}]),n}(up),Dp=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},Lp=Object.prototype.toString;function Pp(e){return"[object Array]"===Lp.call(e)}function Np(e){return void 0===e}function Up(e){return null!==e&&"object"==typeof e}function Fp(e){return"[object Function]"===Lp.call(e)}function jp(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),Pp(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var Gp={isArray:Pp,isArrayBuffer:function(e){return"[object ArrayBuffer]"===Lp.call(e)},isBuffer:function(e){return null!==e&&!Np(e)&&null!==e.constructor&&!Np(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:Up,isUndefined:Np,isDate:function(e){return"[object Date]"===Lp.call(e)},isFile:function(e){return"[object File]"===Lp.call(e)},isBlob:function(e){return"[object Blob]"===Lp.call(e)},isFunction:Fp,isStream:function(e){return Up(e)&&Fp(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:jp,merge:function e(){var t={};function n(n,r){"object"==typeof t[r]&&"object"==typeof n?t[r]=e(t[r],n):t[r]=n}for(var r=0,i=arguments.length;r<i;r++)jp(arguments[r],n);return t},deepMerge:function e(){var t={};function n(n,r){"object"==typeof t[r]&&"object"==typeof n?t[r]=e(t[r],n):t[r]="object"==typeof n?e({},n):n}for(var r=0,i=arguments.length;r<i;r++)jp(arguments[r],n);return t},extend:function(e,t,n){return jp(t,function(t,r){e[r]=n&&"function"==typeof t?Dp(t,n):t}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}};function Bp(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Vp=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(Gp.isURLSearchParams(t))r=t.toString();else{var i=[];Gp.forEach(t,function(e,t){null!=e&&(Gp.isArray(e)?t+="[]":e=[e],Gp.forEach(e,function(e){Gp.isDate(e)?e=e.toISOString():Gp.isObject(e)&&(e=JSON.stringify(e)),i.push(Bp(t)+"="+Bp(e))}))}),r=i.join("&")}if(r){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e};function qp(){this.handlers=[]}qp.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},qp.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},qp.prototype.forEach=function(e){Gp.forEach(this.handlers,function(t){null!==t&&e(t)})};var Hp=qp,zp=function(e,t,n){return Gp.forEach(n,function(n){e=n(e,t)}),e},Kp=function(e){return!(!e||!e.__CANCEL__)};function Wp(){throw new Error("setTimeout has not been defined")}function Yp(){throw new Error("clearTimeout has not been defined")}var Jp=Wp,Xp=Yp;function Qp(e){if(Jp===setTimeout)return setTimeout(e,0);if((Jp===Wp||!Jp)&&setTimeout)return Jp=setTimeout,setTimeout(e,0);try{return Jp(e,0)}catch(t){try{return Jp.call(null,e,0)}catch(t){return Jp.call(this,e,0)}}}"function"==typeof ds.setTimeout&&(Jp=setTimeout),"function"==typeof ds.clearTimeout&&(Xp=clearTimeout);var Zp,$p=[],eh=!1,th=-1;function nh(){eh&&Zp&&(eh=!1,Zp.length?$p=Zp.concat($p):th=-1,$p.length&&rh())}function rh(){if(!eh){var e=Qp(nh);eh=!0;for(var t=$p.length;t;){for(Zp=$p,$p=[];++th<t;)Zp&&Zp[th].run();th=-1,t=$p.length}Zp=null,eh=!1,function(e){if(Xp===clearTimeout)return clearTimeout(e);if((Xp===Yp||!Xp)&&clearTimeout)return Xp=clearTimeout,clearTimeout(e);try{Xp(e)}catch(t){try{return Xp.call(null,e)}catch(t){return Xp.call(this,e)}}}(e)}}function ih(e,t){this.fun=e,this.array=t}function oh(){}ih.prototype.run=function(){this.fun.apply(null,this.array)};var ah=oh,sh=oh,uh=oh,lh=oh,ch=oh,dh=oh,fh=oh,ph=ds.performance||{},hh=ph.now||ph.mozNow||ph.msNow||ph.oNow||ph.webkitNow||function(){return(new Date).getTime()},gh=new Date,vh={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];$p.push(new ih(e,t)),1!==$p.length||eh||Qp(rh)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:ah,addListener:sh,once:uh,off:lh,removeListener:ch,removeAllListeners:dh,emit:fh,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*hh.call(ph),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-gh)/1e3}},mh=function(e,t){Gp.forEach(e,function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])})},yh=function(e,t,n,r,i){return function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}(new Error(e),t,n,r,i)},_h=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],bh=Gp.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=Gp.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0},Sh=Gp.isStandardBrowserEnv()?{write:function(e,t,n,r,i,o){var a=[];a.push(e+"="+encodeURIComponent(t)),Gp.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),Gp.isString(r)&&a.push("path="+r),Gp.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},kh={"Content-Type":"application/x-www-form-urlencoded"};function wh(e,t){!Gp.isUndefined(e)&&Gp.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var Eh,Th={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==vh&&"[object process]"===Object.prototype.toString.call(vh))&&(Eh=function(e){return new Promise(function(t,n){var r=e.data,i=e.headers;Gp.isFormData(r)&&delete i["Content-Type"];var o=new XMLHttpRequest;if(e.auth){var a=e.auth.username||"",s=e.auth.password||"";i.Authorization="Basic "+btoa(a+":"+s)}var u,l,c=(u=e.baseURL,l=e.url,u&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(l)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(u,l):l);if(o.open(e.method.toUpperCase(),Vp(c,e.params,e.paramsSerializer),!0),o.timeout=e.timeout,o.onreadystatechange=function(){if(o&&4===o.readyState&&(0!==o.status||o.responseURL&&0===o.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in o?function(e){var t,n,r,i={};return e?(Gp.forEach(e.split("\n"),function(e){if(r=e.indexOf(":"),t=Gp.trim(e.substr(0,r)).toLowerCase(),n=Gp.trim(e.substr(r+1)),t){if(i[t]&&_h.indexOf(t)>=0)return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([n]):i[t]?i[t]+", "+n:n}}),i):i}(o.getAllResponseHeaders()):null,i={data:e.responseType&&"text"!==e.responseType?o.response:o.responseText,status:o.status,statusText:o.statusText,headers:r,config:e,request:o};!function(e,t,n){var r=n.config.validateStatus;!r||r(n.status)?e(n):t(yh("Request failed with status code "+n.status,n.config,null,n.request,n))}(t,n,i),o=null}},o.onabort=function(){o&&(n(yh("Request aborted",e,"ECONNABORTED",o)),o=null)},o.onerror=function(){n(yh("Network Error",e,null,o)),o=null},o.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(yh(t,e,"ECONNABORTED",o)),o=null},Gp.isStandardBrowserEnv()){var d=Sh,f=(e.withCredentials||bh(c))&&e.xsrfCookieName?d.read(e.xsrfCookieName):void 0;f&&(i[e.xsrfHeaderName]=f)}if("setRequestHeader"in o&&Gp.forEach(i,function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete i[t]:o.setRequestHeader(t,e)}),Gp.isUndefined(e.withCredentials)||(o.withCredentials=!!e.withCredentials),e.responseType)try{o.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&o.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&o.upload&&o.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){o&&(o.abort(),n(e),o=null)}),void 0===r&&(r=null),o.send(r)})}),Eh),transformRequest:[function(e,t){return mh(t,"Accept"),mh(t,"Content-Type"),Gp.isFormData(e)||Gp.isArrayBuffer(e)||Gp.isBuffer(e)||Gp.isStream(e)||Gp.isFile(e)||Gp.isBlob(e)?e:Gp.isArrayBufferView(e)?e.buffer:Gp.isURLSearchParams(e)?(wh(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):Gp.isObject(e)?(wh(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Gp.forEach(["delete","get","head"],function(e){Th.headers[e]={}}),Gp.forEach(["post","put","patch"],function(e){Th.headers[e]=Gp.merge(kh)});var xh=Th;function Ch(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var Ih=function(e){return Ch(e),e.headers=e.headers||{},e.data=zp(e.data,e.headers,e.transformRequest),e.headers=Gp.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),Gp.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||xh.adapter)(e).then(function(t){return Ch(e),t.data=zp(t.data,t.headers,e.transformResponse),t},function(t){return Kp(t)||(Ch(e),t&&t.response&&(t.response.data=zp(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})},Rh=function(e,t){t=t||{};var n={},r=["url","method","params","data"],i=["headers","auth","proxy"],o=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];Gp.forEach(r,function(e){void 0!==t[e]&&(n[e]=t[e])}),Gp.forEach(i,function(r){Gp.isObject(t[r])?n[r]=Gp.deepMerge(e[r],t[r]):void 0!==t[r]?n[r]=t[r]:Gp.isObject(e[r])?n[r]=Gp.deepMerge(e[r]):void 0!==e[r]&&(n[r]=e[r])}),Gp.forEach(o,function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])});var a=r.concat(i).concat(o),s=Object.keys(t).filter(function(e){return-1===a.indexOf(e)});return Gp.forEach(s,function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])}),n};function Ah(e){this.defaults=e,this.interceptors={request:new Hp,response:new Hp}}Ah.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=Rh(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[Ih,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},Ah.prototype.getUri=function(e){return e=Rh(this.defaults,e),Vp(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},Gp.forEach(["delete","get","head","options"],function(e){Ah.prototype[e]=function(t,n){return this.request(Gp.merge(n||{},{method:e,url:t}))}}),Gp.forEach(["post","put","patch"],function(e){Ah.prototype[e]=function(t,n,r){return this.request(Gp.merge(r||{},{method:e,url:t,data:n}))}});var Oh=Ah;function Mh(e){this.message=e}Mh.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Mh.prototype.__CANCEL__=!0;var Dh=Mh;function Lh(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var n=this;e(function(e){n.reason||(n.reason=new Dh(e),t(n.reason))})}Lh.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Lh.source=function(){var e;return{token:new Lh(function(t){e=t}),cancel:e}};var Ph=Lh;function Nh(e){var t=new Oh(e),n=Dp(Oh.prototype.request,t);return Gp.extend(n,Oh.prototype,t),Gp.extend(n,t),n}var Uh=Nh(xh);Uh.Axios=Oh,Uh.create=function(e){return Nh(Rh(Uh.defaults,e))},Uh.Cancel=Dh,Uh.CancelToken=Ph,Uh.isCancel=Kp,Uh.all=function(e){return Promise.all(e)},Uh.spread=function(e){return function(t){return e.apply(null,t)}};var Fh=Uh,jh=Uh;Fh.default=jh;var Gh=Fh,Bh=Gh.create({timeout:3e4,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}});Bh.interceptors.response.use(function(e){var t=e.data,n=t.error_code,r=t.ErrorCode;return Ss(n)&&(r=n),r!==Wu.SUCCESS&&(e.data.ErrorCode=Number(r)),e},function(e){return"Network Error"===e.message&&(!0===Bh.defaults.withCredentials&&_s.warn("Network Error, try to close `IMAxios.defaults.withCredentials` to false. (IMAxios.js)"),Bh.defaults.withCredentials=!1),Promise.reject(e)});var Vh=function(){function e(){Ln(this,e)}return Nn(e,[{key:"request",value:function(e){console.warn("请注意： ConnectionBase.request() 方法必须被派生类重写:")}},{key:"_checkOptions",value:function(e){if(0==!!e.url)throw new Ed({code:Td.NETWORK_BASE_OPTIONS_NO_URL,message:"网络层初始化错误，缺少 URL 参数"})}},{key:"_initOptions",value:function(e){e.method=["POST","GET","PUT","DELETE","OPTION"].indexOf(e.method)>=0?e.method:"POST",e.dataType=e.dataType||"json",e.responseType=e.responseType||"json"}}]),e}(),qh=function(e){Gn(n,e);var t=Yn(n);function n(){var e;return Ln(this,n),(e=t.call(this)).retry=2,e}return Nn(n,[{key:"request",value:function(e){return this._checkOptions(e),this._initOptions(e),this._requestWithRetry({url:e.url,data:e.data,method:e.method})}},{key:"_requestWithRetry",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Bh(e).catch(function(r){return t.retry&&n<t.retry?t._requestWithRetry(e,++n):hp(new Ed({code:r.code||"",message:r.message||""}))})}}]),n}(Vh),Hh=function(e){Gn(n,e);var t=Yn(n);function n(){var e;return Ln(this,n),(e=t.call(this)).retry=2,e._request=e.promisify(Ha.request),e}return Nn(n,[{key:"request",value:function(e){return this._checkOptions(e),this._initOptions(e),e=jn(jn({},e),{},{responseType:"text"}),this._requestWithRetry(e)}},{key:"_requestWithRetry",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._request(e).then(this._handleResolve).catch(function(r){if(ks(r.errMsg)){if(r.errMsg.includes("abort"))return pp({});if(r.errMsg.includes("timeout"))return t.retry>0&&n<t.retry?t._requestWithRetry(e,++n):hp(new Ed({code:Td.NETWORK_TIMEOUT,message:r.errMsg}));if(r.errMsg.includes("fail"))return t.retry>0&&n<t.retry?t._requestWithRetry(e,++n):hp(new Ed({code:Td.NETWORK_ERROR,message:r.errMsg}))}return hp(new Ed(jn({code:Td.UNCAUGHT_ERROR,message:r.message},r)))})}},{key:"_handleResolve",value:function(e){var t=e.data,n=t.error_code,r=t.ErrorCode;return Ss(n)&&(r=n),r!==Wu.SUCCESS&&(e.data.ErrorCode=Number("".concat(r))),e}},{key:"promisify",value:function(e){return function(t){return new Promise(function(n,r){var i=e(Object.assign({},t,{success:n,fail:r}));t.updateAbort&&t.updateAbort(function(){i&&Is(i.abort)&&i.abort()})})}}}]),n}(Vh),zh=function(){function e(){Ln(this,e),this.request=0,this.success=0,this.fail=0,this.reportRate=10,this.requestTimeCost=[]}return Nn(e,[{key:"report",value:function(){if(1!==this.request){if(this.request%this.reportRate!=0)return null;var e=this.avgRequestTime(),t="runLoop reports: success=".concat(this.success,",fail=").concat(this.fail,",total=").concat(this.request,",avg=").concat(e,",cur=").concat(this.requestTimeCost[this.requestTimeCost.length-1],",max=").concat(Math.max.apply(null,this.requestTimeCost),",min=").concat(Math.min.apply(null,this.requestTimeCost));_s.log(t)}}},{key:"setRequestTime",value:function(e,t){var n=Math.abs(t-e);100===this.requestTimeCost.length&&this.requestTimeCost.shift(),this.requestTimeCost.push(n)}},{key:"avgRequestTime",value:function(){for(var e,t=this.requestTimeCost.length,n=0,r=0;r<t;r++)n+=this.requestTimeCost[r];return e=n/t,Math.round(100*e)/100}}]),e}(),Kh=Gh.create({timeout:6e3,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}});Kh.interceptors.response.use(function(e){var t=e.data,n=t.error_code,r=t.ErrorCode;return Ss(n)&&(r=n),r!==Wu.SUCCESS&&(e.data.ErrorCode=Number(r)),e},function(e){return"Network Error"===e.message&&(!0===Kh.defaults.withCredentials&&_s.warn("Network Error, try to close `IMAxiosAVChatroom.defaults.withCredentials` to false. (IMAxiosAVChatroom.js)"),Kh.defaults.withCredentials=!1),Promise.reject(e)});var Wh=Gh.CancelToken,Yh=function(){function e(t){Ln(this,e),this._initializeOptions(t),this._initializeMembers(),this.status=new zh}return Nn(e,[{key:"destructor",value:function(){clearTimeout(this._seedID);var e=this._index();for(var t in this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=null);return e}},{key:"setIndex",value:function(e){this._index=e}},{key:"getIndex",value:function(){return this._index}},{key:"isRunning",value:function(){return!this._stoped}},{key:"_initializeOptions",value:function(e){this.options=e}},{key:"_initializeMembers",value:function(){this._index=-1,this._seedID=0,this._requestStatus=!1,this._stoped=!1,this._intervalTime=0,this._intervalIncreaseStep=1e3,this._intervalDecreaseStep=1e3,this._intervalTimeMax=5e3,this._protectTimeout=3e3,this._getNoticeSeq=this.options.getNoticeSeq,this._retryCount=0,this._responseTime=Date.now(),this._responseTimeThreshold=2e3,this.options.isAVChatRoomLoop?this.requestor=Kh:this.requestor=Bh,_s.log("XHRRunLoop._initializeMembers isAVChatRoomLoop=".concat(!!this.options.isAVChatRoomLoop)),this.abort=null}},{key:"start",value:function(){0===this._seedID?(this._stoped=!1,this._send()):_s.log('XHRRunLoop.start(), XHRRunLoop is running now, if you want to restart runLoop , please run "stop()" first.')}},{key:"_reset",value:function(){_s.log("XHRRunLoop._reset(), reset long poll _intervalTime",this._intervalTime),this.stop(),this.start()}},{key:"_intervalTimeIncrease",value:function(){this._intervalTime!==this._responseTimeThreshold&&(this._intervalTime<this._responseTimeThreshold&&(this._intervalTime+=this._intervalIncreaseStep),this._intervalTime>this._responseTimeThreshold&&(this._intervalTime=this._responseTimeThreshold))}},{key:"_intervalTimeDecrease",value:function(){0!==this._intervalTime&&(this._intervalTime>0&&(this._intervalTime-=this._intervalDecreaseStep),this._intervalTime<0&&(this._intervalTime=0))}},{key:"_intervalTimeAdjustment",value:function(){var e=Date.now();100*Math.floor((e-this._responseTime)/100)<=this._responseTimeThreshold?this._intervalTimeIncrease():this._intervalTimeDecrease(),this._responseTime=e}},{key:"_intervalTimeAdjustmentBaseOnResponseData",value:function(e){e.ErrorCode===Wu.SUCCESS?this._intervalTimeDecrease():this._intervalTimeIncrease()}},{key:"_send",value:function(){var e=this;if(!0!==this._requestStatus){this._requestStatus=!0,this.status.request++,"function"==typeof this.options.before&&this.options.before(this.options.pack.requestData);var t=Date.now(),n=0;this.requestor.request({url:this.options.pack.getUrl(),data:this.options.pack.requestData,method:this.options.pack.method,cancelToken:new Wh(function(t){e.abort=t})}).then(function(r){if(e._intervalTimeAdjustmentBaseOnResponseData.bind(e)(r.data),e._retryCount>0&&(e._retryCount=0),e.status.success++,n=Date.now(),e.status.setRequestTime(t,n),r.data.timecost=n-t,"function"==typeof e.options.success)try{e.options.success({pack:e.options.pack,error:!1,data:e.options.pack.callback(r.data)})}catch(e){_s.warn("XHRRunLoop._send(), error:",e)}e._requestStatus=!1,!1===e._stoped&&(e._seedID=setTimeout(e._send.bind(e),e._intervalTime)),e.status.report()}).catch(function(r){if(e.status.fail++,e._retryCount++,e._intervalTimeAdjustment.bind(e)(),!1===e._stoped&&(e._seedID=setTimeout(e._send.bind(e),e._intervalTime)),e._requestStatus=!1,"function"==typeof e.options.fail&&void 0!==r.request)try{e.options.fail({pack:e.options.pack,error:r,data:!1})}catch(e){_s.warn("XHRRunLoop._send(), fail callback error:",e),_s.error(e)}n=Date.now(),e.status.setRequestTime(t,n),e.status.report()})}}},{key:"stop",value:function(){this._clearAllTimeOut(),this._stoped=!0}},{key:"_clearAllTimeOut",value:function(){clearTimeout(this._seedID),this._seedID=0}}]),e}(),Jh=function(){function e(t){Ln(this,e),this._initializeOptions(t),this._initializeMembers(),this.status=new zh}return Nn(e,[{key:"destructor",value:function(){clearTimeout(this._seedID);var e=this._index();for(var t in this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=null);return e}},{key:"setIndex",value:function(e){this._index=e}},{key:"isRunning",value:function(){return!this._stoped}},{key:"getIndex",value:function(){return this._index}},{key:"_initializeOptions",value:function(e){this.options=e}},{key:"_initializeMembers",value:function(){this._index=-1,this._seedID=0,this._requestStatus=!1,this._stoped=!1,this._intervalTime=0,this._intervalIncreaseStep=1e3,this._intervalDecreaseStep=1e3,this._intervalTimeMax=5e3,this._protectTimeout=3e3,this._getNoticeSeq=this.options.getNoticeSeq,this._retryCount=0,this._responseTime=Date.now(),this._responseTimeThreshold=2e3,this.requestor=new Hh,this.abort=null}},{key:"start",value:function(){0===this._seedID?(this._stoped=!1,this._send()):_s.log('WXRunLoop.start(): WXRunLoop is running now, if you want to restart runLoop , please run "stop()" first.')}},{key:"_reset",value:function(){_s.log("WXRunLoop.reset(), long poll _intervalMaxRate",this._intervalMaxRate),this.stop(),this.start()}},{key:"_intervalTimeIncrease",value:function(){this._intervalTime!==this._responseTimeThreshold&&(this._intervalTime<this._responseTimeThreshold&&(this._intervalTime+=this._intervalIncreaseStep),this._intervalTime>this._responseTimeThreshold&&(this._intervalTime=this._responseTimeThreshold))}},{key:"_intervalTimeDecrease",value:function(){0!==this._intervalTime&&(this._intervalTime>0&&(this._intervalTime-=this._intervalDecreaseStep),this._intervalTime<0&&(this._intervalTime=0))}},{key:"_intervalTimeAdjustment",value:function(){var e=Date.now();100*Math.floor((e-this._responseTime)/100)<=this._responseTimeThreshold?this._intervalTimeIncrease():this._intervalTimeDecrease(),this._responseTime=e}},{key:"_intervalTimeAdjustmentBaseOnResponseData",value:function(e){e.ErrorCode===Wu.SUCCESS?this._intervalTimeDecrease():this._intervalTimeIncrease()}},{key:"_send",value:function(){var e=this;if(!0!==this._requestStatus){var t=this;this._requestStatus=!0,this.status.request++,"function"==typeof this.options.before&&this.options.before(t.options.pack.requestData);var n=Date.now(),r=0;this.requestor.request({url:t.options.pack.getUrl(),data:t.options.pack.requestData,method:t.options.pack.method,updateAbort:function(t){e.abort=t}}).then(function(i){if(t._intervalTimeAdjustmentBaseOnResponseData.bind(e)(i.data),t._retryCount>0&&(t._retryCount=0),e.status.success++,r=Date.now(),e.status.setRequestTime(n,r),i.data.timecost=r-n,"function"==typeof t.options.success)try{e.options.success({pack:e.options.pack,error:!1,data:e.options.pack.callback(i.data)})}catch(e){_s.warn("WXRunLoop._send(), error:",e)}t._requestStatus=!1,!1===t._stoped&&(t._seedID=setTimeout(t._send.bind(t),t._intervalTime)),e.status.report()}).catch(function(i){if(e.status.fail++,t._retryCount++,t._intervalTimeAdjustment.bind(e)(),!1===t._stoped&&(t._seedID=setTimeout(t._send.bind(t),t._intervalTime)),t._requestStatus=!1,"function"==typeof t.options.fail)try{e.options.fail({pack:e.options.pack,error:i,data:!1})}catch(e){_s.warn("WXRunLoop._send(), fail callback error:",e),_s.error(e)}r=Date.now(),e.status.setRequestTime(n,r),e.status.report()})}}},{key:"stop",value:function(){this._clearAllTimeOut(),this._stoped=!0}},{key:"_clearAllTimeOut",value:function(){clearTimeout(this._seedID),this._seedID=0}}]),e}(),Xh=function(){function e(t){Ln(this,e),this.tim=t,this.httpConnection=qa?new Hh:new qh,this.keepAliveConnections=[]}return Nn(e,[{key:"initializeListener",value:function(){this.tim.innerEmitter.on(Ff,this._stopAllRunLoop,this)}},{key:"request",value:function(e){var t={url:e.url,data:e.requestData,method:e.method,callback:e.callback};return this.httpConnection.request(t).then(function(t){return t.data=e.callback(t.data),t.data.errorCode!==Wu.SUCCESS?hp(new Ed({code:t.data.errorCode,message:t.data.errorInfo})):t})}},{key:"createRunLoop",value:function(e){var t=this.createKeepAliveConnection(e);return t.setIndex(this.keepAliveConnections.push(t)-1),t}},{key:"stopRunLoop",value:function(e){e.stop()}},{key:"_stopAllRunLoop",value:function(){for(var e=this.keepAliveConnections.length,t=0;t<e;t++)this.keepAliveConnections[t].stop()}},{key:"destroyRunLoop",value:function(e){e.stop();var t=e.destructor();this.keepAliveConnections.slice(t,1)}},{key:"startRunLoopExclusive",value:function(e){for(var t=e.getIndex(),n=0;n<this.keepAliveConnections.length;n++)n!==t&&this.keepAliveConnections[n].stop();e.start()}},{key:"createKeepAliveConnection",value:function(e){return qa?new Jh(e):(2===this.tim.options.runLoopNetType||this.tim.options.runLoopNetType,new Yh(e))}},{key:"clearAll",value:function(){this.conn.cancelAll()}},{key:"reset",value:function(){this.keepAliveConnections=[]}}]),e}(),Qh=function(){function e(t){Ln(this,e),this.tim=t,this.tim.innerEmitter.on(Bf,this._onErrorDetected,this)}return Nn(e,[{key:"_onErrorDetected",value:function(e){var t=e.data;new Cp("exceptionError").setText("code=".concat(t.code," message=").concat(t.message)).setNetworkType(this.tim.netMonitor.getNetworkType()).setEnd(),t.code?_s.warn("Oops! code:".concat(t.code," message:").concat(t.message)):_s.warn("Oops! message:".concat(t.message," stack:").concat(t.stack)),this.tim.outerEmitter.emit(wn.ERROR,t)}}]),e}(),Zh=function(){function e(t){var n=this;Ln(this,e),nu(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.gender=t.gender||"",this.birthday=t.birthday||0,this.location=t.location||"",this.selfSignature=t.selfSignature||"",this.allowType=t.allowType||En.ALLOW_TYPE_ALLOW_ANY,this.language=t.language||0,this.avatar=t.avatar||"",this.messageSettings=t.messageSettings||0,this.adminForbidType=t.adminForbidType||En.FORBID_TYPE_NONE,this.level=t.level||0,this.role=t.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],nu(t.profileCustomField)||t.profileCustomField.forEach(function(e){n.profileCustomField.push({key:e.key,value:e.value})}))}return Nn(e,[{key:"validate",value:function(e){var t=!0,n="";if(nu(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var r=e.profileCustomField.length,i=null,o=0;o<r;o++){if(i=e.profileCustomField[o],!ks(i.key)||-1===i.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"自定义资料字段的前缀必须是 Tag_Profile_Custom"};if(!ks(i.value))return{valid:!1,tips:"自定义资料字段的 value 必须是字符串"}}for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if("profileCustomField"===a)continue;if(nu(e[a])&&!ks(e[a])&&!Ss(e[a])){n="key:"+a+", invalid value:"+e[a],t=!1;continue}switch(a){case"nick":ks(e[a])||(n="nick should be a string",t=!1),Us(e[a])>500&&(n="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(Us(e[a])," bytes"),t=!1);break;case"gender":Bs(id,e.gender)||(n="key:gender, invalid value:"+e.gender,t=!1);break;case"birthday":Ss(e.birthday)||(n="birthday should be a number",t=!1);break;case"location":ks(e.location)||(n="location should be a string",t=!1);break;case"selfSignature":ks(e.selfSignature)||(n="selfSignature should be a string",t=!1);break;case"allowType":Bs(ad,e.allowType)||(n="key:allowType, invalid value:"+e.allowType,t=!1);break;case"language":Ss(e.language)||(n="language should be a number",t=!1);break;case"avatar":ks(e.avatar)||(n="avatar should be a string",t=!1);break;case"messageSettings":0!==e.messageSettings&&1!==e.messageSettings&&(n="messageSettings should be 0 or 1",t=!1);break;case"adminForbidType":Bs(od,e.adminForbidType)||(n="key:adminForbidType, invalid value:"+e.adminForbidType,t=!1);break;case"level":Ss(e.level)||(n="level should be a number",t=!1);break;case"role":Ss(e.role)||(n="role should be a number",t=!1);break;default:n="unknown key:"+a+"  "+e[a],t=!1}}return{valid:t,tips:n}}}]),e}(),$h=function(){function e(t){Ln(this,e),this.userController=t,this.TAG="profile",this.Actions={Q:"query",U:"update"},this.accountProfileMap=new Map,this.expirationTime=864e5}return Nn(e,[{key:"setExpirationTime",value:function(e){this.expirationTime=e}},{key:"getUserProfile",value:function(e){var t=this,n=e.userIDList;e.fromAccount=this.userController.getMyAccount(),n.length>100&&(_s.warn("ProfileHandler.getUserProfile 获取用户资料人数不能超过100人"),n.length=100);for(var r,i=[],o=[],a=0,s=n.length;a<s;a++)r=n[a],this.userController.isMyFriend(r)&&this._containsAccount(r)?o.push(this._getProfileFromMap(r)):i.push(r);if(0===i.length)return pp(o);e.toAccount=i;var u=e.bFromGetMyProfile||!1,l=[];e.toAccount.forEach(function(e){l.push({toAccount:e,standardSequence:0,customSequence:0})}),e.userItem=l;var c=new Cp("getUserProfile");c.setText(n.length>5?"userIDList.length=".concat(n.length):"userIDList=".concat(n));var d=this.userController.generateConfig(this.TAG,this.Actions.Q,e);return this.userController.request(d).then(function(e){c.setNetworkType(t.userController.getNetworkType()).setEnd(),_s.info("ProfileHandler.getUserProfile ok");var n=t._handleResponse(e).concat(o);return u?(t.userController.onGotMyProfile(),new dp(n[0])):new dp(n)}).catch(function(e){return t.userController.probeNetwork().then(function(t){var n=Jn(t,2),r=n[0],i=n[1];c.setError(e,r,i).setEnd()}),_s.error("ProfileHandler.getUserProfile error:",e),hp(e)})}},{key:"getMyProfile",value:function(){var e=this.userController.getMyAccount();if(_s.log("ProfileHandler.getMyProfile myAccount="+e),this._fillMap(),this._containsAccount(e)){var t=this._getProfileFromMap(e);return _s.debug("ProfileHandler.getMyProfile from cache, myProfile:"+JSON.stringify(t)),this.userController.onGotMyProfile(),pp(t)}return this.getUserProfile({fromAccount:e,userIDList:[e],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(e){for(var t,n,r=Ds.now(),i=e.data.userProfileItem,o=[],a=0,s=i.length;a<s;a++)"@TLS#NOT_FOUND"!==i[a].to&&""!==i[a].to&&(t=i[a].to,n=this._updateMap(t,this._getLatestProfileFromResponse(t,i[a].profileItem)),o.push(n));return _s.log("ProfileHandler._handleResponse cost "+(Ds.now()-r)+" ms"),o}},{key:"_getLatestProfileFromResponse",value:function(e,t){var n={};if(n.userID=e,n.profileCustomField=[],!nu(t))for(var r=0,i=t.length;r<i;r++)if(t[r].tag.indexOf("Tag_Profile_Custom")>-1)n.profileCustomField.push({key:t[r].tag,value:t[r].value});else switch(t[r].tag){case rd.NICK:n.nick=t[r].value;break;case rd.GENDER:n.gender=t[r].value;break;case rd.BIRTHDAY:n.birthday=t[r].value;break;case rd.LOCATION:n.location=t[r].value;break;case rd.SELFSIGNATURE:n.selfSignature=t[r].value;break;case rd.ALLOWTYPE:n.allowType=t[r].value;break;case rd.LANGUAGE:n.language=t[r].value;break;case rd.AVATAR:n.avatar=t[r].value;break;case rd.MESSAGESETTINGS:n.messageSettings=t[r].value;break;case rd.ADMINFORBIDTYPE:n.adminForbidType=t[r].value;break;case rd.LEVEL:n.level=t[r].value;break;case rd.ROLE:n.role=t[r].value;break;default:_s.warn("ProfileHandler._handleResponse unkown tag->",t[r].tag,t[r].value)}return n}},{key:"updateMyProfile",value:function(e){var t=this,n=new Cp("updateMyProfile");n.setText(JSON.stringify(e));var r=(new Zh).validate(e);if(!r.valid)return n.setCode(Td.UPDATE_PROFILE_INVALID_PARAM).setMessage("ProfileHandler.updateMyProfile info:".concat(r.tips)).setNetworkType(this.userController.getNetworkType()).setEnd(),_s.error("ProfileHandler.updateMyProfile info:".concat(r.tips,"，请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#updateMyProfile")),hp({code:Td.UPDATE_PROFILE_INVALID_PARAM,message:"传入 updateMyProfile 接口的参数无效"});var i=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&("profileCustomField"===o?e.profileCustomField.forEach(function(e){i.push({tag:e.key,value:e.value})}):i.push({tag:rd[o.toUpperCase()],value:e[o]}));if(0===i.length)return n.setCode(Td.UPDATE_PROFILE_NO_KEY).setMessage(Md).setNetworkType(this.userController.getNetworkType()).setEnd(),_s.error("ProfileHandler.updateMyProfile info:".concat(Md,"，请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#updateMyProfile")),hp({code:Td.UPDATE_PROFILE_NO_KEY,message:Md});var a=this.userController.generateConfig(this.TAG,this.Actions.U,{fromAccount:this.userController.getMyAccount(),profileItem:i});return this.userController.request(a).then(function(r){n.setNetworkType(t.userController.getNetworkType()).setEnd(),_s.info("ProfileHandler.updateMyProfile ok");var i=t._updateMap(t.userController.getMyAccount(),e);return t.userController.emitOuterEvent(wn.PROFILE_UPDATED,[i]),pp(i)}).catch(function(e){return t.userController.probeNetwork().then(function(t){var r=Jn(t,2),i=r[0],o=r[1];n.setError(e,i,o).setEnd()}),_s.error("ProfileHandler.updateMyProfile error:",e),hp(e)})}},{key:"onProfileModified",value:function(e){var t=e.data;if(!nu(t)){var n,r,i=t.length;_s.info("ProfileHandler.onProfileModified length="+i);for(var o=[],a=0;a<i;a++)n=t[a].userID,r=this._updateMap(n,this._getLatestProfileFromResponse(n,t[a].profileList)),o.push(r);this.userController.emitInnerEvent(zf,o),this.userController.emitOuterEvent(wn.PROFILE_UPDATED,o)}}},{key:"_fillMap",value:function(){if(0===this.accountProfileMap.size){for(var e=this._getCachedProfiles(),t=Date.now(),n=0,r=e.length;n<r;n++)t-e[n].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(e[n].userID,e[n]);_s.log("ProfileHandler._fillMap from cache, map.size="+this.accountProfileMap.size)}}},{key:"_updateMap",value:function(e,t){var n,r=Date.now();return this._containsAccount(e)?(n=this._getProfileFromMap(e),t.profileCustomField&&zs(n.profileCustomField,t.profileCustomField),Ls(n,t,["profileCustomField"]),n.lastUpdatedTime=r):(n=new Zh(t),(this.userController.isMyFriend(e)||e===this.userController.getMyAccount())&&(n.lastUpdatedTime=r,this.accountProfileMap.set(e,n))),this._flushMap(e===this.userController.getMyAccount()),n}},{key:"_flushMap",value:function(e){var t=Xn(this.accountProfileMap.values()),n=this.userController.tim.storage;_s.debug("ProfileHandler._flushMap length=".concat(t.length," flushAtOnce=").concat(e)),n.setItem(this.TAG,t,e)}},{key:"_containsAccount",value:function(e){return this.accountProfileMap.has(e)}},{key:"_getProfileFromMap",value:function(e){return this.accountProfileMap.get(e)}},{key:"_getCachedProfiles",value:function(){var e=this.userController.tim.storage.getItem(this.TAG);return nu(e)?[]:e}},{key:"onConversationsProfileUpdated",value:function(e){for(var t,n,r,i=[],o=0,a=e.length;o<a;o++)n=(t=e[o]).userID,this.userController.isMyFriend(n)&&(this._containsAccount(n)?(r=this._getProfileFromMap(n),Ls(r,t)>0&&i.push(n)):i.push(t.userID));0!==i.length&&(_s.info("ProfileHandler.onConversationsProfileUpdated toAccount:",i),this.getUserProfile({userIDList:i}))}},{key:"reset",value:function(){this._flushMap(!0),this.accountProfileMap.clear()}}]),e}();Me({target:"String",proto:!0},{repeat:Ar});var eg=function(){function e(t){Ln(this,e),this.options=t?t.options:{enablePointer:!0},this.pointsList={},this.reportText={},this.maxNameLen=0,this.gapChar="-",this.log=console.log,this.currentTask=""}return Nn(e,[{key:"newTask",value:function(e){!1!==this.options.enablePointer&&(e||(e=["task",this._timeFormat()].join("-")),this.pointsList[e]=[],this.currentTask=e,console.log("Pointer new Task : ".concat(this.currentTask)))}},{key:"deleteTask",value:function(e){!1!==this.options.enablePointer&&(e||(e=this.currentTask),this.pointsList[e].length=0,delete this.pointsList[e])}},{key:"dot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(!1!==this.options.enablePointer){t=t||this.currentTask;var n=+new Date;this.maxNameLen=this.maxNameLen<e.length?e.length:this.maxNameLen,this.flen=this.maxNameLen+10,this.pointsList[t].push({pointerName:e,time:n})}}},{key:"_analisys",value:function(e){if(!1!==this.options.enablePointer){e=e||this.currentTask;for(var t=this.pointsList[e],n=t.length,r=[],i=[],o=0;o<n;o++)0!==o&&(i=this._analisysTowPoints(t[o-1],t[o]),r.push(i.join("")));return i=this._analisysTowPoints(t[0],t[n-1],!0),r.push(i.join("")),r.join("")}}},{key:"_analisysTowPoints",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!1!==this.options.enablePointer){var r=this.flen,i=t.time-e.time,o=i.toString(),a=e.pointerName+this.gapChar.repeat(r-e.pointerName.length),s=t.pointerName+this.gapChar.repeat(r-t.pointerName.length),u=this.gapChar.repeat(4-o.length)+o,l=n?["%c",a,s,u,"ms\n%c"]:[a,s,u,"ms\n"];return l}}},{key:"report",value:function(e){if(!1!==this.options.enablePointer){e=e||this.currentTask;var t=this._analisys(e);this.pointsList=[];var n=this._timeFormat(),r="Pointer[".concat(e,"(").concat(n,")]"),i=4*this.maxNameLen,o=(i-r.length)/2;console.log(["-".repeat(o),r,"-".repeat(o)].join("")),console.log("%c"+t,"color:#66a","color:red","color:#66a"),console.log("-".repeat(i))}}},{key:"_timeFormat",value:function(){var e=new Date,t=this.zeroFix(e.getMonth()+1,2),n=this.zeroFix(e.getDate(),2);return"".concat(t,"-").concat(n," ").concat(e.getHours(),":").concat(e.getSeconds(),":").concat(e.getMinutes(),"~").concat(e.getMilliseconds())}},{key:"zeroFix",value:function(e,t){return("000000000"+e).slice(-t)}},{key:"reportAll",value:function(){if(!1!==this.options.enablePointer)for(var e in this.pointsList)Object.prototype.hasOwnProperty.call(this.pointsList,e)&&this.eport(e)}}]),e}(),tg=function e(t,n){Ln(this,e),this.userID=t;var r={};if(r.userID=t,!nu(n))for(var i=0,o=n.length;i<o;i++)switch(n[i].tag){case rd.NICK:r.nick=n[i].value;break;case rd.GENDER:r.gender=n[i].value;break;case rd.BIRTHDAY:r.birthday=n[i].value;break;case rd.LOCATION:r.location=n[i].value;break;case rd.SELFSIGNATURE:r.selfSignature=n[i].value;break;case rd.ALLOWTYPE:r.allowType=n[i].value;break;case rd.LANGUAGE:r.language=n[i].value;break;case rd.AVATAR:r.avatar=n[i].value;break;case rd.MESSAGESETTINGS:r.messageSettings=n[i].value;break;case rd.ADMINFORBIDTYPE:r.adminForbidType=n[i].value;break;case rd.LEVEL:r.level=n[i].value;break;case rd.ROLE:r.role=n[i].value;break;default:_s.debug("snsProfileItem unkown tag->",n[i].tag)}this.profile=new Zh(r)},ng=function(){function e(t){Ln(this,e),this.userController=t,this.TAG="friend",this.Actions={G:"get",D:"delete"},this.friends=new Map,this.pointer=new eg}return Nn(e,[{key:"isMyFriend",value:function(e){var t=this.friends.has(e);return t||_s.debug("FriendHandler.isMyFriend "+e+" is not my friend"),t}},{key:"_transformFriendList",value:function(e){if(!nu(e)&&!nu(e.infoItem)){_s.info("FriendHandler._transformFriendList friendNum="+e.friendNum);for(var t,n,r=e.infoItem,i=0,o=r.length;i<o;i++)n=r[i].infoAccount,t=new tg(n,r[i].snsProfileItem),this.friends.set(n,t)}}},{key:"_friends2map",value:function(e){var t=new Map;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.set(n,e[n]);return t}},{key:"getFriendList",value:function(){var e=this,t={};t.fromAccount=this.userController.getMyAccount(),_s.info("FriendHandler.getFriendList myAccount="+t.fromAccount);var n=this.userController.generateConfig(this.TAG,this.Actions.G,t);return this.userController.request(n).then(function(t){_s.info("FriendHandler.getFriendList ok"),e._transformFriendList(t.data);var n=Xn(e.friends.values());return pp(n)}).catch(function(e){return _s.error("FriendHandler.getFriendList error:",e),hp(e)})}},{key:"deleteFriend",value:function(e){if(!Array.isArray(e.toAccount))return _s.error("FriendHandler.deleteFriend options.toAccount 必需是数组"),hp({code:Td.DEL_FRIEND_INVALID_PARAM,message:"传入 deleteFriend 接口的参数无效"});e.toAccount.length>1e3&&(_s.warn("FriendHandler.deleteFriend 删除好友人数不能超过1000人"),e.toAccount.length=1e3);var t=this.userController.generateConfig(this.TAG,this.Actions.D,e);return this.userController.request(t).then(function(e){return _s.info("FriendHandler.deleteFriend ok"),pp()}).catch(function(e){return _s.error("FriendHandler.deleteFriend error:",e),hp(e)})}}]),e}(),rg=function e(t){Ln(this,e),nu||(this.userID=t.userID||"",this.timeStamp=t.timeStamp||0)},ig=function(){function e(t){Ln(this,e),this.userController=t,this.TAG="blacklist",this.Actions={G:"get",C:"create",D:"delete"},this.blacklistMap=new Map,this.startIndex=0,this.maxLimited=100,this.curruentSequence=0}return Nn(e,[{key:"getBlacklist",value:function(){var e=this,t={};t.fromAccount=this.userController.getMyAccount(),t.maxLimited=this.maxLimited,t.startIndex=0,t.lastSequence=this.curruentSequence;var n=new Cp("getBlacklist"),r=this.userController.generateConfig(this.TAG,this.Actions.G,t);return this.userController.request(r).then(function(t){var r=nu(t.data.blackListItem)?0:t.data.blackListItem.length;return n.setNetworkType(e.userController.getNetworkType()).setText(r).setEnd(),_s.info("BlacklistHandler.getBlacklist ok"),e.curruentSequence=t.data.curruentSequence,e._handleResponse(t.data.blackListItem,!0),e._onBlacklistUpdated()}).catch(function(t){return e.userController.probeNetwork().then(function(e){var r=Jn(e,2),i=r[0],o=r[1];n.setError(t,i,o).setEnd()}),_s.error("BlacklistHandler.getBlacklist error:",t),hp(t)})}},{key:"addBlacklist",value:function(e){var t=this,n=new Cp("addToBlacklist");if(!Ts(e.userIDList))return n.setCode(Td.ADD_BLACKLIST_INVALID_PARAM).setMessage("BlacklistHandler.addBlacklist options.userIDList 必需是数组").setNetworkType(this.userController.getNetworkType()).setEnd(),_s.error("BlacklistHandler.addBlacklist options.userIDList 必需是数组"),hp({code:Td.ADD_BLACKLIST_INVALID_PARAM,message:"传入 addToBlacklist 接口的参数无效"});var r=this.userController.tim.loginInfo.identifier;if(1===e.userIDList.length&&e.userIDList[0]===r)return n.setCode(Td.CANNOT_ADD_SELF_TO_BLACKLIST).setMessage("不能拉黑自己").setNetworkType(this.userController.getNetworkType()).setEnd(),_s.error("BlacklistHandler.addBlacklist 不能把自己拉黑"),hp({code:Td.CANNOT_ADD_SELF_TO_BLACKLIST,message:"不能拉黑自己"});e.userIDList.includes(r)&&(e.userIDList=e.userIDList.filter(function(e){return e!==r}),_s.warn("BlacklistHandler.addBlacklist 不能把自己拉黑，已过滤")),e.fromAccount=this.userController.getMyAccount(),e.toAccount=e.userIDList;var i=this.userController.generateConfig(this.TAG,this.Actions.C,e);return this.userController.request(i).then(function(r){return n.setNetworkType(t.userController.getNetworkType()).setText(e.userIDList.length>5?"userIDList.length=".concat(e.userIDList.length):"userIDList=".concat(e.userIDList)).setEnd(),_s.info("BlacklistHandler.addBlacklist ok"),t._handleResponse(r.data.resultItem,!0),t._onBlacklistUpdated()}).catch(function(e){return t.userController.probeNetwork().then(function(t){var r=Jn(t,2),i=r[0],o=r[1];n.setError(e,i,o).setEnd()}),_s.error("BlacklistHandler.addBlacklist error:",e),hp(e)})}},{key:"_handleResponse",value:function(e,t){if(!nu(e))for(var n,r,i,o=0,a=e.length;o<a;o++)r=e[o].to,i=e[o].resultCode,(xs(i)||0===i)&&(t?((n=this.blacklistMap.has(r)?this.blacklistMap.get(r):new rg).userID=r,!nu(e[o].addBlackTimeStamp)&&(n.timeStamp=e[o].addBlackTimeStamp),this.blacklistMap.set(r,n)):this.blacklistMap.has(r)&&(n=this.blacklistMap.get(r),this.blacklistMap.delete(r)));_s.log("BlacklistHandler._handleResponse total="+this.blacklistMap.size+" bAdd="+t)}},{key:"deleteBlacklist",value:function(e){var t=this,n=new Cp("removeFromBlacklist");if(!Ts(e.userIDList))return n.setCode(Td.DEL_BLACKLIST_INVALID_PARAM).setMessage("BlacklistHandler.deleteBlacklist options.userIDList 必需是数组").setNetworkType(this.userController.getNetworkType()).setEnd(),_s.error("BlacklistHandler.deleteBlacklist options.userIDList 必需是数组"),hp({code:Td.DEL_BLACKLIST_INVALID_PARAM,message:"传入 removeFromBlacklist 接口的参数无效"});e.fromAccount=this.userController.getMyAccount(),e.toAccount=e.userIDList;var r=this.userController.generateConfig(this.TAG,this.Actions.D,e);return this.userController.request(r).then(function(r){return n.setNetworkType(t.userController.getNetworkType()).setText(e.userIDList.length>5?"userIDList.length=".concat(e.userIDList.length):"userIDList=".concat(e.userIDList)).setEnd(),_s.info("BlacklistHandler.deleteBlacklist ok"),t._handleResponse(r.data.resultItem,!1),t._onBlacklistUpdated()}).catch(function(e){return t.userController.probeNetwork().then(function(t){var r=Jn(t,2),i=r[0],o=r[1];n.setError(e,i,o).setEnd()}),_s.error("BlacklistHandler.deleteBlacklist error:",e),hp(e)})}},{key:"_onBlacklistUpdated",value:function(){var e=Xn(this.blacklistMap.keys());return this.userController.emitOuterEvent(wn.BLACKLIST_UPDATED,e),pp(e)}},{key:"handleBlackListDelAccount",value:function(e){for(var t,n=[],r=0,i=e.length;r<i;r++)t=e[r],this.blacklistMap.has(t)&&(this.blacklistMap.delete(t),n.push(t));n.length>0&&(_s.log("BlacklistHandler.handleBlackListDelAccount delCount="+n.length+" : "+n.join(",")),this.userController.emitOuterEvent(wn.BLACKLIST_UPDATED,Xn(this.blacklistMap.keys())))}},{key:"handleBlackListAddAccount",value:function(e){for(var t,n=[],r=0,i=e.length;r<i;r++)t=e[r],this.blacklistMap.has(t)||(this.blacklistMap.set(t,new rg({userID:t})),n.push(t));n.length>0&&(_s.log("BlacklistHandler.handleBlackListAddAccount addCount="+n.length+" : "+n.join(",")),this.userController.emitOuterEvent(wn.BLACKLIST_UPDATED,Xn(this.blacklistMap.keys())))}},{key:"reset",value:function(){this.blacklistMap.clear(),this.startIndex=0,this.maxLimited=100,this.curruentSequence=0}}]),e}(),og=function(){function e(t){Ln(this,e),this.userController=t,this.TAG="applyC2C",this.Actions={C:"create",G:"get",D:"delete",U:"update"}}return Nn(e,[{key:"applyAddFriend",value:function(e){var t=this,n=this.userController.generateConfig(this.TAG,this.Actions.C,e),r=this.userController.request(n);return r.then(function(e){t.userController.isActionSuccessful("applyAddFriend",t.Actions.C,e)}).catch(function(e){}),r}},{key:"getPendency",value:function(e){var t=this,n=this.userController.generateConfig(this.TAG,this.Actions.G,e),r=this.userController.request(n);return r.then(function(e){t.userController.isActionSuccessful("getPendency",t.Actions.G,e)}).catch(function(e){}),r}},{key:"deletePendency",value:function(e){var t=this,n=this.userController.generateConfig(this.TAG,this.Actions.D,e),r=this.userController.request(n);return r.then(function(e){t.userController.isActionSuccessful("deletePendency",t.Actions.D,e)}).catch(function(e){}),r}},{key:"replyPendency",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.userController.generateConfig(this.TAG,this.Actions.U,t),r=this.userController.request(n);return r.then(function(t){e.userController.isActionSuccessful("replyPendency",e.Actions.U,t)}).catch(function(e){}),r}}]),e}(),ag=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;return Ln(this,n),(r=t.call(this,e)).profileHandler=new $h(Wn(r)),r.friendHandler=new ng(Wn(r)),r.blacklistHandler=new ig(Wn(r)),r.applyC2CHandler=new og(Wn(r)),r._initializeListener(),r}return Nn(n,[{key:"_initializeListener",value:function(e){var t=this.tim.innerEmitter;t.on(lf,this.onContextUpdated,this),t.on(Af,this.onProfileModified,this),t.on(Rf,this.onNewFriendMessages,this),t.on(qf,this.onConversationsProfileUpdated,this)}},{key:"onContextUpdated",value:function(e){var t=this.tim.context;0!=!!t.a2Key&&0!=!!t.tinyID&&(this.profileHandler.getMyProfile(),this.friendHandler.getFriendList(),this.blacklistHandler.getBlacklist())}},{key:"onGotMyProfile",value:function(){this.triggerReady()}},{key:"onProfileModified",value:function(e){this.profileHandler.onProfileModified(e)}},{key:"onNewFriendMessages",value:function(e){_s.debug("onNewFriendMessages",JSON.stringify(e.data)),nu(e.data.blackListDelAccount)||this.blacklistHandler.handleBlackListDelAccount(e.data.blackListDelAccount),nu(e.data.blackListAddAccount)||this.blacklistHandler.handleBlackListAddAccount(e.data.blackListAddAccount)}},{key:"onConversationsProfileUpdated",value:function(e){this.profileHandler.onConversationsProfileUpdated(e.data)}},{key:"getMyAccount",value:function(){return this.tim.context.identifier}},{key:"isMyFriend",value:function(e){return this.friendHandler.isMyFriend(e)}},{key:"generateConfig",value:function(e,t,n){return{name:e,action:t,param:n}}},{key:"getMyProfile",value:function(){return this.profileHandler.getMyProfile()}},{key:"getUserProfile",value:function(e){return this.profileHandler.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this.profileHandler.updateMyProfile(e)}},{key:"getFriendList",value:function(){return this.friendHandler.getFriendList()}},{key:"deleteFriend",value:function(e){return this.friendHandler.deleteFriend(e)}},{key:"getBlacklist",value:function(){return this.blacklistHandler.getBlacklist()}},{key:"addBlacklist",value:function(e){return this.blacklistHandler.addBlacklist(e)}},{key:"deleteBlacklist",value:function(e){return this.blacklistHandler.deleteBlacklist(e)}},{key:"applyAddFriend",value:function(e){return this.applyC2CHandler.applyAddFriend(e)}},{key:"getPendency",value:function(e){return this.applyC2CHandler.getPendency(e)}},{key:"deletePendency",value:function(e){return this.applyC2CHandler.deletePendency(e)}},{key:"replyPendency",value:function(e){return this.applyC2CHandler.replyPendency(e)}},{key:"reset",value:function(){_s.info("UserController.reset"),this.resetReady(),this.profileHandler.reset(),this.blacklistHandler.reset(),this.checkTimes=0}}]),n}(up),sg=[],ug=sg.sort,lg=o(function(){sg.sort(void 0)}),cg=o(function(){sg.sort(null)}),dg=st("sort");Me({target:"Array",proto:!0,forced:lg||!cg||!dg},{sort:function(e){return void 0===e?ug.call(Le(this)):ug.call(Le(this),nt(e))}});var fg=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers"],pg=function(){function e(t){Ln(this,e),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:""},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.groupCustomField=[],this.muteAllMembers=void 0,this._initGroup(t)}return Nn(e,[{key:"_initGroup",value:function(e){for(var t in e)fg.indexOf(t)<0||("selfInfo"!==t?("memberNum"===t&&(this.memberCount=e[t]),"maxMemberNum"===t&&(this.maxMemberCount=e[t]),this[t]=e[t]):this.updateSelfInfo(e[t]))}},{key:"updateGroup",value:function(e){var t=JSON.parse(JSON.stringify(e));t.lastMsgTime&&(this.lastMessage.lastTime=t.lastMsgTime),xs(t.muteAllMembers)||("On"===t.muteAllMembers?t.muteAllMembers=!0:t.muteAllMembers=!1),t.groupCustomField&&zs(this.groupCustomField,t.groupCustomField),xs(t.memberNum)||(this.memberCount=t.memberNum),xs(t.maxMemberNum)||(this.maxMemberCount=t.maxMemberNum),Ls(this,t,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum"])}},{key:"updateSelfInfo",value:function(e){var t=e.nameCard,n=e.joinTime,r=e.role,i=e.messageRemindType;Ls(this.selfInfo,{nameCard:t,joinTime:n,role:r,messageRemindType:i},[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(e){this.selfInfo.nameCard=e}},{key:"memberNum",set:function(e){},get:function(){return _s.warn("！！！v2.8.0起弃用memberNum，请使用 memberCount"),this.memberCount}},{key:"maxMemberNum",set:function(e){},get:function(){return _s.warn("！！！v2.8.0起弃用maxMemberNum，请使用 maxMemberCount"),this.maxMemberCount}}]),e}(),hg=function(e,t){if(xs(t))return"";switch(e){case En.MSG_TEXT:return t.text;case En.MSG_IMAGE:return"[图片]";case En.MSG_GEO:return"[位置]";case En.MSG_AUDIO:return"[语音]";case En.MSG_VIDEO:return"[视频]";case En.MSG_FILE:return"[文件]";case En.MSG_CUSTOM:return"[自定义消息]";case En.MSG_GRP_TIP:return"[群提示消息]";case En.MSG_GRP_SYS_NOTICE:return"[群系统通知]";case En.MSG_FACE:return"[动画表情]";default:return""}},gg=function(e){return xs(e)?{lastTime:0,lastSequence:0,fromAccount:0,messageForShow:"",payload:null,type:"",isRevoked:!1}:e instanceof Vd?{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",messageForShow:hg(e.type,e.payload),payload:e.payload||null,type:e.type||null,isRevoked:!1}:jn(jn({},e),{},{isRevoked:!1,messageForShow:hg(e.type,e.payload)})},vg=function(){function e(t){Ln(this,e),this.conversationID=t.conversationID||"",this.unreadCount=t.unreadCount||0,this.type=t.type||"",this.lastMessage=gg(t.lastMessage),t.lastMsgTime&&(this.lastMessage.lastTime=t.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=t.peerReadTime||0,this._initProfile(t)}return Nn(e,[{key:"_initProfile",value:function(e){var t=this;Object.keys(e).forEach(function(n){switch(n){case"userProfile":t.userProfile=e.userProfile;break;case"groupProfile":t.groupProfile=e.groupProfile}}),xs(this.userProfile)&&this.type===En.CONV_C2C?this.userProfile=new Zh({userID:e.conversationID.replace("C2C","")}):xs(this.groupProfile)&&this.type===En.CONV_GROUP&&(this.groupProfile=new pg({groupID:e.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(e,t){xs(e)||(Ys(this.subType)||Js(this.subType)?this.unreadCount=0:t&&this.type===En.CONV_GROUP?this.unreadCount=e:this.unreadCount=this.unreadCount+e)}},{key:"updateLastMessage",value:function(e){this.lastMessage=gg(e)}},{key:"reduceUnreadCount",value:function(){this.unreadCount>=1&&(this.unreadCount-=1)}},{key:"isLastMessageRevoked",value:function(e){var t=e.sequence,n=e.time;return this.type===En.CONV_C2C&&t===this.lastMessage.lastSequence&&n===this.lastMessage.lastTime||this.type===En.CONV_GROUP&&t===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"toAccount",get:function(){return this.conversationID.replace("C2C","").replace("GROUP","")}},{key:"subType",get:function(){return this.groupProfile?this.groupProfile.type:""}}]),e}(),mg=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;return Ln(this,n),(r=t.call(this,e)).pagingStatus=Xu.NOT_START,r.pagingTimeStamp=0,r.conversationMap=new Map,r.tempGroupList=[],r._initListeners(),r}return Nn(n,[{key:"hasLocalConversationMap",value:function(){return this.conversationMap.size>0}},{key:"_createLocalConversation",value:function(e){return this.conversationMap.has(e)?this.conversationMap.get(e):(_s.log("ConversationController._createLocalConversation conversationID:".concat(e)),new vg({conversationID:e,type:e.slice(0,3)===En.CONV_C2C?En.CONV_C2C:En.CONV_GROUP}))}},{key:"hasLocalConversation",value:function(e){return this.conversationMap.has(e)}},{key:"getConversationList",value:function(){var e=this;_s.log("ConversationController.getConversationList."),this.pagingStatus===Xu.REJECTED&&(_s.log("ConversationController.getConversationList. continue to sync conversationList"),this._syncConversationList());var t=new Cp("getConversationList");return this.request({name:"conversation",action:"query"}).then(function(n){var r=n.data.conversations,i=void 0===r?[]:r,o=e._getConversationOptions(i);return e._updateLocalConversationList(o,!0),e._setStorageConversationList(),e._handleC2CPeerReadTime(),t.setText(i.length).setNetworkType(e.getNetworkType()).setEnd(),_s.log("ConversationController.getConversationList ok."),pp({conversationList:e.getLocalConversationList()})}).catch(function(n){return e.probeNetwork().then(function(e){var r=Jn(e,2),i=r[0],o=r[1];t.setError(n,i,o).setEnd()}),_s.error("ConversationController.getConversationList error:",n),hp(n)})}},{key:"_syncConversationList",value:function(){var e=this,t=new Cp("syncConversationList");return this.pagingStatus===Xu.NOT_START&&this.conversationMap.clear(),this._autoPagingSyncConversationList().then(function(n){return e.pagingStatus=Xu.RESOLVED,e._setStorageConversationList(),e._handleC2CPeerReadTime(),t.setText("".concat(e.conversationMap.size)).setNetworkType(e.getNetworkType()).setEnd(),n}).catch(function(n){return e.pagingStatus=Xu.REJECTED,t.setText(e.pagingTimeStamp),e.probeNetwork().then(function(e){var r=Jn(e,2),i=r[0],o=r[1];t.setError(n,i,o).setEnd()}),hp(n)})}},{key:"_autoPagingSyncConversationList",value:function(){var e=this;return this.pagingStatus=Xu.PENDING,this.request({name:"conversation",action:"pagingQuery",param:{fromAccount:this.tim.context.identifier,timeStamp:this.pagingTimeStamp,orderType:1}}).then(function(t){var n=t.data,r=n.completeFlag,i=n.conversations,o=void 0===i?[]:i,a=n.timeStamp;if(_s.log("ConversationController._autoPagingSyncConversationList completeFlag=".concat(r," nums=").concat(o.length)),o.length>0){var s=e._getConversationOptions(o);e._updateLocalConversationList(s,!0)}if(e._isReady)e._emitConversationUpdate();else{if(!e.isLoggedIn())return pp();e.triggerReady()}return e.pagingTimeStamp=a,1!==r?e._autoPagingSyncConversationList():pp()}).catch(function(t){throw e.isLoggedIn()&&(e._isReady||(_s.warn("ConversationController._autoPagingSyncConversationList failed. error:".concat(Ps(t))),e.triggerReady())),t})}},{key:"_handleC2CPeerReadTime",value:function(){var e,t=this.tim.messageController,n=$n(this.conversationMap);try{for(n.s();!(e=n.n()).done;){var r=Jn(e.value,2),i=r[0],o=r[1];o.type===En.CONV_C2C&&(_s.debug("ConversationController._handleC2CPeerReadTime",i,o.peerReadTime),t.recordPeerReadTime(i,o.peerReadTime))}}catch(e){n.e(e)}finally{n.f()}}},{key:"getConversationProfile",value:function(e){var t=this,n=this.conversationMap.has(e)?this.conversationMap.get(e):this._createLocalConversation(e);if(n._isInfoCompleted||n.type===En.CONV_SYSTEM)return pp({conversation:n});var r=new Cp("getConversationProfile");return _s.log("ConversationController.getConversationProfile. conversationID:".concat(e," lastMessage:"),n.lastMessage),this._updateUserOrGroupProfileCompletely(n).then(function(n){return r.setNetworkType(t.getNetworkType()).setText("conversationID=".concat(e," unreadCount=").concat(n.data.conversation.unreadCount)).setEnd(),_s.log("ConversationController.getConversationProfile ok. conversationID:",e),n}).catch(function(n){return t.probeNetwork().then(function(t){var i=Jn(t,2),o=i[0],a=i[1];r.setError(n,o,a).setText("conversationID=".concat(e)).setEnd()}),_s.error("ConversationController.getConversationProfile error:",n),hp(n)})}},{key:"deleteConversation",value:function(e){var t=this,n={};if(!this.conversationMap.has(e)){var r=new Ed({code:Td.CONVERSATION_NOT_FOUND,message:"没有找到相应的会话，请检查传入参数"});return hp(r)}switch(this.conversationMap.get(e).type){case En.CONV_C2C:n.type=1,n.toAccount=e.replace(En.CONV_C2C,"");break;case En.CONV_GROUP:n.type=2,n.toGroupID=e.replace(En.CONV_GROUP,"");break;case En.CONV_SYSTEM:return this.tim.groupController.deleteGroupSystemNotice({messageList:this.tim.messageController.getLocalMessageList(e)}),this.deleteLocalConversation(e),pp({conversationID:e});default:var i=new Ed({code:Td.CONVERSATION_UN_RECORDED_TYPE,message:"未记录的会话类型"});return hp(i)}var o=new Cp("deleteConversation");return o.setText("conversationID=".concat(e)),_s.log("ConversationController.deleteConversation. conversationID=".concat(e)),this.tim.setMessageRead({conversationID:e}).then(function(){return t.request({name:"conversation",action:"delete",param:n})}).then(function(){return o.setNetworkType(t.getNetworkType()).setEnd(),_s.log("ConversationController.deleteConversation ok."),t.deleteLocalConversation(e),pp({conversationID:e})}).catch(function(e){return t.probeNetwork().then(function(t){var n=Jn(t,2),r=n[0],i=n[1];o.setError(e,r,i).setEnd()}),_s.error("ConversationController.deleteConversation error:",e),hp(e)})}},{key:"getLocalConversationList",value:function(){return Xn(this.conversationMap.values())}},{key:"getLocalConversation",value:function(e){return this.conversationMap.get(e)}},{key:"_initLocalConversationList",value:function(){var e=new Cp("getConversationListInStorage");_s.time("initConversationList"),_s.log("ConversationController._initLocalConversationList.");var t=this._getStorageConversationList();if(t){for(var n=t.length,r=0;r<n;r++)this.conversationMap.set(t[r].conversationID,new vg(t[r]));this._emitConversationUpdate(!0,!1),e.setNetworkType(this.getNetworkType()).setText(n).setEnd()}else e.setNetworkType(this.getNetworkType()).setText(0).setEnd();this._syncConversationList()}},{key:"_getStorageConversationList",value:function(){return this.tim.storage.getItem("conversationMap")}},{key:"_setStorageConversationList",value:function(){var e=this.getLocalConversationList().slice(0,20).map(function(e){return{conversationID:e.conversationID,type:e.type,subType:e.subType,lastMessage:e.lastMessage,groupProfile:e.groupProfile,userProfile:e.userProfile}});this.tim.storage.setItem("conversationMap",e)}},{key:"_initListeners",value:function(){var e=this;this.tim.innerEmitter.once(lf,this._initLocalConversationList,this),this.tim.innerEmitter.on(pf,this._onSendOrReceiveMessage,this),this.tim.innerEmitter.on(hf,this._handleSyncMessages,this),this.tim.innerEmitter.on(gf,this._handleSyncMessages,this),this.tim.innerEmitter.on(vf,this._onSendOrReceiveMessage,this),this.tim.innerEmitter.on(mf,this._onSendOrReceiveMessage,this),this.tim.innerEmitter.on(yf,this._onSendOrReceiveMessage,this),this.tim.innerEmitter.on(Nf,this._onGroupListUpdated,this),this.tim.innerEmitter.on(zf,this._updateConversationUserProfile,this),this.tim.innerEmitter.on(_f,this._onMessageRevoked,this),this.ready(function(){e.tempGroupList.length>0&&(e._updateConversationGroupProfile(e.tempGroupList),e.tempGroupList.length=0)})}},{key:"_onGroupListUpdated",value:function(e){this._updateConversationGroupProfile(e.data)}},{key:"_updateConversationGroupProfile",value:function(e){var t=this;Ts(e)&&0===e.length||(this.hasLocalConversationMap()?(e.forEach(function(e){var n="GROUP".concat(e.groupID);if(t.conversationMap.has(n)){var r=t.conversationMap.get(n);r.groupProfile=e,r.lastMessage.lastSequence<e.nextMessageSeq&&(r.lastMessage.lastSequence=e.nextMessageSeq-1),r.subType||(r.subType=e.type)}}),this._emitConversationUpdate(!0,!1)):this.tempGroupList=e)}},{key:"_updateConversationUserProfile",value:function(e){var t=this;e.data.forEach(function(e){var n="C2C".concat(e.userID);t.conversationMap.has(n)&&(t.conversationMap.get(n).userProfile=e)}),this._emitConversationUpdate(!0,!1)}},{key:"_onMessageRevoked",value:function(e){var t=this,n=e.data;if(0!==n.length){var r=null,i=!1;n.forEach(function(e){(r=t.conversationMap.get(e.conversationID))&&r.isLastMessageRevoked(e)&&(i=!0,r.setLastMessageRevoked(!0))}),i&&this._emitConversationUpdate(!0,!1)}}},{key:"_handleSyncMessages",value:function(e){this._onSendOrReceiveMessage(e,!0)}},{key:"_onSendOrReceiveMessage",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.data.eventDataList;this._isReady?0!==r.length&&(this._getPeerReadTime(r),this._updateLocalConversationList(r,!1,n),this._setStorageConversationList(),this._emitConversationUpdate()):this.ready(function(){t._onSendOrReceiveMessage(e,n)})}},{key:"_getPeerReadTime",value:function(e){var t=this,n=[];e.forEach(function(e){t.conversationMap.has(e.conversationID)||e.type!==En.CONV_C2C||n.push(e.conversationID.replace(En.CONV_C2C,""))}),n.length>0&&(_s.debug("ConversationController._getPeerReadTime userIDList:".concat(n)),this.tim.messageController.getPeerReadTime(n))}},{key:"_updateLocalConversationList",value:function(e,t,n){var r;r=this._updateTempConversations(e,t,n),this.conversationMap=new Map(this._sortConversations([].concat(Xn(r.conversations),Xn(this.conversationMap)))),t||this._updateUserOrGroupProfile(r.newerConversations)}},{key:"_updateTempConversations",value:function(e,t,n){for(var r=[],i=[],o=0,a=e.length;o<a;o++){var s=new vg(e[o]),u=this.conversationMap.get(s.conversationID);if(this.conversationMap.has(s.conversationID)){var l=["unreadCount","allowType","adminForbidType","payload"];n&&l.push("lastMessage"),Ls(u,s,l,[null,void 0,"",0,NaN]),u.updateUnreadCount(s.unreadCount,t),n||(u.lastMessage.payload=e[o].lastMessage.payload),this.conversationMap.delete(u.conversationID),r.push([u.conversationID,u])}else{if(s.type===En.CONV_GROUP){var c=s.groupProfile.groupID,d=this.tim.groupController.getLocalGroupProfile(c);d&&(s.groupProfile=d,s.updateUnreadCount(0))}i.push(s),r.push([s.conversationID,s])}}return{conversations:r,newerConversations:i}}},{key:"_sortConversations",value:function(e){return e.sort(function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})}},{key:"_updateUserOrGroupProfile",value:function(e){var t=this;if(0!==e.length){var n=[],r=[];e.forEach(function(e){if(e.type===En.CONV_C2C)n.push(e.toAccount);else if(e.type===En.CONV_GROUP){var i=e.toAccount;t.tim.groupController.hasLocalGroup(i)?e.groupProfile=t.tim.groupController.getLocalGroupProfile(i):r.push(i)}}),n.length>0&&this.tim.getUserProfile({userIDList:n}).then(function(e){var n=e.data;Ts(n)?n.forEach(function(e){t.conversationMap.get("C2C".concat(e.userID)).userProfile=e}):t.conversationMap.get("C2C".concat(n.userID)).userProfile=n}),r.length>0&&this.tim.groupController.getGroupProfileAdvance({groupIDList:r,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then(function(e){e.data.successGroupList.forEach(function(e){var n="GROUP".concat(e.groupID);if(t.conversationMap.has(n)){var r=t.conversationMap.get(n);Ls(r.groupProfile,e,[],[null,void 0,"",0,NaN]),!r.subType&&e.type&&(r.subType=e.type)}})})}}},{key:"_updateUserOrGroupProfileCompletely",value:function(e){var t=this;return e.type===En.CONV_C2C?this.tim.getUserProfile({userIDList:[e.toAccount]}).then(function(n){var r=n.data;return 0===r.length?hp(new Ed({code:Td.USER_OR_GROUP_NOT_FOUND,message:"没有找到相应的用户或群组，请检查传入参数"})):(e.userProfile=r[0],e._isInfoCompleted=!0,t._unshiftConversation(e),pp({conversation:e}))}):this.tim.getGroupProfile({groupID:e.toAccount}).then(function(n){return e.groupProfile=n.data.group,e._isInfoCompleted=!0,t._unshiftConversation(e),pp({conversation:e})})}},{key:"_unshiftConversation",value:function(e){e instanceof vg&&!this.conversationMap.has(e.conversationID)&&(this.conversationMap=new Map([[e.conversationID,e]].concat(Xn(this.conversationMap))),this._setStorageConversationList(),this._emitConversationUpdate(!0,!1))}},{key:"deleteLocalConversation",value:function(e){this.conversationMap.delete(e),this._setStorageConversationList(),this.emitInnerEvent(Hf,e),this._emitConversationUpdate(!0,!1)}},{key:"_getConversationOptions",value:function(e){var t=[],n=e.filter(function(e){var t=e.lastMsg;return Es(t)}).map(function(e){if(1===e.type){var n={userID:e.userID,nick:e.c2CNick,avatar:e.c2CImage};return t.push(n),{conversationID:"C2C".concat(e.userID),type:"C2C",lastMessage:{lastTime:e.time,lastSequence:e.sequence,fromAccount:e.lastC2CMsgFromAccount,messageForShow:e.messageShow,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:null,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null},userProfile:new Zh(n),peerReadTime:e.c2cPeerReadTime}}return{conversationID:"GROUP".concat(e.groupID),type:"GROUP",lastMessage:{lastTime:e.time,lastSequence:e.messageReadSeq+e.unreadCount,fromAccount:e.msgGroupFromAccount,messageForShow:e.messageShow,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:null,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null},groupProfile:new pg({groupID:e.groupID,name:e.groupNick,avatar:e.groupImage}),unreadCount:e.unreadCount,peerReadTime:0}});return t.length>0&&this.emitInnerEvent(qf,t),n}},{key:"_emitConversationUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Xn(this.conversationMap.values());t&&this.emitInnerEvent(Vf,n),e&&this.emitOuterEvent(wn.CONVERSATION_LIST_UPDATED,n)}},{key:"_conversationMapTreeShaking",value:function(e){var t=this,n=new Map(Xn(this.conversationMap));e.forEach(function(e){return n.delete(e.conversationID)}),n.has(En.CONV_SYSTEM)&&n.delete(En.CONV_SYSTEM);var r=this.tim.groupController.getJoinedAVChatRoom();r&&r.forEach(function(e){n.delete("".concat(En.CONV_GROUP).concat(e))}),Xn(n.keys()).forEach(function(e){return t.conversationMap.delete(e)})}},{key:"reset",value:function(){this.pagingStatus=Xu.NOT_START,this.pagingTimeStamp=0,this.conversationMap.clear(),this.resetReady(),this.tim.innerEmitter.once(lf,this._initLocalConversationList,this)}}]),n}(up),yg=1..toFixed,_g=Math.floor,bg=function(e,t,n){return 0===t?n:t%2==1?bg(e,t-1,n*e):bg(e*e,t/2,n)},Sg=yg&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!o(function(){yg.call({})});Me({target:"Number",proto:!0,forced:Sg},{toFixed:function(e){var t,n,r,i,o=function(e){if("number"!=typeof e&&"Number"!=f(e))throw TypeError("Incorrect invocation");return+e}(this),a=ue(e),s=[0,0,0,0,0,0],u="",l="0",c=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*s[n],s[n]=r%1e7,r=_g(r/1e7)},d=function(e){for(var t=6,n=0;--t>=0;)n+=s[t],s[t]=_g(n/e),n=n%e*1e7},p=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==s[e]){var n=String(s[e]);t=""===t?n:t+Ar.call("0",7-n.length)+n}return t};if(a<0||a>20)throw RangeError("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return String(o);if(o<0&&(u="-",o=-o),o>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(o*bg(2,69,1))-69)<0?o*bg(2,-t,1):o/bg(2,t,1),n*=4503599627370496,(t=52-t)>0){for(c(0,n),r=a;r>=7;)c(1e7,0),r-=7;for(c(bg(10,r,1),0),r=t-1;r>=23;)d(1<<23),r-=23;d(1<<r),c(1,1),d(2),l=p()}else c(0,n),c(1<<-t,0),l=p()+Ar.call("0",a);return l=a>0?u+((i=l.length)<=a?"0."+Ar.call("0",a-i)+l:l.slice(0,i-a)+"."+l.slice(i-a)):u+l}});var kg=[].push,wg=Math.min,Eg=!o(function(){return!RegExp(4294967295,"y")});ga("split",2,function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=String(g(this)),i=void 0===n?4294967295:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!oa(e))return t.call(r,e,i);for(var o,a,s,u=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),c=0,d=new RegExp(e.source,l+"g");(o=$o.call(d,r))&&!((a=d.lastIndex)>c&&(u.push(r.slice(c,o.index)),o.length>1&&o.index<r.length&&kg.apply(u,o.slice(1)),s=o[0].length,c=a,u.length>=i));)d.lastIndex===o.index&&d.lastIndex++;return c===r.length?!s&&d.test("")||u.push(""):u.push(r.slice(c)),u.length>i?u.slice(0,i):u}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=g(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=n(r,e,this,i,r!==t);if(o.done)return o.value;var a=C(e),s=String(this),u=Ri(a,RegExp),l=a.unicode,c=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(Eg?"y":"g"),d=new u(Eg?a:"^(?:"+a.source+")",c),f=void 0===i?4294967295:i>>>0;if(0===f)return[];if(0===s.length)return null===ya(d,s)?[s]:[];for(var p=0,h=0,g=[];h<s.length;){d.lastIndex=Eg?h:0;var v,m=ya(d,Eg?s:s.slice(h));if(null===m||(v=wg(ce(d.lastIndex+(Eg?0:h)),s.length))===p)h=ma(s,h,l);else{if(g.push(s.slice(p,h)),g.length===f)return g;for(var y=1;y<=m.length-1;y++)if(g.push(m[y]),g.length===f)return g;h=p=v}}return g.push(s.slice(p)),g}]},!Eg);var Tg,xg=x.f,Cg="".startsWith,Ig=Math.min,Rg=ua("startsWith"),Ag=!(Rg||(Tg=xg(String.prototype,"startsWith"),!Tg||Tg.writable));Me({target:"String",proto:!0,forced:!Ag&&!Rg},{startsWith:function(e){var t=String(g(this));aa(e);var n=ce(Ig(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return Cg?Cg.call(t,r,n):t.slice(n,n+r.length)===r}});var Og=function(){function e(t){if(Ln(this,e),void 0===t)throw new Ed({code:Td.MESSAGE_LIST_CONSTRUCTOR_NEED_OPTIONS,message:Cd});if(void 0===t.tim)throw new Ed({code:Td.MESSAGE_LIST_CONSTRUCTOR_NEED_OPTIONS,message:"".concat(Cd,".tim")});this.list=new Map,this.tim=t.tim,this._initializeOptions(t)}return Nn(e,[{key:"getLocalOldestMessageByConversationID",value:function(e){if(!e)return null;if(!this.list.has(e))return null;var t=this.list.get(e).values();return t?t.next().value:null}},{key:"_initializeOptions",value:function(e){this.options={};var t={memory:{maxDatasPerKey:100,maxBytesPerData:256,maxKeys:0},cache:{maxDatasPerKey:10,maxBytesPerData:256,maxKeys:0}};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(void 0===e[n]){this.options[n]=t[n];continue}var r=t[n];for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(void 0===e[n][i]){this.options[n][i]=r[i];continue}this.options[n][i]=e[n][i]}}}},{key:"pushIn",value:function(e){var t=e.conversationID,n=e.ID,r=!0;return this.list.has(t)||this.list.set(t,new Map),this.list.has(t)&&this.list.get(t).has(n)?r=!1:this.list.get(t).set(n,e),r}},{key:"unshift",value:function(e){Ts(e)?e.length>0&&this._unshiftMultipleMessages(e):this._unshiftSingleMessage(e)}},{key:"_unshiftSingleMessage",value:function(e){var t=e.conversationID,n=e.ID;if(!this.list.has(t))return this.list.set(t,new Map),void this.list.get(t).set(n,e);var r=Array.from(this.list.get(t));r.unshift([n,e]),this.list.set(t,new Map(r))}},{key:"_unshiftMultipleMessages",value:function(e){for(var t=e.length,n=[],r=e[0].conversationID,i=this.list.has(r)?Array.from(this.list.get(r)):[],o=0;o<t;o++)n.push([e[o].ID,e[o]]);this.list.set(r,new Map(n.concat(i)))}},{key:"remove",value:function(e){var t=e.conversationID,n=e.ID;this.list.has(t)&&this.list.get(t).delete(n)}},{key:"revoke",value:function(e,t,n){if(_s.debug("revoke message",e,t,n),this.list.has(e)){var r,i=$n(this.list.get(e));try{for(i.s();!(r=i.n()).done;){var o=Jn(r.value,2)[1];if(o.sequence===t&&!o.isRevoked&&(xs(n)||o.random===n))return o.isRevoked=!0,o}}catch(e){i.e(e)}finally{i.f()}}return null}},{key:"removeByConversationID",value:function(e){this.list.has(e)&&this.list.delete(e)}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){var n=[];if(this.list.has(e)){var r,i=$n(this.list.get(e));try{for(i.s();!(r=i.n()).done;){var o=Jn(r.value,2)[1];o.time<=t&&!o.isPeerRead&&"out"===o.flow&&(o.isPeerRead=!0,n.push(o))}}catch(e){i.e(e)}finally{i.f()}_s.log("MessagesList.updateMessageIsPeerReadProperty conversationID=".concat(e," peerReadTime=").concat(t," count=").concat(n.length))}return n}},{key:"hasLocalMessageList",value:function(e){return this.list.has(e)}},{key:"getLocalMessageList",value:function(e){return this.hasLocalMessageList(e)?Xn(this.list.get(e).values()):[]}},{key:"hasLocalMessage",value:function(e,t){return!!this.hasLocalMessageList(e)&&this.list.get(e).has(t)}},{key:"getLocalMessage",value:function(e,t){return this.hasLocalMessage(e,t)?this.list.get(e).get(t):null}},{key:"reset",value:function(){this.list.clear()}}]),e}(),Mg=function(){function e(t){Ln(this,e),this.tim=t}return Nn(e,[{key:"setMessageRead",value:function(e){var t=e.conversationID,n=e.messageID,r=this.tim.conversationController.getLocalConversation(t);if(_s.log("ReadReportHandler.setMessageRead conversationID=".concat(t," unreadCount=").concat(r?r.unreadCount:0)),!r||0===r.unreadCount)return pp();var i=n?this.tim.messageController.getLocalMessage(t,n):null;switch(r.type){case En.CONV_C2C:return this._setC2CMessageRead({conversationID:t,lastMessageTime:i?i.time:r.lastMessage.lastTime});case En.CONV_GROUP:return this._setGroupMessageRead({conversationID:t,lastMessageSeq:i?i.sequence:r.lastMessage.lastSequence});case En.CONV_SYSTEM:return r.unreadCount=0,pp();default:return pp()}}},{key:"_setC2CMessageRead",value:function(e){var t=this,n=e.conversationID,r=e.lastMessageTime;_s.log("ReadReportHandler._setC2CMessageRead conversationID=".concat(n," lastMessageTime=").concat(r)),Ss(r)||_s.warn("ReadReportHandler._setC2CMessageRead 请勿修改 Conversation.lastMessage.lastTime，否则可能会导致已读上报结果不准确");var i=new Cp("setC2CMessageRead");return i.setText("".concat(n,"-").concat(r)),this.tim.messageController.request({name:"conversation",action:"setC2CMessageRead",param:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:n.replace("C2C",""),lastMessageTime:r,receipt:1}]}}}).then(function(){return i.setNetworkType(t.tim.netMonitor.getNetworkType()).setEnd(),_s.log("ReadReportHandler._setC2CMessageRead ok."),t._updateIsReadAfterReadReport({conversationID:n,lastMessageTime:r}),t._updateUnreadCount(n),new dp}).catch(function(e){return t.tim.netMonitor.probe().then(function(t){var n=Jn(t,2),r=n[0],o=n[1];i.setError(e,r,o).setEnd()}),_s.log("ReadReportHandler._setC2CMessageRead failed. ".concat(Ps(e))),hp(e)})}},{key:"_setGroupMessageRead",value:function(e){var t=this,n=e.conversationID,r=e.lastMessageSeq;_s.log("ReadReportHandler._setGroupMessageRead conversationID=".concat(n," lastMessageSeq=").concat(r)),Ss(r)||_s.warn("ReadReportHandler._setGroupMessageRead 请勿修改 Conversation.lastMessage.lastSequence，否则可能会导致已读上报结果不准确");var i=new Cp("setGroupMessageRead");return i.setText("".concat(n,"-").concat(r)),this.tim.messageController.request({name:"conversation",action:"setGroupMessageRead",param:{groupID:n.replace("GROUP",""),messageReadSeq:r}}).then(function(){return i.setNetworkType(t.tim.netMonitor.getNetworkType()).setEnd(),_s.log("ReadReportHandler._setGroupMessageRead ok."),t._updateIsReadAfterReadReport({conversationID:n,lastMessageSeq:r}),t._updateUnreadCount(n),new dp}).catch(function(e){return t.tim.netMonitor.probe().then(function(t){var n=Jn(t,2),r=n[0],o=n[1];i.setError(e,r,o).setEnd()}),_s.log("ReadReportHandler._setGroupMessageRead failed. ".concat(Ps(e))),hp(e)})}},{key:"_updateUnreadCount",value:function(e){var t=this.tim,n=t.conversationController,r=t.messageController,i=n.getLocalConversation(e),o=r.getLocalMessageList(e);i&&(i.unreadCount=o.filter(function(e){return!e.isRead&&!e.getOnlineOnlyFlag()}).length,_s.log("ReadReportHandler._updateUnreadCount conversationID=".concat(i.conversationID," unreadCount=").concat(i.unreadCount)))}},{key:"_updateIsReadAfterReadReport",value:function(e){var t=e.conversationID,n=e.lastMessageSeq,r=e.lastMessageTime,i=this.tim.messageController.getLocalMessageList(t);if(0!==i.length)for(var o,a=i.length-1;a>=0;a--)if(o=i[a],!(r&&o.time>r||n&&o.sequence>n)){if("in"===o.flow&&o.isRead)break;o.setIsRead(!0)}}},{key:"updateIsRead",value:function(e){var t=this.tim,n=t.conversationController,r=t.messageController,i=n.getLocalConversation(e),o=r.getLocalMessageList(e);if(i&&0!==o.length&&!Xs(i.type)){for(var a=[],s=0;s<o.length;s++)"in"!==o[s].flow?"out"!==o[s].flow||o[s].isRead||o[s].setIsRead(!0):a.push(o[s]);var u=0;if(i.type===En.CONV_C2C){var l=a.slice(-i.unreadCount).filter(function(e){return e.isRevoked}).length;u=a.length-i.unreadCount-l}else u=a.length-i.unreadCount;for(var c=0;c<u&&!a[c].isRead;c++)a[c].setIsRead(!0)}}}]),e}(),Dg=at.findIndex,Lg=!0,Pg=dt("findIndex");"findIndex"in[]&&Array(1).findIndex(function(){Lg=!1}),Me({target:"Array",proto:!0,forced:Lg||!Pg},{findIndex:function(e){return Dg(this,e,arguments.length>1?arguments[1]:void 0)}}),ur("findIndex");var Ng=function(){function e(t){var n=t.tim,r=t.messageController;Ln(this,e),this.tim=n,this.messageController=r,this.completedMap=new Map,this._initListener()}return Nn(e,[{key:"getMessageList",value:function(e){var t=this,n=e.conversationID,r=e.nextReqMessageID,i=e.count;if(this.tim.groupController.checkJoinedAVChatRoomByID(n.replace("GROUP","")))return _s.log("GetMessageHandler.getMessageList not available in avchatroom. conversationID=".concat(n)),pp({messageList:[],nextReqMessageID:"",isCompleted:!0});(xs(i)||i>15)&&(i=15);var o=this._computeLeftCount({conversationID:n,nextReqMessageID:r});return _s.log("GetMessageHandler.getMessageList. conversationID=".concat(n," leftCount=").concat(o," count=").concat(i," nextReqMessageID=").concat(r)),this._needGetHistory({conversationID:n,leftCount:o,count:i})?this.messageController.getHistoryMessages({conversationID:n,count:20}).then(function(){return o=t._computeLeftCount({conversationID:n,nextReqMessageID:r}),new dp(t._computeResult({conversationID:n,nextReqMessageID:r,count:i,leftCount:o}))}):(_s.log("GetMessageHandler.getMessageList. get messagelist from memory"),pp(this._computeResult({conversationID:n,nextReqMessageID:r,count:i,leftCount:o})))}},{key:"setCompleted",value:function(e){_s.log("GetMessageHandler.setCompleted. conversationID=".concat(e)),this.completedMap.set(e,!0)}},{key:"deleteCompletedItem",value:function(e){_s.log("GetMessageHandler.deleteCompletedItem. conversationID=".concat(e)),this.completedMap.delete(e)}},{key:"_initListener",value:function(){var e=this;this.tim.innerEmitter.on(Yf,function(){e.setCompleted(En.CONV_SYSTEM)}),this.tim.innerEmitter.on(Kf,function(t){var n=t.data;e.setCompleted("".concat(En.CONV_GROUP).concat(n))})}},{key:"_getMessageListSize",value:function(e){return this.messageController.getLocalMessageList(e).length}},{key:"_needGetHistory",value:function(e){var t=e.conversationID,n=e.leftCount,r=e.count,i=this.tim.conversationController.getLocalConversation(t),o=!!i&&i.type===En.CONV_SYSTEM,a=!!i&&i.subType===En.GRP_AVCHATROOM;return!o&&!a&&n<r&&!this.completedMap.has(t)}},{key:"_computeResult",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,r=e.count,i=e.leftCount,o=this._computeMessageList({conversationID:t,nextReqMessageID:n,count:r}),a=this._computeIsCompleted({conversationID:t,leftCount:i,count:r}),s=this._computeNextReqMessageID({messageList:o,isCompleted:a,conversationID:t});return _s.log("GetMessageHandler._computeResult. conversationID=".concat(t," leftCount=").concat(i," count=").concat(r," nextReqMessageID=").concat(s," nums=").concat(o.length," isCompleted=").concat(a)),{messageList:o,nextReqMessageID:s,isCompleted:a}}},{key:"_computeNextReqMessageID",value:function(e){var t=e.messageList,n=e.isCompleted,r=e.conversationID;if(!n)return 0===t.length?"":t[0].ID;var i=this.messageController.getLocalMessageList(r);return 0===i.length?"":i[0].ID}},{key:"_computeMessageList",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,r=e.count,i=this.messageController.getLocalMessageList(t),o=this._computeIndexEnd({nextReqMessageID:n,messageList:i}),a=this._computeIndexStart({indexEnd:o,count:r});return i.slice(a,o)}},{key:"_computeIndexEnd",value:function(e){var t=e.messageList,n=void 0===t?[]:t,r=e.nextReqMessageID;return r?n.findIndex(function(e){return e.ID===r}):n.length}},{key:"_computeIndexStart",value:function(e){var t=e.indexEnd,n=e.count;return t>n?t-n:0}},{key:"_computeLeftCount",value:function(e){var t=e.conversationID,n=e.nextReqMessageID;return n?this.messageController.getLocalMessageList(t).findIndex(function(e){return e.ID===n}):this._getMessageListSize(t)}},{key:"_computeIsCompleted",value:function(e){var t=e.conversationID;return!!(e.leftCount<=e.count&&this.completedMap.has(t))}},{key:"reset",value:function(){_s.log("GetMessageHandler.reset"),this.completedMap.clear()}}]),e}(),Ug=function e(t){Ln(this,e),this.value=t,this.next=null},Fg=function(){function e(t){Ln(this,e),this.MAX_LENGTH=t,this.pTail=null,this.pNodeToDel=null,this.map=new Map,_s.log("SinglyLinkedList init MAX_LENGTH=".concat(this.MAX_LENGTH))}return Nn(e,[{key:"pushIn",value:function(e){var t=new Ug(e);if(this.map.size<this.MAX_LENGTH)null===this.pTail?(this.pTail=t,this.pNodeToDel=t):(this.pTail.next=t,this.pTail=t),this.map.set(e,1);else{var n=this.pNodeToDel;this.pNodeToDel=this.pNodeToDel.next,this.map.delete(n.value),n.next=null,n=null,this.pTail.next=t,this.pTail=t,this.map.set(e,1)}}},{key:"has",value:function(e){return this.map.has(e)}},{key:"tail",value:function(){return this.pTail}},{key:"size",value:function(){return this.map.size}},{key:"data",value:function(){return Array.from(this.map.keys())}},{key:"reset",value:function(){for(var e;null!==this.pNodeToDel;)e=this.pNodeToDel,this.pNodeToDel=this.pNodeToDel.next,e.next=null,e=null;this.pTail=null,this.map.clear()}}]),e}(),jg=function(){function e(t){Ln(this,e),this.tim=t}return Nn(e,[{key:"upload",value:function(e){switch(e.type){case En.MSG_IMAGE:return this._uploadImage(e);case En.MSG_FILE:return this._uploadFile(e);case En.MSG_AUDIO:return this._uploadAudio(e);case En.MSG_VIDEO:return this._uploadVideo(e);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(e){var t=this.tim,n=t.uploadController,r=t.messageController,i=e.getElements()[0],o=r.getMessageOptionByID(e.messageID);return n.uploadImage({file:o.payload.file,to:o.to,onProgress:function(e){if(i.updatePercent(e),Is(o.onProgress))try{o.onProgress(e)}catch(e){return hp(new Ed({code:Td.MESSAGE_ONPROGRESS_FUNCTION_ERROR,message:"".concat(Rd)}))}}}).then(function(t){var n=t.location,r=t.fileType,o=t.fileSize,a=t.width,s=t.height,u=Hs(n);i.updateImageFormat(r);var l=$s({originUrl:u,originWidth:a,originHeight:s,min:198}),c=$s({originUrl:u,originWidth:a,originHeight:s,min:720});return i.updateImageInfoArray([{size:o,url:u,width:a,height:s},jn({},c),jn({},l)]),e})}},{key:"_uploadFile",value:function(e){var t=this.tim,n=t.uploadController,r=t.messageController,i=e.getElements()[0],o=r.getMessageOptionByID(e.messageID);return n.uploadFile({file:o.payload.file,to:o.to,onProgress:function(e){if(i.updatePercent(e),Is(o.onProgress))try{o.onProgress(e)}catch(e){return hp(new Ed({code:Td.MESSAGE_ONPROGRESS_FUNCTION_ERROR,message:"".concat(Rd)}))}}}).then(function(t){var n=t.location,r=Hs(n);return i.updateFileUrl(r),e})}},{key:"_uploadAudio",value:function(e){var t=this.tim,n=t.uploadController,r=t.messageController,i=e.getElements()[0],o=r.getMessageOptionByID(e.messageID);return n.uploadAudio({file:o.payload.file,to:o.to,onProgress:function(e){if(i.updatePercent(e),Is(o.onProgress))try{o.onProgress(e)}catch(e){return hp(new Ed({code:Td.MESSAGE_ONPROGRESS_FUNCTION_ERROR,message:"".concat(Rd)}))}}}).then(function(t){var n=t.location,r=Hs(n);return i.updateAudioUrl(r),e})}},{key:"_uploadVideo",value:function(e){var t=this.tim,n=t.uploadController,r=t.messageController,i=e.getElements()[0],o=r.getMessageOptionByID(e.messageID);return n.uploadVideo({file:o.payload.file,to:o.to,onProgress:function(e){if(i.updatePercent(e),Is(o.onProgress))try{o.onProgress(e)}catch(e){return hp(new Ed({code:Td.MESSAGE_ONPROGRESS_FUNCTION_ERROR,message:"".concat(Rd)}))}}}).then(function(t){var n=Hs(t.location);return i.updateVideoUrl(n),e})}}]),e}(),Gg=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;return Ln(this,n),(r=t.call(this,e))._initializeMembers(),r._initializeListener(),r._initialzeHandlers(),r.messageOptionMap=new Map,r}return Nn(n,[{key:"_initializeMembers",value:function(){this.messagesList=new Og({tim:this.tim}),this.currentMessageKey={},this.singlyLinkedList=new Fg(100),this._peerReadTimeMap=new Map}},{key:"_initialzeHandlers",value:function(){this.readReportHandler=new Mg(this.tim,this),this.getMessageHandler=new Ng({messageController:this,tim:this.tim}),this.uploadFileHandler=new jg(this.tim)}},{key:"reset",value:function(){this.messagesList.reset(),this.currentMessageKey={},this.getMessageHandler.reset(),this.singlyLinkedList.reset(),this._peerReadTimeMap.clear(),this.messageOptionMap.clear()}},{key:"_initializeListener",value:function(){var e=this.tim.innerEmitter;e.on(Tf,this._onReceiveC2CMessage,this),e.on(df,this._onSyncMessagesProcessing,this),e.on(ff,this._onSyncMessagesFinished,this),e.on(xf,this._onReceiveGroupMessage,this),e.on(Cf,this._onReceiveGroupTips,this),e.on(If,this._onReceiveSystemNotice,this),e.on(Of,this._onReceiveGroupMessageRevokedNotice,this),e.on(Mf,this._onReceiveC2CMessageRevokedNotice,this),e.on(Df,this._onC2CMessageReadReceipt,this),e.on(Hf,this._clearConversationMessages,this)}},{key:"_guardForAVChatRoom",value:function(e){if(e.conversationType===En.CONV_GROUP){var t=this.tim.groupController,n=e.to;return t.hasLocalGroup(n)?Promise.resolve():t.getGroupProfile({groupID:n}).then(function(t){var r=t.data.group.type;if(_s.log("MessageController._guardForAVChatRoom. groupID=".concat(n," type=").concat(r)),r===En.GRP_AVCHATROOM){var i="userId=".concat(e.from," 未加入群 groupID=").concat(n,"。发消息前先使用 joinGroup 接口申请加群，详细请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#joinGroup");return _s.warn("MessageController._guardForAVChatRoom sendMessage not allowed. ".concat(i)),hp(new Ed({code:Td.MESSAGE_SEND_FAIL,message:i,data:{message:e}}))}return Promise.resolve()})}return Promise.resolve()}},{key:"sendMessageInstance",value:function(e,t){var n,r=this,i=null;switch(e.conversationType){case En.CONV_C2C:i=this._handleOnSendC2CMessageSuccess.bind(this);break;case En.CONV_GROUP:i=this._handleOnSendGroupMessageSuccess.bind(this);break;default:return hp(new Ed({code:Td.MESSAGE_SEND_INVALID_CONVERSATION_TYPE,message:'Message.conversationType 只能为 "C2C" 或 "GROUP"'}))}return this.singlyLinkedList.pushIn(e.random),this.uploadFileHandler.upload(e).then(function(){return r._guardForAVChatRoom(e).then(function(){var i=null;return e.isSendable()?(r._addSendMessageTotalCount(e),n=Date.now(),e.conversationType===En.CONV_C2C?i=r._createC2CMessagePack(e,t):e.conversationType===En.CONV_GROUP&&(i=r._createGroupMessagePack(e,t)),r.request(i)):hp({code:Td.MESSAGE_FILE_URL_IS_EMPTY,message:"缺少必要的参数文件 URL"})}).then(function(o){return r._addSendMessageSuccessCount(e,n),e.conversationType===En.CONV_GROUP&&(e.sequence=o.data.sequence,e.time=o.data.time,e.generateMessageID(r.tim.context.identifier)),r.messagesList.pushIn(e),i(e,o.data),r.messageOptionMap.delete(e.messageID),r._isOnlineMessage(e,t)?e.setOnlineOnlyFlag(!0):r.emitInnerEvent(pf,{eventDataList:[{conversationID:e.conversationID,unreadCount:0,type:e.conversationType,subType:e.conversationSubType,lastMessage:e}]}),"TIMImageElem"===e.type&&eu(e.payload.imageInfoArray),new dp({message:e})}).catch(function(t){e.status=Ju.FAIL;var n=new Cp("sendMessage");return n.setMessageType(e.type).setText("".concat(r._generateTjgID(e),"-").concat(e.type,"-").concat(e.from,"-").concat(e.to)),r.probeNetwork().then(function(e){var r=Jn(e,2),i=r[0],o=r[1];n.setError(t,i,o).setEnd()}),_s.error("MessageController.sendMessageInstance error:",t),hp(new Ed({code:t&&t.code?t.code:Td.MESSAGE_SEND_FAIL,message:t&&t.message?t.message:xd,data:{message:e}}))})})}},{key:"_getSendMessageSpecifiedKey",value:function(e){if(e.conversationType===En.CONV_C2C)return _p;if(e.conversationType===En.CONV_GROUP){var t=this.tim.groupController.getLocalGroupProfile(e.to);if(!t)return;var n=t.type;if(Ks(n))return bp;if(Ws(n))return Sp;if(Ys(n))return kp;if(Js(n))return wp}}},{key:"_addSendMessageTotalCount",value:function(e){var t=this.tim.sumStatController;t.addTotalCount(yp);var n=this._getSendMessageSpecifiedKey(e);n&&t.addTotalCount(n)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n=this.tim.sumStatController,r=Math.abs(Date.now()-t);n.addSuccessCount(yp),n.addCost(yp,r);var i=this._getSendMessageSpecifiedKey(e);i&&(n.addSuccessCount(i),n.addCost(i,r))}},{key:"resendMessage",value:function(e){return e.isResend=!0,e.status=Ju.UNSEND,this.sendMessageInstance(e)}},{key:"_isFileLikeMessage",value:function(e){return[En.MSG_IMAGE,En.MSG_FILE,En.MSG_AUDIO,En.MSG_VIDEO].indexOf(e.type)>=0}},{key:"_resendBinaryTypeMessage",value:function(){}},{key:"_canIUseOnlineOnlyFlag",value:function(e){var t=this.tim.groupController.getJoinedAVChatRoom();return!t||!t.includes(e.to)||e.conversationType!==En.CONV_GROUP}},{key:"_isOnlineMessage",value:function(e,t){return!(!this._canIUseOnlineOnlyFlag(e)||!t||!0!==t.onlineUserOnly)}},{key:"_createC2CMessagePack",value:function(e,t){var n=null;return t&&(t.offlinePushInfo&&(n=t.offlinePushInfo),!0===t.onlineUserOnly&&(n?n.disablePush=!0:n={disablePush:!0})),{name:"c2cMessage",action:"create",tjgID:this._generateTjgID(e),param:{toAccount:e.to,msgBody:e.getElements(),msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:this._isOnlineMessage(e,t)?0:void 0,offlinePushInfo:n?{pushFlag:!0===n.disablePush?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:!0===n.ignoreIOSBadge?1:0},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0}}}},{key:"_handleOnSendC2CMessageSuccess",value:function(e,t){e.status=Ju.SUCCESS,e.time=t.time}},{key:"_createGroupMessagePack",value:function(e,t){var n=null;return t&&t.offlinePushInfo&&(n=t.offlinePushInfo),{name:"groupMessage",action:"create",tjgID:this._generateTjgID(e),param:{groupID:e.to,msgBody:e.getElements(),random:e.random,priority:e.priority,clientSequence:e.clientSequence,onlineOnlyFlag:this._isOnlineMessage(e,t)?1:0,offlinePushInfo:n?{pushFlag:!0===n.disablePush?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:!0===n.ignoreIOSBadge?1:0},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0}}}},{key:"_handleOnSendGroupMessageSuccess",value:function(e,t){e.sequence=t.sequence,e.time=t.time,e.status=Ju.SUCCESS}},{key:"_onReceiveC2CMessage",value:function(e){_s.debug("MessageController._onReceiveC2CMessage nums=".concat(e.data.length));var t=Date.now(),n=this._newC2CMessageStoredAndSummary({notifiesList:e.data,type:En.CONV_C2C,C2CRemainingUnreadList:e.C2CRemainingUnreadList}),r=n.eventDataList,i=n.result;if(r.length>0&&this.emitInnerEvent(vf,{eventDataList:r,result:i}),i.length>0){var o=this.tim.sumStatController;o.addTotalCount(Ep),o.addSuccessCount(Ep),o.addCost(Ep,Date.now()-t),this.emitOuterEvent(wn.MESSAGE_RECEIVED,i)}}},{key:"_onReceiveGroupMessage",value:function(e){_s.debug("MessageController._onReceiveGroupMessage nums=".concat(e.data.length));var t=Date.now(),n=this.newGroupMessageStoredAndSummary(e.data),r=n.eventDataList,i=n.result;if(r.length>0&&this.emitInnerEvent(mf,{eventDataList:r,result:i,isGroupTip:!1}),i.length>0){var o=this.tim.sumStatController;o.addTotalCount(Ep),o.addSuccessCount(Ep),o.addCost(Ep,Date.now()-t),this.emitOuterEvent(wn.MESSAGE_RECEIVED,i)}}},{key:"_onReceiveGroupTips",value:function(e){var t=Date.now(),n=e.data;_s.debug("MessageController._onReceiveGroupTips nums=".concat(n.length));var r=this.newGroupTipsStoredAndSummary(n),i=r.eventDataList,o=r.result;if(i.length>0&&this.emitInnerEvent(mf,{eventDataList:i,result:o,isGroupTip:!0}),o.length>0){var a=this.tim.sumStatController;a.addTotalCount(Ep),a.addSuccessCount(Ep),a.addCost(Ep,Date.now()-t),this.emitOuterEvent(wn.MESSAGE_RECEIVED,o)}}},{key:"_onReceiveSystemNotice",value:function(e){var t=Date.now(),n=e.data,r=n.groupSystemNotices,i=n.type;_s.debug("MessageController._onReceiveSystemNotice nums=".concat(r.length));var o=this.newSystemNoticeStoredAndSummary({notifiesList:r,type:i}),a=o.eventDataList,s=o.result;if(a.length>0&&this.emitInnerEvent(yf,{eventDataList:a,result:s,type:i}),s.length>0&&"poll"===i){var u=this.tim.sumStatController;u.addTotalCount(Ep),u.addSuccessCount(Ep),u.addCost(Ep,Date.now()-t),this.emitOuterEvent(wn.MESSAGE_RECEIVED,s)}}},{key:"_onReceiveGroupMessageRevokedNotice",value:function(e){var t=this;_s.debug("MessageController._onReceiveGroupMessageRevokedNotice nums=".concat(e.data.length));var n=[],r=null;e.data.forEach(function(e){e.elements.revokedInfos.forEach(function(e){(r=t.messagesList.revoke("GROUP".concat(e.groupID),e.sequence))&&n.push(r)})}),0!==n.length&&(this.emitInnerEvent(_f,n),this.emitOuterEvent(wn.MESSAGE_REVOKED,n))}},{key:"_onReceiveC2CMessageRevokedNotice",value:function(e){var t=this;_s.debug("MessageController._onReceiveC2CMessageRevokedNotice nums=".concat(e.data.length));var n=[],r=null;e.data.forEach(function(e){e.c2cMessageRevokedNotify.revokedInfos.forEach(function(e){var i=t.tim.context.identifier===e.from?"C2C".concat(e.to):"C2C".concat(e.from);(r=t.messagesList.revoke(i,e.sequence,e.random))&&n.push(r)})}),0!==n.length&&(this.emitInnerEvent(_f,n),this.emitOuterEvent(wn.MESSAGE_REVOKED,n))}},{key:"_onC2CMessageReadReceipt",value:function(e){var t=this;e.data.forEach(function(e){if(!nu(e.c2cMessageReadReceipt)){var n=e.c2cMessageReadReceipt.to;e.c2cMessageReadReceipt.uinPairReadArray.forEach(function(e){var r=e.peerReadTime;_s.debug("MessageController._onC2CMessageReadReceipt to=".concat(n," peerReadTime=").concat(r));var i="C2C".concat(n);t.recordPeerReadTime(i,r),t._updateMessageIsPeerReadProperty(i,r)})}})}},{key:"_updateMessageIsPeerReadProperty",value:function(e,t){if(e.startsWith(En.CONV_C2C)&&t>0){var n=this.messagesList.updateMessageIsPeerReadProperty(e,t);n.length>0&&this.emitOuterEvent(wn.MESSAGE_READ_BY_PEER,n)}}},{key:"getPeerReadTime",value:function(e){var t=this;if(!nu(e)){var n=new Cp("getPeerReadTime");return _s.log("MessageController.getPeerReadTime userIDList:".concat(e)),this.request({name:"c2cPeerReadTime",action:"get",param:{userIDList:e}}).then(function(r){var i=r.data.peerReadTimeList;_s.log("MessageController.getPeerReadTime ok. peerReadTimeList:".concat(i));for(var o="",a=0;a<e.length;a++)o+="".concat(e[a],"-").concat(i[a]," "),i[a]>0&&t.recordPeerReadTime("C2C".concat(e[a]),i[a]);n.setNetworkType(t.getNetworkType()).setText(o).setEnd()}).catch(function(e){t.probeNetwork().then(function(t){var r=Jn(t,2),i=r[0],o=r[1];n.setError(e,i,o).setEnd()}),_s.warn("MessageController.getPeerReadTime failed. error:",e)})}}},{key:"recordPeerReadTime",value:function(e,t){this._peerReadTimeMap.has(e)?this._peerReadTimeMap.get(e)<t&&this._peerReadTimeMap.set(e,t):this._peerReadTimeMap.set(e,t)}},{key:"_clearConversationMessages",value:function(e){var t=e.data;this.messagesList.removeByConversationID(t),this.getMessageHandler.deleteCompletedItem(t)}},{key:"_pushIntoNoticeResult",value:function(e,t){return!(!this.messagesList.pushIn(t)||this.singlyLinkedList.has(t.random)||(e.push(t),0))}},{key:"_newC2CMessageStoredAndSummary",value:function(e){for(var t=e.notifiesList,n=e.type,r=e.C2CRemainingUnreadList,i=e.isFromSync,o=null,a=[],s=[],u={},l=this.tim.bigDataHallwayController,c=0,d=t.length;c<d;c++){var f=t[c];f.currentUser=this.tim.context.identifier,f.conversationType=n,f.isSystemMessage=!!f.isSystemMessage,o=new Vd(f),f.elements=l.parseElements(f.elements,f.from),o.setElement(f.elements),(i||this._pushIntoNoticeResult(s,o))&&(0!==f.msgLifeTime?void 0===u[o.conversationID]?u[o.conversationID]=a.push({conversationID:o.conversationID,unreadCount:"out"===o.flow?0:1,type:o.conversationType,subType:o.conversationSubType,lastMessage:o})-1:(a[u[o.conversationID]].type=o.conversationType,a[u[o.conversationID]].subType=o.conversationSubType,a[u[o.conversationID]].lastMessage=o,"in"===o.flow&&a[u[o.conversationID]].unreadCount++):o.setOnlineOnlyFlag(!0))}if(Ts(r))for(var p=function(e,t){var n=a.find(function(t){return t.conversationID==="C2C".concat(r[e].from)});n?n.unreadCount+=r[e].count:a.push({conversationID:"C2C".concat(r[e].from),unreadCount:r[e].count,type:En.CONV_C2C,lastMsgTime:r[e].lastMsgTime})},h=0,g=r.length;h<g;h++)p(h);return{eventDataList:a,result:s}}},{key:"newGroupMessageStoredAndSummary",value:function(e){var t=null,n=[],r={},i=[],o=En.CONV_GROUP,a=this.tim.bigDataHallwayController,s=e.length;s>1&&e.sort(function(e,t){return e.sequence-t.sequence});for(var u=0;u<s;u++){var l=e[u];l.currentUser=this.tim.context.identifier,l.conversationType=o,l.isSystemMessage=!!l.isSystemMessage,t=new Vd(l),l.elements=a.parseElements(l.elements,l.from),t.setElement(l.elements),this._isMessageFromAVChatroom(t)||this._pushIntoNoticeResult(i,t)&&(1!==l.onlineOnlyFlag?void 0===r[t.conversationID]?r[t.conversationID]=n.push({conversationID:t.conversationID,unreadCount:"out"===t.flow?0:1,type:t.conversationType,subType:t.conversationSubType,lastMessage:t})-1:(n[r[t.conversationID]].type=t.conversationType,n[r[t.conversationID]].subType=t.conversationSubType,n[r[t.conversationID]].lastMessage=t,"in"===t.flow&&n[r[t.conversationID]].unreadCount++):t.setOnlineOnlyFlag(!0))}return{eventDataList:n,result:i}}},{key:"_isMessageFromAVChatroom",value:function(e){var t=e.conversationID.slice(5);return this.tim.groupController.checkJoinedAVChatRoomByID(t)}},{key:"newGroupTipsStoredAndSummary",value:function(e){for(var t=null,n=[],r=[],i={},o=0,a=e.length;o<a;o++){var s=e[o];s.currentUser=this.tim.context.identifier,s.conversationType=En.CONV_GROUP,(t=new Vd(s)).setElement({type:En.MSG_GRP_TIP,content:jn(jn({},s.elements),{},{groupProfile:s.groupProfile})}),t.isSystemMessage=!1,this._isMessageFromAVChatroom(t)||this._pushIntoNoticeResult(r,t)&&(void 0===i[t.conversationID]?i[t.conversationID]=n.push({conversationID:t.conversationID,unreadCount:"out"===t.flow?0:1,type:t.conversationType,subType:t.conversationSubType,lastMessage:t})-1:(n[i[t.conversationID]].type=t.conversationType,n[i[t.conversationID]].subType=t.conversationSubType,n[i[t.conversationID]].lastMessage=t,"in"===t.flow&&n[i[t.conversationID]].unreadCount++))}return{eventDataList:n,result:r}}},{key:"newSystemNoticeStoredAndSummary",value:function(e){var t=e.notifiesList,n=e.type,r=null,i=t.length,o=0,a=[],s={conversationID:En.CONV_SYSTEM,unreadCount:0,type:En.CONV_SYSTEM,subType:null,lastMessage:null};for(o=0;o<i;o++){var u=t[o];15!==u.elements.operationType&&(u.currentUser=this.tim.context.identifier,u.conversationType=En.CONV_SYSTEM,u.conversationID=En.CONV_SYSTEM,(r=new Vd(u)).setElement({type:En.MSG_GRP_SYS_NOTICE,content:jn(jn({},u.elements),{},{groupProfile:u.groupProfile})}),r.isSystemMessage=!0,(1===r.sequence&&1===r.random||2===r.sequence&&2===r.random)&&(r.sequence=Fs(),r.random=Fs(),r.generateMessageID(u.currentUser),_s.log("MessageController.newSystemNoticeStoredAndSummary sequence and random maybe duplicated, regenerate. ID=".concat(r.ID))),this._pushIntoNoticeResult(a,r)&&("poll"===n?s.unreadCount++:"sync"===n&&r.setIsRead(!0),s.subType=r.conversationSubType))}return s.lastMessage=a[a.length-1],{eventDataList:a.length>0?[s]:[],result:a}}},{key:"_onSyncMessagesProcessing",value:function(e){var t=this._newC2CMessageStoredAndSummary({notifiesList:e.data,type:En.CONV_C2C,isFromSync:!0,C2CRemainingUnreadList:e.C2CRemainingUnreadList}),n=t.eventDataList,r=t.result;this.emitInnerEvent(hf,{eventDataList:n,result:r})}},{key:"_onSyncMessagesFinished",value:function(e){this.triggerReady();var t=this._newC2CMessageStoredAndSummary({notifiesList:e.data.messageList,type:En.CONV_C2C,isFromSync:!0,C2CRemainingUnreadList:e.data.C2CRemainingUnreadList}),n=t.eventDataList,r=t.result;this.emitInnerEvent(gf,{eventDataList:n,result:r})}},{key:"getHistoryMessages",value:function(e){if(e.conversationID===En.CONV_SYSTEM)return pp();!e.count&&(e.count=15),e.count>20&&(e.count=20);var t=this.messagesList.getLocalOldestMessageByConversationID(e.conversationID);t||((t={}).time=0,t.sequence=0,0===e.conversationID.indexOf(En.CONV_C2C)?(t.to=e.conversationID.replace(En.CONV_C2C,""),t.conversationType=En.CONV_C2C):0===e.conversationID.indexOf(En.CONV_GROUP)&&(t.to=e.conversationID.replace(En.CONV_GROUP,""),t.conversationType=En.CONV_GROUP));var n="";switch(t.conversationType){case En.CONV_C2C:return n=e.conversationID.replace(En.CONV_C2C,""),this.getC2CRoamMessages({conversationID:e.conversationID,peerAccount:n,count:e.count,lastMessageTime:void 0===this.currentMessageKey[e.conversationID]?0:t.time});case En.CONV_GROUP:return this.getGroupRoamMessages({conversationID:e.conversationID,groupID:t.to,count:e.count,sequence:t.sequence-1});default:return pp()}}},{key:"getC2CRoamMessages",value:function(e){var t=this,n=e.conversationID,r=void 0!==this.currentMessageKey[n]?this.currentMessageKey[n]:"";_s.log("MessageController.getC2CRoamMessages toAccount=".concat(e.peerAccount," count=").concat(e.count||15," lastMessageTime=").concat(e.lastMessageTime||0," messageKey=").concat(r));var i=new Cp("getC2CRoamingMessages");return this.request({name:"c2cMessage",action:"query",param:{peerAccount:e.peerAccount,count:e.count||15,lastMessageTime:e.lastMessageTime||0,messageKey:r}}).then(function(o){var a=o.data,s=a.complete,u=a.messageList;xs(u)?_s.log("MessageController.getC2CRoamMessages ok. complete=".concat(s," but messageList is undefined!")):_s.log("MessageController.getC2CRoamMessages ok. complete=".concat(s," nums=").concat(u.length)),i.setNetworkType(t.getNetworkType()).setText("".concat(e.peerAccount,"-").concat(e.count||15,"-").concat(e.lastMessageTime||0,"-").concat(r,"-").concat(s,"-").concat(u?u.length:"undefined")).setEnd(),1===s&&t.getMessageHandler.setCompleted(n);var l=t._roamMessageStore(u,En.CONV_C2C,n);t.readReportHandler.updateIsRead(n),t.currentMessageKey[n]=o.data.messageKey;var c=t._peerReadTimeMap.get(n);if(_s.log("MessageController.getC2CRoamMessages update isPeerRead property. conversationID=".concat(n," peerReadTime=").concat(c)),c)t._updateMessageIsPeerReadProperty(n,c);else{var d=n.replace(En.CONV_C2C,"");t.getPeerReadTime([d]).then(function(){t._updateMessageIsPeerReadProperty(n,t._peerReadTimeMap.get(n))})}return l}).catch(function(n){return t.probeNetwork().then(function(t){var o=Jn(t,2),a=o[0],s=o[1];i.setError(n,a,s).setText("".concat(e.peerAccount,"-").concat(e.count||15,"-").concat(e.lastMessageTime||0,"-").concat(r)).setEnd()}),_s.warn("MessageController.getC2CRoamMessages failed. ".concat(n)),hp(n)})}},{key:"_computeLastSequence",value:function(e){return e.sequence>=0?Promise.resolve(e.sequence):this.tim.groupController.getGroupLastSequence(e.groupID)}},{key:"getGroupRoamMessages",value:function(e){var t=this,n=new Cp("getGroupRoamingMessages"),r=0;return this._computeLastSequence(e).then(function(n){return r=n,_s.log("MessageController.getGroupRoamMessages groupID=".concat(e.groupID," lastSequence=").concat(r)),t.request({name:"groupMessage",action:"query",param:{groupID:e.groupID,count:21,sequence:r}})}).then(function(i){var o=i.data,a=o.messageList,s=o.complete;xs(a)?_s.log("MessageController.getGroupRoamMessages ok. complete=".concat(s," but messageList is undefined!")):_s.log("MessageController.getGroupRoamMessages ok. complete=".concat(s," nums=").concat(a.length)),n.setNetworkType(t.getNetworkType()).setText("".concat(e.groupID,"-").concat(r,"-").concat(s,"-").concat(a?a.length:"undefined")).setEnd();var u="GROUP".concat(e.groupID);if(2===s||nu(a))return t.getMessageHandler.setCompleted(u),[];var l=t._roamMessageStore(a,En.CONV_GROUP,u);return t.readReportHandler.updateIsRead(u),t._patchConversationLastMessage(u),l}).catch(function(i){return t.probeNetwork().then(function(t){var o=Jn(t,2),a=o[0],s=o[1];n.setError(i,a,s).setText("".concat(e.groupID,"-").concat(r)).setEnd()}),_s.warn("MessageController.getGroupRoamMessages failed. ".concat(i)),hp(i)})}},{key:"_patchConversationLastMessage",value:function(e){var t=this.tim.conversationController.getLocalConversation(e);if(t){var n=t.lastMessage,r=n.messageForShow,i=n.payload;if(nu(r)||nu(i)){var o=this.messagesList.getLocalMessageList(e);if(0===o.length)return;var a=o[o.length-1];_s.log("MessageController._patchConversationLastMessage conversationID:".concat(e," payload:"),a.payload),t.updateLastMessage(a)}}}},{key:"_roamMessageStore",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=null,i=[],o=0,a=e.length,s=null,u=t===En.CONV_GROUP,l=this.tim.bigDataHallwayController,c=function(){o=u?e.length-1:0,a=u?0:e.length},d=function(){u?--o:++o},f=function(){return u?o>=a:o<a};for(c();f();d())if(u&&1===e[o].sequence&&this.getMessageHandler.setCompleted(n),1!==e[o].isPlaceMessage)if((r=new Vd(e[o])).to=e[o].to,r.isSystemMessage=!!e[o].isSystemMessage,r.conversationType=t,e[o].event===nd.JSON.TYPE.GROUP.TIP?s={type:En.MSG_GRP_TIP,content:jn(jn({},e[o].elements),{},{groupProfile:e[o].groupProfile})}:(e[o].elements=l.parseElements(e[o].elements,e[o].from),s=e[o].elements),nu(s)){var p=new Cp("emptyMessageBody");p.setText("from:".concat(r.from," to:").concat(r.to," sequence:").concat(r.sequence," event:").concat(e[o].event)),p.setNetworkType(this.getNetworkType()).setEnd()}else r.setElement(s),r.reInitialize(this.tim.context.identifier),i.push(r);return this.messagesList.unshift(i),c=d=f=null,i}},{key:"getLocalMessageList",value:function(e){return this.messagesList.getLocalMessageList(e)}},{key:"getLocalMessage",value:function(e,t){return this.messagesList.getLocalMessage(e,t)}},{key:"hasLocalMessage",value:function(e,t){return this.messagesList.hasLocalMessage(e,t)}},{key:"deleteLocalMessage",value:function(e){e instanceof Vd&&this.messagesList.remove(e)}},{key:"revokeMessage",value:function(e){var t,n=this;e.conversationType===En.CONV_C2C?t={name:"c2cMessageWillBeRevoked",action:"create",param:{msgInfo:{fromAccount:e.from,toAccount:e.to,msgSeq:e.sequence,msgRandom:e.random,msgTimeStamp:e.time}}}:e.conversationType===En.CONV_GROUP&&(t={name:"groupMessageWillBeRevoked",action:"create",param:{to:e.to,msgSeqList:[{msgSeq:e.sequence}]}});var r=new Cp("revokeMessage");return r.setMessageType(e.type).setText("".concat(this._generateTjgID(e),"-").concat(e.type,"-").concat(e.from,"-").concat(e.to)),this.request(t).then(function(t){var i=t.data.recallRetList;if(!nu(i)&&0!==i[0].retCode){var o=new Ed({code:i[0].retCode,message:wd[i[0].retCode]||"消息撤回失败",data:{message:e}});return r.setCode(o.code).setMessage(o.message).setEnd(),hp(o)}return _s.info("MessageController.revokeMessage ok. ID=".concat(e.ID)),e.isRevoked=!0,r.setEnd(),n.emitInnerEvent(_f,[e]),new dp({message:e})}).catch(function(t){n.probeNetwork().then(function(e){var n=Jn(e,2),i=n[0],o=n[1];r.setError(t,i,o).setEnd()});var i=new Ed({code:t&&t.code?t.code:Td.MESSAGE_REVOKE_FAIL,message:t&&t.message?t.message:"消息撤回失败",data:{message:e}});return _s.warn("MessageController.revokeMessage failed. ID=".concat(e.ID," code=").concat(i.code," message=").concat(i.message)),hp(i)})}},{key:"setMessageRead",value:function(e){var t=this;return new Promise(function(n,r){t.ready(function(){t.readReportHandler.setMessageRead(e).then(n).catch(r)})})}},{key:"getMessageList",value:function(e){return this.getMessageHandler.getMessageList(e)}},{key:"createTextMessage",value:function(e){e.currentUser=this.tim.context.identifier;var t=new Vd(e),n="string"==typeof e.payload?e.payload:e.payload.text,r=new Qu({text:n});return t.setElement(r),t}},{key:"createCustomMessage",value:function(e){e.currentUser=this.tim.context.identifier;var t=new Vd(e),n=new Fd({data:e.payload.data,description:e.payload.description,extension:e.payload.extension});return t.setElement(n),t}},{key:"createImageMessage",value:function(e){e.currentUser=this.tim.context.identifier;var t=new Vd(e);if(qa){var n=e.payload.file;if(bs(n))return void _s.warn("小程序环境下调用 createImageMessage 接口时，payload.file 不支持传入 File 对象");var r=n.tempFilePaths[0],i={url:r,name:r.slice(r.lastIndexOf("/")+1),size:n.tempFiles[0].size,type:r.slice(r.lastIndexOf(".")+1).toLowerCase()};e.payload.file=i}else if(Ua&&bs(e.payload.file)){var o=e.payload.file;e.payload.file={files:[o]}}var a=new sd({imageFormat:nd.IMAGE_FORMAT.UNKNOWN,uuid:this._generateUUID(),file:e.payload.file});return t.setElement(a),this.messageOptionMap.set(t.messageID,e),t}},{key:"createFileMessage",value:function(e){if(!qa){if(Ua&&bs(e.payload.file)){var t=e.payload.file;e.payload.file={files:[t]}}e.currentUser=this.tim.context.identifier;var n=new Vd(e),r=new Ud({uuid:this._generateUUID(),file:e.payload.file});return n.setElement(r),this.messageOptionMap.set(n.messageID,e),n}_s.warn("小程序目前不支持选择文件， createFileMessage 接口不可用！")}},{key:"createAudioMessage",value:function(e){if(qa){var t=e.payload.file;if(qa){var n={url:t.tempFilePath,name:t.tempFilePath.slice(t.tempFilePath.lastIndexOf("/")+1),size:t.fileSize,second:parseInt(t.duration)/1e3,type:t.tempFilePath.slice(t.tempFilePath.lastIndexOf(".")+1).toLowerCase()};e.payload.file=n}e.currentUser=this.tim.context.identifier;var r=new Vd(e),i=new ld({second:Math.floor(t.duration/1e3),size:t.fileSize,url:t.tempFilePath,uuid:this._generateUUID()});return r.setElement(i),this.messageOptionMap.set(r.messageID,e),r}_s.warn("createAudioMessage 目前只支持小程序环境下发语音消息")}},{key:"createVideoMessage",value:function(e){e.currentUser=this.tim.context.identifier,e.payload.file.thumbUrl="https://webim-1252463788.cos.ap-shanghai.myqcloud.com/assets/images/transparent.png",e.payload.file.thumbSize=1668;var t={};if(qa){if(bs(e.payload.file))return void _s.warn("小程序环境下调用 createVideoMessage 接口时，payload.file 不支持传入 File 对象");var n=e.payload.file;t.url=n.tempFilePath,t.name=n.tempFilePath.slice(n.tempFilePath.lastIndexOf("/")+1),t.size=n.size,t.second=n.duration,t.type=n.tempFilePath.slice(n.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else if(Ua){if(bs(e.payload.file)){var r=e.payload.file;e.payload.file.files=[r]}var i=e.payload.file;t.url=window.URL.createObjectURL(i.files[0]),t.name=i.files[0].name,t.size=i.files[0].size,t.second=i.files[0].duration||0,t.type=i.files[0].type.split("/")[1]}e.payload.file.videoFile=t;var o=new Vd(e),a=new jd({videoFormat:t.type,videoSecond:Number(t.second.toFixed(0)),videoSize:t.size,remoteVideoUrl:"",videoUrl:t.url,videoUUID:this._generateUUID(),thumbUUID:this._generateUUID(),thumbWidth:e.payload.file.width||200,thumbHeight:e.payload.file.height||200,thumbUrl:e.payload.file.thumbUrl,thumbSize:e.payload.file.thumbSize,thumbFormat:e.payload.file.thumbUrl.slice(e.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()});return o.setElement(a),this.messageOptionMap.set(o.messageID,e),o}},{key:"createFaceMessage",value:function(e){e.currentUser=this.tim.context.identifier;var t=new Vd(e),n=new ud(e.payload);return t.setElement(n),t}},{key:"_generateUUID",value:function(){var e=this.tim.context;return"".concat(e.SDKAppID,"-").concat(e.identifier,"-").concat(function(){for(var e="",t=32;t>0;--t)e+=js[Math.floor(Math.random()*Gs)];return e}())}},{key:"_generateTjgID",value:function(e){return this.tim.context.tinyID+"-"+e.random}},{key:"getMessageOptionByID",value:function(e){return this.messageOptionMap.get(e)}},{key:"isMessageSentByCurrentInstance",value:function(e){return!(!this.messagesList.hasLocalMessage(e.conversationID,e.ID)&&!this.singlyLinkedList.has(e.random))}},{key:"pushToMessageList",value:function(e){this.messagesList.pushIn(e)}}]),n}(up),Bg=function(){function e(t){Ln(this,e),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this._initMember(t)}return Nn(e,[{key:"_initMember",value:function(e){this.updateMember(e)}},{key:"updateMember",value:function(e){var t=[null,void 0,"",0,NaN];e.memberCustomField&&zs(this.memberCustomField,e.memberCustomField),Ls(this,e,["memberCustomField"],t)}},{key:"updateRole",value:function(e){["Owner","Admin","Member"].indexOf(e)<0||(this.role=e)}},{key:"updateMuteUntil",value:function(e){xs(e)||(this.muteUntil=Math.floor((Date.now()+1e3*e)/1e3))}},{key:"updateNameCard",value:function(e){xs(e)||(this.nameCard=e)}},{key:"updateMemberCustomField",value:function(e){e&&zs(this.memberCustomField,e)}}]),e}(),Vg=function(){function e(t){Ln(this,e),this.tim=t.tim,this.groupController=t.groupController,this._initListeners()}return Nn(e,[{key:"_initListeners",value:function(){this.tim.innerEmitter.on(mf,this._onReceivedGroupTips,this)}},{key:"_onReceivedGroupTips",value:function(e){var t=this,n=e.data,r=n.result;n.isGroupTip&&r.forEach(function(e){switch(e.payload.operationType){case 1:t._onNewMemberComeIn(e);break;case 2:t._onMemberQuit(e);break;case 3:t._onMemberKickedOut(e);break;case 4:t._onMemberSetAdmin(e);break;case 5:t._onMemberCancelledAdmin(e);break;case 6:t._onGroupProfileModified(e);break;case 7:t._onMemberInfoModified(e);break;default:_s.warn("GroupTipsHandler._onReceivedGroupTips Unhandled groupTips. operationType=",e.payload.operationType)}})}},{key:"_onNewMemberComeIn",value:function(e){var t=e.payload,n=t.memberNum,r=t.groupProfile.groupID,i=this.groupController.getLocalGroupProfile(r);i&&Ss(n)&&(i.memberNum=n)}},{key:"_onMemberQuit",value:function(e){var t=e.payload,n=t.memberNum,r=t.groupProfile.groupID,i=this.groupController.getLocalGroupProfile(r);i&&Ss(n)&&(i.memberNum=n),this.groupController.deleteLocalGroupMembers(r,e.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(e){var t=e.payload,n=t.memberNum,r=t.groupProfile.groupID,i=this.groupController.getLocalGroupProfile(r);i&&Ss(n)&&(i.memberNum=n),this.groupController.deleteLocalGroupMembers(r,e.payload.userIDList)}},{key:"_onMemberSetAdmin",value:function(e){var t=this,n=e.payload.groupProfile.groupID;e.payload.userIDList.forEach(function(e){var r=t.groupController.getLocalGroupMemberInfo(n,e);r&&r.updateRole(En.GRP_MBR_ROLE_ADMIN)})}},{key:"_onMemberCancelledAdmin",value:function(e){var t=this,n=e.payload.groupProfile.groupID;e.payload.userIDList.forEach(function(e){var r=t.groupController.getLocalGroupMemberInfo(n,e);r&&r.updateRole(En.GRP_MBR_ROLE_MEMBER)})}},{key:"_onGroupProfileModified",value:function(e){var t=this,n=e.payload.newGroupProfile,r=e.payload.groupProfile.groupID,i=this.groupController.getLocalGroupProfile(r);Object.keys(n).forEach(function(e){switch(e){case"ownerID":t._ownerChaged(i,n);break;default:i[e]=n[e]}}),this.groupController.emitGroupListUpdate(!0,!0)}},{key:"_ownerChaged",value:function(e,t){var n=e.groupID,r=this.groupController.getLocalGroupProfile(n),i=this.tim.context.identifier;if(i===t.ownerID){r.updateGroup({selfInfo:{role:En.GRP_MBR_ROLE_OWNER}});var o=this.groupController.getLocalGroupMemberInfo(n,i),a=this.groupController.getLocalGroupProfile(n).ownerID,s=this.groupController.getLocalGroupMemberInfo(n,a);o&&o.updateRole(En.GRP_MBR_ROLE_OWNER),s&&s.updateRole(En.GRP_MBR_ROLE_MEMBER)}}},{key:"_onMemberInfoModified",value:function(e){var t=this,n=e.payload.groupProfile.groupID;e.payload.memberList.forEach(function(e){var r=t.groupController.getLocalGroupMemberInfo(n,e.userID);r&&e.muteTime&&r.updateMuteUntil(e.muteTime)})}}]),e}(),qg=function(){function e(t){Ln(this,e),this.groupController=t.groupController,this.tim=t.tim,this.pendencyMap=new Map,this._initLiceners()}return Nn(e,[{key:"_initLiceners",value:function(){this.tim.innerEmitter.on(yf,this._onReceivedGroupSystemNotice,this),this.tim.innerEmitter.on(ff,this._clearGroupSystemNotice,this)}},{key:"_clearGroupSystemNotice",value:function(){var e=this;this.getPendencyList().then(function(t){t.forEach(function(t){e.pendencyMap.set("".concat(t.from,"_").concat(t.groupID,"_").concat(t.to),t)});var n=e.tim.messageController.getLocalMessageList(En.CONV_SYSTEM),r=[];n.forEach(function(t){var n=t.payload,i=n.operatorID,o=n.operationType,a=n.groupProfile;if(1===o){var s="".concat(i,"_").concat(a.groupID,"_").concat(a.to),u=e.pendencyMap.get(s);u&&Ss(u.handled)&&0!==u.handled&&r.push(t)}}),e.groupController.deleteGroupSystemNotice({messageList:r})})}},{key:"getPendencyList",value:function(e){var t=this;return this.groupController.request({name:"group",action:"getGroupPendency",param:{startTime:e&&e.startTime?e.startTime:0,limit:e&&e.limit?e.limit:10,handleAccount:this.tim.context.identifier}}).then(function(e){var n=e.data,r=n.pendencyList;return 0!==n.nextStartTime?t.getPendencyList({startTime:n.nextStartTime}).then(function(e){return[].concat(Xn(r),Xn(e))}):r})}},{key:"_onReceivedGroupSystemNotice",value:function(e){var t=this,n=e.data,r=n.result;"sync"!==n.type&&r.forEach(function(e){switch(e.payload.operationType){case 1:t._onApplyGroupRequest(e);break;case 2:t._onApplyGroupRequestAgreed(e);break;case 3:t._onApplyGroupRequestRefused(e);break;case 4:t._onMemberKicked(e);break;case 5:t._onGroupDismissed(e);break;case 6:break;case 7:t._onInviteGroup(e);break;case 8:t._onQuitGroup(e);break;case 9:t._onSetManager(e);break;case 10:t._onDeleteManager(e);break;case 11:case 12:case 15:break;case 255:t.groupController.emitOuterEvent(wn.GROUP_SYSTEM_NOTICE_RECEIVED,{message:e,type:255})}})}},{key:"_onApplyGroupRequest",value:function(e){this.groupController.emitOuterEvent(wn.GROUP_SYSTEM_NOTICE_RECEIVED,{message:e,type:1})}},{key:"_onApplyGroupRequestAgreed",value:function(e){var t=this,n=e.payload.groupProfile.groupID;this.groupController.hasLocalGroup(n)||this.groupController.getGroupProfile({groupID:n}).then(function(e){var n=e.data.group;n&&(t.groupController.updateGroupMap([n]),t.groupController.emitGroupListUpdate())}),this.groupController.emitOuterEvent(wn.GROUP_SYSTEM_NOTICE_RECEIVED,{message:e,type:2})}},{key:"_onApplyGroupRequestRefused",value:function(e){this.groupController.emitOuterEvent(wn.GROUP_SYSTEM_NOTICE_RECEIVED,{message:e,type:3})}},{key:"_onMemberKicked",value:function(e){var t=e.payload.groupProfile.groupID;this.groupController.hasLocalGroup(t)&&this.groupController.deleteLocalGroupAndConversation(t),this.groupController.emitOuterEvent(wn.GROUP_SYSTEM_NOTICE_RECEIVED,{message:e,type:4})}},{key:"_onGroupDismissed",value:function(e){var t=e.payload.groupProfile.groupID,n=this.groupController.hasLocalGroup(t),r=this.groupController.AVChatRoomHandler;n&&this.groupController.deleteLocalGroupAndConversation(t),r.checkJoinedAVChatRoomByID(t)&&r.reset(t),this.groupController.emitOuterEvent(wn.GROUP_SYSTEM_NOTICE_RECEIVED,{message:e,type:5})}},{key:"_onInviteGroup",value:function(e){var t=this,n=e.payload.groupProfile.groupID;this.groupController.hasLocalGroup(n)||this.groupController.getGroupProfile({groupID:n}).then(function(e){var n=e.data.group;n&&(t.groupController.updateGroupMap([n]),t.groupController.emitGroupListUpdate())}),this.groupController.emitOuterEvent(wn.GROUP_SYSTEM_NOTICE_RECEIVED,{message:e,type:7})}},{key:"_onQuitGroup",value:function(e){var t=e.payload.groupProfile.groupID;this.groupController.hasLocalGroup(t)&&this.groupController.deleteLocalGroupAndConversation(t),this.groupController.emitOuterEvent(wn.GROUP_SYSTEM_NOTICE_RECEIVED,{message:e,type:8})}},{key:"_onSetManager",value:function(e){var t=e.payload.groupProfile,n=t.to,r=t.groupID,i=this.groupController.getLocalGroupMemberInfo(r,n);i&&i.updateRole(En.GRP_MBR_ROLE_ADMIN),this.groupController.emitOuterEvent(wn.GROUP_SYSTEM_NOTICE_RECEIVED,{message:e,type:9})}},{key:"_onDeleteManager",value:function(e){var t=e.payload.groupProfile,n=t.to,r=t.groupID,i=this.groupController.getLocalGroupMemberInfo(r,n);i&&i.updateRole(En.GRP_MBR_ROLE_MEMBER),this.groupController.emitOuterEvent(wn.GROUP_SYSTEM_NOTICE_RECEIVED,{message:e,type:10})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),e}(),Hg=Xe("splice"),zg=dt("splice",{ACCESSORS:!0,0:0,1:2}),Kg=Math.max,Wg=Math.min;Me({target:"Array",proto:!0,forced:!Hg||!zg},{splice:function(e,t){var n,r,i,o,a,s,u=Le(this),l=ce(u.length),c=pe(e,l),d=arguments.length;if(0===d?n=r=0:1===d?(n=0,r=l-c):(n=d-2,r=Wg(Kg(ue(t),0),l-c)),l+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(i=qe(u,r),o=0;o<r;o++)(a=c+o)in u&&Pe(i,o,u[a]);if(i.length=r,n<r){for(o=c;o<l-r;o++)s=o+n,(a=o+r)in u?u[s]=u[a]:delete u[s];for(o=l;o>l-r+n;o--)delete u[o-1]}else if(n>r)for(o=l-r;o>c;o--)s=o+n-1,(a=o+r-1)in u?u[s]=u[a]:delete u[s];for(o=0;o<n;o++)u[o+c]=arguments[o+2];return u.length=l-r+n,i}});var Yg={3:!0,4:!0,5:!0,6:!0},Jg=function(){function e(t){var n=t.tim,r=t.groupController;Ln(this,e),this.tim=n,this.groupController=r,this.sequencesLinkedList=new Fg(100),this.receivedMessageCount=0,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this._joinedGroupMap=new Map,this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60}return Nn(e,[{key:"hasJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._joinedGroupMap.has(e)}},{key:"getJoinedAVChatRoom",value:function(){return this._joinedGroupMap.size>0?Xn(this._joinedGroupMap.keys()):null}},{key:"start",value:function(e){var t=this._pollingRequestInfoMap.get(e),n={key:t.key,startSeq:t.startSeq};if(this._pollingInstanceMap.has(e)){var r=this._pollingInstanceMap.get(e);r.isRunning()||r.start()}else{var i=this.groupController.createTransportCapsule({name:"AVChatRoom",action:"startLongPoll",param:n}),o=this.tim.connectionController.createRunLoop({pack:i,before:this._updateRequestData.bind(this,e),success:this._handleSuccess.bind(this,e),fail:this._handleFailure.bind(this),isAVChatRoomLoop:!0});o.start(),this._pollingInstanceMap.set(e,o),_s.log("AVChatRoomHandler.start message channel started. groupID=".concat(e))}}},{key:"stop",value:function(e){var t=this._pollingInstanceMap.get(e);t&&t.isRunning()&&(t.abort(),t.stop(),_s.log("AVChatRoomHandler.stop message channel stopped. groupID=".concat(e)))}},{key:"startRunLoop",value:function(e){var t=this;return this._precheck().then(function(){var n=e.longPollingKey,r=e.group,i=r.groupID;return t._pollingRequestInfoMap.set(i,{key:n,startSeq:0}),t._joinedGroupMap.set(i,r),t._addAVChatRoomID(i),t.groupController.updateGroupMap([r]),t.groupController.emitGroupListUpdate(!0,!1),t.start(i),t.groupController.isLoggedIn()?pp({status:Ku.SUCCESS,group:r}):pp({status:Ku.SUCCESS})})}},{key:"joinWithoutAuth",value:function(e){var t=this;return this.groupController.request({name:"group",action:"applyJoinAVChatRoom",param:e}).then(function(n){var r=n.data.longPollingKey;if(xs(r))return hp(new Ed({code:Td.CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN,message:"非 AVChatRoom 类型的群组不允许匿名加群，请先登录后再加群"}));_s.log("AVChatRoomHandler.joinWithoutAuth ok. groupID:".concat(e.groupID)),t.groupController.emitInnerEvent(Wf),t.groupController.emitInnerEvent(Kf,e.groupID);var i=new pg({groupID:e.groupID});return t.startRunLoop({group:i,longPollingKey:r}),new dp({status:Ku.SUCCESS})}).catch(function(t){return _s.error("AVChatRoomHandler.joinWithoutAuth error:".concat(Ps(t),". groupID:").concat(e.groupID)),hp(t)})}},{key:"_precheck",value:function(){if(this.tim.context.unlimitedAVChatRoom)return Promise.resolve();if(!this.hasJoinedAVChatRoom())return Promise.resolve();var e=Jn(this._joinedGroupMap.entries().next().value,2),t=e[0],n=e[1];if(this.groupController.isLoggedIn()){if(n.selfInfo.role!==En.GRP_MBR_ROLE_OWNER&&n.ownerID!==this.tim.loginInfo.identifier)return this.groupController.quitGroup(t);this.groupController.deleteLocalGroupAndConversation(t)}else this.groupController.deleteLocalGroupAndConversation(t);return this.reset(t),Promise.resolve()}},{key:"_updateRequestData",value:function(e,t){var n=this._pollingRequestInfoMap.get(e),r=n.key,i=n.startSeq;t.StartSeq=i,t.Key=r,this.tim.sumStatController.addTotalCount(mp)}},{key:"_handleSuccess",value:function(e,t){this.tim.sumStatController.addSuccessCount(mp),this.tim.sumStatController.addCost(mp,t.data.timecost);var n=t.data,r=n.errorCode,i=n.errorInfo,o=n.key,a=n.nextSeq,s=n.rspMsgList;if(r!==Wu.SUCCESS){var u=this._pollingRequestInfoMap.get(e),l=new Cp(Op),c=u?"".concat(u.key,"-").concat(u.startSeq):"requestInfo is undefined";l.setMessage("".concat(e,"-").concat(c,"-").concat(i||JSON.stringify(t.data))).setCode(r).setNetworkType(this.groupController.getNetworkType()).setEnd(!0)}else ks(o)&&Ss(a)&&this._pollingRequestInfoMap.set(e,{key:o,startSeq:a}),Ts(s)&&s.length>0&&(s.forEach(function(e){e.to=e.groupID}),this._dispatchNotice(s));this.groupController.emitInnerEvent(Pf)}},{key:"_handleFailure",value:function(e){if(e.error)if("ECONNABORTED"===e.error.code||e.error.code===Td.NETWORK_TIMEOUT)if(e.error.config){var t=e.error.config.url,n=e.error.config.data;_s.log("AVChatRoomHandler._handleFailure request timed out. url=".concat(t," data=").concat(n))}else _s.log("AVChatRoomHandler._handleFailure request timed out");else _s.log("AVChatRoomHandler._handleFailure request failed due to network error");this.groupController.emitInnerEvent(Lf)}},{key:"_dispatchNotice",value:function(e){if(Ts(e)&&0!==e.length){var t=Date.now(),n=null,r=[],i=[],o=e.length;o>1&&e.sort(function(e,t){return e.sequence-t.sequence});for(var a=0;a<o;a++)if(Yg[e[a].event]){if(this.receivedMessageCount+=1,n=this.packMessage(e[a],e[a].event),this.tim.context.unlimitedAVChatRoom||!this.sequencesLinkedList.has(n.sequence)){var s=n.conversationID;if(this.receivedMessageCount%40==0&&this.tim.messageLossController.detectMessageLoss(s,this.sequencesLinkedList.data()),null!==this.sequencesLinkedList.tail()){var u=this.sequencesLinkedList.tail().value,l=n.sequence-u;l>1&&l<=20?this.tim.messageLossController.onMessageMaybeLost(s,u+1,l-1):l<-1&&l>=-20&&this.tim.messageLossController.onMessageMaybeLost(s,n.sequence+1,Math.abs(l)-1)}this.sequencesLinkedList.pushIn(n.sequence),this._isMessageSentByCurrentInstance(n)||(n.conversationType===En.CONV_SYSTEM&&i.push(n),r.push(n))}}else _s.warn("AVChatRoomHandler._dispatchMessage 未处理的 event 类型: ".concat(e[a].event));if(i.length>0&&this.groupController.emitInnerEvent(yf,{result:i,eventDataList:[],type:"poll"}),0!==r.length){var c=this.packConversationOption(r);c.length>0&&this.groupController.emitInnerEvent(mf,{eventDataList:c,type:"poll"}),_s.debug("AVChatRoomHandler._dispatchNotice nums=".concat(r.length));var d=this.tim.sumStatController;d.addTotalCount(Tp),d.addSuccessCount(Tp),d.addCost(Tp,Date.now()-t),this._checkMessageStacked(r),this.groupController.emitOuterEvent(wn.MESSAGE_RECEIVED,r)}}}},{key:"_checkMessageStacked",value:function(e){var t=e.length;t>=100&&(_s.warn("AVChatRoomHandler.checkMessageStacked 直播群消息堆积数:".concat(e.length,'！可能会导致微信小程序渲染时遇到 "Dom limit exceeded" 的错误，建议接入侧此时只渲染最近的10条消息')),this._reportMessageStackedCount<5&&(new Cp("messageStacked").setNetworkType(this.groupController.getNetworkType()).setText("nums=".concat(t," groupID=").concat(Xn(this._joinedGroupMap.keys()))).setEnd(),this._reportMessageStackedCount+=1))}},{key:"_isMessageSentByCurrentInstance",value:function(e){return!!this.tim.messageController.isMessageSentByCurrentInstance(e)}},{key:"packMessage",value:function(e,t){e.currentUser=this.tim.context.identifier,e.conversationType=5===t?En.CONV_SYSTEM:En.CONV_GROUP,e.isSystemMessage=!!e.isSystemMessage;var n=new Vd(e),r=this.packElements(e,t);return n.setElement(r),n}},{key:"packElements",value:function(e,t){return 4===t||6===t?(this._updateMemberCountByGroupTips(e),{type:En.MSG_GRP_TIP,content:jn(jn({},e.elements),{},{groupProfile:e.groupProfile})}):5===t?{type:En.MSG_GRP_SYS_NOTICE,content:jn(jn({},e.elements),{},{groupProfile:e.groupProfile})}:this.tim.bigDataHallwayController.parseElements(e.elements,e.from)}},{key:"packConversationOption",value:function(e){for(var t=new Map,n=0;n<e.length;n++){var r=e[n],i=r.conversationID;if(t.has(i)){var o=t.get(i);o.lastMessage=r,"in"===r.flow&&o.unreadCount++}else t.set(i,{conversationID:r.conversationID,unreadCount:"out"===r.flow?0:1,type:r.conversationType,subType:r.conversationSubType,lastMessage:r})}return Xn(t.values())}},{key:"_addAVChatRoomID",value:function(e){var t=this.tim.loginInfo.avchatroomIDList||[];t.includes(e)||(this.tim.context.unlimitedAVChatRoom?t.push(e):t.splice(0,1,e),this.tim.loginInfo.avchatroomIDList=t)}},{key:"_deleteAVChatRoomID",value:function(e){var t=this.tim.loginInfo.avchatroomIDList||[],n=t.indexOf(e);-1!==n&&(t.splice(n,1),this.tim.loginInfo.avchatroomIDList=t)}},{key:"joinAVChatRoomSilently",value:function(){var e=this,t=this.tim.loginInfo.avchatroomIDList||[];if(0!==t.length){var n=new Cp("joinAVChatRoomSilently");t.forEach(function(t){e.groupController.joinGroup({groupID:t}).then(function(r){_s.warn("AVChatRoomHandler.joinAVChatRoomSilently silently join group ok:".concat(t)),n.setCode(r.code).setText("groupID=".concat(t)).setNetworkType(e.groupController.getNetworkType()).setEnd(!0)}).catch(function(r){_s.warn("AVChatRoomHandler.joinAVChatRoomSilently silently join group failed:".concat(Ps(r))),n.setMessage("".concat(t,"-").concat(JSON.stringify(r))).setCode(r.code).setNetworkType(e.groupController.getNetworkType()).setEnd(!0)})})}}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._onlineMemberCountMap.get(e)||{},n=Date.now();return nu(t)||n-t.lastSyncTime>1e3*t.expireTime&&n-t.latestUpdateTime>1e4&&n-t.lastReqTime>3e3?(t.lastReqTime=n,this._onlineMemberCountMap.set(e,t),this._getGroupOnlineMemberCount(e).then(function(e){return new dp({memberCount:e.memberCount})}).catch(function(e){return hp(e)})):pp({memberCount:t.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(e){var t=this;return this.groupController.request({name:"group",action:"getOnlineMemberNum",param:{groupID:e}}).then(function(n){var r=t._onlineMemberCountMap.get(e)||{},i=n.data,o=i.onlineMemberNum,a=void 0===o?0:o,s=i.expireTime,u=void 0===s?t.DEFAULT_EXPIRE_TIME:s;_s.log("AVChatRoomHandler._getGroupOnlineMemberCount ok. groupID=".concat(e," memberCount=").concat(a," expireTime=").concat(u));var l=Date.now();return nu(r)&&(r.lastReqTime=l),t._onlineMemberCountMap.set(e,Object.assign(r,{lastSyncTime:l,latestUpdateTime:l,memberCount:a,expireTime:u})),{memberCount:a}}).catch(function(n){return _s.warn("AVChatRoomHandler._getGroupOnlineMemberCount failed. error:".concat(Ps(n))),new Cp("getGroupOnlineMemberCount").setCode(n.code).setMessage("".concat(e,"-").concat(JSON.stringify(n))).setNetworkType(t.groupController.getNetworkType()).setEnd(),Promise.reject(n)})}},{key:"_updateMemberCountByGroupTips",value:function(e){var t=e.groupProfile.groupID,n=e.elements.onlineMemberInfo,r=void 0===n?void 0:n;if(void 0!==r){var i=r.onlineMemberNum,o=void 0===i?0:i,a=r.expireTime,s=void 0===a?this.DEFAULT_EXPIRE_TIME:a,u=this._onlineMemberCountMap.get(t)||{},l=Date.now();nu(u)?Object.assign(u,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:l,memberCount:o,expireTime:s}):(u.latestUpdateTime=l,u.memberCount=o),_s.debug("AVChatRoomHandler._updateMemberCountByGroupTips info:",u),this._onlineMemberCountMap.set(t,u)}}},{key:"reset",value:function(e){if(0!==this._pollingInstanceMap.size){if(e)_s.log("AVChatRoomHandler.reset groupID=".concat(e)),this.stop(e),this._pollingInstanceMap.delete(e),this._joinedGroupMap.delete(e),this._pollingRequestInfoMap.delete(e),this._onlineMemberCountMap.delete(e);else{_s.log("AVChatRoomHandler.reset all");var t,n=$n(this._pollingInstanceMap.keys());try{for(n.s();!(t=n.n()).done;){var r=t.value;this.stop(r)}}catch(e){n.e(e)}finally{n.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear()}this.sequencesLinkedList.reset(),this.receivedMessageCount=0,this._reportMessageStackedCount=0,this._deleteAVChatRoomID(e)}}}]),e}(),Xg="GroupController",Qg=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;return Ln(this,n),(r=t.call(this,e)).groupMap=new Map,r.groupMemberListMap=new Map,r.groupNoticeHandler=new qg({tim:e,groupController:Wn(r)}),r.groupTipsHandler=new Vg({tim:e,groupController:Wn(r)}),r.AVChatRoomHandler=new Jg({tim:e,groupController:Wn(r)}),r._initListeners(),r}return Nn(n,[{key:"createGroup",value:function(e){var t=this,n="".concat(Xg,".createGroup");if(!["Public","Private","ChatRoom","AVChatRoom"].includes(e.type)){var r=new Ed({code:Td.ILLEGAL_GROUP_TYPE,message:"非法的群类型，请检查传入参数"});return hp(r)}Js(e.type)&&!xs(e.memberList)&&e.memberList.length>0&&(_s.warn("".concat(n,"创建AVChatRoom时不能添加群成员，自动忽略该字段")),e.memberList=void 0),Ws(e.type)||xs(e.joinOption)||(_s.warn("".concat(n," 创建Work/Meeting/AVChatRoom群时不能设置字段：joinOption，自动忽略该字段")),e.joinOption=void 0);var i=new Cp("createGroup");return _s.log("".concat(n)),this.request({name:"group",action:"create",param:e}).then(function(r){if(i.setNetworkType(t.getNetworkType()).setText("groupType=".concat(e.type," groupID=").concat(r.data.groupID)).setEnd(),_s.log("".concat(n," ok. groupID:"),r.data.groupID),e.type===En.GRP_AVCHATROOM)return t.getGroupProfile({groupID:r.data.groupID});t.updateGroupMap([jn(jn({},e),{},{groupID:r.data.groupID})]);var o=t.tim.createCustomMessage({to:r.data.groupID,conversationType:En.CONV_GROUP,payload:{data:"group_create",extension:"".concat(t.tim.context.identifier,"创建群组")}});return t.tim.sendMessage(o),t.emitGroupListUpdate(),t.getGroupProfile({groupID:r.data.groupID})}).then(function(e){var t=e.data.group;return t.selfInfo.messageRemindType=En.MSG_REMIND_ACPT_AND_NOTE,t.selfInfo.role=En.GRP_MBR_ROLE_OWNER,e}).catch(function(r){return i.setText("groupType=".concat(e.type)),t.probeNetwork().then(function(e){var t=Jn(e,2),n=t[0],o=t[1];i.setError(r,n,o).setEnd()}),_s.error("".concat(n," error:"),r),hp(r)})}},{key:"joinGroup",value:function(e){var t=this,n=e.groupID,r=e.type,i="".concat(Xg,".joinGroup");if(r===En.GRP_WORK){var o=new Ed({code:Td.CANNOT_JOIN_WORK,message:"不能加入 Work 类型的群组"});return hp(o)}if(this.hasLocalGroup(n)){if(!this.isLoggedIn())return pp({status:En.JOIN_STATUS_ALREADY_IN_GROUP});var a=new Cp(Ap);return this.getGroupProfile({groupID:n}).then(function(e){return a.setNetworkType(t.getNetworkType()).setText("groupID=".concat(n," joinedStatus=").concat(En.JOIN_STATUS_ALREADY_IN_GROUP)).setEnd(),pp({status:En.JOIN_STATUS_ALREADY_IN_GROUP})}).catch(function(r){return a.setNetworkType(t.getNetworkType()).setText("groupID=".concat(n," unjoined")).setEnd(),_s.warn("".concat(i," ").concat(n," was unjoined, now join!")),t.groupMap.delete(n),t.applyJoinGroup(e)})}return _s.log("".concat(i," groupID:"),n),this.isLoggedIn()?this.applyJoinGroup(e):this.AVChatRoomHandler.joinWithoutAuth(e)}},{key:"quitGroup",value:function(e){var t=this,n="".concat(Xg,".quitGroup");_s.log("".concat(n," groupID:"),e);var r=this.AVChatRoomHandler.checkJoinedAVChatRoomByID(e);if(r&&!this.isLoggedIn())return _s.log("".concat(n," anonymously ok. groupID:"),e),this.deleteLocalGroupAndConversation(e),this.AVChatRoomHandler.reset(e),pp({groupID:e});var i=new Cp("quitGroup");return this.request({name:"group",action:"quitGroup",param:{groupID:e}}).then(function(){return i.setNetworkType(t.getNetworkType()).setText("groupID=".concat(e)).setEnd(),_s.log("".concat(n," ok. groupID:"),e),r&&t.AVChatRoomHandler.reset(e),t.deleteLocalGroupAndConversation(e),new dp({groupID:e})}).catch(function(r){return i.setText("groupID=".concat(e)),t.probeNetwork().then(function(e){var t=Jn(e,2),n=t[0],o=t[1];i.setError(r,n,o).setEnd()}),_s.error("".concat(n," error. error:").concat(Ps(r)," groupID:").concat(e)),hp(r)})}},{key:"changeGroupOwner",value:function(e){var t=this,n="".concat(Xg,".changeGroupOwner");if(this.hasLocalGroup(e.groupID)&&this.getLocalGroupProfile(e.groupID).type===En.GRP_AVCHATROOM)return hp(new Ed({code:Td.CANNOT_CHANGE_OWNER_IN_AVCHATROOM,message:"AVChatRoom 类型的群组不能转让群主"}));if(e.newOwnerID===this.tim.loginInfo.identifier)return hp(new Ed({code:Td.CANNOT_CHANGE_OWNER_TO_SELF,message:"不能把群主转让给自己"}));var r=new Cp("changeGroupOwner");return _s.log("".concat(n," groupID:"),e.groupID),this.request({name:"group",action:"changeGroupOwner",param:e}).then(function(){r.setNetworkType(t.getNetworkType()).setText("groupID=".concat(e.groupID)).setEnd(),_s.log("".concat(n," ok. groupID:"),e.groupID);var i=e.groupID,o=e.newOwnerID;t.groupMap.get(i).ownerID=o;var a=t.groupMemberListMap.get(i);if(a instanceof Map){var s=a.get(t.tim.loginInfo.identifier);xs(s)||(s.updateRole("Member"),t.groupMap.get(i).selfInfo.role="Member");var u=a.get(o);xs(u)||u.updateRole("Owner")}return t.emitGroupListUpdate(!0,!1),new dp({group:t.groupMap.get(i)})}).catch(function(i){return r.setText("groupID=".concat(e.groupID)),t.probeNetwork().then(function(e){var t=Jn(e,2),n=t[0],o=t[1];r.setError(i,n,o).setEnd()}),_s.error("".concat(n," error:").concat(Ps(i)," groupID:").concat(e.groupID)),hp(i)})}},{key:"dismissGroup",value:function(e){var t=this,n="".concat(Xg,".dismissGroup");if(this.hasLocalGroup(e)&&this.getLocalGroupProfile(e).type===En.GRP_WORK)return hp(new Ed({code:Td.CANNOT_DISMISS_WORK,message:"不能解散 Work 类型的群组"}));var r=new Cp("dismissGroup");return _s.log("".concat(n," groupID:").concat(e)),this.request({name:"group",action:"destroyGroup",param:{groupID:e}}).then(function(){return r.setNetworkType(t.getNetworkType()).setText("groupID=".concat(e)).setEnd(),_s.log("".concat(n," ok. groupID:").concat(e)),t.deleteLocalGroupAndConversation(e),t.checkJoinedAVChatRoomByID(e)&&t.AVChatRoomHandler.reset(e),new dp({groupID:e})}).catch(function(i){return r.setText("groupID=".concat(e)),t.probeNetwork().then(function(e){var t=Jn(e,2),n=t[0],o=t[1];r.setError(i,n,o).setEnd()}),_s.error("".concat(n," error:").concat(Ps(i)," groupID:").concat(e)),hp(i)})}},{key:"updateGroupProfile",value:function(e){var t=this,n="".concat(Xg,".updateGroupProfile");!this.hasLocalGroup(e.groupID)||Ws(this.getLocalGroupProfile(e.groupID).type)||xs(e.joinOption)||(_s.warn("".concat(n," Work/Meeting/AVChatRoom群不能设置字段：joinOption，自动忽略该字段")),e.joinOption=void 0),xs(e.muteAllMembers)||(e.muteAllMembers?e.muteAllMembers="On":e.muteAllMembers="Off");var r=new Cp("updateGroupProfile");return r.setText(JSON.stringify(e)),_s.log("".concat(n," groupID:"),e.groupID),this.request({name:"group",action:"updateGroupProfile",param:e}).then(function(){return r.setNetworkType(t.getNetworkType()).setEnd(),_s.log("".concat(n," ok. groupID:"),e.groupID),t.hasLocalGroup(e.groupID)&&(t.groupMap.get(e.groupID).updateGroup(e),t._setStorageGroupList()),new dp({group:t.groupMap.get(e.groupID)})}).catch(function(i){return t.probeNetwork().then(function(e){var t=Jn(e,2),n=t[0],o=t[1];r.setError(i,n,o).setEnd()}),_s.log("".concat(n," failed. error:").concat(Ps(i)," groupID:").concat(e.groupID)),hp(i)})}},{key:"setGroupMemberRole",value:function(e){var t=this,n="".concat(Xg,".setGroupMemberRole"),r=e.groupID,i=e.userID,o=e.role,a=this.groupMap.get(r);if(a.selfInfo.role!==En.GRP_MBR_ROLE_OWNER)return hp(new Ed({code:Td.NOT_OWNER,message:"你不是群主，只有群主才有权限操作"}));if([En.GRP_WORK,En.GRP_AVCHATROOM].includes(a.type))return hp(new Ed({code:Td.CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM,message:"不能在 Work / AVChatRoom 类型的群中设置群成员身份"}));if([En.GRP_MBR_ROLE_ADMIN,En.GRP_MBR_ROLE_MEMBER].indexOf(o)<0)return hp(new Ed({code:Td.INVALID_MEMBER_ROLE,message:"不合法的群成员身份，请检查传入参数"}));if(i===this.tim.loginInfo.identifier)return hp(new Ed({code:Td.CANNOT_SET_SELF_MEMBER_ROLE,message:"不能设置自己的群成员身份，请检查传入参数"}));var s=new Cp("setGroupMemberRole");return s.setText("groupID=".concat(r," userID=").concat(i," role=").concat(o)),_s.log("".concat(n," groupID:").concat(r,". userID: ").concat(i)),this._modifyGroupMemberInfo({groupID:r,userID:i,role:o}).then(function(e){return s.setNetworkType(t.getNetworkType()).setEnd(),_s.log("".concat(n," ok. groupID:").concat(r,". userID: ").concat(i)),new dp({group:a,member:e})}).catch(function(e){return t.probeNetwork().then(function(t){var n=Jn(t,2),r=n[0],i=n[1];s.setError(e,r,i).setEnd()}),_s.error("".concat(n," error:").concat(Ps(e)," groupID:").concat(r," userID:").concat(i)),hp(e)})}},{key:"setGroupMemberMuteTime",value:function(e){var t=this,n=e.groupID,r=e.userID,i=e.muteTime,o="".concat(Xg,".setGroupMemberMuteTime");if(r===this.tim.loginInfo.identifier)return hp(new Ed({code:Td.CANNOT_MUTE_SELF,message:"不能将自己禁言，请检查传入参数"}));_s.log("".concat(o," groupID:").concat(n,". userID: ").concat(r));var a=new Cp("setGroupMemberMuteTime");return a.setText("groupID=".concat(n," userID=").concat(r," muteTime=").concat(i)),this._modifyGroupMemberInfo({groupID:n,userID:r,muteTime:i}).then(function(e){return a.setNetworkType(t.getNetworkType()).setEnd(),_s.log("".concat(o," ok. groupID:").concat(n,". userID: ").concat(r)),new dp({group:t.getLocalGroupProfile(n),member:e})}).catch(function(e){return t.probeNetwork().then(function(t){var n=Jn(t,2),r=n[0],i=n[1];a.setError(e,r,i).setEnd()}),_s.error("".concat(o," error:").concat(Ps(e)," groupID:").concat(n," userID:").concat(r)),hp(e)})}},{key:"setMessageRemindType",value:function(e){var t=this,n="".concat(Xg,".setMessageRemindType"),r=new Cp("setMessageRemindType");r.setText("groupID=".concat(e.groupID," userID=").concat(e.userID||this.tim.loginInfo.identifier)),_s.log("".concat(n," groupID:").concat(e.groupID,". userID: ").concat(e.userID||this.tim.loginInfo.identifier));var i=e.groupID,o=e.messageRemindType;return this._modifyGroupMemberInfo({groupID:i,messageRemindType:o,userID:this.tim.loginInfo.identifier}).then(function(){r.setNetworkType(t.getNetworkType()).setEnd(),_s.log("".concat(n," ok. groupID:").concat(e.groupID," userID:").concat(e.userID||t.tim.loginInfo.identifier));var i=t.getLocalGroupProfile(e.groupID);return i&&(i.selfInfo.messageRemindType=o),new dp({group:i})}).catch(function(i){return t.probeNetwork().then(function(e){var t=Jn(e,2),n=t[0],o=t[1];r.setError(i,n,o).setEnd()}),_s.error("".concat(n," error:").concat(Ps(i)," groupID:").concat(e.groupID," userID:").concat(e.userID||t.tim.loginInfo.identifier)),hp(i)})}},{key:"setGroupMemberNameCard",value:function(e){var t=this,n="".concat(Xg,".setGroupMemberNameCard"),r=e.groupID,i=e.userID,o=void 0===i?this.tim.loginInfo.identifier:i,a=e.nameCard;_s.log("".concat(n," groupID:").concat(r,". userID: ").concat(o));var s=new Cp("setGroupMemberNameCard");return s.setText("groupID=".concat(r," userID=").concat(o," nameCard=").concat(a)),this._modifyGroupMemberInfo({groupID:r,userID:o,nameCard:a}).then(function(e){_s.log("".concat(n," ok. groupID:").concat(r,". userID: ").concat(o)),s.setNetworkType(t.getNetworkType()).setEnd();var i=t.getLocalGroupProfile(r);return o===t.tim.loginInfo.identifier&&i&&i.setSelfNameCard(a),new dp({group:i,member:e})}).catch(function(e){return t.probeNetwork().then(function(t){var n=Jn(t,2),r=n[0],i=n[1];s.setError(e,r,i).setEnd()}),_s.error("".concat(n," error:").concat(Ps(e)," groupID:").concat(r," userID:").concat(o)),hp(e)})}},{key:"setGroupMemberCustomField",value:function(e){var t=this,n="".concat(Xg,".setGroupMemberCustomField"),r=e.groupID,i=e.userID,o=void 0===i?this.tim.loginInfo.identifier:i,a=e.memberCustomField;_s.log("".concat(n," groupID:").concat(r,". userID: ").concat(o));var s=new Cp("setGroupMemberCustomField");return s.setText("groupID=".concat(r," userID=").concat(o," memberCustomField=").concat(a)),this._modifyGroupMemberInfo({groupID:r,userID:o,memberCustomField:a}).then(function(e){return s.setNetworkType(t.getNetworkType()).setEnd(),_s.log("".concat(n," ok. groupID:").concat(r,". userID: ").concat(o)),new dp({group:t.groupMap.get(r),member:e})}).catch(function(e){return t.probeNetwork().then(function(t){var n=Jn(t,2),r=n[0],i=n[1];s.setError(e,r,i).setEnd()}),_s.error("".concat(n," error:").concat(Ps(e)," groupID:").concat(r," userID:").concat(o)),hp(e)})}},{key:"getGroupList",value:function(e){var t=this,n="".concat(Xg,".getGroupList"),r=new Cp("getGroupList");_s.log("".concat(n));var i={introduction:"Introduction",notification:"Notification",createTime:"CreateTime",ownerID:"Owner_Account",lastInfoTime:"LastInfoTime",memberNum:"MemberNum",maxMemberNum:"MaxMemberNum",joinOption:"ApplyJoinOption",muteAllMembers:"ShutUpAllMember"},o=["Type","Name","FaceUrl","NextMsgSeq","LastMsgTime"];return e&&e.groupProfileFilter&&e.groupProfileFilter.forEach(function(e){i[e]&&o.push(i[e])}),this.request({name:"group",action:"list",param:{responseFilter:{groupBaseInfoFilter:o,selfInfoFilter:["Role","JoinTime","MsgFlag"]}}}).then(function(e){var i=e.data.groups;return _s.log("".concat(n," ok. nums=").concat(i.length)),t._groupListTreeShaking(i),t.updateGroupMap(i),r.setNetworkType(t.getNetworkType()).setText("".concat(i.length,"-afterTreeshaking-").concat(t.groupMap.size)).setEnd(),t.tempConversationList&&(_s.log("".concat(n," update last message with tempConversationList, nums=").concat(t.tempConversationList.length)),t._handleUpdateGroupLastMessage({data:t.tempConversationList}),t.tempConversationList=null),t.emitGroupListUpdate(),new dp({groupList:t.getLocalGroups()})}).catch(function(e){return t.probeNetwork().then(function(t){var n=Jn(t,2),i=n[0],o=n[1];r.setError(e,i,o).setEnd()}),_s.error("".concat(n," error:"),e),hp(e)})}},{key:"getGroupMemberList",value:function(e){var t=this,n=e.groupID,r=e.offset,i=void 0===r?0:r,o=e.count,a=void 0===o?15:o,s="".concat(Xg,".getGroupMemberList"),u=new Cp("getGroupMemberList");_s.log("".concat(s," groupID: ").concat(n," offset: ").concat(i," count: ").concat(a));var l=[];return this.request({name:"group",action:"getGroupMemberList",param:{groupID:n,offset:i,limit:a>100?100:a,memberInfoFilter:["Role","NameCard","ShutUpUntil"]}}).then(function(e){var r=e.data,i=r.members,o=r.memberNum;return Ts(i)&&0!==i.length?(t.hasLocalGroup(n)&&(t.getLocalGroupProfile(n).memberNum=o),l=t._updateLocalGroupMemberMap(n,i),t.tim.getUserProfile({userIDList:i.map(function(e){return e.userID}),tagList:[rd.NICK,rd.AVATAR]})):Promise.resolve([])}).then(function(e){var r=e.data;if(!Ts(r)||0===r.length)return pp({memberList:[]});var o=r.map(function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}});return t._updateLocalGroupMemberMap(n,o),u.setNetworkType(t.getNetworkType()).setText("groupID=".concat(n," offset=").concat(i," count=").concat(a)).setEnd(),_s.log("".concat(s," ok.")),new dp({memberList:l})}).catch(function(e){return t.probeNetwork().then(function(t){var n=Jn(t,2),r=n[0],i=n[1];u.setError(e,r,i).setEnd()}),_s.error("".concat(s," error:"),e),hp(e)})}},{key:"getLocalGroups",value:function(){return Xn(this.groupMap.values())}},{key:"getLocalGroupProfile",value:function(e){return this.groupMap.get(e)}},{key:"hasLocalGroup",value:function(e){return this.groupMap.has(e)}},{key:"getLocalGroupMemberInfo",value:function(e,t){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(t):null}},{key:"setLocalGroupMember",value:function(e,t){if(this.groupMemberListMap.has(e))this.groupMemberListMap.get(e).set(t.userID,t);else{var n=(new Map).set(t.userID,t);this.groupMemberListMap.set(e,n)}}},{key:"hasLocalGroupMember",value:function(e,t){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(t)}},{key:"hasLocalGroupMemberMap",value:function(e){return this.groupMemberListMap.has(e)}},{key:"getGroupProfile",value:function(e){var t=this,n="".concat(Xg,".getGroupProfile"),r=new Cp("getGroupProfile");_s.log("".concat(n," groupID:"),e.groupID);var i=e.groupID,o=e.groupCustomFieldFilter,a={groupIDList:[i],responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember"],groupCustomFieldFilter:o}};return this.getGroupProfileAdvance(a).then(function(o){var a,s=o.data,u=s.successGroupList,l=s.failureGroupList;return _s.log("".concat(n," ok. groupID:").concat(e.groupID)),l.length>0?hp(l[0]):(Js(u[0].type)&&!t.hasLocalGroup(i)?a=new pg(u[0]):(t.updateGroupMap(u),a=t.getLocalGroupProfile(i)),r.setNetworkType(t.getNetworkType()).setText("groupID=".concat(a.groupID," type=").concat(a.type," muteAllMembers=").concat(a.muteAllMembers," ownerID=").concat(a.ownerID)).setEnd(),a&&a.selfInfo&&!a.selfInfo.nameCard?t.updateSelfInfo(a).then(function(e){return new dp({group:e})}):new dp({group:a}))}).catch(function(i){return t.probeNetwork().then(function(t){var n=Jn(t,2),o=n[0],a=n[1];r.setError(i,o,a).setText("groupID=".concat(e.groupID)).setEnd()}),_s.error("".concat(n," error:").concat(Ps(i)," groupID:").concat(e.groupID)),hp(i)})}},{key:"getGroupMemberProfile",value:function(e){var t=this,n="".concat(Xg,".getGroupMemberProfile"),r=new Cp("getGroupMemberProfile");r.setText(e.userIDList.length>5?"userIDList.length=".concat(e.userIDList.length):"userIDList=".concat(e.userIDList)),_s.log("".concat(n," groupID:").concat(e.groupID," userIDList:").concat(e.userIDList.join(","))),e.userIDList.length>50&&(e.userIDList=e.userIDList.slice(0,50));var i=e.groupID,o=e.userIDList;return this._getGroupMemberProfileAdvance(jn(jn({},e),{},{userIDList:o})).then(function(e){var n=e.data.members;return Ts(n)&&0!==n.length?(t._updateLocalGroupMemberMap(i,n),t.tim.getUserProfile({userIDList:n.map(function(e){return e.userID}),tagList:[rd.NICK,rd.AVATAR]})):pp([])}).then(function(e){var n=e.data.map(function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}});t._updateLocalGroupMemberMap(i,n);var a=o.filter(function(e){return t.hasLocalGroupMember(i,e)}).map(function(e){return t.getLocalGroupMemberInfo(i,e)});return r.setNetworkType(t.getNetworkType()).setEnd(),new dp({memberList:a})})}},{key:"_getGroupMemberProfileAdvance",value:function(e){return this.request({name:"group",action:"getGroupMemberProfile",param:jn(jn({},e),{},{memberInfoFilter:e.memberInfoFilter?e.memberInfoFilter:["Role","JoinTime","NameCard","ShutUpUntil"]})})}},{key:"updateSelfInfo",value:function(e){var t="".concat(Xg,".updateSelfInfo"),n=e.groupID;_s.log("".concat(t," groupID:"),n);var r={groupID:n,userIDList:[this.tim.loginInfo.identifier]};return this.getGroupMemberProfile(r).then(function(r){var i=r.data.memberList;return _s.log("".concat(t," ok. groupID:"),n),e&&0!==i.length&&e.updateSelfInfo(i[0]),e})}},{key:"addGroupMember",value:function(e){var t=this,n="".concat(Xg,".addGroupMember"),r=new Cp("addGroupMember");r.setText("groupID=".concat(e.groupID));var i=this.getLocalGroupProfile(e.groupID);if(Js(i.type)){var o=new Ed({code:Td.CANNOT_ADD_MEMBER_IN_AVCHATROOM,message:Od});return r.setCode(Td.CANNOT_ADD_MEMBER_IN_AVCHATROOM).setMessage(Od).setNetworkType(this.getNetworkType()).setText("groupID=".concat(e.groupID," groupType=").concat(i.type)).setEnd(),hp(o)}return e.userIDList=e.userIDList.map(function(e){return{userID:e}}),_s.log("".concat(n," groupID:"),e.groupID),this.request({name:"group",action:"addGroupMember",param:e}).then(function(o){var a=o.data.members;r.setNetworkType(t.getNetworkType()).setText("groupID=".concat(e.groupID)).setEnd(),_s.log("".concat(n," ok. groupID:"),e.groupID);var s=a.filter(function(e){return 1===e.result}).map(function(e){return e.userID}),u=a.filter(function(e){return 0===e.result}).map(function(e){return e.userID}),l=a.filter(function(e){return 2===e.result}).map(function(e){return e.userID});return 0===s.length?new dp({successUserIDList:s,failureUserIDList:u,existedUserIDList:l}):(i.memberNum+=s.length,new dp({successUserIDList:s,failureUserIDList:u,existedUserIDList:l,group:i}))}).catch(function(i){return t.probeNetwork().then(function(t){var n=Jn(t,2),o=n[0],a=n[1];r.setError(i,o,a).setText("groupID=".concat(e.groupID)).setEnd()}),_s.error("".concat(n," error:").concat(Ps(i)," groupID:").concat(e.groupID)),hp(i)})}},{key:"deleteGroupMember",value:function(e){var t=this,n="".concat(Xg,".deleteGroupMember"),r=new Cp("deleteGroupMember");r.setText(e.userIDList.length>5?"userIDList.length=".concat(e.userIDList.length):"userIDList=".concat(e.userIDList)),_s.log("".concat(n," groupID:").concat(e.groupID," userIDList:").concat(e.userIDList));var i=this.getLocalGroupProfile(e.groupID);return i.type===En.GRP_AVCHATROOM?hp(new Ed({code:Td.CANNOT_KICK_MEMBER_IN_AVCHATROOM,message:"不能在 AVChatRoom 类型的群组踢人"})):this.request({name:"group",action:"deleteGroupMember",param:e}).then(function(){return r.setNetworkType(t.getNetworkType()).setEnd(),_s.log("".concat(n," ok")),i.memberNum--,t.deleteLocalGroupMembers(e.groupID,e.userIDList),new dp({group:i,userIDList:e.userIDList})}).catch(function(i){return t.probeNetwork().then(function(t){var n=Jn(t,2),o=n[0],a=n[1];r.setError(i,o,a).setText("groupID=".concat(e.groupID)).setEnd()}),_s.error("".concat(n," error:").concat(Ps(i)," groupID:").concat(e.groupID)),hp(i)})}},{key:"searchGroupByID",value:function(e){var t=this,n="".concat(Xg,".searchGroupByID"),r={groupIDList:[e]},i=new Cp("searchGroupByID");return i.setText("groupID=".concat(e)),_s.log("".concat(n," groupID:").concat(e)),this.request({name:"group",action:"searchGroupByID",param:r}).then(function(r){var o=r.data.groupProfile;if(o[0].errorCode!==Wu.SUCCESS)throw new Ed({code:o[0].errorCode,message:o[0].errorInfo});return i.setNetworkType(t.getNetworkType()).setEnd(),_s.log("".concat(n," ok. groupID:").concat(e)),new dp({group:new pg(o[0])})}).catch(function(r){return t.probeNetwork().then(function(e){var t=Jn(e,2),n=t[0],o=t[1];i.setError(r,n,o).setEnd()}),_s.warn("".concat(n," error:").concat(Ps(r)," groupID:").concat(e)),hp(r)})}},{key:"applyJoinGroup",value:function(e){var t=this,n="".concat(Xg,".applyJoinGroup"),r=new Cp(Ap);return this.request({name:"group",action:"applyJoinGroup",param:e}).then(function(i){var o=i.data,a=o.joinedStatus,s=o.longPollingKey;switch(r.setNetworkType(t.getNetworkType()).setText("groupID=".concat(e.groupID," joinedStatus=").concat(a)).setEnd(),_s.log("".concat(n," ok. groupID:").concat(e.groupID," joinedStatus:").concat(a," longPollingKey:").concat(s)),a){case Ku.WAIT_APPROVAL:return new dp({status:Ku.WAIT_APPROVAL});case Ku.SUCCESS:return t.getGroupProfile({groupID:e.groupID}).then(function(n){var r=n.data.group,i={status:Ku.SUCCESS,group:r};return xs(s)?(t.emitGroupListUpdate(!0,!1),new dp(i)):(t.emitInnerEvent(Kf,e.groupID),t.AVChatRoomHandler.startRunLoop({longPollingKey:s,group:r}))});default:var u=new Ed({code:Td.JOIN_GROUP_FAIL,message:"加群失败，请检查传入参数或重试"});return _s.error("".concat(n," error:").concat(Ps(u)," groupID:").concat(e.groupID)),hp(u)}}).catch(function(i){return r.setText("groupID=".concat(e.groupID)),t.probeNetwork().then(function(e){var t=Jn(e,2),n=t[0],o=t[1];r.setError(i,n,o).setEnd()}),_s.error("".concat(n," error:").concat(Ps(i)," groupID:").concat(e.groupID)),hp(i)})}},{key:"applyJoinAVChatRoom",value:function(e){return this.AVChatRoomHandler.applyJoinAVChatRoom(e)}},{key:"handleGroupApplication",value:function(e){var t=this,n="".concat(Xg,".handleGroupApplication"),r=e.message.payload,i=r.groupProfile.groupID,o=r.authentication,a=r.messageKey,s=r.operatorID,u=new Cp("handleGroupApplication");return u.setText("groupID=".concat(i)),_s.log("".concat(n," groupID:"),i),this.request({name:"group",action:"handleApplyJoinGroup",param:jn(jn({},e),{},{applicant:s,groupID:i,authentication:o,messageKey:a})}).then(function(){return u.setNetworkType(t.getNetworkType()).setEnd(),_s.log("".concat(n," ok. groupID:"),i),t.deleteGroupSystemNotice({messageList:[e.message]}),new dp({group:t.getLocalGroupProfile(i)})}).catch(function(e){return t.probeNetwork().then(function(t){var n=Jn(t,2),r=n[0],i=n[1];u.setError(e,r,i).setEnd()}),_s.error("".concat(n," error. error:").concat(Ps(e)," groupID:").concat(i)),hp(e)})}},{key:"deleteGroupSystemNotice",value:function(e){var t=this,n="".concat(Xg,".deleteGroupSystemNotice");return Ts(e.messageList)&&0!==e.messageList.length?(_s.log("".concat(n)+e.messageList.map(function(e){return e.ID})),this.request({name:"group",action:"deleteGroupSystemNotice",param:{messageListToDelete:e.messageList.map(function(e){return{from:En.CONV_SYSTEM,messageSeq:e.clientSequence,messageRandom:e.random}})}}).then(function(){return _s.log("".concat(n," ok")),e.messageList.forEach(function(e){t.tim.messageController.deleteLocalMessage(e)}),new dp}).catch(function(e){return _s.error("".concat(n," error:"),e),hp(e)})):pp()}},{key:"getGroupProfileAdvance",value:function(e){var t="".concat(Xg,".getGroupProfileAdvance");return Ts(e.groupIDList)&&e.groupIDList.length>50&&(_s.warn("".concat(t," 获取群资料的数量不能超过50个")),e.groupIDList.length=50),_s.log("".concat(t," groupIDList:"),e.groupIDList),this.request({name:"group",action:"query",param:e}).then(function(e){_s.log("".concat(t," ok."));var n=e.data.groups,r=n.filter(function(e){return xs(e.errorCode)||e.errorCode===Wu.SUCCESS}),i=n.filter(function(e){return e.errorCode&&e.errorCode!==Wu.SUCCESS}).map(function(e){return new Ed({code:e.errorCode,message:e.errorInfo,data:{groupID:e.groupID}})});return new dp({successGroupList:r,failureGroupList:i})}).catch(function(n){return _s.error("".concat(t," error:").concat(Ps(n)," groupIDList:").concat(e.groupIDList)),hp(n)})}},{key:"_deleteLocalGroup",value:function(e){return this.groupMap.delete(e),this.groupMemberListMap.delete(e),this._setStorageGroupList(),this.groupMap.has(e)&&this.groupMemberListMap.has(e)}},{key:"_initGroupList",value:function(){var e=this,t="".concat(Xg,"._initGroupList"),n=new Cp("getGroupListInStorage");_s.time(xp),_s.log("".concat(t));var r=this._getStorageGroupList();Ts(r)&&r.length>0?(r.forEach(function(t){e.groupMap.set(t.groupID,new pg(t))}),this.emitGroupListUpdate(!0,!1),n.setNetworkType(this.getNetworkType()).setText(this.groupMap.size).setEnd()):n.setNetworkType(this.getNetworkType()).setText(0).setEnd(),this.triggerReady(),_s.log("".concat(t," ok. initCost=").concat(_s.timeEnd(xp),"ms")),this.getGroupList()}},{key:"_initListeners",value:function(){var e=this.tim.innerEmitter;e.once(lf,this._initGroupList,this),e.on(Vf,this._handleUpdateGroupLastMessage,this),e.on(mf,this._handleReceivedGroupMessage,this),e.on(zf,this._handleProfileUpdated,this)}},{key:"emitGroupListUpdate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalGroups(),r=JSON.parse(JSON.stringify(n));t&&this.emitInnerEvent(Nf,r),e&&this.emitOuterEvent(wn.GROUP_LIST_UPDATED,n)}},{key:"_handleReceivedGroupMessage",value:function(e){var t=this,n=e.data.eventDataList;Array.isArray(n)&&n.forEach(function(e){var n=e.conversationID.replace(En.CONV_GROUP,"");t.groupMap.has(n)&&(t.groupMap.get(n).nextMessageSeq=e.lastMessage.sequence+1)})}},{key:"_onReceivedGroupSystemNotice",value:function(e){var t=e.data;this.groupNoticeHandler._onReceivedGroupNotice(t)}},{key:"_handleUpdateGroupLastMessage",value:function(e){var t="".concat(Xg,"._handleUpdateGroupLastMessage"),n=e.data;if(_s.log("".concat(t," convNums=").concat(n.length," groupNums=").concat(this.groupMap.size)),0!==this.groupMap.size){for(var r,i,o,a=!1,s=0,u=n.length;s<u;s++)(r=n[s]).conversationID&&r.type!==En.CONV_GROUP&&(i=r.conversationID.split(/^GROUP/)[1],(o=this.getLocalGroupProfile(i))&&(o.lastMessage=r.lastMessage,a=!0));a&&(this.groupMap=this._sortLocalGroupList(this.groupMap),this.emitGroupListUpdate(!0,!1))}else this.tempConversationList=n}},{key:"_sortLocalGroupList",value:function(e){var t=Xn(e).filter(function(e){var t=Jn(e,2);return t[0],!nu(t[1].lastMessage)});return t.sort(function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime}),new Map([].concat(Xn(t),Xn(e)))}},{key:"_getStorageGroupList",value:function(){return this.tim.storage.getItem("groupMap")}},{key:"_setStorageGroupList",value:function(){var e=this.getLocalGroups().filter(function(e){var t=e.type;return!Js(t)}).slice(0,20).map(function(e){return{groupID:e.groupID,name:e.name,avatar:e.avatar,type:e.type}});this.tim.storage.setItem("groupMap",e)}},{key:"updateGroupMap",value:function(e){var t=this;e.forEach(function(e){t.groupMap.has(e.groupID)?t.groupMap.get(e.groupID).updateGroup(e):t.groupMap.set(e.groupID,new pg(e))}),this._setStorageGroupList()}},{key:"_updateLocalGroupMemberMap",value:function(e,t){var n=this;return Ts(t)&&0!==t.length?t.map(function(t){return n.hasLocalGroupMember(e,t.userID)?n.getLocalGroupMemberInfo(e,t.userID).updateMember(t):n.setLocalGroupMember(e,new Bg(t)),n.getLocalGroupMemberInfo(e,t.userID)}):[]}},{key:"deleteLocalGroupMembers",value:function(e,t){var n=this.groupMemberListMap.get(e);n&&t.forEach(function(e){n.delete(e)})}},{key:"_modifyGroupMemberInfo",value:function(e){var t=this,n=e.groupID,r=e.userID;return this.request({name:"group",action:"modifyGroupMemberInfo",param:e}).then(function(){if(t.hasLocalGroupMember(n,r)){var i=t.getLocalGroupMemberInfo(n,r);return xs(e.muteTime)||i.updateMuteUntil(e.muteTime),xs(e.role)||i.updateRole(e.role),xs(e.nameCard)||i.updateNameCard(e.nameCard),xs(e.memberCustomField)||i.updateMemberCustomField(e.memberCustomField),i}return t.getGroupMemberProfile({groupID:n,userIDList:[r]}).then(function(e){return Jn(e.data.memberList,1)[0]})})}},{key:"_groupListTreeShaking",value:function(e){for(var t=new Map(Xn(this.groupMap)),n=0,r=e.length;n<r;n++)t.delete(e[n].groupID);this.AVChatRoomHandler.hasJoinedAVChatRoom()&&this.AVChatRoomHandler.getJoinedAVChatRoom().forEach(function(e){t.delete(e)});for(var i=Xn(t.keys()),o=0,a=i.length;o<a;o++)this.groupMap.delete(i[o])}},{key:"_handleProfileUpdated",value:function(e){for(var t=this,n=e.data,r=function(e){var r=n[e];t.groupMemberListMap.forEach(function(e){e.has(r.userID)&&e.get(r.userID).updateMember({nick:r.nick,avatar:r.avatar})})},i=0;i<n.length;i++)r(i)}},{key:"getJoinedAVChatRoom",value:function(){return this.AVChatRoomHandler.getJoinedAVChatRoom()}},{key:"deleteLocalGroupAndConversation",value:function(e){this._deleteLocalGroup(e),this.tim.conversationController.deleteLocalConversation("GROUP".concat(e)),this.emitGroupListUpdate(!0,!1)}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this.AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"getGroupLastSequence",value:function(e){var t=this,n="".concat(Xg,".getGroupLastSequence"),r=new Cp("getGroupLastSequence"),i=0;if(this.hasLocalGroup(e)){var o=this.getLocalGroupProfile(e);if(o.lastMessage.lastSequence>0)return i=o.lastMessage.lastSequence,_s.log("".concat(n," got lastSequence=").concat(i," from local group profile[lastMessage.lastSequence]. groupID=").concat(e)),r.setNetworkType(this.getNetworkType()).setText("got lastSequence=".concat(i," from local group profile[lastMessage.lastSequence]. groupID=").concat(e)).setEnd(),Promise.resolve(i);if(o.nextMessageSeq>1)return i=o.nextMessageSeq-1,_s.log("".concat(n," got lastSequence=").concat(i," from local group profile[nextMessageSeq]. groupID=").concat(e)),r.setNetworkType(this.getNetworkType()).setText("got lastSequence=".concat(i," from local group profile[nextMessageSeq]. groupID=").concat(e)).setEnd(),Promise.resolve(i)}var a="GROUP".concat(e),s=this.tim.conversationController.getLocalConversation(a);if(s&&s.lastMessage.lastSequence)return i=s.lastMessage.lastSequence,_s.log("".concat(n," got lastSequence=").concat(i," from local conversation profile[lastMessage.lastSequence]. groupID=").concat(e)),r.setNetworkType(this.getNetworkType()).setText("got lastSequence=".concat(i," from local conversation profile[lastMessage.lastSequence]. groupID=").concat(e)).setEnd(),Promise.resolve(i);var u={groupIDList:[e],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}};return this.getGroupProfileAdvance(u).then(function(o){var a=o.data.successGroupList;return nu(a)?_s.log("".concat(n," successGroupList is empty. groupID=").concat(e)):(i=a[0].nextMessageSeq-1,_s.log("".concat(n," got lastSequence=").concat(i," from getGroupProfileAdvance. groupID=").concat(e))),r.setNetworkType(t.getNetworkType()).setText("got lastSequence=".concat(i," from getGroupProfileAdvance. groupID=").concat(e)).setEnd(),i}).catch(function(i){return t.probeNetwork().then(function(t){var n=Jn(t,2),o=n[0],a=n[1];r.setError(i,o,a).setText("get lastSequence failed from getGroupProfileAdvance. groupID=".concat(e)).setEnd()}),_s.warn("".concat(n," failed. ").concat(i)),hp(i)})}},{key:"getGroupOnlineMemberCount",value:function(e){return this.AVChatRoomHandler.checkJoinedAVChatRoomByID(e)?this.AVChatRoomHandler.getGroupOnlineMemberCount(e):pp({memberCount:0})}},{key:"reset",value:function(){this.groupMap.clear(),this.groupMemberListMap.clear(),this.resetReady(),this.groupNoticeHandler.reset(),this.AVChatRoomHandler.reset(),this.tim.innerEmitter.once(lf,this._initGroupList,this)}}]),n}(up),Zg=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;Ln(this,n),(r=t.call(this,e)).REALTIME_MESSAGE_TIMEOUT=3e5,r.LONGPOLLING_ID_TIMEOUT=3e5,r._currentState=En.NET_STATE_CONNECTED,r._status={OPENIM:{lastResponseReceivedTime:0,jitterCount:0,failedCount:0},AVCHATROOM:{lastResponseReceivedTime:0,jitterCount:0,failedCount:0}};var i=r.tim.innerEmitter;return i.on(bf,r._onGetLongPollIDFailed,Wn(r)),i.on(kf,r._onOpenIMResponseOK,Wn(r)),i.on(Sf,r._onOpenIMRequestFailed,Wn(r)),i.on(Pf,r._onAVChatroomResponseOK,Wn(r)),i.on(Lf,r._onAVChatroomRequestFailed,Wn(r)),r}return Nn(n,[{key:"_onGetLongPollIDFailed",value:function(){this._currentState!==En.NET_STATE_DISCONNECTED&&this._emitNetStateChangeEvent(En.NET_STATE_DISCONNECTED)}},{key:"_onOpenIMResponseOK",value:function(){this._onResponseOK("OPENIM")}},{key:"_onOpenIMRequestFailed",value:function(){this._onRequestFailed("OPENIM")}},{key:"_onAVChatroomResponseOK",value:function(){this.isLoggedIn()||this._onResponseOK("AVCHATROOM")}},{key:"_onAVChatroomRequestFailed",value:function(){this.isLoggedIn()||this._onRequestFailed("AVCHATROOM")}},{key:"_onResponseOK",value:function(e){var t=this._status[e],n=Date.now();if(0!==t.lastResponseReceivedTime){var r=n-t.lastResponseReceivedTime;_s.debug("StatusController._onResponseOK key=".concat(e," currentState=").concat(this._currentState," interval=").concat(r," failedCount=").concat(t.failedCount," jitterCount=").concat(t.jitterCount)),t.failedCount>0&&(t.failedCount=0,t.jitterCount+=1,this._currentState!==En.NET_STATE_CONNECTED&&this._emitNetStateChangeEvent(En.NET_STATE_CONNECTED)),r<=this.LONGPOLLING_ID_TIMEOUT?t.jitterCount>=3&&(new Cp("networkJitter").setText("".concat(e,"-").concat(r,"-").concat(t.jitterCount)).setNetworkType(this.getNetworkType()).setEnd(),t.jitterCount=0):(new Cp("sdkReload").setText("".concat(e,"-").concat(r)).setNetworkType(this.getNetworkType()).setEnd(),_s.warn("StatusController._onResponseOK, sdk reload. key=".concat(e," interval=").concat(r,"ms. https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/module-EVENT.html#.SDK_RELOAD")),this.emitInnerEvent(Jf)),t.lastResponseReceivedTime=n}else t.lastResponseReceivedTime=n}},{key:"_onRequestFailed",value:function(e){var t=this,n=this._status[e];Date.now()-n.lastResponseReceivedTime>=this.LONGPOLLING_ID_TIMEOUT?this._currentState!==En.NET_STATE_DISCONNECTED&&(_s.warn("StatusController._onRequestFailed, disconnected, longpolling unavailable more than 5min. key=".concat(e," networkType=").concat(this.getNetworkType())),this._emitNetStateChangeEvent(En.NET_STATE_DISCONNECTED)):(n.failedCount+=1,n.failedCount>5?this.probeNetwork().then(function(r){var i=Jn(r,2),o=i[0],a=i[1];o?(t._currentState!==En.NET_STATE_CONNECTING&&t._emitNetStateChangeEvent(En.NET_STATE_CONNECTING),_s.warn("StatusController._onRequestFailed, connecting, network jitter. key=".concat(e," networkType=").concat(a))):(t._currentState!==En.NET_STATE_DISCONNECTED&&t._emitNetStateChangeEvent(En.NET_STATE_DISCONNECTED),_s.warn("StatusController._onRequestFailed, disconnected, longpolling unavailable. key=".concat(e," networkType=").concat(a))),n.failedCount=0,n.jitterCount=0}):this._currentState===En.NET_STATE_CONNECTED&&this._emitNetStateChangeEvent(En.NET_STATE_CONNECTING))}},{key:"_emitNetStateChangeEvent",value:function(e){_s.log("StatusController._emitNetStateChangeEvent net state changed from ".concat(this._currentState," to ").concat(e)),this._currentState=e,this.emitOuterEvent(wn.NET_STATE_CHANGE,{state:e})}},{key:"reset",value:function(){_s.log("StatusController.reset"),this._currentState=En.NET_STATE_CONNECTED,this._status={OPENIM:{lastResponseReceivedTime:0,jitterCount:0,failedCount:0},AVCHATROOM:{lastResponseReceivedTime:0,jitterCount:0,failedCount:0}}}}]),n}(up);function $g(){return null}var ev=function(){function e(t){Ln(this,e),this.tim=t,this.storageQueue=new Map,this.checkTimes=0,this.checkTimer=setInterval(this._onCheckTimer.bind(this),1e3),this._errorTolerantHandle()}return Nn(e,[{key:"_errorTolerantHandle",value:function(){!qa&&xs(window.localStorage)&&(this.getItem=$g,this.setItem=$g,this.removeItem=$g,this.clear=$g)}},{key:"_onCheckTimer",value:function(){if(this.checkTimes++,this.checkTimes%20==0){if(0===this.storageQueue.size)return;this._doFlush()}}},{key:"_doFlush",value:function(){try{var e,t=$n(this.storageQueue);try{for(t.s();!(e=t.n()).done;){var n=Jn(e.value,2),r=n[0],i=n[1];this._setStorageSync(this._getKey(r),i)}}catch(e){t.e(e)}finally{t.f()}this.storageQueue.clear()}catch(e){_s.warn("Storage._doFlush error",e)}}},{key:"_getPrefix",value:function(){var e=this.tim.loginInfo,t=e.SDKAppID,n=e.identifier;return"TIM_".concat(t,"_").concat(n,"_")}},{key:"getItem",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;return this._getStorageSync(n)}catch(e){return _s.warn("Storage.getItem error:",e),{}}}},{key:"setItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(n){var i=r?this._getKey(e):e;this._setStorageSync(i,t)}else this.storageQueue.set(e,t)}},{key:"clear",value:function(){try{qa?Ha.clearStorageSync():localStorage.clear()}catch(e){_s.warn("Storage.clear error:",e)}}},{key:"removeItem",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;this._removeStorageSync(n)}catch(e){_s.warn("Storage.removeItem error:",e)}}},{key:"getSize",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"b";try{var r={size:0,limitSize:5242880,unit:n};if(Object.defineProperty(r,"leftSize",{enumerable:!0,get:function(){return r.limitSize-r.size}}),qa&&(r.limitSize=1024*Ha.getStorageInfoSync().limitSize),e)r.size=JSON.stringify(this.getItem(e)).length+this._getKey(e).length;else if(qa){var i=Ha.getStorageInfoSync(),o=i.keys;o.forEach(function(e){r.size+=JSON.stringify(t._getStorageSync(e)).length+t._getKey(e).length})}else for(var a in localStorage)localStorage.hasOwnProperty(a)&&(r.size+=localStorage.getItem(a).length+a.length);return this._convertUnit(r)}catch(e){_s.warn("Storage.getSize error:",e)}}},{key:"_convertUnit",value:function(e){var t={},n=e.unit;for(var r in t.unit=n,e)"number"==typeof e[r]&&("kb"===n.toLowerCase()?t[r]=Math.round(e[r]/1024):"mb"===n.toLowerCase()?t[r]=Math.round(e[r]/1024/1024):t[r]=e[r]);return t}},{key:"_getKey",value:function(e){return"".concat(this._getPrefix()).concat(e)}},{key:"_setStorageSync",value:function(e,t){qa?Va?my.setStorageSync({key:e,data:t}):Ha.setStorageSync(e,t):localStorage.setItem(e,JSON.stringify(t))}},{key:"_getStorageSync",value:function(e){return qa?Va?my.getStorageSync({key:e}).data:Ha.getStorageSync(e):JSON.parse(localStorage.getItem(e))}},{key:"_removeStorageSync",value:function(e){qa?Va?my.removeStorageSync({key:e}):Ha.removeStorageSync(e):localStorage.removeItem(e)}},{key:"reset",value:function(){this._doFlush(),this.checkTimes=0}}]),e}(),tv=n(function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,o),!0;case 6:return c.fn.call(c.context,t,r,i,o,a),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,i);break;default:if(!u)for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s});function nv(e){var t=e.context||null;return{platform:ef,websdkappid:$d,v:Zd,a2:t&&t.a2Key||void 0,tinyid:t&&t.tinyID||void 0,sdkappid:t&&t.SDKAppID||0,contentType:t&&t.contentType||0,apn:t&&t.apn||1,accounttype:t&&t.accountType||0}}var rv=function(){function e(t){Ln(this,e),this.tim=t,this.tim.innerEmitter.on(sf,this._update,this),this.tim.innerEmitter.on(uf,this._update,this),this.tim.innerEmitter.on(cf,this._updateSpecifiedConfig,this),this._initConfig()}return Nn(e,[{key:"_update",value:function(e){this._initConfig()}},{key:"_updateSpecifiedConfig",value:function(e){var t=this;e.data.forEach(function(e){t._set(e)})}},{key:"get",value:function(e){var t=e.name,n=e.action,r=e.param,i=e.tjgID;if(xs(this.config[t])||xs(this.config[t][n]))throw new Ed({code:Td.NETWORK_PACKAGE_UNDEFINED,message:"".concat("未定义的 packageConfig",": PackageConfig.").concat(t)});var o=function e(t){if(0===Object.getOwnPropertyNames(t).length)return Object.create(null);var n=Array.isArray(t)?[]:Object.create(null),r="";for(var i in t)null!==t[i]?void 0!==t[i]?(r=On(t[i]),["string","number","function","boolean"].indexOf(r)>=0?n[i]=t[i]:n[i]=e(t[i])):n[i]=void 0:n[i]=null;return n}(this.config[t][n]);return o.requestData=this._initRequestData(r,o),o.encode=this._initEncoder(o),o.decode=this._initDecoder(o),i&&(o.queryString.tjg_id=i),o}},{key:"_set",value:function(e){var t=e.key,n=e.value;if(0!=!!t){var r=t.split(".");r.length<=0||function e(t,n,r,i){var o=n[r];"object"===On(t[o])?e(t[o],n,r+1,i):t[o]=i}(this.config,r,0,n)}}},{key:"_initConfig",value:function(){var e;this.config={},this.config.accessLayer=(e=this.tim,{create:null,query:{serverName:of.NAME.WEB_IM,cmd:of.CMD.ACCESS_LAYER,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:jn(jn({},nv(e)),{},{identifier:e.context.identifier,usersig:e.context.userSig}),requestData:{}},update:null,delete:null}),this.config.login=function(e){return{create:null,query:{serverName:of.NAME.OPEN_IM,cmd:of.CMD.LOGIN,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:jn(jn({},nv(e)),{},{identifier:e.loginInfo.identifier,usersig:e.loginInfo.userSig,sdkappid:e.loginInfo.SDKAppID,accounttype:e.loginInfo.accountType,reqtime:+new Date/1e3}),requestData:{state:"Online"},keyMaps:{request:{tinyID:"tinyId"},response:{TinyId:"tinyID"}}},update:null,delete:null}}(this.tim),this.config.logout=function(e){return{create:null,query:{serverName:of.NAME.OPEN_IM,cmd:of.CMD.LOGOUT_ALL,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:jn(jn({},nv(e)),{},{reqtime:+new Date/1e3}),requestData:{}},update:null,delete:null}}(this.tim),this.config.longPollLogout=function(e){return{create:null,query:{serverName:of.NAME.OPEN_IM,cmd:of.CMD.LOGOUT_LONG_POLL,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:jn(jn({},nv(e)),{},{reqtime:+new Date}),requestData:{longPollID:""},keyMaps:{request:{longPollID:"LongPollingId"}}},update:null,delete:null}}(this.tim),this.config.profile=function(e){var t=nv(e),n={serverName:of.NAME.PROFILE,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:t};return{query:jn(jn({},n),{},{cmd:of.CMD.PORTRAIT_GET,requestData:{fromAccount:"",userItem:[]},keyMaps:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),update:jn(jn({},n),{},{cmd:of.CMD.PORTRAIT_SET,requestData:{fromAccount:"",profileItem:[{tag:rd.NICK,value:""},{tag:rd.GENDER,value:""},{tag:rd.ALLOWTYPE,value:""},{tag:rd.AVATAR,value:""}]}})}}(this.tim),this.config.group=function(e){var t=of.NAME.GROUP,n=nv(e);if(e.context.login!==Yu.IS_LOGIN||!e.context.a2Key){t=of.NAME.BIG_GROUP_NO_AUTH;var r=nv(e);r.a2,r.tinyid,n=Kn(r,["a2","tinyid"])}var i={request:{ownerID:"Owner_Account",userID:"Member_Account",newOwnerID:"NewOwner_Account",maxMemberNum:"MaxMemberCount",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember",messageRemindType:"MsgFlag",userIDList:"MemberList",groupIDList:"GroupIdList",applyMessage:"ApplyMsg",muteTime:"ShutUpTime",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption"},response:{GroupIdList:"groups",MsgFlag:"messageRemindType",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers",ApplyJoinOption:"joinOption"}},o={serverName:of.NAME.GROUP,channel:of.CHANNEL.XHR,protocol:nf,queryString:n};return{create:jn(jn({},o),{},{cmd:of.CMD.CREATE_GROUP,requestData:{type:En.GRP_WORK,name:void 0,groupID:void 0,ownerID:e.loginInfo.identifier,introduction:void 0,notification:void 0,avatar:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0},keyMaps:i}),list:jn(jn({},o),{},{cmd:of.CMD.GET_JOINED_GROUPS,requestData:{userID:e.loginInfo.identifier,limit:void 0,offset:void 0,groupType:void 0,responseFilter:void 0},keyMaps:i}),query:jn(jn({},o),{},{cmd:of.CMD.GET_GROUP_INFO,requestData:{groupIDList:void 0,responseFilter:void 0},keyMaps:i}),getGroupMemberProfile:jn(jn({},o),{},{cmd:of.CMD.GET_GROUP_MEMBER_INFO,requestData:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMaps:{request:jn(jn({},i.request),{},{userIDList:"Member_List_Account"}),response:i.response}}),getGroupMemberList:jn(jn({},o),{},{cmd:of.CMD.GET_GROUP_MEMBER_LIST,requestData:{groupID:void 0,limit:0,offset:0,memberRoleFilter:void 0,memberInfoFilter:void 0},keyMaps:i}),quitGroup:jn(jn({},o),{},{cmd:of.CMD.QUIT_GROUP,requestData:{groupID:void 0}}),changeGroupOwner:jn(jn({},o),{},{cmd:of.CMD.CHANGE_GROUP_OWNER,queryString:n,requestData:{groupID:void 0,newOwnerID:void 0},keyMaps:i}),destroyGroup:jn(jn({},o),{},{cmd:of.CMD.DESTROY_GROUP,requestData:{groupID:void 0}}),updateGroupProfile:jn(jn({},o),{},{cmd:of.CMD.MODIFY_GROUP_INFO,requestData:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,maxMemberNum:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0},keyMaps:{request:jn(jn({},i.request),{},{groupCustomField:"AppDefinedData"}),response:i.response}}),modifyGroupMemberInfo:jn(jn({},o),{},{cmd:of.CMD.MODIFY_GROUP_MEMBER_INFO,requestData:{groupID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMaps:i}),addGroupMember:jn(jn({},o),{},{cmd:of.CMD.ADD_GROUP_MEMBER,requestData:{groupID:void 0,silence:void 0,userIDList:void 0},keyMaps:i}),deleteGroupMember:jn(jn({},o),{},{cmd:of.CMD.DELETE_GROUP_MEMBER,requestData:{groupID:void 0,userIDList:void 0,reason:void 0},keyMaps:{request:{userIDList:"MemberToDel_Account"}}}),searchGroupByID:jn(jn({},o),{},{cmd:of.CMD.SEARCH_GROUP_BY_ID,requestData:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption"]}},keyMaps:{request:{groupIDList:"GroupIdList"}}}),applyJoinGroup:jn(jn({},o),{},{cmd:of.CMD.APPLY_JOIN_GROUP,requestData:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0},keyMaps:i}),applyJoinAVChatRoom:jn(jn({},o),{},{serverName:of.NAME.BIG_GROUP_NO_AUTH,cmd:of.CMD.APPLY_JOIN_GROUP,requestData:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0},keyMaps:i}),handleApplyJoinGroup:jn(jn({},o),{},{cmd:of.CMD.HANDLE_APPLY_JOIN_GROUP,requestData:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMaps:{request:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"},response:{MsgKey:"messageKey"}}}),deleteGroupSystemNotice:jn(jn({},o),{},{serverName:of.NAME.OPEN_IM,cmd:of.CMD.DELETE_GROUP_SYSTEM_MESSAGE,requestData:{messageListToDelete:void 0},keyMaps:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),getGroupPendency:jn(jn({},o),{},{cmd:of.CMD.GET_GROUP_PENDENCY,requestData:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMaps:{request:{handleAccount:"Handle_Account"}}}),getOnlineMemberNum:{serverName:t,cmd:of.CMD.GET_ONLINE_MEMBER_NUM,channel:of.CHANNEL.XHR,protocol:nf,queryString:n,requestData:{groupID:void 0}}}}(this.tim),this.config.longPollID=function(e){return{create:{},query:{serverName:of.NAME.OPEN_IM,cmd:of.CMD.GET_LONG_POLL_ID,channel:of.CHANNEL.XHR,protocol:nf,queryString:jn(jn({},nv(e)),{},{instanceid:e.context.instanceID,reqtime:+new Date/1e3}),requestData:{},keyMaps:{response:{LongPollingId:"longPollingID"}}},update:{},delete:{}}}(this.tim),this.config.longPoll=function(e){var t=jn(jn({},nv(e)),{},{instanceid:e.context.instanceID,reqtime:Math.ceil(+new Date/1e3)});return{create:{},query:{serverName:of.NAME.OPEN_IM,cmd:of.CMD.LONG_POLL,channel:of.CHANNEL.AUTO,protocol:nf,queryString:t,requestData:{timeout:null,cookie:{notifySeq:0,noticeSeq:0,longPollingID:0}},keyMaps:{response:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension"}}},update:{},delete:{}}}(this.tim),this.config.applyC2C=function(e){var t=nv(e),n={serverName:of.NAME.FRIEND,channel:of.CHANNEL.XHR,protocol:nf,queryString:t};return{create:jn(jn({},n),{},{cmd:of.CMD.FRIEND_ADD,requestData:{fromAccount:"",addFriendItem:[]}}),get:jn(jn({},n),{},{cmd:of.CMD.GET_PENDENCY,requestData:{fromAccount:"",pendencyType:"Pendency_Type_ComeIn"}}),update:jn(jn({},n),{},{cmd:of.CMD.RESPONSE_PENDENCY,requestData:{fromAccount:"",responseFriendItem:[]}}),delete:jn(jn({},n),{},{cmd:of.CMD.DELETE_PENDENCY,requestData:{fromAccount:"",toAccount:[],pendencyType:"Pendency_Type_ComeIn"}})}}(this.tim),this.config.friend=function(e){var t=jn(jn({},nv(e)),{},{reqtime:function(){return+new Date}}),n={serverName:of.NAME.FRIEND,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:t};return{get:jn(jn({},n),{},{cmd:of.CMD.FRIEND_GET_ALL,requestData:{fromAccount:"",timeStamp:0,tagList:[rd.NICK,"Tag_SNS_IM_Remark",rd.AVATAR]},keyMaps:{request:{},response:{}}}),delete:jn(jn({},n),{},{cmd:of.CMD.FRIEND_DELETE,requestData:{fromAccount:"",toAccount:[],deleteType:"Delete_Type_Single"}})}}(this.tim),this.config.blacklist=function(e){var t=nv(e),n={serverName:of.NAME.FRIEND,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:t};return{create:jn(jn({},n),{},{cmd:of.CMD.ADD_BLACKLIST,requestData:{fromAccount:"",toAccount:[]}}),get:jn(jn({},n),{},{cmd:of.CMD.GET_BLACKLIST,requestData:{fromAccount:"",startIndex:0,maxLimited:30,lastSequence:0}}),delete:jn(jn({},n),{},{cmd:of.CMD.DELETE_BLACKLIST,requestData:{fromAccount:"",toAccount:[]}}),update:{}}}(this.tim),this.config.c2cMessage=function(e){var t=jn(jn({},nv(e)),{},{reqtime:function(){return+new Date}}),n={request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag"},response:{MsgContent:"content",MsgTime:"time",Data:"data",Desc:"description",Ext:"extension",MsgKey:"messageKey",MsgType:"type",MsgBody:"elements",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}},r={serverName:of.NAME.OPEN_IM,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:t};return{create:jn(jn({},r),{},{cmd:of.CMD.SEND_MESSAGE,requestData:{fromAccount:e.loginInfo.identifier,toAccount:"",msgTimeStamp:Math.ceil(+new Date/1e3),msgSeq:0,msgRandom:0,msgBody:[],msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0},androidInfo:{OPPOChannelID:""}}},keyMaps:n}),query:jn(jn({},r),{},{cmd:of.CMD.GET_C2C_ROAM_MESSAGES,requestData:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMsg:1},keyMaps:n})}}(this.tim),this.config.c2cMessageWillBeRevoked=function(e){var t=jn(jn({},nv(e)),{},{reqtime:function(){return+new Date}});return{create:{serverName:of.NAME.OPEN_IM,cmd:of.CMD.REVOKE_C2C_MESSAGE,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:t,requestData:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:Math.ceil(+new Date/1e3),msgSeq:0,msgRandom:0}},keyMaps:{request:{msgInfo:"MsgInfo",fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody"}}}}}(this.tim),this.config.c2cPeerReadTime=function(e){var t=jn(jn({},nv(e)),{},{reqtime:function(){return+new Date}});return{get:{serverName:of.NAME.OPEN_IM,cmd:of.CMD.GET_PEER_READ_TIME,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:t,requestData:{userIDList:void 0},keyMaps:{request:{userIDList:"To_Account"},response:{ReadTime:"peerReadTimeList"}}}}}(this.tim),this.config.groupMessage=function(e){var t=jn(jn({},nv(e)),{},{reqtime:function(){return+new Date}}),n={request:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq"},response:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsPlaceMsg:"isPlaceMessage",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}},r={serverName:of.NAME.GROUP,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:t};return{create:jn(jn({},r),{},{cmd:of.CMD.SEND_GROUP_MESSAGE,requestData:{groupID:"",fromAccount:e.loginInfo.identifier,random:0,clientSequence:0,priority:"",msgBody:[],onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0},androidInfo:{OPPOChannelID:""}}},keyMaps:n}),query:jn(jn({},r),{},{cmd:of.CMD.GET_GROUP_ROAM_MESSAGES,requestData:{withRecalledMsg:1,groupID:"",count:15,sequence:""},keyMaps:n}),update:null,delete:null}}(this.tim),this.config.groupMessageWillBeRevoked=function(e){var t=jn(jn({},nv(e)),{},{reqtime:function(){return+new Date}});return{create:{serverName:of.NAME.GROUP,cmd:of.CMD.REVOKE_GROUP_MESSAGE,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:t,requestData:{to:"",msgSeqList:[]},keyMaps:{request:{to:"GroupId",msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}}}(this.tim),this.config.conversation=function(e){var t=nv(e),n={serverName:of.NAME.RECENT_CONTACT,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:t};return{query:jn(jn({},n),{},{cmd:of.CMD.GET_CONVERSATION_LIST,requestData:{fromAccount:e.loginInfo.identifier,count:0},keyMaps:{request:{},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq"}}}),pagingQuery:jn(jn({},n),{},{cmd:of.CMD.PAGING_GET_CONVERSATION_LIST,requestData:{fromAccount:void 0,timeStamp:void 0,orderType:void 0},keyMaps:{request:{},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime"}}}),delete:jn(jn({},n),{},{cmd:of.CMD.DELETE_CONVERSATION,requestData:{fromAccount:e.loginInfo.identifier,toAccount:void 0,type:1,toGroupID:void 0},keyMaps:{request:{toGroupID:"ToGroupid"}}}),setC2CMessageRead:jn(jn({},n),{},{serverName:of.NAME.OPEN_IM,cmd:of.CMD.SET_C2C_MESSAGE_READ,requestData:{C2CMsgReaded:void 0},keyMaps:{request:{lastMessageTime:"LastedMsgTime"}}}),setGroupMessageRead:jn(jn({},n),{},{serverName:of.NAME.GROUP,cmd:of.CMD.SET_GROUP_MESSAGE_READ,requestData:{groupID:void 0,messageReadSeq:void 0},keyMaps:{request:{messageReadSeq:"MsgReadedSeq"}}})}}(this.tim),this.config.syncMessage=function(e){var t=jn(jn({},nv(e)),{},{reqtime:function(){return[Math.ceil(+new Date),Math.random()].join("")}});return{create:null,query:{serverName:of.NAME.OPEN_IM,cmd:of.CMD.GET_MESSAGES,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:t,requestData:{cookie:"",syncFlag:0,needAbstract:1},keyMaps:{request:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},response:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"groupID",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList"}}},update:null,delete:null}}(this.tim),this.config.AVChatRoom=function(e){var t=of.NAME.BIG_GROUP_LONG_POLLING_NO_AUTH,n=jn(jn({},nv(e)),{},{accounttype:"792",reqtime:function(){return+new Date}});return(e.context.login===Yu.IS_LOGIN||e.context.a2Key)&&(t=of.NAME.BIG_GROUP_LONG_POLLING),{startLongPoll:{serverName:t,cmd:of.CMD.AVCHATROOM_LONG_POLL,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:n,requestData:{USP:1,startSeq:1,holdTime:90,key:void 0},keyMaps:{request:{USP:"USP"},response:{ToGroupId:"groupID",MsgPriority:"priority"}}}}}(this.tim),this.config.cosUpload=function(e){var t=jn(jn({},nv(e)),{},{reqtime:function(){return+new Date}});return{create:{serverName:of.NAME.OPEN_IM,cmd:of.CMD.FILE_UPLOAD,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:t,requestData:{appVersion:"2.1",fromAccount:"",toAccount:"",sequence:0,time:function(){return Math.ceil(Date.now()/1e3)},random:function(){return Fs()},fileStrMd5:"",fileSize:"",serverVer:1,authKey:"",busiId:1,pkgFlag:1,sliceOffset:0,sliceSize:0,sliceData:"",contentType:"application/x-www-form-urlencoded"},keyMaps:{request:{},response:{}}},update:null,delete:null}}(this.tim),this.config.cosSig=function(e){var t={sdkappid:e.loginInfo.SDKAppID,identifier:e.loginInfo.identifier,userSig:e.context.userSig};return{create:null,query:{serverName:of.NAME.IM_COS_SIGN,cmd:of.CMD.COS_SIGN,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:t,requestData:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMaps:{request:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},response:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}},update:null,delete:null}}(this.tim),this.config.bigDataHallwayAuthKey=function(e){return{create:null,query:{serverName:of.NAME.OPEN_IM,cmd:of.CMD.BIG_DATA_HALLWAY_AUTH_KEY,channel:of.CHANNEL.XHR,protocol:nf,method:"POST",queryString:jn(jn({},nv(e)),{},{accounttype:"792",reqtime:function(){return+new Date}}),requestData:{}}}}(this.tim),this.config.ssoEventStat=function(e){var t={sdkappid:e.loginInfo.SDKAppID,reqtime:Math.ceil(+new Date/1e3)};return{create:{serverName:of.NAME.IM_OPEN_STAT,cmd:of.CMD.TIM_WEB_REPORT,channel:of.CHANNEL.AUTO,protocol:nf,queryString:t,requestData:{table:"",report:[]},keyMaps:{request:{table:"table",report:"report",SDKAppID:"sdkappid",version:"version",tinyID:"tinyid",userID:"userid",platform:"platform",method:"method",time:"time",start:"start",end:"end",cost:"cost",status:"status",codeint:"codeint",message:"message",pointer:"pointer",text:"text",msgType:"msgtype",networkType:"networktype",startts:"startts",endts:"endts",timespan:"timespan"}}},query:{},update:{},delete:{}}}(this.tim),this.config.ssoSumStat=function(e){var t=null;return null!==e.context&&(t={sdkappid:e.context.SDKAppID,reqtime:Math.ceil(+new Date/1e3)}),{create:{serverName:of.NAME.IM_OPEN_STAT,cmd:of.CMD.TIM_WEB_REPORT,channel:of.CHANNEL.AUTO,protocol:nf,queryString:t,requestData:{table:"",report:[]},keyMaps:{request:{table:"table",report:"report",SDKAppID:"sdkappid",version:"version",tinyID:"tinyid",userID:"userid",item:"item",lpID:"lpid",platform:"platform",scene:"scene",networkType:"networktype",total:"total",successRate:"successrate",avg:"avg",timespan:"timespan",time:"time"}}},query:{},update:{},delete:{}}}(this.tim)}},{key:"_initRequestData",value:function(e,t){if(void 0===e)return np(t.requestData,this._getRequestMap(t),this.tim);var n=t.requestData,r=Object.create(null);for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){if(r[i]="function"==typeof n[i]?n[i]():n[i],void 0===e[i])continue;r[i]=e[i]}return r=np(r,this._getRequestMap(t),this.tim)}},{key:"_getRequestMap",value:function(e){if(e.keyMaps&&e.keyMaps.request&&Object.keys(e.keyMaps.request).length>0)return e.keyMaps.request}},{key:"_initEncoder",value:function(e){switch(e.protocol){case nf:return function(e){if("string"===On(e))try{return JSON.parse(e)}catch(t){return e}return e};case tf:return function(e){return e};default:return function(e){return _s.warn("PackageConfig._initEncoder(), unknow response type, data: ",JSON.stringify(e)),e}}}},{key:"_initDecoder",value:function(e){switch(e.protocol){case nf:return function(e){if("string"===On(e))try{return JSON.parse(e)}catch(t){return e}return e};case tf:return function(e){return e};default:return function(e){return _s.warn("PackageConfig._initDecoder(), unknow response type, data: ",e),e}}}}]),e}(),iv=Math.floor;Me({target:"Number",stat:!0},{isInteger:function(e){return!m(e)&&isFinite(e)&&iv(e)===e}});var ov=function(e){var t=e.length,n=e[t-1];if("string"!=typeof n)return"";if(n.length>1)return"";var r=e[t-1];return delete e[t-1],e.length-=t===e.length?1:0,r},av={C2CMessageArray:1,groupMessageArray:1,groupTips:1,C2CNotifyMessageArray:1,profileModify:1,friendListMod:1},sv=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;return Ln(this,n),(r=t.call(this,e))._initialization(),r}return Nn(n,[{key:"_initialization",value:function(){this._syncOffset="",this._syncNoticeList=[],this._syncEventArray=[],this._syncMessagesIsRunning=!1,this._syncMessagesFinished=!1,this._isLongPoll=!1,this._longPollID=0,this._noticeSequence=0,this._initializeListener(),this._runLoop=null,this._initShuntChannels()}},{key:"_initShuntChannels",value:function(){this._shuntChannels=Object.create(null),this._shuntChannels.C2CMessageArray=this._C2CMessageArrayChannel.bind(this),this._shuntChannels.groupMessageArray=this._groupMessageArrayChannel.bind(this),this._shuntChannels.groupTips=this._groupTipsChannel.bind(this),this._shuntChannels.C2CNotifyMessageArray=this._C2CNotifyMessageArrayChannel.bind(this),this._shuntChannels.profileModify=this._profileModifyChannel.bind(this),this._shuntChannels.friendListMod=this._friendListModChannel.bind(this)}},{key:"_C2CMessageArrayChannel",value:function(e,t,n){this.emitInnerEvent(Tf,t)}},{key:"_groupMessageArrayChannel",value:function(e,t,n){this.emitInnerEvent(xf,t)}},{key:"_groupTipsChannel",value:function(e,t,n){var r=this;switch(e){case 4:case 6:this.emitInnerEvent(Cf,t);break;case 5:t.forEach(function(e){Ts(e.elements.revokedInfos)?r.emitInnerEvent(Of,t):r.emitInnerEvent(If,{groupSystemNotices:t,type:n})});break;default:_s.log("NotificationController._groupTipsChannel unknown event=".concat(e," type=").concat(n),t)}}},{key:"_C2CNotifyMessageArrayChannel",value:function(e,t,n){if(t[0]){var r=t[0];r.hasOwnProperty("kickoutMsgNotify")?this.emitInnerEvent(Ef):r.hasOwnProperty("c2cMessageRevokedNotify")?this.emitInnerEvent(Mf,t):r.hasOwnProperty("c2cMessageReadReceipt")&&this.emitInnerEvent(Df,t)}}},{key:"_profileModifyChannel",value:function(e,t,n){this.emitInnerEvent(Af,t)}},{key:"_friendListModChannel",value:function(e,t,n){this.emitInnerEvent(Rf,t)}},{key:"_dispatchNotice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"poll";if(Ts(e))for(var n=null,r=null,i="",o="",a="",s=0,u=0,l=e.length;u<l;u++)s=(n=e[u]).event,i=Object.keys(n).find(function(e){return void 0!==av[e]}),Is(this._shuntChannels[i])?(r=n[i],"poll"===t&&this._updatenoticeSequence(r),this._shuntChannels[i](s,r,t)):("poll"===t&&this._updatenoticeSequence(),o="".concat(Td.NOTICE_RUNLOOP_UNEXPECTED_CONDITION),a="".concat("意料外的通知条件",": ").concat(s,", ").concat(i),this.emitInnerEvent(Bf,new Ed({code:o,message:a,data:{payloadName:i,event:s}})),o="",a="")}},{key:"getLongPollID",value:function(){return this._longPollID}},{key:"_IAmReady",value:function(){this.triggerReady()}},{key:"reset",value:function(){this._noticeSequence=0,this._resetSync(),this.closeNoticeChannel()}},{key:"_resetSync",value:function(){this._syncOffset="",this._syncNoticeList=[],this._syncEventArray=[],this._syncMessagesIsRunning=!1,this._syncMessagesFinished=!1}},{key:"_setNoticeSeqInRequestData",value:function(e){e.Cookie.NoticeSeq=this._noticeSequence,this.tim.sumStatController.addTotalCount(vp)}},{key:"_updatenoticeSequence",value:function(e){if(e){var t=e[e.length-1].noticeSequence;t&&"number"==typeof t?t<=this._noticeSequence||(this._noticeSequence=t):this._noticeSequence++}else this._noticeSequence++}},{key:"_initializeListener",value:function(){var e=this.tim.innerEmitter;e.on(lf,this._startSyncMessages,this),e.on(jf,this.closeNoticeChannel,this)}},{key:"openNoticeChannel",value:function(){_s.log("NotificationController.openNoticeChannel"),this._getLongPollID()}},{key:"closeNoticeChannel",value:function(){_s.log("NotificationController.closeNoticeChannel"),(this._runLoop instanceof Yh||this._runLoop instanceof Jh)&&(this._runLoop.abort(),this._runLoop.stop()),this._longPollID=0,this._isLongPoll=!1}},{key:"_getLongPollID",value:function(){var e=this;if(0===this._longPollID){var t=new Cp("getLongPollID");this.request({name:"longPollID",action:"query"}).then(function(n){var r=n.data.longPollingID;e._onGetLongPollIDSuccess(r),t.setText("longPollingID=".concat(r)).setNetworkType(e.getNetworkType()).setEnd()}).catch(function(n){var r=new Ed({code:n.code||Td.GET_LONGPOLL_ID_FAILED,message:n.message||"获取 longpolling id 失败"});e.emitInnerEvent(bf),e.emitInnerEvent(Bf,r),e.probeNetwork().then(function(e){var n=Jn(e,2),i=n[0],o=n[1];t.setError(r,i,o).setEnd()})})}else this._onGetLongPollIDSuccess(this._longPollID)}},{key:"_onGetLongPollIDSuccess",value:function(e){this.emitInnerEvent(cf,[{key:"long_poll_logout.query.requestData.longPollingID",value:e},{key:"longPoll.query.requestData.cookie.longPollingID",value:e}]),this._longPollID=e,this._startLongPoll(),this._IAmReady(),this.tim.sumStatController.recordLongPollingID(this._longPollID)}},{key:"_startLongPoll",value:function(){if(!0!==this._isLongPoll){_s.log("NotificationController._startLongPoll...");var e=this.tim.connectionController,t=this.createTransportCapsule({name:"longPoll",action:"query"});this._isLongPoll=!0,this._runLoop=e.createRunLoop({pack:t,before:this._setNoticeSeqInRequestData.bind(this),success:this._onNoticeReceived.bind(this),fail:this._onNoticeFail.bind(this)}),this._runLoop.start()}else _s.log("NotificationController._startLongPoll is running...")}},{key:"_onNoticeReceived",value:function(e){var t=e.data;t.errorCode!==Wu.SUCCESS?(new Cp(Op).setMessage(t.errorInfo||JSON.stringify(t)).setCode(t.errorCode).setNetworkType(this.getNetworkType()).setEnd(!0),this._onResponseError(t)):this.emitInnerEvent(kf),this.tim.sumStatController.addSuccessCount(vp),this.tim.sumStatController.addCost(vp,t.timecost),e.data.eventArray&&this._dispatchNotice(e.data.eventArray)}},{key:"_onResponseError",value:function(e){switch(e.errorCode){case Td.LONG_POLL_KICK_OUT:_s.warn("NotificationController._onResponseError, longPollingID=".concat(this._longPollID," was kicked out")),this.emitInnerEvent(wf),this.closeNoticeChannel();break;case Td.MESSAGE_A2KEY_EXPIRED:case Td.ACCOUNT_A2KEY_EXPIRED:this.emitInnerEvent(Gf);break;default:xs(e.errorCode)||xs(e.errorInfo)?_s.log("NotificationController._onResponseError, errorCode or errorInfo undefined!",e):this.emitInnerEvent(Bf,new Ed({code:e.errorCode,message:e.errorInfo}))}}},{key:"_onNoticeFail",value:function(e){if(e.error)if("ECONNABORTED"===e.error.code||e.error.code===Td.NETWORK_TIMEOUT)if(e.error.config){var t=e.error.config.url,n=e.error.config.data;_s.log("NotificationController._onNoticeFail request timed out. url=".concat(t," data=").concat(n))}else _s.log("NotificationController._onNoticeFail request timed out.");else _s.log("NotificationController._onNoticeFail request failed due to network error");this.emitInnerEvent(Sf)}},{key:"_startSyncMessages",value:function(e){!0!==this._syncMessagesFinished&&this.syncMessage()}},{key:"syncMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._syncMessagesIsRunning=!0,this.request({name:"syncMessage",action:"query",param:{cookie:t,syncFlag:n}}).then(function(t){var n=t.data;switch(function(){for(var e=[],t=ov(arguments),n=0;n<arguments.length;n++)Number.isInteger(arguments[n])?e.push(arguments[n]):e.push(1==!!arguments[n]?"1":"0");return e.join(t)}(n.cookie,n.syncFlag)){case"00":case"01":e.emitInnerEvent(Bf,{code:Td.NOTICE_RUNLOOP_OFFSET_LOST,message:"_syncOffset 丢失"});break;case"10":case"11":n.eventArray&&e._dispatchNotice(n.eventArray,"sync"),e._syncNoticeList=e._syncNoticeList.concat(n.messageList),e.emitInnerEvent(df,{data:n.messageList,C2CRemainingUnreadList:n.C2CRemainingUnreadList}),e._syncOffset=n.cookie,e.syncMessage(n.cookie,n.syncFlag);break;case"12":n.eventArray&&e._dispatchNotice(n.eventArray,"sync"),e.openNoticeChannel(),e._syncNoticeList=e._syncNoticeList.concat(n.messageList),e.emitInnerEvent(ff,{messageList:n.messageList,C2CRemainingUnreadList:n.C2CRemainingUnreadList}),e._syncOffset=n.cookie,e._syncNoticeList=[],e._syncMessagesIsRunning=!1,e._syncMessagesFinished=!0}}).catch(function(t){e._syncMessagesIsRunning=!1,_s.error("NotificationController.syncMessage failed. error:",t)})}}]),n}(up),uv=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;return Ln(this,n),(r=t.call(this,e)).COSSDK=null,r._cosUploadMethod=null,r.expiredTimeLimit=600,r.appid=0,r.bucketName="",r.ciUrl="",r.directory="",r.downloadUrl="",r.uploadUrl="",r.expiredTimeOut=r.expiredTimeLimit,r.region="ap-shanghai",r.cos=null,r.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},r._timer=0,r.tim.innerEmitter.on(lf,r._init,Wn(r)),r.triggerReady(),r}return Nn(n,[{key:"_expiredTimer",value:function(){var e=this;this._timer=setInterval(function(){Math.ceil(Date.now()/1e3)>=e.cosOptions.expiredTime-120&&(e._getAuthorizationKey(),clearInterval(e._timer))},6e4)}},{key:"_init",value:function(){var e=qa?"cos-wx-sdk":"cos-js-sdk";this.COSSDK=this.tim.getPlugin(e),this.COSSDK?this._getAuthorizationKey():_s.warn("UploadController._init 没有检测到上传插件，将无法发送图片、音频、视频、文件等类型的消息。详细请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#registerPlugin")}},{key:"_getAuthorizationKey",value:function(){var e=this,t=Math.ceil(Date.now()/1e3),n=new Cp("getCosAuthKey");this.request({name:"cosSig",action:"query",param:{duration:this.expiredTimeLimit}}).then(function(r){_s.log("UploadController._getAuthorizationKey ok. data:",r.data);var i=r.data,o=i.expiredTime-t;n.setText("requestId=".concat(i.requestId," requestTime=").concat(t," expiredTime=").concat(i.expiredTime," timeout=").concat(o,"s")).setNetworkType(e.getNetworkType()).setEnd(),e.appid=i.appid,e.bucketName=i.bucketName,e.ciUrl=i.ciUrl,e.directory=i.directory,e.downloadUrl=i.downloadUrl,e.uploadUrl=i.uploadUrl,e.expiredTimeOut=o,e.cosOptions={secretId:i.secretId,secretKey:i.secretKey,sessionToken:i.sessionToken,expiredTime:i.expiredTime},e._initUploaderMethod(),e._expiredTimer()}).catch(function(t){e.probeNetwork().then(function(e){var r=Jn(e,2),i=r[0],o=r[1];n.setError(t,i,o).setEnd()}),_s.warn("UploadController._getAuthorizationKey failed. error:",t)})}},{key:"_initUploaderMethod",value:function(){var e=this;this.appid&&(this.cos=qa?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=qa?function(t,n){e.cos.postObject(t,n)}:function(t,n){e.cos.uploadFiles(t,n)})}},{key:"_getAuthorization",value:function(e,t){t({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"uploadImage",value:function(e){if(!e.file)return hp(new Ed({code:Td.MESSAGE_IMAGE_SELECT_FILE_FIRST,message:"请先选择一个图片"}));var t=this._checkImageType(e.file);if(!0!==t)return t;var n=this._checkImageMime(e.file);if(!0!==n)return n;var r=this._checkImageSize(e.file);if(!0!==r)return r;var i=null;return this.upload(e).then(function(e){return i=e,t="https://".concat(e.location),qa?new Promise(function(e,n){Ha.getImageInfo({src:t,success:function(t){e({width:t.width,height:t.height})},fail:function(){e({width:0,height:0})}})}):$a&&9===es?Promise.resolve({width:0,height:0}):new Promise(function(e,n){var r=new Image;r.onload=function(){e({width:this.width,height:this.height}),r=null},r.onerror=function(){e({width:0,height:0}),r=null},r.src=t});var t}).then(function(e){return i.width=e.width,i.height=e.height,Promise.resolve(i)})}},{key:"_checkImageType",value:function(e){var t="";return t=qa?e.url.slice(e.url.lastIndexOf(".")+1):e.files[0].name.slice(e.files[0].name.lastIndexOf(".")+1),Pd.indexOf(t.toLowerCase())>=0||hp(new Ed({coe:Td.MESSAGE_IMAGE_TYPES_LIMIT,message:"只允许上传 jpg png jpeg gif bmp格式的图片"}))}},{key:"_checkImageMime",value:function(e){return!0}},{key:"_checkImageSize",value:function(e){var t=0;return 0===(t=qa?e.size:e.files[0].size)?hp(new Ed({code:Td.MESSAGE_FILE_IS_EMPTY,message:"".concat(Id)})):t<20971520||hp(new Ed({coe:Td.MESSAGE_IMAGE_SIZE_LIMIT,message:"".concat("图片大小超过20M，无法发送")}))}},{key:"uploadFile",value:function(e){var t=null;return e.file?e.file.files[0].size>104857600?(t=new Ed({code:Td.MESSAGE_FILE_SIZE_LIMIT,message:Ad}),hp(t)):0===e.file.files[0].size?(t=new Ed({code:Td.MESSAGE_FILE_IS_EMPTY,message:"".concat(Id)}),hp(t)):this.upload(e):(t=new Ed({code:Td.MESSAGE_FILE_SELECT_FILE_FIRST,message:"请先选择一个文件"}),hp(t))}},{key:"uploadVideo",value:function(e){return e.file.videoFile.size>104857600?hp(new Ed({code:Td.MESSAGE_VIDEO_SIZE_LIMIT,message:"".concat("视频大小超过100M，无法发送")})):0===e.file.videoFile.size?hp(new Ed({code:Td.MESSAGE_FILE_IS_EMPTY,message:"".concat(Id)})):-1===Nd.indexOf(e.file.videoFile.type)?hp(new Ed({code:Td.MESSAGE_VIDEO_TYPES_LIMIT,message:"".concat("只允许上传 mp4 格式的视频")})):qa?this.handleVideoUpload({file:e.file.videoFile}):Ua?this.handleVideoUpload(e):void 0}},{key:"handleVideoUpload",value:function(e){var t=this;return new Promise(function(n,r){t.upload(e).then(function(e){n(e)}).catch(function(){t.upload(e).then(function(e){n(e)}).catch(function(){r(new Ed({code:Td.MESSAGE_VIDEO_UPLOAD_FAIL,message:"视频上传失败"}))})})})}},{key:"uploadAudio",value:function(e){return e.file?e.file.size>20971520?hp(new Ed({code:Td.MESSAGE_AUDIO_SIZE_LIMIT,message:"".concat("语音大小大于20M，无法发送")})):0===e.file.size?hp(new Ed({code:Td.MESSAGE_FILE_IS_EMPTY,message:"".concat(Id)})):this.upload(e):hp(new Ed({code:Td.MESSAGE_AUDIO_UPLOAD_FAIL,message:"语音上传失败"}))}},{key:"upload",value:function(e){var t=this;if(!Is(this._cosUploadMethod))return _s.warn("UploadController.upload 没有检测到上传插件，将无法发送图片、音频、视频、文件等类型的消息。详细请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#registerPlugin"),hp(new Ed({code:Td.COS_UNDETECTED,message:"未检测到 COS 上传插件"}));var n=new Cp("upload");_s.time("upload");var r=qa?e.file:e.file.files[0];return new Promise(function(i,o){var a=qa?t._createCosOptionsWXMiniApp(e):t._createCosOptionsWeb(e),s=t;t._cosUploadMethod(a,function(e,a){var u=Object.create(null);if(a){if(e||Ts(a.files)&&a.files[0].error){var l=new Ed({code:Td.MESSAGE_FILE_UPLOAD_FAIL,message:"文件上传失败"});return n.setError(l,!0,t.getNetworkType()).setEnd(),_s.log("UploadController.upload failed, error:",a.files[0].error),403===a.files[0].error.statusCode&&(_s.warn("UploadController.upload failed. cos AccessKeyId was invalid, regain auth key!"),t._getAuthorizationKey()),void o(l)}u.fileName=r.name,u.fileSize=r.size,u.fileType=r.type.slice(r.type.indexOf("/")+1).toLowerCase(),u.location=qa?a.Location:a.files[0].data.Location;var c=_s.timeEnd("upload"),d=s._formatFileSize(r.size),f=s._formatSpeed(1e3*r.size/c),p="size=".concat(d,",time=").concat(c,"ms,speed=").concat(f);return _s.log("UploadController.upload success name=".concat(r.name,",").concat(p)),i(u),void n.setNetworkType(t.getNetworkType()).setText(p).setEnd()}var h=new Ed({code:Td.MESSAGE_FILE_UPLOAD_FAIL,message:"文件上传失败"});n.setError(h,!0,s.getNetworkType()).setEnd(),_s.warn("UploadController.upload failed, error:",e),403===e.statusCode&&(_s.warn("UploadController.upload failed. cos AccessKeyId was invalid, regain auth key!"),t._getAuthorizationKey()),o(h)})})}},{key:"_formatFileSize",value:function(e){return e<1024?e+"B":e<1048576?Math.floor(e/1024)+"KB":Math.floor(e/1048576)+"MB"}},{key:"_formatSpeed",value:function(e){return e<=1048576?(e/1024).toFixed(1)+"KB/s":(e/1048576).toFixed(1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(e){var t=this.tim.context.identifier,n=this._genFileName(t,e.to,e.file.files[0].name);return{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),Body:e.file.files[0]}],SliceSize:1048576,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(e){_s.warn("onProgress callback error:",e),_s.error(e)}},onFileFinish:function(e,t,n){}}}},{key:"_createCosOptionsWXMiniApp",value:function(e){var t=this.tim.context.identifier,n=this._genFileName(t,e.to,e.file.name),r=e.file.url;return{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),FilePath:r,onProgress:function(t){if(_s.log(JSON.stringify(t)),"function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(e){_s.warn("onProgress callback error:",e),_s.error(e)}}}}},{key:"_genFileName",value:function(e,t,n){return"".concat(e,"-").concat(t,"-").concat(Fs(99999),"-").concat(n)}},{key:"reset",value:function(){this._timer&&(clearInterval(this._timer),this._timer=0)}}]),n}(up),lv=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;return Ln(this,n),(r=t.call(this,e)).FILETYPE={SOUND:2106,FILE:2107,VIDEO:2113},r._bdh_download_server="grouptalk.c2c.qq.com",r._BDHBizID=10001,r._authKey="",r._expireTime=0,r.tim.innerEmitter.on(lf,r._getAuthKey,Wn(r)),r}return Nn(n,[{key:"_getAuthKey",value:function(){var e=this;this.request({name:"bigDataHallwayAuthKey",action:"query"}).then(function(t){t.data.authKey&&(e._authKey=t.data.authKey,e._expireTime=parseInt(t.data.expireTime))})}},{key:"_isFromOlderVersion",value:function(e){return 2!==e.content.downloadFlag}},{key:"parseElements",value:function(e,t){if(!Ts(e)||!t)return[];for(var n=[],r=null,i=0;i<e.length;i++)r=e[i],this._needParse(r)?n.push(this._parseElement(r,t)):n.push(e[i]);return n}},{key:"_needParse",value:function(e){return!(!this._isFromOlderVersion(e)||e.type!==En.MSG_AUDIO&&e.type!==En.MSG_FILE&&e.type!==En.MSG_VIDEO)}},{key:"_parseElement",value:function(e,t){switch(e.type){case En.MSG_AUDIO:return this._parseAudioElement(e,t);case En.MSG_FILE:return this._parseFileElement(e,t);case En.MSG_VIDEO:return this._parseVideoElement(e,t)}}},{key:"_parseAudioElement",value:function(e,t){return e.content.url=this._genAudioUrl(e.content.uuid,t),e}},{key:"_parseFileElement",value:function(e,t){return e.content.url=this._genFileUrl(e.content.uuid,t,e.content.fileName),e}},{key:"_parseVideoElement",value:function(e,t){return e.content.url=this._genVideoUrl(e.content.uuid,t),e}},{key:"_genAudioUrl",value:function(e,t){return""===this._authKey?(_s.warn("BigDataHallwayController._genAudioUrl no authKey!"),""):"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(this.tim.context.SDKAppID,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.SOUND,"&openid=").concat(t,"&ver=0")}},{key:"_genFileUrl",value:function(e,t,n){return""===this._authKey?(_s.warn("BigDataHallwayController._genFileUrl no authKey!"),""):(n||(n="".concat(Math.floor(1e5*Math.random()),"-").concat(Date.now())),"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(this.tim.context.SDKAppID,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.FILE,"&openid=").concat(t,"&ver=0&filename=").concat(encodeURIComponent(n)))}},{key:"_genVideoUrl",value:function(e,t){return""===this._authKey?(_s.warn("BigDataHallwayController._genVideoUrl no authKey!"),""):"https://".concat(this._bdh_download_server,"/asn.com/stddownload_common_file?authkey=").concat(this._authKey,"&bid=").concat(this._BDHBizID,"&subbid=").concat(this.tim.context.SDKAppID,"&fileid=").concat(e,"&filetype=").concat(this.FILETYPE.VIDEO,"&openid=").concat(t,"&ver=0")}},{key:"reset",value:function(){this._authKey="",this.expireTime=0}}]),n}(up);function cv(e){return e=window.localStorage?localStorage.getItem(e)||sessionStorage.getItem(e):(e=document.cookie.match(new RegExp("(?:^|;\\s)"+e+"=(.*?)(?:;\\s|$)")))?e[1]:""}function dv(e,t,n){if(window.localStorage)try{n?localStorage.setItem(e,t):sessionStorage.setItem(e,t)}catch(e){}else document.cookie=e+"="+t+";path=/;domain="+function(){var e=window.location.host,t=e.split(".");return 2<t.length&&(e=({"com.cn":1,"js.cn":1,"net.cn":1,"gov.cn":1,"com.hk":1,"co.nz":1}[t.slice(-2).join(".")]?t.slice(-3):t.slice(-2)).join(".")),e}()+(n?";expires="+n:"")}function fv(e,t){var n,r={};if(void 0===t)var i=window.location,o=i.host,a=i.pathname,s=i.search.substr(1),u=i.hash;else o=(i=t.match(/\w+:\/\/((?:[\w-]+\.)+\w+)(?::\d+)?(\/[^\?\\"'\|:<>]*)?(?:\?([^'"\\<>#]*))?(?:#(\w+))?/i)||[])[1],a=i[2],s=i[3],u=i[4];return void 0!==u&&(u=u.replace(/"|'|<|>/gi,"M")),s&&function(){for(var e=s.split("&"),t=0,n=e.length;t<n;t++)if(-1!=e[t].indexOf("=")){var i=e[t].indexOf("="),o=e[t].slice(0,i);i=e[t].slice(i+1),r[o]=i}}(),s=function(){if(void 0===s)return s;for(var t=s.split("&"),n=[],r=0,i=t.length;r<i;r++)if(-1!=t[r].indexOf("=")){var o=t[r].indexOf("="),a=t[r].slice(0,o);o=t[r].slice(o+1),e.ignoreParams&&-1!=e.ignoreParams.indexOf(a)||n.push(a+"="+o)}return n.join("&")}(),u&&function(){for(var e=0==u.indexOf("#")?u.substr(1).split("&"):u.split("&"),t=0,r=e.length;t<r;t++)if(-1!=e[t].indexOf("=")){var i=e[t].indexOf("="),o=e[t].slice(0,i);if(i=e[t].slice(i+1),"adtag"===o.toLowerCase()){n=i;break}}}(),{host:o,path:a,search:s,hash:u,param:r,adtag:n}}function pv(e){var t,n=fv(e),r={dm:n.host,pvi:"",si:"",url:n.path,arg:encodeURIComponent(n.search||"").substr(0,512),ty:0};return r.pvi=function(){var t=new Date((new Date).getTime()+63072e6).toGMTString();if(e.userReport){var n=cv("pgv_uid");n&&n==e.user.user_id||(r.ty=1,dv("pgv_uid",e.user.user_id,t)),n=e.user.user_id}else(n=cv("pgv_pvi"))||(r.ty=1,dv("pgv_pvi",n=hv(),t));return n}(),r.si=((t=cv("pgv_si"))||dv("pgv_si",t=hv("s")),t),r.url=function(){var t=n.path;return e.senseQuery&&(t+=n.search?"?"+encodeURIComponent(n.search||"").substr(0,512):""),e.senseHash&&(t+=n.hash?encodeURIComponent(n.hash):""),t}(),r}function hv(e){for(var t=[0,1,2,3,4,5,6,7,8,9],n=10;1<n;n--){var r=Math.floor(10*Math.random()),i=t[r];t[r]=t[n-1],t[n-1]=i}for(n=r=0;5>n;n++)r=10*r+t[n];return(e||"")+(r+"")+ +new Date}function gv(e){return{r2:e.sid}}function vv(e){var t={};if(e){var n,r=[];for(n in e)e.hasOwnProperty(n)&&r.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));e=r.join(";"),t.ext=e}return t}function mv(e){var t=fv(e,document.referrer);return e=fv(e),{rdm:t.host,rurl:t.path,rarg:encodeURIComponent(t.search||"").substr(0,512),adt:e.param.ADTAG||e.param.adtag||e.param.CKTAG||e.param.cktag||e.param.PTAG||e.param.ptag||e.adtag}}function yv(){try{var e=navigator,t=screen||{width:"",height:"",colorDepth:""},n={scr:t.width+"x"+t.height,scl:t.colorDepth+"-bit",lg:(e.language||e.userLanguage).toLowerCase(),tz:(new Date).getTimezoneOffset()/60}}catch(e){return{}}return n}var _v={conf:{},version:"2.0.19",init:function(e){var t={sid:0,cid:0,autoReport:0,senseHash:0,senseQuery:0,userReport:0,performanceMonitor:0,ignoreParams:[]};if(e)for(var n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)&&(t[n]=e[n]);this.conf=t,this.conf.autoReport&&this.pgv()},pgv:function(){var e=this.conf,t=[],n=this.version;if(e.sid)if(!e.userReport||e.user&&e.user.user_id&&!parseInt(e.user.user_id,10)!==conf.user.user_id){for(var r=0,i=[pv(e),mv(e),gv(e),yv(),vv({version:n}),{random:+new Date}],o=i.length;r<o;r++)for(var a in i[r])i[r].hasOwnProperty(a)&&t.push(a+"="+(void 0===i[r][a]?"":i[r][a]));var s=function(e){e="https://pingtas.qq.com/webview/pingd?"+e.join("&").toLowerCase();var t=new Image;t.onload=t.onerror=t.onabort=function(){t=t.onload=t.onerror=t.onabort=null},t.src=e};s(t),e.performanceMonitor&&(t=function(){for(var t=function(){if(window.performance){var e=window.performance.timing,t={value:e.domainLookupEnd-e.domainLookupStart},n={value:e.connectEnd-e.connectStart},r={value:e.responseStart-(e.requestStart||e.responseStart+1)},i=e.responseEnd-e.responseStart;e.domContentLoadedEventStart?0>i&&(i=0):i=-1,e={domainLookupTime:t,connectTime:n,requestTime:r,resourcesLoadedTime:{value:i},domParsingTime:{value:e.domContentLoadedEventStart?e.domInteractive-e.domLoading:-1},domContentLoadedTime:{value:e.domContentLoadedEventStart?e.domContentLoadedEventStart-e.fetchStart:-1}}}else e="";return e}(),r=[],i=[],o=0,a=[pv(e),{r2:e.cid},yv(),{random:+new Date}],u=a.length;o<u;o++)for(var l in a[o])a[o].hasOwnProperty(l)&&i.push(l+"="+(void 0===a[o][l]?"":a[o][l]));for(l in t)t.hasOwnProperty(l)&&("domContentLoadedTime"==l?i.push("r3="+t[l].value):r.push(t[l].value));t=vv({pfm:r.join("_"),version:n}),i.push("ext="+t.ext),s(i)},void 0!==window.performance&&void 0!==window.performance.timing&&0!=window.performance.timing.loadEventEnd?t():window.attachEvent?window.attachEvent("onload",t):window.addEventListener&&window.addEventListener("load",t,!1))}else console.log("MTA H5分析错误提示：您选择了用户统计uv，请设置业务的user_id，需为int类型");else console.log("MTA H5分析错误提示：您没有设置sid")},clickStat:function(e,t){var n=this.conf,r=[],i=pv(n),o=gv(n);if(n.cid){i.dm="taclick",i.url=e,o.r2=n.cid,o.r5=function(e){e=void 0===e?{}:e;var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t+"="+encodeURIComponent(e[t]));return n.join(";")}(t);var a=0;for(i=(n=[i,mv(n),o,yv(),vv({version:this.version}),{random:+new Date}]).length;a<i;a++)for(var s in n[a])n[a].hasOwnProperty(s)&&r.push(s+"="+(void 0===n[a][s]?"":n[a][s]));r="https://pingtas.qq.com/webview/pingd?"+r.join("&");var u=new Image;u.onload=u.onerror=u.onabort=function(){u=u.onload=u.onerror=u.onabort=null},u.src=r}else console.log("MTA H5分析错误提示：您没有设置cid,请到管理台开通自定义事件并更新统计代码")},clickShare:function(e){var t,n,r=this.conf,i=fv(r),o=void 0===(i=i.param.CKTAG||i.param.ckatg)?[]:i.split(".");if(r.cid){i=[];var a=pv(r),s=gv(r);for(a.dm="taclick_share",a.url="mtah5-share-"+e,s.r2=r.cid,s.r5=(n=[],2===(t=o).length&&"mtah5_share"==t[0]&&n.push(t[0]+"="+t[1]),n.join(";")),e=0,a=(r=[a,mv(r),s,yv(),vv({version:this.version}),{random:+new Date}]).length;e<a;e++)for(var u in r[e])r[e].hasOwnProperty(u)&&i.push(u+"="+(void 0===r[e][u]?"":r[e][u]));u="https://pingtas.qq.com/webview/pingd?"+i.join("&");var l=new Image;l.onload=l.onerror=l.onabort=function(){l=l.onload=l.onerror=l.onabort=null},l.src=u}else console.log("MTA H5分析错误提示：您没有设置cid,请到管理台开通自定义事件并更新统计代码")}},bv=function(){function e(){Ln(this,e);try{_v.init({sid:"500690998",cid:"500691017",autoReport:0,senseHash:0,senseQuery:0,performanceMonitor:0,ignoreParams:[]})}catch(e){}}return Nn(e,[{key:"report",value:function(e,t){try{_v.clickStat(e,t)}catch(e){}}},{key:"stat",value:function(){try{_v.pgv()}catch(e){}}}]),e}(),Sv=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;Ln(this,n),(r=t.call(this,e)).MTA=new bv;var i=r.tim.innerEmitter;return i.on(Yf,r._stat,Wn(r)),i.on(Wf,r._stat,Wn(r)),r}return Nn(n,[{key:"_stat",value:function(){this.MTA.report("sdkappid",{value:this.tim.context.SDKAppID}),this.MTA.report("version",{value:"2.8.5"}),this.MTA.stat()}}]),n}(up),kv=function(){function e(t){Ln(this,e),this._table="timwebii",this._report=[]}return Nn(e,[{key:"pushIn",value:function(e){_s.debug("SSOLogBody.pushIn",this._report.length,e),this._report.push(e)}},{key:"backfill",value:function(e){var t;Ts(e)&&0!==e.length&&(_s.debug("SSOLogBody.backfill",this._report.length,e.length),(t=this._report).unshift.apply(t,Xn(e)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return 0===this._report.length}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getTable",value:function(){return this._table}},{key:"getLogsInMemory",value:function(){var e=this._report.slice();return this._reset(),e}}]),e}(),wv=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;return Ln(this,n),(r=t.call(this,e)).TAG="im-ssolog-event",r._reportBody=new kv,r._version="2.8.5",r.MIN_THRESHOLD=20,r.MAX_THRESHOLD=100,r.WAITING_TIME=6e4,r.INTERVAL=2e4,r._timerID=0,r._resetLastReportTime(),r._startReportTimer(),r._retryCount=0,r.MAX_RETRY_COUNT=3,r.tim.innerEmitter.on(Uf,r._onLoginSuccess,Wn(r)),r}return Nn(n,[{key:"reportAtOnce",value:function(){_s.debug("EventStatController.reportAtOnce"),this._report()}},{key:"_onLoginSuccess",value:function(){var e=this,t=this.tim.storage,n=t.getItem(this.TAG,!1);!nu(n)&&Is(n.forEach)&&(_s.log("EventStatController._onLoginSuccess get ssolog in storage, nums="+n.length),n.forEach(function(t){e._reportBody.pushIn(t)}),t.removeItem(this.TAG,!1))}},{key:"pushIn",value:function(e){e instanceof Cp&&(e.setCommonInfo({SDKAppID:this.tim.context.SDKAppID,version:this._version,tinyID:this.tim.context.tinyID,userID:this.tim.loginInfo.identifier,platform:this.getPlatform(),scene:this.tim.context.scene,instanceID:this.tim.context.instanceID}),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{key:"_resetLastReportTime",value:function(){this._lastReportTime=Date.now()}},{key:"_startReportTimer",value:function(){var e=this;this._timerID=setInterval(function(){Date.now()<e._lastReportTime+e.WAITING_TIME||e._reportBody.isEmpty()||e._report()},this.INTERVAL)}},{key:"_stopReportTimer",value:function(){this._timerID>0&&(clearInterval(this._timerID),this._timerID=0)}},{key:"_report",value:function(){var e=this;if(!this._reportBody.isEmpty()){var t=this._reportBody.getLogsInMemory();this.request({name:"ssoEventStat",action:"create",param:{table:this._reportBody.getTable(),report:t}}).then(function(){e._resetLastReportTime(),e._retryCount>0&&(_s.debug("EventStatController.report retry success"),e._retryCount=0)}).catch(function(n){if(_s.warn("EventStatController.report, networkType:".concat(e.getNetworkType()," error:").concat(Ps(n))),e._reportBody.backfill(t),e._reportBody.getLogsNumInMemory()>e.MAX_THRESHOLD||e._retryCount===e.MAX_RETRY_COUNT||0===e._timerID)return e._retryCount=0,void e._flushAtOnce();e._retryCount+=1})}}},{key:"_flushAtOnce",value:function(){var e=this.tim.storage,t=e.getItem(this.TAG,!1),n=this._reportBody.getLogsInMemory();if(nu(t))_s.log("EventStatController._flushAtOnce nums="+n.length),e.setItem(this.TAG,n,!0,!1);else{var r=n.concat(t);r.length>this.MAX_THRESHOLD&&(r=r.slice(0,this.MAX_THRESHOLD)),_s.log("EventStatController._flushAtOnce nums="+r.length),e.setItem(this.TAG,r,!0,!1)}}},{key:"reset",value:function(){_s.log("EventStatController.reset"),this._stopReportTimer(),this._report()}}]),n}(up),Ev="none",Tv="online",xv=function(){function e(){Ln(this,e),this._networkType="",this.maxWaitTime=3e3}return Nn(e,[{key:"start",value:function(){var e=this;qa?(Ha.getNetworkType({success:function(t){e._networkType=t.networkType,t.networkType===Ev?_s.warn("NetMonitor no network, please check!"):_s.info("NetMonitor networkType:".concat(t.networkType))}}),Ha.onNetworkStatusChange(this._onNetworkStatusChange.bind(this))):this._networkType=Tv}},{key:"_onNetworkStatusChange",value:function(e){this._networkType=e.networkType,e.isConnected?_s.info("NetMonitor networkType:".concat(e.networkType)):_s.warn("NetMonitor no network, please check!")}},{key:"probe",value:function(){var e=this;return new Promise(function(t,n){if(qa)Ha.getNetworkType({success:function(n){e._networkType=n.networkType,n.networkType===Ev?(_s.warn("NetMonitor no network, please check!"),t([!1,n.networkType])):(_s.info("NetMonitor networkType:".concat(n.networkType)),t([!0,n.networkType]))}});else if(window&&window.fetch)fetch("".concat(qs(),"//webim-1252463788.file.myqcloud.com/assets/test/speed.xml?random=").concat(Math.random())).then(function(e){e.ok?t([!0,Tv]):t([!1,Ev])}).catch(function(e){t([!1,Ev])});else{var r=new XMLHttpRequest,i=setTimeout(function(){_s.warn("NetMonitor fetch timeout. Probably no network, please check!"),r.abort(),e._networkType=Ev,t([!1,Ev])},e.maxWaitTime);r.onreadystatechange=function(){4===r.readyState&&(clearTimeout(i),200===r.status||304===r.status?(this._networkType=Tv,t([!0,Tv])):(_s.warn("NetMonitor fetch status:".concat(r.status,". Probably no network, please check!")),this._networkType=Ev,t([!1,Ev])))},r.open("GET","".concat(qs(),"//webim-1252463788.file.myqcloud.com/assets/test/speed.xml?random=").concat(Math.random())),r.send()}})}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){this._networkType=""}}]),e}(),Cv=function(){function e(t){var n=this;Ln(this,e),Ts(t)?(this._map=new Map,t.forEach(function(e){n._map.set(e,[])})):_s.warn("AverageCalculator.constructor need keys")}return Nn(e,[{key:"push",value:function(e,t){return!(xs(e)||!this._map.has(e)||!Ss(t)||(this._map.get(e).push(t),0))}},{key:"getSize",value:function(e){return xs(e)||!this._map.has(e)?-1:this._map.get(e).length}},{key:"getAvg",value:function(e){if(xs(e)||!this._map.has(e))return-1;var t=this._map.get(e),n=t.length;if(0===n)return 0;var r=0;return t.forEach(function(e){r+=e}),t.length=0,this._map.set(e,[]),parseInt(r/n)}},{key:"getMax",value:function(e){return xs(e)||!this._map.has(e)?-1:Math.max.apply(null,this._map.get(e))}},{key:"getMin",value:function(e){return xs(e)||!this._map.has(e)?-1:Math.min.apply(null,this._map.get(e))}},{key:"reset",value:function(){this._map.forEach(function(e){e.length=0})}}]),e}(),Iv=function(){function e(t){var n=this;Ln(this,e),Ts(t)?(this._map=new Map,t.forEach(function(e){n._map.set(e,{totalCount:0,successCount:0})})):_s.warn("SuccessRateCalculator.constructor need keys")}return Nn(e,[{key:"addTotalCount",value:function(e){return!(xs(e)||!this._map.has(e)||(this._map.get(e).totalCount+=1,0))}},{key:"addSuccessCount",value:function(e){return!(xs(e)||!this._map.has(e)||(this._map.get(e).successCount+=1,0))}},{key:"getSuccessRate",value:function(e){if(xs(e)||!this._map.has(e))return-1;var t=this._map.get(e);if(0===t.totalCount)return 1;var n=parseFloat((t.successCount/t.totalCount).toFixed(2));return n>1&&(n=1),t.totalCount=t.successCount=0,n}},{key:"getTotalCount",value:function(e){return xs(e)||!this._map.has(e)?-1:this._map.get(e).totalCount}},{key:"reset",value:function(){this._map.forEach(function(e){e.totalCount=0,e.successCount=0})}}]),e}(),Rv=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;return Ln(this,n),(r=t.call(this,e)).TABLE="timwebsum",r.TAG="im-ssolog-sumstat",r._items=[vp,mp,yp,_p,bp,Sp,kp,wp,Ep,Tp],r._thresholdMap=new Map,r._thresholdMap.set(vp,100),r._thresholdMap.set(mp,150),r._thresholdMap.set(yp,15),r._thresholdMap.set(_p,6),r._thresholdMap.set(bp,6),r._thresholdMap.set(Sp,6),r._thresholdMap.set(kp,6),r._thresholdMap.set(wp,6),r._thresholdMap.set(Ep,50),r._thresholdMap.set(Tp,50),r._lpID="",r._platform=r.getPlatform(),r._lastReportTime=0,r._statInfoArr=[],r._retryCount=0,r._avgCalc=new Cv(r._items),r._successRateCalc=new Iv(r._items),r.tim.innerEmitter.on(Uf,r._onLoginSuccess,Wn(r)),r}return Nn(n,[{key:"_onLoginSuccess",value:function(){var e=this,t=this.tim.storage,n=t.getItem(this.TAG,!1);!nu(n)&&Is(n.forEach)&&(_s.log("SumStatController._onLoginSuccess get sumstatlog in storage, nums="+n.length),n.forEach(function(t){e._statInfoArr.push(t)}),t.removeItem(this.TAG,!1))}},{key:"recordLongPollingID",value:function(e){this._lpID=e}},{key:"addTotalCount",value:function(e){this._successRateCalc.addTotalCount(e)?1===this._successRateCalc.getTotalCount(e)&&(this._lastReportTime=Date.now()):_s.warn("SumStatController.addTotalCount invalid key:",e)}},{key:"addSuccessCount",value:function(e){this._successRateCalc.addSuccessCount(e)||_s.warn("SumStatController.addSuccessCount invalid key:",e)}},{key:"addCost",value:function(e,t){this._avgCalc.push(e,t)?(_s.debug("SumStatController.addCost",e,t,this._avgCalc.getSize(e)),this._avgCalc.getSize(e)>=this._thresholdMap.get(e)&&this._report(e)):_s.warn("SumStatController.addCost invalid key or cost:",e,t)}},{key:"_getItemNum",value:function(e){switch(e){case vp:return 1;case mp:return 2;case yp:return 3;case Ep:return 4;case Tp:return 5;case _p:return 6;case bp:return 7;case Sp:return 8;case kp:return 9;case wp:return 10;default:return 100}}},{key:"_getStatInfo",value:function(e){var t=null;return this._avgCalc.getSize(e)>0&&(t={SDKAppID:"".concat(this.tim.context.SDKAppID),version:"".concat("2.8.5"),tinyID:this.tim.context.tinyID,userID:this.tim.loginInfo.identifier,item:this._getItemNum(e),lpID:e===vp?this._lpID:"",platform:this._platform,scene:this.tim.context.scene,networkType:this.getNetworkType(),total:this._successRateCalc.getTotalCount(e),successRate:this._successRateCalc.getSuccessRate(e),avg:this._avgCalc.getAvg(e),timespan:Date.now()-this._lastReportTime,time:Ns()}),t}},{key:"_report",value:function(e){var t=this,n=[],r=null;xs(e)?this._items.forEach(function(e){null!==(r=t._getStatInfo(e))&&n.push(r)}):null!==(r=this._getStatInfo(e))&&n.push(r),_s.debug("SumStatController._report",n),this._statInfoArr.length>0&&(n=n.concat(this.statInfoArr),this._statInfoArr=[]),this._doReport(n)}},{key:"_doReport",value:function(e){var t=this;nu(e)?_s.warn("SumStatController._doReport statInfoArr is empty, do nothing"):this.request({name:"ssoSumStat",action:"create",param:{table:this.TABLE,report:e}}).then(function(){t._lastReportTime=Date.now(),t._retryCount>0&&(_s.debug("SumStatController._doReport retry success"),t._retryCount=0)}).catch(function(n){_s.warn("SumStatController._doReport, online:".concat(t.getNetworkType()," error:").concat(Ps(n)),e),t._retryCount<=1?setTimeout(function(){_s.info("SumStatController._doReport retry",e),t._retryCount+=1,t._doReport(e)},5e3):(t._retryCount=0,t._statInfoArr=t._statInfoArr.concat(e),t._flushAtOnce())})}},{key:"_flushAtOnce",value:function(){var e=this.tim.storage,t=e.getItem(this.TAG,!1),n=this._statInfoArr;if(nu(t))_s.log("SumStatController._flushAtOnce nums="+n.length),e.setItem(this.TAG,n,!0,!1);else{var r=n.concat(t);r.length>10&&(r=r.slice(0,10)),_s.log("SumStatController._flushAtOnce nums="+r.length),e.setItem(this.TAG,r,!0,!1)}this._statInfoArr=[]}},{key:"reset",value:function(){_s.info("SumStatController.reset"),this._report(),this._avgCalc.reset(),this._successRateCalc.reset()}}]),n}(up),Av=function(){function e(){Ln(this,e),this._funcMap=new Map}return Nn(e,[{key:"defense",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if("string"!=typeof e)return null;if(0===e.length)return null;if("function"!=typeof t)return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);var r=null;return this._funcMap.get(e).has(t)?r=this._funcMap.get(e).get(t):(r=this._pack(e,t,n),this._funcMap.get(e).set(t,r)),r}},{key:"defenseOnce",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return"function"!=typeof t?null:this._pack(e,t,n)}},{key:"find",value:function(e,t){return"string"!=typeof e||0===e.length||"function"!=typeof t?null:this._funcMap.has(e)?this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(_s.log("SafetyCallback.find: 找不到 func —— ".concat(e,"/").concat(""!==t.name?t.name:"[anonymous]")),null):(_s.log("SafetyCallback.find: 找不到 eventName-".concat(e," 对应的 func")),null)}},{key:"delete",value:function(e,t){return"function"==typeof t&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),0===this._funcMap.get(e).size&&this._funcMap.delete(e),!0)}},{key:"_pack",value:function(e,t,n){return function(){try{t.apply(n,Array.from(arguments))}catch(t){var r=Object.values(wn).indexOf(e);if(-1!==r){var i=Object.keys(wn)[r];_s.warn("接入侧事件 TIM.EVENT.".concat(i," 对应的回调函数逻辑存在问题，请检查！"),t)}var o=new Cp("callbackFunctionError");o.setText("eventName=".concat(e)).setMessage(t.message).setEnd()}}}}]),e}(),Ov=function(e){Gn(n,e);var t=Yn(n);function n(e){var r;return Ln(this,n),(r=t.call(this,e))._maybeLostSequencesMap=new Map,r}return Nn(n,[{key:"onMessageMaybeLost",value:function(e,t,n){this._maybeLostSequencesMap.has(e)||this._maybeLostSequencesMap.set(e,[]);for(var r=this._maybeLostSequencesMap.get(e),i=0;i<n;i++)r.push(t+i);_s.debug("MessageLossController.onMessageMaybeLost. maybeLostSequences:".concat(r))}},{key:"detectMessageLoss",value:function(e,t){var n=this._maybeLostSequencesMap.get(e);if(!nu(n)&&!nu(t)){var r=t.filter(function(e){return-1!==n.indexOf(e)});if(_s.debug("MessageLossController.detectMessageLoss. matchedSequences:".concat(r)),n.length===r.length)_s.info("MessageLossController.detectMessageLoss no message loss. conversationID=".concat(e));else{var i,o=n.filter(function(e){return-1===r.indexOf(e)}),a=o.length;a<=5?i=e+"-"+o.join("-"):(o.sort(function(e,t){return e-t}),i=e+" start:"+o[0]+" end:"+o[a-1]+" count:"+a),new Cp("messageLoss").setText(i).setNetworkType(this.getNetworkType()).setEnd(),_s.warn("MessageLossController.detectMessageLoss message loss detected. conversationID:".concat(e," lostSequences:").concat(o))}n.length=0}}},{key:"reset",value:function(){_s.log("MessageLossController.reset"),this._maybeLostSequencesMap.clear()}}]),n}(up),Mv=function(e){Gn(r,e);var t,n=Yn(r);function r(e){var t;return Ln(this,r),(t=n.call(this,e))._request=qa?new Hh:new qh,t}return Nn(r,[{key:"sendMessage",value:(t=Dn(regeneratorRuntime.mark(function e(t){var n,r,i,o,a,s,u,l,c,d,f,p,h,g,v,m,y,_,b;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=this._constructMessageInstance(t))){e.next=3;break}return e.abrupt("return",hp({code:Td.MESSAGE_SEND_FAIL,message:xd}));case 3:return r=Date.now(),i=nu(t.GroupId)?"openim/sendmsg":"group_open_http_svc/send_group_msg",o=this.tim.context,a=o.a2Key,s=o.tinyID,u=o.SDKAppID,l=o.identifier,c=!0===this.tim.context.oversea?"api.im.qcloud.com":"webim.tim.qq.com",d="https://"+c+"/v4/"+i+"?platform=10&websdkappid=537048168&v=1.7.3&a2="+a+"&tinyid="+s+"&sdkappid="+u+"&contentType=json&apn=1&reqtime="+Date.now()+"tjg_id="+this._generateTjgID(n),f={url:d,data:t,method:"POST"},this._addSendMessageTotalCount(n),(p=new Cp("sendComboMessage")).setText("".concat(this._generateTjgID(n),"-").concat(n.from,"-").concat(n.to,"-").concat(n.getElements().length)),e.prev=12,e.next=15,this._request.request(f);case 15:if(h=e.sent,g=h.data,v=g.ErrorCode,m=g.ErrorInfo,0===v){e.next=21;break}return p.setCode(v).setMessage(m).setNetworkType(this.getNetworkType()).setEnd(),n.status=Ju.FAIL,e.abrupt("return",hp(new Ed({code:v,message:m||xd,data:{message:n}})));case 21:return this._addSendMessageSuccessCount(n,r),n.status=Ju.SUCCESS,y=h.data,_=y.MsgTime,b=y.MsgSeq,n.time=_,b&&(n.sequence=b),n.generateMessageID(l),this.tim.messageController.pushToMessageList(n),this.emitInnerEvent(pf,{eventDataList:[{conversationID:n.conversationID,unreadCount:0,type:n.conversationType,subType:n.conversationSubType,lastMessage:n}]}),e.abrupt("return",pp(n));case 32:return e.prev=32,e.t0=e.catch(12),this.probeNetwork().then(function(t){var n=Jn(t,2),r=n[0],i=n[1];p.setError(e.t0,r,i).setEnd()}),_s.warn("ComboMessageController.sendMessage failed. error:",e.t0),n.status=Ju.FAIL,e.abrupt("return",hp(new Ed({code:Td.MESSAGE_SEND_FAIL,message:xd,data:{message:n}})));case 38:case"end":return e.stop()}},e,this,[[12,32]])})),function(e){return t.apply(this,arguments)})},{key:"_constructMessageInstance",value:function(e){var t=null;try{var n=this.tim.context.identifier,r={};r.currentUser=n,r.from=e.From_Account||n,e.GroupId?(r.conversationID="".concat(En.CONV_GROUP).concat(e.GroupId),r.conversationType=En.CONV_GROUP,r.to=e.GroupId):e.To_Account&&(r.conversationID="".concat(En.CONV_C2C).concat(e.To_Account),r.conversationType=En.CONV_C2C,r.to=e.To_Account),r.time=e.MsgTimeStamp||0,r.random=e.Random||e.MsgRandom||0,r.priority=e.MsgPriority,(t=new Vd(r)).status=Ju.UNSEND;for(var i,o=e.MsgBody.length,a=0;a<o;a++)"TIMTextElem"===(i=e.MsgBody[a]).MsgType?t.setTextElement(i.MsgContent.Text):"TIMCustomElem"===i.MsgType?t.setCustomElement({data:i.MsgContent.Data||"",description:i.MsgContent.Desc||"",extension:i.MsgContent.Ext||""}):"TIMFaceElem"===i.MsgType&&t.setFaceElement({index:i.MsgContent.Index,data:i.MsgContent.Data});var s=t.getElements();t.payload=s[0].content,t.type=s[0].type}catch(e){t=null,_s.error("ComboMessageController._constructMessageInstance failed. error:",e)}return t}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n=this.tim.sumStatController,r=Math.abs(Date.now()-t);n.addSuccessCount(yp),n.addCost(yp,r);var i=this._getSendMessageSpecifiedKey(e);i&&(n.addSuccessCount(i),n.addCost(i,r))}},{key:"_addSendMessageTotalCount",value:function(e){var t=this.tim.sumStatController;t.addTotalCount(yp);var n=this._getSendMessageSpecifiedKey(e);n&&t.addTotalCount(n)}},{key:"_getSendMessageSpecifiedKey",value:function(e){if(e.conversationType===En.CONV_C2C)return _p;if(e.conversationType===En.CONV_GROUP){var t=this.tim.groupController.getLocalGroupProfile(e.to);if(!t)return;var n=t.type;if(Ks(n))return bp;if(Ws(n))return Sp;if(Ys(n))return kp;if(Js(n))return wp}}},{key:"_generateTjgID",value:function(e){return this.tim.context.tinyID+"-"+e.random}},{key:"reset",value:function(){_s.info("ComboMessageController.reset")}}]),r}(up),Dv=function(){function e(t){Ln(this,e);var n=new Cp(Ip);sp.mixin(this),this._initOptions(t),this._initMemberVariables(),this._initControllers(),this._initListener(),Cp.bindController(this.eventStatController),n.setText("instanceID=".concat(this.loginInfo.instanceID,"-oversea=").concat(this.loginInfo.oversea,"-mp=").concat(qa,"-ua=").concat(Ka)).setEnd(),_s.info("SDK instanceID:".concat(this.loginInfo.instanceID," oversea:").concat(this.loginInfo.oversea," inMiniApp:").concat(qa,", SDKAppID:").concat(t.SDKAppID,", UserAgent:").concat(Ka)),this._safetyCallbackFactory=new Av}var t;return Nn(e,[{key:"login",value:function(e){return _s.time(gp),this._ssoLog=new Cp("sdkReady"),this.netMonitor.start(),this.loginInfo.identifier=e.identifier||e.userID,this.loginInfo.userSig=e.userSig,this.signController.login(this.loginInfo)}},{key:"logout",value:function(){var e=this.signController.logout();return this.resetSDK(),e}},{key:"on",value:function(e,t,n){e===wn.GROUP_SYSTEM_NOTICE_RECEIVED&&_s.warn("！！！TIM.EVENT.GROUP_SYSTEM_NOTICE_RECEIVED v2.6.0起弃用，为了更好的体验，请在 TIM.EVENT.MESSAGE_RECEIVED 事件回调内接收处理群系统通知，详细请参考：https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/Message.html#.GroupSystemNoticePayload"),_s.debug("on","eventName:".concat(e)),this.outerEmitter.on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"once",value:function(e,t,n){_s.debug("once","eventName:".concat(e)),this.outerEmitter.once(e,this._safetyCallbackFactory.defenseOnce(e,t,n),n||this)}},{key:"off",value:function(e,t,n,r){_s.debug("off","eventName:".concat(e));var i=this._safetyCallbackFactory.find(e,t);null!==i&&(this.outerEmitter.off(e,i,n,r),this._safetyCallbackFactory.delete(e,t))}},{key:"registerPlugin",value:function(e){var t=this;this.plugins||(this.plugins={}),Object.keys(e).forEach(function(n){t.plugins[n]=e[n]}),new Cp("registerPlugin").setText("key=".concat(Object.keys(e))).setEnd()}},{key:"getPlugin",value:function(e){return this.plugins[e]||void 0}},{key:"setLogLevel",value:function(e){e<=0&&(console.log([""," ________  ______  __       __  __       __  ________  _______","|        \\|      \\|  \\     /  \\|  \\  _  |  \\|        \\|       \\"," \\$$$$$$$$ \\$$$$$$| $$\\   /  $$| $$ / \\ | $$| $$$$$$$$| $$$$$$$\\","   | $$     | $$  | $$$\\ /  $$$| $$/  $\\| $$| $$__    | $$__/ $$","   | $$     | $$  | $$$$\\  $$$$| $$  $$$\\ $$| $$  \\   | $$    $$","   | $$     | $$  | $$\\$$ $$ $$| $$ $$\\$$\\$$| $$$$$   | $$$$$$$\\","   | $$    _| $$_ | $$ \\$$$| $$| $$$$  \\$$$$| $$_____ | $$__/ $$","   | $$   |   $$ \\| $$  \\$ | $$| $$$    \\$$$| $$     \\| $$    $$","    \\$$    \\$$$$$$ \\$$      \\$$ \\$$      \\$$ \\$$$$$$$$ \\$$$$$$$","",""].join("\n")),console.log("%cIM 智能客服，随时随地解决您的问题 →_→ https://cloud.tencent.com/act/event/smarty-service?from=im-doc","color:#ff0000"),console.log(["","参考以下文档，会更快解决问题哦！(#^.^#)\n","SDK 更新日志: https://cloud.tencent.com/document/product/269/38492\n","SDK 接口文档: https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html\n","常见问题: https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/tutorial-01-faq.html\n","反馈问题？戳我提 issue: https://github.com/tencentyun/TIMSDK/issues\n","如果您需要在生产环境关闭上面的日志，请 tim.setLogLevel(1)\n"].join("\n"))),_s.setLevel(e)}},{key:"destroy",value:function(){var e=this;return this.logout().finally(function(){e.outerEmitter.emit(wn.SDK_DESTROY,{SDKAppID:e.loginInfo.SDKAppID})})}},{key:"createTextMessage",value:function(e){return this.messageController.createTextMessage(e)}},{key:"createImageMessage",value:function(e){return this.messageController.createImageMessage(e)}},{key:"createAudioMessage",value:function(e){return this.messageController.createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){return this.messageController.createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){return this.messageController.createCustomMessage(e)}},{key:"createFaceMessage",value:function(e){return this.messageController.createFaceMessage(e)}},{key:"createFileMessage",value:function(e){return this.messageController.createFileMessage(e)}},{key:"sendMessage",value:function(e,t){return e instanceof Vd?this.messageController.sendMessageInstance(e,t):hp(new Ed({code:Td.MESSAGE_SEND_NEED_MESSAGE_INSTANCE,message:"需要 Message 的实例"}))}},{key:"callExperimentalAPI",value:(t=Dn(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("sendComboMessage"!==t){e.next=4;break}return e.next=3,this.comboMessageController.sendMessage(n);case 3:return e.abrupt("return",e.sent);case 4:return e.abrupt("return",hp(new Ed({code:Td.INVALID_OPERATION,message:"无效操作，如调用了未定义或者未实现的方法等"})));case 5:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})},{key:"revokeMessage",value:function(e){return this.messageController.revokeMessage(e)}},{key:"resendMessage",value:function(e){return this.messageController.resendMessage(e)}},{key:"getMessageList",value:function(e){return this.messageController.getMessageList(e)}},{key:"setMessageRead",value:function(e){return this.messageController.setMessageRead(e)}},{key:"getConversationList",value:function(){return this.conversationController.getConversationList()}},{key:"getConversationProfile",value:function(e){return this.conversationController.getConversationProfile(e)}},{key:"deleteConversation",value:function(e){return this.conversationController.deleteConversation(e)}},{key:"getMyProfile",value:function(){return this.userController.getMyProfile()}},{key:"getUserProfile",value:function(e){return this.userController.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this.userController.updateMyProfile(e)}},{key:"getFriendList",value:function(){return this.userController.getFriendList()}},{key:"deleteFriend",value:function(e){return this.userController.deleteFriend(e)}},{key:"getBlacklist",value:function(){return this.userController.getBlacklist()}},{key:"addToBlacklist",value:function(e){return this.userController.addBlacklist(e)}},{key:"removeFromBlacklist",value:function(e){return this.userController.deleteBlacklist(e)}},{key:"getGroupList",value:function(e){return this.groupController.getGroupList(e)}},{key:"getGroupProfile",value:function(e){return this.groupController.getGroupProfile(e)}},{key:"createGroup",value:function(e){return this.groupController.createGroup(e)}},{key:"dismissGroup",value:function(e){return this.groupController.dismissGroup(e)}},{key:"updateGroupProfile",value:function(e){return this.groupController.updateGroupProfile(e)}},{key:"joinGroup",value:function(e){return this.groupController.joinGroup(e)}},{key:"quitGroup",value:function(e){return this.groupController.quitGroup(e)}},{key:"searchGroupByID",value:function(e){return this.groupController.searchGroupByID(e)}},{key:"changeGroupOwner",value:function(e){return this.groupController.changeGroupOwner(e)}},{key:"handleGroupApplication",value:function(e){return this.groupController.handleGroupApplication(e)}},{key:"setMessageRemindType",value:function(e){return this.groupController.setMessageRemindType(e)}},{key:"getGroupMemberList",value:function(e){return this.groupController.getGroupMemberList(e)}},{key:"getGroupMemberProfile",value:function(e){return this.groupController.getGroupMemberProfile(e)}},{key:"getGroupOnlineMemberCount",value:function(e){return this.groupController.getGroupOnlineMemberCount(e)}},{key:"addGroupMember",value:function(e){return this.groupController.addGroupMember(e)}},{key:"deleteGroupMember",value:function(e){return this.groupController.deleteGroupMember(e)}},{key:"setGroupMemberMuteTime",value:function(e){return this.groupController.setGroupMemberMuteTime(e)}},{key:"setGroupMemberRole",value:function(e){return this.groupController.setGroupMemberRole(e)}},{key:"setGroupMemberNameCard",value:function(e){return this.groupController.setGroupMemberNameCard(e)}},{key:"setGroupMemberCustomField",value:function(e){return this.groupController.setGroupMemberCustomField(e)}},{key:"_initOptions",value:function(e){this.plugins={},this._sdkReloadFlag=!1;var t=e.SDKAppID||0,n=Fs();this.context={SDKAppID:t,accountType:n},this.loginInfo={SDKAppID:t,accountType:n,identifier:null,userSig:null,unlimitedAVChatRoom:e.unlimitedAVChatRoom||!1,scene:e.scene||"",oversea:e.oversea||!1,avchatroomIDList:[],instanceID:Zs()},this.options={runLoopNetType:e.runLoopNetType||2,enablePointer:e.enablePointer||!1}}},{key:"_initMemberVariables",value:function(){var e;this.innerEmitter=new tv,this.outerEmitter=new tv,e=this.outerEmitter,fp=e,this.packageConfig=new rv(this),this.storage=new ev(this),this.netMonitor=new xv,this.outerEmitter._emit=this.outerEmitter.emit,this.outerEmitter.emit=function(e,t){var n=arguments[0],r=[n,{name:arguments[0],data:arguments[1]}];this.outerEmitter._emit.apply(this.outerEmitter,r)}.bind(this),this.innerEmitter._emit=this.innerEmitter.emit,this.innerEmitter.emit=function(e,t){var n;Es(arguments[1])&&arguments[1].data?(_s.warn("inner eventData has data property, please check!"),n=[e,{name:arguments[0],data:arguments[1].data}]):n=[e,{name:arguments[0],data:arguments[1]}],this.innerEmitter._emit.apply(this.innerEmitter,n)}.bind(this)}},{key:"_initControllers",value:function(){this.exceptionController=new Qh(this),this.connectionController=new Xh(this),this.contextController=new cp(this),this.context=this.contextController.getContext(),this.signController=new Mp(this),this.messageController=new Gg(this),this.comboMessageController=new Mv(this),this.conversationController=new mg(this),this.userController=new ag(this),this.groupController=new Qg(this),this.notificationController=new sv(this),this.bigDataHallwayController=new lv(this),this.statusController=new Zg(this),this.uploadController=new uv(this),this.messageLossController=new Ov(this),this.eventStatController=new wv(this),this.sumStatController=new Rv(this),this.mtaReportController=new Sv(this),this._initReadyListener()}},{key:"_initListener",value:function(){var e=this;if(this.innerEmitter.on(Jf,this._onSDKReload,this),qa&&"function"==typeof Ha.onAppShow&&"function"==typeof Ha.onAppHide){var t=null;Ha.onAppHide(function(){t=new Cp("mpHideToShow")}),Ha.onAppShow(function(){null!==t&&t.setNetworkType(e.netMonitor.getNetworkType()).setEnd()})}}},{key:"_initReadyListener",value:function(){for(var e=this,t=this.readyList,n=0,r=t.length;n<r;n++)this[t[n]].ready(function(){return e._readyHandle()})}},{key:"_onSDKReload",value:function(){var e=this;_s.log("sdk reloading..."),this.resetSDK(),this.login(this.loginInfo).then(function(t){e._sdkReloadFlag=!0})}},{key:"resetSDK",value:function(){var e=this;this.initList.forEach(function(t){e[t].reset&&e[t].reset()}),this.netMonitor.reset(),this.storage.reset(),this.resetReady(),this._initReadyListener(),this.outerEmitter.emit(wn.SDK_NOT_READY)}},{key:"_readyHandle",value:function(){for(var e=this.readyList,t=!0,n=0,r=e.length;n<r;n++)if(!this[e[n]].isReady()){t=!1;break}if(t){var i=_s.timeEnd(gp);_s.warn("SDK is ready. cost=".concat(i,"ms")),this.triggerReady(),this.innerEmitter.emit(Yf),this.outerEmitter.emit(wn.SDK_READY),this._sdkReloadFlag&&(this.outerEmitter.emit(wn.SDK_RELOAD),this.groupController.AVChatRoomHandler.joinAVChatRoomSilently(),this._sdkReloadFlag=!1),this._ssoLog.setNetworkType(this.netMonitor.getNetworkType()).setText(i).setEnd()}}}]),e}();Dv.prototype.readyList=["conversationController"],Dv.prototype.initList=["exceptionController","connectionController","signController","contextController","messageController","comboMessageController","conversationController","userController","groupController","notificationController","eventStatController","sumStatController","messageLossController","statusController"];var Lv={login:"login",logout:"logout",destroy:"destroy",on:"on",off:"off",ready:"ready",setLogLevel:"setLogLevel",joinGroup:"joinGroup",quitGroup:"quitGroup",registerPlugin:"registerPlugin",getGroupOnlineMemberCount:"getGroupOnlineMemberCount"},Pv={},Nv={create:function(e){if(e.SDKAppID&&Pv[e.SDKAppID])return Pv[e.SDKAppID];_s.log("TIM.create");var t=new Dv(e);t.on(wn.SDK_DESTROY,function(e){Pv[e.data.SDKAppID]=null,delete Pv[e.data.SDKAppID]});var n=function(e){var t=Object.create(null);return Object.keys(Xd).forEach(function(n){if(e[n]){var r=Xd[n],i=new er;t[r]=function(){var t=Array.from(arguments);return i.use(function(t,r){return function(e,t){return!(!e.isReady()&&void 0===Lv[t]&&(e.innerEmitter.emit(Bf,new Ed({code:Td.SDK_IS_NOT_READY,message:"".concat(t," ").concat(Ld,"，请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/module-EVENT.html#.SDK_READY")})),1))}(e,n)?r():hp(new Ed({code:Td.SDK_IS_NOT_READY,message:"".concat(n," ").concat(Ld,"。")}))}).use(function(e,t){if(!0===function(e,t,n){if(void 0===t)return!0;var r=!0;if("object"===or(t).toLowerCase())Object.keys(t).forEach(function(i){var o=1===e.length?e[0][i]:void 0;r=!!ru(o,t[i],n,i)&&r});else if("array"===or(t).toLowerCase())for(var i=0;i<t.length;i++)r=!!ru(e[i],t[i],n,t[i].name)&&r;if(r)return r;throw new Error("Params validate failed.")}(e,Jd[n],r))return t()}).use(function(t,r){return e[n].apply(e,t)}),i.run(t)}}}),t}(t);return Pv[e.SDKAppID]=n,_s.log("TIM.create ok"),n}};return Nv.TYPES=En,Nv.EVENT=wn,Nv.VERSION="2.8.5",_s.log("TIM.VERSION: ".concat(Nv.VERSION)),Nv}()}).call(this,n(61))},1407:function(e,t,n){var r;window,e.exports=(r=n(1103),function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=38)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=a(n(1)),o=a(n(7));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.headSize=8,this.size=0,this.type="",this.subBox=[],this.start=-1}return r(e,[{key:"readHeader",value:function(e){if(this.start=e.position,this.size=e.readUint32(),this.type=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),1===this.size)this.size=e.readUint64();else if(0===this.size&&"mdat"!==this.type)throw new o.default("parse","",{line:19,handle:"[Box] readHeader",msg:"parse mp4 mdat box failed"});if("uuid"===this.type)for(var t=[],n=0;n<16;n++)t.push(e.readUint8())}},{key:"readBody",value:function(t){var n=this.size-t.position+this.start,r=this.type;this.data=t.buffer.slice(t.position,t.position+n),t.position+=this.data.byteLength;var i=void 0;(i=e.containerBox.find(function(e){return e===r})?e.containerParser:e[r])&&i instanceof Function&&i.call(this)}},{key:"read",value:function(e){this.readHeader(e),this.readBody(e)}}],[{key:"containerParser",value:function(){for(var t=new i.default(this.data),n=t.buffer.byteLength;t.position<n;){var r=new e;r.readHeader(t),this.subBox.push(r),r.readBody(t)}delete this.data,t=null}}]),e}();s.containerBox=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","mfra"],t.default=s,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),a=(r=o)&&r.__esModule?r:{default:r},s=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof ArrayBuffer))throw new a.default("parse","",{line:9,handle:"[Stream] constructor",msg:"data is valid"});this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return i(e,[{key:"skip",value:function(t){for(var n=Math.floor(t/4),r=t%4,i=0;i<n;i++)e.readByte(this.dataview,4);r>0&&e.readByte(this.dataview,r)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,n){var r=void 0;switch(t){case 1:r=n?e.getInt8(e.position):e.getUint8(e.position);break;case 2:r=n?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(n)throw"not supported for readByte 3";r=e.getUint8(e.position)<<16,r|=e.getUint8(e.position+1)<<8,r|=e.getUint8(e.position+2);break;case 4:r=n?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(n)throw new a.default("parse","",{line:73,handle:"[Stream] readByte",msg:"not supported for readBody 8"});r=e.getUint32(e.position)<<32,r|=e.getUint32(e.position+4);break;default:r=""}return e.position+=t,r}}]),e}();t.default=s,e.exports=t.default},function(e,t,n){"use strict";var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t,n){"use strict";var r=n(19)("wks"),i=n(20),o=n(2).Symbol,a="function"==typeof o;(e.exports=function(e){return r[e]||(r[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=r},function(e,t,n){"use strict";var r=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=r)},function(e,t,n){"use strict";var r=n(6);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e){return"object"===(void 0===e?"undefined":r(e))?null!==e:"function"==typeof e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(34),o=(r=i)&&r.__esModule?r:{default:r},a=n(84),s=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),r.version=a.version;var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return o.url=i,o}return function(e,t){throw new TypeError("Super expression must either be null or a function, not undefined")}(),t}(o.default.Errors);t.default=s,e.exports=t.default},function(e,t,n){"use strict";var r=n(9);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){"use strict";e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){"use strict";e.exports=!n(23)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){"use strict";var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,n){"use strict";var r=n(5),i=n(41),o=n(42),a=Object.defineProperty;t.f=n(10)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){"use strict";var r,i,o,a,s,u,l,c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=n(64),f=n(81),p=Function.prototype.apply,h=Function.prototype.call,g=Object.create,v=Object.defineProperty,m=Object.defineProperties,y=Object.prototype.hasOwnProperty,_={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var n,i;return f(t),i=this,r.call(this,e,n=function(){o.call(i,e,n),p.call(t,this,arguments)}),n.__eeOnceListener__=t,this},s={on:r=function(e,t){var n;return f(t),y.call(this,"__ee__")?n=this.__ee__:(n=_.value=g(null),v(this,"__ee__",_),_.value=null),n[e]?"object"===c(n[e])?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},once:i,off:o=function(e,t){var n,r,i,o;if(f(t),!y.call(this,"__ee__"))return this;if(!(n=this.__ee__)[e])return this;if("object"===(void 0===(r=n[e])?"undefined":c(r)))for(o=0;i=r[o];++o)i!==t&&i.__eeOnceListener__!==t||(2===r.length?n[e]=r[o?0:1]:r.splice(o,1));else r!==t&&r.__eeOnceListener__!==t||delete n[e];return this},emit:a=function(e){var t,n,r,i,o;if(y.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"===(void 0===i?"undefined":c(i))){for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];for(i=i.slice(),t=0;r=i[t];++t)p.call(r,this,o)}else switch(arguments.length){case 1:h.call(i,this);break;case 2:h.call(i,this,arguments[1]);break;case 3:h.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];p.call(i,this,o)}}},u={on:d(r),once:d(i),off:d(o),emit:d(a)},l=m({},u),e.exports=t=function(e){return null==e?g(l):m(Object(e),u)},t.methods=s},function(e,t,n){"use strict";var r=n(75)();e.exports=function(e){return e!==r&&null!==e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=new Date;t.setFullYear(1904),t.setMonth(0),t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),this.time=t}return r(e,[{key:"setTime",value:function(e){return this.time.setTime(this.time.getTime()+1*e),this.time.toLocaleString()}}]),e}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(36),a=(r=o)&&r.__esModule?r:{default:r},s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.buffer=new Uint8Array(0)}return i(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach(function(t){t?e.buffer=(0,a.default)(Uint8Array,e.buffer,t):window.console.error(t)})}}],[{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}();t.default=s,e.exports=t.default},function(e,t,n){"use strict";e.exports=!1},function(e,t,n){"use strict";var r=n(11),i=n(3)("toStringTag"),o="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,n){"use strict";var r=n(4),i=n(2),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(17)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){"use strict";var r=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+i).toString(36))}},function(e,t,n){"use strict";var r=n(2),i=n(4),o=n(22),a=n(25),s=n(8),u=function e(t,n,u){var l,c,d,f,p=t&e.F,h=t&e.G,g=t&e.P,v=t&e.B,m=h?r:t&e.S?r[n]||(r[n]={}):(r[n]||{}).prototype,y=h?i:i[n]||(i[n]={}),_=y.prototype||(y.prototype={});for(l in h&&(u=n),u)d=((c=!p&&m&&void 0!==m[l])?m:u)[l],f=v&&c?s(d,r):g&&"function"==typeof d?s(Function.call,d):d,m&&a(m,l,d,t&e.U),y[l]!=d&&o(y,l,f),g&&_[l]!=d&&(_[l]=d)};r.core=i,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,n){"use strict";var r=n(12),i=n(43);e.exports=n(10)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){"use strict";var r=n(6),i=n(2).document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,n){"use strict";var r=n(2),i=n(22),o=n(26),a=n(20)("src"),s=n(44),u=(""+s).split("toString");n(4).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,n,s){var l="function"==typeof n;l&&(o(n,"name")||i(n,"name",t)),e[t]!==n&&(l&&(o(n,a)||i(n,a,e[t]?""+e[t]:u.join(String(t)))),e===r?e[t]=n:s?e[t]?e[t]=n:i(e,t,n):(delete e[t],i(e,t,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[a]||s.call(this)})},function(e,t,n){"use strict";var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,n){"use strict";e.exports={}},function(e,t,n){"use strict";var r=n(29),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){"use strict";var r=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:r)(e)}},function(e,t,n){"use strict";var r,i,o,a=n(8),s=n(51),u=n(52),l=n(24),c=n(2),d=c.process,f=c.setImmediate,p=c.clearImmediate,h=c.MessageChannel,g=c.Dispatch,v=0,m={},y=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},_=function(e){y.call(e.data)};f&&p||(f=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return m[++v]=function(){s("function"==typeof e?e:Function(e),t)},r(v),v},p=function(e){delete m[e]},"process"==n(11)(d)?r=function(e){d.nextTick(a(y,e,1))}:g&&g.now?r=function(e){g.now(a(y,e,1))}:h?(o=(i=new h).port2,i.port1.onmessage=_,r=a(o.postMessage,o,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(r=function(e){c.postMessage(e+"","*")},c.addEventListener("message",_,!1)):r="onreadystatechange"in l("script")?function(e){u.appendChild(l("script")).onreadystatechange=function(){u.removeChild(this),y.call(e)}}:function(e){setTimeout(a(y,e,1),0)}),e.exports={set:f,clear:p}},function(e,t,n){"use strict";var r=n(9);function i(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},function(e,t,n){"use strict";var r=n(2).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){"use strict";e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){e.exports=r},function(e,t,n){"use strict";e.exports=function(e){return null!=e}},function(e,t,n){"use strict";var r,i=n(85),o=(r=i)&&r.__esModule?r:{default:r};e.exports=o.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=a(n(13)),o=a(n(7));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t,n,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(0,i.default)(this),this.url=t,this.range=n,this.withCredentials=r,this.id=n.join("-"),this.on=!1;var s=new window.XMLHttpRequest;s.target=this,s.responseType="arraybuffer",s.withCredentials=this.withCredentials||!1,s.open("get",t),s.setRequestHeader("Range","bytes="+n[0]+"-"+n[1]),s.onload=function(){200!==s.status&&206!==s.status||a&&a instanceof Function&&a(s.response),s.target.remove()},s.onerror=function(e){s.target.emit("error",new o.default("network","",{line:25,handle:"[Task] constructor",msg:e.message,url:t})),s.target.remove()},s.onabort=function(){s.target.remove()},this.xhr=s,e.queue.push(this),this.update()}return r(e,[{key:"cancel",value:function(){this.xhr.abort()}},{key:"remove",value:function(){var t=this;e.queue.filter(function(n,r){return n.url===t.url&&n.id===t.id&&(e.queue.splice(r,1),!0)}),this.update()}},{key:"update",value:function(){var t=e.queue,n=t.filter(function(e){return e.on}),r=t.filter(function(e){return!e.on}),i=e.limit-n.length;r.forEach(function(e,t){t<i&&e.run()})}},{key:"run",value:function(){1===this.xhr.readyState?(this.on=!0,this.xhr.send()):this.remove()}}],[{key:"clear",value:function(){e.queue.forEach(function(e){e.on&&e.cancel()}),e.queue.length=0}}]),e}();s.queue=[],s.limit=2,window.Task=s,t.default=s,e.exports=t.default},function(e,t,n){e.exports=n(39)},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n(40),n(60);var i=l(n(34)),o=l(n(63)),a=l(n(129)),s=l(n(37)),u=l(n(16));function l(e){return e&&e.__esModule?e:{default:e}}i.default.install("mp4player",function(){var e=this,t=i.default.sniffer,n=i.default.util,l=i.default.Errors,c=void 0,d=void 0,f=e.config.preloadTime||15,p=void 0,h=e.config.url,g=e.config.pluginRule||function(){return!0};if(h){"String"===n.typeOf(h)?c=h:"Array"===n.typeOf(h)&&h.length&&(c=h[0].src,h.length>1&&(d=h[1].src)),e.config._mainURL=c,e.config._backupURL=d;var v=function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.currentTime;e.timer&&clearTimeout(e.timer),r=Math.max(r,e.currentTime),e.timer=setTimeout(function(){e.mp4.seek(r+.1*n).then(function(t){if(t){var n=e.mse;n.updating=!0,n.appendBuffer(t),n.once("updateend",function(){n.updating=!1})}},function(){n<10&&setTimeout(function(){t(n+1)},2e3)})},50)},m=function(t){var n=new o.default(t,e.config),r=void 0;return new Promise(function(t,i){n.once("moovReady",function(){(r=new a.default(n.videoOnly?'video/mp4; codecs="avc1.64001E"':'video/mp4; codecs="avc1.64001E, mp4a.40.5"')).on("sourceopen",function(){r.appendBuffer(n.packMeta()),r.once("updateend",v.bind(e))}),t([n,r])}),n.on("error",function(e){i(e)})})};if(["chrome","firfox","safari"].some(function(e){return e===t.browser})&&a.default.isSupported('video/mp4; codecs="avc1.64001E, mp4a.40.5"')){if(e._start=e.start,!g.call(e))return!1;var y=function(e,t){t.vid=e.config.vid,t.url=e.src,t.errd&&"object"===r(t.errd)&&e.mp4&&(t.errd.url=e.mp4.url,t.url=e.mp4.url,e.mp4.canDownload=!1),e.emit("DATA_REPORT",t),s.default.clear(),e.mp4&&e.mp4.bufferCache&&e.mp4.bufferCache.clear(),e.currentTime&&(e._currentTime=e.currentTime),e._start&&(e.start=e._start,e._start=null),e.switchURL=null,e._replay=null,clearInterval(e.mp4ProgressTimer),e.off("seeking",b),e.off("pause",S),e.off("playing",k),e.off("waiting",w),e.off("ended",E),e.off("destroy",T),"network"===t.errt&&e.config._backupURL?e.src=e.config._backupURL:e.src=e.config._mainURL,e.once("canplay",function(){e._currentTime&&(e.currentTime=e._currentTime),e.play()})};e.start=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;m(n).then(function(t){e.once("canplay",function(){e.play()});var n=t[0],r=t[1];e._start(r.url),e.mp4=n,e.mse=r,n.on("error",function(t){y(e,t)})},function(t){e._start(n),y(e,t)}),e.once("canplay",function(){if("safari"===t.browser&&e.buffered){var n=e.buffered.start(0);e.currentTime=n+.1}})},e.cut=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments[1],r=new u.default,a=new o.default(h,e.config);return new Promise(function(e,o){a.once("moovReady",function(){(!n||n<=t)&&(n=t+15),n>a.meta.duration&&(t=a.meta.duration-(n-t),n=a.meta.duration),a.cut(t,n).then(function(o){if(o){var s=i.default.util.deepCopy({duration:n-t,audioDuration:n-t,endTime:n-t},a.meta);s.duration=n-t,s.videoDuration=n-t,s.audioDuration=n-t,s.endTime=n-t,r.write(a.packMeta(s),o),e(new Blob([r.buffer],{type:'video/mp4; codecs="avc1.64001E, mp4a.40.5"'}))}})}),a.on("error",function(e){o(e)})})},e.switchURL=function(n){var r=new o.default(n,e.config),a=e.mp4;r.on("moovReady",function(){a.timeRage;var n=e.currentTime,o=a.timeRage.find(function(e){return e[0]-n>2})[0],s=e.getBufferedRange()[1];s-o>0&&"safari"!==t.browser&&e.mse.removeBuffer(o,s),i.default.util.hasClass(e.root,"xgplayer-ended")||e.emit("urlchange"),e.mp4=r,e.mse.appendBuffer(r.packMeta())}),r.on("error",function(t){y(e,t)})},e.playNext=function(t){var n=new o.default(t,e.config),r=e.mp4;n.on("moovReady",function(){var t=[0,0],i=e.video.buffered,o=e.video.currentTime,a=0;if(i)for(var s=0,u=i.length;s<u;s++)t[0]=i.start(s),t[1]=i.end(s),t[0]<=o&&t[1]<=o&&(a=t[1]>a?t[1]:a,e.mse.removeBuffer(t[0],t[1]));e.mp4=n,e.mse.appendBuffer(n.packMeta());var l=!0;e.on("timeupdate",function(){if(l&&r.meta.endTime-e.currentTime<2){var t=e.getBufferedRange();if(e.currentTime-t[1]<.1&&(l=!1,e.currentTime=0,i=e.video.buffered))for(var n=0,o=i.length;n<o;n++)t[0]=i.start(n),t[1]=i.end(n),t[0]>=a&&e.mse.removeBuffer(t[0],t[1])}})}),n.on("error",function(t){y(e,t)})};var _=function(){var t=e.mse,n=e.mp4;if(t&&!t.updating&&n.canDownload){var r=n.timeRage,i=e.getBufferedRange(),o=e.currentTime+f;if(i[1]-o>0)return;r.every(function(e,t){var r=(e[0]+e[1])/2;return 0!==i[1]&&(!(r>i[1]&&!n.bufferCache.has(t))||void v(0,r))}),function(e,t){if(t.meta.endTime-e.currentTime<2){var n=e.getBufferedRange();e.currentTime-n[1]<.1&&e.mse.endOfStream()}}(e,n)}};e.mp4ProgressTimer=setInterval(_,e.config.mp4ProgressTimer||300);var b=function(){var t=e.buffered,n=!1,r=e.currentTime;if(s.default.clear(),t.length){for(var i=0,o=t.length;i<o;i++)if(r>=t.start(i)&&r<=t.end(i)){n=!0;break}n||v(0,r)}else v(0,e.currentTime)};e.on("seeking",b);var S=function(){s.default.clear()};e.on("pause",S);var k=function(){p&&clearTimeout(p)};e.on("playing",k);var w=function(){var t=e.mp4;if(t&&t.meta){var n=e.getBufferedRange(),r=t.meta.videoDuration;r-e.currentTime<.5&&r-n[1]<.5?e.mse.endOfStream():(v(0,n[1]+1),p=setTimeout(function(){for(var t=e.buffered,n=void 0,r=0,i=t.length;r<i;r++)if((n=t.start(r))>=e.currentTime){e.currentTime=n;break}},1500))}};e.on("waiting",w);var E=function(){e.off("waiting",w),clearInterval(e.mp4ProgressTimer)};e.on("ended",E);var T=function(){s.default.clear(),e.timer&&clearTimeout(e.timer)};e.once("destroy",T),e._replay=function(){s.default.clear(),e.mp4.bufferCache.clear(),m(e.mp4.url).then(function(t){var n=t[0],r=t[1];e._start(r.url),e.mp4=n,e.mse=r,e.currentTime=0,e.play(),e.once("canplay",function(){e.on("waiting",w),e.mp4ProgressTimer=setInterval(_,e.config.mp4ProgressTimer||300)})},function(t){y(e,t)})}}}else e.emit("error",new l("other",e.config.vid))})},function(e,t,n){"use strict";var r,i,o,a,s=n(17),u=n(2),l=n(8),c=n(18),d=n(21),f=n(6),p=n(9),h=n(45),g=n(46),v=n(50),m=n(30).set,y=n(53)(),_=n(31),b=n(54),S=n(32),k=n(55),w=u.TypeError,E=u.process,T=E&&E.versions,x=T&&T.v8||"",C=u.Promise,I="process"==c(E),R=function(){},A=i=_.f,O=!!function(){try{var e=C.resolve(1),t=(e.constructor={})[n(3)("species")]=function(e){e(R,R)};return(I||"function"==typeof PromiseRejectionEvent)&&e.then(R)instanceof t&&0!==x.indexOf("6.6")&&-1===S.indexOf("Chrome/66")}catch(e){}}(),M=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},D=function(e,t){if(!e._n){e._n=!0;var n=e._c;y(function(){for(var r=e._v,i=1==e._s,o=0,a=function(t){var n,o,a,s=i?t.ok:t.fail,u=t.resolve,l=t.reject,c=t.domain;try{s?(i||(2==e._h&&N(e),e._h=1),!0===s?n=r:(c&&c.enter(),n=s(r),c&&(c.exit(),a=!0)),n===t.promise?l(w("Promise-chain cycle")):(o=M(n))?o.call(n,u,l):u(n)):l(r)}catch(e){c&&!a&&c.exit(),l(e)}};n.length>o;)a(n[o++]);e._c=[],e._n=!1,t&&!e._h&&L(e)})}},L=function(e){m.call(u,function(){var t,n,r,i=e._v,o=P(e);if(o&&(t=b(function(){I?E.emit("unhandledRejection",i,e):(n=u.onunhandledrejection)?n({promise:e,reason:i}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=I||P(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},P=function(e){return 1!==e._h&&0===(e._a||e._c).length},N=function(e){m.call(u,function(){var t;I?E.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})})},U=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),D(t,!0))},F=function e(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw w("Promise can't be resolved itself");(n=M(t))?y(function(){var i={_w:r,_d:!1};try{n.call(t,l(e,i,1),l(U,i,1))}catch(e){U.call(i,e)}}):(r._v=t,r._s=1,D(r,!1))}catch(e){U.call({_w:r,_d:!1},e)}}};O||(C=function(e){h(this,C,"Promise","_h"),p(e),r.call(this);try{e(l(F,this,1),l(U,this,1))}catch(e){U.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(56)(C.prototype,{then:function(e,t){var n=A(v(this,C));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=I?E.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&D(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r;this.promise=e,this.resolve=l(F,e,1),this.reject=l(U,e,1)},_.f=A=function(e){return e===C||e===a?new o(e):i(e)}),d(d.G+d.W+d.F*!O,{Promise:C}),n(57)(C,"Promise"),n(58)("Promise"),a=n(4).Promise,d(d.S+d.F*!O,"Promise",{reject:function(e){var t=A(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(s||!O),"Promise",{resolve:function(e){return k(s&&this===a?C:this,e)}}),d(d.S+d.F*!(O&&n(59)(function(e){C.all(e).catch(R)})),"Promise",{all:function(e){var t=this,n=A(t),r=n.resolve,i=n.reject,o=b(function(){var n=[],o=0,a=1;g(e,!1,function(e){var s=o++,u=!1;n.push(void 0),a++,t.resolve(e).then(function(e){u||(u=!0,n[s]=e,--a||r(n))},i)}),--a||r(n)});return o.e&&i(o.v),n.promise},race:function(e){var t=this,n=A(t),r=n.reject,i=b(function(){g(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}})},function(e,t,n){"use strict";e.exports=!n(10)&&!n(23)(function(){return 7!=Object.defineProperty(n(24)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){"use strict";var r=n(6);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){"use strict";e.exports=n(19)("native-function-to-string",Function.toString)},function(e,t,n){"use strict";e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){"use strict";var r=n(8),i=n(47),o=n(48),a=n(5),s=n(28),u=n(49),l={},c={},d=e.exports=function(e,t,n,d,f){var p,h,g,v,m=f?function(){return e}:u(e),y=r(n,d,t?2:1),_=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(o(m)){for(p=s(e.length);p>_;_++)if((v=t?y(a(h=e[_])[0],h[1]):y(e[_]))===l||v===c)return v}else for(g=m.call(e);!(h=g.next()).done;)if((v=i(g,y,h.value,t))===l||v===c)return v};d.BREAK=l,d.RETURN=c},function(e,t,n){"use strict";var r=n(5);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},function(e,t,n){"use strict";var r=n(27),i=n(3)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},function(e,t,n){"use strict";var r=n(18),i=n(3)("iterator"),o=n(27);e.exports=n(4).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[r(e)]}},function(e,t,n){"use strict";var r=n(5),i=n(9),o=n(3)("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||null==(n=r(a)[o])?t:i(n)}},function(e,t,n){"use strict";e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){"use strict";var r=n(2).document;e.exports=r&&r.documentElement},function(e,t,n){"use strict";var r=n(2),i=n(30).set,o=r.MutationObserver||r.WebKitMutationObserver,a=r.process,s=r.Promise,u="process"==n(11)(a);e.exports=function(){var e,t,n,l=function(){var r,i;for(u&&(r=a.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){a.nextTick(l)};else if(!o||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var c=s.resolve(void 0);n=function(){c.then(l)}}else n=function(){i.call(r,l)};else{var d=!0,f=document.createTextNode("");new o(l).observe(f,{characterData:!0}),n=function(){f.data=d=!d}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t,n){"use strict";e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){"use strict";var r=n(5),i=n(6),o=n(31);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";var r=n(25);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},function(e,t,n){"use strict";var r=n(12).f,i=n(26),o=n(3)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},function(e,t,n){"use strict";var r=n(2),i=n(12),o=n(10),a=n(3)("species");e.exports=function(e){var t=r[e];o&&t&&!t[a]&&i.f(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,n){"use strict";var r=n(3)("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],a=o[r]();a.next=function(){return{done:n=!0}},o[r]=function(){return a},e(o)}catch(e){}return n}},function(e,t,n){"use strict";var r=n(21),i=n(61),o=n(32),a=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);r(r.P+r.F*a,"String",{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},function(e,t,n){"use strict";var r=n(28),i=n(62),o=n(33);e.exports=function(e,t,n,a){var s=String(o(e)),u=s.length,l=void 0===n?" ":String(n),c=r(t);if(c<=u||""==l)return s;var d=c-u,f=i.call(l,Math.ceil(d/l.length));return f.length>d&&(f=f.slice(0,d)),a?f+s:s+f}},function(e,t,n){"use strict";var r=n(29),i=n(33);e.exports=function(e){var t=String(i(this)),n="",o=r(e);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=f(n(13)),o=f(n(82)),a=f(n(83)),s=f(n(16)),u=f(n(127)),l=f(n(37)),c=f(n(128)),d=f(n(7));function f(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.pow(25,4);(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),(0,i.default)(this),this.url=t,this.withCredentials=n.withCredentials,u.default.videoOnly=this.videoOnly=n.videoOnly||!1,this.CHUNK_SIZE=r,this.init(t),this.once("moovReady",this.moovParse.bind(this)),this.cache=new s.default,this.bufferCache=new Set,this.timeRage=[],this.canDownload=!0}return r(e,[{key:"getData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t+this.CHUNK_SIZE,r=this;return new Promise(function(i,o){new l.default(e.url,[t,n],e.withCredentials,i).once("error",function(e){r.emit("error",e)})})}},{key:"moovParse",value:function(){var e=this,t=this,n=this.moovBox,r=c.default.findBox(n,"mvhd"),i=c.default.findBox(n,"trak"),a=void 0,s=void 0,l=void 0,f=void 0,p=void 0,h=void 0,g=void 0,v=void 0,m=void 0,y=void 0,_=void 0,b=void 0,S=void 0,k=void 0;(i=[].concat(i)).forEach(function(e){var n=c.default.findBox(e,"hdlr"),i=c.default.findBox(e,"mdhd");if(n&&i){if("vide"===n.handleType&&t.videoOnly){var o=c.default.findBox(e,"elst");e.empty_duration=0,o.empty_duration&&(e.empty_duration=o.empty_duration*i.timescale/r.timeScale),e.time_offset=o.start_time-e.empty_duration}var u=c.default.findBox(e,"stsd").subBox[0];if("vide"===n.handleType){var w=c.default.findBox(e,"avcC"),E=c.default.findBox(e,"tkhd");a=e,p=i.timescale,w?(l=u.type+"."+c.default.toHex(w.profile,w.profileCompatibility,w.AVCLevelIndication).join(""),g=w.sequence&&w.sequence.map(function(e){return Number("0x"+e)}),v=w.pps&&w.pps.map(function(e){return Number("0x"+e)}),m=w.profile):l=""+u.type,E&&(y=E.width,_=E.height)}if("soun"===n.handleType){s=e;var T=c.default.findBox(e,"esds"),x=c.default.findBox(e,"mp4a"),C=c.default.findBox(e,5);h=i.timescale,f=T?u.type+"."+c.default.toHex(T.subBox[0].subBox[0].typeID)+"."+T.subBox[0].subBox[0].subBox[0].type:""+u.type,C&&C.EScode&&(k=C.EScode.map(function(e){return Number("0x"+e)})),x&&(b=x.channelCount,S=x.sampleRate)}}else t.emit("error",new d.default("parse","",{line:72,handle:"[MP4] moovParse",url:t.url}))}),this.videoTrak=(0,o.default)({},a),s||(u.default.videoOnly=this.videoOnly=!0),this.videoOnly||(this.audioTrak=(0,o.default)({},s));var w=this._boxes.find(function(e){return"mdat"===e.type}),E=c.default.seekTrakDuration(a,p),T=void 0;this.videoOnly||(T=c.default.seekTrakDuration(s,h)),this.mdatStart=w.start;var x=this.videoKeyFrames,C=x.length-1;x.forEach(function(t,n){n<C?e.timeRage.push([t.time.time/p,x[n+1].time.time/p]):e.timeRage.push([t.time.time/p,-1])}),this.meta={videoCodec:l,createTime:r.createTime,modifyTime:r.modifyTime,duration:E,timeScale:r.timeScale,videoDuration:E,videoTimeScale:p,endTime:E,sps:g,pps:v,width:y,height:_,profile:m,pixelRatio:[1,1],channelCount:b,sampleRate:S,audioConfig:k},this.videoOnly||(this.meta.audioCodec=f,this.meta.audioDuration=T,this.meta.audioTimeScale=h,this.meta.duration=r.duration/r.timeScale,this.meta.endTime=Math.min(E,T))}},{key:"init",value:function(){var e=this;e.getData().then(function(t){var n=void 0,r=0,i=void 0,o=void 0;try{n=new a.default(t)}catch(t){return e.emit("error",t.type?t:new d.default("parse","",{line:176,handle:"[MP4] init",msg:t.message})),!1}if(e._boxes=o=n.boxes,o.every(function(t){return r+=t.size,"moov"!==t.type||(i=t,e.moovBox=i,e.emit("moovReady",i),!1)}),!i){var s=n.nextBox;s?"moov"===s.type?e.getData(r,r+s.size+28).then(function(t){var n=new a.default(t);e._boxes=e._boxes.concat(n.boxes),(i=n.boxes.filter(function(e){return"moov"===e.type})).length?(e.moovBox=i[0],e.emit("moovReady",i)):e.emit("error",new d.default("parse","",{line:203,handle:"[MP4] init",msg:"not find moov box"}))}):e.emit("error",new d.default("parse","",{line:207,handle:"[MP4] init",msg:"not find moov box"})):e.getData(r,"").then(function(t){var n=new a.default(t);n?(e._boxes=e._boxes.concat(n.boxes),n.boxes.every(function(t){return"moov"!==t.type||(i=t,e.moovBox=i,e.emit("moovReady",i),!1)})):e.emit("error",new d.default("parse","",{line:225,handle:"[MP4] init",msg:"not find moov box"}))})}}).catch(function(){e.emit("error",new d.default("network","",{line:231,handle:"[MP4] getData",msg:"getData failed"}))})}},{key:"getSamplesByOrders",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video",t=arguments[1],n=arguments[2],r="video"===e?this.videoTrak:this.audioTrak,i=c.default.findBox(r,"stsc"),o=c.default.findBox(r,"stsz"),a=c.default.findBox(r,"stts"),s=c.default.findBox(r,"stco"),u=c.default.findBox(r,"ctts"),l=this.mdatStart,d=[];if(n=void 0!==n?n:o.entries.length,t instanceof Array)t.forEach(function(e,t){d.push({idx:e,size:o.entries[e],time:c.default.seekSampleTime(a,u,e,r.time_offset),offset:c.default.seekSampleOffset(i,s,o,e,l)})});else if(0!==n)for(var f=t;f<n;f++)d.push({idx:f,size:o.entries[f],time:c.default.seekSampleTime(a,u,f,r.time_offset),offset:c.default.seekSampleOffset(i,s,o,f,l)});else d={idx:t,size:o.entries[t],time:c.default.seekSampleTime(a,u,t,r.time_offset),offset:c.default.seekSampleOffset(i,s,o,t,l)};return d}},{key:"packMeta",value:function(){if(this.meta){var e=new s.default;return e.write(u.default.ftyp()),e.write(u.default.moov(this.meta)),this.cache.write(e.buffer),e.buffer}}},{key:"seek",value:function(e){var t=e*this.meta.videoTimeScale,n=void 0,r=this.videoKeyFrames,i=void 0;return this.videoOnly||(i=this.audioKeyFrames),r.every(function(e,i){var o=e.time.time,a=r[i+1]?r[i+1].time.time:Number.MAX_SAFE_INTEGER;return!(o<=t&&t<a&&(n=i,1))}),this.videoOnly||i.every(function(e,r){var o=e.startTime,a=i[r+1]?i[r+1].startTime:Number.MAX_SAFE_INTEGER;return!(o<=t&&t<a&&(n=Math.min(r,n),1))}),this.bufferCache.has(n)?Promise.resolve(null):this.loadFragment(n)}},{key:"loadFragment",value:function(e){var t=void 0,n=void 0,r=this.videoKeyFrames[e],i=void 0;if(t=r.offset,this.videoOnly||(i=this.getSamplesByOrders("audio",this.audioKeyFrames[e].order,0),t=Math.min(r.offset,i.offset)),e<this.videoKeyFrames.length-1){var o=this.videoKeyFrames[e+1],a=void 0;n=o.offset,this.videoOnly||(a=this.getSamplesByOrders("audio",this.audioKeyFrames[e+1].order,0),n=Math.max(o.offset,a.offset))}var s=this;return window.isNaN(t)||void 0!==n&&window.isNaN(n)?(s.emit("error",new d.default("parse","",{line:366,handle:"[MP4] loadFragment",url:s.url})),!1):this.bufferCache.has(e)?Promise.resolve(null):this.getData(t+s.mdatStart,n?s.mdatStart+n:"").then(function(n){return s.createFragment(new Uint8Array(n),t,e)})}},{key:"addFragment",value:function(e){var t=new s.default;return t.write(u.default.moof(e)),t.write(u.default.mdat(e)),this.cache.write(t.buffer),t.buffer}},{key:"createFragment",value:function(e,t,n){var r=[];this.bufferCache.add(n);var i=this.videoKeyFrames.map(function(e){return e.idx}),o=this.getSamplesByOrders("video",i[n],i[n+1]),a=o.map(function(n,r){return{size:n.size,duration:n.time.duration,offset:n.time.offset,buffer:new Uint8Array(e.slice(n.offset-t,n.offset-t+n.size)),key:0===r}});if(r.push(this.addFragment({id:1,time:o[0].time.time,firstFlags:33554432,flags:3841,samples:a})),!this.videoOnly){var s=this.getSamplesByOrders("audio",this.audioKeyFrames[n].order,this.audioKeyFrames[n+1]?this.audioKeyFrames[n+1].order:void 0),u=s.map(function(n,r){return{size:n.size,duration:n.time.duration,offset:n.time.offset,buffer:new Uint8Array(e.slice(n.offset-t,n.offset-t+n.size)),key:0===r}});r.push(this.addFragment({id:2,time:s[0].time.time,firstFlags:0,flags:1793,samples:u}))}var l=0;r.every(function(e){return l+=e.byteLength,!0});var c=new Uint8Array(l),d=0;return r.every(function(e){return c.set(e,d),d+=e.byteLength,!0}),Promise.resolve(c)}},{key:"download",value:function(){}},{key:"cut",value:function(e,t){this.bufferCache.clear();var n=e*this.meta.videoTimeScale,r=t*this.meta.videoTimeScale,i=void 0,o=void 0,a=this.videoKeyFrames,s=this.audioKeyFrames;return a.every(function(e,t){var s=e.time.time,u=a[t+1]?a[t+1].time.time:Number.MAX_SAFE_INTEGER;return s<=n&&n<u?(i=t,!0):!(s<=r&&r<u&&(o=t,1))}),s.every(function(e,t){var a=e.startTime,u=s[t+1]?s[t+1].startTime:Number.MAX_SAFE_INTEGER;return a<=n&&n<u?(i=Math.min(t,i),!0):!(a<=r&&r<u&&(o=Math.min(t,o),1))}),o||(o=a.length),this.loadFragmentForCut(i,o)}},{key:"loadFragmentForCut",value:function(e,t){var n,r,i=this.videoKeyFrames[e],o=this.getSamplesByOrders("audio",this.audioKeyFrames[e].order,0);n=Math.min(i.offset,o.offset);var a=this.videoKeyFrames[t],s=this.getSamplesByOrders("audio",this.audioKeyFrames[t].order,0);r=Math.max(a.offset,s.offset);var u=this;return window.isNaN(n)||void 0!==r&&window.isNaN(r)?(u.emit("error",new d.default("parse","",{line:366,handle:"[MP4] loadFragment",url:u.url})),!1):this.getData(n+u.mdatStart,r?u.mdatStart+r:"").then(function(i){return u.createFragmentForCut(new Uint8Array(i),n,e,r,t)})}},{key:"createFragmentForCut",value:function(e,t,n,r,i){var o=[],a=this.videoKeyFrames.map(function(e){return e.idx}),s=this.getSamplesByOrders("video",a[n],a[i]).map(function(n,r){return{size:n.size,duration:n.time.duration,offset:n.time.offset,buffer:new Uint8Array(e.slice(n.offset-t,n.offset-t+n.size)),key:0===r}});o.push(this.addFragment({id:1,time:0,firstFlags:33554432,flags:3841,samples:s}));var u=this.getSamplesByOrders("audio",this.audioKeyFrames[n].order,this.audioKeyFrames[i]?this.audioKeyFrames[i].order:void 0).map(function(n,r){return{size:n.size,duration:n.time.duration,offset:n.time.offset,buffer:new Uint8Array(e.slice(n.offset-t,n.offset-t+n.size)),key:0===r}});o.push(this.addFragment({id:2,time:0,firstFlags:0,flags:1793,samples:u}));var l=0;o.every(function(e){return l+=e.byteLength,!0});var c=new Uint8Array(l),d=0;return o.every(function(e){return c.set(e,d),d+=e.byteLength,!0}),Promise.resolve(c)}},{key:"videoKeyFrames",get:function(){if(this._videoFrames)return this._videoFrames;var e=this.videoTrak,t=c.default.findBox(e,"stss"),n=this.getSamplesByOrders("video",t.entries.map(function(e){return e-1}));return this._videoFrames=n,n}},{key:"audioKeyFrames",get:function(){if(this._audioFrames)return this._audioFrames;var e,t=c.default.findBox(this.videoTrak,"mdhd").timescale,n=c.default.findBox(this.audioTrak,"mdhd").timescale,r=c.default.findBox(this.audioTrak,"stts").entry;return e=this.videoKeyFrames.map(function(e){return c.default.seekOrderSampleByTime(r,n,e.time.time/t)}),this._audioFrames=e,this._audioFrames}}]),e}();t.default=p,e.exports=t.default},function(e,t,n){"use strict";var r=n(35),i=n(65),o=n(69),a=n(77),s=n(78);(e.exports=function(e,t){var n,i,u,l,c;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],r(e)?(n=s.call(e,"c"),i=s.call(e,"e"),u=s.call(e,"w")):(n=u=!0,i=!1),c={value:t,configurable:n,enumerable:i,writable:u},l?o(a(l),c):c}).gs=function(e,t,n){var u,l,c,d;return"string"!=typeof e?(c=n,n=t,t=e,e=null):c=arguments[3],r(t)?i(t)?r(n)?i(n)||(c=n,n=void 0):n=void 0:(c=t,t=n=void 0):t=void 0,r(e)?(u=s.call(e,"c"),l=s.call(e,"e")):(u=!0,l=!1),d={get:t,set:n,configurable:u,enumerable:l},c?o(a(c),d):d}},function(e,t,n){"use strict";var r=n(66),i=/^\s*class[\s{/}]/,o=Function.prototype.toString;e.exports=function(e){return!!r(e)&&!i.test(o.call(e))}},function(e,t,n){"use strict";var r=n(67);e.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(e){return!1}return!r(e)}},function(e,t,n){"use strict";var r=n(68);e.exports=function(e){if(!r(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(e){return!1}}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(35),o={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!i(e)&&hasOwnProperty.call(o,void 0===e?"undefined":r(e))}},function(e,t,n){"use strict";e.exports=n(70)()?Object.assign:n(71)},function(e,t,n){"use strict";e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,n){"use strict";var r=n(72),i=n(76),o=Math.max;e.exports=function(e,t){var n,a,s,u=o(arguments.length,2);for(e=Object(i(e)),s=function(r){try{e[r]=t[r]}catch(e){n||(n=e)}},a=1;a<u;++a)r(t=arguments[a]).forEach(s);if(void 0!==n)throw n;return e}},function(e,t,n){"use strict";e.exports=n(73)()?Object.keys:n(74)},function(e,t,n){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,n){"use strict";var r=n(14),i=Object.keys;e.exports=function(e){return i(r(e)?Object(e):e)}},function(e,t,n){"use strict";e.exports=function(){}},function(e,t,n){"use strict";var r=n(14);e.exports=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,n){"use strict";var r=n(14),i=Array.prototype.forEach,o=Object.create;e.exports=function(e){var t=o(null);return i.call(arguments,function(e){r(e)&&function(e,t){var n;for(n in e)t[n]=e[n]}(Object(e),t)}),t}},function(e,t,n){"use strict";e.exports=n(79)()?String.prototype.contains:n(80)},function(e,t,n){"use strict";var r="razdwatrzy";e.exports=function(){return"function"==typeof r.contains&&!0===r.contains("dwa")&&!1===r.contains("foo")}},function(e,t,n){"use strict";var r=String.prototype.indexOf;e.exports=function(e){return r.call(this,e,arguments[1])>-1}},function(e,t,n){"use strict";e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e){return function(e){return!!e&&"object"===(void 0===e?"undefined":r(e))}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===o}(e)}(e)},o="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function a(e,t){return!1!==t.clone&&t.isMergeableObject(e)?u((n=e,Array.isArray(n)?[]:{}),e,t):e;var n}function s(e,t,n){return e.concat(t).map(function(e){return a(e,n)})}function u(e,t,n){(n=n||{}).arrayMerge=n.arrayMerge||s,n.isMergeableObject=n.isMergeableObject||i;var r=Array.isArray(t);return r===Array.isArray(e)?r?n.arrayMerge(e,t,n):function(e,t,n){var r={};return n.isMergeableObject(e)&&Object.keys(e).forEach(function(t){r[t]=a(e[t],n)}),Object.keys(t).forEach(function(i){n.isMergeableObject(t[i])&&e[i]?r[i]=u(e[i],t[i],n):r[i]=a(t[i],n)}),r}(e,t,n):a(t,n)}u.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,n){return u(e,n,t)},{})};var l=u;t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=K(n(0)),i=K(n(36)),o=K(n(1)),a=K(n(86)),s=K(n(87)),u=K(n(88)),l=K(n(89)),c=K(n(90)),d=K(n(91)),f=K(n(92)),p=K(n(93)),h=K(n(94)),g=K(n(95)),v=K(n(96)),m=K(n(97)),y=K(n(98)),_=K(n(99)),b=K(n(100)),S=K(n(101)),k=K(n(102)),w=K(n(103)),E=K(n(104)),T=K(n(105)),x=K(n(106)),C=K(n(107)),I=K(n(108)),R=K(n(109)),A=K(n(110)),O=K(n(111)),M=K(n(112)),D=K(n(113)),L=K(n(114)),P=K(n(115)),N=K(n(116)),U=K(n(117)),F=K(n(118)),j=K(n(119)),G=K(n(120)),B=K(n(121)),V=K(n(122)),q=K(n(123)),H=K(n(124)),z=K(n(125));function K(e){return e&&e.__esModule?e:{default:e}}var W={};function Y(e,t,n){var r=e;t.map(function(e,i){r[e]=i==t.length-1?n:r[e]||{},r=r[e]})}Y(W,["box","avc1"],K(n(126)).default),Y(W,["box","avcC"],z.default),Y(W,["box","btrt"],H.default),Y(W,["box","co64"],q.default),Y(W,["box","ctts"],V.default),Y(W,["box","dref"],B.default),Y(W,["box","elst"],G.default),Y(W,["box","esds"],j.default),Y(W,["box","ftyp"],F.default),Y(W,["box","hdlr"],U.default),Y(W,["box","hmhd"],N.default),Y(W,["box","iods"],P.default),Y(W,["box","mdat"],L.default),Y(W,["box","mdhd"],D.default),Y(W,["box","mfhd"],M.default),Y(W,["box","mp4a"],O.default),Y(W,["box","MP4DecConfigDescrTag"],A.default),Y(W,["box","MP4DecSpecificDescrTag"],R.default),Y(W,["box","MP4ESDescrTag"],I.default),Y(W,["box","mvhd"],C.default),Y(W,["box","nmhd"],x.default),Y(W,["box","pasp"],T.default),Y(W,["box","sbgp"],E.default),Y(W,["box","sdtp"],w.default),Y(W,["box","SLConfigDescriptor"],k.default),Y(W,["box","smhd"],S.default),Y(W,["box","stco"],b.default),Y(W,["box","stsc"],_.default),Y(W,["box","stsd"],y.default),Y(W,["box","stsh"],m.default),Y(W,["box","stss"],v.default),Y(W,["box","stsz"],g.default),Y(W,["box","stts"],h.default),Y(W,["box","stz2"],p.default),Y(W,["box","tfhd"],f.default),Y(W,["box","tkhd"],d.default),Y(W,["box","traf"],c.default),Y(W,["box","trun"],l.default),Y(W,["box","udta"],u.default),Y(W,["box","url"],s.default),Y(W,["box","vmhd"],a.default),t.default=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.buffer=null,this.boxes=[],this.nextBox=null,this.start=0,this.buffer?(0,i.default)(Uint8Array,this.buffer,t):this.buffer=t;var n=t.byteLength;t.position=0;for(var a=new o.default(t);n-a.position>=8;){var s=new r.default;if(s.readHeader(a),s.size-8<=n-a.position)s.readBody(a),this.boxes.push(s);else{if("mdat"!==s.type){this.nextBox=s,a.position-=8;break}s.readBody(a),this.boxes.push(s)}}this.buffer=new Uint8Array(this.buffer.slice(a.position))},e.exports=t.default},function(e){e.exports=JSON.parse('{"version":"1.2.4"}')},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=0,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=!0,a=!1,s=void 0;try{for(var u,l=r[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;t+=c.length}}catch(e){a=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}var d=new e(t),f=0,p=!0,h=!1,g=void 0;try{for(var v,m=r[Symbol.iterator]();!(p=(v=m.next()).done);p=!0){var y=v.value;d.set(y,f),f+=y.length}}catch(e){h=!0,g=e}finally{try{!p&&m.return&&m.return()}finally{if(h)throw g}}return d}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.vmhd=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()],this.graphicsmode=e.readUint16(),this.opcolor=[e.readUint16(),e.readUint16(),e.readUint16()],delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default["url "]=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()];for(var t=[],n=e.buffer.byteLength;e.position<n;)t.push(e.readUint8());this.location=t,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r,i=n(0);((r=i)&&r.__esModule?r:{default:r}).default.udta=function(){delete this.subBox}},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1)),o=a(n(15));function a(e){return e&&e.__esModule?e:{default:e}}r.default.tkhd=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3,0),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new o.default).setTime(1e3*this.create),this.modifyTime=(new o.default).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new o.default).setTime(1e3*this.create),this.modifyTime=(new o.default).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint32()),e.readUint64(),this.layer=e.readInt16(),this.alternate_group=e.readInt16(),this.volume=e.readInt16()>>8,e.readUint16();for(var t=[],n=0;n<9;n++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,this.width=e.readUint16()+"."+e.readUint16(),this.height=e.readUint16()+"."+e.readUint16(),delete this.data,delete this.subBox,e=null}},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.stts=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.count=e.readUint32();for(var t=[],n=0,r=this.count;n<r;n++)t.push({sampleCount:e.readUint32(),sampleDuration:e.readUint32()});this.entry=t,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.stsz=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.sampleSize=e.readUint32(),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;n<r;n++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.stss=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;n<r;n++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}},function(e,t,n){},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.stsd=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=new r.default;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.stsc=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;n<r;n++)t.push({first_chunk:e.readUint32(),samples_per_chunk:e.readUint32(),sample_desc_index:e.readUint32()});for(var o,a,s=0,u=this.count;s<u-1;s++)o=t[s],a=t[s-1],o.chunk_count=t[s+1].first_chunk-o.first_chunk,o.first_sample=0===s?1:a.first_sample+a.chunk_count*a.samples_per_chunk;if(1===this.count){var l=t[0];l.first_sample=1,l.chunk_count=0}else if(this.count>1){var c=t[this.count-1],d=t[this.count-2];c.first_sample=d.first_sample+d.chunk_count*d.samples_per_chunk,c.chunk_count=0}delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.stco=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;n<r;n++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.smhd=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.balance=e.readInt8()+"."+e.readInt8(),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r,i=n(0),o=(r=i)&&r.__esModule?r:{default:r};o.default.SLConfigDescriptor=function(e){var t=new o.default,n=void 0;return t.type=e.readUint8(),128===(n=e.readUint8())?(t.extend=!0,e.skip(2),n=e.readUint8()+5):n+=2,t.size=n,t.SL=e.readUint8(),delete t.subBox,t}},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.pasp=function(){var e=new i.default(this.data);this.content=e.buffer.slice(0,this.size-8),delete this.subBox,delete this.data,e=null}},function(e,t,n){},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1)),o=a(n(15));function a(e){return e&&e.__esModule?e:{default:e}}r.default.mvhd=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new o.default).setTime(1e3*this.create),this.modifyTime=(new o.default).setTime(1e3*this.modify),this.timeScale=e.readUint32(),this.duration=e.readUint32(),this.rate=e.readUint16()+"."+e.readUint16(),this.volume=e.readUint8()+"."+e.readUint8(),i.default.readByte(e.dataview,8),i.default.readByte(e.dataview,2);for(var t=[],n=0;n<9;n++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,i.default.readByte(e.dataview,24),this.nextTrackID=e.readUint32(),delete this.subBox,delete this.data}},function(e,t,n){"use strict";var r,i=n(0),o=(r=i)&&r.__esModule?r:{default:r};o.default.MP4ESDescrTag=function(e){var t=new o.default,n=void 0;return t.type=e.readUint8(),128===(n=e.readUint8())?(t.extend=!0,e.skip(2),n=e.readUint8()+5):n+=2,t.size=n,t.esID=e.readUint16(),t.priority=e.readUint8(),t.subBox.push(o.default.MP4DecConfigDescrTag(e)),t.subBox.push(o.default.SLConfigDescriptor(e)),t}},function(e,t,n){"use strict";var r,i=n(0),o=(r=i)&&r.__esModule?r:{default:r};o.default.MP4DecSpecificDescrTag=function(e){var t=new o.default,n=void 0,r=void 0;t.type=e.readUint8(),128===(n=e.readUint8())?(t.extend=!0,e.skip(2),r=(n=e.readUint8()+5)-5):(r=n,n+=2),t.size=n;for(var i=[],a=0;a<r;a++)i.push(Number(e.readUint8()).toString(16).padStart(2,"0"));return t.EScode=i,delete t.subBox,t}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.MP4DecConfigDescrTag=function(e){var t=new r.default,n=void 0;return t.type=e.readUint8(),128===(n=e.readUint8())?(t.extend=!0,e.skip(2),n=e.readUint8()+5):n+=2,t.size=n,t.typeID=e.readUint8(),t.streamUint=e.readUint8(),t.bufferSize=i.default.readByte(e.dataview,3),t.maximum=e.readUint32(),t.average=e.readUint32(),t.subBox.push(r.default.MP4DecSpecificDescrTag(e)),t}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.mp4a=function(){var e=new i.default(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(8),this.channelCount=e.readUint16(),this.sampleSize=e.readUint16(),e.skip(4),this.sampleRate=e.readUint32()>>16;var t=new r.default;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null}},function(e,t,n){},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1)),o=a(n(15));function a(e){return e&&e.__esModule?e:{default:e}}r.default.mdhd=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new o.default).setTime(1e3*this.create),this.modifyTime=(new o.default).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new o.default).setTime(1e3*this.create),this.modifyTime=(new o.default).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.language=e.readUint16(),e.readUint16(),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r,i=n(0);((r=i)&&r.__esModule?r:{default:r}).default.mdat=function(){delete this.subBox}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.iods=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3);for(var t=[],n=e.buffer.byteLength;e.position<n;)t.push(e.readUint8());this.content=t,delete this.subBox,delete this.data,e=null}},function(e,t,n){},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.hdlr=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),e.skip(4),this.handleType=""+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8()),e.skip(12);for(var t=[];e.position<this.size-8;)t.push(String.fromCharCode(e.readUint8()));this.name=t.join(""),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.ftyp=function(){var e=new i.default(this.data);this.major_brand=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),this.minor_version=e.readUint32();for(var t=[],n=0,r=Math.floor((e.buffer.byteLength-8)/4);n<r;n++)t.push(String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()));this.compatible_brands=t,e=null,delete this.subBox,delete this.data}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.esds=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3);var t=r.default.MP4ESDescrTag(e);this.subBox.push(t),delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.elst=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3);var t=[],n=e.readUint32();this.empty_duration=0,this.start_time=0;var r=0;this.entries=t;for(var o=0;o<n;o++){var a={};t.push(a),1===this.version?(a.segment_duration=e.readUint64(),a.media_time=e.readUint64()):(a.segment_duration=e.readUint32(),a.media_time=e.readInt32()),a.media_rate_integer=e.readInt16(),a.media_rate_fraction=e.readInt16(),0===o&&-1===a.media_time?(this.empty_duration=a.segment_duration,r=1):o===r&&a.media_time>=0&&(this.start_time=a.media_time)}delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.dref=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3);var t=e.readUint32();this.entryCount=t;for(var n=0;n<t;n++){var o=new r.default;this.subBox.push(o),o.read(e)}delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.ctts=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=[];this.entry=t;for(var n=0,r=this.entryCount;n<r;n++)t.push({count:e.readUint32(),offset:e.readUint32()});delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.co64=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;n<r;n++)t.push(e.readUint64());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.btrt=function(){var e=new i.default(this.data);this.bufferSizeDB=e.readUint32(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32(),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.avcC=function(){var e=new i.default(this.data);this.configVersion=e.readUint8(),this.profile=e.readUint8(),this.profileCompatibility=e.readUint8(),this.AVCLevelIndication=e.readUint8(),this.lengthSizeMinusOne=1+(3&e.readUint8()),this.numOfSequenceParameterSets=31&e.readUint8();var t=e.readUint16();this.sequenceLength=t;for(var n=[],r=0;r<t;r++)n.push(Number(e.readUint8()).toString(16));this.ppsCount=e.readUint8();var o=e.readUint16();this.ppsLength=o;for(var a=[],s=0;s<o;s++)a.push(Number(e.readUint8()).toString(16));this.pps=a,this.sequence=n;for(var u=[],l=e.dataview.byteLength;e.position<l;)u.push(e.readUint8());this.last=u,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1));function o(e){return e&&e.__esModule?e:{default:e}}r.default.avc1=function(){var e=new i.default(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.skip(4),this.frameCount=e.readUint16(),e.skip(1);for(var t=0;t<31;t++)String.fromCharCode(e.readUint8());for(this.depth=e.readUint16(),e.skip(2);e.position<e.buffer.byteLength;){var n=new r.default;n.readHeader(e),this.subBox.push(n),n.readBody(e)}delete this.data,e=null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(16),a=(r=o)&&r.__esModule?r:{default:r},s=Math.pow(2,32)-1,u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"type",value:function(e){return new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)])}},{key:"size",value:function(e){return a.default.writeUint32(e)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){var t=new a.default;return t.write(e.size(24),e.type("ftyp"),new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])),t.buffer}},{key:"moov",value:function(t){var n=new a.default,r=8,i=e.mvhd(t.duration,t.timeScale),o=e.videoTrak(t),s=void 0;e.videoOnly||(s=e.audioTrak(t));var u=e.mvex(t.duration,t.timeScale);return(e.videoOnly?[i,o,u]:[i,o,s,u]).forEach(function(e){r+=e.byteLength}),e.videoOnly?n.write(e.size(r),e.type("moov"),i,o,u):n.write(e.size(r),e.type("moov"),i,o,s,u),n.buffer}},{key:"mvhd",value:function(t,n){var r=new a.default;t*=n;var i=Math.floor(t/(s+1)),o=Math.floor(t%(s+1)),u=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return r.write(e.size(8+u.length),e.type("mvhd"),new Uint8Array(u)),r.buffer}},{key:"videoTrak",value:function(t){var n=new a.default,r=8,i=e.tkhd({id:1,duration:t.videoDuration,timescale:t.videoTimeScale,width:t.width,height:t.height,type:"video"}),o=e.mdia({type:"video",timescale:t.videoTimeScale,duration:t.videoDuration,sps:t.sps,pps:t.pps,pixelRatio:t.pixelRatio,width:t.width,height:t.height});return[i,o].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("trak"),i,o),n.buffer}},{key:"audioTrak",value:function(t){var n=new a.default,r=8,i=e.tkhd({id:2,duration:t.audioDuration,timescale:t.audioTimeScale,width:0,height:0,type:"audio"}),o=e.mdia({type:"audio",timescale:t.audioTimeScale,duration:t.audioDuration,channelCount:t.channelCount,samplerate:t.sampleRate,audioConfig:t.audioConfig});return[i,o].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("trak"),i,o),n.buffer}},{key:"tkhd",value:function(t){var n=new a.default,r=t.id,i=t.duration*t.timeScale,o=t.width,u=t.height,l=t.type,c=Math.floor(i/(s+1)),d=Math.floor(i%(s+1)),f=new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d,0,0,0,0,0,0,0,0,0,0,0,"video"===l?1:0,"audio"===l?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,u>>8&255,255&u,0,0]);return n.write(e.size(8+f.byteLength),e.type("tkhd"),f),n.buffer}},{key:"edts",value:function(t){var n=new a.default,r=t.duration,i=t.mediaTime;return n.write(e.size(36),e.type("edts")),n.write(e.size(28),e.type("elst")),n.write(new Uint8Array([0,0,0,1,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,1])),n.buffer}},{key:"mdia",value:function(t){var n=new a.default,r=8,i=e.mdhd(t.timescale,t.duration),o=e.hdlr(t.type),s=e.minf(t);return[i,o,s].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("mdia"),i,o,s),n.buffer}},{key:"mdhd",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new a.default;n*=t;var i=Math.floor(n/(s+1)),o=Math.floor(n%(s+1)),u=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]);return r.write(e.size(12+u.byteLength),e.type("mdhd"),e.extension(1,0),u),r.buffer}},{key:"hdlr",value:function(t){var n=new a.default,r=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(r.splice.apply(r,[8,4].concat([115,111,117,110])),r.splice.apply(r,[24,13].concat([83,111,117,110,100,72,97,110,100,108,101,114,0]))),n.write(e.size(8+r.length),e.type("hdlr"),new Uint8Array(r)),n.buffer}},{key:"minf",value:function(t){var n=new a.default,r=8,i="video"===t.type?e.vmhd():e.smhd(),o=e.dinf(),s=e.stbl(t);return[i,o,s].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("minf"),i,o,s),n.buffer}},{key:"vmhd",value:function(){var t=new a.default;return t.write(e.size(20),e.type("vmhd"),new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])),t.buffer}},{key:"smhd",value:function(){var t=new a.default;return t.write(e.size(16),e.type("smhd"),new Uint8Array([0,0,0,0,0,0,0,0])),t.buffer}},{key:"dinf",value:function(){var t=new a.default;return t.write(e.size(36),e.type("dinf"),e.size(28),e.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),t.buffer}},{key:"stbl",value:function(t){var n=new a.default,r=8,i=e.stsd(t),o=e.stts(),s=e.stsc(),u=e.stsz(),l=e.stco();return[i,o,s,u,l].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("stbl"),i,o,s,u,l),n.buffer}},{key:"stsd",value:function(t){var n=new a.default,r=void 0;return r="audio"===t.type?e.mp4a(t):e.avc1(t),n.write(e.size(16+r.byteLength),e.type("stsd"),e.extension(0,0),new Uint8Array([0,0,0,1]),r),n.buffer}},{key:"mp4a",value:function(t){var n=new a.default,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),i=e.esds(t.audioConfig);return n.write(e.size(8+r.byteLength+i.byteLength),e.type("mp4a"),r,i),n.buffer}},{key:"esds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[43,146,8,0],n=t.length,r=new a.default,i=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(t).concat([6,1,2]));return r.write(e.size(8+i.byteLength),e.type("esds"),i),r.buffer}},{key:"avc1",value:function(t){var n=new a.default,r=t.sps,i=t.pps,o=t.width,s=t.height,u=t.pixelRatio[0],l=t.pixelRatio[1],c=new Uint8Array([1,r[1],r[2],r[3],255,225].concat([r.length>>>8&255,255&r.length]).concat(r).concat(1).concat([i.length>>>8&255,255&i.length]).concat(i)),d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,s>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),p=new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,l>>24,l>>16&255,l>>8&255,255&l]);return n.write(e.size(40+d.byteLength+c.byteLength+f.byteLength),e.type("avc1"),d,e.size(8+c.byteLength),e.type("avcC"),c,e.size(20),e.type("btrt"),f,e.size(16),e.type("pasp"),p),n.buffer}},{key:"stts",value:function(){var t=new a.default,n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stts"),n),t.buffer}},{key:"stsc",value:function(){var t=new a.default,n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stsc"),n),t.buffer}},{key:"stco",value:function(){var t=new a.default,n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stco"),n),t.buffer}},{key:"stsz",value:function(){var t=new a.default,n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return t.write(e.size(20),e.type("stsz"),n),t.buffer}},{key:"mvex",value:function(t,n){var r=new a.default,i=a.default.writeUint32(t*n);return r.write(e.size(88),e.type("mvex"),e.size(16),e.type("mehd"),e.extension(0,0),i,e.trex(1),e.trex(2)),r.buffer}},{key:"trex",value:function(t){var n=new a.default,r=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return n.write(e.size(8+r.byteLength),e.type("trex"),r),n.buffer}},{key:"moof",value:function(t){var n=new a.default,r=8,i=e.mfhd(),o=e.traf(t);return[i,o].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("moof"),i,o),n.buffer}},{key:"mfhd",value:function(){var t=new a.default,n=a.default.writeUint32(e.sequence);return e.sequence+=1,t.write(e.size(16),e.type("mfhd"),e.extension(0,0),n),t.buffer}},{key:"traf",value:function(t){var n=new a.default,r=8,i=e.tfhd(t.id),o=e.tfdt(t.time),s=e.sdtp(t),u=e.trun(t,s.byteLength);return[i,o,s,u].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("traf"),i,o,s,u),n.buffer}},{key:"tfhd",value:function(t){var n=new a.default,r=a.default.writeUint32(t);return n.write(e.size(16),e.type("tfhd"),e.extension(0,0),r),n.buffer}},{key:"tfdt",value:function(t){var n=new a.default,r=Math.floor(t/(s+1)),i=Math.floor(t%(s+1));return n.write(e.size(20),e.type("tfdt"),e.extension(1,0),a.default.writeUint32(r),a.default.writeUint32(i)),n.buffer}},{key:"trun",value:function(t,n){var r=t.id,i=1===r?16:12,o=new a.default,s=a.default.writeUint32(t.samples.length),u=a.default.writeUint32(96+i*t.samples.length+n);return o.write(e.size(20+i*t.samples.length),e.type("trun"),e.extension(0,t.flags),s,u),t.samples.forEach(function(e,t){o.write(a.default.writeUint32(e.duration)),o.write(a.default.writeUint32(e.size)),1===r?(o.write(a.default.writeUint32(e.key?33554432:16842752)),o.write(a.default.writeUint32(e.offset))):o.write(a.default.writeUint32(16777216))}),o.buffer}},{key:"sdtp",value:function(t){var n=new a.default;return n.write(e.size(12+t.samples.length),e.type("sdtp"),e.extension(0,0)),t.samples.forEach(function(e){n.write(new Uint8Array(1===t.id?[e.key?32:16]:[16]))}),n.buffer}},{key:"mdat",value:function(t){var n=new a.default,r=8;return t.samples.forEach(function(e){r+=e.size}),n.write(e.size(r),e.type("mdat")),t.samples.forEach(function(e){n.write(e.buffer)}),n.buffer}}]),e}();u.sequence=1,t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={findBox:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e.type!==t){if(e&&e.subBox){var i=e.subBox.filter(function(e){return e.type===t});i.length?i.forEach(function(e){return n.push(e)}):e.subBox.forEach(function(e){return r.findBox(e,t,n)})}}else n.push(e);return(n=[].concat(n)).length>1?n:n[0]},padStart:function(e,t,n){for(var r=String(n),i=t>>0,o=Math.ceil(i/r.length),a=[],s=String(e);o--;)a.push(r);return a.join("").substring(0,i-s.length)+s},toHex:function(){for(var e=[],t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.forEach(function(t){e.push(r.padStart(Number(t).toString(16),2,0))}),e},sum:function(){for(var e=0,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach(function(t){e+=t}),e},stscOffset:function(e,t){var n=e.entries.filter(function(e){return e.first_sample<=t&&t<e.first_sample+e.chunk_count*e.samples_per_chunk})[0];if(n){var r=Math.floor((t-n.first_sample)/n.samples_per_chunk),i=n.first_sample+r*n.samples_per_chunk;return{chunk_index:n.first_chunk+r,samples_offset:[i,t]}}var o=e.entries.pop();e.entries.push(o);var a=Math.floor((t-o.first_sample)/o.samples_per_chunk);return{chunk_index:o.first_chunk+a,samples_offset:[o.first_sample+o.samples_per_chunk*a,t]}},seekSampleOffset:function(e,t,n,i,o){var a=r.stscOffset(e,i+1),s=t.entries[a.chunk_index-1]+r.sum.apply(null,n.entries.slice(a.samples_offset[0]-1,a.samples_offset[1]-1))-o;if(void 0===s)throw"result="+s+",stco.length="+t.entries.length+",sum="+r.sum.apply(null,n.entries.slice(0,i));if(s<0)throw"result="+s+",stco.length="+t.entries.length+",sum="+r.sum.apply(null,n.entries.slice(0,i));return s},seekSampleTime:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=void 0,o=void 0,a=0,s=0,u=0;if(e.entry.every(function(e){return o=e.sampleDuration,n<a+e.sampleCount?(i=s+(n-a)*e.sampleDuration,!1):(a+=e.sampleCount,s+=e.sampleCount*o,!0)}),t){var l=0;t.entry.every(function(e){return l+=e.count,!(n<l&&(u=e.offset,1))})}return i||(i=s+(n-a)*o),{time:i-=r,duration:o,offset:u}},seekOrderSampleByTime:function(e,t,n){var r=0,i=0,o=0,a=void 0;return e.every(function(e,s){return a=e.sampleCount*e.sampleDuration/t,n<=r+a?(i=o+Math.ceil((n-r)*t/e.sampleDuration),r+=Math.ceil((n-r)*t/e.sampleDuration)*e.sampleDuration/t,!1):(r+=a,o+=e.sampleCount,!0)}),{order:i,startTime:r}},seekTrakDuration:function(e,t){var n=r.findBox(e,"stts"),i=0;return n.entry.forEach(function(e){i+=e.sampleCount*e.sampleDuration}),Number(i/t).toFixed(4)}};t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=a(n(13)),o=a(n(7));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.64001E, mp4a.40.5"';!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=this;(0,i.default)(this),this.codecs=t,this.mediaSource=new window.MediaSource,this.url=window.URL.createObjectURL(this.mediaSource),this.queue=[],this.updating=!1,this.mediaSource.addEventListener("sourceopen",function(){n.sourceBuffer=n.mediaSource.addSourceBuffer(n.codecs),n.sourceBuffer.addEventListener("error",function(e){n.emit("error",new o.default("mse","",{line:16,handle:"[MSE] constructor sourceopen",msg:e.message}))}),n.sourceBuffer.addEventListener("updateend",function(e){n.emit("updateend");var t=n.queue.shift();t&&n.sourceBuffer&&!n.sourceBuffer.updating&&"open"===n.state&&n.sourceBuffer.appendBuffer(t)}),n.emit("sourceopen")}),this.mediaSource.addEventListener("sourceclose",function(){n.emit("sourceclose")})}return r(e,[{key:"appendBuffer",value:function(e){var t=this.sourceBuffer;return t&&!t.updating&&"open"===this.state?(t.appendBuffer(e),!0):(this.queue.push(e),!1)}},{key:"removeBuffer",value:function(e,t){this.sourceBuffer.remove(e,t)}},{key:"endOfStream",value:function(){"open"===this.state&&this.mediaSource.endOfStream()}},{key:"state",get:function(){return this.mediaSource.readyState}},{key:"duration",get:function(){return this.mediaSource.duration},set:function(e){this.mediaSource.duration=e}}],[{key:"isSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported(e)}}]),e}();t.default=s,e.exports=t.default}]))},1504:function(e,t,n){(function(t){e.exports=function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};function n(e,t){return e(t={exports:{}},t.exports),t.exports}var r=function(e){return e&&e.Math==Math&&e},i=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof e&&e)||Function("return this")(),o=function(e){try{return!!e()}catch(e){return!0}},a=!o(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),s={}.propertyIsEnumerable,u=Object.getOwnPropertyDescriptor,l={f:u&&!s.call({1:2},1)?function(e){var t=u(this,e);return!!t&&t.enumerable}:s},c=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},d={}.toString,f=function(e){return d.call(e).slice(8,-1)},p="".split,h=o(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==f(e)?p.call(e,""):Object(e)}:Object,g=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},v=function(e){return h(g(e))},m=function(e){return"object"==typeof e?null!==e:"function"==typeof e},y=function(e,t){if(!m(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!m(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!m(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!m(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},_={}.hasOwnProperty,b=function(e,t){return _.call(e,t)},S=i.document,k=m(S)&&m(S.createElement),w=function(e){return k?S.createElement(e):{}},E=!a&&!o(function(){return 7!=Object.defineProperty(w("div"),"a",{get:function(){return 7}}).a}),T=Object.getOwnPropertyDescriptor,x={f:a?T:function(e,t){if(e=v(e),t=y(t,!0),E)try{return T(e,t)}catch(e){}if(b(e,t))return c(!l.f.call(e,t),e[t])}},C=function(e){if(!m(e))throw TypeError(String(e)+" is not an object");return e},I=Object.defineProperty,R={f:a?I:function(e,t,n){if(C(e),t=y(t,!0),C(n),E)try{return I(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},A=a?function(e,t,n){return R.f(e,t,c(1,n))}:function(e,t,n){return e[t]=n,e},O=function(e,t){try{A(i,e,t)}catch(n){i[e]=t}return t},M=i["__core-js_shared__"]||O("__core-js_shared__",{}),D=Function.toString;"function"!=typeof M.inspectSource&&(M.inspectSource=function(e){return D.call(e)});var L,P,N,U=M.inspectSource,F=i.WeakMap,j="function"==typeof F&&/native code/.test(U(F)),G=n(function(e){(e.exports=function(e,t){return M[e]||(M[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.1",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),B=0,V=Math.random(),q=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++B+V).toString(36)},H=G("keys"),z=function(e){return H[e]||(H[e]=q(e))},K={},W=i.WeakMap;if(j){var Y=new W,J=Y.get,X=Y.has,Q=Y.set;L=function(e,t){return Q.call(Y,e,t),t},P=function(e){return J.call(Y,e)||{}},N=function(e){return X.call(Y,e)}}else{var Z=z("state");K[Z]=!0,L=function(e,t){return A(e,Z,t),t},P=function(e){return b(e,Z)?e[Z]:{}},N=function(e){return b(e,Z)}}var $,ee,te={set:L,get:P,has:N,enforce:function(e){return N(e)?P(e):L(e,{})},getterFor:function(e){return function(t){var n;if(!m(t)||(n=P(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},ne=n(function(e){var t=te.get,n=te.enforce,r=String(String).split("String");(e.exports=function(e,t,o,a){var s=!!a&&!!a.unsafe,u=!!a&&!!a.enumerable,l=!!a&&!!a.noTargetGet;"function"==typeof o&&("string"!=typeof t||b(o,"name")||A(o,"name",t),n(o).source=r.join("string"==typeof t?t:"")),e!==i?(s?!l&&e[t]&&(u=!0):delete e[t],u?e[t]=o:A(e,t,o)):u?e[t]=o:O(t,o)})(Function.prototype,"toString",function(){return"function"==typeof this&&t(this).source||U(this)})}),re=i,ie=function(e){return"function"==typeof e?e:void 0},oe=function(e,t){return arguments.length<2?ie(re[e])||ie(i[e]):re[e]&&re[e][t]||i[e]&&i[e][t]},ae=Math.ceil,se=Math.floor,ue=function(e){return isNaN(e=+e)?0:(e>0?se:ae)(e)},le=Math.min,ce=function(e){return e>0?le(ue(e),9007199254740991):0},de=Math.max,fe=Math.min,pe=function(e,t){var n=ue(e);return n<0?de(n+t,0):fe(n,t)},he=function(e){return function(t,n,r){var i,o=v(t),a=ce(o.length),s=pe(r,a);if(e&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},ge={includes:he(!0),indexOf:he(!1)},ve=ge.indexOf,me=function(e,t){var n,r=v(e),i=0,o=[];for(n in r)!b(K,n)&&b(r,n)&&o.push(n);for(;t.length>i;)b(r,n=t[i++])&&(~ve(o,n)||o.push(n));return o},ye=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],_e=ye.concat("length","prototype"),be={f:Object.getOwnPropertyNames||function(e){return me(e,_e)}},Se={f:Object.getOwnPropertySymbols},ke=oe("Reflect","ownKeys")||function(e){var t=be.f(C(e)),n=Se.f;return n?t.concat(n(e)):t},we=function(e,t){for(var n=ke(t),r=R.f,i=x.f,o=0;o<n.length;o++){var a=n[o];b(e,a)||r(e,a,i(t,a))}},Ee=/#|\.prototype\./,Te=function(e,t){var n=Ce[xe(e)];return n==Re||n!=Ie&&("function"==typeof t?o(t):!!t)},xe=Te.normalize=function(e){return String(e).replace(Ee,".").toLowerCase()},Ce=Te.data={},Ie=Te.NATIVE="N",Re=Te.POLYFILL="P",Ae=Te,Oe=x.f,Me=function(e,t){var n,r,o,a,s,u=e.target,l=e.global,c=e.stat;if(n=l?i:c?i[u]||O(u,{}):(i[u]||{}).prototype)for(r in t){if(a=t[r],o=e.noTargetGet?(s=Oe(n,r))&&s.value:n[r],!Ae(l?r:u+(c?".":"#")+r,e.forced)&&void 0!==o){if(typeof a==typeof o)continue;we(a,o)}(e.sham||o&&o.sham)&&A(a,"sham",!0),ne(n,r,a,e)}},De=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Le=function(e,t,n){if(De(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},Pe=function(e){return Object(g(e))},Ne=Array.isArray||function(e){return"Array"==f(e)},Ue=!!Object.getOwnPropertySymbols&&!o(function(){return!String(Symbol())}),Fe=Ue&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,je=G("wks"),Ge=i.Symbol,Be=Fe?Ge:Ge&&Ge.withoutSetter||q,Ve=function(e){return b(je,e)||(Ue&&b(Ge,e)?je[e]=Ge[e]:je[e]=Be("Symbol."+e)),je[e]},qe=Ve("species"),He=function(e,t){var n;return Ne(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!Ne(n.prototype)?m(n)&&null===(n=n[qe])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},ze=[].push,Ke=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=5==e||o;return function(s,u,l,c){for(var d,f,p=Pe(s),g=h(p),v=Le(u,l,3),m=ce(g.length),y=0,_=c||He,b=t?_(s,m):n?_(s,0):void 0;m>y;y++)if((a||y in g)&&(f=v(d=g[y],y,p),e))if(t)b[y]=f;else if(f)switch(e){case 3:return!0;case 5:return d;case 6:return y;case 2:ze.call(b,d)}else if(i)return!1;return o?-1:r||i?i:b}},We={forEach:Ke(0),map:Ke(1),filter:Ke(2),some:Ke(3),every:Ke(4),find:Ke(5),findIndex:Ke(6)},Ye=oe("navigator","userAgent")||"",Je=i.process,Xe=Je&&Je.versions,Qe=Xe&&Xe.v8;Qe?ee=($=Qe.split("."))[0]+$[1]:Ye&&(!($=Ye.match(/Edge\/(\d+)/))||$[1]>=74)&&($=Ye.match(/Chrome\/(\d+)/))&&(ee=$[1]);var Ze=ee&&+ee,$e=Ve("species"),et=function(e){return Ze>=51||!o(function(){var t=[];return(t.constructor={})[$e]=function(){return{foo:1}},1!==t[e](Boolean).foo})},tt=We.filter,nt=et("filter"),rt=nt&&!o(function(){[].filter.call({length:-1,0:1},function(e){throw e})});Me({target:"Array",proto:!0,forced:!nt||!rt},{filter:function(e){return tt(this,e,arguments.length>1?arguments[1]:void 0)}});var it=We.map,ot=et("map"),at=ot&&!o(function(){[].map.call({length:-1,0:1},function(e){throw e})});function st(e){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ut(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function lt(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){ut(o,r,i,a,s,"next",e)}function s(e){ut(o,r,i,a,s,"throw",e)}a(void 0)})}}function ct(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ft(e,t,n){return t&&dt(e.prototype,t),n&&dt(e,n),e}function pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){pt(e,t,n[t])})}return e}function gt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}function vt(e){return(vt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function yt(e,t,n){return(yt=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&mt(i,n.prototype),i}).apply(null,arguments)}function _t(e){var t="function"==typeof Map?new Map:void 0;return(_t=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return yt(e,arguments,vt(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),mt(r,e)})(e)}function bt(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function St(e,t,n){return(St="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=vt(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function kt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function wt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}Me({target:"Array",proto:!0,forced:!ot||!at},{map:function(e){return it(this,e,arguments.length>1?arguments[1]:void 0)}}),n(function(e){!function(t){var n,r=Object.prototype,i=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag",l=t.regeneratorRuntime;if(l)e.exports=l;else{(l=t.regeneratorRuntime=e.exports).wrap=_;var c="suspendedStart",d="suspendedYield",f="executing",p="completed",h={},g={};g[a]=function(){return this};var v=Object.getPrototypeOf,m=v&&v(v(A([])));m&&m!==r&&i.call(m,a)&&(g=m);var y=w.prototype=S.prototype=Object.create(g);k.prototype=y.constructor=w,w.constructor=k,w[u]=k.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===k||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(y),e},l.awrap=function(e){return{__await:e}},E(T.prototype),T.prototype[s]=function(){return this},l.AsyncIterator=T,l.async=function(e,t,n,r){var i=new T(_(e,t,n,r));return l.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},E(y),y[u]="Generator",y[a]=function(){return this},y.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},l.values=A,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),h}}}function _(e,t,n,r){var i=t&&t.prototype instanceof S?t:S,o=Object.create(i.prototype),a=new R(r||[]);return o._invoke=function(e,t,n){var r=c;return function(i,o){if(r===f)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw o;return O()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===c)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var u=b(e,t,n);if("normal"===u.type){if(r=n.done?p:d,u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=p,n.method="throw",n.arg=u.arg)}}}(e,n,a),o}function b(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function S(){}function k(){}function w(){}function E(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function T(e){var t;this._invoke=function(n,r){function o(){return new Promise(function(t,o){!function t(n,r,o,a){var s=b(e[n],e,r);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==typeof l&&i.call(l,"__await")?Promise.resolve(l.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(l).then(function(e){u.value=e,o(u)},a)}a(s.arg)}(n,r,t,o)})}return t=t?t.then(o,o):o()}}function x(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,x(e,t),"throw"===t.method))return h;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var i=b(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,h):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function A(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())});let Et=!0,Tt=!0;function xt(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Ct(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&r(t)};return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);const r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function It(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Et=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Rt(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Tt=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function At(){if("object"==typeof window){if(Et)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Ot(e,t){Tt&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Mt(e){const{navigator:t}=e,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=xt(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)n.browser="chrome",n.version=xt(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=xt(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=xt(t.userAgent,/AppleWebKit\/(\d+)\./,1),n.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return n}function Dt(e){return"[object Object]"===Object.prototype.toString.call(e)}function Lt(e){return Dt(e)?Object.keys(e).reduce(function(t,n){const r=Dt(e[n]),i=r?Lt(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})},{}):e}function Pt(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(t=>{e.forEach(n=>{n.type===r&&n.trackId===t.id&&function e(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach(i=>{i.endsWith("Id")?e(t,t.get(n[i]),r):i.endsWith("Ids")&&n[i].forEach(n=>{e(t,t.get(n),r)})}))}(e,n,i)})}),i}const Nt=At;function Ut(e){const t=e&&e.navigator;if(!t.mediaDevices)return;const n=Mt(e),r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),(e={})[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(n.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const a=n.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||a)){let n;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?n=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(n=["front"]),n)return t.mediaDevices.enumerateDevices().then(t=>{let a=(t=t.filter(e=>"videoinput"===e.kind)).find(e=>n.some(t=>e.label.toLowerCase().includes(t)));return!a&&t.length&&n.includes("back")&&(a=t[t.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=r(e.video),Nt("chrome: "+JSON.stringify(e)),i(e)})}e.video=r(e.video)}return Nt("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return n.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,n,r){i(e,e=>{t.webkitGetUserMedia(e,n,e=>{r&&r(o(e))})})}.bind(t),t.mediaDevices.getUserMedia){const e=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(o(e))))}}}function Ft(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function jt(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)Ct(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=(t=>{t.stream.addEventListener("addtrack",n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}),t.stream.getTracks().forEach(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})}),this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function Gt(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Bt(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t[n.id]=n}),t},o=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const r=function(e){n(o(i(e)))};return t.apply(this,[r,e])}return new Promise((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])}).then(n,r)}}function Vt(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>Pt(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),Ct(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>Pt(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach(n=>{n.track===e&&(t?r=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?r=!0:n=t),t.track===e)),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function qt(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function Ht(e){if(!e.RTCPeerConnection)return;const t=Mt(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return qt(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find(e=>e.track===t);if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>o(this,e))}};e.RTCPeerConnection.prototype[t]=r[t]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function zt(e){const t=Mt(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!e.RTCPeerConnection)return;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]});const n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}function Kt(e){Ct(e,"negotiationneeded",e=>{if("stable"===e.target.signalingState)return e})}var Wt=Object.freeze({shimMediaStream:Ft,shimOnTrack:jt,shimGetSendersWithDtmf:Gt,shimGetStats:Bt,shimSenderReceiverGetStats:Vt,shimAddTrackRemoveTrackWithNative:qt,shimAddTrackRemoveTrack:Ht,shimPeerConnection:zt,fixNegotiationNeeded:Kt,shimGetUserMedia:Ut,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}),Yt=n(function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},t.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},t.getDescription=function(e){var n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){var n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(function(e){return 0===e.indexOf(n)})},t.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},t.getMid=function(e){var n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.getIceParameters=function(e,n){var r=t.splitLines(e);return{usernameFragment:(r=r.concat(t.splitLines(n))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},t.parseRtpParameters=function(e){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var o=r[i],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=t.parseRtpMap(a),u=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=u.length?t.parseFmtp(u[0]):{},s.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(s.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach(function(e){n.headerExtensions.push(t.parseExtmap(e))}),n},t.writeRtpDescription=function(e,n){var r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=n.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(function(e){r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)});var i=0;return n.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",n.headerExtensions&&n.headerExtensions.forEach(function(e){r+=t.writeExtmap(e)}),r},t.parseRtpEncodingParameters=function(e){var n,r=[],i=t.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),u=s.length>0&&s[0].ssrc,l=t.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});l.length>0&&l[0].length>1&&l[0][0]===u&&(n=l[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:u,codecPayloadType:parseInt(e.parameters.apt,10)};u&&n&&(t.rtx={ssrc:n}),r.push(t),o&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:u,mechanism:a?"red+ulpfec":"red"},r.push(t))}}),0===r.length&&u&&r.push({ssrc:u});var c=t.matchPrefix(e,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=c})),r},t.parseRtcpParameters=function(e){var n={},r=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);var i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;var o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.parseMsid=function(e){var n,r=t.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(n=r[0].substr(7).split(" "))[0],track:n[1]};var i=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(n=i[0].value.split(" "))[0],track:n[1]}:void 0},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,r){var i=void 0!==n?n:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.writeMediaSection=function(e,n,r,i){var o=t.writeRtpDescription(e.kind,n);if(o+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),o},t.getDirection=function(e,n){for(var r=t.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){var n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var n=t.splitLines(e),r=0;r<n.length;r++)if(n[r].length<2||"="!==n[r].charAt(1))return!1;return!0},e.exports=t});function Jt(e,t,n,r,i){var o=Yt.writeRtpDescription(e.kind,t);if(o+=Yt.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=Yt.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":i||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s="msid:"+(r?r.id:"-")+" "+a+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+Yt.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+Yt.localCName+"\r\n"),o}function Xt(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!i(r,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function Qt(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function Zt(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function $t(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}var en=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function r(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var i=function(n){var r=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw $t("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var o=n.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=Yt.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(i.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(i.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),i.prototype.onicecandidate=null,i.prototype.onaddstream=null,i.prototype.ontrack=null,i.prototype.onremovestream=null,i.prototype.onsignalingstatechange=null,i.prototype.oniceconnectionstatechange=null,i.prototype.onconnectionstatechange=null,i.prototype.onicegatheringstatechange=null,i.prototype.onnegotiationneeded=null,i.prototype.ondatachannel=null,i.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},i.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},i.prototype.getConfiguration=function(){return this._config},i.prototype.getLocalStreams=function(){return this.localStreams},i.prototype.getRemoteStreams=function(){return this.remoteStreams},i.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},i.prototype.addTrack=function(t,n){if(this._isClosed)throw $t("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find(function(e){return e.track===t}))throw $t("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},i.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},i.prototype.removeTrack=function(t){if(this._isClosed)throw $t("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw $t("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},i.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},i.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},i.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},i.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},i.prototype._gather=function(t,n){var r=this,i=this.transceivers[n].iceGatherer;if(!i.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),i.onlocalcandidate=function(e){if(!(r.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,s=!a||0===Object.keys(a).length;if(s)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),a.component=1,a.ufrag=i.getLocalParameters().usernameFragment;var u=Yt.writeCandidate(a);o.candidate=Object.assign(o.candidate,Yt.parseCandidate(u)),o.candidate.candidate=u,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var l=Yt.getMediaSections(r._localDescription.sdp);l[o.candidate.sdpMLineIndex]+=s?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",r._localDescription.sdp=Yt.getDescription(r._localDescription.sdp)+l.join("");var c=r.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),s||r._dispatchEvent("icecandidate",o),c&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){i.onlocalcandidate(e)})},0)}},i.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},i.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},i.prototype._transceive=function(e,n,r){var i=Xt(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:Yt.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),r&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},i.prototype.setLocalDescription=function(e){var t,n,r=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject($t("TypeError",'Unsupported type "'+e.type+'"'));if(!Qt("setLocalDescription",e.type,r.signalingState)||r._isClosed)return Promise.reject($t("InvalidStateError","Can not set local "+e.type+" in state "+r.signalingState));if("offer"===e.type)t=Yt.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=Yt.parseRtpParameters(e);r.transceivers[t].localCapabilities=n}),r.transceivers.forEach(function(e,t){r._gather(e.mid,t)});else if("answer"===e.type){t=Yt.splitSections(r._remoteDescription.sdp),n=t.shift();var i=Yt.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var o=r.transceivers[t],a=o.iceGatherer,s=o.iceTransport,u=o.dtlsTransport,l=o.localCapabilities,c=o.remoteCapabilities;if(!(Yt.isRejected(e)&&0===Yt.matchPrefix(e,"a=bundle-only").length||o.rejected)){var d=Yt.getIceParameters(e,n),f=Yt.getDtlsParameters(e,n);i&&(f.role="server"),r.usingBundle&&0!==t||(r._gather(o.mid,t),"new"===s.state&&s.start(a,d,i?"controlling":"controlled"),"new"===u.state&&u.start(f));var p=Xt(l,c);r._transceive(o,p.codecs.length>0,!1)}})}return r._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?r._updateSignalingState("have-local-offer"):r._updateSignalingState("stable"),Promise.resolve()},i.prototype.setRemoteDescription=function(i){var o=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject($t("TypeError",'Unsupported type "'+i.type+'"'));if(!Qt("setRemoteDescription",i.type,o.signalingState)||o._isClosed)return Promise.reject($t("InvalidStateError","Can not set remote "+i.type+" in state "+o.signalingState));var a={};o.remoteStreams.forEach(function(e){a[e.id]=e});var s=[],u=Yt.splitSections(i.sdp),l=u.shift(),c=Yt.matchPrefix(l,"a=ice-lite").length>0,d=Yt.matchPrefix(l,"a=group:BUNDLE ").length>0;o.usingBundle=d;var f=Yt.matchPrefix(l,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!f&&f.substr(14).split(" ").indexOf("trickle")>=0,u.forEach(function(r,u){var f=Yt.splitLines(r),p=Yt.getKind(r),h=Yt.isRejected(r)&&0===Yt.matchPrefix(r,"a=bundle-only").length,g=f[0].substr(2).split(" ")[2],v=Yt.getDirection(r,l),m=Yt.parseMsid(r),y=Yt.getMid(r)||Yt.generateIdentifier();if(h||"application"===p&&("DTLS/SCTP"===g||"UDP/DTLS/SCTP"===g))o.transceivers[u]={mid:y,kind:p,protocol:g,rejected:!0};else{var _,b,S,k,w,E,T,x,C;!h&&o.transceivers[u]&&o.transceivers[u].rejected&&(o.transceivers[u]=o._createTransceiver(p,!0));var I,R,A=Yt.parseRtpParameters(r);h||(I=Yt.getIceParameters(r,l),(R=Yt.getDtlsParameters(r,l)).role="client"),T=Yt.parseRtpEncodingParameters(r);var O=Yt.parseRtcpParameters(r),M=Yt.matchPrefix(r,"a=end-of-candidates",l).length>0,D=Yt.matchPrefix(r,"a=candidate:").map(function(e){return Yt.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!h&&d&&u>0&&o.transceivers[u]&&(o._disposeIceAndDtlsTransports(u),o.transceivers[u].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[u].iceTransport=o.transceivers[0].iceTransport,o.transceivers[u].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[u].rtpSender&&o.transceivers[u].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[u].rtpReceiver&&o.transceivers[u].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==i.type||h)"answer"!==i.type||h||(b=(_=o.transceivers[u]).iceGatherer,S=_.iceTransport,k=_.dtlsTransport,w=_.rtpReceiver,E=_.sendEncodingParameters,x=_.localCapabilities,o.transceivers[u].recvEncodingParameters=T,o.transceivers[u].remoteCapabilities=A,o.transceivers[u].rtcpParameters=O,D.length&&"new"===S.state&&(!c&&!M||d&&0!==u?D.forEach(function(e){Zt(_.iceTransport,e)}):S.setRemoteCandidates(D)),d&&0!==u||("new"===S.state&&S.start(b,I,"controlling"),"new"===k.state&&k.start(R)),!Xt(_.localCapabilities,_.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&_.sendEncodingParameters[0].rtx&&delete _.sendEncodingParameters[0].rtx,o._transceive(_,"sendrecv"===v||"recvonly"===v,"sendrecv"===v||"sendonly"===v),!w||"sendrecv"!==v&&"sendonly"!==v?delete _.rtpReceiver:(C=w.track,m?(a[m.stream]||(a[m.stream]=new e.MediaStream),n(C,a[m.stream]),s.push([C,w,a[m.stream]])):(a.default||(a.default=new e.MediaStream),n(C,a.default),s.push([C,w,a.default]))));else{(_=o.transceivers[u]||o._createTransceiver(p)).mid=y,_.iceGatherer||(_.iceGatherer=o._createIceGatherer(u,d)),D.length&&"new"===_.iceTransport.state&&(!M||d&&0!==u?D.forEach(function(e){Zt(_.iceTransport,e)}):_.iceTransport.setRemoteCandidates(D)),x=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(x.codecs=x.codecs.filter(function(e){return"rtx"!==e.name})),E=_.sendEncodingParameters||[{ssrc:1001*(2*u+2)}];var L,P=!1;"sendrecv"===v||"sendonly"===v?(P=!_.rtpReceiver,w=_.rtpReceiver||new e.RTCRtpReceiver(_.dtlsTransport,p),P&&(C=w.track,m&&"-"===m.stream||(m?(a[m.stream]||(a[m.stream]=new e.MediaStream,Object.defineProperty(a[m.stream],"id",{get:function(){return m.stream}})),Object.defineProperty(C,"id",{get:function(){return m.track}}),L=a[m.stream]):(a.default||(a.default=new e.MediaStream),L=a.default)),L&&(n(C,L),_.associatedRemoteMediaStreams.push(L)),s.push([C,w,L]))):_.rtpReceiver&&_.rtpReceiver.track&&(_.associatedRemoteMediaStreams.forEach(function(t){var n=t.getTracks().find(function(e){return e.id===_.rtpReceiver.track.id});n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)}),_.associatedRemoteMediaStreams=[]),_.localCapabilities=x,_.remoteCapabilities=A,_.rtpReceiver=w,_.rtcpParameters=O,_.sendEncodingParameters=E,_.recvEncodingParameters=T,o._transceive(o.transceivers[u],!1,P)}}}),void 0===o._dtlsRole&&(o._dtlsRole="offer"===i.type?"active":"passive"),o._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(a).forEach(function(t){var n=a[t];if(n.getTracks().length){if(-1===o.remoteStreams.indexOf(n)){o.remoteStreams.push(n);var i=new Event("addstream");i.stream=n,e.setTimeout(function(){o._dispatchEvent("addstream",i)})}s.forEach(function(e){var t=e[0],i=e[1];n.id===e[2].id&&r(o,t,i,[n])})}}),s.forEach(function(e){e[2]||r(o,e[0],e[1],[])}),e.setTimeout(function(){o&&o.transceivers&&o.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},i.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},i.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},i.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},i.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},i.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},i.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject($t("InvalidStateError","Can not call createOffer after close"));var r=n.transceivers.filter(function(e){return"audio"===e.kind}).length,i=n.transceivers.filter(function(e){return"video"===e.kind}).length,o=arguments[0];if(o){if(o.mandatory||o.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==o.offerToReceiveAudio&&(r=!0===o.offerToReceiveAudio?1:!1===o.offerToReceiveAudio?0:o.offerToReceiveAudio),void 0!==o.offerToReceiveVideo&&(i=!0===o.offerToReceiveVideo?1:!1===o.offerToReceiveVideo?0:o.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?--r<0&&(e.wantReceive=!1):"video"===e.kind&&--i<0&&(e.wantReceive=!1)});r>0||i>0;)r>0&&(n._createTransceiver("audio"),r--),i>0&&(n._createTransceiver("video"),i--);var a=Yt.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(r,i){var o=r.track,a=r.kind,s=r.mid||Yt.generateIdentifier();r.mid=s,r.iceGatherer||(r.iceGatherer=n._createIceGatherer(i,n.usingBundle));var u=e.RTCRtpSender.getCapabilities(a);t<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),r.remoteCapabilities&&r.remoteCapabilities.codecs&&r.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),u.headerExtensions.forEach(function(e){(r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var l=r.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];o&&t>=15019&&"video"===a&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),r.wantReceive&&(r.rtpReceiver=new e.RTCRtpReceiver(r.dtlsTransport,a)),r.localCapabilities=u,r.sendEncodingParameters=l}),"max-compat"!==n._config.bundlePolicy&&(a+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(e,t){a+=Jt(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),a+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,a+="a="+Yt.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(a+="a=end-of-candidates\r\n"))});var s=new e.RTCSessionDescription({type:"offer",sdp:a});return Promise.resolve(s)},i.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject($t("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject($t("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var r=Yt.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(r+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),r+="a=ice-options:trickle\r\n";var i=Yt.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach(function(e,o){if(!(o+1>i)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?r+="m=application 0 DTLS/SCTP 5000\r\n":r+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?r+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(r+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(r+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var a;e.stream&&("audio"===e.kind?a=e.stream.getAudioTracks()[0]:"video"===e.kind&&(a=e.stream.getVideoTracks()[0]),a&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var s=Xt(e.localCapabilities,e.remoteCapabilities);!s.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=Jt(e,s,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+="a=rtcp-rsize\r\n")}});var o=new e.RTCSessionDescription({type:"answer",sdp:r});return Promise.resolve(o)},i.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(r,i){if(!n._remoteDescription)return i($t("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<n.transceivers.length;a++)if(n.transceivers[a].mid===e.sdpMid){o=a;break}var s=n.transceivers[o];if(!s)return i($t("OperationError","Can not add ICE candidate"));if(s.rejected)return r();var u=Object.keys(e.candidate).length>0?Yt.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return r();if(u.component&&1!==u.component)return r();if((0===o||o>0&&s.iceTransport!==n.transceivers[0].iceTransport)&&!Zt(s.iceTransport,u))return i($t("OperationError","Can not add ICE candidate"));var l=e.candidate.trim();0===l.indexOf("a=")&&(l=l.substr(2)),(t=Yt.getMediaSections(n._remoteDescription.sdp))[o]+="a="+(u.type?l:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=Yt.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var c=0;c<n.transceivers.length&&(n.transceivers[c].rejected||(n.transceivers[c].iceTransport.addRemoteCandidate({}),(t=Yt.getMediaSections(n._remoteDescription.sdp))[c]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=Yt.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));c++);r()})},i.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw $t("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&r.push(e[t].getStats())})}),Promise.all(r).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(n){var r;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[n]).type]||r.type,t.set(n,e[n])}),t})}}});var o=["createOffer","createAnswer"];return o.forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(o=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),i};function tn(e){const t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(e=>Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e)))}}function nn(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function rn(e){const t=Mt(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(e){t.set.call(this,e);const n=new Event("enabled");n.enabled=e,this.dispatchEvent(n)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const n=en(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){let n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(e=>{if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&Ot("RTCIceServer.url","RTCIceServer.urls");const r="string"==typeof t;return r&&(t=[t]),t=t.filter(e=>{if(0===e.indexOf("stun:"))return!1;const t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?(n=!0,!0):t&&!n}),delete e.url,e.urls=r?t[0]:t,!!t.length}})}(e.iceServers,t.version),At("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function on(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var an=Object.freeze({shimPeerConnection:rn,shimReplaceTrack:on,shimGetUserMedia:tn,shimGetDisplayMedia:nn});function sn(e){const t=Mt(e),n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){Ot("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function un(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ln(e){const t=Mt(e);if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]});const n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.version<68&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,o]=arguments;return i.apply(this,[e||null]).then(e=>{if(t.version<53&&!n)try{e.forEach(e=>{e.type=r[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,n)=>{e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))})}return e}).then(n,o)}}function cn(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function dn(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),Ct(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function fn(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){Ot("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function pn(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}var hn=Object.freeze({shimOnTrack:un,shimPeerConnection:ln,shimSenderGetStats:cn,shimReceiverGetStats:dn,shimRemoveStream:fn,shimRTCDataChannel:pn,shimGetUserMedia:sn,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function gn(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e){const n=arguments[1];return n&&(this._localStreams?this._localStreams.includes(n)||this._localStreams.push(n):this._localStreams=[n]),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function vn(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=(e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})}))}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function mn(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}function yn(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=(e=>n(_n(e)))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function _n(e){return e&&void 0!==e.video?Object.assign({},e,{video:Lt(e.video)}):e}function bn(e){const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(Ot("RTCIceServer.url","RTCIceServer.urls"),(r=JSON.parse(JSON.stringify(r))).urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Sn(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function kn(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}var wn=Object.freeze({shimLocalStreamsAPI:gn,shimRemoteStreamsAPI:vn,shimCallbacksAPI:mn,shimGetUserMedia:yn,shimConstraints:_n,shimRTCIceServerUrls:bn,shimTrackEventTransceiver:Sn,shimCreateOfferLegacy:kn});function En(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Yt.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Ct(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Tn(e){if(!e.RTCPeerConnection)return;const t=Mt(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},r=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=Yt.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Yt.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=Yt.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),t=n(e),i=r(arguments[0],e);let o;o=0===t&&0===i?Number.POSITIVE_INFINITY:0===t||0===i?Math.max(t,i):Math.min(t,i);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>o}),this._sctp=a}return i.apply(this,arguments)}}function xn(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},Ct(e,"datachannel",e=>(t(e.channel,e.target),e))}function Cn(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=(e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e}),this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function In(e){if(!e.RTCPeerConnection)return;const t=Mt(e);if("chrome"===t.browser&&t.version>=71)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n")),n.apply(this,arguments)}}var Rn=Object.freeze({shimRTCIceCandidate:En,shimMaxMessageSize:Tn,shimSendThrowTypeError:xn,shimConnectionState:Cn,removeAllowExtmapMixed:In});!function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const n=At,r=Mt(e),i={browserDetails:r,commonShim:Rn,extractVersion:xt,disableLog:It,disableWarnings:Rt};switch(r.browser){case"chrome":if(!Wt||!zt||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;n("adapter.js shimming chrome."),i.browserShim=Wt,Ut(e),Ft(e),zt(e),jt(e),Ht(e),Gt(e),Bt(e),Vt(e),Kt(e),En(e),Cn(e),Tn(e),xn(e),In(e);break;case"firefox":if(!hn||!ln||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=hn,sn(e),ln(e),un(e),fn(e),cn(e),dn(e),pn(e),En(e),Cn(e),Tn(e),xn(e);break;case"edge":if(!an||!rn||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),i;n("adapter.js shimming edge."),i.browserShim=an,tn(e),nn(e),rn(e),on(e),Tn(e),xn(e);break;case"safari":if(!wn||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=wn,bn(e),kn(e),mn(e),gn(e),vn(e),Sn(e),yn(e),En(e),Tn(e),xn(e),In(e);break;default:n("Unsupported browser!")}}({window:window});var An=[].slice,On={},Mn=Function.bind||function(e){var t=De(this),n=An.call(arguments,1),r=function(){var i=n.concat(An.call(arguments));return this instanceof r?function(e,t,n){if(!(t in On)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";On[t]=Function("C,a","return new C("+r.join(",")+")")}return On[t](e,n)}(t,i.length,i):t.apply(e,i)};return m(t.prototype)&&(r.prototype=t.prototype),r};Me({target:"Function",proto:!0},{bind:Mn});var Dn=R.f,Ln=Function.prototype,Pn=Ln.toString,Nn=/^\s*function ([^ (]*)/;!a||"name"in Ln||Dn(Ln,"name",{configurable:!0,get:function(){try{return Pn.call(this).match(Nn)[1]}catch(e){return""}}});var Un=function(){var e=function(){},t="undefined",n=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function i(e,t){for(var r=0;r<n.length;r++){var i=n[r];this[i]=this.methodFactory(i,e,t)}this.log=this.debug}function o(e,n,r){return function(){("undefined"==typeof console?"undefined":st(console))!==t&&(i.call(this,n,r),this[e].apply(this,arguments))}}function a(n,i,a){return function(n){return"debug"===n&&(n="log"),("undefined"==typeof console?"undefined":st(console))!==t&&(void 0!==console[n]?r(console,n):void 0!==console.log?r(console,"log"):e)}(n)||o.apply(this,arguments)}function s(e,r,o){var s,u=this,l="loglevel";function c(){var e;if(("undefined"==typeof window?"undefined":st(window))!==t){try{e=window.localStorage[l]}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}e&&(l+=":"+e),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=o||a,u.getLevel=function(){return s},u.setLevel=function(r,o){if("string"==typeof r&&void 0!==u.levels[r.toUpperCase()]&&(r=u.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=u.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(s=r,!1!==o&&function(e){var r=(n[e]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":st(window))!==t)try{window.localStorage[l]=r}catch(e){}}(r),i.call(u,r,e),("undefined"==typeof console?"undefined":st(console))===t&&r<u.levels.SILENT)return"No console available for logging"},u.setDefaultLevel=function(e){c()||u.setLevel(e,!1)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)};var d=c();null==d&&(d=null==r?"WARN":r),u.setLevel(d,!1)}var u=new s,l={};u.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=l[e];return t||(t=l[e]=new s(e,u.getLevel(),u.methodFactory)),t};var c=("undefined"==typeof window?"undefined":st(window))!==t?window.log:void 0;return u.noConflict=function(){return("undefined"==typeof window?"undefined":st(window))!==t&&window.log===u&&(window.log=c),u},u.getLoggers=function(){return l},u}(),Fn=function(e,t,n){var r=y(t);r in e?R.f(e,r,c(0,n)):e[r]=n},jn=Ve("isConcatSpreadable"),Gn=Ze>=51||!o(function(){var e=[];return e[jn]=!1,e.concat()[0]!==e}),Bn=et("concat"),Vn=function(e){if(!m(e))return!1;var t=e[jn];return void 0!==t?!!t:Ne(e)};Me({target:"Array",proto:!0,forced:!Gn||!Bn},{concat:function(e){var t,n,r,i,o,a=Pe(this),s=He(a,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(o=-1===t?a:arguments[t],Vn(o)){if(u+(i=ce(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<i;n++,u++)n in o&&Fn(s,u,o[n])}else{if(u>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Fn(s,u++,o)}return s.length=u,s}}),Me({target:"Array",stat:!0},{isArray:Ne});var qn=function(e,t){var n=[][e];return!n||!o(function(){n.call(null,t||function(){throw 1},1)})},Hn=[].join,zn=h!=Object,Kn=qn("join",",");Me({target:"Array",proto:!0,forced:zn||Kn},{join:function(e){return Hn.call(v(this),void 0===e?",":e)}});var Wn=Ve("species"),Yn=[].slice,Jn=Math.max;Me({target:"Array",proto:!0,forced:!et("slice")},{slice:function(e,t){var n,r,i,o=v(this),a=ce(o.length),s=pe(e,a),u=pe(void 0===t?a:t,a);if(Ne(o)&&("function"!=typeof(n=o.constructor)||n!==Array&&!Ne(n.prototype)?m(n)&&null===(n=n[Wn])&&(n=void 0):n=void 0,n===Array||void 0===n))return Yn.call(o,s,u);for(r=new(void 0===n?Array:n)(Jn(u-s,0)),i=0;s<u;s++,i++)s in o&&Fn(r,i,o[s]);return r.length=i,r}});var Xn=We.some;Me({target:"Array",proto:!0,forced:qn("some")},{some:function(e){return Xn(this,e,arguments.length>1?arguments[1]:void 0)}});var Qn=Math.max,Zn=Math.min;Me({target:"Array",proto:!0,forced:!et("splice")},{splice:function(e,t){var n,r,i,o,a,s,u=Pe(this),l=ce(u.length),c=pe(e,l),d=arguments.length;if(0===d?n=r=0:1===d?(n=0,r=l-c):(n=d-2,r=Zn(Qn(ue(t),0),l-c)),l+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(i=He(u,r),o=0;o<r;o++)(a=c+o)in u&&Fn(i,o,u[a]);if(i.length=r,n<r){for(o=c;o<l-r;o++)s=o+n,(a=o+r)in u?u[s]=u[a]:delete u[s];for(o=l;o>l-r+n;o--)delete u[o-1]}else if(n>r)for(o=l-r;o>c;o--)s=o+n-1,(a=o+r-1)in u?u[s]=u[a]:delete u[s];for(o=0;o<n;o++)u[o+c]=arguments[o+2];return u.length=l-r+n,i}});var $n="".repeat||function(e){var t=String(g(this)),n="",r=ue(e);if(r<0||1/0==r)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n},er=Math.ceil,tr=function(e){return function(t,n,r){var i,o,a=String(g(t)),s=a.length,u=void 0===r?" ":String(r),l=ce(n);return l<=s||""==u?a:(i=l-s,(o=$n.call(u,er(i/u.length))).length>i&&(o=o.slice(0,i)),e?a+o:o+a)}},nr=[tr(!1),tr(!0)][0],rr=Math.abs,ir=Date.prototype,or=ir.getTime,ar=ir.toISOString,sr=o(function(){return"0385-07-25T07:06:39.999Z"!=ar.call(new Date(-5e13-1))})||!o(function(){ar.call(new Date(NaN))})?function(){if(!isFinite(or.call(this)))throw RangeError("Invalid time value");var e=this.getUTCFullYear(),t=this.getUTCMilliseconds(),n=e<0?"-":e>9999?"+":"";return n+nr(rr(e),n?6:4,0)+"-"+nr(this.getUTCMonth()+1,2,0)+"-"+nr(this.getUTCDate(),2,0)+"T"+nr(this.getUTCHours(),2,0)+":"+nr(this.getUTCMinutes(),2,0)+":"+nr(this.getUTCSeconds(),2,0)+"."+nr(t,3,0)+"Z"}:ar;Me({target:"Date",proto:!0,forced:Date.prototype.toISOString!==sr},{toISOString:sr});var ur=Date.prototype,lr=ur.toString,cr=ur.getTime;new Date(NaN)+""!="Invalid Date"&&ne(ur,"toString",function(){var e=cr.call(this);return e==e?lr.call(this):"Invalid Date"});var dr=x.f,fr=o(function(){dr(1)});Me({target:"Object",stat:!0,forced:!a||fr,sham:!a},{getOwnPropertyDescriptor:function(e,t){return dr(v(e),t)}});var pr=!o(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),hr=z("IE_PROTO"),gr=Object.prototype,vr=pr?Object.getPrototypeOf:function(e){return e=Pe(e),b(e,hr)?e[hr]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?gr:null},mr=o(function(){vr(1)});Me({target:"Object",stat:!0,forced:mr,sham:!pr},{getPrototypeOf:function(e){return vr(Pe(e))}});var yr={};yr[Ve("toStringTag")]="z";var _r="[object z]"===String(yr),br=Ve("toStringTag"),Sr="Arguments"==f(function(){return arguments}()),kr=_r?f:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),br))?n:Sr?f(t):"Object"==(r=f(t))&&"function"==typeof t.callee?"Arguments":r},wr=_r?{}.toString:function(){return"[object "+kr(this)+"]"};_r||ne(Object.prototype,"toString",wr,{unsafe:!0});var Er=function(){var e=C(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t};function Tr(e,t){return RegExp(e,t)}var xr={UNSUPPORTED_Y:o(function(){var e=Tr("a","y");return e.lastIndex=2,null!=e.exec("abcd")}),BROKEN_CARET:o(function(){var e=Tr("^r","gy");return e.lastIndex=2,null!=e.exec("str")})},Cr=RegExp.prototype.exec,Ir=String.prototype.replace,Rr=Cr,Ar=function(){var e=/a/,t=/b*/g;return Cr.call(e,"a"),Cr.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),Or=xr.UNSUPPORTED_Y||xr.BROKEN_CARET,Mr=void 0!==/()??/.exec("")[1];(Ar||Mr||Or)&&(Rr=function(e){var t,n,r,i,o=this,a=Or&&o.sticky,s=Er.call(o),u=o.source,l=0,c=e;return a&&(-1===(s=s.replace("y","")).indexOf("g")&&(s+="g"),c=String(e).slice(o.lastIndex),o.lastIndex>0&&(!o.multiline||o.multiline&&"\n"!==e[o.lastIndex-1])&&(u="(?: "+u+")",c=" "+c,l++),n=new RegExp("^(?:"+u+")",s)),Mr&&(n=new RegExp("^"+u+"$(?!\\s)",s)),Ar&&(t=o.lastIndex),r=Cr.call(a?n:o,c),a?r?(r.input=r.input.slice(l),r[0]=r[0].slice(l),r.index=o.lastIndex,o.lastIndex+=r[0].length):o.lastIndex=0:Ar&&r&&(o.lastIndex=o.global?r.index+r[0].length:t),Mr&&r&&r.length>1&&Ir.call(r[0],n,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)}),r});var Dr=Rr;Me({target:"RegExp",proto:!0,forced:/./.exec!==Dr},{exec:Dr});var Lr=RegExp.prototype,Pr=Lr.toString,Nr=o(function(){return"/a/b"!=Pr.call({source:"a",flags:"b"})}),Ur="toString"!=Pr.name;(Nr||Ur)&&ne(RegExp.prototype,"toString",function(){var e=C(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in Lr)?Er.call(e):n)},{unsafe:!0});var Fr=Ve("species"),jr=!o(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),Gr="$0"==="a".replace(/./,"$0"),Br=!o(function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}),Vr=function(e,t,n,r){var i=Ve(e),a=!o(function(){var t={};return t[i]=function(){return 7},7!=""[e](t)}),s=a&&!o(function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[Fr]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t});if(!a||!s||"replace"===e&&(!jr||!Gr)||"split"===e&&!Br){var u=/./[i],l=n(i,""[e],function(e,t,n,r,i){return t.exec===Dr?a&&!i?{done:!0,value:u.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}},{REPLACE_KEEPS_$0:Gr}),c=l[0],d=l[1];ne(String.prototype,e,c),ne(RegExp.prototype,i,2==t?function(e,t){return d.call(e,this,t)}:function(e){return d.call(e,this)})}r&&A(RegExp.prototype[i],"sham",!0)},qr=function(e){return function(t,n){var r,i,o=String(g(t)),a=ue(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=o.charCodeAt(a))<55296||r>56319||a+1===s||(i=o.charCodeAt(a+1))<56320||i>57343?e?o.charAt(a):r:e?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}},Hr={codeAt:qr(!1),charAt:qr(!0)},zr=Hr.charAt,Kr=function(e,t,n){return t+(n?zr(e,t).length:1)},Wr=function(e,t){var n=e.exec;if("function"==typeof n){var r=n.call(e,t);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==f(e))throw TypeError("RegExp#exec called on incompatible receiver");return Dr.call(e,t)},Yr=Math.max,Jr=Math.min,Xr=Math.floor,Qr=/\$([$&'`]|\d\d?|<[^>]*>)/g,Zr=/\$([$&'`]|\d\d?)/g;Vr("replace",2,function(e,t,n,r){return[function(n,r){var i=g(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,i,r):t.call(String(i),n,r)},function(e,o){if(r.REPLACE_KEEPS_$0||"string"==typeof o&&-1===o.indexOf("$0")){var a=n(t,e,this,o);if(a.done)return a.value}var s=C(e),u=String(this),l="function"==typeof o;l||(o=String(o));var c=s.global;if(c){var d=s.unicode;s.lastIndex=0}for(var f=[];;){var p=Wr(s,u);if(null===p)break;if(f.push(p),!c)break;""===String(p[0])&&(s.lastIndex=Kr(u,ce(s.lastIndex),d))}for(var h,g="",v=0,m=0;m<f.length;m++){p=f[m];for(var y=String(p[0]),_=Yr(Jr(ue(p.index),u.length),0),b=[],S=1;S<p.length;S++)b.push(void 0===(h=p[S])?h:String(h));var k=p.groups;if(l){var w=[y].concat(b,_,u);void 0!==k&&w.push(k);var E=String(o.apply(void 0,w))}else E=i(y,u,_,b,k,o);_>=v&&(g+=u.slice(v,_)+E,v=_+y.length)}return g+u.slice(v)}];function i(e,n,r,i,o,a){var s=r+e.length,u=i.length,l=Zr;return void 0!==o&&(o=Pe(o),l=Qr),t.call(a,l,function(t,a){var l;switch(a.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,r);case"'":return n.slice(s);case"<":l=o[a.slice(1,-1)];break;default:var c=+a;if(0===c)return t;if(c>u){var d=Xr(c/10);return 0===d?t:d<=u?void 0===i[d-1]?a.charAt(1):i[d-1]+a.charAt(1):t}l=i[c-1]}return void 0===l?"":l})}});var $r=Ve("match"),ei=function(e){var t;return m(e)&&(void 0!==(t=e[$r])?!!t:"RegExp"==f(e))},ti=Ve("species"),ni=function(e,t){var n,r=C(e).constructor;return void 0===r||null==(n=C(r)[ti])?t:De(n)},ri=[].push,ii=Math.min,oi=!o(function(){return!RegExp(4294967295,"y")});Vr("split",2,function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=String(g(this)),i=void 0===n?4294967295:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!ei(e))return t.call(r,e,i);for(var o,a,s,u=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),c=0,d=new RegExp(e.source,l+"g");(o=Dr.call(d,r))&&!((a=d.lastIndex)>c&&(u.push(r.slice(c,o.index)),o.length>1&&o.index<r.length&&ri.apply(u,o.slice(1)),s=o[0].length,c=a,u.length>=i));)d.lastIndex===o.index&&d.lastIndex++;return c===r.length?!s&&d.test("")||u.push(""):u.push(r.slice(c)),u.length>i?u.slice(0,i):u}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=g(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=n(r,e,this,i,r!==t);if(o.done)return o.value;var a=C(e),s=String(this),u=ni(a,RegExp),l=a.unicode,c=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(oi?"y":"g"),d=new u(oi?a:"^(?:"+a.source+")",c),f=void 0===i?4294967295:i>>>0;if(0===f)return[];if(0===s.length)return null===Wr(d,s)?[s]:[];for(var p=0,h=0,g=[];h<s.length;){d.lastIndex=oi?h:0;var v,m=Wr(d,oi?s:s.slice(h));if(null===m||(v=ii(ce(d.lastIndex+(oi?0:h)),s.length))===p)h=Kr(s,h,l);else{if(g.push(s.slice(p,h)),g.length===f)return g;for(var y=1;y<=m.length-1;y++)if(g.push(m[y]),g.length===f)return g;h=p=v}}return g.push(s.slice(p)),g}]},!oi);var ai=[].slice,si=/MSIE .\./.test(Ye),ui=function(e){return function(t,n){var r=arguments.length>2,i=r?ai.call(arguments,2):void 0;return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};Me({global:!0,bind:!0,forced:si},{setTimeout:ui(i.setTimeout),setInterval:ui(i.setInterval)});var li=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},ci=Object.prototype.toString;function di(e){return"[object Array]"===ci.call(e)}function fi(e){return null!==e&&"object"==typeof e}function pi(e){return"[object Function]"===ci.call(e)}function hi(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),di(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var gi={isArray:di,isArrayBuffer:function(e){return"[object ArrayBuffer]"===ci.call(e)},isBuffer:function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:fi,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===ci.call(e)},isFile:function(e){return"[object File]"===ci.call(e)},isBlob:function(e){return"[object Blob]"===ci.call(e)},isFunction:pi,isStream:function(e){return fi(e)&&pi(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:hi,merge:function e(){var t={};function n(n,r){"object"==typeof t[r]&&"object"==typeof n?t[r]=e(t[r],n):t[r]=n}for(var r=0,i=arguments.length;r<i;r++)hi(arguments[r],n);return t},deepMerge:function e(){var t={};function n(n,r){"object"==typeof t[r]&&"object"==typeof n?t[r]=e(t[r],n):t[r]="object"==typeof n?e({},n):n}for(var r=0,i=arguments.length;r<i;r++)hi(arguments[r],n);return t},extend:function(e,t,n){return hi(t,function(t,r){e[r]=n&&"function"==typeof t?li(t,n):t}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}};function vi(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var mi=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(gi.isURLSearchParams(t))r=t.toString();else{var i=[];gi.forEach(t,function(e,t){null!=e&&(gi.isArray(e)?t+="[]":e=[e],gi.forEach(e,function(e){gi.isDate(e)?e=e.toISOString():gi.isObject(e)&&(e=JSON.stringify(e)),i.push(vi(t)+"="+vi(e))}))}),r=i.join("&")}if(r){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e};function yi(){this.handlers=[]}yi.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},yi.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},yi.prototype.forEach=function(e){gi.forEach(this.handlers,function(t){null!==t&&e(t)})};var _i=yi,bi=function(e,t,n){return gi.forEach(n,function(n){e=n(e,t)}),e},Si=function(e){return!(!e||!e.__CANCEL__)},ki=void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function wi(){throw new Error("setTimeout has not been defined")}function Ei(){throw new Error("clearTimeout has not been defined")}var Ti=wi,xi=Ei;function Ci(e){if(Ti===setTimeout)return setTimeout(e,0);if((Ti===wi||!Ti)&&setTimeout)return Ti=setTimeout,setTimeout(e,0);try{return Ti(e,0)}catch(t){try{return Ti.call(null,e,0)}catch(t){return Ti.call(this,e,0)}}}"function"==typeof ki.setTimeout&&(Ti=setTimeout),"function"==typeof ki.clearTimeout&&(xi=clearTimeout);var Ii,Ri=[],Ai=!1,Oi=-1;function Mi(){Ai&&Ii&&(Ai=!1,Ii.length?Ri=Ii.concat(Ri):Oi=-1,Ri.length&&Di())}function Di(){if(!Ai){var e=Ci(Mi);Ai=!0;for(var t=Ri.length;t;){for(Ii=Ri,Ri=[];++Oi<t;)Ii&&Ii[Oi].run();Oi=-1,t=Ri.length}Ii=null,Ai=!1,function(e){if(xi===clearTimeout)return clearTimeout(e);if((xi===Ei||!xi)&&clearTimeout)return xi=clearTimeout,clearTimeout(e);try{xi(e)}catch(t){try{return xi.call(null,e)}catch(t){return xi.call(this,e)}}}(e)}}function Li(e,t){this.fun=e,this.array=t}function Pi(){}Li.prototype.run=function(){this.fun.apply(null,this.array)};var Ni=Pi,Ui=Pi,Fi=Pi,ji=Pi,Gi=Pi,Bi=Pi,Vi=Pi,qi=ki.performance||{},Hi=qi.now||qi.mozNow||qi.msNow||qi.oNow||qi.webkitNow||function(){return(new Date).getTime()},zi=new Date,Ki={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];Ri.push(new Li(e,t)),1!==Ri.length||Ai||Ci(Di)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:Ni,addListener:Ui,once:Fi,off:ji,removeListener:Gi,removeAllListeners:Bi,emit:Vi,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*Hi.call(qi),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-zi)/1e3}},Wi=function(e,t){gi.forEach(e,function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])})},Yi=function(e,t,n,r,i){return function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}(new Error(e),t,n,r,i)},Ji=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],Xi=gi.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=gi.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0},Qi=gi.isStandardBrowserEnv()?{write:function(e,t,n,r,i,o){var a=[];a.push(e+"="+encodeURIComponent(t)),gi.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),gi.isString(r)&&a.push("path="+r),gi.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Zi=function(e){return new Promise(function(t,n){var r=e.data,i=e.headers;gi.isFormData(r)&&delete i["Content-Type"];var o=new XMLHttpRequest;if(e.auth){var a=e.auth.username||"",s=e.auth.password||"";i.Authorization="Basic "+btoa(a+":"+s)}if(o.open(e.method.toUpperCase(),mi(e.url,e.params,e.paramsSerializer),!0),o.timeout=e.timeout,o.onreadystatechange=function(){if(o&&4===o.readyState&&(0!==o.status||o.responseURL&&0===o.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in o?function(e){var t,n,r,i={};return e?(gi.forEach(e.split("\n"),function(e){if(r=e.indexOf(":"),t=gi.trim(e.substr(0,r)).toLowerCase(),n=gi.trim(e.substr(r+1)),t){if(i[t]&&Ji.indexOf(t)>=0)return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([n]):i[t]?i[t]+", "+n:n}}),i):i}(o.getAllResponseHeaders()):null,i={data:e.responseType&&"text"!==e.responseType?o.response:o.responseText,status:o.status,statusText:o.statusText,headers:r,config:e,request:o};!function(e,t,n){var r=n.config.validateStatus;!r||r(n.status)?e(n):t(Yi("Request failed with status code "+n.status,n.config,null,n.request,n))}(t,n,i),o=null}},o.onabort=function(){o&&(n(Yi("Request aborted",e,"ECONNABORTED",o)),o=null)},o.onerror=function(){n(Yi("Network Error",e,null,o)),o=null},o.ontimeout=function(){n(Yi("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",o)),o=null},gi.isStandardBrowserEnv()){var u=Qi,l=(e.withCredentials||Xi(e.url))&&e.xsrfCookieName?u.read(e.xsrfCookieName):void 0;l&&(i[e.xsrfHeaderName]=l)}if("setRequestHeader"in o&&gi.forEach(i,function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete i[t]:o.setRequestHeader(t,e)}),e.withCredentials&&(o.withCredentials=!0),e.responseType)try{o.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&o.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&o.upload&&o.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){o&&(o.abort(),n(e),o=null)}),void 0===r&&(r=null),o.send(r)})},$i={"Content-Type":"application/x-www-form-urlencoded"};function eo(e,t){!gi.isUndefined(e)&&gi.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var to={adapter:function(){var e;return void 0!==Ki&&"[object process]"===Object.prototype.toString.call(Ki)?e=Zi:"undefined"!=typeof XMLHttpRequest&&(e=Zi),e}(),transformRequest:[function(e,t){return Wi(t,"Accept"),Wi(t,"Content-Type"),gi.isFormData(e)||gi.isArrayBuffer(e)||gi.isBuffer(e)||gi.isStream(e)||gi.isFile(e)||gi.isBlob(e)?e:gi.isArrayBufferView(e)?e.buffer:gi.isURLSearchParams(e)?(eo(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):gi.isObject(e)?(eo(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};gi.forEach(["delete","get","head"],function(e){to.headers[e]={}}),gi.forEach(["post","put","patch"],function(e){to.headers[e]=gi.merge($i)});var no=to;function ro(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var io=function(e){var t,n;return ro(e),e.baseURL&&!function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}(e.url)&&(e.url=(t=e.baseURL,(n=e.url)?t.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):t)),e.headers=e.headers||{},e.data=bi(e.data,e.headers,e.transformRequest),e.headers=gi.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),gi.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||no.adapter)(e).then(function(t){return ro(e),t.data=bi(t.data,t.headers,e.transformResponse),t},function(t){return Si(t)||(ro(e),t&&t.response&&(t.response.data=bi(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})},oo=function(e,t){t=t||{};var n={};return gi.forEach(["url","method","params","data"],function(e){void 0!==t[e]&&(n[e]=t[e])}),gi.forEach(["headers","auth","proxy"],function(r){gi.isObject(t[r])?n[r]=gi.deepMerge(e[r],t[r]):void 0!==t[r]?n[r]=t[r]:gi.isObject(e[r])?n[r]=gi.deepMerge(e[r]):void 0!==e[r]&&(n[r]=e[r])}),gi.forEach(["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"],function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])}),n};function ao(e){this.defaults=e,this.interceptors={request:new _i,response:new _i}}ao.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=oo(this.defaults,e)).method=e.method?e.method.toLowerCase():"get";var t=[io,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},ao.prototype.getUri=function(e){return e=oo(this.defaults,e),mi(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},gi.forEach(["delete","get","head","options"],function(e){ao.prototype[e]=function(t,n){return this.request(gi.merge(n||{},{method:e,url:t}))}}),gi.forEach(["post","put","patch"],function(e){ao.prototype[e]=function(t,n,r){return this.request(gi.merge(r||{},{method:e,url:t,data:n}))}});var so=ao;function uo(e){this.message=e}uo.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},uo.prototype.__CANCEL__=!0;var lo=uo;function co(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var n=this;e(function(e){n.reason||(n.reason=new lo(e),t(n.reason))})}co.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},co.source=function(){var e;return{token:new co(function(t){e=t}),cancel:e}};var fo=co;function po(e){var t=new so(e),n=li(so.prototype.request,t);return gi.extend(n,so.prototype,t),gi.extend(n,t),n}var ho=po(no);ho.Axios=so,ho.create=function(e){return po(oo(ho.defaults,e))},ho.Cancel=lo,ho.CancelToken=fo,ho.isCancel=Si,ho.all=function(e){return Promise.all(e)},ho.spread=function(e){return function(t){return e.apply(null,t)}};var go=ho,vo=ho;go.default=vo;var mo,yo=go,_o=((new Date).getTime(),0),bo=function(){return(new Date).getTime()+_o},So=function(){var e=new Date;return e.setTime(bo()),e.toLocaleString()};function ko(e){try{return JSON.stringify(e)}catch(e){if(!mo)try{var t={};t.a=t,JSON.stringify(t)}catch(e){mo=e.message}if(e.message===mo)return"[Circular]";throw e}}var wo=Object.prototype.hasOwnProperty;function Eo(){try{throw new Error}catch(e){return e.stack}}function To(e){var t=this,n=[],r=[];this.length=function(){return n.length},this.sent=function(){return r.length},this.push=function(t){n.push(t),n.length>e&&n.shift()},this.send=function(){return r.length||(r=n,n=[]),r},this.confirm=function(){r=[],t.content=""},this.fail=function(){var i=1+n.length+r.length-e;i>0&&(r.splice(0,i),n=r.concat(n),t.confirm())}}var xo,Co,Io,Ro=!!Eo(),Ao={url:"https://yun.tim.qq.com/v5/AVQualityReportSvc/C2S?sdkappid=1&cmdtype=jssdk_log",interval:1e3,level:"trace",capacity:0,stacktrace:{levels:["trace","warn","error"],depth:3,excess:0},timestamp:function(){return(new Date).toISOString()},format:function(e){return"[".concat(e.timestamp,"] <").concat(e.level.label.toUpperCase(),">").concat(e.logger?" (".concat(e.logger,")"):"",": ").concat(e.message).concat(e.stacktrace?"\n".concat(e.stacktrace):"")}},Oo=-1,Mo=!1,Do="",Lo="",Po="",No=function(e,t){if(!e||!e.getLogger)throw new TypeError("Argument is not a root loglevel object");if(xo)throw new Error("You can assign a plugin only one time");xo=e;var n=function e(){for(var t={},n=0;n<arguments.length;n+=1){var r=Object(arguments[n]);for(var i in r)wo.call(r,i)&&(t[i]="object"!==st(r[i])||Array.isArray(r[i])?r[i]:e(t[i],r[i]))}return t}(Ao,t);n.capacity=n.capacity||500;var r,i=n.interval;Oo=setInterval(function(){if(Mo&&!o.sent()){if(!o.length())return;var e=o.send();o.content=r?'{"logs":['.concat(e.join(","),"]}"):e.join("\n"),function(e){if(Mo){var t=JSON.stringify({timestamp:So(),sdkAppId:Do,userId:Lo,version:Po,log:e});yo.post(n.url,t).then(function(){o.confirm()}).catch(function(){o.fail()})}}(o.content)}},i);var o=new To(n.capacity);return Co=e.methodFactory,Io=function(e,t,i){var a=Co(e,t,i),s=Ro&&n.stacktrace.levels.some(function(t){return t===e}),u=xo.levels[e.toUpperCase()];return function(){for(var l=arguments.length,c=new Array(l),d=0;d<l;d++)c[d]=arguments[d];var f=function(e){var t="",n=0;return e.length>1&&"string"==typeof e[0]&&(t=(t=e[0].replace(/(%?)(%([sdjo]))/g,function(t,r,i,o){if(!r){var a=e[n+=1],s="";switch(o){case"s":s+=a;break;case"d":s+=+a;break;case"j":s=ko(a);break;case"o":var u=ko(a);"{"!==u[0]&&"["!==u[0]&&(u="<".concat(u,">")),s=function(e){if(!Object.getOwnPropertyDescriptor||!Object.getPrototypeOf)return Object.prototype.toString.call(e).slice(8,-1);for(;e;){var t=Object.getOwnPropertyDescriptor(e,"constructor");if(void 0!==t&&"function"==typeof t.value&&""!==t.value.name)return t.value.name;e=Object.getPrototypeOf(e)}return""}(a)+u}return s}return t})).replace(/%{2,2}/g,"%"),n+=1),e.length>n&&(t&&(t+=" "),t+=e.slice(n).join(" ")),t}(c),p=u>=t;if(p){var h=new Date;h.setTime(bo());var g=h.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),v="["+g+"] <"+e.toUpperCase()+"> "+f;a.apply(void 0,[v])}var m=So(),y=s?Eo():"";if(y){var _=y.split("\n");_.splice(0,n.stacktrace.excess+3);var b=n.stacktrace.depth;if(b&&_.length!==b+1){var S=_.splice(0,b);y=S.join("\n"),_.length&&(y+="\n    and ".concat(_.length," more"))}else y=_.join("\n")}var k=n.format({message:f,level:{label:e,value:u},logger:i||"",timestamp:m,stacktrace:y});void 0===r&&(r="string"!=typeof k);var w="";if(r)try{w+=JSON.stringify(k)}catch(e){return a.apply(void 0,c),void xo.getLogger("logger").error(e)}else w+=k;o.push(w)}},e.methodFactory=Io,e.setLevel(e.getLevel()),e},Uo=!1;Un.setConfig=function(e){!function(e){Mo||(Do="".concat(e.sdkAppId),Lo="".concat(e.userId),Po="".concat(e.version),Mo=!0)}(e)},Un.setLogLevel=function(e){Un.setLevel(e)},Un.getLogLevel=function(e){return Un.getLevel(e)},Un.enableUploadLog=function(){Uo||(No(Un),Uo=!0)},Un.disableUploadLog=function(){Uo&&(Un.warn("disable upload log! Without log we are difficult to help you triage the issue you might run into!"),function(){if(!xo)throw new Error("You can't disable a not appled plugin");if(Io!==xo.methodFactory)throw new Error("You can't disable a plugin after appling another plugin");xo.methodFactory=Co,xo.setLevel(xo.getLevel()),xo=void 0,clearInterval(Oo)}(),Uo=!1)},Un.enableUploadLog(),Un.setLevel("INFO");var Fo,jo=!0,Go=Object.keys||function(e){return me(e,ye)},Bo=a?Object.defineProperties:function(e,t){C(e);for(var n,r=Go(t),i=r.length,o=0;i>o;)R.f(e,n=r[o++],t[n]);return e},Vo=oe("document","documentElement"),qo=z("IE_PROTO"),Ho=function(){},zo=function(e){return"<script>"+e+"<\/script>"},Ko=function(){try{Fo=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;Ko=Fo?function(e){e.write(zo("")),e.close();var t=e.parentWindow.Object;return e=null,t}(Fo):((t=w("iframe")).style.display="none",Vo.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(zo("document.F=Object")),e.close(),e.F);for(var n=ye.length;n--;)delete Ko.prototype[ye[n]];return Ko()};K[qo]=!0;var Wo=Object.create||function(e,t){var n;return null!==e?(Ho.prototype=C(e),n=new Ho,Ho.prototype=null,n[qo]=e):n=Ko(),void 0===t?n:Bo(n,t)},Yo=be.f,Jo={}.toString,Xo="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Qo={f:function(e){return Xo&&"[object Window]"==Jo.call(e)?function(e){try{return Yo(e)}catch(e){return Xo.slice()}}(e):Yo(v(e))}},Zo={f:Ve},$o=R.f,ea=function(e){var t=re.Symbol||(re.Symbol={});b(t,e)||$o(t,e,{value:Zo.f(e)})},ta=R.f,na=Ve("toStringTag"),ra=function(e,t,n){e&&!b(e=n?e:e.prototype,na)&&ta(e,na,{configurable:!0,value:t})},ia=We.forEach,oa=z("hidden"),aa=Ve("toPrimitive"),sa=te.set,ua=te.getterFor("Symbol"),la=Object.prototype,ca=i.Symbol,da=oe("JSON","stringify"),fa=x.f,pa=R.f,ha=Qo.f,ga=l.f,va=G("symbols"),ma=G("op-symbols"),ya=G("string-to-symbol-registry"),_a=G("symbol-to-string-registry"),ba=G("wks"),Sa=i.QObject,ka=!Sa||!Sa.prototype||!Sa.prototype.findChild,wa=a&&o(function(){return 7!=Wo(pa({},"a",{get:function(){return pa(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=fa(la,t);r&&delete la[t],pa(e,t,n),r&&e!==la&&pa(la,t,r)}:pa,Ea=function(e,t){var n=va[e]=Wo(ca.prototype);return sa(n,{type:"Symbol",tag:e,description:t}),a||(n.description=t),n},Ta=Fe?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof ca},xa=function(e,t,n){e===la&&xa(ma,t,n),C(e);var r=y(t,!0);return C(n),b(va,r)?(n.enumerable?(b(e,oa)&&e[oa][r]&&(e[oa][r]=!1),n=Wo(n,{enumerable:c(0,!1)})):(b(e,oa)||pa(e,oa,c(1,{})),e[oa][r]=!0),wa(e,r,n)):pa(e,r,n)},Ca=function(e,t){C(e);var n=v(t),r=Go(n).concat(Oa(n));return ia(r,function(t){a&&!Ia.call(n,t)||xa(e,t,n[t])}),e},Ia=function(e){var t=y(e,!0),n=ga.call(this,t);return!(this===la&&b(va,t)&&!b(ma,t))&&(!(n||!b(this,t)||!b(va,t)||b(this,oa)&&this[oa][t])||n)},Ra=function(e,t){var n=v(e),r=y(t,!0);if(n!==la||!b(va,r)||b(ma,r)){var i=fa(n,r);return!i||!b(va,r)||b(n,oa)&&n[oa][r]||(i.enumerable=!0),i}},Aa=function(e){var t=ha(v(e)),n=[];return ia(t,function(e){b(va,e)||b(K,e)||n.push(e)}),n},Oa=function(e){var t=e===la,n=ha(t?ma:v(e)),r=[];return ia(n,function(e){!b(va,e)||t&&!b(la,e)||r.push(va[e])}),r};if(Ue||(ne((ca=function(){if(this instanceof ca)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=q(e),n=function(e){this===la&&n.call(ma,e),b(this,oa)&&b(this[oa],t)&&(this[oa][t]=!1),wa(this,t,c(1,e))};return a&&ka&&wa(la,t,{configurable:!0,set:n}),Ea(t,e)}).prototype,"toString",function(){return ua(this).tag}),ne(ca,"withoutSetter",function(e){return Ea(q(e),e)}),l.f=Ia,R.f=xa,x.f=Ra,be.f=Qo.f=Aa,Se.f=Oa,Zo.f=function(e){return Ea(Ve(e),e)},a&&(pa(ca.prototype,"description",{configurable:!0,get:function(){return ua(this).description}}),ne(la,"propertyIsEnumerable",Ia,{unsafe:!0}))),Me({global:!0,wrap:!0,forced:!Ue,sham:!Ue},{Symbol:ca}),ia(Go(ba),function(e){ea(e)}),Me({target:"Symbol",stat:!0,forced:!Ue},{for:function(e){var t=String(e);if(b(ya,t))return ya[t];var n=ca(t);return ya[t]=n,_a[n]=t,n},keyFor:function(e){if(!Ta(e))throw TypeError(e+" is not a symbol");if(b(_a,e))return _a[e]},useSetter:function(){ka=!0},useSimple:function(){ka=!1}}),Me({target:"Object",stat:!0,forced:!Ue,sham:!a},{create:function(e,t){return void 0===t?Wo(e):Ca(Wo(e),t)},defineProperty:xa,defineProperties:Ca,getOwnPropertyDescriptor:Ra}),Me({target:"Object",stat:!0,forced:!Ue},{getOwnPropertyNames:Aa,getOwnPropertySymbols:Oa}),Me({target:"Object",stat:!0,forced:o(function(){Se.f(1)})},{getOwnPropertySymbols:function(e){return Se.f(Pe(e))}}),da){var Ma=!Ue||o(function(){var e=ca();return"[null]"!=da([e])||"{}"!=da({a:e})||"{}"!=da(Object(e))});Me({target:"JSON",stat:!0,forced:Ma},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(m(t)||void 0!==e)&&!Ta(e))return Ne(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Ta(t))return t}),i[1]=t,da.apply(null,i)}})}ca.prototype[aa]||A(ca.prototype,aa,ca.prototype.valueOf),ra(ca,"Symbol"),K[oa]=!0;var Da=R.f,La=i.Symbol;if(a&&"function"==typeof La&&(!("description"in La.prototype)||void 0!==La().description)){var Pa={},Na=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Na?new La(e):void 0===e?La():La(e);return""===e&&(Pa[t]=!0),t};we(Na,La);var Ua=Na.prototype=La.prototype;Ua.constructor=Na;var Fa=Ua.toString,ja="Symbol(test)"==String(La("test")),Ga=/^Symbol\((.*)\)[^)]+$/;Da(Ua,"description",{configurable:!0,get:function(){var e=m(this)?this.valueOf():this,t=Fa.call(e);if(b(Pa,e))return"";var n=ja?t.slice(7,-1):t.replace(Ga,"$1");return""===n?void 0:n}}),Me({global:!0,forced:!0},{Symbol:Na})}ea("iterator");var Ba=Ve("unscopables"),Va=Array.prototype;null==Va[Ba]&&R.f(Va,Ba,{configurable:!0,value:Wo(null)});var qa=function(e){Va[Ba][e]=!0},Ha=We.findIndex,za=!0;"findIndex"in[]&&Array(1).findIndex(function(){za=!1}),Me({target:"Array",proto:!0,forced:za},{findIndex:function(e){return Ha(this,e,arguments.length>1?arguments[1]:void 0)}}),qa("findIndex");var Ka=We.forEach,Wa=qn("forEach")?function(e){return Ka(this,e,arguments.length>1?arguments[1]:void 0)}:[].forEach;Me({target:"Array",proto:!0,forced:[].forEach!=Wa},{forEach:Wa});var Ya,Ja,Xa,Qa={},Za=Ve("iterator"),$a=!1;[].keys&&("next"in(Xa=[].keys())?(Ja=vr(vr(Xa)))!==Object.prototype&&(Ya=Ja):$a=!0),null==Ya&&(Ya={}),b(Ya,Za)||A(Ya,Za,function(){return this});var es={IteratorPrototype:Ya,BUGGY_SAFARI_ITERATORS:$a},ts=es.IteratorPrototype,ns=function(){return this},rs=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return C(n),function(e){if(!m(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),is=es.IteratorPrototype,os=es.BUGGY_SAFARI_ITERATORS,as=Ve("iterator"),ss=function(){return this},us=function(e,t,n,r,i,o,a){!function(e,t,n){var r=t+" Iterator";e.prototype=Wo(ts,{next:c(1,n)}),ra(e,r,!1),Qa[r]=ns}(n,t,r);var s,u,l,d=function(e){if(e===i&&v)return v;if(!os&&e in h)return h[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},f=t+" Iterator",p=!1,h=e.prototype,g=h[as]||h["@@iterator"]||i&&h[i],v=!os&&g||d(i),m="Array"==t&&h.entries||g;if(m&&(s=vr(m.call(new e)),is!==Object.prototype&&s.next&&(vr(s)!==is&&(rs?rs(s,is):"function"!=typeof s[as]&&A(s,as,ss)),ra(s,f,!0))),"values"==i&&g&&"values"!==g.name&&(p=!0,v=function(){return g.call(this)}),h[as]!==v&&A(h,as,v),Qa[t]=v,i)if(u={values:d("values"),keys:o?v:d("keys"),entries:d("entries")},a)for(l in u)!os&&!p&&l in h||ne(h,l,u[l]);else Me({target:t,proto:!0,forced:os||p},u);return u},ls=te.set,cs=te.getterFor("Array Iterator"),ds=us(Array,"Array",function(e,t){ls(this,{type:"Array Iterator",target:v(e),index:0,kind:t})},function(){var e=cs(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values");Qa.Arguments=Qa.Array,qa("keys"),qa("values"),qa("entries");var fs=!o(function(){return Object.isExtensible(Object.preventExtensions({}))}),ps=n(function(e){var t=R.f,n=q("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},a=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!m(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!b(e,n)){if(!i(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!b(e,n)){if(!i(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return fs&&a.REQUIRED&&i(e)&&!b(e,n)&&o(e),e}};K[n]=!0}),hs=(ps.REQUIRED,ps.fastKey,ps.getWeakData,ps.onFreeze,Ve("iterator")),gs=Array.prototype,vs=Ve("iterator"),ms=function(e,t,n,r){try{return r?t(C(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&C(i.call(e)),t}},ys=n(function(e){var t=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,n,r,i,o){var a,s,u,l,c,d,f,p,h=Le(n,r,i?2:1);if(o)a=e;else{if("function"!=typeof(s=function(e){if(null!=e)return e[vs]||e["@@iterator"]||Qa[kr(e)]}(e)))throw TypeError("Target is not iterable");if(void 0!==(p=s)&&(Qa.Array===p||gs[hs]===p)){for(u=0,l=ce(e.length);l>u;u++)if((c=i?h(C(f=e[u])[0],f[1]):h(e[u]))&&c instanceof t)return c;return new t(!1)}a=s.call(e)}for(d=a.next;!(f=d.call(a)).done;)if("object"==typeof(c=ms(a,h,f.value,i))&&c&&c instanceof t)return c;return new t(!1)}).stop=function(e){return new t(!0,e)}}),_s=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},bs=Ve("iterator"),Ss=!1;try{var ks=0,ws={next:function(){return{done:!!ks++}},return:function(){Ss=!0}};ws[bs]=function(){return this},Array.from(ws,function(){throw 2})}catch(e){}var Es=function(e,t){if(!t&&!Ss)return!1;var n=!1;try{var r={};r[bs]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Ts=function(e,t,n){var r,i;return rs&&"function"==typeof(r=t.constructor)&&r!==n&&m(i=r.prototype)&&i!==n.prototype&&rs(e,i),e},xs=function(e,t,n){for(var r in t)ne(e,r,t[r],n);return e},Cs=Ve("species"),Is=function(e){var t=oe(e),n=R.f;a&&t&&!t[Cs]&&n(t,Cs,{configurable:!0,get:function(){return this}})},Rs=R.f,As=ps.fastKey,Os=te.set,Ms=te.getterFor,Ds=(function(e,t,n){var r=-1!==e.indexOf("Map"),a=-1!==e.indexOf("Weak"),s=r?"set":"add",u=i[e],l=u&&u.prototype,c=u,d={},f=function(e){var t=l[e];ne(l,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(a&&!m(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return a&&!m(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(a&&!m(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(Ae(e,"function"!=typeof u||!(a||l.forEach&&!o(function(){(new u).entries().next()}))))c=n.getConstructor(t,e,r,s),ps.REQUIRED=!0;else if(Ae(e,!0)){var p=new c,h=p[s](a?{}:-0,1)!=p,g=o(function(){p.has(1)}),v=Es(function(e){new u(e)}),y=!a&&o(function(){for(var e=new u,t=5;t--;)e[s](t,t);return!e.has(-0)});v||((c=t(function(t,n){_s(t,c,e);var i=Ts(new u,t,c);return null!=n&&ys(n,i[s],i,r),i})).prototype=l,l.constructor=c),(g||y)&&(f("delete"),f("has"),r&&f("get")),(y||h)&&f(s),a&&l.clear&&delete l.clear}d[e]=c,Me({global:!0,forced:c!=u},d),ra(c,e),a||n.setStrong(c,e,r)}("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(e,t,n,r){var i=e(function(e,o){_s(e,i,t),Os(e,{type:t,index:Wo(null),first:void 0,last:void 0,size:0}),a||(e.size=0),null!=o&&ys(o,e[r],e,n)}),o=Ms(t),s=function(e,t,n){var r,i,s=o(e),l=u(e,t);return l?l.value=n:(s.last=l={index:i=As(t,!0),key:t,value:n,previous:r=s.last,next:void 0,removed:!1},s.first||(s.first=l),r&&(r.next=l),a?s.size++:e.size++,"F"!==i&&(s.index[i]=l)),e},u=function(e,t){var n,r=o(e),i=As(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return xs(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,a?e.size=0:this.size=0},delete:function(e){var t=o(this),n=u(this,e);if(n){var r=n.next,i=n.previous;delete t.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),t.first==n&&(t.first=r),t.last==n&&(t.last=i),a?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=o(this),r=Le(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!u(this,e)}}),xs(i.prototype,n?{get:function(e){var t=u(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),a&&Rs(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=Ms(t),o=Ms(r);us(e,t,function(e,t){Os(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})},n?"entries":"values",!n,!0),Is(t)}}),"\t\n\v\f\r                　\u2028\u2029\ufeff"),Ls="["+Ds+"]",Ps=RegExp("^"+Ls+Ls+"*"),Ns=RegExp(Ls+Ls+"*$"),Us=function(e){return function(t){var n=String(g(t));return 1&e&&(n=n.replace(Ps,"")),2&e&&(n=n.replace(Ns,"")),n}},Fs={start:Us(1),end:Us(2),trim:Us(3)},js=be.f,Gs=x.f,Bs=R.f,Vs=Fs.trim,qs=i.Number,Hs=qs.prototype,zs="Number"==f(Wo(Hs)),Ks=function(e){var t,n,r,i,o,a,s,u,l=y(e,!1);if("string"==typeof l&&l.length>2)if(43===(t=(l=Vs(l)).charCodeAt(0))||45===t){if(88===(n=l.charCodeAt(2))||120===n)return NaN}else if(48===t){switch(l.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+l}for(a=(o=l.slice(2)).length,s=0;s<a;s++)if((u=o.charCodeAt(s))<48||u>i)return NaN;return parseInt(o,r)}return+l};if(Ae("Number",!qs(" 0o1")||!qs("0b1")||qs("+0x1"))){for(var Ws,Ys=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof Ys&&(zs?o(function(){Hs.valueOf.call(n)}):"Number"!=f(n))?Ts(new qs(Ks(t)),n,Ys):Ks(t)},Js=a?js(qs):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Xs=0;Js.length>Xs;Xs++)b(qs,Ws=Js[Xs])&&!b(Ys,Ws)&&Bs(Ys,Ws,Gs(qs,Ws));Ys.prototype=Hs,Hs.constructor=Ys,ne(i,"Number",Ys)}var Qs=Math.floor;Me({target:"Number",stat:!0},{isInteger:function(e){return!m(e)&&isFinite(e)&&Qs(e)===e}});var Zs=Fs.trim,$s=i.parseInt,eu=/^[+-]?0[Xx]/,tu=8!==$s(Ds+"08")||22!==$s(Ds+"0x16")?function(e,t){var n=Zs(String(e));return $s(n,t>>>0||(eu.test(n)?16:10))}:$s;Me({global:!0,forced:parseInt!=tu},{parseInt:tu});var nu,ru,iu,ou=i.Promise,au=/(iphone|ipod|ipad).*applewebkit/i.test(Ye),su=i.location,uu=i.setImmediate,lu=i.clearImmediate,cu=i.process,du=i.MessageChannel,fu=i.Dispatch,pu=0,hu={},gu=function(e){if(hu.hasOwnProperty(e)){var t=hu[e];delete hu[e],t()}},vu=function(e){return function(){gu(e)}},mu=function(e){gu(e.data)},yu=function(e){i.postMessage(e+"",su.protocol+"//"+su.host)};uu&&lu||(uu=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return hu[++pu]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},nu(pu),pu},lu=function(e){delete hu[e]},"process"==f(cu)?nu=function(e){cu.nextTick(vu(e))}:fu&&fu.now?nu=function(e){fu.now(vu(e))}:du&&!au?(iu=(ru=new du).port2,ru.port1.onmessage=mu,nu=Le(iu.postMessage,iu,1)):!i.addEventListener||"function"!=typeof postMessage||i.importScripts||o(yu)?nu="onreadystatechange"in w("script")?function(e){Vo.appendChild(w("script")).onreadystatechange=function(){Vo.removeChild(this),gu(e)}}:function(e){setTimeout(vu(e),0)}:(nu=yu,i.addEventListener("message",mu,!1)));var _u,bu,Su,ku,wu,Eu,Tu,xu,Cu={set:uu,clear:lu},Iu=x.f,Ru=Cu.set,Au=i.MutationObserver||i.WebKitMutationObserver,Ou=i.process,Mu=i.Promise,Du="process"==f(Ou),Lu=Iu(i,"queueMicrotask"),Pu=Lu&&Lu.value;Pu||(_u=function(){var e,t;for(Du&&(e=Ou.domain)&&e.exit();bu;){t=bu.fn,bu=bu.next;try{t()}catch(e){throw bu?ku():Su=void 0,e}}Su=void 0,e&&e.enter()},Du?ku=function(){Ou.nextTick(_u)}:Au&&!au?(wu=!0,Eu=document.createTextNode(""),new Au(_u).observe(Eu,{characterData:!0}),ku=function(){Eu.data=wu=!wu}):Mu&&Mu.resolve?(Tu=Mu.resolve(void 0),xu=Tu.then,ku=function(){xu.call(Tu,_u)}):ku=function(){Ru.call(i,_u)});var Nu,Uu,Fu,ju,Gu=Pu||function(e){var t={fn:e,next:void 0};Su&&(Su.next=t),bu||(bu=t,ku()),Su=t},Bu=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=De(t),this.reject=De(n)},Vu={f:function(e){return new Bu(e)}},qu=function(e,t){if(C(e),m(t)&&t.constructor===e)return t;var n=Vu.f(e);return(0,n.resolve)(t),n.promise},Hu=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},zu=Cu.set,Ku=Ve("species"),Wu="Promise",Yu=te.get,Ju=te.set,Xu=te.getterFor(Wu),Qu=ou,Zu=i.TypeError,$u=i.document,el=i.process,tl=oe("fetch"),nl=Vu.f,rl=nl,il="process"==f(el),ol=!!($u&&$u.createEvent&&i.dispatchEvent),al=Ae(Wu,function(){if(U(Qu)===String(Qu)){if(66===Ze)return!0;if(!il&&"function"!=typeof PromiseRejectionEvent)return!0}if(Ze>=51&&/native code/.test(Qu))return!1;var e=Qu.resolve(1),t=function(e){e(function(){},function(){})};return(e.constructor={})[Ku]=t,!(e.then(function(){})instanceof t)}),sl=al||!Es(function(e){Qu.all(e).catch(function(){})}),ul=function(e){var t;return!(!m(e)||"function"!=typeof(t=e.then))&&t},ll=function(e,t,n){if(!t.notified){t.notified=!0;var r=t.reactions;Gu(function(){for(var i=t.value,o=1==t.state,a=0;r.length>a;){var s,u,l,c=r[a++],d=o?c.ok:c.fail,f=c.resolve,p=c.reject,h=c.domain;try{d?(o||(2===t.rejection&&pl(e,t),t.rejection=1),!0===d?s=i:(h&&h.enter(),s=d(i),h&&(h.exit(),l=!0)),s===c.promise?p(Zu("Promise-chain cycle")):(u=ul(s))?u.call(s,f,p):f(s)):p(i)}catch(e){h&&!l&&h.exit(),p(e)}}t.reactions=[],t.notified=!1,n&&!t.rejection&&dl(e,t)})}},cl=function(e,t,n){var r,o;ol?((r=$u.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),i.dispatchEvent(r)):r={promise:t,reason:n},(o=i["on"+e])?o(r):"unhandledrejection"===e&&function(e,t){var n=i.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},dl=function(e,t){zu.call(i,function(){var n,r=t.value;if(fl(t)&&(n=Hu(function(){il?el.emit("unhandledRejection",r,e):cl("unhandledrejection",e,r)}),t.rejection=il||fl(t)?2:1,n.error))throw n.value})},fl=function(e){return 1!==e.rejection&&!e.parent},pl=function(e,t){zu.call(i,function(){il?el.emit("rejectionHandled",e):cl("rejectionhandled",e,t.value)})},hl=function(e,t,n,r){return function(i){e(t,n,i,r)}},gl=function(e,t,n,r){t.done||(t.done=!0,r&&(t=r),t.value=n,t.state=2,ll(e,t,!0))},vl=function(e,t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(e===n)throw Zu("Promise can't be resolved itself");var i=ul(n);i?Gu(function(){var r={done:!1};try{i.call(n,hl(vl,e,r,t),hl(gl,e,r,t))}catch(n){gl(e,r,n,t)}}):(t.value=n,t.state=1,ll(e,t,!1))}catch(n){gl(e,{done:!1},n,t)}}};al&&(Qu=function(e){_s(this,Qu,Wu),De(e),Nu.call(this);var t=Yu(this);try{e(hl(vl,this,t),hl(gl,this,t))}catch(e){gl(this,t,e)}},(Nu=function(e){Ju(this,{type:Wu,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=xs(Qu.prototype,{then:function(e,t){var n=Xu(this),r=nl(ni(this,Qu));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=il?el.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&ll(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Uu=function(){var e=new Nu,t=Yu(e);this.promise=e,this.resolve=hl(vl,e,t),this.reject=hl(gl,e,t)},Vu.f=nl=function(e){return e===Qu||e===Fu?new Uu(e):rl(e)},"function"==typeof ou&&(ju=ou.prototype.then,ne(ou.prototype,"then",function(e,t){var n=this;return new Qu(function(e,t){ju.call(n,e,t)}).then(e,t)},{unsafe:!0}),"function"==typeof tl&&Me({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return qu(Qu,tl.apply(i,arguments))}}))),Me({global:!0,wrap:!0,forced:al},{Promise:Qu}),ra(Qu,Wu,!1),Is(Wu),Fu=oe(Wu),Me({target:Wu,stat:!0,forced:al},{reject:function(e){var t=nl(this);return t.reject.call(void 0,e),t.promise}}),Me({target:Wu,stat:!0,forced:al},{resolve:function(e){return qu(this,e)}}),Me({target:Wu,stat:!0,forced:sl},{all:function(e){var t=this,n=nl(t),r=n.resolve,i=n.reject,o=Hu(function(){var n=De(t.resolve),o=[],a=0,s=1;ys(e,function(e){var u=a++,l=!1;o.push(void 0),s++,n.call(t,e).then(function(e){l||(l=!0,o[u]=e,--s||r(o))},i)}),--s||r(o)});return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=nl(t),r=n.reject,i=Hu(function(){var i=De(t.resolve);ys(e,function(e){i.call(t,e).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var ml=Hr.charAt,yl=te.set,_l=te.getterFor("String Iterator");us(String,"String",function(e){yl(this,{type:"String Iterator",string:String(e),index:0})},function(){var e,t=_l(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=ml(n,r),t.index+=e.length,{value:e,done:!1})}),Vr("match",1,function(e,t,n){return[function(t){var n=g(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;var i=C(e),o=String(this);if(!i.global)return Wr(i,o);var a=i.unicode;i.lastIndex=0;for(var s,u=[],l=0;null!==(s=Wr(i,o));){var c=String(s[0]);u[l]=c,""===c&&(i.lastIndex=Kr(o,ce(i.lastIndex),a)),l++}return 0===l?null:u}]});var bl,Sl=function(e){if(ei(e))throw TypeError("The method doesn't accept regular expressions");return e},kl=Ve("match"),wl=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[kl]=!1,"/./"[e](t)}catch(e){}}return!1},El=x.f,Tl="".startsWith,xl=Math.min,Cl=wl("startsWith"),Il=!(Cl||(bl=El(String.prototype,"startsWith"),!bl||bl.writable));Me({target:"String",proto:!0,forced:!Il&&!Cl},{startsWith:function(e){var t=String(g(this));Sl(e);var n=ce(xl(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return Tl?Tl.call(t,r,n):t.slice(n,n+r.length)===r}});var Rl={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0};for(var Al in Rl){var Ol=i[Al],Ml=Ol&&Ol.prototype;if(Ml&&Ml.forEach!==Wa)try{A(Ml,"forEach",Wa)}catch(e){Ml.forEach=Wa}}var Dl=Ve("iterator"),Ll=Ve("toStringTag"),Pl=ds.values;for(var Nl in Rl){var Ul=i[Nl],Fl=Ul&&Ul.prototype;if(Fl){if(Fl[Dl]!==Pl)try{A(Fl,Dl,Pl)}catch(e){Fl[Dl]=Pl}if(Fl[Ll]||A(Fl,Ll,Nl),Rl[Nl])for(var jl in ds)if(Fl[jl]!==ds[jl])try{A(Fl,jl,ds[jl])}catch(e){Fl[jl]=ds[jl]}}}var Gl=ge.indexOf,Bl=[].indexOf,Vl=!!Bl&&1/[1].indexOf(1,-0)<0,ql=qn("indexOf");Me({target:"Array",proto:!0,forced:Vl||ql},{indexOf:function(e){return Vl?Bl.apply(this,arguments)||0:Gl(this,e,arguments.length>1?arguments[1]:void 0)}});var Hl=o(function(){Go(1)});Me({target:"Object",stat:!0,forced:Hl},{keys:function(e){return Go(Pe(e))}});var zl=l.f,Kl=function(e){return function(t){for(var n,r=v(t),i=Go(r),o=i.length,s=0,u=[];o>s;)n=i[s++],a&&!zl.call(r,n)||u.push(e?[n,r[n]]:r[n]);return u}},Wl=(Kl(!0),Kl(!1));Me({target:"Object",stat:!0},{values:function(e){return Wl(e)}});var Yl=n(function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,o),!0;case 6:return c.fn.call(c.context,t,r,i,o,a),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,i);break;default:if(!u)for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}),Jl="connection-state-changed",Xl="connected",Ql="error",Zl={DISCONNECTED:"DISCONNECTED",CONNECTING:"CONNECTING",RECONNECTING:"RECONNECTING",CONNECTED:"CONNECTED"},$l={NEW_REMOTE_SDP:2,NEW_ICE_CANDIDATE:4,CLINET_BANNDED:8,CHANNEL_SETUP_SUCCESS:19,CHANNEL_SETUP_FAILED:80,REBUILD_SESSION_RESULT:514,JOIN_ROOM_RESULT:20,PEER_JOIN:16,PEER_LEAVE:18,UPDATE_REMOTE_SDP:48,UPDATE_AUDIO_SSRC:50,UPDATE_VIDEO_SSRC:52,UPLINK_NETWORK_STATS:22,UPDATE_REMOTE_MUTE_STAT:23,CLOSE_PEER_ACK:10,SUBSCRIBE_ACK:26,PONG:775},ec={NEW_REMOTE_SDP:"new-remote-sdp",NEW_ICE_CANDIDATE:"new-ice-candidate",CLINET_BANNDED:"client-banned",CHANNEL_SETUP_SUCCESS:"channel-setup-success",CHANNEL_SETUP_FAILED:"channel-setup-failed",REBUILD_SESSION_RESULT:"channel-reconnect-result",JOIN_ROOM_RESULT:"join-room-result",PEER_JOIN:"peer-join",PEER_LEAVE:"peer-leave",UPDATE_REMOTE_SDP:"update-remote-sdp",UPDATE_AUDIO_SSRC:"update-audio-ssrc",UPDATE_VIDEO_SSRC:"update-video-ssrc",UPLINK_NETWORK_STATS:"uplink-network-stats",UPDATE_REMOTE_MUTE_STAT:"update-remote-mute-stat",CLOSE_PEER_ACK:"close-peer-ack",SUBSCRIBE_ACK:"subscribe-ack",REQUEST_REBUILD_SESSION:"request-rebuild-session",CLIENT_REJOIN:"client-rejoin",PONG:"pong"},tc="on_peer_sdp",nc="on_close_peer",rc={INVALID_PARAMETER:4096,INVALID_OPERATION:4097,NOT_SUPPORTED:4098,DEVICE_NOT_FOUND:4099,SIGNAL_CHANNEL_SETUP_FAILED:16385,SIGNAL_CHANNEL_ERROR:16386,ICE_TRANSPORT_ERROR:16387,JOIN_ROOM_FAILED:16388,CREATE_OFFER_FAILED:16389,SIGNAL_CHANNEL_RECONNECTION_FAILED:16390,UPLINK_RECONNECTION_FAILED:16391,DOWNLINK_RECONNECTION_FAILED:16392,CLIENT_BANNED:16448,SERVER_TIMEOUT:16449,SUBSCRIPTION_TIMEOUT:16450,PLAY_NOT_ALLOWED:16451,UNKNOWN:65535},ic=function(e){for(var t in rc)if(rc[t]===e)return t;return"UNKNOWN"},oc=function(e){function t(e){var n,r=e.message,i=e.code,o=void 0===i?rc.UNKNOWN:i,a=e.extraCode,s=void 0===a?0:a;return ct(this,t),(n=bt(this,vt(t).call(this,r+" <".concat(ic(o)," 0x").concat(o.toString(16),"> https://trtc-1252463788.file.myqcloud.com/web/docs/module-ErrorCode.html")))).code_=o,n.extraCode_=s,n.name="RtcError",n.message_=r,n}return gt(t,_t(Error)),ft(t,[{key:"getCode",value:function(){return this.code_}},{key:"getExtraCode",value:function(){return this.extraCode_}}]),t}(),ac=new Map,sc=function(e,t){var n=ac.get(e);n||(ac.set(e,[]),n=ac.get(e)),n.push(t)},uc=function(e){var t=ac.get(e);return t?ac.delete(e):t=[],t},lc="5Y2wZK8nANNAoVw6dSAHVjNxrD1ObBM2kBPV",cc="224d130c-7b5c-415b-aaa2-79c2eb5a6df2",dc=0,fc={JOIN:"join",PUBLISH:"publish",UNPUBLISH:"unpublish",LOCAL_STREAM_INITIALIZE:"local_stream_initialize",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscibe",UPLINK_CONNECTION:"uplink_connection",UPLINK_RECONNECTION:"uplink_reconnection",DOWNLINK_CONNECTION:"downlink_connection",DOWNLINK_RECONNECTION:"downlink_reconnection",SIGNAL_CONNECTION:"signal_connection",SIGNAL_RECONNECTION:"signal_reconnection",UPDATE_STREAM:"update_stream"},pc="pending",hc="success",gc={CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected"},vc={JOIN:"join",DELTA_JOIN:"delta-join",REJOIN:"rejoin",LEAVE:"leave",DELTA_LEAVE:"delta-leave",PUBLISH:"publish",DELTA_PUBLISH:"delta-publish",UNPUBLISH:"unpublish",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",UPLINK_CONNECTION:"uplink-connection",UPLINK_RECONNECTION:"uplink-reconnection",DOWNLINK_CONNECTION:"downlink-connection",DOWNLINK_RECONNECTION:"downlink-reconnection",ON_TRACK:"ontrack",SET_LOCAL_DESCRIPTION:"setLocalDescription",SET_REMOTE_DESCRIPTION:"setRemoteDescription",ICE_CONNECTION_STATE:"iceConnectionState",LOCAL_STREAM_INITIALIZE:"stream-initialize",SIGNAL_CONNECTION:"websocketConnectionState",SIGNAL_RECONNECTION:"websocketReconnectionState",UPDATE_STREAM:"update-stream",RECOVER_SUBSCRIPTION:"recover-subscription"},mc=R.f,yc=be.f,_c=te.set,bc=Ve("match"),Sc=i.RegExp,kc=Sc.prototype,wc=/a/g,Ec=/a/g,Tc=new Sc(wc)!==wc,xc=xr.UNSUPPORTED_Y;if(a&&Ae("RegExp",!Tc||xc||o(function(){return Ec[bc]=!1,Sc(wc)!=wc||Sc(Ec)==Ec||"/a/i"!=Sc(wc,"i")}))){for(var Cc=function(e,t){var n,r=this instanceof Cc,i=ei(e),o=void 0===t;if(!r&&i&&e.constructor===Cc&&o)return e;Tc?i&&!o&&(e=e.source):e instanceof Cc&&(o&&(t=Er.call(e)),e=e.source),xc&&(n=!!t&&t.indexOf("y")>-1)&&(t=t.replace(/y/g,""));var a=Ts(Tc?new Sc(e,t):Sc(e,t),r?this:kc,Cc);return xc&&n&&_c(a,{sticky:n}),a},Ic=function(e){e in Cc||mc(Cc,e,{configurable:!0,get:function(){return Sc[e]},set:function(t){Sc[e]=t}})},Rc=yc(Sc),Ac=0;Rc.length>Ac;)Ic(Rc[Ac++]);kc.constructor=Cc,Cc.prototype=kc,ne(i,"RegExp",Cc)}Is("RegExp");var Oc=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};Vr("search",1,function(e,t,n){return[function(t){var n=g(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;var i=C(e),o=String(this),a=i.lastIndex;Oc(a,0)||(i.lastIndex=0);var s=Wr(i,o);return Oc(i.lastIndex,a)||(i.lastIndex=a),null===s?-1:s.index}]});var Mc=Fs.trim,Dc=i.parseFloat,Lc=1/Dc(Ds+"-0")!=-1/0?function(e){var t=Mc(String(e)),n=Dc(t);return 0===n&&"-"==t.charAt(0)?-0:n}:Dc;Me({global:!0,forced:parseFloat!=Lc},{parseFloat:Lc});var Pc=window.navigator&&window.navigator.userAgent||"",Nc=/AppleWebKit\/([\d.]+)/i.exec(Pc),Uc=(Nc&&parseFloat(Nc.pop()),/iPad/i.test(Pc)),Fc=/iPhone/i.test(Pc)&&!Uc,jc=/iPod/i.test(Pc),Gc=Fc||Uc||jc,Bc=(function(){var e=Pc.match(/OS (\d+)_/i);e&&e[1]&&e[1]}(),/Android/i.test(Pc)),Vc=(function(){var e=Pc.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);t&&n&&parseFloat(e[1]+"."+e[2])}(),Bc&&/webkit/i.test(Pc),/Firefox/i.test(Pc)),qc=function(){var e=Pc.match(/Firefox\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),Hc=/Edge\//i.test(Pc),zc=/Edg\//i.test(Pc),Kc=function(){var e=Pc.match(/Edg\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),Wc=!Hc&&/Chrome/i.test(Pc),Yc=function(){var e=Pc.match(/Chrome\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),Jc=function(){var e=Pc.match(/Chrome\/([\d.]+)/);return e&&e[1]?e[1]:null}(),Xc=(/MSIE\s8\.0/.test(Pc),function(){var e=/MSIE\s(\d+)\.\d/.exec(Pc),t=e&&parseFloat(e[1]);!t&&/Trident\/7.0/i.test(Pc)&&/rv:11.0/.test(Pc)&&(t=11)}(),/Safari/i.test(Pc)&&!Wc&&!Bc&&!Hc),Qc=function(){var e=Pc.match(/Version\/([\d.]+)/);return e&&e[1]?e[1]:null}(),Zc=/TBS\/\d+/i.test(Pc),$c=(function(){var e=Pc.match(/TBS\/(\d+)/i);e&&e[1]&&e[1]}(),!Zc&&/MQQBrowser\/\d+/i.test(Pc)),ed=(!Zc&&/ QQBrowser\/\d+/i.test(Pc),/(micromessenger|webbrowser)/i.test(Pc),/Windows/i.test(Pc)),td=/MAC OS X/i.test(Pc),nd=/Linux/i.test(Pc),rd=(/MicroMessenger/i.test(Pc),/UCBrowser/i.test(Pc)),id=(/MiuiBrowser/i.test(Pc),/HuaweiBrowser/i.test(Pc),Wc?"Chrome/"+Jc:Xc?"Safari/"+Qc:"NotSupportedBrowser"),od="file:"===location.protocol||"localhost"===location.hostname||/^\d+\.\d+\.\d+\.\d+$/.test(location.hostname),ad=function(e){var t=window.location.search.match(new RegExp("(\\?|&)"+e+"=([^&]*)(&|$)"));return t?decodeURIComponent(t[2]):""},sd=function(){return ad("trtc_env")},ud=function(e){var t=e,n=ad("trtc_env");return n&&(t="wss://"+n+".rtc.qq.com:8687"),t},ld=function(e){if(!e||"object"!==st(e)||"[object Object]"!=Object.prototype.toString.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Function.prototype.toString.call(n)===Function.prototype.toString.call(Object)};function cd(e){var t=Math.round(e/2)+1;return t>6?13e3:1e3*function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t<=1?r:e(t-1,r,n+r)}(t)}var dd={sdkAppId:"",userId:"",version:"",env:"qcloud",browserVersion:"",ua:""},fd=function(e){dd.sdkAppId="".concat(e.sdkAppId),dd.version="".concat(e.version),dd.env=e.env,dd.userId=e.userId,dd.browserVersion=e.browserVersion,dd.ua=e.ua},pd=function(e,t){var n={timestamp:So(),sdkAppId:dd.sdkAppId,userId:dd.userId,version:dd.version,log:e};t&&(n.errorInfo=t.message),yo.post("https://yun.tim.qq.com/v5/AVQualityReportSvc/C2S?sdkappid=1&cmdtype=jssdk_log",JSON.stringify(n)).catch(function(){})},hd=function(e){var t="stat-".concat(e.eventType,"-").concat(e.result);"delta-join"!==e.eventType&&"delta-leave"!==e.eventType&&"delta-publish"!==e.eventType||(t="".concat(e.eventType,":").concat(e.delta)),pd(t),"failed"===e.result&&(t="stat-".concat(e.eventType,"-").concat(e.result,"-").concat(e.code),pd(t,e.error))},gd=function(e){if(!od){var t=ht({},e,dd);void 0===t.code&&(t.code="failed"===t.result?rc.UNKNOWN:0),yo.post("https://yun.tim.qq.com/v5/AVQualityReportSvc/C2S?sdkappid=1&cmdtype=jssdk_event",JSON.stringify(t)).catch(function(){})}},vd=function(e){od||(gd(ht({},e,{result:"success"})),"qcloud"===dd.env&&hd(ht({},e,{result:"success"})))},md=function(e){if(!od){var t=e.eventType,n=e.code,r=e.error,i={eventType:t,result:"failed",code:n||(r instanceof oc?r.getExtraCode()||r.getCode():rc.UNKNOWN)};gd(i),"qcloud"===dd.env&&hd(ht({},i,{error:r}))}},yd=Object.prototype.hasOwnProperty;function _d(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(ld(e))switch(Object.prototype.toString.call(e)){case"[object File]":case"[object Map]":case"[object Set]":return 0===e.size;case"[object Object]":for(var t in e)if(yd.call(e,t))return!1;return!0}return!1}var bd=function(){function e(t){ct(this,e),this.sdkAppId_=t.sdkAppId,this.userId_=t.userId,this.userSig_=t.userSig,this.url_=t.url,this.backupUrl_=t.backupUrl,this.version_=t.version,this.urlWithParam_="".concat(this.url_,"?sdkAppid=").concat(this.sdkAppId_,"&identifier=").concat(this.userId_,"&userSig=").concat(this.userSig_),this.backupUrlWithParam_="".concat(this.backupUrl_,"?sdkAppid=").concat(this.sdkAppId_,"&identifier=").concat(this.userId_,"&userSig=").concat(this.userSig_),this.isConnected_=!1,this.isConnecting_=!1,this.socketInUse_=null,this.socket_=null,this.backupSocket_=null,this.backupTimer_=-1,this.signalInfo_={},this.currentState_=Zl.DISCONNECTED,this.reconnectionCount_=0,this.reconnectionTimer_=-1,this.pingPongTimeoutId_=-1,this.pingTimeoutId_=-1,this.emitter_=new Yl}var t;return ft(e,[{key:"connect",value:function(){var e=this;Un.info("connect to url: ".concat(this.urlWithParam_)),this.emitter_.emit(Jl,{prevState:this.currentState_,state:Zl.CONNECTING}),this.currentState_=Zl.CONNECTING,this.socket_=new WebSocket(this.urlWithParam_),this.bindSocket(this.socket_),this.backupTimer_=setTimeout(function(){e.isConnected_||(Un.info("trying to connect to backupUrl"),e.tryConnectBackup())},1e3)}},{key:"tryConnectBackup",value:function(){this.backupSocket_||(Un.debug("try to connect to url: ".concat(this.backupUrlWithParam_)),this.backupSocket_=new WebSocket(this.backupUrlWithParam_),this.bindSocket(this.backupSocket_))}},{key:"bindSocket",value:function(e){e.onopen=this.onopen.bind(this),e.onclose=this.onclose.bind(this),e.onerror=this.onerror.bind(this),e.onmessage=this.onmessage.bind(this)}},{key:"unbindSocket",value:function(e){e.onopen=function(){},e.onclose=function(){},e.onerror=function(){},e.onmessage=function(){}}},{key:"unbindAndCloseSocket",value:function(e){if("main"===e){if(this.socket_){this.unbindSocket(this.socket_);try{this.socket_.close(1e3)}catch(e){}this.socket_=null}}else if(this.backupSocket_){this.unbindSocket(this.backupSocket_);try{this.backupSocket_.close(1e3)}catch(e){}this.backupSocket_=null}}},{key:"clearBackupTimer",value:function(){-1!==this.backupTimer_&&(clearTimeout(this.backupTimer_),this.backupTimer_=-1)}},{key:"clearReconnectionTimer",value:function(){-1!==this.reconnectionTimer_&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}},{key:"onopen",value:function(e){if(!this.isConnected_){this.isConnected_=!0,this.isConnecting_=!1,this.clearBackupTimer(),e.target===this.socket_?(this.unbindAndCloseSocket("backup"),this.socketInUse_=this.socket_):(this.unbindAndCloseSocket("main"),this.socketInUse_=this.backupSocket_);var t=e.target.url;Un.info("[".concat(this.userId_,"] websocket[").concat(t,"] is connected")),this.emitter_.emit(Jl,{prevState:this.currentState_,state:Zl.CONNECTED}),this.currentState_=Zl.CONNECTED,this.emitter_.emit(Xl)}}},{key:"onclose",value:function(e){var t=e.target.url,n=e.target===this.socketInUse_;Un.info("[".concat(this.userId_,"] websocket[").concat(t," InUse: ").concat(n,"] is closed with code: ").concat(e.code)),e.target===this.socketInUse_&&(this.isConnected_=!1,this.addSignalEvent("disconnected"),e.wasClean&&1e3===e.code?(this.emitter_.emit(Jl,{prevState:this.currentState_,state:Zl.DISCONNECTED}),this.currentState_=Zl.DISCONNECTED):(Un.warn("[".concat(this.userId_,"] onclose code:").concat(e.code," reason:").concat(e.reason)),Un.warn("close current websocket and schedule a reconnect timeout"),this.socketInUse_.onclose=function(){},this.socketInUse_.close(4011),this.socket_=this.backupSocket_=this.socketInUse_=null,this.reconnect("main")))}},{key:"onerror",value:function(e){var t=e.target.url;Un.debug("[".concat(this.userId_,"] websocket[").concat(t,"] error observed")),this.isConnected_?e.target===this.socketInUse_&&(this.isConnected_=!1,this.unbindAndCloseSocket("main"),this.unbindAndCloseSocket("backup"),this.socketInUse_=null,this.addSignalEvent("disconnected"),this.reconnect("main")):(this.isReconnecting_||md({eventType:vc.SIGNAL_CONNECTION,code:rc.UNKNOWN}),e.target==this.socket_?(this.unbindAndCloseSocket("main"),this.reconnect("backup")):(this.unbindAndCloseSocket("backup"),this.reconnect("main"))),this.isConnecting_=!1,this.isConnected_=!1}},{key:"onmessage",value:function(e){var t=this;if(this.isConnected_){var n=JSON.parse(e.data),r=n.cmd,i=n.content,o=Object.values($l),a=Object.keys($l)[o.indexOf(r)],s=ec[a];if(r!==$l.UPDATE_REMOTE_MUTE_STAT&&r!==$l.UPLINK_NETWORK_STATS&&r!==$l.PONG){var u=e.target==this.socket_?this.url_:this.backupUrl_;if(Un.debug("[".concat(this.userId_,"] websocket[").concat(u,"] received message: ").concat(e.data)),Un.info("[".concat(this.userId_,"] Received event: [ ").concat(s||"unknown cmd: "+r," ]")),(s===ec.UPDATE_REMOTE_SDP||s===ec.UPDATE_AUDIO_SSRC||s===ec.UPDATE_VIDEO_SSRC)&&i.offersdp)try{var l=JSON.parse(i.offersdp),c=l.audiossrc,d=l.videossrc,f=l.rtxssrc;Un.info("[".concat(this.userId_,"] ssrc info in offersdp: [ audiossrc: ").concat(c," videossrc: ").concat(d," rtxssrc: ").concat(f," ]"))}catch(e){}}switch(r){case $l.CHANNEL_SETUP_SUCCESS:this.signalInfo_.relayIp=i.relayip,this.signalInfo_.relayInnerIp=i.innerip,this.signalInfo_.signalIp=i.signalip,this.signalInfo_.localIp=i.localip,this.signalInfo_.dataPort=i.dataport,this.signalInfo_.stunPort=i.stunport,this.signalInfo_.checkSigSeq=i.checkSigSeq,this.signalInfo_.socketId=i.socketid,this.signalInfo_.tinyId=i.tinyid,this.signalInfo_.openId=i.openid,this.signalInfo_.stunPortList=i.stunportList,!i.stunportList||i.stunportList.length<=0?this.signalInfo_.stunServers="stun:"+i.relayip+":"+i.stunport:(this.signalInfo_.stunServers=[],i.stunportList.forEach(function(e){var n="stun:"+i.relayip+":"+e;t.signalInfo_.stunServers.push(n)})),i.cgiurl&&(this.signalInfo_.logCgiUrl=i.cgiurl),i.svrTime&&function(e){_o=e-(new Date).getTime();var t=new Date;t.setTime(e),Un.info("baseTime from server: "+t+" offset: "+_o)}(i.svrTime),Un.info("ChannelSetup Success: signalIp:".concat(i.signalip," relayIp:").concat(i.relayip," clientIp:").concat(i.localip," checkSigSeq:").concat(i.checkSigSeq)),Un.info("start ping pong"),this.startPingPong(),this.isReconnecting_&&1===i.rc&&(this.reconnectionCount_=0,this.clearReconnectionTimer(),this.emitter_.emit(ec.REQUEST_REBUILD_SESSION,{signalInfo:this.signalInfo_})),this.emitter_.emit(s,{signalInfo:this.signalInfo_}),this.addSignalEvent("connected");break;case $l.REBUILD_SESSION_RESULT:-1===i.result&&this.emitter_.emit(ec.CLIENT_REJOIN);break;case $l.CHANNEL_SETUP_FAILED:if(!this.isReconnecting_){var p="sdkAppId invalid",h="";void 0!==i.errorCode&&(p=i.errorCode,h=i.errorMsg);var g=new oc({code:rc.SIGNAL_CHANNEL_SETUP_FAILED,message:"SignalChannel setup failure: ('errorCode': ".concat(p,", 'errorMsg': ").concat(h," })")});md({eventType:vc.SIGNAL_CONNECTION,error:g}),this.emitter_.emit(Ql,g)}break;default:this.emitter_.emit(s,{data:n})}}}},{key:"addSignalEvent",value:function(e){sc(this.userId_,"connected"===e?{eventId:32791,eventDesc:"signal channel is connected",timestamp:bo(),userId:this.userId_,tinyId:this.signalInfo_.tinyId}:{eventId:32790,eventDesc:"signal channel is disconnected",timestamp:bo(),userId:this.userId_,tinyId:this.signalInfo_.tinyId})}},{key:"reconnect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";if(this.isConnecting_||-1!==this.reconnectionTimer_)Un.info("signal channel is reconnecting, ignoring current reconnection");else{if(this.reconnectionCount_>=30){Un.warn("SDK has tried reconnect signal channel for ".concat(30," times, but all failed. please check your network"));var n=new oc({code:rc.SIGNAL_CHANNEL_RECONNECTION_FAILED,message:"signal channel reconnection failed, please check your network"});return md({eventType:vc.SIGNAL_RECONNECTION,error:n}),void this.emitter_.emit(Ql,n)}this.isConnecting_=!0,this.reconnectionCount_++,this.currentState_!==Zl.RECONNECTING&&(this.emitter_.emit(Jl,{prevState:this.currentState_,state:Zl.RECONNECTING}),this.currentState_=Zl.RECONNECTING),Un.warn("reconnecting to ".concat(t," signal channel [").concat(this.reconnectionCount_,"/").concat(30,"]"));var r=this.getReconnectionUrl(t);"main"===t?(this.socket_=new WebSocket(r),this.bindSocket(this.socket_)):(this.backupSocket_=new WebSocket(r),this.bindSocket(this.backupSocket_));var i=cd(this.reconnectionCount_);this.reconnectionTimer_=setTimeout(function(){Un.warn("reconnect ".concat(t," signal channel timeout(").concat(i/1e3,"s), close and try again")),e.isConnecting_=!1,e.clearReconnectionTimer(),e.unbindAndCloseSocket(t),e.reconnect("main"===t?"backup":"main")},i)}}},{key:"isConnected",value:function(){return this.isConnected_}},{key:"getReconnectionUrl",value:function(e){var t="main"===e?this.urlWithParam_:this.backupUrlWithParam_;return _d(this.signalInfo_)||-1!==t.indexOf("&rc=1")||(t+="&iip="+this.signalInfo_.relayInnerIp+"&dp="+this.signalInfo_.dataPort+"&oip="+this.signalInfo_.relayIp+"&sp="+this.signalInfo_.stunPort+"&rc=1"),t}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(this.isConnected_){var r=this.createSendMessage(e);r.data=t,void 0!==n&&(r.srctinyid=n),this.socketInUse_.send(JSON.stringify(r))}}},{key:"sendWithoutUA",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;if(this.isConnected_){var r=this.createSendMessage(e,!1);r.data=t,void 0!==n&&(r.srctinyid=n),this.socketInUse_.send(JSON.stringify(r))}}},{key:"sendWithReport",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;if(this.isConnected_){var r=this.createSendMessage(e);r.data=t,r.report=n,this.socketInUse_.send(JSON.stringify(r))}}},{key:"startPingPong",value:(t=lt(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,-1===this.pingPongTimeoutId_){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.ping();case 5:this.pingPongTimeoutId_=setTimeout(function(){t.pingPongTimeoutId_=-1,t.startPingPong()},1e4),e.next=13;break;case 8:e.prev=8,e.t0=e.catch(0),Un.warn("ping-pong failed, start signal reconnection"),this.close(),this.reconnect("main");case 13:case"end":return e.stop()}},e,this,[[0,8]])})),function(){return t.apply(this,arguments)})},{key:"stopPingPong",value:function(){Un.info("stop ping pong"),clearTimeout(this.pingTimeoutId_),clearTimeout(this.pingPongTimeoutId_),this.pingTimeoutId_=-1,this.pingPongTimeoutId_=-1}},{key:"ping",value:function(){var e=this;return new Promise(function(t,n){if(-1!==e.pingTimeoutId_)return t();e.sendWithoutUA("ping"),e.once(ec.PONG,function(){clearTimeout(e.pingTimeoutId_),e.pingTimeoutId_=-1,t()}),e.pingTimeoutId_=setTimeout(function(){e.pingTimeoutId_=-1,n()},6e3)})}},{key:"createSendMessage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={tag_key:e,data:"",openid:this.userId_,tinyid:this.signalInfo_.tinyId,version:this.version_};return t&&(n.ua=navigator.userAgent),n}},{key:"getCurrentState",value:function(){return this.currentState_}},{key:"close",value:function(){Un.info("close SignalChannel"),this.clearBackupTimer(),this.clearReconnectionTimer(),this.stopPingPong(),this.isConnecting_=!1,this.isConnected_=!1,this.socketInUse_=null,this.unbindAndCloseSocket("main"),this.unbindAndCloseSocket("backup")}},{key:"on",value:function(e,t,n){this.emitter_.on(e,t,n)}},{key:"removeListener",value:function(e,t,n){this.emitter_.removeListener(e,t,n)}},{key:"once",value:function(e,t){this.emitter_.once(e,t)}},{key:"off",value:function(e,t,n){this.emitter_.off(e,t,n)}},{key:"isReconnecting_",get:function(){return-1!==this.reconnectionTimer_}}]),e}();window.addEventListener("message",function(e){e.origin==window.location.origin&&function(e){if("PermissionDeniedError"==e)throw new Error("PermissionDeniedError");e.sourceId}(e.data)}),window.InstallTrigger,window.opera||navigator.userAgent.indexOf(" OPR/");var Sd=(window.chrome,{result:!1,detail:{isBrowserSupported:!1,isWebRTCSupported:!1,isMediaDevicesSupported:!1,isH264Supported:!1}}),kd=function(){return["RTCPeerConnection","webkitRTCPeerConnection","RTCIceGatherer"].filter(function(e){return e in window}).length>0},wd=function(){if(!navigator.mediaDevices)return!1;var e=["getUserMedia","enumerateDevices"];return e.filter(function(e){return e in navigator.mediaDevices}).length===e.length},Ed=function(){var e=lt(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Sd.detail.isH264Supported){e.next=2;break}return e.abrupt("return",Sd.detail.isH264Supported);case 2:return t=!1,e.prev=4,n=new RTCPeerConnection,e.next=8,n.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1});case 8:return-1!==e.sent.sdp.toLowerCase().indexOf("h264")&&(t=!0),n.close(),Sd.detail.isH264Supported=t,e.abrupt("return",t);case 15:return e.prev=15,e.t0=e.catch(4),e.abrupt("return",!1);case 18:case"end":return e.stop()}},e,null,[[4,15]])}));return function(){return e.apply(this,arguments)}}(),Td=function(){var e=lt(regeneratorRuntime.mark(function e(){var t,n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Sd.result){e.next=2;break}return e.abrupt("return",Sd);case 2:return t=!($c||rd||Hc||zc&&Kc<80||Vc&&qc<56),n=kd(),r=wd(),e.next=7,Ed();case 7:return i=e.sent,Sd.result=t&&n&&r&&i,Sd.detail.isBrowserSupported=t,Sd.detail.isWebRTCSupported=n,Sd.detail.isMediaDevicesSupported=r,Sd.detail.isH264Supported=i,Sd.result||Un.error("".concat(navigator.userAgent," isBrowserSupported: ").concat(t," isWebRTCSupported: ").concat(n," isMediaSupported: ").concat(r," isH264Supported: ").concat(i)),e.abrupt("return",Sd);case 15:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),xd=function(){if("undefined"==typeof RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var e=new RTCPeerConnection,t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t},Cd=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)},Id=function(){return"RTCPeerConnection"in window&&"getReceivers"in window.RTCPeerConnection.prototype},Rd=function(){return"RTCPeerConnection"in window&&"getSenders"in window.RTCPeerConnection.prototype};Td();var Ad=Math.min,Od=[].lastIndexOf,Md=!!Od&&1/[1].lastIndexOf(1,-0)<0,Dd=qn("lastIndexOf"),Ld=Md||Dd?function(e){if(Md)return Od.apply(this,arguments)||0;var t=v(this),n=ce(t.length),r=n-1;for(arguments.length>1&&(r=Ad(r,ue(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:Od;Me({target:"Array",proto:!0,forced:Ld!==[].lastIndexOf},{lastIndexOf:Ld});var Pd={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return Pd.Android()||Pd.BlackBerry()||Pd.iOS()||Pd.Opera()||Pd.Windows()},getOsName:function(){var e="Unknown OS";return Pd.Android()&&(e="Android"),Pd.BlackBerry()&&(e="BlackBerry"),Pd.iOS()&&(e="iOS"),Pd.Opera()&&(e="Opera Mini"),Pd.Windows()&&(e="Windows"),e}};/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(navigator.userAgent||"");var Nd=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob),Ud=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,Fd=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),jd=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Gd=!!window.chrome&&!Ud,Bd="undefined"!=typeof document&&!!document.documentMode&&!Nd;function Vd(){navigator.appVersion;var e,t,n,r=navigator.userAgent,i=navigator.appName,o=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10);if(Ud){i="Opera";try{a=(o=navigator.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(e){o="0.0.0.0",a=0}}else Bd?((t=r.indexOf("rv:"))>0?o=r.substring(t+3):(t=r.indexOf("MSIE"),o=r.substring(t+5)),i="IE"):Gd?(t=r.indexOf("Chrome"),i="Chrome",o=r.substring(t+7)):jd?-1!==r.indexOf("CriOS")?(t=r.indexOf("CriOS"),i="Chrome",o=r.substring(t+6)):-1!==r.indexOf("FxiOS")?(t=r.indexOf("FxiOS"),i="Firefox",o=r.substring(t+6)):(t=r.indexOf("Safari"),i="Safari",o=r.substring(t+7),-1!==(t=r.indexOf("Version"))&&(o=r.substring(t+8)),-1!==navigator.userAgent.indexOf("Version/")&&(o=navigator.userAgent.split("Version/")[1].split(" ")[0])):Fd?(t=r.indexOf("Firefox"),i="Firefox",o=r.substring(t+8)):(e=r.lastIndexOf(" ")+1)<(t=r.lastIndexOf("/"))&&(i=r.substring(e,t),o=r.substring(t+1),i.toLowerCase()===i.toUpperCase()&&(i=navigator.appName));return Nd&&(i="Edge",o=navigator.userAgent.split("Edge/")[1]),-1!==(n=o.search(/[; )]/))&&(o=o.substring(0,n)),a=parseInt(""+o,10),isNaN(a)&&(o=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10)),{fullVersion:o,version:a,name:i}}function qd(){var e="";return screen.width&&(e+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:"")),e}function Hd(){var e=!1;return["RTCPeerConnection","webkitRTCPeerConnection","RTCIceGatherer"].forEach(function(t){t in window&&(e=!0)}),e}function zd(){var e=!1;return navigator.getUserMedia?e=!0:navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(e=!0),e}function Kd(){return function(){return lt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,navigator.mediaDevices.enumerateDevices();case 4:return t=e.sent,e.abrupt("return",t.filter(function(e){return"audioinput"===e.kind}));case 6:case"end":return e.stop()}},e)})).apply(this,arguments)}.apply(this,arguments)}function Wd(){return function(){return lt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,navigator.mediaDevices.enumerateDevices();case 4:return t=e.sent,e.abrupt("return",t.filter(function(e){return"videoinput"===e.kind}));case 6:case"end":return e.stop()}},e)})).apply(this,arguments)}.apply(this,arguments)}var Yd={STREAM_ADDED:"stream-added",STREAM_REMOVED:"stream-removed",STREAM_UPDATED:"stream-updated",STREAM_PUBLISHED:"stream-published",STREAM_SUBSCRIBED:"stream-subscribed",STREAM_UNSUBSCRIBED:"stream-unsubscribed",STATE_CHANGED:"state-changed",ERROR:"error",CONNECTION_STATE_CHANGED:"connection-state-changed"},Jd="peer-leave",Xd="mute-audio",Qd="mute-video",Zd="unmute-audio",$d="unmute-video",ef="network-quality",tf="error",nf="player-state-changed",rf="player-state-changed",of=function(){function e(t){ct(this,e),this.prevReport_={}}var t,n,r,i;return ft(e,[{key:"getSenderStats",value:(i=lt(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n={audio:{bytesSent:0,packetsSent:0,audioLevel:0,totalAudioEnergy:0},video:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0},rtt:0},!(r=t.getPeerConnection())){e.next=13;break}return e.prev=3,e.next=6,r.getStats();case 6:e.sent.forEach(function(e){if("outbound-rtp"===e.type)if("video"===e.mediaType){if(!Vc&&void 0===e.trackId)return;n.video.bytesSent=e.bytesSent,n.video.packetsSent=e.packetsSent,n.video.framesEncoded=e.framesEncoded}else"audio"===e.mediaType&&(n.audio.bytesSent=e.bytesSent,n.audio.packetsSent=e.packetsSent);else"candidate-pair"===e.type?"number"==typeof e.currentRoundTripTime&&(n.rtt=1e3*e.currentRoundTripTime):"track"===e.type?(void 0!==e.frameWidth&&(n.video.frameWidth=e.frameWidth,n.video.frameHeight=e.frameHeight,n.video.framesSent=e.framesSent),void 0!==e.audioLevel&&(n.audio.audioLevel=e.audioLevel||0)):"media-source"===e.type&&"audio"===e.kind&&(n.audio.audioLevel=e.audioLevel||0,n.audio.totalAudioEnergy=e.totalAudioEnergy||0)}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),Un.warn("failed to getStats on sender connection");case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}},e,null,[[3,10]])})),function(e){return i.apply(this,arguments)})},{key:"getReceiverStats",value:(r=lt(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n={tinyId:t.getTinyId(),userId:t.getUserId(),hasAudio:!1,hasVideo:!1,audio:{bytesReceived:0,packetsReceived:0,packetsLost:0,jitter:0,audioLevel:0,totalAudioEnergy:0},video:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesDecoded:0,frameWidth:0,frameHeight:0}},!(r=t.getPeerConnection())){e.next=13;break}return e.prev=3,e.next=6,r.getStats();case 6:e.sent.forEach(function(e){if("inbound-rtp"===e.type){if("audio"===e.mediaType)n.audio.packetsReceived=e.packetsReceived,n.audio.bytesReceived=e.bytesReceived,n.audio.packetsLost=e.packetsLost,n.audio.jitter=e.jitter,n.hasAudio=!0;else if("video"===e.mediaType){if(Vc&&0===e.bytesReceived)return;n.video.packetsReceived=e.packetsReceived,n.video.bytesReceived=e.bytesReceived,n.video.packetsLost=e.packetsLost,n.video.framesDecoded=e.framesDecoded,n.hasVideo=!0}}else"track"===e.type&&(void 0!==e.frameWidth&&(n.video.frameWidth=e.frameWidth,n.video.frameHeight=e.frameHeight),"audio"===e.kind&&(n.audio.audioLevel=e.audioLevel||0,n.audio.totalAudioEnergy=e.totalAudioEnergy||0))}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),Un.warn("failed to getStats on receiver connection");case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}},e,null,[[3,10]])})),function(e){return r.apply(this,arguments)})},{key:"getStats",value:(n=lt(regeneratorRuntime.mark(function e(t,n){var r,i,o,a,s,u,l,c,d,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},!t){e.next=5;break}return e.next=4,this.getSenderStats(t);case 4:r=e.sent;case 5:i=[],o=!0,a=!1,s=void 0,e.prev=9,u=n[Symbol.iterator]();case 11:if(o=(l=u.next()).done){e.next=20;break}return(c=kt(l.value,2))[0],d=c[1],e.next=15,this.getReceiverStats(d);case 15:f=e.sent,i.push(f);case 17:o=!0,e.next=11;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(9),a=!0,s=e.t0;case 26:e.prev=26,e.prev=27,o||null==u.return||u.return();case 29:if(e.prev=29,!a){e.next=32;break}throw s;case 32:return e.finish(29);case 33:return e.finish(26);case 34:return e.abrupt("return",{senderStats:r,receiverStats:i});case 35:case"end":return e.stop()}},e,this,[[9,22,26,34],[27,,29,33]])})),function(e,t){return n.apply(this,arguments)})},{key:"prepareReport",value:function(e,t){_d(e.senderStats)||(t.uint32_delay=e.senderStats.rtt,t.AudioReportState.sentAudioLevel=e.senderStats.audio.audioLevel,t.AudioReportState.sentAudioEnergy=e.senderStats.audio.totalAudioEnergy,t.AudioReportState.uint32_audio_enc_pkg_br=e.senderStats.audio.bytesSent,t.VideoReportState.uint32_video_snd_br=e.senderStats.video.bytesSent,t.VideoReportState.uint32_send_total_pkg=e.senderStats.video.packetsSent,t.VideoReportState.VideoEncState[0].uint32_enc_width=e.senderStats.video.frameWidth,t.VideoReportState.VideoEncState[0].uint32_enc_height=e.senderStats.video.frameHeight,t.VideoReportState.VideoEncState[0].uint32_enc_fps=e.senderStats.video.framesSent),e.receiverStats.forEach(function(e){e.hasAudio&&(t.AudioReportState.AudioDecState.push({uint32_audio_delay:0,uint32_audio_jitter:e.audio.jitter,uint32_audio_real_recv_pkg:e.audio.packetsReceived,uint32_audio_flow:e.audio.bytesReceived,uint32_audio_real_recv_br:0,uint64_sender_uin:e.tinyId,packetsLost:e.audio.packetsLost,totalPacketsLost:e.audio.packetsLost,audioLevel:e.audio.audioLevel,audioEnergy:e.audio.totalAudioEnergy}),t.AudioReportState.uint32_audio_real_recv_pkg+=e.audio.packetsReceived,t.AudioReportState.uint32_audio_flow+=e.audio.bytesReceived,t.uint32_real_num+=e.audio.packetsReceived),e.hasVideo&&(t.VideoReportState.VideoDecState.push({uint32_video_recv_fps:e.video.framesDecoded,uint32_video_recv_br:e.video.bytesReceived,uint32_video_real_recv_pkg:e.video.packetsReceived,uint32_dec_height:e.video.frameHeight,uint32_dec_width:e.video.frameWidth,uint32_video_jitter:0,uint64_sender_uin:e.tinyId,packetsLost:e.video.packetsLost,totalPacketsLost:e.video.packetsLost}),t.VideoReportState.uint32_video_total_real_recv_pkg+=e.video.packetsReceived,t.VideoReportState.uint32_video_rcv_br+=e.video.bytesReceived)}),t.uint64_end_utime=(new Date).getTime();var n=this.prevReport_;if(this.prevReport_=JSON.parse(JSON.stringify(t)),_d(n))t.AudioReportState.uint32_audio_enc_pkg_br=8*t.AudioReportState.uint32_audio_enc_pkg_br/2,t.VideoReportState.uint32_video_rcv_br=8*t.VideoReportState.uint32_video_rcv_br/2,t.VideoReportState.uint32_video_snd_br=8*t.VideoReportState.uint32_video_snd_br/2,t.VideoReportState.VideoDecState.forEach(function(e){e.uint32_video_recv_br=8*e.uint32_video_recv_br/2,t.uint32_total_send_bps=t.AudioReportState.uint32_audio_enc_pkg_br+t.VideoReportState.uint32_video_snd_br});else{t.uint64_begine_utime=n.uint64_end_utime,t.uint32_real_num-=n.uint32_real_num,t.uint32_real_num<=0&&(t.uint32_real_num=0),t.AudioReportState.uint32_audio_real_recv_pkg-=n.AudioReportState.uint32_audio_real_recv_pkg,t.AudioReportState.uint32_audio_real_recv_pkg<=0&&(t.AudioReportState.uint32_audio_real_recv_pkg=0),t.AudioReportState.uint32_audio_enc_pkg_br-=n.AudioReportState.uint32_audio_enc_pkg_br,t.AudioReportState.uint32_audio_enc_pkg_br<=0&&(t.AudioReportState.uint32_audio_enc_pkg_br=0),t.AudioReportState.uint32_audio_enc_pkg_br=8*t.AudioReportState.uint32_audio_enc_pkg_br/2,t.VideoReportState.uint32_video_snd_br-=n.VideoReportState.uint32_video_snd_br,t.VideoReportState.uint32_video_snd_br<=0&&(t.VideoReportState.uint32_video_snd_br=0),t.VideoReportState.uint32_video_snd_br=8*t.VideoReportState.uint32_video_snd_br/2,t.AudioReportState.uint32_audio_flow-=n.AudioReportState.uint32_audio_flow,t.AudioReportState.uint32_audio_flow<=0&&(t.AudioReportState.uint32_audio_flow=0),t.VideoReportState.uint32_send_total_pkg-=n.VideoReportState.uint32_send_total_pkg,t.VideoReportState.uint32_send_total_pkg<=0&&(t.VideoReportState.uint32_send_total_pkg=0),t.VideoReportState.uint32_video_rcv_br-=n.VideoReportState.uint32_video_rcv_br,t.VideoReportState.uint32_video_rcv_br<=0&&(t.VideoReportState.uint32_video_rcv_br=0),t.VideoReportState.uint32_video_rcv_br=8*t.VideoReportState.uint32_video_rcv_br/2,t.VideoReportState.uint32_video_total_real_recv_pkg-=n.VideoReportState.uint32_video_total_real_recv_pkg,t.VideoReportState.uint32_video_total_real_recv_pkg<=0&&(t.VideoReportState.uint32_video_total_real_recv_pkg=0),t.VideoReportState.VideoEncState[0].uint32_enc_fps-=n.VideoReportState.VideoEncState[0].uint32_enc_fps,t.VideoReportState.VideoEncState[0].uint32_enc_fps<0&&(t.VideoReportState.VideoEncState[0].uint32_enc_fps=0),t.VideoReportState.VideoEncState[0].uint32_enc_fps=t.VideoReportState.VideoEncState[0].uint32_enc_fps/2;for(var r=t.VideoReportState.VideoDecState.length,i=0;i<r;i++){for(var o=t.VideoReportState.VideoDecState[i],a=o.uint64_sender_uin,s=o.uint32_video_real_recv_pkg,u=o.uint32_video_recv_br,l=o.uint32_video_recv_fps,c=0;c<n.VideoReportState.VideoDecState.length;c++){var d=n.VideoReportState.VideoDecState[c];if(d.uint64_sender_uin===a){o.packetsLost=o.totalPacketsLost-d.totalPacketsLost,(s-=d.uint32_video_real_recv_pkg)<=0&&(s=0),(u-=d.uint32_video_recv_br)<=0&&(u=0),(l-=d.uint32_video_recv_fps)<0&&(l=0);break}}t.VideoReportState.VideoDecState[i].uint32_video_real_recv_pkg=s,t.VideoReportState.VideoDecState[i].uint32_video_recv_br=8*u/2,t.VideoReportState.VideoDecState[i].uint32_video_recv_fps=l/2}r=t.AudioReportState.AudioDecState.length;for(var f=0;f<r;f++){for(var p=t.AudioReportState.AudioDecState[f],h=p.uint32_audio_real_recv_pkg,g=p.uint32_audio_flow,v=p.uint64_sender_uin,m=0;m<n.AudioReportState.AudioDecState.length;m++){var y=n.AudioReportState.AudioDecState[m];if(y.uint64_sender_uin===v){p.packetsLost=p.totalPacketsLost-y.totalPacketsLost,(h-=y.uint32_audio_real_recv_pkg)<=0&&(h=0),(g-=y.uint32_audio_flow)<=0&&(g=0);break}}t.AudioReportState.AudioDecState[f].uint32_audio_real_recv_pkg=h,t.AudioReportState.AudioDecState[f].uint32_audio_flow=g,t.AudioReportState.AudioDecState[f].uint32_audio_real_recv_br=8*g/2}t.AudioReportState.uint32_audio_real_recv_br=8*t.AudioReportState.uint32_audio_flow/2,t.uint32_real_num=t.AudioReportState.uint32_audio_real_recv_pkg+t.VideoReportState.uint32_video_total_real_recv_pkg,t.uint32_total_send_bps=t.AudioReportState.uint32_audio_enc_pkg_br+t.VideoReportState.uint32_video_snd_br,t.uint32_total_recv_bps=t.AudioReportState.uint32_audio_real_recv_br+t.VideoReportState.uint32_video_rcv_br}return t}},{key:"getStatsReport",value:(t=lt(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={uint64_begine_utime:(new Date).getTime(),uint64_end_utime:0,uint32_real_num:0,uint32_delay:0,uint32_CPU_curfreq:0,uint32_total_send_bps:0,uint32_total_recv_bps:0,AudioReportState:{uint32_audio_enc_pkg_br:0,uint32_audio_real_recv_pkg:0,uint32_audio_flow:0,uint32_audio_real_recv_br:0,uint32_audio_delay:0,uint32_audio_jitter:0,uint32_microphone_status:1,sentAudioLevel:0,sentAudioEnergy:0,AudioDecState:[]},VideoReportState:{uint32_video_delay:0,uint32_video_snd_br:0,uint32_video_total_real_recv_pkg:0,uint32_video_rcv_br:0,uint32_send_total_pkg:0,VideoEncState:[{uint32_enc_width:0,uint32_enc_height:0,uint32_capture_fps:0,uint32_enc_fps:0}],VideoDecState:[]}},e.next=3,this.getStats(t,n);case 3:return i=e.sent,this.prepareReport(i,r),e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})}]),e}(),af=function(){function e(t){ct(this,e),this.id_=t.id,this.direction_=t.direction,this.type_=t.type,this.directionPrefix_="local"===this.direction_?"":"*"}return ft(e,[{key:"log",value:function(e,t){Un[e]("[".concat(this.directionPrefix_).concat(this.id_,"] ").concat(this.type_," ").concat(t))}},{key:"info",value:function(e){this.log("info",e)}},{key:"debug",value:function(e){this.log("debug",e)}},{key:"warn",value:function(e){this.log("warn",e)}},{key:"error",value:function(e){this.log("error",e)}}]),e}(),sf=function(){function e(t){var n=t.signalChannel,r=t.connnections,i=t.userId;ct(this,e),this.signalChannel_=n,this.connnections_=r,this.log_=new af({id:"q|"+i,direction:"local",type:""}),this.uplinkConnection_=null,this.uplinkNetworkQuality_=dc,this.uplinkRTT_=0,this.uplinkLoss_=0,this.downlinkNetworkQuality_=dc,this.downlinkPrevStatMap_=new Map,this.downlinkLossAndRTTMap_=new Map,this.interval_=-1,this.emitter_=new Yl,this.initilize()}var t,n;return ft(e,[{key:"initilize",value:function(){var e=this;this.signalChannel_.on(ec.UPLINK_NETWORK_STATS,function(t){e.handleUplinkNetworkQuality(t)}),this.signalChannel_.on(Jl,this.handleSignalConnectionStateChange.bind(this)),this.start()}},{key:"handleUplinkNetworkQuality",value:function(e){if(!this.uplinkConnection_)return this.uplinkNetworkQuality=dc,this.uplinkLoss_=0,void(this.uplinkRTT_=0);var t=this.uplinkConnection_.getPeerConnection();if(t&&this.isPeerConnectionDisconnected(t))return this.uplinkNetworkQuality=6,this.uplinkLoss_=0,void(this.uplinkRTT_=0);var n=e.data.content;if(0===n.result){var r=n.expectAudPkg+n.expectVidPkg,i=n.recvAudPkg+n.recvVidPkg,o=r-i;if(0===r&&0===i)return;this.uplinkLoss_=o<=0?0:Math.round(o/r*100),this.uplinkRTT_=n.rtt,this.uplinkNetworkQuality=this.getNetworkQuality(this.uplinkLoss_,this.uplinkRTT_)}}},{key:"handleDownlinkNetworkQuality",value:(n=lt(regeneratorRuntime.mark(function e(){var t,n,r,i,o,a,s,u,l,c,d,f,p,h,g=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connnections_&&0!==this.connnections_.size){e.next=3;break}return this.downlinkNetworkQuality=dc,e.abrupt("return");case 3:if((t=wt(this.connnections_.values()).map(function(e){return e.getPeerConnection()}).filter(function(e){return!!e})).filter(this.isPeerConnectionDisconnected).length!==t.length){e.next=8;break}return this.downlinkNetworkQuality=6,e.abrupt("return");case 8:n=t.filter(function(e){return"connected"===e.connectionState}),r=0;case 10:if(!(r<n.length)){e.next=30;break}return e.next=13,this.getStat(n[r]);case 13:if(i=e.sent,o=i.rtt,a=i.totalPacketsLost,s=i.totalPacketsReceived,this.downlinkPrevStatMap_.has(n[r])){e.next=20;break}return this.downlinkPrevStatMap_.set(n[r],{totalPacketsLost:a,totalPacketsReceived:s}),e.abrupt("continue",27);case 20:u=0,l=this.downlinkPrevStatMap_.get(n[r]),c=a-l.totalPacketsLost,d=s-l.totalPacketsReceived,u=c<=0||d<0?0:Math.round(c/(c+d)*100),this.downlinkPrevStatMap_.set(n[r],{totalPacketsLost:a,totalPacketsReceived:s}),this.downlinkLossAndRTTMap_.set(n[r],{rtt:o,loss:u});case 27:r++,e.next=10;break;case 30:if(wt(this.downlinkPrevStatMap_.keys()).forEach(function(e){g.isPeerConnectionDisconnected(e)&&(g.downlinkPrevStatMap_.delete(e),g.downlinkLossAndRTTMap_.delete(e))}),0!==this.downlinkLossAndRTTMap_.size){e.next=33;break}return e.abrupt("return");case 33:f=this.getAverageLossAndRTT(wt(this.downlinkLossAndRTTMap_.values())),p=f.rtt,h=f.loss,this.downlinkNetworkQuality=this.getNetworkQuality(h,p);case 35:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"getStat",value:(t=lt(regeneratorRuntime.mark(function e(t){var n,r,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n={rtt:0,totalPacketsLost:0,totalPacketsReceived:0},t&&Id()){e.next=3;break}return e.abrupt("return",n);case 3:r=t.getReceivers(),e.prev=4,i=0;case 6:if(!(i<r.length)){e.next=15;break}return o=r[i],e.next=10,o.getStats();case 10:e.sent.forEach(function(e){"candidate-pair"===e.type&&"number"==typeof e.currentRoundTripTime&&(n.rtt=Math.round(1e3*e.currentRoundTripTime)),"inbound-rtp"!==e.type||"audio"!==e.mediaType&&"video"!==e.mediaType||(n.totalPacketsLost+=e.packetsLost,n.totalPacketsReceived+=e.packetsReceived)});case 12:i++,e.next=6;break;case 15:return e.abrupt("return",n);case 18:return e.prev=18,e.t0=e.catch(4),e.abrupt("return",n);case 21:case"end":return e.stop()}},e,null,[[4,18]])})),function(e){return t.apply(this,arguments)})},{key:"getAverageLossAndRTT",value:function(e){var t={rtt:0,loss:0};return Array.isArray(e)&&e.length>0&&(e.forEach(function(e){t.rtt+=e.rtt,t.loss+=e.loss}),Object.keys(t).forEach(function(n){t[n]=Math.round(t[n]/e.length)})),t}},{key:"getNetworkQuality",value:function(e,t){return e>50||t>500?5:e>30||t>350?4:e>20||t>200?3:e>10||t>100?2:e>=0||t>=0?1:dc}},{key:"handleSignalConnectionStateChange",value:function(e){e.state===Zl.DISCONNECTED?(this.uplinkRTT_=0,this.uplinkLoss_=0,this.uplinkNetworkQuality=6):e.state===Zl.CONNECTED&&6===this.uplinkNetworkQuality&&(this.uplinkNetworkQuality=5)}},{key:"handleUplinkConnectionStateChange",value:function(e){var t=e.state;t===gc.DISCONNECTED?(this.uplinkLoss_=0,this.uplinkRTT_=0,this.uplinkNetworkQuality=6):t===gc.CONNECTED&&6===this.uplinkNetworkQuality&&(this.uplinkNetworkQuality=5)}},{key:"isPeerConnectionDisconnected",value:function(e){return!(!e||"disconnected"!==e.connectionState&&"failed"!==e.connectionState&&"closed"!==e.connectionState)}},{key:"setUplinkConnection",value:function(e){this.uplinkConnection_=e,this.uplinkConnection_?this.uplinkConnection_.on(Yd.CONNECTION_STATE_CHANGED,this.handleUplinkConnectionStateChange.bind(this)):(this.uplinkNetworkQuality=dc,this.uplinkRTT_=0,this.uplinkLoss_=0)}},{key:"start",value:function(){var e=this;-1===this.interval_?(this.log_.info("start network quality calculating"),this.interval_=setInterval(function(){e.handleDownlinkNetworkQuality(),e.emitter_.emit(ef,{uplinkNetworkQuality:e.uplinkNetworkQuality,downlinkNetworkQuality:e.downlinkNetworkQuality})},2e3)):this.log_.info("network quality calculating is already started")}},{key:"stop",value:function(){this.log_.info("stop network quality calculating"),-1!==this.interval_&&(clearInterval(this.interval_),this.interval_=-1)}},{key:"on",value:function(e,t){this.emitter_.on(e,t)}},{key:"uplinkNetworkQuality",get:function(){return this.uplinkNetworkQuality_},set:function(e){e!==this.uplinkNetworkQuality_&&this.log_.info("uplink network quality change ".concat(this.uplinkNetworkQuality," -> ").concat(e,", rtt: ").concat(this.uplinkRTT_,", loss: ").concat(this.uplinkLoss_)),this.uplinkNetworkQuality_=e}},{key:"downlinkNetworkQuality",get:function(){return this.downlinkNetworkQuality_},set:function(e){if(e!==this.downlinkNetworkQuality_){var t=this.getAverageLossAndRTT(wt(this.downlinkLossAndRTTMap_.values())),n=t.rtt,r=t.loss;this.log_.info("downlink network quality change ".concat(this.downlinkNetworkQuality," -> ").concat(e,", rtt: ").concat(n,", loss: ").concat(r))}this.downlinkNetworkQuality_=e}}]),e}(),uf=function(){function e(){ct(this,e),this.log_=Un,this.localStream_=null,this.prevDevices_=[],this.timer=-1,this.initialize()}var t,n,r;return ft(e,[{key:"initialize",value:(r=lt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:navigator.mediaDevices.addEventListener("devicechange",this.onDeviceChange.bind(this));case 1:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"onDeviceChange",value:(n=lt(regeneratorRuntime.mark(function e(){var t,n,r,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.localStream_&&this.localStream_.getMediaStream()&&!this.localStream_.getScreen()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,fp.getDevices();case 4:t=e.sent,n=t.filter(function(e){return i.prevDevices_.findIndex(function(t){var n=t.deviceId;return e.deviceId===n})<0}),r=this.prevDevices_.filter(function(e){return t.findIndex(function(t){var n=t.deviceId;return e.deviceId===n})<0}),n.length>0&&this.handleDeviceAdded(this.prevDevices_,n),r.length>0&&this.handleDeviceRemoved(t,r),this.prevDevices_=t;case 10:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"setLocalStream",value:(t=lt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=4;break}return e.next=3,fp.getDevices();case 3:this.prevDevices_=e.sent;case 4:this.localStream_=t;case 5:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"handleDeviceAdded",value:function(e,t){this.log_.warn("devicesAdded: ".concat(JSON.stringify(t))),this.localStream_.updateDeviceIdInUse();var n=t.filter(function(e){return"videoinput"===e.kind}),r=t.filter(function(e){return"audioinput"===e.kind}),i=e.filter(function(e){return"videoinput"===e.kind}),o=e.filter(function(e){return"audioinput"===e.kind}),a=n.length>0&&0===i.length&&this.localStream_.getVideo(),s=r.length>0&&0===o.length&&this.localStream_.getAudio();if(s&&a)return this.log_.info("new microphone and camera detected, but there was no device before."),void this.updateStreamDebounced({cameraId:n[0].deviceId,microphoneId:r[0].deviceId});a&&(this.log_.info("new camera detected, but there was no camera before."),this.updateStreamDebounced({cameraId:n[0].deviceId,microphoneId:this.localStream_.getMicrophoneId()})),s&&(this.log_.info("new microphone detected, but there was no microphone before."),this.updateStreamDebounced({microphoneId:r[0].deviceId,cameraId:this.localStream_.getCameraId()}))}},{key:"handleDeviceRemoved",value:function(e,t){this.log_.warn("devicesRemoved: ".concat(JSON.stringify(t))),this.localStream_.updateDeviceIdInUse();var n=!1,r=!1,i=this.localStream_.getCameraId(),o=this.localStream_.getMicrophoneId();if("default"===o){var a=this.localStream_.getMicrophoneGroupId(),s=e.filter(function(e){return"default"===e.deviceId&&"audioinput"===e.kind})[0];s&&s.groupId!==a&&(r=!0)}if(t.forEach(function(e){var t=e.deviceId;i.length>0&&t===i?n=!0:o.length>0&&t===o&&(r=!0)}),n&&r)return this.log_.warn("current camera and microphone in use is lost, cameraId: ".concat(i,", microphoneId: ").concat(o)),void((this.localStream_.getAudio()||this.localStream_.getVideo())&&this.updateStreamDebounced());n&&(this.log_.warn("current camera in use is lost, deviceId: ".concat(i)),this.localStream_.getVideo()&&this.updateStreamDebounced({microphoneId:o})),r&&(this.log_.warn("current microphone in use is lost, deviceId: ".concat(o)),this.localStream_.getAudio()&&this.updateStreamDebounced({cameraId:i}))}},{key:"updateStreamDebounced",value:function(e){var t=this;this.timer&&(clearTimeout(this.timer),this.timer=-1),this.timer=setTimeout(function(){t.localStream_.updateStream(e),t.timer=-1},500)}}]),e}();function lf(e){return e=window.localStorage?localStorage.getItem(e)||sessionStorage.getItem(e):(e=document.cookie.match(new RegExp("(?:^|;\\s)"+e+"=(.*?)(?:;\\s|$)")))?e[1]:""}function cf(e,t,n){if(window.localStorage)try{n?localStorage.setItem(e,t):sessionStorage.setItem(e,t)}catch(e){}}function df(e,t){var n,r={};if(void 0===t)var i=window.location,o=i.host,a=i.pathname,s=i.search.substr(1),u=i.hash;else o=(i=t.match(/\w+:\/\/((?:[\w-]+\.)+\w+)(?::\d+)?(\/[^\?\\"'\|:<>]*)?(?:\?([^'"\\<>#]*))?(?:#(\w+))?/i)||[])[1],a=i[2],s=i[3],u=i[4];return void 0!==u&&(u=u.replace(/"|'|<|>/gi,"M")),s&&function(){for(var e=s.split("&"),t=0,n=e.length;t<n;t++)if(-1!=e[t].indexOf("=")){var i=e[t].indexOf("="),o=e[t].slice(0,i);i=e[t].slice(i+1),r[o]=i}}(),s=function(){if(void 0===s)return s;for(var t=s.split("&"),n=[],r=0,i=t.length;r<i;r++)if(-1!=t[r].indexOf("=")){var o=t[r].indexOf("="),a=t[r].slice(0,o);o=t[r].slice(o+1),e.ignoreParams&&-1!=e.ignoreParams.indexOf(a)||n.push(a+"="+o)}return n.join("&")}(),u&&function(){for(var e=0==u.indexOf("#")?u.substr(1).split("&"):u.split("&"),t=0,r=e.length;t<r;t++)if(-1!=e[t].indexOf("=")){var i=e[t].indexOf("="),o=e[t].slice(0,i);if(i=e[t].slice(i+1),"adtag"===o.toLowerCase()){n=i;break}}}(),{host:o,path:a,search:s,hash:u,param:r,adtag:n}}function ff(e){var t,n=df(e),r={dm:n.host,pvi:"",si:"",url:n.path,arg:encodeURIComponent(n.search||"").substr(0,512),ty:0};return r.pvi=function(){var t=new Date((new Date).getTime()+63072e6).toGMTString();if(e.userReport){var n=lf("pgv_uid");n&&n==e.user.user_id||(r.ty=1,cf("pgv_uid",e.user.user_id,t)),n=e.user.user_id}else(n=lf("pgv_pvi"))||(r.ty=1,cf("pgv_pvi",n=pf(),t));return n}(),r.si=((t=lf("pgv_si"))||cf("pgv_si",t=pf("s")),t),r.url=function(){var t=n.path;return e.senseQuery&&(t+=n.search?"?"+encodeURIComponent(n.search||"").substr(0,512):""),e.senseHash&&(t+=n.hash?encodeURIComponent(n.hash):""),t}(),r}function pf(e){for(var t=[0,1,2,3,4,5,6,7,8,9],n=10;1<n;n--){var r=Math.floor(10*Math.random()),i=t[r];t[r]=t[n-1],t[n-1]=i}for(n=r=0;5>n;n++)r=10*r+t[n];return(e||"")+(r+"")+ +new Date}function hf(e){return{r2:e.sid}}function gf(e){var t={};if(e){var n,r=[];for(n in e)e.hasOwnProperty(n)&&r.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));e=r.join(";"),t.ext=e}return t}function vf(e){var t=df(e,document.referrer);return e=df(e),{rdm:t.host,rurl:t.path,rarg:encodeURIComponent(t.search||"").substr(0,512),adt:e.param.ADTAG||e.param.adtag||e.param.CKTAG||e.param.cktag||e.param.PTAG||e.param.ptag||e.adtag}}function mf(){try{var e=navigator,t=screen||{width:"",height:"",colorDepth:""},n={scr:t.width+"x"+t.height,scl:t.colorDepth+"-bit",lg:(e.language||e.userLanguage).toLowerCase(),tz:(new Date).getTimezoneOffset()/60}}catch(e){return{}}return n}var yf={conf:{},version:"2.0.19",init:function(e){var t={sid:0,cid:0,autoReport:0,senseHash:0,senseQuery:0,userReport:0,performanceMonitor:0,ignoreParams:[]};if(e)for(var n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)&&(t[n]=e[n]);this.conf=t,this.conf.autoReport&&this.pgv()},pgv:function(){var e=this.conf,t=[],n=this.version;if(e.sid)if(!e.userReport||e.user&&e.user.user_id&&!parseInt(e.user.user_id,10)!==conf.user.user_id){for(var r=0,i=[ff(e),vf(e),hf(e),mf(),gf({version:n}),{random:+new Date}],o=i.length;r<o;r++)for(var a in i[r])i[r].hasOwnProperty(a)&&t.push(a+"="+(void 0===i[r][a]?"":i[r][a]));var s=function(e){e="https://pingtas.qq.com/webview/pingd?"+e.join("&").toLowerCase();var t=new Image;t.onload=t.onerror=t.onabort=function(){t=t.onload=t.onerror=t.onabort=null},t.src=e};s(t),e.performanceMonitor&&(t=function(){for(var t=function(){if(window.performance){var e=window.performance.timing,t={value:e.domainLookupEnd-e.domainLookupStart},n={value:e.connectEnd-e.connectStart},r={value:e.responseStart-(e.requestStart||e.responseStart+1)},i=e.responseEnd-e.responseStart;e.domContentLoadedEventStart?0>i&&(i=0):i=-1,e={domainLookupTime:t,connectTime:n,requestTime:r,resourcesLoadedTime:{value:i},domParsingTime:{value:e.domContentLoadedEventStart?e.domInteractive-e.domLoading:-1},domContentLoadedTime:{value:e.domContentLoadedEventStart?e.domContentLoadedEventStart-e.fetchStart:-1}}}else e="";return e}(),r=[],i=[],o=0,a=[ff(e),{r2:e.cid},mf(),{random:+new Date}],u=a.length;o<u;o++)for(var l in a[o])a[o].hasOwnProperty(l)&&i.push(l+"="+(void 0===a[o][l]?"":a[o][l]));for(l in t)t.hasOwnProperty(l)&&("domContentLoadedTime"==l?i.push("r3="+t[l].value):r.push(t[l].value));t=gf({pfm:r.join("_"),version:n}),i.push("ext="+t.ext),s(i)},void 0!==window.performance&&void 0!==window.performance.timing&&0!=window.performance.timing.loadEventEnd?t():window.attachEvent?window.attachEvent("onload",t):window.addEventListener&&window.addEventListener("load",t,!1))}else console.log("MTA H5分析错误提示：您选择了用户统计uv，请设置业务的user_id，需为int类型");else console.log("MTA H5分析错误提示：您没有设置sid")},clickStat:function(e,t){var n=this.conf,r=[],i=ff(n),o=hf(n);if(n.cid){i.dm="taclick",i.url=e,o.r2=n.cid,o.r5=function(e){e=void 0===e?{}:e;var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t+"="+encodeURIComponent(e[t]));return n.join(";")}(t);var a=0;for(i=(n=[i,vf(n),o,mf(),gf({version:this.version}),{random:+new Date}]).length;a<i;a++)for(var s in n[a])n[a].hasOwnProperty(s)&&r.push(s+"="+(void 0===n[a][s]?"":n[a][s]));r="https://pingtas.qq.com/webview/pingd?"+r.join("&");var u=new Image;u.onload=u.onerror=u.onabort=function(){u=u.onload=u.onerror=u.onabort=null},u.src=r}else console.log("MTA H5分析错误提示：您没有设置cid,请到管理台开通自定义事件并更新统计代码")},clickShare:function(e){var t,n,r=this.conf,i=df(r),o=void 0===(i=i.param.CKTAG||i.param.ckatg)?[]:i.split(".");if(r.cid){i=[];var a=ff(r),s=hf(r);for(a.dm="taclick_share",a.url="mtah5-share-"+e,s.r2=r.cid,s.r5=(n=[],2===(t=o).length&&"mtah5_share"==t[0]&&n.push(t[0]+"="+t[1]),n.join(";")),e=0,a=(r=[a,vf(r),s,mf(),gf({version:this.version}),{random:+new Date}]).length;e<a;e++)for(var u in r[e])r[e].hasOwnProperty(u)&&i.push(u+"="+(void 0===r[e][u]?"":r[e][u]));u="https://pingtas.qq.com/webview/pingd?"+i.join("&");var l=new Image;l.onload=l.onerror=l.onabort=function(){l=l.onload=l.onerror=l.onabort=null},l.src=u}else console.log("MTA H5分析错误提示：您没有设置cid,请到管理台开通自定义事件并更新统计代码")}},_f=new(function(){function e(){ct(this,e),this.init()}return ft(e,[{key:"report",value:function(e,t){try{yf.clickStat(e,t)}catch(e){}}},{key:"stat",value:function(){try{yf.pgv()}catch(e){}}},{key:"init",value:function(){try{yf.init({sid:"500699039",cid:"500699088",autoReport:1,senseHash:0,senseQuery:0,performanceMonitor:0,ignoreParams:[]})}catch(e){}}}]),e}()),bf=ge.includes;Me({target:"Array",proto:!0},{includes:function(e){return bf(this,e,arguments.length>1?arguments[1]:void 0)}}),qa("includes"),Me({target:"String",proto:!0,forced:!wl("includes")},{includes:function(e){return!!~String(g(this)).indexOf(Sl(e),arguments.length>1?arguments[1]:void 0)}});var Sf=function(){function e(t){ct(this,e),this.client_=t.client,this.subscribedStreams_=new Map,this.unsubscribedStreams_=new Map,this.subscriptedOptions_=new Map,this.autoRecoveryFlags_=new Map}var t,n,r;return ft(e,[{key:"recover",value:(r=lt(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getUserId(),this.autoRecoveryFlags_.has(n)){e.next=4;break}return e.abrupt("return");case 4:if(r=this.unsubscribedStreams_.has(n)?"unsubscribe":"subscribe",e.prev=5,Un.warn("recover() try to recover subscription [".concat(r,"][").concat(n,"]")),"subscribe"!==r){e.next=12;break}return e.next=10,this.recoverSubscription(n,t);case 10:e.next=14;break;case 12:return e.next=14,this.recoverUnsubscription(n,t);case 14:vd({eventType:vc.RECOVER_SUBSCRIPTION}),Un.warn("recover() recover successfully [".concat(r,"][").concat(n,"]")),this.deleteAutoRecoveryFlag(n),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(5),Un.error("recover() recover failed ".concat(r),e.t0),md({eventType:vc.RECOVER_SUBSCRIPTION,error:e.t0}),this.deleteAutoRecoveryFlag(n);case 24:case"end":return e.stop()}},e,this,[[5,19]])})),function(e){return r.apply(this,arguments)})},{key:"recoverSubscription",value:(n=lt(regeneratorRuntime.mark(function e(t,n){var r,i,o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.subscriptedOptions_.get(t),i=this.subscribedStreams_.get(t),r&&i){e.next=4;break}return e.abrupt("return");case 4:return o=this.getStreamMuteState(i),a=o.isAudioMuted,s=o.isVideoMuted,this.mergeStream(i,n),u=i.getConnection(),e.next=9,u.subscribe(i,r);case 9:this.recoverPlayingState(i),a&&i.doEnableTrack("audio",!1),s&&i.doEnableTrack("video",!1);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"recoverUnsubscription",value:(t=lt(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.unsubscribedStreams_.get(t),this.mergeStream(r,n),i=r.getConnection(),e.next=5,i.unsubscribe(r);case 5:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})},{key:"getStreamMuteState",value:function(e){var t={isAudioMuted:!1,isVideoMuted:!1},n=e.getMediaStream();return n&&(t.isAudioMuted=n.getAudioTracks().map(function(e){return e.enabled}).includes(!1),t.isVideoMuted=n.getVideoTracks().map(function(e){return e.enabled}).includes(!1)),t}},{key:"recoverPlayingState",value:function(e){var t=e.isPlaying(),n=e.getDiv();if(t&&n){var r=n.parentNode;e.stop(),e.play(r,{objectFit:e.getObjectFit(),muted:e.getMuted()})}}},{key:"mergeStream",value:function(e,t){var n=t.getConnection(),r=t.getMediaStream();e.setConnection(n),n.setRemoteStream(r.id,e),e.setMediaStream(r),e.setHasAudio(t.hasAudio()),e.setHasVideo(t.hasVideo())}},{key:"addSubscriptionRecord",value:function(e,t,n){if(this.subscribedStreams_.set(e,t),n)this.subscriptedOptions_.set(e,n);else{var r=t.getConnection().getSubscribeState(),i=r.audio,o=r.video,a=r.auxiliary;"main"===t.getType()?this.subscriptedOptions_.set(e,{audio:i,video:o}):this.subscriptedOptions_.set(e,{audio:i,video:a})}this.unsubscribedStreams_.delete(e)}},{key:"addUnsubscriptionRecord",value:function(e,t){this.unsubscribedStreams_.set(e,t),this.subscribedStreams_.delete(e),this.subscriptedOptions_.delete(e)}},{key:"markAllStream",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.subscribedStreams_.keys()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this.setAutoRecoveryFlag(o)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}var a=!0,s=!1,u=void 0;try{for(var l,c=this.unsubscribedStreams_.keys()[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var d=l.value;this.setAutoRecoveryFlag(d)}}catch(e){s=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}}},{key:"setAutoRecoveryFlag",value:function(e){Un.info("setAutoRecoveryFlag() mark ".concat(e)),this.autoRecoveryFlags_.set(e)}},{key:"hasAutoRecoveryFlag",value:function(e){return!!this.isEnabled&&this.autoRecoveryFlags_.has(e)}},{key:"deleteAutoRecoveryFlag",value:function(e){this.autoRecoveryFlags_.delete(e)}},{key:"delete",value:function(e){this.unsubscribedStreams_.delete(e),this.subscribedStreams_.delete(e),this.subscriptedOptions_.delete(e),this.autoRecoveryFlags_.delete(e)}},{key:"isEnabled",get:function(){return"webrtc"!==this.client_.getEnv()}}]),e}(),kf=We.find,wf=!0;"find"in[]&&Array(1).find(function(){wf=!1}),Me({target:"Array",proto:!0,forced:wf},{find:function(e){return kf(this,e,arguments.length>1?arguments[1]:void 0)}}),qa("find");var Ef=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},Tf=1..toFixed,xf=Math.floor,Cf=function(e,t,n){return 0===t?n:t%2==1?Cf(e,t-1,n*e):Cf(e*e,t/2,n)},If=Tf&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!o(function(){Tf.call({})});Me({target:"Number",proto:!0,forced:If},{toFixed:function(e){var t,n,r,i,o=function(e){if("number"!=typeof e&&"Number"!=f(e))throw TypeError("Incorrect invocation");return+e}(this),a=ue(e),s=[0,0,0,0,0,0],u="",l="0",c=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*s[n],s[n]=r%1e7,r=xf(r/1e7)},d=function(e){for(var t=6,n=0;--t>=0;)n+=s[t],s[t]=xf(n/e),n=n%e*1e7},p=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==s[e]){var n=String(s[e]);t=""===t?n:t+$n.call("0",7-n.length)+n}return t};if(a<0||a>20)throw RangeError("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return String(o);if(o<0&&(u="-",o=-o),o>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(o*Cf(2,69,1))-69)<0?o*Cf(2,-t,1):o/Cf(2,t,1),n*=4503599627370496,(t=52-t)>0){for(c(0,n),r=a;r>=7;)c(1e7,0),r-=7;for(c(Cf(10,r,1),0),r=t-1;r>=23;)d(1<<23),r-=23;d(1<<r),c(1,1),d(2),l=p()}else c(0,n),c(1<<-t,0),l=p()+$n.call("0",a);return l=a>0?u+((i=l.length)<=a?"0."+$n.call("0",a-i)+l:l.slice(0,i-a)+"."+l.slice(i-a)):u+l}});var Rf=window.AudioContext||window.webkitAudioContext,Af=null,Of=function(){function e(){var t=this;ct(this,e),Af||(Af=new Rf),this.context_=Af,this.instant_=0,this.slow_=0,this.clip_=0,this.script_=this.context_.createScriptProcessor(2048,1,1),this.script_.onaudioprocess=function(e){var n,r=e.inputBuffer.getChannelData(0),i=0,o=0;for(n=0;n<r.length;++n)i+=r[n]*r[n],Math.abs(r[n])>.99&&(o+=1);t.instant_=Math.sqrt(i/r.length),t.slow_=.95*t.slow_+.05*t.instant_,t.clip_=o/r.length}}return ft(e,[{key:"connectToSource",value:function(e,t){try{var n=new MediaStream;n.addTrack(e),this.mic_=this.context_.createMediaStreamSource(n),this.mic_.connect(this.script_),this.script_.connect(this.context_.destination),void 0!==t&&t(null)}catch(e){Un.error("soundMeter connectoToSource error: "+e),void 0!==t&&t(e)}}},{key:"stop",value:function(){this.mic_.disconnect(),this.script_.disconnect()}},{key:"resume",value:function(){this.context_&&this.context_.resume()}},{key:"getVolume",value:function(){return this.instant_.toFixed(2)}}]),e}(),Mf=function(){function e(t){ct(this,e),this.stream_=t.stream,this.userId_=t.stream.getUserId(),this.log_=this.stream_.getIDLogger(),this.track_=t.track,this.div_=t.div,this.muted_=t.muted,this.outputDeviceId_=t.outputDeviceId,this.volume_=t.volume,this.element_=null,this.emitter_=new Yl,this.state_="NONE",this.soundMeter_=null}var t,n,r;return ft(e,[{key:"play",value:(r=lt(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=new MediaStream).addTrack(this.track_),(n=document.createElement("audio")).srcObject=t,n.muted=this.muted_,n.setAttribute("id","audio_".concat(this.stream_.getId())),n.setAttribute("autoplay","autoplay"),n.setAttribute("playsinline","playsinline"),this.div_.appendChild(n),!this.outputDeviceId_){e.next=12;break}return e.next=12,n.setSinkId(this.outputDeviceId_);case 12:return this.element_=n,this.setVolume(this.volume_),this.handleEvents(),e.prev=15,e.next=18,n.play();case 18:e.next=26;break;case 20:if(e.prev=20,e.t0=e.catch(15),this.log_.warn("<audio> play() error: "+e.t0),!(r=e.t0.toString()+" <audio>").startsWith("NotAllowedError")){e.next=26;break}throw new oc({code:rc.PLAY_NOT_ALLOWED,message:r});case 26:case"end":return e.stop()}},e,this,[[15,20]])})),function(){return r.apply(this,arguments)})},{key:"handleEvents",value:function(){var e=this;this.element_.addEventListener("playing",function(t){e.log_.info("stream - audio player is starting playing"),e.state_="PLAYING",e.emitter_.emit(rf,{state:e.state_,reason:"playing"})}),this.element_.addEventListener("ended",function(t){e.log_.info("stream - audio player is ended"),"STOPPED"!==e.state_&&(e.state_="STOPPED",e.emitter_.emit(rf,{state:e.state_,reason:"ended"}))}),this.element_.addEventListener("pause",function(t){e.log_.info("stream - audio player is paused"),e.state_="PAUSED",e.emitter_.emit(rf,{state:e.state_,reason:"pause"})}),this.track_.addEventListener("ended",function(t){e.log_.info("stream - audio player track is ended"),"STOPPED"!==e.state_&&(e.state_="STOPPED",e.emitter_.emit(rf,{state:e.state_,reason:"ended"}))}),this.track_.addEventListener("mute",function(t){e.log_.info("stream - audio track is muted"),"PAUSED"!==e.state_&&(e.state_="PAUSED",e.emitter_.emit(rf,{state:e.state_,reason:"mute"}))}),this.track_.addEventListener("unmute",function(t){e.log_.info("stream - audio track is unmuted"),"PAUSED"===e.state_&&(e.state_="PLAYING",e.emitter_.emit(rf,{state:e.state_,reason:"unmute"}))})}},{key:"setSinkId",value:(n=lt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.outputDeviceId_===t){e.next=4;break}return e.next=3,this.element_.setSinkId(t);case 3:this.outputDeviceId_=t;case 4:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"setVolume",value:function(e){this.log_.info("stream - audioElement setVolume to : ".concat(e)),this.element_.volume=e}},{key:"getAudioLevel",value:function(){return this.soundMeter_||(this.soundMeter_=new Of,this.soundMeter_.connectToSource(this.track_)),this.soundMeter_.getVolume()}},{key:"stop",value:function(){this.div_.removeChild(this.element_),this.element_.srcObject=null,this.soundMeter_&&(this.soundMeter_.stop(),this.soundMeter_=null)}},{key:"resume",value:(t=lt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.element_.play();case 3:this.soundMeter_&&this.soundMeter_.resume(),e.next=12;break;case 6:if(e.prev=6,e.t0=e.catch(0),this.log_.warn("<audio> play() error: "+e.t0),!(t=e.t0.toString()+" <audio>").startsWith("NotAllowedError")){e.next=12;break}throw new oc({code:rc.PLAY_NOT_ALLOWED,message:t});case 12:case"end":return e.stop()}},e,this,[[0,6]])})),function(){return t.apply(this,arguments)})},{key:"on",value:function(e,t){this.emitter_.on(e,t)}}]),e}(),Df=function(){function e(t){ct(this,e),this.stream_=t.stream,this.userId_=t.stream.getUserId(),this.log_=this.stream_.getIDLogger(),this.track_=t.track,this.div_=t.div,this.muted_=t.muted,this.objectFit_=t.objectFit,this.mirror_=t.mirror,this.element_=null,this.emitter_=new Yl,this.state_="NONE"}var t,n;return ft(e,[{key:"play",value:(n=lt(regeneratorRuntime.mark(function e(){var t,n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new MediaStream).addTrack(this.track_),(n=document.createElement("video")).srcObject=t,n.muted=!0,r="width: 100%; height: 100%; object-fit: ".concat(this.objectFit_,";"),this.mirror_&&(r+="transform: rotateY(180deg);"),n.setAttribute("id","video_".concat(this.stream_.getId())),n.setAttribute("style",r),n.setAttribute("autoplay","autoplay"),n.setAttribute("playsinline","playsinline"),this.div_.appendChild(n),this.element_=n,this.handleEvents(),e.prev=14,e.next=17,n.play();case 17:e.next=25;break;case 19:if(e.prev=19,e.t0=e.catch(14),this.log_.warn("<video> play() error: "+e.t0),!(i=e.t0.toString()+" <video>").startsWith("NotAllowedError")){e.next=25;break}throw new oc({code:rc.PLAY_NOT_ALLOWED,message:i});case 25:case"end":return e.stop()}},e,this,[[14,19]])})),function(){return n.apply(this,arguments)})},{key:"handleEvents",value:function(){var e=this;this.element_.addEventListener("playing",function(t){e.log_.info("stream - video player is starting playing"),e.state_="PLAYING",e.emitter_.emit(rf,{state:e.state_,reason:"playing"})}),this.element_.addEventListener("ended",function(t){e.log_.info("stream - video player is ended"),"STOPPED"!==e.state_&&(e.state_="STOPPED",e.emitter_.emit(rf,{state:e.state_,reason:"ended"}))}),this.element_.addEventListener("pause",function(t){e.log_.info("stream - video player is paused"),e.state_="PAUSED",e.emitter_.emit(rf,{state:e.state_,reason:"pause"})}),this.track_.addEventListener("ended",function(t){e.log_.info("stream - video player track is ended"),"STOPPED"!==e.state_&&(e.state_="STOPPED",e.emitter_.emit(rf,{state:e.state_,reason:"ended"}))}),this.track_.addEventListener("mute",function(t){e.log_.info("stream - video track is muted"),"PAUSED"!==e.state_&&(e.state_="PAUSED",e.emitter_.emit(rf,{state:e.state_,reason:"mute"}))}),this.track_.addEventListener("unmute",function(t){e.log_.info("stream - video track is unmuted"),"PAUSED"===e.state_&&(e.state_="PLAYING",e.emitter_.emit(rf,{state:e.state_,reason:"unmute"}))})}},{key:"stop",value:function(){this.div_.removeChild(this.element_),this.element_.srcObject=null}},{key:"resume",value:(t=lt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.element_.play();case 3:e.next=11;break;case 5:if(e.prev=5,e.t0=e.catch(0),this.log_.warn("<video> play() error: "+e.t0),!(t=e.t0.toString()+" <video>").startsWith("NotAllowedError")){e.next=11;break}throw new oc({code:rc.PLAY_NOT_ALLOWED,message:t});case 11:case"end":return e.stop()}},e,this,[[0,5]])})),function(){return t.apply(this,arguments)})},{key:"getVideoFrame",value:function(){var e=document.createElement("canvas");return e.width=this.element_.videoWidth,e.height=this.element_.videoHeight,e.getContext("2d").drawImage(this.element_,0,0),e.toDataURL("image/png")}},{key:"on",value:function(e,t){this.emitter_.on(e,t)}}]),e}(),Lf=function(){function e(t){ct(this,e),this.userId_=t.userId,this.isRemote_=t.isRemote,this.type_=t.type,this.log_=new af({id:"s|"+this.userId_,direction:this.isRemote_?"remote":"local",type:this.isRemote_?this.type_:""}),this.mirror_=!1,this.isRemote_||(this.mirror_=!0),void 0!==t.mirror&&(this.mirror_=t.mirror),this.client_=null,void 0!==t.client&&(this.client_=t.client),this.mediaStream_=null,this.div_=null,this.isPlaying_=!1,this.connection_=null,this.hasAudio_=!1,this.hasVideo_=!1,this.audioPlayer_=null,this.videoPlayer_=null,this.muted_=!1,this.objectFit_="cover",this.id_=Ef(),this.audioOutputDeviceId_=0,this.audioVolume_=1,this.emitter_=new Yl}var t,n,r,i,o;return ft(e,[{key:"getType",value:function(){return this.type_}},{key:"getIDLogger",value:function(){return this.log_}},{key:"setConnection",value:function(e){this.connection_!==e&&(this.connection_=e)}},{key:"getConnection",value:function(){return this.connection_}},{key:"play",value:(o=lt(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPlaying_){e.next=2;break}throw new oc({code:rc.INVALID_OPERATION,message:"duplicated play() call observed, please stop() firstly"});case 2:if(this.isPlaying_=!0,this.log_.info("stream start to play with options: ".concat(JSON.stringify(n))),(r=document.createElement("div")).setAttribute("id","player_".concat(this.id_)),r.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),i=t,"object"!==st(t)&&(i=document.getElementById(t)),i.appendChild(r),this.div_=r,this.isRemote_||(this.muted_=!0),n&&void 0!==n.muted&&(this.muted_=n.muted),this.isRemote_&&"auxiliary"===this.getType()&&(this.objectFit_="contain"),n&&void 0!==n.objectFit&&(this.objectFit_=n.objectFit),!this.hasVideo_){e.next=18;break}return e.next=18,this.playVideo();case 18:if(!this.hasAudio_){e.next=21;break}return e.next=21,this.playAudio();case 21:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"playAudio",value:(i=lt(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getAudioTrack(),this.audioPlayer_||!t){e.next=7;break}return this.log_.info("stream - create AudioPlayer and play"),this.audioPlayer_=new Mf({stream:this,track:t,div:this.div_,muted:this.muted_,outputDeviceId:this.audioOutputDeviceId_,volume:this.audioVolume_}),this.audioPlayer_.on(rf,function(e){n.emitter_.emit(nf,{type:"audio",state:e.state,reason:e.reason})}),e.next=7,this.audioPlayer_.play();case 7:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"playVideo",value:(r=lt(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getVideoTrack(),this.videoPlayer_||!t){e.next=7;break}return this.log_.info("stream - create VideoPlayer and play"),this.videoPlayer_=new Df({stream:this,track:t,div:this.div_,muted:this.muted_,objectFit:this.objectFit_,mirror:this.mirror_}),this.videoPlayer_.on(rf,function(e){n.emitter_.emit(nf,{type:"video",state:e.state,reason:e.reason})}),e.next=7,this.videoPlayer_.play();case 7:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"stopAudio",value:function(){this.audioPlayer_&&(this.log_.info("stream - stop AudioPlayer"),this.audioPlayer_.stop(),this.audioPlayer_=null)}},{key:"stopVideo",value:function(){this.videoPlayer_&&(this.log_.info("stream - stop VideoPlayer"),this.videoPlayer_.stop(),this.videoPlayer_=null)}},{key:"restartAudio",value:function(){this.isPlaying_&&(this.stopAudio(),this.playAudio())}},{key:"restartVideo",value:function(){this.isPlaying_&&(this.stopVideo(),this.playVideo())}},{key:"stop",value:function(){this.isPlaying_&&(this.isPlaying_=!1,this.stopAudio(),this.stopVideo(),this.div_.parentNode.removeChild(this.div_))}},{key:"resume",value:(n=lt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isPlaying_){e.next=2;break}return e.abrupt("return");case 2:if(this.log_.info("stream - resume"),!this.audioPlayer_){e.next=6;break}return e.next=6,this.audioPlayer_.resume();case 6:if(!this.videoPlayer_){e.next=9;break}return e.next=9,this.videoPlayer_.resume();case 9:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"close",value:function(){this.isPlaying_&&this.stop(),this.mediaStream_&&(this.mediaStream_.preventEvent=1,this.mediaStream_.getTracks().forEach(function(e){e.stop()}),this.mediaStream_=null)}},{key:"muteAudio",value:function(){return this.addRemoteEvent(!0,"audio"),this.doEnableTrack("audio",!1)}},{key:"muteVideo",value:function(){return this.addRemoteEvent(!0,"video"),this.doEnableTrack("video",!1)}},{key:"unmuteAudio",value:function(){return this.addRemoteEvent(!1,"audio"),this.doEnableTrack("audio",!0)}},{key:"unmuteVideo",value:function(){return this.addRemoteEvent(!1,"video"),this.doEnableTrack("video",!0)}},{key:"addRemoteEvent",value:function(e,t){if(this.isRemote_&&this.client_){var n=this.client_.getUserId(),r="".concat(e?"mute":"unmute"," remote ").concat(t);sc(n,{eventId:"audio"===t?e?32785:32787:e?32784:32786,eventDesc:r,timestamp:(new Date).getTime(),userId:n,tinyId:this.client_.getTinyId(),remoteUserId:this.userId_,remoteTinyId:this.connection_.getTinyId()})}}},{key:"doEnableTrack",value:function(e,t){var n=!1;return"audio"===e?this.mediaStream_.getAudioTracks().forEach(function(e){n=!0,e.enabled=t}):this.mediaStream_.getVideoTracks().forEach(function(e){n=!0,e.enabled=t}),n}},{key:"getId",value:function(){return this.id_}},{key:"getUserId",value:function(){return this.userId_}},{key:"isPlaying",value:function(){return this.isPlaying_}},{key:"setAudioOutput",value:(t=lt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioOutputDeviceId_=t,!this.audioPlayer_){e.next=4;break}return e.next=4,this.audioPlayer_.setSinkId(t);case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"setAudioVolume",value:function(e){this.audioVolume_=e,this.log_.info("setAudioVolume to ".concat(e)),this.audioPlayer_&&this.audioPlayer_.setVolume(e)}},{key:"getAudioLevel",value:function(){var e=0;return this.audioPlayer_&&(e=this.audioPlayer_.getAudioLevel()),e}},{key:"hasAudio",value:function(){return this.hasAudio_}},{key:"hasVideo",value:function(){return this.hasVideo_}},{key:"getAudioTrack",value:function(){var e=null;if(this.mediaStream_){var t=this.mediaStream_.getAudioTracks();t.length>0&&(e=t[0])}return e}},{key:"getVideoTrack",value:function(){var e=null;if(this.mediaStream_){var t=this.mediaStream_.getVideoTracks();t.length>0&&(e=t[0])}return e}},{key:"getVideoFrame",value:function(){return this.videoPlayer_?this.videoPlayer_.getVideoFrame():null}},{key:"getMediaStream",value:function(){return this.mediaStream_}},{key:"setMediaStream",value:function(e){e!==this.mediaStream_&&(this.mediaStream_&&this.mediaStream_.getTracks().forEach(function(e){return e.stop()}),this.mediaStream_=e)}},{key:"setHasVideo",value:function(e){this.hasVideo_=e,this.isPlaying_&&(e?(this.log_.info("stream updated, play video"),this.playVideo()):(this.log_.info("stream updated, stop video"),this.stopVideo()))}},{key:"setHasAudio",value:function(e){this.hasAudio_=e,this.isPlaying_&&(e?(this.log_.info("stream updated, play audio"),this.playAudio()):(this.log_.info("stream updated, stop audio"),this.stopAudio()))}},{key:"on",value:function(e,t){this.emitter_.on(e,t)}},{key:"isRemote",value:function(){return this.isRemote_}},{key:"getDiv",value:function(){return this.div_}},{key:"getObjectFit",value:function(){return this.objectFit_}},{key:"getMuted",value:function(){return this.muted_}}]),e}(),Pf=function(e){function t(e){var n;ct(this,t);var r=ht({},e,{isRemote:!0,type:e.type});return(n=bt(this,vt(t).call(this,r))).isInSubscriptionCycle_=!1,n}return gt(t,Lf),ft(t,[{key:"getType",value:function(){return St(vt(t.prototype),"getType",this).call(this)}},{key:"setInSubscriptionCycle",value:function(e){this.isInSubscriptionCycle_=e}},{key:"isInSubscriptionCycle",value:function(){return this.isInSubscriptionCycle_}}]),t}(),Nf=n(function(e){var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach(function(e){t[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})}),Uf=(Nf.v,Nf.o,Nf.s,Nf.i,Nf.u,Nf.e,Nf.p,Nf.z,Nf.r,Nf.t,Nf.c,Nf.b,Nf.m,Nf.a,n(function(e,t){var n=function(e){return String(Number(e))===e?Number(e):e},r=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:i?t[e.name]:t;!function(e,t,r,i){if(i&&!r)t[i]=n(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(t[r[o]]=n(e[o+1]))}(r.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],o=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach(function(e){var t=e[0],i=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),o=n[n.length-1]);for(var a=0;a<(Nf[t]||[]).length;a+=1){var s=Nf[t][a];if(s.reg.test(i))return r(s,o,i)}}),t.media=n,t};var o=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),i=0;i<r.length;i+=3)t.push({component:r[i],ip:r[i+1],port:r[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}})),Ff=(Uf.parse,Uf.parseParams,Uf.parseFmtpConfig,Uf.parsePayloads,Uf.parseRemoteCandidates,Uf.parseImageAttributes,Uf.parseSimulcastStreamList,/%[sdv%]/g),jf=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?r.push(n[t.name][o]):r.push(n[t.names[i]])}else r.push(n[t.name]);return function(e){var t=1,n=arguments,r=n.length;return e.replace(Ff,function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})}.apply(null,r)},Gf=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Bf=["i","c","b","a"],Vf={write:function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||Gf,r=t.innerOrder||Bf,i=[];return n.forEach(function(t){Nf[t].forEach(function(n){n.name in e&&null!=e[n.name]?i.push(jf(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){i.push(jf(t,n,e))})})}),e.media.forEach(function(e){i.push(jf("m",Nf.m[0],e)),r.forEach(function(t){Nf[t].forEach(function(n){n.name in e&&null!=e[n.name]?i.push(jf(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){i.push(jf(t,n,e))})})})}),i.join("\r\n")+"\r\n"},parse:Uf.parse,parseFmtpConfig:Uf.parseFmtpConfig,parseParams:Uf.parseParams,parsePayloads:Uf.parsePayloads,parseRemoteCandidates:Uf.parseRemoteCandidates,parseImageAttributes:Uf.parseImageAttributes,parseSimulcastStreamList:Uf.parseSimulcastStreamList},qf=function(e,t){var n=Vf.parse(e).media,r=Vf.parse(t).media;return{added:r.filter(function(e){var t=n.find(function(t){return t.mid===e.mid});return(void 0===t||void 0===t.ssrcs)&&e.ssrcs}),removed:n.filter(function(e){var t=r.find(function(t){return t.mid===e.mid});return(void 0===t||void 0===t.ssrcs)&&e.ssrcs})}},Hf=function(e){return Vf.parse(e)},zf=function(e){return Vf.write(e)},Kf=function(e){return e>>16&255},Wf={voiceActivityDetection:!1},Yf=function(){function e(t){ct(this,e),this.userId_=t.userId,this.tinyId_=t.tinyId,this.client_=t.client,this.sdpSemantics_=t.client.getSdpSemantics(),this.isUplink_=t.isUplink,this.log_=new af({id:"n|"+this.userId_,direction:this.isUplink_?"local":"remote",type:""}),this.signalChannel_=t.signalChannel,this.peerConnection_=null,this.connectTimer_=-1,this.remoteStreams_=new Map,this.localStream_=null,this.waitForUpdatedAnswer_=!1,this.isErrorObserved_=!1,this.mutedState_=0,this.subscribeState_={audio:!0,video:!0,auxiliary:!0},this.pendingSubscription_=[],this.pendingStreams_=[],this.subscriptionTimeout_=-1,this.subscriptionRetryCount_=0,this.isSubscriptionPending_=!1,this.sentSubscriptionAfterConnected_=!1,this.emitter_=new Yl,this.startTime_=new Date,this.endTime_=this.startTime_,this.hasValidEndTime_=!1,this.hasVideo_=!1,this.needToRebuildConnection_=!1,this.publishResolve_=null,this.currentState_=gc.DISCONNECTED}var t,n,r,i,o,a,s,u,l;return ft(e,[{key:"initialize",value:function(){var e={iceServers:this.client_.getIceServers(),iceTransportPolicy:"all",sdpSemantics:this.sdpSemantics_,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",tcpCandidatePolicy:"disable",IceTransportsType:"nohost"};this.peerConnection_=new RTCPeerConnection(e),this.peerConnection_.onconnectionstatechange=this.onConnectionStateChange.bind(this),this.isUplink_||(this.peerConnection_.ontrack=this.onTrack.bind(this)),this.installSignalChannelEvents()}},{key:"publish",value:function(e){var t=this;return new Promise(function(n,r){t.localStream_=e,t.publishResolve_=n;var i=e.getMediaStream();t.log_.info("is publishing stream: ".concat(e.getId())),i.getTracks().forEach(function(e){"video"===e.kind&&t.setVideoStats("start"),t.peerConnection_.addTrack(e,i)}),t.updateMediaSettings(i),t.exchangeOffer(r)})}},{key:"updateMediaSettings",value:function(e){var t=this,n={EncVideoCodec:"H264",EncVideoWidth:0,EncVideoHeight:0,EncVideoBr:"0",EncVideoFps:0,EncAudioCodec:"opus",EncAudioFS:0,EncAudioCh:0,EncAudioBr:"0"};"getSettings"in MediaStreamTrack.prototype?e.getTracks().forEach(function(e){var r=e.getSettings();if("audio"===e.kind){var i=1;r.channelCount&&(i=r.channelCount),n.EncAudioCh=i,n.EncAudioBr="".concat(1e3*t.localStream_.getAudioBitrate()),n.EncAudioFS=r.sampleRate}else"video"===e.kind&&(n.EncVideoWidth=r.width,n.EncVideoHeight=r.height,n.EncVideoFps=r.frameRate,n.EncVideoBr="".concat(1e3*t.localStream_.getVideoBitrate()))}):n=this.getMediaSettingsFromProfile(n),this.log_.info("updateMediaSettings: "+JSON.stringify(n)),this.signalChannel_.send("on_constraints_config",n)}},{key:"getMediaSettingsFromProfile",value:function(e){var t=this.localStream_;if(t){if(t.getAudioTrack()){var n=t.getAudioProfile();e.EncAudioCh=n.channelCount,e.EncAudioBr="".concat(1e3*n.bitrate),e.EncAudioFS=n.sampleRate}if(t.getVideoTrack()){var r=t.getVideoProfile();e.EncVideoWidth=r.width,e.EncVideoHeight=r.height,e.EncVideoFps=r.frameRate,e.EncVideoBr="".concat(1e3*r.bitrate)}}return e}},{key:"replaceStream",value:(l=lt(regeneratorRuntime.mark(function e(t){var n,r,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.peerConnection_||!Rd()){e.next=8;break}return n=t.getVideoTracks(),r=t.getAudioTracks(),(this.peerConnection_.getSenders()||[]).forEach(function(e){e.track&&("video"===e.track.kind?e.replaceTrack&&n.length>0?e.replaceTrack(n[0]):(i.peerConnection_.removeTrack(e),n.length>0&&i.peerConnection_.addTrack(n[0],t)):"audio"===e.track.kind&&(e.replaceTrack&&r.length>0?e.replaceTrack(r[0]):(i.peerConnection_.removeTrack(e),r.length>0&&i.peerConnection_.addTrack(r[0],t))))}),this.updateMediaSettings(t),e.next=8,this.updateOffer();case 8:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"addTrack",value:(u=lt(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.peerConnection_){e.next=8;break}return this.log_.info("is adding ".concat(t.kind," track to current published local stream")),n=this.localStream_.getMediaStream(),this.peerConnection_.addTrack(t,n),"video"===t.kind&&this.setVideoStats("start"),this.updateMediaSettings(n),e.next=8,this.updateOffer();case 8:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"removeTrack",value:(s=lt(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.peerConnection_||!Rd()){e.next=10;break}if(this.log_.info("is removing ".concat(t.kind," track from current published local stream")),!(n=this.peerConnection_.getSenders().find(function(e){return e.track===t}))){e.next=10;break}return this.peerConnection_.removeTrack(n),"RTCPeerConnection"in window&&"getTransceivers"in window.RTCPeerConnection.prototype&&Vc&&(r=this.peerConnection_.getTransceivers().find(function(e){return e.sender&&null===e.sender.track}))&&"function"==typeof r.stop&&r.stop(),"video"===t.kind&&this.setVideoStats("end"),this.updateMediaSettings(this.localStream_.getMediaStream()),e.next=10,this.updateOffer();case 10:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"isReplaceTrackAvailable",value:function(){return"RTCRtpSender"in window&&"replaceTrack"in window.RTCRtpSender.prototype}},{key:"replaceTrack",value:(a=lt(regeneratorRuntime.mark(function e(t){var n,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReplaceTrackAvailable()&&Rd()){e.next=2;break}throw new oc({code:rc.INVALID_OPERATION,message:"replaceTrack is not supported in this browser, please use switchDevice or addTrack instead"});case 2:if(this.peerConnection_){e.next=4;break}throw new oc({code:rc.INVALID_OPERATION,message:"replaceTrack() is only valid after the LocalStream has been published"});case 4:if(0!==(n=this.peerConnection_.getSenders()).length){e.next=7;break}throw new oc({code:rc.INVALID_OPERATION,message:"replaceTrack() is only valid after the LocalStream has been published"});case 7:n.forEach(function(e){e.track&&e.track.kind===t.kind&&(r.log_.info("is replacing ".concat(t.kind," track to current published local stream")),e.replaceTrack(t))});case 8:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"close",value:function(){var e=this;this.log_.info("closing connection"),this.clearConnectTimer(),-1!==this.subscriptionTimeout_&&(clearTimeout(this.subscriptionTimeout_),this.subscriptionTimeout_=-1),this.peerConnection_&&(this.peerConnection_.onconnectionstatechange=function(e){},this.peerConnection_.close(),this.peerConnection_=null),this.isUplink_||(this.remoteStreams_.forEach(function(t,n,r){var i=t;i.setConnection(null),e.emitter_.emit(Yd.STREAM_REMOVED,{stream:i})}),this.remoteStreams_.clear()),this.uninstallSignalChannelEvents()}},{key:"installSignalChannelEvents",value:function(){this.isUplink_?this.signalChannel_.on(ec.NEW_REMOTE_SDP,this.onNewRemoteSdp,this):(this.signalChannel_.on(ec.UPDATE_REMOTE_SDP,this.onUpdateRemoteSdp,this),this.signalChannel_.on(ec.UPDATE_AUDIO_SSRC,this.onUpdateAudioSSRC,this),this.signalChannel_.on(ec.UPDATE_VIDEO_SSRC,this.onUpdateVideoSSRC,this),this.signalChannel_.on(ec.SUBSCRIBE_ACK,this.onSubscription,this))}},{key:"uninstallSignalChannelEvents",value:function(){this.isUplink_?this.signalChannel_.removeListener(ec.NEW_REMOTE_SDP,this.onNewRemoteSdp,this):(this.signalChannel_.removeListener(ec.UPDATE_REMOTE_SDP,this.onUpdateRemoteSdp,this),this.signalChannel_.removeListener(ec.UPDATE_AUDIO_SSRC,this.onUpdateAudioSSRC,this),this.signalChannel_.removeListener(ec.UPDATE_VIDEO_SSRC,this.onUpdateVideoSSRC,this),this.signalChannel_.removeListener(ec.SUBSCRIBE_ACK,this.onSubscription,this))}},{key:"onNewRemoteSdp",value:function(e){if(this.hitTest(e.data.srctinyid)){var t=e.data.content;this.acceptAnswer(t)}}},{key:"onUpdateRemoteSdp",value:function(e){var t=e.data.content;if(this.hitTest(t.srctinyid)){this.log_.info("is updating remote sdp offer");var n=t.newSdp;this.updateRemoteDescription(n)}}},{key:"onUpdateAudioSSRC",value:function(e){var t=e.data.content;if(this.hitTest(t.srctinyid)){this.log_.info("is updating audio ssrc");var n=t.newSdp;this.updateRemoteDescription(n)}}},{key:"onUpdateVideoSSRC",value:(o=lt(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.data.content,!this.hitTest(n.srctinyid)){e.next=25;break}if(r=n.newSdp,!this.needToRebuildConnection_){e.next=23;break}return e.prev=4,this.log_.warn("peerConnection rebuilding"),this.peerConnection_.onconnectionstatechange=function(){},this.peerConnection_.close(),this.peerConnection_=null,this.needToRebuildConnection_=!1,this.uninstallSignalChannelEvents(),e.next=13,this.initialize();case 13:return e.next=15,this.setRemoteOffer(r);case 15:this.log_.warn("peerConnection rebuild successfully"),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(4),this.log_.warn("peerConnection rebuild failed");case 21:e.next=25;break;case 23:this.log_.info("is updating video ssrc"),this.updateRemoteDescription(r);case 25:case"end":return e.stop()}},e,this,[[4,18]])})),function(e){return o.apply(this,arguments)})},{key:"onTrack",value:function(e){var t=e.streams[0],n=e.track;if(this.log_.info("ontrack() kind: ".concat(n.kind," id: ").concat(n.id," streamId: ").concat(t.id)),"unified-plan"===this.sdpSemantics_){var r=function(e){var t=Vf.parse(e),n={audio:[],video:[]};return t.media.forEach(function(e){if(e.ssrcs){var t=e.ssrcs[0].id>>16&255;if("audio"===e.type)n.audio.push(lc);else if("video"==e.type){var r=2===t?lc:cc;n.video.push(r)}}}),n}(this.peerConnection_.remoteDescription.sdp);if("audio"===n.kind){if(0===r.audio.length||t.id!==lc)return void this.log_.debug("skip this invalid audio track")}else if(-1===r.video.indexOf(t.id))return void this.log_.debug("skip this invalid video track: ".concat(n.id,"  msid: ").concat(t.id))}gd({eventType:"ontrack",kind:n.kind});var i=!1,o=this.remoteStreams_.get(t.id);if(void 0===o){var a=t.id===lc?"main":"auxiliary";(o=new Pf({type:a,userId:this.userId_,client:this.client_})).setConnection(this),this.remoteStreams_.set(t.id,o),i=!0}o.setMediaStream(t),"audio"===n.kind?(o.hasAudio()&&o.isPlaying()&&(this.log_.debug("already has an audio track, restart audio player with the new track"),o.restartAudio()),o.setHasAudio(!0)):(this.setVideoStats("start"),o.hasVideo()&&o.isPlaying()&&(this.log_.debug("already has an video track, restart video player with the new track"),o.restartVideo()),o.setHasVideo(!0)),o.getAudioTrack()||o.setHasAudio(!1),o.getVideoTrack()||o.setHasVideo(!1),i?this.emitter_.emit(Yd.STREAM_ADDED,{stream:o}):this.emitter_.emit(Yd.STREAM_UPDATED,{stream:o})}},{key:"isRtpSenderAvailable",value:function(){return"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype&&Rd()}},{key:"setBandwidth",value:(i=lt(regeneratorRuntime.mark(function e(t,n,r){var i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isUplink_){e.next=2;break}return e.abrupt("return",r);case 2:if(this.isRtpSenderAvailable()){e.next=4;break}return e.abrupt("return","video"===n?this.updateVideoBandwidthRestriction(r,t):this.updateAudioBandwidthRestriction(r,t));case 4:if(!(i=this.peerConnection_.getSenders().find(function(e){return e.track&&e.track.kind===n}))){e.next=20;break}return(o=i.getParameters()).encodings&&0!==o.encodings.length||(o.encodings=[{}]),"unlimited"===t?delete o.encodings[0].maxBitrate:o.encodings[0].maxBitrate=1e3*t,e.prev=9,e.next=12,i.setParameters(o);case 12:return this.log_.debug(n+" bandwidth was set to "+t+" kbps"),e.abrupt("return",r);case 16:return e.prev=16,e.t0=e.catch(9),this.log_.info("failed to set bandwidth by setting maxBitrate: "+e.t0),e.abrupt("return","video"===n?this.updateVideoBandwidthRestriction(r,t):this.updateAudioBandwidthRestriction(r,t));case 20:return e.abrupt("return",r);case 21:case"end":return e.stop()}},e,this,[[9,16]])})),function(e,t,n){return i.apply(this,arguments)})},{key:"updateVideoBandwidthRestriction",value:function(e,t){var n="AS";return Vc&&(n="TIAS",t*=1e3),e=-1===e.indexOf("b="+n+":")?e.replace(/m=video (.*)\r\nc=IN (.*)\r\n/,"m=video $1\r\nc=IN $2\r\nb="+n+":"+t+"\r\n"):e.replace(new RegExp("b="+n+":.*\r\n"),"b="+n+":"+t+"\r\n")}},{key:"updateAudioBandwidthRestriction",value:function(e,t){var n="AS";return Vc&&(n="TIAS",t*=1e3),e=e.replace(/m=audio (.*)\r\nc=IN (.*)\r\n/,"m=audio $1\r\nc=IN $2\r\nb="+n+":"+t+"\r\n")}},{key:"removeBandwidthRestriction",value:function(e){return e.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"")}},{key:"removeVideoOrientation",value:function(e){return e.replace(/urn:3gpp:video-orientation/,"")}},{key:"exchangeOffer",value:function(e){var t=this;this.peerConnection_.createOffer(Wf).then(function(e){return t.peerConnection_.setLocalDescription(e)}).then(function(){t.log_.info("createOffer success, sending offer to remote server");var e=t.peerConnection_.localDescription,n={type:e.type,sdp:t.removeVideoOrientation(e.sdp)};t.log_.debug("sending sdp offer: "+n.sdp),t.signalChannel_.send(tc,n,0),vd({eventType:vc.SET_LOCAL_DESCRIPTION,kind:"offer"})}).catch(function(n){var r=new oc({code:rc.CREATE_OFFER_FAILED,message:"failed to create offer: "+n.message});t.log_.error("failed to create offer",n),md({eventType:vc.SET_LOCAL_DESCRIPTION,kind:"offer",error:r}),e(r)})}},{key:"setSDPDirection",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"all",r=Hf(e);return r.media.forEach(function(e){"all"!==n&&e.type!==n||(e.direction=t)}),zf(r)}},{key:"updateOffer",value:(r=lt(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="",e.prev=1,e.next=4,this.peerConnection_.createOffer(Wf);case 4:return t=e.sent,Vc&&(t.sdp=this.setSDPDirection(t.sdp,"sendrecv")),e.next=8,this.peerConnection_.setLocalDescription(t);case 8:n=this.peerConnection_.localDescription,this.log_.info("createOffer success, sending updated offer to remote server"),this.log_.debug("updatedOffer: "+n.sdp),this.signalChannel_.send("on_reexchange_sdp",n,0),this.waitForUpdatedAnswer_=!0,vd({eventType:vc.SET_LOCAL_DESCRIPTION,kind:"offer"}),e.next=22;break;case 16:throw e.prev=16,e.t0=e.catch(1),r=new oc({code:rc.CREATE_OFFER_FAILED,message:"failed to create updated sdp offer: "+e.t0.message}),this.log_.error(r),md({eventType:vc.SET_LOCAL_DESCRIPTION,kind:"offer",error:r}),r;case 22:case"end":return e.stop()}},e,this,[[1,16]])})),function(){return r.apply(this,arguments)})},{key:"addRRTRLine",value:function(e){var t=e.split("\r\n"),n=new Map;t.forEach(function(e,r){/^a=rtcp-fb:/.test(e)&&t[r+1]&&!/^a=rtcp-fb:/.test(t[r+1])&&n.set(r+1,e.match(/^a=rtcp-fb:\d+/)[0]+" rrtr")});for(var r=wt(n),i=0;i<r.length;i++){var o=kt(r[i],2),a=o[0],s=o[1];t.splice(a+i,0,s)}return t.join("\r\n")}},{key:"addSPSDescription",value:function(e){var t=Hf(e);return t.media.forEach(function(e){"video"===e.type&&e.fmtp.forEach(function(e){e.config+=";sps-pps-idr-in-keyframe=1"})}),zf(t)}},{key:"acceptAnswer",value:(n=lt(regeneratorRuntime.mark(function e(t){var n,r,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.localStream_.getVideoBitrate(),r=this.localStream_.getAudioBitrate(),i=this.removeVideoOrientation(t.sdp),e.prev=3,e.next=6,this.setBandwidth(n,"video",i);case 6:return i=e.sent,e.next=9,this.setBandwidth(r,"audio",i);case 9:return i=e.sent,o={type:t.type,sdp:i},e.next=13,this.peerConnection_.setRemoteDescription(o);case 13:this.log_.debug("accepted anwswer: "+i),this.waitForUpdatedAnswer_||(this.log_.info("accepted remote answer"),this.publishResolve_&&(this.publishResolve_(this.localStream_),this.publishResolve_=null)),vd({eventType:vc.SET_REMOTE_DESCRIPTION,kind:"answer"}),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(3),md({eventType:vc.SET_REMOTE_DESCRIPTION,kind:"answer",error:e.t0}),this.log_.error("failed to accept remote answer "+e.t0);case 22:case"end":return e.stop()}},e,this,[[3,18]])})),function(e){return n.apply(this,arguments)})},{key:"failIceConnectionForTest",value:function(){this.log_.warn("failIceConnectionForTest()"),this.emitter_.emit(Yd.ERROR,new oc({message:"fake ICE failure fired",code:rc.ICE_TRANSPORT_ERROR}))}},{key:"getDTLSTransportState",value:function(){if(!this.peerConnection_)return"unknown";var e=null;if(this.isUplink_){if(!Rd()||0===this.peerConnection_.getSenders().length)return"unknown";e=this.peerConnection_.getSenders()[0].transport}else{if(!Id()||0===this.peerConnection_.getReceivers().length)return"unknown";e=this.peerConnection_.getReceivers()[0].transport}return e?e.state:"unknown"}},{key:"onConnectionStateChange",value:function(e){var t=this,n=this.peerConnection_.iceConnectionState,r=this.getDTLSTransportState();if(this.log_.info("onConnectionStateChange() connectionState: "+e.target.connectionState),this.log_.info("ICE Transport state: ".concat(n,", DTLS Transport state: ").concat(r)),"connecting"===e.target.connectionState?(this.clearConnectTimer(),this.connectTimer_=setTimeout(function(){var e="".concat(t.isUplink_?"uplink":"downlink"," DTLS Transport connection timeout (").concat(10,"s). ICE Transport state: ").concat(n,", DTLS Transport state: ").concat(r);t.addTransportEvent("disconnected"),t.emitter_.emit(Yd.CONNECTION_STATE_CHANGED,{prevState:t.currentState_,state:gc.DISCONNECTED}),t.currentState_=gc.DISCONNECTED,t.isErrorObserved_=!0;var i=new oc({message:e,code:rc.ICE_TRANSPORT_ERROR});md({eventType:vc.ICE_CONNECTION_STATE,error:i}),t.emitter_.emit(Yd.ERROR,i)},1e4),this.emitter_.emit(Yd.CONNECTION_STATE_CHANGED,{prevState:this.currentState_,state:gc.CONNECTING}),this.currentState_=gc.CONNECTING):this.clearConnectTimer(),"failed"===e.target.connectionState||"closed"===e.target.connectionState){var i="".concat(this.isUplink_?"uplink":"downlink"," ICE/DTLS Transport connection ").concat(e.target.connectionState,". ICE Transport state: ").concat(n,", DTLS Transport state: ").concat(r),o=new oc({message:i,code:rc.ICE_TRANSPORT_ERROR});md({eventType:vc.ICE_CONNECTION_STATE,error:o}),this.emitter_.emit(Yd.CONNECTION_STATE_CHANGED,{prevState:this.currentState_,state:gc.DISCONNECTED}),this.currentState_=gc.DISCONNECTED,this.isErrorObserved_||(this.addTransportEvent("disconnected"),this.emitter_.emit(Yd.ERROR,o))}if("connected"===e.target.connectionState||"completed"===e.target.connectionState){if(vd({eventType:vc.ICE_CONNECTION_STATE}),this.addTransportEvent("connected"),this.emitter_.emit(Yd.CONNECTION_STATE_CHANGED,{prevState:this.currentState_,state:gc.CONNECTED}),this.currentState_=gc.CONNECTED,!this.sentSubscriptionAfterConnected_&&this.pendingSubscription_.length>0){this.log_.info("send pending subscription after RTCPeerConnection is connected");var a=this.pendingSubscription_[0];this.doSendSubscription(a.data,a.stream),this.sentSubscriptionAfterConnected_=!0}}else"disconnected"===e.target.connectionState&&(this.emitter_.emit(Yd.CONNECTION_STATE_CHANGED,{prevState:this.currentState_,state:gc.DISCONNECTED}),this.currentState_=gc.DISCONNECTED,this.addTransportEvent("disconnected"))}},{key:"hitTest",value:function(e){return(0===e||"0"===e)&&this.isUplink_||e===this.tinyId_}},{key:"updateRemoteDescription",value:function(e){var t=this;this.log_.debug("updateRemoteDescription() ".concat(e.sdp));var n=this.peerConnection_.remoteDescription.sdp;this.peerConnection_.setRemoteDescription(e).then(lt(regeneratorRuntime.mark(function r(){var i,o,a,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(vd({eventType:vc.SET_REMOTE_DESCRIPTION,kind:"offer"}),t.log_.info("updateRemoteDescription success"),"unified-plan"===t.sdpSemantics_?(i=qf(n,e.sdp),t.addRemoteTrack(i.added),t.removeRemoteTrack(i.removed)):t.removeRemoteTrackLegacy(n,e.sdp),(o=t.pendingStreams_.shift())&&(t.log_.debug("mark ".concat(o.getType()," stream exit subscription cycle")),o.setInSubscriptionCycle(!1)),!Vc){r.next=15;break}return r.next=8,t.peerConnection_.createAnswer();case 8:return(a=r.sent).sdp=t.addRRTRLine(a.sdp),r.next=12,t.peerConnection_.setLocalDescription(a);case 12:s=t.peerConnection_.localDescription,t.signalChannel_.send(tc,s,t.tinyId_),t.log_.info("accepted remote offer updated, sending answer");case 15:case"end":return r.stop()}},r)}))).catch(function(e){md({eventType:vc.SET_REMOTE_DESCRIPTION,kind:"offer",error:e}),t.log_.error("updateRemoteDescription failed ".concat(e))})}},{key:"addRemoteTrack",value:function(e){var t=this;this.peerConnection_&&Id()&&e.forEach(function(e){var n=e.mid,r=7===Kf(e.ssrcs[0].id)?cc:lc,i=t.peerConnection_.getReceivers()[n];if(i&&i.track){t.log_.info("add ".concat(i.track.kind," track ").concat(i.track.id));var o=t.remoteStreams_.get(r);if(o)o.getMediaStream().addTrack(i.track),"audio"===i.track.kind?o.setHasAudio(!0):(o.setHasVideo(!0),t.setVideoStats("start")),t.emitter_.emit(Yd.STREAM_UPDATED,{stream:o});else{t.log_.debug("remoteStream for msid:".concat(r," not exist"));var a=new MediaStream;a.addTrack(i.track),(o=new Pf({type:r===lc?"main":"auxiliary",userId:t.userId_,client:t.client_})).setMediaStream(a),o.setConnection(t),t.remoteStreams_.set(r,o),"audio"===i.track.kind?o.setHasAudio(!0):o.setHasVideo(!0),t.emitter_.emit("stream-added",{stream:o})}}})}},{key:"removeRemoteTrack",value:function(e){var t=this;e.forEach(function(e){var n=Kf(e.ssrcs[0].id),r=2===n?"video":7===n?"auxVideo":"audio";t.log_.info("[".concat(r,"] track was removed"));var i="auxVideo"===r?cc:lc,o=t.remoteStreams_.get(i);o&&(i!==cc&&0!==o.getMediaStream().getTracks().length||o.isInSubscriptionCycle()?("audio"===r?o.setHasAudio(!1):(o.setHasVideo(!1),t.setVideoStats("end")),t.emitter_.emit(Yd.STREAM_UPDATED,{stream:o})):(t.log_.info("remote stream ".concat(i," removed")),t.remoteStreams_.delete(i),t.emitter_.emit(Yd.STREAM_REMOVED,{stream:o})))})}},{key:"removeRemoteTrackLegacy",value:function(e,t){var n=this,r=Hf(e).media,i=Hf(t).media;r.filter(function(e){var t,r=i.find(function(t){return t.type===e.type}),o=2;if("audio"===e.type)void 0!==r&&void 0!==r.ssrcs||!e.ssrcs||(n.log_.info("[audio] track was removed"),(t=n.remoteStreams_.get(o))&&(0===t.getMediaStream().getTracks().length?t.isInSubscriptionCycle()||(n.log_.info("remote stream ".concat(o," removed")),n.remoteStreams_.delete(o),n.emitter_.emit(Yd.STREAM_REMOVED,{stream:t})):(t.setHasAudio(!1),n.emitter_.emit(Yd.STREAM_UPDATED,{stream:t}))));else if((void 0===r||void 0===r.ssrcs)&&e.ssrcs||r.ssrcGroups&&e.ssrcGroups&&r.ssrcGroups.length<e.ssrcGroups.length){var a=!1,s=!1;void 0===r.ssrcs&&2===e.ssrcGroups.length?(n.log_.info("[main & aux video] tracks were removed"),a=!0,s=!0):void 0===r.ssrcs&&1===e.ssrcGroups.length?(n.log_.info("[main video] track was removed"),a=!0):e.ssrcGroups.length>r.ssrcGroups.length&&(n.log_.info("[auxiliary video] track was removed"),s=!0),s&&(o=cc,n.log_.info("remote stream ".concat(o," removed")),(t=n.remoteStreams_.get(o))&&!t.isInSubscriptionCycle()&&(n.remoteStreams_.delete(o),n.emitter_.emit(Yd.STREAM_REMOVED,{stream:t}))),a&&(o=lc,(t=n.remoteStreams_.get(o))&&(0===t.getMediaStream().getTracks().length?t.isInSubscriptionCycle()||(n.log_.info("remote stream ".concat(o," removed")),n.remoteStreams_.delete(o),n.emitter_.emit(Yd.STREAM_REMOVED,{stream:t})):(n.setVideoStats("end"),t.setHasVideo(!1),n.emitter_.emit(Yd.STREAM_UPDATED,{stream:t}))))}})}},{key:"setRemoteOffer",value:function(e){var t=this;return this.peerConnection_.setRemoteDescription(e).then(function(){return vd({eventType:vc.SET_REMOTE_DESCRIPTION,kind:"offer"}),t.peerConnection_.createAnswer()}).then(function(e){return e.sdp=t.addRRTRLine(e.sdp),e.sdp=t.addSPSDescription(e.sdp),t.peerConnection_.setLocalDescription(e)}).then(function(){var e=t.peerConnection_.localDescription;t.signalChannel_.send(tc,e,t.tinyId_),t.log_.info("accepted remote offer and acknowledged answer")}).catch(function(e){md({eventType:vc.SET_REMOTE_DESCRIPTION,kind:"offer",error:e}),t.log_.error("failed to accept remote offer "+e)})}},{key:"setMutedState",value:function(e,t){if(this.isUplink_){"audio"===e?t?this.mutedState_|=4:this.mutedState_&=-5:t?this.mutedState_|=1:this.mutedState_&=-2;var n={srctinyid:0,userid:this.userId_,flag:this.mutedState_};this.log_.info("set ".concat(e," muted state: [").concat(t?"mute":"unmute","]")),this.signalChannel_.send("on_change_av_state",n)}}},{key:"onSubscription",value:function(e){var t=e.data.content,n=t.srctinyid;if(this.hitTest(n)){var r=0===t.errCode,i=this.pendingSubscription_.shift();if(void 0!==i){this.subscriptionRetryCount_=0,this.isSubscriptionPending_=!1,-1!==this.subscriptionTimeout_&&(clearTimeout(this.subscriptionTimeout_),this.subscriptionTimeout_=-1);var o=i.stream;this.log_.info("".concat(o.getType()," stream ").concat(i.type," result: ").concat(r?"success":"failure"," errCode: ").concat(t.errCode)),i.callback({code:t.errCode}),r&&"subscribe"===i.type&&this.emitter_.emit(Yd.STREAM_SUBSCRIBED,{stream:o})}if(this.pendingSubscription_.length>0){var a=this.pendingSubscription_[0];this.log_.info("schedule a pending subscription"),this.doSendSubscription(a.data,a.stream)}}}},{key:"subscribe",value:function(e,t){var n=this;return new Promise(function(r,i){if(void 0===t||"main"===e.getType()&&void 0!==t.audio&&void 0!==t.video&&t.audio===n.subscribeState_.audio&&t.video===n.subscribeState_.video||"auxiliary"===e.getType()&&void 0!==t.video&&n.subscribeState_.auxiliary===t.video)return n.emitter_.emit(Yd.STREAM_SUBSCRIBED,{stream:e,result:!0}),r();var o,a;"main"===e.getType()?(void 0!==t.audio&&(!1===n.subscribeState_.audio&&!0===t.audio&&(n.needToRebuildConnection_=!0),n.subscribeState_.audio=t.audio),void 0!==t.video&&(n.subscribeState_.video=t.video),n.subscribeState_.audio?(o=32777,a="subscribe audio"):(o=32779,a="unsubscribe audio"),n.addEventInternal(o,a),n.subscribeState_.video?(o=32776,a="subscribe video"):(o=32778,a="unsubscribe video"),n.addEventInternal(o,a)):void 0!==t.video&&(n.subscribeState_.auxiliary=t.video),n.log_.info("subscribe ".concat(e.getType()," stream with options ").concat(JSON.stringify(t)," current state: ").concat(JSON.stringify(n.subscribeState_))),n.sendSubscription(e,"subscribe",function(e){var t=e.code;if(0===t)r();else{var o=new oc({code:t,message:"failed to subscribe remote stream"});n.log_.error(o),i(o)}})})}},{key:"unsubscribe",value:function(e){var t=this;return new Promise(function(n,r){"main"===e.getType()?(t.subscribeState_.audio=!1,t.subscribeState_.video=!1):t.subscribeState_.auxiliary=!1,t.log_.info("unsubscribe ".concat(e.getType()," stream with ").concat(JSON.stringify(t.subscribeState_))),t.sendSubscription(e,"unsubscribe",function(e){var i=e.code;if(0===i)n();else{var o=new oc({code:i,message:"failed to unsubscribe remote stream"});t.log_.error(o),r(o)}}),t.addEventInternal(32779,"unsubscribe audio"),t.addEventInternal(32778,"unsubscribe video")})}},{key:"addEventInternal",value:function(e,t){var n=this.client_.getUserId(),r={eventId:e,eventDesc:t,timestamp:bo(),userId:n,tinyId:this.client_.getTinyId()};this.isUplink_||(r.remoteUserId=this.userId_,r.remoteTinyId=this.tinyId_),sc(n,r)}},{key:"addTransportEvent",value:function(e){"connected"===e?this.addEventInternal(32793,"ice transport is connected"):this.addEventInternal(32792,"ice transport is disconnected")}},{key:"sendSubscription",value:function(e,t,n){var r={srctinyid:this.tinyId_,userid:this.userId_,audio:this.subscribeState_.audio,bigVideo:this.subscribeState_.video,auxVideo:this.subscribeState_.auxiliary};this.pendingSubscription_.length>0?this.log_.debug("queue the subscription for later handling"):this.doSendSubscription(r,e),this.pendingSubscription_.push({stream:e,type:t,data:r,callback:n}),e.setInSubscriptionCycle(!0)}},{key:"doSendSubscription",value:function(e,t){var n=this;"connected"===this.peerConnection_.connectionState||"completed"===this.peerConnection_.connectionState?(t&&this.pendingStreams_.push(t),this.log_.debug("doSendSubscription() send SUBSCRIBE command with data: ".concat(JSON.stringify(e))),this.signalChannel_.send("on_subscribe",e),this.isSubscriptionPending_=!0,this.subscriptionTimeout_=setTimeout(function(){if(n.isSubscriptionPending_)if(n.log_.debug("subscription timeout"),n.subscriptionRetryCount_+=1,n.subscriptionRetryCount_<=3){n.log_.debug("resend subscription");var e=n.pendingSubscription_[0].data;n.doSendSubscription(e)}else n.log_.error("remote server not response to subscription"),n.pendingSubscription_.shift(),n.pendingStreams_.shift(),n.isSubscriptionPending_=!1,n.subscriptionRetryCount_=0,n.emitter_.emit(Yd.ERROR,new oc({code:rc.SUBSCRIPTION_TIMEOUT,message:"remote server not response to subscription"}))},5e3)):this.log_.debug("try to send subscription when connectionState ".concat(this.peerConnection_.connectionState))}},{key:"getPeerConnection",value:function(){return this.peerConnection_}},{key:"getUserId",value:function(){return this.userId_}},{key:"getTinyId",value:function(){return this.tinyId_}},{key:"setVideoStats",value:function(e){"start"===e?(this.hasVideo_=!0,this.startTime_=new Date,this.hasValidEndTime_=!1):(this.hasVideo_=!1,this.endTime_=new Date,this.hasValidEndTime_=!0)}},{key:"getVideoHealthStats",value:(t=lt(regeneratorRuntime.mark(function e(){var t,n,r,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasValidEndTime_||(this.endTime_=new Date),t=(this.endTime_-this.startTime_)/1e3,n=!1,r=0,i=0,o=0,!this.hasVideo_){e.next=21;break}if(n=!0,!this.isUplink_){e.next=15;break}return e.next=11,(new of).getSenderStats(this);case 11:a=e.sent,r=a.video.framesSent/t,e.next=19;break;case 15:return e.next=17,(new of).getReceiverStats(this);case 17:a=e.sent,r=a.video.framesDecoded/t;case 19:i=a.video.frameWidth,o=a.video.frameHeight;case 21:return e.abrupt("return",{valid:n,framerate:r,duration:t,width:i,height:o});case 22:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"setRemoteStream",value:function(e,t){this.remoteStreams_.set(e,t)}},{key:"getSubscribeState",value:function(){return this.subscribeState_}},{key:"clearConnectTimer",value:function(){-1!==this.connectTimer_&&(clearTimeout(this.connectTimer_),this.connectTimer_=-1)}},{key:"on",value:function(e,t){this.emitter_.on(e,t)}}]),e}(),Jf=function(e){function t(e){var n;return ct(this,t),(n=bt(this,vt(t).call(this,e))).isReconnecting_=!1,n.reconnectionCount_=0,n.reconnectionTimer_=-1,n.isFirstConnection_=!0,n.onReceivedCloseACK=lt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.close(),n.initialize(),e.next=4,n.publish(n.localStream_);case 4:case"end":return e.stop()}},e)})),n.emitter_.on(Yd.ERROR,function(e){e.getCode()===rc.ICE_TRANSPORT_ERROR&&(n.isFirstConnection_&&(n.isFirstConnection_=!1,md({eventType:vc.UPLINK_CONNECTION,error:e})),n.isReconnecting_||(n.isReconnecting_=!0,_f.report(fc.UPLINK_RECONNECTION,{value:pc}),n.reconnect()))}),n.emitter_.on(Yd.CONNECTION_STATE_CHANGED,function(e){e.state===gc.CONNECTED&&(n.isFirstConnection_&&(n.isFirstConnection_=!1,_f.report(fc.UPLINK_CONNECTION,{value:hc}),vd({eventType:vc.UPLINK_CONNECTION})),n.isReconnecting_&&(_f.report(fc.UPLINK_RECONNECTION,{value:hc}),vd({eventType:vc.UPLINK_RECONNECTION}),n.log_.warn("reconnect() uplink reconnect successfully"),n.stopReconnection()))}),n}var n;return gt(t,Yf),ft(t,[{key:"getIsReconnecting",value:function(){return this.isReconnecting_}},{key:"reconnect",value:(n=lt(regeneratorRuntime.mark(function e(){var t,n,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===this.reconnectionTimer_){e.next=3;break}return this.log_.warn("reconnect() uplink is reconnecting, ignore current reconnection"),e.abrupt("return");case 3:if(!(this.reconnectionCount_>=30)){e.next=10;break}return this.log_.warn("SDK has tried reconnect uplink for ".concat(30," times, but all failed, please check your network")),this.stopReconnection(),t=new oc({code:rc.UPLINK_RECONNECTION_FAILED,message:"uplink reconnect failed, please check your network and publish again"}),md({eventType:vc.UPLINK_RECONNECTION,error:t}),this.emitter_.emit(Yd.ERROR,t),e.abrupt("return");case 10:if(this.signalChannel_.getCurrentState()===Zl.CONNECTED){e.next=14;break}return this.log_.warn("reconnect() signal channel is not connected, suspend reconnection until signal is connected"),this.signalChannel_.once(Xl,function(){r.reconnect()}),e.abrupt("return");case 14:this.reconnectionCount_++;try{this.log_.warn("reconnect() try to reconnect uplink [".concat(this.reconnectionCount_,"/").concat(30,"]")),n=cd(this.reconnectionCount_),this.reconnectionTimer_=setTimeout(function(){r.log_.warn("reconnect() uplink reconnect timeout(".concat(n/1e3,"s), try again")),r.signalChannel_.off(ec.CLOSE_PEER_ACK,r.onReceivedCloseACK),r.clearReconnectionTimer(),r.reconnect()},n),this.signalChannel_.send(nc),this.signalChannel_.once(ec.CLOSE_PEER_ACK,this.onReceivedCloseACK)}catch(e){}case 16:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"clearReconnectionTimer",value:function(){-1!==this.reconnectionTimer_&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}},{key:"stopReconnection",value:function(){this.log_.info("stop uplink reconnection"),this.isReconnecting_=!1,this.reconnectionCount_=0,this.clearReconnectionTimer()}}]),t}(),Xf=function(e){function t(e){var n;return ct(this,t),(n=bt(this,vt(t).call(this,e))).isReconnecting_=!1,n.reconnectionCount_=0,n.reconnectionTimer_=-1,n.isFirstConnection_=!0,n.emitter_.on(Yd.ERROR,function(e){if(e.getCode()===rc.ICE_TRANSPORT_ERROR&&(n.isFirstConnection_&&(n.isFirstConnection_=!1,md({eventType:vc.DOWNLINK_CONNECTION,error:e})),!n.isReconnecting_)){n.isReconnecting_=!0,_f.report(fc.DOWNLINK_RECONNECTION,{value:pc});var t=n.client_.getSubscriptionManager();t&&t.setAutoRecoveryFlag(n.userId_),n.reconnect()}}),n.emitter_.on(Yd.CONNECTION_STATE_CHANGED,function(e){e.state===gc.CONNECTED&&(n.isFirstConnection_&&(n.isFirstConnection_=!1,_f.report(fc.DOWNLINK_CONNECTION,{value:hc}),vd({eventType:vc.DOWNLINK_CONNECTION})),n.isReconnecting_&&(_f.report(fc.DOWNLINK_RECONNECTION,{value:hc}),vd({eventType:vc.DOWNLINK_RECONNECTION}),n.log_.warn("reconnect() downlink reconnect successfully"),n.stopReconnection()))}),n.signalChannel_.on(ec.PEER_JOIN,function(e){if(n.isReconnecting_){var t=e.data.content,r=t.srcopenid,i=t.remoteoffer;r===n.userId_&&n.onReceiveOfferSDP(i)}}),n}return gt(t,Yf),ft(t,[{key:"reconnect",value:function(){var e=this;if(-1===this.reconnectionTimer_){if(this.reconnectionCount_>=30){this.log_.warn("SDK has tried reconnect downlink [".concat(this.userId_,"] for ").concat(30," times, but all failed, please check your network")),this.stopReconnection();var t=new oc({code:rc.DOWNLINK_RECONNECTION_FAILED,message:"downlink reconnect failed, please check your network and re-join room"});return md({eventType:vc.DOWNLINK_RECONNECTION,error:t}),void this.emitter_.emit(Yd.ERROR,t)}if(this.signalChannel_.getCurrentState()!==Zl.CONNECTED)return this.log_.warn("reconnect() signal channel is not connected, suspend reconnection until signal is connected"),void this.signalChannel_.once(Xl,function(){e.reconnect()});this.reconnectionCount_++,this.log_.warn("reconnect() try to reconnect downlink [".concat(this.reconnectionCount_,"/").concat(30,"]"));var n=cd(this.reconnectionCount_);this.reconnectionTimer_=setTimeout(function(){e.log_.warn("reconnect() downlink [".concat(e.userId_,"] reconnect timeout(").concat(n/1e3,"s), try again")),e.clearReconnectionTimer(),e.reconnect()},n),this.signalChannel_.send("on_recreate_down_peerc",{srctinyid:this.tinyId_})}else this.log_.warn("reconnect() downlink is reconnecting, ignore current reconnection")}},{key:"onReceiveOfferSDP",value:function(e){this.log_.info("accept downlink offer sdp, clear downlink status"),this.clearReconnectionTimer(),this.peerConnection_&&(this.peerConnection_.onconnectionstatechange=function(){},this.peerConnection_.close(),this.peerConnection_=null),this.subscribeState_={audio:!0,video:!0,auxiliary:!0},this.sentSubscriptionAfterConnected_=!1,this.remoteStreams_.forEach(function(e){e.setConnection(null)}),this.remoteStreams_.clear(),this.uninstallSignalChannelEvents(),this.initialize(),this.setRemoteOffer(e)}},{key:"getIsReconnecting",value:function(){return this.isReconnecting_}},{key:"clearReconnectionTimer",value:function(){-1!==this.reconnectionTimer_&&(clearTimeout(this.reconnectionTimer_),this.reconnectionTimer_=-1)}},{key:"stopReconnection",value:function(){this.log_.info("stop downlink reconnection"),this.isReconnecting_=!1,this.reconnectionCount_=0,this.clearReconnectionTimer()}}]),t}(),Qf=function(){function e(t){if(ct(this,e),this.mode_=t.mode,this.sdpSemantics_="plan-b",void 0!==t.sdpSemantics?this.sdpSemantics_=t.sdpSemantics:xd()&&(this.sdpSemantics_="unified-plan"),this.sdkAppId_=t.sdkAppId,this.userId_=t.userId,this.log_=new af({id:"c|"+this.userId_,direction:"local",type:""}),this.userSig_=t.userSig,this.roomId_=0,this.useStringRoomId_=t.useStringRoomId,this.recordId_=null,this.pureAudioPushMode_=null,this.version_=t.version,this.log_.info("using sdpSemantics: "+this.sdpSemantics_),Un.setConfig({sdkAppId:this.sdkAppId_,userId:this.userId_,version:this.version_}),void 0!==t.recordId){if(!Number.isInteger(Number(t.recordId)))throw new oc({code:rc.INVALID_PARAMETER,message:"recordId must be an integer number"});this.recordId_=t.recordId}var n;this.disableReceiver_=!1,this.signalChannel_=null,this.isScreenShareOnly_=0,void 0!==t.isScreenShareOnly&&(this.isScreenShareOnly_=t.isScreenShareOnly?1:0),this.role_="anchor",this.privateMapKey_="",this.tinyId_=0,this.env_="",this.proxy_=null,this.turnServer_=null,this.connections_=new Map,this.connectionsRefreshCount_=new Map,this.pendingRefresh_=new Map,this.mutedStates_=new Map,this.localStream_=null,this.isPublishing_=!1,this.isUplinkClosing_=!1,this.uplinkConnection_=null,this.emitter_=new Yl,this.signalInfo_={},this.isSignalReady_=!1,this.isJoined_=!1,this.heartbeat_=-1,this.stats_=new of,this.joinTimeout_=-1,this.publishTimeout_=-1,this.unpublishTimeout_=-1,this.networkQuality_=null,this.startJoinTimestamp_=new Date,this.joinedTimestamp_=new Date,this.joinOptions={},this.downlinkVideoHealthStats_={},this.uplinkVideoHealthStats_={},this.basis_={browser:Vd().name+"/"+Vd().fullVersion,os:(Pd.any()?{osName:Pd.getOsName()}:function(){for(var e,t=navigator.appVersion,n=navigator.userAgent,r="-",i=[{s:"Chrome OS",r:/CrOS/},{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],o=0;e=i[o];o++)if(e.r.test(n)){r=e.s;break}var a="-";switch(/Windows/.test(r)&&(/Windows (.*)/.test(r)&&(a=/Windows (.*)/.exec(r)[1]),r="Windows"),r){case"Mac OS X":/Mac OS X (10[._\d]+)/.test(n)&&(a=/Mac OS X (10[._\d]+)/.exec(n)[1]);break;case"Android":/Android ([._\d]+)/.test(n)&&(a=/Android ([._\d]+)/.exec(n)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(n)&&(a=(a=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))[1]+"."+a[2]+"."+(0|a[3]))}return{osName:r+a}}()).osName,displayResolution:qd(),isScreenShareSupported:Cd(),isWebRTCSupported:Hd(),isGetUserMediaSupported:zd(),isWebAudioSupported:(n={isSupported:!1,isCreateMediaStreamSourceSupported:!1},["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){n.isSupported||e in window&&(n.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(n.isCreateMediaStreamSourceSupported=!0))}),n.isSupported),isWebSocketsSupported:"WebSocket"in window&&2===window.WebSocket.CLOSING},this.initBussinessInfo_(t)}var t,n,r,i,o,a,s,u,l,c,d,f,p,h,g,v;return ft(e,[{key:"initBussinessInfo_",value:function(e){this.bussinessInfo_=e.bussinessInfo;var t={};if("string"==typeof e.bussinessInfo&&(t=JSON.parse(e.bussinessInfo)),void 0!==e.pureAudioPushMode){if(!Number.isInteger(Number(e.pureAudioPushMode)))throw new oc({code:rc.INVALID_PARAMETER,message:"pureAudioPushMode must be an integer number"});this.pureAudioPushMode_=e.pureAudioPushMode,t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.pure_audio_push_mod=this.pureAudioPushMode_}if(void 0!==e.streamId){if(!("string"==typeof e.streamId&&String(e.streamId)&&String(e.streamId).length<=64))throw new oc({code:rc.INVALID_PARAMETER,message:"streamId must be a sting literal within 64 bytes, and not be empty"});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_streamid_main=e.streamId}if(void 0!==e.userDefineRecordId){if(null===e.userDefineRecordId.match(/^[A-Za-z0-9_-]{1,64}$/gi))throw new oc({code:rc.INVALID_PARAMETER,message:"userDefineRecordId must be a sting literal contains (a-zA-Z),(0-9), underline and hyphen, within 64 bytes, and not be empty"});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_record_id=e.userDefineRecordId}if(void 0!==e.userDefinePushArgs){if(!("string"==typeof e.userDefinePushArgs&&String(e.userDefinePushArgs)&&String(e.userDefinePushArgs).length<=256))throw new oc({code:rc.INVALID_PARAMETER,message:"userDefinePushArgs must be a sting literal within 256 bytes, and not be empty"});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_push_args=e.userDefinePushArgs}_d(t)||(this.bussinessInfo_=JSON.stringify(t))}},{key:"setProxyServer",value:function(e){if(!e.startsWith("wss://"))throw new oc({code:rc.INVALID_PARAMETER,message:'proxy server url shall be started with "wss://"'});this.proxy_=e}},{key:"getUrl",value:function(e){var t=ud(e);return!sd()&&this.proxy_&&(t=this.proxy_),t}},{key:"getBackupUrl",value:function(){return this.proxy_?this.proxy_:ud("wss://bk.rtc.qq.com:8687")}},{key:"getUserId",value:function(){return this.userId_}},{key:"getTinyId",value:function(){return this.tinyId_}},{key:"setTurnServer",value:function(e){this.turnServer_={},this.turnServer_.urls="turn:"+e.url,void 0!==e.username&&void 0!==e.credential&&(this.turnServer_.username=e.username,this.turnServer_.credential=e.credential,this.turnServer_.credentialType="password",void 0!==e.credentialType&&(this.turnServer_.credentialType=e.credentialType))}},{key:"initialize",value:function(){var e=this;return new Promise(function(t,n){e.log_.info("setup signal channel"),e.signalChannel_=new bd({sdkAppId:e.sdkAppId_,userId:e.userId_,userSig:e.userSig_,url:e.getUrl("wss://qcloud.rtc.qq.com:8687"),backupUrl:e.getUrl("wss://bk.rtc.qq.com:8687"),version:e.version_}),e.networkQuality_||(e.networkQuality_=new sf({connnections:e.connections_,signalChannel:e.signalChannel_,userId:e.userId_}),e.networkQuality_.on(ef,function(t){e.emitter_.emit(ef,t)})),e.deviceDetector_||(e.deviceDetector_=new uf),e.subscriptionManager_||(e.subscriptionManager_=new Sf({client:e})),e.signalChannel_.on(Jl,function(t){switch(e.log_.info("SignalChannel state changed from ".concat(t.prevState," to ").concat(t.state)),t.state){case Zl.CONNECTING:_f.report(fc.SIGNAL_CONNECTION,{value:pc});break;case Zl.CONNECTED:t.prevState===Zl.RECONNECTING?(e.log_.warn("signal channel reconnect successfully"),_f.report(fc.SIGNAL_RECONNECTION,{value:hc}),vd({eventType:vc.SIGNAL_RECONNECTION})):t.prevState===Zl.CONNECTING&&(_f.report(fc.SIGNAL_CONNECTION,{value:hc}),vd({eventType:vc.SIGNAL_CONNECTION}));break;case Zl.RECONNECTING:t.prevState===Zl.CONNECTED&&_f.report(fc.SIGNAL_RECONNECTION,{value:pc})}e.emitter_.emit("connection-state-changed",t)}),e.signalChannel_.on(Ql,function(t){e.isSignalReady_?(e.closeUplink(),e.closeConnections(),e.emitter_.emit(tf,t)):n(t)}),e.signalChannel_.on(ec.CHANNEL_SETUP_FAILED,function(t){e.log_.error("signal channel setup failed"),n(t)}),e.signalChannel_.on(ec.CHANNEL_SETUP_SUCCESS,function(n){e.signalInfo_=n.signalInfo,e.tinyId_=e.signalInfo_.tinyId,e.isSignalReady_||(e.isSignalReady_=!0,t())}),e.signalChannel_.on(ec.PEER_JOIN,function(t){e.disableReceiver_||e.onPeerJoin(t.data)}),e.signalChannel_.on(ec.PEER_LEAVE,function(t){e.onPeerLeave(t.data)}),e.signalChannel_.on(ec.UPDATE_REMOTE_MUTE_STAT,function(t){e.onUserList(t.data),e.onUpdateRemoteMuteStat(t.data)}),e.signalChannel_.on(ec.CLINET_BANNDED,function(){var t=lt(regeneratorRuntime.mark(function t(n){var r,i,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.data.content,t.next=3,e.reset();case 3:"banned"===r.type?(i="you got banned by account admin",e.log_.error("user was banned because of "+i),e.onClientBanned(i)):"kick"===r.type?(o="duplicated userId joining the room",e.log_.error("user was banned because of "+o),e.onClientBanned(o)):(e.log_.error("Relay server timeout observed [".concat(r.type,"]")),e.emitter_.emit(tf,new oc({code:rc.SERVER_TIMEOUT,message:"Relay server timeout observed"})));case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),e.signalChannel_.on(ec.REQUEST_REBUILD_SESSION,function(t){e.signalInfo_=t.signalInfo;var n=[];e.connections_&&n.push(0);var r=[],i=!0,o=!1,a=void 0;try{for(var s,u=e.connections_[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=kt(s.value,2),c=l[0],d=l[1];n.push(c);var f=d.getPeerConnection().remoteDescription;f&&r.push(f.sdp)}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}var p={socketid:e.signalInfo_.socketId,tinyid:e.tinyId_,appid:e.sdkAppId_,openid:e.userId_,sessionid:String(e.roomId_),sids:n,relayInfo:e.signalInfo_.relayInnerIp,remotesdp:r};e.log_.debug("reconnect - rebuild session with data: ".concat(JSON.stringify(p))),e.signalChannel_.send("on_rebuild_session",p)}),e.signalChannel_.on(ec.CLIENT_REJOIN,function(){var t=lt(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.reJoin();case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),e.signalChannel_.connect()})}},{key:"join",value:(v=lt(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(kd()&&Ed()){e.next=2;break}throw new oc({code:rc.NOT_SUPPORTED,message:"the browser does NOT support WebRTC!"});case 2:return _f.report(fc.JOIN,{value:pc}),this.joinOptions=t,this.startJoinTimestamp_=new Date,(n=sd())||(n="qcloud",this.proxy_&&(this.proxy_.startsWith("wss://trtc.rtc.qq.com")?n="trtc":this.proxy_.startsWith("wss://webrtc.qq.com")&&(n="webrtc"))),this.env_=n,r=Vd(),fd({env:n,sdkAppId:this.sdkAppId_,userId:this.userId_,version:this.version_,browserVersion:r.name+r.version,ua:navigator.userAgent}),sc(this.userId_,{eventId:32788,eventDesc:"joining room",timestamp:bo(),userId:this.userId_,tinyId:this.tinyId_}),e.prev=11,e.next=14,this.initialize();case 14:e.next=20;break;case 16:throw e.prev=16,e.t0=e.catch(11),md({eventType:vc.JOIN,error:e.t0}),e.t0;case 20:return e.prev=20,e.next=23,this.doJoin(t);case 23:e.next=29;break;case 25:throw e.prev=25,e.t1=e.catch(20),md({eventType:vc.JOIN,error:e.t1}),e.t1;case 29:_f.report(fc.JOIN,{value:hc}),this.joinedTimestamp_=new Date,i=this.joinedTimestamp_-this.startJoinTimestamp_,vd({eventType:vc.DELTA_JOIN,delta:i}),vd({eventType:vc.JOIN}),this.uploadTrtcStats();case 35:case"end":return e.stop()}},e,this,[[11,16],[20,25]])})),function(e){return v.apply(this,arguments)})},{key:"uploadTrtcStats",value:(g=lt(regeneratorRuntime.mark(function e(){var t,n,r,i,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="undefined",n="undefined",e.prev=2,e.next=5,Kd();case 5:r=e.sent,t=r&&r.length,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),t="undefined";case 12:return e.prev=12,e.next=15,Wd();case 15:i=e.sent,n=i&&i.length,e.next=22;break;case 19:e.prev=19,e.t1=e.catch(12),n="undefined";case 22:o={microphone:t,camera:n},a={webRTC:this.basis_.isWebRTCSupported,getUserMedia:this.basis_.isGetUserMediaSupported,webSocket:this.basis_.isWebSocketsSupported,screenShare:this.basis_.isScreenShareSupported,webAudio:this.basis_.isWebAudioSupported},s={browser:this.basis_.browser,os:this.basis_.os,trtc:a,devices:o},pd("trtcstats-"+JSON.stringify(s)),this.log_.info("TrtcStats-"+JSON.stringify(s));case 27:case"end":return e.stop()}},e,this,[[2,9],[12,19]])})),function(){return g.apply(this,arguments)})},{key:"getVersion",value:function(){var e=this.version_.split(".");return 1e3*parseInt(e[0])+100*parseInt(e[1])+parseInt(e[2])}},{key:"doJoin",value:function(e){var t=this;return new Promise(function(n,r){if(!t.isSignalReady_)throw new oc({code:rc.INVALID_OPERATION,message:"SignalChannel is not ready yet"});if(t.isJoined_)throw new oc({code:rc.INVALID_OPERATION,message:"duplicate join() called"});t.roomId_=e.roomId,void 0!==e.role&&(t.role_=e.role);var i="";void 0!==e.privateMapKey&&(i=e.privateMapKey),t.privateMapKey_=i,t.log_.info("Join() => joining room: ".concat(e.roomId," mode: ").concat(t.mode_," role: ").concat(t.role_));var o,a=t.signalInfo_,s={openid:a.openId,tinyid:a.tinyId,peerconnectionport:"",useStrRoomid:!!t.useStringRoomId_&&1,roomid:String(e.roomId),sdkAppID:String(t.sdkAppId_),socketid:a.socketId,userSig:t.userSig_,privMapEncrypt:i,privMap:"",relayip:a.relayInnerIp,dataport:a.dataPort,stunport:a.stunPort,checkSigSeq:a.checkSigSeq,pstnBizType:0,pstnPhoneNumber:null,recordId:t.recordId_,role:"user",jsSdkVersion:String(t.getVersion()),sdpSemantics:t.sdpSemantics_,browserVersion:id,closeLocalMedia:!0,trtcscene:"live"===t.mode_?2:1,trtcrole:"anchor"===t.role_?20:21,bussinessInfo:t.bussinessInfo_,isAuxUser:t.isScreenShareOnly_};t.joinTimeout_=setTimeout(function(){t.log_.error("join room timeout observed  https://trtc-1252463788.file.myqcloud.com/web/docs/tutorial-10-error-code-tips.html"),r(new oc({code:rc.JOIN_ROOM_FAILED,message:"join room timeout"}))},5e3),t.signalChannel_.sendWithReport("on_create_room",s,(o=0,navigator&&navigator.connection&&navigator.connection.effectiveType&&(o="4g"===navigator.connection.effectiveType?1:4),navigator&&navigator.connection&&navigator.connection.type&&("wifi"===navigator.connection.type?o=1:"cellular"===navigator.connection.type&&(o=4)),{AbilityOption:{GeneralLimit:{CPULimit:{uint32_CPU_num:String(navigator.hardwareConcurrency||0),str_CPU_name:String(navigator.platform),uint32_CPU_maxfreq:String(0),model:"",uint32_total_memory:String(0)},uint32_terminal_type:String(Bc?4:Fc?2:Uc?3:td?12:ed?5:nd?13:1),uint32_device_type:String(0),str_os_verion:Bc?"Android":Fc?"iPhone":Uc?"iPad":td?"Mac":ed?"Windows":nd?"Linux":"unknown",uint32_link_type:String(1),str_client_version:"4.7.0",uint32_net_type:String(o),ua:navigator.userAgent,version:""}}})),t.signalChannel_.once(ec.JOIN_ROOM_RESULT,function(e){clearTimeout(t.joinTimeout_),t.joinTimeout_=-1;var i=e.data.content.ret;i?(t.log_.error("Join room failed result: "+i+" error: "+e.data.content.error),r(new oc({code:rc.JOIN_ROOM_FAILED,extraCode:i,message:"Failed to join room - "+e.data.content.error}))):(t.isJoined_=!0,t.log_.info("Join room success, start heartbeat"),t.startHeartbeat(),n())})})}},{key:"connectSignalBeforeReJoin",value:function(){var e=this;return new Promise(function(t,n){e.log_.warn("connectSignalBeforeReJoin() try to connect signal before reJoin"),e.isSignalReady_=!1,e.signalChannel_.close(),e.signalChannel_.once(ec.CHANNEL_SETUP_SUCCESS,function(n){e.log_.warn("connectSignalBeforeReJoin() signal setup successfully"),t()}),e.signalChannel_.once(Ql,function(t){e.log_.warn("connectSignalBeforeReJoin() signal setup failed"),n(t)}),e.signalChannel_.connect()})}},{key:"reJoin",value:(h=lt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isJoined_){e.next=3;break}return this.log_.warn("reJoin() you haven't join room yet, abort reJoin"),e.abrupt("return");case 3:return this.isJoined_=!1,e.prev=4,this.log_.warn("reJoin() try to reJoin room: ".concat(this.joinOptions.roomId)),this.subscriptionManager_&&this.subscriptionManager_.markAllStream(),e.next=9,this.connectSignalBeforeReJoin();case 9:return e.next=11,this.doJoin(this.joinOptions);case 11:if(this.log_.warn("reJoin() reJoin successfully"),vd({eventType:vc.REJOIN}),e.prev=13,!this.uplinkConnection_||!this.localStream_||this.uplinkConnection_.getIsReconnecting()){e.next=17;break}return e.next=17,this.republish();case 17:e.next=21;break;case 19:e.prev=19,e.t0=e.catch(13);case 21:e.next=28;break;case 23:e.prev=23,e.t1=e.catch(4),this.log_.warn("reJoin() reJoin failed"+e.t1),md({eventType:vc.REJOIN,error:e.t1}),this.emitter_.emit(tf,new oc({code:rc.JOIN_ROOM_FAILED,message:"reJoin room: ".concat(this.joinOptions.roomId," failed, please check your network")}));case 28:case"end":return e.stop()}},e,this,[[4,23],[13,19]])})),function(){return h.apply(this,arguments)})},{key:"republish",value:(p=lt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.log_.warn("republish() try to re-publish localStream"),t=this.localStream_,e.next=5,this.doUnpublish(t);case 5:return e.next=7,this.publish(t);case 7:this.log_.warn("republish() re-publish localStream successfully"),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),this.log_.warn("republish() re-publish localStream failed "+e.t0),e.t0;case 14:case"end":return e.stop()}},e,this,[[0,10]])})),function(){return p.apply(this,arguments)})},{key:"leave",value:(f=lt(regeneratorRuntime.mark(function e(){var t,n,r,i,o,a,s,u,l,c,d,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return sc(this.userId_,{eventId:32789,eventDesc:"leaving room",timestamp:bo(),userId:this.userId_,tinyId:this.tinyId_}),e.prev=1,e.next=4,this.doHeartbeat();case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:t=!1,n=!0,r=!1,i=void 0,e.prev=12,o=this.connections_[Symbol.iterator]();case 14:if(n=(a=o.next()).done){e.next=24;break}if((s=kt(a.value,2))[0],u=s[1],t){e.next=21;break}return e.next=19,u.getVideoHealthStats();case 19:(l=e.sent).valid&&(t=!0,this.downlinkVideoHealthStats_=l);case 21:n=!0,e.next=14;break;case 24:e.next=30;break;case 26:e.prev=26,e.t1=e.catch(12),r=!0,i=e.t1;case 30:e.prev=30,e.prev=31,n||null==o.return||o.return();case 33:if(e.prev=33,!r){e.next=36;break}throw i;case 36:return e.finish(33);case 37:return e.finish(30);case 38:return c={userAgent:navigator.userAgent},d={uplink:this.uplinkVideoHealthStats_,downlink:this.downlinkVideoHealthStats_},pd("healthstats-"+JSON.stringify(c)),pd("healthstats-"+JSON.stringify(d)),this.log_.info("HealthStats-"+JSON.stringify(d)),e.prev=43,e.next=46,this.doLeave();case 46:e.next=50;break;case 48:e.prev=48,e.t2=e.catch(43);case 50:vd({eventType:vc.LEAVE}),f=Math.floor((new Date-this.joinedTimestamp_)/1e3),vd({eventType:vc.DELTA_LEAVE,delta:f});case 53:case"end":return e.stop()}},e,this,[[1,6],[12,26,30,38],[31,,33,37],[43,48]])})),function(){return f.apply(this,arguments)})},{key:"doLeave",value:function(){var e,t=this;return new Promise((e=lt(regeneratorRuntime.mark(function e(n,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isJoined_){e.next=2;break}return e.abrupt("return",n());case 2:return t.log_.info("leave() => leaving room"),t.signalChannel_.send("on_quit_room"),e.next=6,t.reset();case 6:return e.abrupt("return",n());case 7:case"end":return e.stop()}},e)})),function(t,n){return e.apply(this,arguments)}))}},{key:"clearPublishTimeout",value:function(){-1!==this.publishTimeout_&&(clearTimeout(this.publishTimeout_),this.publishTimeout_=-1)}},{key:"clearUnpublishTimeout",value:function(){this.unpublishTimeout_&&(clearTimeout(this.unpublishTimeout_),this.unpublishTimeout_=-1)}},{key:"clearNetworkQuality",value:function(){this.networkQuality_&&(this.networkQuality_.stop(),this.networkQuality_=null)}},{key:"closeConnections",value:function(){var e=this;this.connections_.forEach(function(t){e.closeDownLink(t.getTinyId())})}},{key:"destroy",value:function(){if(this.isJoined_)throw this.log_.warn("please call leave() before destroy() client"),new oc({code:rc.INVALID_OPERATION,message:"Please call leave() before destory() the client"});this.log_.info("destroying SignalChannel"),this.signalChannel_&&(this.signalChannel_.close(),this.signalChannel_=null)}},{key:"reset",value:(d=lt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopHeartbeat(),this.closeConnections(),this.mutedStates_.clear(),this.clearPublishTimeout(),this.clearUnpublishTimeout(),this.clearNetworkQuality(),this.pendingRefresh_.clear(),e.prev=7,e.next=10,this.closeUplink();case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(7);case 14:this.isJoined_=!1,this.isSignalReady_=!1,this.destroy();case 17:case"end":return e.stop()}},e,this,[[7,12]])})),function(){return d.apply(this,arguments)})},{key:"publish",value:function(e){var t,n=this;return new Promise((t=lt(regeneratorRuntime.mark(function t(r,i){var o,a,s,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Sd.result){t.next=2;break}throw new oc({code:rc.NOT_SUPPORTED,message:"the browser does NOT support TRTC!"});case 2:if(n.isJoined_){t.next=4;break}throw new oc({code:rc.INVALID_OPERATION,message:"please call join() before publish()"});case 4:if("live"!==n.mode_||"audience"!==n.role_){t.next=6;break}throw new oc({code:rc.INVALID_OPERATION,message:'no permission to publish() under live/audience, please call swithRole("anchor") firstly before publish()'});case 6:if(!n.localStream_){t.next=8;break}throw new oc({code:rc.INVALID_OPERATION,message:"duplicate publishing, please unpublish and then re-publish  https://trtc-1252463788.file.myqcloud.com/web/docs/tutorial-10-error-code-tips.html"});case 8:if(!n.isPublishing_){t.next=10;break}throw new oc({code:rc.INVALID_OPERATION,message:"previous publishing is ongoing, please avoid re-publishing  https://trtc-1252463788.file.myqcloud.com/web/docs/tutorial-10-error-code-tips.html"});case 10:return _f.report(fc.PUBLISH,{value:pc}),n.isPublishing_=!0,o=new Date,n.log_.info("publish() => publishing local stream"),a=new Jf({userId:n.userId_,tinyId:n.tinyId_,client:n,isUplink:!0,signalChannel:n.signalChannel_}),_f.report(fc.UPLINK_CONNECTION,{value:pc}),a.initialize(),n.publishTimeout_=setTimeout(function(){n.isPublishing_=!1,a.close(),n.log_.error("failed to publish because of timeout  https://trtc-1252463788.file.myqcloud.com/web/docs/tutorial-10-error-code-tips.html");var e=new oc({code:rc.UNKNOWN,message:"publish timeout"});md({eventType:vc.PUBLISH,error:e}),i(e)},1e4),t.prev=18,t.next=21,a.publish(e);case 21:n.localStream_=t.sent,n.log_.info("local stream publish successfully"),n.clearPublishTimeout(),n.isPublishing_=!1,n.localStream_.setConnection(a),n.uplinkConnection_=a,s=new Date,u=s-o,_f.report(fc.PUBLISH,{value:hc}),vd({eventType:vc.PUBLISH}),vd({eventType:vc.DELTA_PUBLISH,delta:u}),e.hasAudio()&&sc(n.userId_,{eventId:32769,eventDesc:"publish audio track",timestamp:bo(),userId:n.userId_,tinyId:n.tinyId_}),e.hasVideo()&&sc(n.userId_,{eventId:32768,eventDesc:"publish video track",timestamp:bo(),userId:n.userId_,tinyId:n.tinyId_}),n.networkQuality_&&n.networkQuality_.setUplinkConnection(n.uplinkConnection_),n.deviceDetector_&&n.deviceDetector_.setLocalStream(n.localStream_),r(),t.next=47;break;case 39:t.prev=39,t.t0=t.catch(18),n.clearPublishTimeout(),n.isPublishing_=!1,a.close(),n.log_.error("failed to publish stream",t.t0),md({eventType:vc.PUBLISH,error:t.t0}),i(t.t0);case 47:a.on(Yd.ERROR,function(){var e=lt(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.getCode())!==rc.ICE_TRANSPORT_ERROR){e.next=3;break}return e.abrupt("return");case 3:if(r!==rc.UPLINK_RECONNECTION_FAILED){e.next=6;break}return e.next=6,n.closeUplink();case 6:n.emitter_.emit(tf,t);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 48:case"end":return t.stop()}},t,null,[[18,39]])})),function(e,n){return t.apply(this,arguments)}))}},{key:"unpublish",value:function(e){var t=this;return new Promise(function(n,r){if(t.isPublishing_)throw new oc({code:rc.INVALID_OPERATION,message:"unpublish() is being called during publish() is ongoing"});if(e!==t.localStream_)throw new oc({code:rc.INVALID_PARAMETER,message:"stream has not been published yet"});_f.report(fc.UNPUBLISH,{value:pc}),t.log_.info("unpublish() => unpublishing local stream"),t.doUnpublish().then(function(){_f.report(fc.UNPUBLISH,{value:hc}),vd({eventType:vc.UNPUBLISH}),n()}).catch(function(e){md({eventType:vc.UNPUBLISH,error:e}),r(e)})})}},{key:"doUnpublish",value:function(){var e=this;return new Promise(function(t,n){e.signalChannel_.send(nc),e.unpublishTimeout_=setTimeout(lt(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.log_.warn("unpublish() timeout observed"),t.next=3,e.closeUplink();case 3:return r=new oc({code:rc.UNKNOWN,message:"unpublish timeout"}),t.abrupt("return",n(r));case 5:case"end":return t.stop()}},t)})),5e3),e.signalChannel_.once(ec.CLOSE_PEER_ACK,function(){var n=lt(regeneratorRuntime.mark(function n(r){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.clearUnpublishTimeout(),e.log_.info("received CLOSE_PEER_ACK, close uplink connection"),n.next=4,e.closeUplink();case 4:return n.abrupt("return",t());case 5:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}())})}},{key:"closeUplink",value:(c=lt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isUplinkClosing_){e.next=3;break}return this.log_.warn("uplink is closing, abort current closeUplink request"),e.abrupt("return");case 3:if(this.isUplinkClosing_=!0,!this.uplinkConnection_){e.next=17;break}return e.next=7,this.uplinkConnection_.getVideoHealthStats();case 7:this.uplinkVideoHealthStats_=e.sent,this.uplinkConnection_.getIsReconnecting()&&this.uplinkConnection_.stopReconnection(),this.uplinkConnection_.close(),this.uplinkConnection_=null,this.networkQuality_&&this.networkQuality_.setUplinkConnection(null),this.localStream_.hasAudio()&&sc(this.userId_,{eventId:32771,eventDesc:"unpublish audio track",timestamp:bo(),userId:this.userId_,tinyId:this.tinyId_}),this.localStream_.hasVideo()&&sc(this.userId_,{eventId:32770,eventDesc:"unpublish video track",timestamp:bo(),userId:this.userId_,tinyId:this.tinyId_}),this.localStream_.setConnection(null),this.localStream_=null,this.deviceDetector_&&this.deviceDetector_.setLocalStream(null);case 17:this.isUplinkClosing_=!1;case 18:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"closeDownLink",value:function(e){var t=this.connections_.get(e);t&&(t.getIsReconnecting()&&t.stopReconnection(),this.subscriptionManager_&&this.subscriptionManager_.delete(t.getUserId()),t.close(),this.connections_.delete(e),this.mutedStates_.delete(e),this.connectionsRefreshCount_.delete(e))}},{key:"subscribe",value:(l=lt(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new oc({code:rc.INVALID_PARAMETER,message:"stream is undefined or null"});case 2:if(t.isRemote()){e.next=4;break}throw new oc({code:rc.INVALID_PARAMETER,message:"try to subscribe a local stream"});case 4:return _f.report(fc.SUBSCRIBE,{value:pc}),this.log_.info("subscribe() => subscribe to [".concat(t.getUserId(),"] ").concat(t.getType()," stream with options: ").concat(JSON.stringify(n))),r=t.getConnection(),e.prev=7,e.next=10,r.subscribe(t,n);case 10:this.subscriptionManager_&&this.subscriptionManager_.addSubscriptionRecord(t.getUserId(),t,n),_f.report(fc.SUBSCRIBE,{value:hc}),vd({eventType:vc.SUBSCRIBE}),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(7),md({eventType:vc.SUBSCRIBE,error:e.t0}),e.t0;case 19:case"end":return e.stop()}},e,this,[[7,15]])})),function(e,t){return l.apply(this,arguments)})},{key:"unsubscribe",value:(u=lt(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new oc({code:rc.INVALID_PARAMETER,message:"stream is undefined or null"});case 2:if(t.isRemote()){e.next=4;break}throw new oc({code:rc.INVALID_PARAMETER,message:"try to unsubscribe a local stream"});case 4:return this.log_.info("unsubscribe() => unsubscribe to [".concat(t.getUserId(),"] ").concat(t.getType()," stream")),_f.report(fc.UNSUBSCRIBE,{value:pc}),n=t.getConnection(),e.prev=7,e.next=10,n.unsubscribe(t);case 10:this.subscriptionManager_&&this.subscriptionManager_.addUnsubscriptionRecord(t.getUserId(),t),_f.report(fc.UNSUBSCRIBE,{value:hc}),vd({eventType:vc.UNSUBSCRIBE}),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(7),md({eventType:vc.UNSUBSCRIBE,error:e.t0}),e.t0;case 19:case"end":return e.stop()}},e,this,[[7,15]])})),function(e){return u.apply(this,arguments)})},{key:"switchRole",value:(s=lt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("live"===this.mode_){e.next=2;break}throw new oc({code:rc.INVALID_PARAMETER,message:"role is only valid in live mode"});case 2:if("anchor"===t||"audience"===t){e.next=4;break}throw new oc({code:rc.INVALID_PARAMETER,message:"role could only be set to a value as anchor or audience"});case 4:if(this.role_===t){e.next=13;break}if(this.role_=t,this.log_.info("switchRole() => switch role to: "+t),this.isJoined_){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,this.leave();case 11:return e.next=13,this.join({role:t,roomId:this.roomId_,privateMapKey:this.privateMapKey_});case 13:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"on",value:function(e,t){this.emitter_.on(e,t)}},{key:"off",value:function(e,t){"*"===e?this.emitter_.removeAllListeners():this.emitter_.off(e,t)}},{key:"getRemoteMutedState",value:function(){var e=this,t=[];return this.mutedStates_.forEach(function(n,r,i){var o=e.connections_.get(r);o&&t.push(ht({userId:o.getUserId()},n))}),t}},{key:"setDefaultMuteRemoteStreams",value:function(e){this.log_.info("setDefaultMuteRemoteStreams muted: "+e),this.disableReceiver_=e}},{key:"getTransportStats",value:(a=lt(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t={rtt:0},!this.uplinkConnection_){e.next=6;break}return e.next=4,this.stats_.getSenderStats(this.uplinkConnection_);case 4:n=e.sent,t.rtt=n.rtt;case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"getLocalAudioStats",value:(o=lt(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t={})[this.userId_]={bytesSent:0,packetsSent:0},!this.uplinkConnection_){e.next=7;break}return e.next=5,this.stats_.getSenderStats(this.uplinkConnection_);case 5:n=e.sent,t[this.userId_]={bytesSent:n.audio.bytesSent,packetsSent:n.audio.packetsSent};case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"getLocalVideoStats",value:(i=lt(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t={})[this.userId_]={bytesSent:0,packetsSent:0,framesEncoded:0,framesSent:0,frameWidth:0,frameHeight:0},!this.uplinkConnection_){e.next=7;break}return e.next=5,this.stats_.getSenderStats(this.uplinkConnection_);case 5:n=e.sent,t[this.userId_]={bytesSent:n.video.bytesSent,packetsSent:n.video.packetsSent,framesEncoded:n.video.framesEncoded,framesSent:n.video.framesSent,frameWidth:n.video.frameWidth,frameHeight:n.video.frameHeight};case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"getRemoteAudioStats",value:(r=lt(regeneratorRuntime.mark(function e(){var t,n,r,i,o,a,s,u,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t={},n=!0,r=!1,i=void 0,e.prev=4,o=this.connections_[Symbol.iterator]();case 6:if(n=(a=o.next()).done){e.next=15;break}return(s=kt(a.value,2))[0],u=s[1],e.next=10,this.stats_.getReceiverStats(u);case 10:(l=e.sent).hasAudio&&(t[l.userId]={bytesReceived:l.audio.bytesReceived,packetsReceived:l.audio.packetsReceived,packetsLost:l.audio.packetsLost});case 12:n=!0,e.next=6;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),r=!0,i=e.t0;case 21:e.prev=21,e.prev=22,n||null==o.return||o.return();case 24:if(e.prev=24,!r){e.next=27;break}throw i;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return e.abrupt("return",t);case 30:case"end":return e.stop()}},e,this,[[4,17,21,29],[22,,24,28]])})),function(){return r.apply(this,arguments)})},{key:"getRemoteVideoStats",value:(n=lt(regeneratorRuntime.mark(function e(){var t,n,r,i,o,a,s,u,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t={},n=!0,r=!1,i=void 0,e.prev=4,o=this.connections_[Symbol.iterator]();case 6:if(n=(a=o.next()).done){e.next=15;break}return(s=kt(a.value,2))[0],u=s[1],e.next=10,this.stats_.getReceiverStats(u);case 10:(l=e.sent).hasVideo&&(t[l.userId]={bytesReceived:l.video.bytesReceived,packetsReceived:l.video.packetsReceived,packetsLost:l.video.packetsLost,framesDecoded:l.video.framesDecoded,frameWidth:l.video.frameWidth,frameHeight:l.video.frameHeight});case 12:n=!0,e.next=6;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),r=!0,i=e.t0;case 21:e.prev=21,e.prev=22,n||null==o.return||o.return();case 24:if(e.prev=24,!r){e.next=27;break}throw i;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return e.abrupt("return",t);case 30:case"end":return e.stop()}},e,this,[[4,17,21,29],[22,,24,28]])})),function(){return n.apply(this,arguments)})},{key:"getSdpSemantics",value:function(){return this.sdpSemantics_}},{key:"getIceServers",value:function(){var e=[];return this.turnServer_&&e.push(this.turnServer_),e}},{key:"startHeartbeat",value:function(){-1===this.heartbeat_&&(this.log_.info("startHeartbeat..."),this.heartbeat_=setInterval(this.doHeartbeat.bind(this),2e3))}},{key:"stopHeartbeat",value:function(){-1!==this.heartbeat_&&(this.log_.info("stopHeartbeat"),clearInterval(this.heartbeat_),this.heartbeat_=-1)}},{key:"doHeartbeat",value:(t=lt(regeneratorRuntime.mark(function e(){var t,n,r,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stats_.getStatsReport(this.uplinkConnection_,this.connections_);case 2:t=e.sent,n=this.signalChannel_.isConnected()?uc(this.userId_):[],r={WebRTCQualityReq:t,eventList:n,sdkAppId:this.sdkAppId_,tinyid:this.tinyId_,roomid:this.roomId_,socketid:this.signalInfo_.socketId,clientip:this.signalInfo_.localIp,serverip:this.signalInfo_.relayIp,cpunumber:navigator.hardwareConcurrency||0,cpudevice:navigator.platform,devicename:navigator.platform,ostype:navigator.platform,mode:this.localStream_?this.localStream_.getScreen()?"screen":"video":""},i=0,this.localStream_&&this.localStream_.getMediaStream()&&(o=this.localStream_.getMediaStream().getAudioTracks(),i=o.length>0&&o[0].muted?3:1),r.WebRTCQualityReq.AudioReportState.uint32_microphone_status=i,this.signalChannel_.send("on_quality_report",r);case 9:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"onPeerJoin",value:function(e){var t=this,n=e.content,r=n.srcopenid,i=n.srctinyid,o=n.remoteoffer,a=this.connections_.get(i);if(a){if(a.getIsReconnecting())return;this.log_.warn("duplicated peer-join observed, rebuild the connection"),this.log_.info("remote peer [".concat(r,"] is leaving")),a.close(),this.connections_.delete(i),this.emitter_.emit(Jd,{userId:r})}var s=this.pendingRefresh_.get(i);s&&(clearTimeout(s),this.pendingRefresh_.delete(i)),this.log_.info("remote peer [".concat(r,"] is online")),this.emitter_.emit("peer-join",{userId:r});var u=new Xf({userId:r,tinyId:i,client:this,isUplink:!1,signalChannel:this.signalChannel_});this.connections_.set(i,u),_f.report(fc.DOWNLINK_CONNECTION,{value:pc}),u.initialize(),u.setRemoteOffer(o),u.on(Yd.STREAM_ADDED,function(e){t.subscriptionManager_.hasAutoRecoveryFlag(r)?t.subscriptionManager_.recover(e.stream):t.emitter_.emit("stream-added",{stream:e.stream})}),u.on(Yd.STREAM_REMOVED,function(e){t.subscriptionManager_.hasAutoRecoveryFlag(r)||t.emitter_.emit("stream-removed",{stream:e.stream})}),u.on(Yd.STREAM_UPDATED,function(e){t.subscriptionManager_.hasAutoRecoveryFlag(r)||t.emitter_.emit("stream-updated",{stream:e.stream})}),u.on(Yd.STREAM_SUBSCRIBED,function(e){t.subscriptionManager_.hasAutoRecoveryFlag(r)||t.emitter_.emit("stream-subscribed",{stream:e.stream})}),u.on(Yd.ERROR,function(e){var n=e.getCode();n!==rc.ICE_TRANSPORT_ERROR&&(n===rc.DOWNLINK_RECONNECTION_FAILED&&t.closeDownLink(i),t.emitter_.emit(tf,e))})}},{key:"onPeerLeave",value:function(e){var t=e.content,n=t.srctinyid,r=t.srcopenid,i=this.connections_.get(n);if(i){if(i.getIsReconnecting())return;void 0===r&&(r=i.getUserId()),this.log_.info("remote peer [".concat(r,"] is leaving")),this.closeDownLink(n),this.emitter_.emit(Jd,{userId:r})}}},{key:"onUserList",value:function(e){var t=this;try{var n=e.content.userlist.map(function(e){return e.userid});this.connections_.forEach(function(e){var r=e.getUserId(),i=e.getTinyId();n.findIndex(function(e){return e===r})<0&&(t.log_.info("peer leave detected [".concat(r,"]")),t.closeDownLink(i),t.emitter_.emit(Jd,{userId:r}))})}catch(e){}}},{key:"onUpdateRemoteMuteStat",value:function(e){var t=this,n=e.content;n.userlist.forEach(function(e){var n=e.srctinyid,r=e.userid;if(0!==n&&n!==t.tinyId_)if(t.connections_.get(n)){var i=!!(1&e.flag),o=!!(8&e.flag),a=!!(64&e.flag),s=!!(16&e.flag),u=t.mutedStates_.get(n);if(void 0===u)return t.mutedStates_.set(n,{hasAudio:o,hasVideo:i,audioMuted:a,videoMuted:s}),i?s?t.emitter_.emit(Qd,{userId:r}):t.emitter_.emit($d,{userId:r}):t.emitter_.emit(Qd,{userId:r}),void(o?a?t.emitter_.emit(Xd,{userId:r}):t.emitter_.emit(Zd,{userId:r}):t.emitter_.emit(Xd,{userId:r}));var l=!a&&o;(!u.audioMuted&&u.hasAudio)!==l&&(l?t.emitter_.emit(Zd,{userId:r}):t.emitter_.emit(Xd,{userId:r}));var c=!s&&i;(!u.videoMuted&&u.hasVideo)!==c&&(c?t.emitter_.emit($d,{userId:r}):t.emitter_.emit(Qd,{userId:r})),t.mutedStates_.set(n,{hasAudio:o,hasVideo:i,audioMuted:a,videoMuted:s})}else t.mutedStates_.delete(n)})}},{key:"onClientBanned",value:function(e){this.emitter_.emit("client-banned",new oc({code:rc.CLIENT_BANNED,message:"client was banned because of "+e}))}},{key:"getEnv",value:function(){return this.env_}},{key:"getSubscriptionManager",value:function(){return this.subscriptionManager_}},{key:"triggerReconnectForTest",value:function(e){var t={exitcode:e};this.log_.warn("triggerReconnectForTest exitcode: "+e),this.signalChannel_.send("on_test_ws_broken",t)}},{key:"setBandwidthForTest",value:function(e){this.uplinkConnection_&&this.uplinkConnection_.setBandwidth(e)}}]),e}(),Zf=function(e){var t=e.retryFunction,n=e.settings,r=e.onError,i=e.onRetrying,o=e.context;return function(){for(var e=this,a=arguments.length,s=new Array(a),u=0;u<a;u++)s[u]=arguments[u];var l=n.retries||5,c=0,d=-1,f=0,p=function(){var a=lt(regeneratorRuntime.mark(function a(u,h){var g,v,m,y;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,g=o||e,a.next=4,t.apply(g,s);case 4:v=a.sent,c=0,u(v),a.next=14;break;case 9:a.prev=9,a.t0=a.catch(0),m=function(){clearTimeout(d),c=0,f=2,h(a.t0)},y=function(){2!==f&&c<l?(f=1,i(++c,m),d=setTimeout(function(){d=-1,p(u,h)},n.timeout||1e3)):m()},r(a.t0,y,h);case 14:case"end":return a.stop()}},a,null,[[0,9]])}));return function(e,t){return a.apply(this,arguments)}}();return new Promise(p)}}({retryFunction:function(){var e=lt(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=3;break}return Un.error("navigator.mediaDevices is undefined"),e.abrupt("return");case 3:return e.next=5,$f(t);case 5:if(n=e.sent,Un.info("getUserMedia with constraints: "+JSON.stringify(n)),!n.audio){e.next=14;break}return e.next=10,fp.getMicrophones();case 10:if(r=e.sent,Un.info("microphones: ".concat(JSON.stringify(r))),0!==r.length){e.next=14;break}throw new oc({code:rc.DEVICE_NOT_FOUND,message:"no microphone detected, but you are trying to get audio stream, please check your microphone and the configeration on TRTC.createStream."});case 14:if(!n.video){e.next=21;break}return e.next=17,fp.getCameras();case 17:if(i=e.sent,Un.info("cameras: ".concat(JSON.stringify(i))),0!==i.length){e.next=21;break}throw new oc({code:rc.DEVICE_NOT_FOUND,message:"no camera detected, but you are trying to get video stream, please check your camera and the configeration on TRTC.createStream."});case 21:return e.next=23,navigator.mediaDevices.getUserMedia(n);case 23:return e.abrupt("return",e.sent);case 24:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),settings:{retries:5,timeout:2e3},onError:function(e,t,n){"NotReadableError"===e.name?t():n(e)},onRetrying:function(e){Un.warn("getUserMedia NotReadableError observed, retrying [".concat(e,"/5]"))}});function $f(e){return function(){return lt(regeneratorRuntime.mark(function e(t){var n,r,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n={echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0},t.audio){e.next=5;break}n=!1,e.next=15;break;case 5:if(_d(t.microphoneId)){e.next=9;break}n=ht({deviceId:{exact:t.microphoneId},sampleRate:t.sampleRate,channelCount:t.channelCount},n),e.next=15;break;case 9:return n=ht({sampleRate:t.sampleRate,channelCount:t.channelCount},n),e.next=12,fp.getMicrophones();case 12:r=e.sent,(i=r.filter(function(e){var t=e.deviceId;return t.length>0&&"default"!==t})).length>0&&(n.deviceId={exact:i[0].deviceId});case 15:return o={},o=void 0!==t.facingMode&&t.video?{facingMode:t.facingMode,width:t.width,height:t.height,frameRate:t.frameRate}:!_d(t.cameraId)&&t.video?{deviceId:{exact:t.cameraId},width:t.width,height:t.height,frameRate:t.frameRate}:!!t.video&&(void 0===t.width||{width:t.width,height:t.height,frameRate:t.frameRate}),e.abrupt("return",{audio:n,video:o});case 18:case"end":return e.stop()}},e)})).apply(this,arguments)}.apply(this,arguments)}var ep=function(){var e=lt(regeneratorRuntime.mark(function e(t){var n,r,i,o,a,s,u,l,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=3;break}return Un.error("navigator.mediaDevices is undefined"),e.abrupt("return");case 3:if(n=null,!(Wc&&Yc<74||Xc)){e.next=28;break}return r=np(t),Un.info("getDisplayMedia with contraints: "+JSON.stringify(r)),e.next=9,navigator.mediaDevices.getDisplayMedia(r);case 9:if(i=e.sent,!t.screenAudio){e.next=15;break}return Un.warn("Your browser not support capture system audio"),e.abrupt("return",i);case 15:if(!t.audio){e.next=25;break}return o=tp(t),Un.info("getUserMedia with constraints: "+JSON.stringify(o)),e.next=20,navigator.mediaDevices.getUserMedia(o);case 20:return n=e.sent,i.addTrack(n.getAudioTracks()[0]),e.abrupt("return",i);case 25:return e.abrupt("return",i);case 26:e.next=54;break;case 28:if(!t.screenAudio){e.next=38;break}return t.audioConstraints={echoCancellation:!0,noiseSuppression:!0,sampleRate:44100},a=np(t),Un.info("getDisplayMedia with contraints: "+JSON.stringify(a)),e.next=34,navigator.mediaDevices.getDisplayMedia(a);case 34:return s=e.sent,e.abrupt("return",s);case 38:return u=np(t),Un.info("getDisplayMedia with contraints: "+JSON.stringify(u)),e.next=42,navigator.mediaDevices.getDisplayMedia(u);case 42:if(l=e.sent,!t.audio){e.next=53;break}return c=tp(t),Un.info("getUserMedia with constraints: "+JSON.stringify(c)),e.next=48,navigator.mediaDevices.getUserMedia(c);case 48:return n=e.sent,l.addTrack(n.getAudioTracks()[0]),e.abrupt("return",l);case 53:return e.abrupt("return",l);case 54:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();function tp(e){return{audio:void 0!==e.microphoneId?{deviceId:{exact:e.microphoneId},sampleRate:e.sampleRate,channelCount:e.channelCount}:{sampleRate:e.sampleRate,channelCount:e.channelCount},video:!1}}function np(e){var t={},n={width:e.width,height:e.height,frameRate:e.frameRate};return void 0!==e.screenSource&&(n.displaySurface=e.screenSource),t.video=n,void 0!==e.audioConstraints&&(t.audio=e.audioConstraints),t}var rp=new Map;rp.set("120p",{width:160,height:120,frameRate:15,bitrate:200}),rp.set("180p",{width:320,height:180,frameRate:15,bitrate:350}),rp.set("240p",{width:320,height:240,frameRate:15,bitrate:400}),rp.set("360p",{width:640,height:360,frameRate:15,bitrate:800}),rp.set("480p",{width:640,height:480,frameRate:15,bitrate:900}),rp.set("720p",{width:1280,height:720,frameRate:15,bitrate:1500}),rp.set("1080p",{width:1920,height:1080,frameRate:15,bitrate:2e3}),rp.set("1440p",{width:2560,height:1440,frameRate:30,bitrate:4860}),rp.set("4K",{width:3840,height:2160,frameRate:30,bitrate:9e3});var ip=new Map;ip.set("480p",{width:640,height:480,frameRate:5,bitrate:900}),ip.set("480p_2",{width:640,height:480,frameRate:30,bitrate:1e3}),ip.set("720p",{width:1280,height:720,frameRate:5,bitrate:1200}),ip.set("720p_2",{width:1280,height:720,frameRate:30,bitrate:3e3}),ip.set("1080p",{width:1920,height:1080,frameRate:5,bitrate:1600}),rp.set("1080p_2",{width:1920,height:1080,frameRate:30,bitrate:4e3});var op=new Map;op.set("standard",{sampleRate:48e3,channelCount:1,bitrate:40}),op.set("high",{sampleRate:48e3,channelCount:1,bitrate:128});var ap,sp,up,lp,cp,dp=function(e){function t(e){var n;ct(this,t);var r=ht({},e,{isRemote:!1,type:"local"});return e.screen&&(r.mirror=!1),(n=bt(this,vt(t).call(this,r))).video_=e.video,n.audio_=e.audio,n.cameraId_=e.cameraId,n.cameraGroupId_="",n.facingMode_=e.facingMode,n.microphoneId_=e.microphoneId,n.microphoneGroupId_="",n.videoSource_=e.videoSource,n.audioSource_=e.audioSource,n.screen_=e.screen,n.screenSource_=e.screenSource,n.screenAudio_=e.screenAudio,n.audioProfile_={sampleRate:48e3,channelCount:1,bitrate:40},n.videoProfile_={width:640,height:480,frameRate:15,bitrate:900},n.screenProfile_={width:1920,height:1080,frameRate:5,bitrate:1600},n.videoBitrate_=n.screen_?1600:900,n.videoSetting_=null,n}var n,r,i,o,a,s;return gt(t,Lf),ft(t,[{key:"initialize",value:function(){var e=this;return new Promise(function(t,n){if(_f.report(fc.LOCAL_STREAM_INITIALIZE,{value:pc}),void 0===e.audio_){var r=new MediaStream;return void 0!==e.audioSource_&&(r.addTrack(e.audioSource_),e.setHasAudio(!0)),void 0!==e.videoSource_&&(r.addTrack(e.videoSource_),e.setHasVideo(!0)),e.setMediaStream(r),vd({eventType:vc.LOCAL_STREAM_INITIALIZE,kind:"custom"}),_f.report(fc.LOCAL_STREAM_INITIALIZE,{value:hc}),t()}e.screen_?(e.log_.info("initialize stream audio: "+e.audio_+" screenAudio: "+e.screenAudio_+" screen: "+e.screen_),ep({audio:e.audio_,screenAudio:e.screenAudio_,microphoneId:e.microphoneId_,screenSource:e.screenSource_,width:e.screenProfile_.width,height:e.screenProfile_.height,frameRate:e.screenProfile_.frameRate,sampleRate:e.audioProfile_.sampleRate,channelCount:e.audioProfile_.channelCount}).then(function(n){return e.setMediaStream(n),e.setHasAudio(e.audio_||e.screenAudio_),e.setHasVideo(!0),e.listenForScreenSharingStopped(e.getVideoTrack()),e.setVideoContentHint("detail"),e.updateDeviceIdInUse(),vd({eventType:vc.LOCAL_STREAM_INITIALIZE,kind:"getDisplayMedia"}),_f.report(fc.LOCAL_STREAM_INITIALIZE,{value:hc}),t()}).catch(function(t){md({eventType:vc.LOCAL_STREAM_INITIALIZE,kind:"getDisplayMedia",error:t}),e.log_.error("getDisplayMedia error observed "+t),n(t)})):(e.log_.info("initialize stream audio: "+e.audio_+" video: "+e.video_),Zf({audio:e.audio_,video:e.video_,facingMode:e.facingMode_,cameraId:e.cameraId_,microphoneId:e.microphoneId_,width:e.videoProfile_.width,height:e.videoProfile_.height,frameRate:e.videoProfile_.frameRate,sampleRate:e.audioProfile_.sampleRate,channelCount:e.audioProfile_.channelCount}).then(function(n){return"getSettings"in MediaStreamTrack.prototype&&(e.videoSetting_=n.getVideoTracks().length>0&&n.getVideoTracks()[0].getSettings()),e.setMediaStream(n),e.setHasAudio(e.audio_),e.setHasVideo(e.video_),e.updateDeviceIdInUse(),e.log_.debug("gotStream hasAudio: "+e.hasAudio_+" hasVideo: "+e.hasVideo_),vd({eventType:vc.LOCAL_STREAM_INITIALIZE,kind:"getUserMedia"}),_f.report(fc.LOCAL_STREAM_INITIALIZE,{value:hc}),t()}).catch(function(t){md({eventType:vc.LOCAL_STREAM_INITIALIZE,kind:"getUserMedia",error:t}),e.log_.error("getUserMedia error observed "+t+" https://trtc-1252463788.file.myqcloud.com/web/docs/tutorial-10-error-code-tips.html"),n(t)}))})}},{key:"listenForScreenSharingStopped",value:function(e){var t=this;e.addEventListener("ended",function(e){t.log_.info("screen sharing was stopped because the video track is ended"),t.emitter_.emit("screen-sharing-stopped")})}},{key:"muteAudio",value:function(){var e=St(vt(t.prototype),"muteAudio",this).call(this);if(e){this.log_.info("localStream mute audio");var n=this.getConnection();if(n){n.setMutedState("audio",!0);var r=n.getUserId(),i=n.getTinyId();sc(r,{eventId:32772,eventDesc:"mute local audio track",timestamp:bo(),userId:r,tinyId:i})}}return e}},{key:"muteVideo",value:function(){this.log_.info("localStream mute video");var e=St(vt(t.prototype),"muteVideo",this).call(this);if(e){var n=this.getConnection();if(n){n.setMutedState("video",!0);var r=n.getUserId(),i=n.getTinyId();sc(r,{eventId:32773,eventDesc:"mute local video track",timestamp:bo(),userId:r,tinyId:i})}}return e}},{key:"unmuteAudio",value:function(){var e=St(vt(t.prototype),"unmuteAudio",this).call(this);if(e){this.log_.info("localStream unmute audio");var n=this.getConnection();if(n){n.setMutedState("audio",!1);var r=n.getUserId(),i=n.getTinyId();sc(r,{eventId:32774,eventDesc:"unmute local audio track",timestamp:bo(),userId:r,tinyId:i})}}return e}},{key:"unmuteVideo",value:function(){this.log_.info("localStream unmute video");var e=St(vt(t.prototype),"unmuteVideo",this).call(this);if(e){var n=this.getConnection();if(n){n.setMutedState("video",!1);var r=n.getUserId(),i=n.getTinyId();sc(r,{eventId:32775,eventDesc:"unmute local video track",timestamp:bo(),userId:r,tinyId:i})}}return e}},{key:"setAudioProfile",value:function(e){var t;"object"===st(e)?t=e:void 0===(t=op.get(e))&&(t=op.get("standard")),this.log_.info("setAudioProfile: "+JSON.stringify(t)),this.audioProfile_=t}},{key:"setVideoProfile",value:function(e){var t;"object"===st(e)?t=e:void 0===(t=rp.get(e))&&(t=rp.get("480p")),this.log_.info("setVideoProfile "+JSON.stringify(t)),this.videoProfile_=t,this.videoBitrate_=t.bitrate}},{key:"getVideoBitrate",value:function(){return this.videoBitrate_}},{key:"getAudioBitrate",value:function(){return this.audioProfile_.bitrate}},{key:"setScreenProfile",value:function(e){var t=e;"object"!==st(e)&&void 0===(t=ip.get(e))&&(t=ip.get("1080p")),this.log_.info("setScreenProfile "+JSON.stringify(e)),this.screenProfile_=t,this.videoBitrate_=t.bitrate}},{key:"getVideoProfile",value:function(){return this.screen_?this.screenProfile_:this.videoProfile_}},{key:"getAudioProfile",value:function(){return this.audioProfile_}},{key:"setVideoContentHint",value:function(e){var t=this.getVideoTrack();t&&"contentHint"in t&&(this.log_.info("set video track contentHint to: "+e),t.contentHint=e,t.contentHint!==e&&this.log_.warn("Invalid video track contentHint: "+e))}},{key:"switchDevice",value:(s=lt(regeneratorRuntime.mark(function e(n,r){var i,o,a,s,u,l,c,d,f,p,h,g,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.screen_){e.next=2;break}throw new oc({code:rc.INVALID_OPERATION,message:"switch device is not supported in screen sharing"});case 2:if(!("audio"===n&&this.microphoneId_===r||"video"===n&&this.cameraId_===r||this.audioSource_||this.videoSource_)){e.next=4;break}return e.abrupt("return");case 4:if("audio"===n&&(this.microphoneId_=r,this.audio_||(this.audio_=!0)),"video"===n&&("user"===r||"environment"===r?this.facingMode_=r:this.cameraId_=r,this.video_||(this.video_=!0)),this.getMediaStream()){e.next=8;break}return e.abrupt("return");case 8:return this.log_.info("switchDevice "+n+" to: "+r),"video"===n&&(Bc||Gc||Vc)&&(i=this.getVideoTrack())&&i.stop(),"audio"===n&&Vc&&(o=this.getAudioTrack(),a=this.getMicrophoneTrackMixed(),o&&o.stop(),a&&a.stop()),e.next=13,Zf({audio:this.audio_,video:this.video_,facingMode:this.facingMode_,cameraId:this.cameraId_,microphoneId:this.microphoneId_,width:this.videoProfile_.width,height:this.videoProfile_.height,frameRate:this.videoProfile_.frameRate,sampleRate:this.audioProfile_.sampleRate,channelCount:this.audioProfile_.channelCount});case 13:if(s=e.sent,(u=s.getAudioTracks()[0])&&this.isAudioTrackMixed()&&(l=this.getAudioTrack(),c=fp.AudioMixerPlugin.getAudioTrackMap(),d=fp.AudioMixerPlugin.mix({targetTrack:u,sourceList:c.get(l.id).sourceList}),s.removeTrack(u),s.addTrack(d)),this.setMediaStream(s),this.updateDeviceIdInUse(),!(f=this.getConnection())){e.next=28;break}return e.next=22,f.replaceStream(s);case 22:p=f.getUserId(),h=f.getTinyId(),g=32780,v="switch camera","audio"===n&&(g=32781,v="switch microphone"),sc(p,{eventId:g,eventDesc:v,timestamp:bo(),userId:p,tinyId:h});case 28:return this.log_.info("switchDevice - restart audio/video player"),St(vt(t.prototype),"restartAudio",this).call(this),St(vt(t.prototype),"restartVideo",this).call(this),e.abrupt("return");case 32:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"addTrack",value:(a=lt(regeneratorRuntime.mark(function e(t){var n,r,i,o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.getMediaStream()){e.next=3;break}throw new oc({code:rc.INVALID_OPERATION,message:"the local stream is not initialized yet"});case 3:if(!("audio"===t.kind&&n.getAudioTracks().length>0||"video"===t.kind&&n.getVideoTracks().length>0)){e.next=5;break}throw new oc({code:rc.INVALID_OPERATION,message:"A Stream has at most one audio track and one video track"});case 5:if("video"!==t.kind){e.next=10;break}if(!("getSettings"in MediaStreamTrack.prototype)){e.next=10;break}if(r=t.getSettings(),!this.videoSetting_||r.width===this.videoSetting_.width&&r.height===this.videoSetting_.height){e.next=10;break}throw new oc({code:rc.INVALID_PARAMETER,message:"video resolution of the track (".concat(r.width," x ").concat(r.height,") shall be kept the same as the previous: ").concat(this.videoSetting_.width," x ").concat(this.videoSetting_.height)});case 10:if(n.addTrack(t),"audio"===t.kind?(this.audio_=!0,this.setHasAudio(!0)):(this.video_=!0,this.setHasVideo(!0)),!(i=this.getConnection())){e.next=22;break}return e.next=16,i.addTrack(t);case 16:o=i.getUserId(),a=i.getTinyId(),s=32768,u="add video track to current published stream","audio"===t.kind&&(s=32769,u="add audio track to current published stream"),sc(o,{eventId:s,eventDesc:u,timestamp:bo(),userId:o,tinyId:a});case 22:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"removeTrack",value:(o=lt(regeneratorRuntime.mark(function e(t){var n,r,i,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("audio"!==t.kind){e.next=2;break}throw new oc({code:rc.INVALID_PARAMETER,message:"remove audio track is not supported"});case 2:if(n=this.getMediaStream()){e.next=5;break}throw new oc({code:rc.INVALID_OPERATION,message:"the local stream is not initialized yet"});case 5:if(-1!==n.getTracks().indexOf(t)){e.next=7;break}throw new oc({code:rc.INVALID_PARAMETER,message:"the track to be removed is not being publishing"});case 7:if(1!==n.getTracks().length){e.next=9;break}throw new oc({code:rc.INVALID_OPERATION,message:"remove the only video track is not supported, please use replaceTrack or muteVideo"});case 9:if(n.removeTrack(t),"audio"===t.kind?(this.audio_=!1,this.setHasAudio(!1)):(this.video_=!1,this.setHasVideo(!1)),!(r=this.getConnection())){e.next=21;break}return e.next=15,r.removeTrack(t);case 15:i=r.getUserId(),o=r.getTinyId(),a=32770,s="remove video track from current published stream","audio"===t.kind&&(a=32771,s="remove audio track from current published stream"),sc(i,{eventId:a,eventDesc:s,timestamp:bo(),userId:i,tinyId:o});case 21:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"replaceTrack",value:(i=lt(regeneratorRuntime.mark(function e(n){var r,i,o,a,s,u,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getMediaStream()){e.next=3;break}throw new oc({code:rc.INVALID_OPERATION,message:"the local stream is not initialized yet"});case 3:if(!("audio"===n.kind&&r.getAudioTracks().length<=0||"video"===n.kind&&r.getVideoTracks().length<=0)){e.next=5;break}throw new oc({code:rc.INVALID_PARAMETER,message:"try to replace ".concat(n.kind," track but there's no previous ").concat(n.kind," being published")});case 5:if("video"!==n.kind){e.next=10;break}if(!("getSettings"in MediaStreamTrack.prototype)){e.next=10;break}if(i=n.getSettings(),!this.videoSetting_||i.width===this.videoSetting_.width&&i.height===this.videoSetting_.height){e.next=10;break}throw new oc({code:rc.INVALID_PARAMETER,message:"video resolution of the track (".concat(i.width," x ").concat(i.height,") shall be kept the same as the previous: ").concat(this.videoSetting_.width," x ").concat(this.videoSetting_.height)});case 10:if("audio"===n.kind?(r.removeTrack(r.getAudioTracks()[0]),r.addTrack(n),St(vt(t.prototype),"restartAudio",this).call(this)):(r.removeTrack(r.getVideoTracks()[0]),r.addTrack(n),St(vt(t.prototype),"restartVideo",this).call(this)),!(o=this.getConnection())){e.next=21;break}return e.next=15,o.replaceTrack(n);case 15:a=o.getUserId(),s=o.getTinyId(),u=32782,l="replace video track from current published stream","audio"===n.kind&&(u=32783,l="replace audio track from current published stream"),sc(a,{eventId:u,eventDesc:l,timestamp:bo(),userId:a,tinyId:s});case 21:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"updateStream",value:(r=lt(regeneratorRuntime.mark(function e(t){var n,r,i,o,a,s,u,l,c,d,f,p,h,g,v,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaStream_){e.next=2;break}return e.abrupt("return");case 2:return this.log_.info("updateStream() try to recover local stream"),e.prev=3,e.next=6,fp.getCameras();case 6:return n=e.sent,e.next=9,fp.getMicrophones();case 9:if(r=e.sent,i=this.audio_,(o=this.video_)&&0===n.length&&(o=!1,this.log_.info("updateStream() video flag is true, but no camera detected, set video to false")),i&&0===r.length&&(i=!1,this.log_.info("updateStream() audio flag is true, but no microphone detected, set audio to false")),!1!==i||!1!==o){e.next=17;break}return this.log_.info("updateStream() both audio and video are false, recover stream aborted"),e.abrupt("return");case 17:return _f.report(fc.UPDATE_STREAM,{value:pc}),a=this.mediaStream_.getAudioTracks().map(function(e){return e.enabled}).includes(!1),s=this.mediaStream_.getVideoTracks().map(function(e){return e.enabled}).includes(!1),u=t&&n.findIndex(function(e){return e.deviceId===t.cameraId})>=0,l=t&&r.findIndex(function(e){return e.deviceId===t.microphoneId})>=0,e.next=24,Zf({audio:i,video:o,cameraId:u?t.cameraId:void 0,microphoneId:l?t.microphoneId:void 0,facingMode:this.facingMode_,width:this.videoProfile_.width,height:this.videoProfile_.height,frameRate:this.videoProfile_.frameRate,sampleRate:this.audioProfile_.sampleRate,channelCount:this.audioProfile_.channelCount});case 24:c=e.sent,d=c.getTracks(),f=0;case 27:if(!(f<d.length)){e.next=45;break}if("audio"!==(p=d[f]).kind||!this.isAudioTrackMixed()){e.next=40;break}if(h=this.getAudioTrack(),g=fp.AudioMixerPlugin.getAudioTrackMap(),(v=g.get(h.id)).hasMicrophone){e.next=36;break}return p.stop(),e.abrupt("continue",42);case 36:return m=fp.AudioMixerPlugin.mix({targetTrack:p,sourceList:v.sourceList}),e.next=39,this.replaceTrack_(m);case 39:return e.abrupt("continue",42);case 40:return e.next=42,this.replaceTrack_(p);case 42:f++,e.next=27;break;case 45:a&&(this.log_.info("updateStream() prev audio tracks is muted, keep current audio tracks muted"),this.doEnableTrack("audio",!1)),s&&(this.log_.info("updateStream() prev video tracks is muted, keep current video tracks muted"),this.doEnableTrack("video",!1)),this.updateDeviceIdInUse(),_f.report(fc.UPDATE_STREAM,{value:hc}),vd({eventType:vc.UPDATE_STREAM}),this.log_.info("updateStream() recover local stream successfully"),e.next=57;break;case 53:e.prev=53,e.t0=e.catch(3),md({eventType:vc.UPDATE_STREAM,error:e.t0}),this.log_.error("updateStream() failed to recover local stream, "+e.t0);case 57:case"end":return e.stop()}},e,this,[[3,53]])})),function(e){return r.apply(this,arguments)})},{key:"replaceTrack_",value:(n=lt(regeneratorRuntime.mark(function e(n){var r,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.mediaStream_.getAudioTracks(),i=this.mediaStream_.getVideoTracks(),!("audio"===n.kind&&r.length<=0||"video"===n.kind&&i.length<=0)){e.next=5;break}return this.log_.info("there is no previous ".concat(n.kind," track, replacement ignored")),e.abrupt("return");case 5:if("audio"===n.kind?(this.mediaStream_.removeTrack(r[0]),this.mediaStream_.addTrack(n),St(vt(t.prototype),"restartAudio",this).call(this)):("getSettings"in MediaStreamTrack.prototype&&(o=n.getSettings(),!this.videoSetting_||o.width===this.videoSetting_.width&&o.height===this.videoSetting_.height||this.log_.warn("the resolution of video track to be replaced (".concat(o.width," x ").concat(o.height,") is different from the previous video settings (").concat(this.videoSetting_.width," x ").concat(this.videoSetting_.height,"). It may cause a cloud recording exception"))),this.mediaStream_.removeTrack(i[0]),this.mediaStream_.addTrack(n),St(vt(t.prototype),"restartVideo",this).call(this)),!(a=this.getConnection())){e.next=10;break}return e.next=10,a.replaceTrack(n);case 10:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"updateDeviceIdInUse",value:function(){var e=this;if(!this.mediaStream_)return this.cameraId_="",this.cameraGroupId_="",this.microphoneId_="",void(this.microphoneGroupId_="");"getSettings"in MediaStreamTrack.prototype&&this.mediaStream_.getTracks().forEach(function(t){if("audio"===t.kind&&e.isAudioTrackMixed()){var n=e.getMicrophoneTrackMixed();if(n){var r=n.getSettings(),i=r.deviceId,o=r.groupId;i&&(e.microphoneId_=i,e.microphoneGroupId_=o)}}else{var a=t.getSettings(),s=a.deviceId,u=a.groupId;s&&("audio"===t.kind?(e.microphoneId_=s,e.microphoneGroupId_=u):"video"!==t.kind||e.screen_||(e.cameraId_=s,e.cameraGroupId_=u))}});var t=this.mediaStream_.getAudioTracks(),n=this.mediaStream_.getVideoTracks();t&&0===t.length&&(this.microphoneId_="",this.microphoneGroupId_=""),n&&0===n.length&&(this.cameraId_="",this.cameraGroupId_="")}},{key:"isAudioTrackMixed",value:function(){if(fp.AudioMixerPlugin){var e=fp.AudioMixerPlugin.getAudioTrackMap(),t=this.getAudioTrack();if(e&&t&&e.has(t.id))return!0}return!1}},{key:"getMicrophoneTrackMixed",value:function(){if(fp.AudioMixerPlugin){var e=fp.AudioMixerPlugin.getAudioTrackMap(),t=this.getAudioTrack();if(e&&t&&e.has(t.id)){var n=e.get(t.id);return n.hasMicrophone?n.microphoneTrack:null}}return null}},{key:"getScreen",value:function(){return this.screen_}},{key:"getVideo",value:function(){return this.video_}},{key:"getAudio",value:function(){return this.audio_}},{key:"getCameraId",value:function(){return this.cameraId_}},{key:"getMicrophoneId",value:function(){return this.microphoneId_}},{key:"getMicrophoneGroupId",value:function(){return this.microphoneGroupId_}},{key:"setAudioVolume",value:function(e){St(vt(t.prototype),"setAudioVolume",this).call(this,e)}}]),t}(),fp={VERSION:"4.7.0",Logger:{LogLevel:{TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,NONE:5},setLogLevel:function(e){Un.setLogLevel(e)},enableUploadLog:function(){Un.enableUploadLog()},disableUploadLog:function(){Un.disableUploadLog()}},checkSystemRequirements:(cp=lt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Un.warn("breaking change occurs on TRTC.checkSystemRequirements from v4.7.0, refer to: https://trtc-1252463788.file.myqcloud.com/web/docs/TRTC.html#.checkSystemRequirements"),e.next=3,Td();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)})),function(){return cp.apply(this,arguments)}),isScreenShareSupported:function(){return Cd()},getDevices:(lp=lt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=3;break}return Un.error("navigator.mediaDevices is undefined"),e.abrupt("return",[]);case 3:return e.next=5,navigator.mediaDevices.enumerateDevices();case 5:return t=e.sent,e.abrupt("return",t.map(function(e,t){var n=e.label;e.label||(n=e.kind+"_"+t);var r={label:n,deviceId:e.deviceId,kind:e.kind};return e.groupId&&(r.groupId=e.groupId),r}));case 7:case"end":return e.stop()}},e)})),function(){return lp.apply(this,arguments)}),getCameras:(up=lt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=3;break}return Un.error("navigator.mediaDevices is undefined"),e.abrupt("return",[]);case 3:return e.next=5,navigator.mediaDevices.enumerateDevices();case 5:return t=e.sent,e.abrupt("return",t.filter(function(e){return"videoinput"===e.kind}).map(function(e,t){var n=e.label;e.label||(n="camera_"+t);var r={label:n,deviceId:e.deviceId,kind:e.kind};return e.groupId&&(r.groupId=e.groupId),r}));case 7:case"end":return e.stop()}},e)})),function(){return up.apply(this,arguments)}),getMicrophones:(sp=lt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=3;break}return Un.error("navigator.mediaDevices is undefined"),e.abrupt("return",[]);case 3:return e.next=5,navigator.mediaDevices.enumerateDevices();case 5:return t=e.sent,e.abrupt("return",t.filter(function(e){return"audioinput"===e.kind}).map(function(e,t){var n=e.label;e.label||(n="microphone_"+t);var r={label:n,deviceId:e.deviceId,kind:e.kind};return e.groupId&&(r.groupId=e.groupId),r}));case 7:case"end":return e.stop()}},e)})),function(){return sp.apply(this,arguments)}),getSpeakers:(ap=lt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return t=e.sent,e.abrupt("return",t.filter(function(e){return"audiooutput"===e.kind}).map(function(e,t){var n=e.label;e.label||(n="speaker_"+t);var r={label:n,deviceId:e.deviceId,kind:e.kind};return e.groupId&&(r.groupId=e.groupId),r}));case 4:case"end":return e.stop()}},e)})),function(){return ap.apply(this,arguments)}),createClient:function(e){_f.report("sdkAppID",{value:e.sdkAppId}),_f.report("version",{value:this.VERSION}),Un.getLogLevel()!=fp.Logger.LogLevel.NONE&&jo&&(jo=!1,console.info("******************************************************************************"),console.info("*   欢迎使用 TRTC Web SDK - 腾讯云实时音视频通信"),console.info("*   API 文档：https://trtc-1252463788.file.myqcloud.com/web/docs/index.html"),console.info("*   版本更新日志：https://cloud.tencent.com/document/product/647/38958"),console.info("*   反馈问题：https://github.com/tencentyun/TRTCSDK/issues"),console.info("******************************************************************************"),Un.info("TRTC Web SDK Version: 4.7.0"),Un.info("UserAgent: "+navigator.userAgent),Un.info("URL of current page: "+location.href));var t={version:this.VERSION};return new Qf(ht({},t,e))},createStream:function(e){if(void 0!==e.screen&&e.screen&&void 0===e.audio&&(e.audio=!1),!(void 0===e.audio&&void 0===e.video||void 0===e.audioSource&&void 0===e.videoSource))throw new oc({code:rc.INVALID_PARAMETER,message:"LocalStream must be created by createStream() with either audio/video or audioSource/videoSourcebut can not be mixed with audio/video and audioSource/videoSource"});if(void 0!==e.screen&&!0===e.screen&&!0===e.video)throw new oc({code:rc.INVALID_PARAMETER,message:"screen/video options are mutually exclusive, they can not be both true"});if(e.audio&&e.screenAudio)throw new oc({code:rc.INVALID_PARAMETER,message:"audio/screenAudio options are mutually exclusive, they can not be both true"});if(!0!==e.screen&&!0===e.screenAudio)throw new oc({code:rc.INVALID_PARAMETER,message:"screenAudio options are configurable while screen options is true"});if(void 0!==e.screen&&!0===e.screen&&!this.isScreenShareSupported())throw new oc({code:rc.INVALID_OPERATION,message:"screen capture is not supported, please use the latest chrome browser"});return new dp(e)}};return fp}()}).call(this,n(61))}}]);
//# sourceMappingURL=vendors~containers-ImLiveDetail~containers-m-LiveShare-4340ff1b.js.map