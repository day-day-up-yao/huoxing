(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{1485:function(e,t,a){"use strict";a.r(t),function(e){a(675);var n=a(676),r=a.n(n),i=(a(1381),a(1382)),o=a.n(i),s=(a(1383),a(1384)),l=a.n(s),c=(a(1376),a(1377)),u=a.n(c),p=(a(1396),a(1397)),m=a.n(p),d=(a(247),a(183)),f=a.n(d),g=(a(1388),a(1389)),h=a.n(g),v=(a(1387),a(50)),b=a.n(v),y=(a(361),a(20)),w=a.n(y),S=(a(1392),a(1393)),I=a.n(S),E=(a(678),a(363)),L=a.n(E),P=(a(184),a(1378)),C=a.n(P),j=(a(1379),a(1380)),O=a.n(j),x=a(0),k=a.n(x),T=a(246),_=a(10),N=a(1614),V=a(1398),M=(a(1606),a(11)),q=a.n(M),A=a(51),D=a.n(A),F=a(1655),R=a(248),U=a(48);a(1661);function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Y(){return(Y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function z(e,t,a,n,r,i,o){try{var s=e[i](o),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(n,r)}function B(e){return function(){var t=this,a=arguments;return new Promise(function(n,r){var i=e.apply(t,a);function o(e){z(i,n,r,o,s,"next",e)}function s(e){z(i,n,r,o,s,"throw",e)}o(void 0)})}}function J(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function W(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(t){X(e,t,a[t])})}return e}function G(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Z=O.a.Item,ee=C.a.TextArea,te=L.a.Group,ae=I.a.RangePicker,ne=[{label:"国内",value:"1"},{label:"海外",value:"2"}],re="",ie=1,oe=!1,se=function(t){function a(t){var n,r,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),r=this,i=Q(a).call(this,t),n=!i||"object"!==H(i)&&"function"!=typeof i?$(r):i,X($(n),"enterIconLoading",function(){n.setState({iconLoading:!0})}),X($(n),"insertState",function(e){e.map(function(e){n.state[e+"fileList"]=[],n.state[e+"Img"]=""})}),X($(n),"routerWillLeave",function(){return"离开页面可能会导致编辑内容丢失, 是否确认离开?"}),X($(n),"saveArticle",function(e){var t=n.props.form,a=null,r=W({},a=1===parseInt(n.state.subject)?{pc_subject:n.state.pcSubjectImg,m_subject:n.state.mSubjectImg,pc_hot_subject:n.state.pcHotSubjectImg,m_hot_subject:n.state.mHotSubjectImg}:{},{tags:n.state.tags.join(","),original:n.state.original,subject:n.state.subject,content:n.state.newsContent,audio:JSON.stringify(n.state.audioDefalutArr),video:n.state.videofileList[0]&&n.state.videofileList[0].fileUrl?JSON.stringify(n.state.videofileList):"[]",author:t.getFieldValue("author"),hotCounts:t.getFieldValue("hotCounts"),synopsis:t.getFieldValue("synopsis"),title:t.getFieldValue("title"),source:t.getFieldValue("source"),advertised:t.getFieldValue("advertised"),subTitle:t.getFieldValue("subTitle"),originalUrl:t.getFieldValue("originalUrl"),originalTitle:t.getFieldValue("originalTitle"),placeType:n.state.placeType,place:n.state.place,coverPic:JSON.stringify(W({pc_recommend:n.state.pcImg,pc:n.state.Img,wap_small:n.state.mImg,wap_big:n.state.mcImg,video_pc:n.state.videoPcImg,video_m:n.state.videoMImg},a))});localStorage.setItem("articleData",JSON.stringify(r)),e&&e(r)}),X($(n),"fileList",function(e,t){return e[t]&&""!==e[t]?[{uid:0,name:"xxx.png",status:"done",url:e[t]}]:[]}),X($(n),"renderData",function(e){var t=e.content.replace(/<style(.+)<\/style>/,"");t=t.replace(/<img[^>]*>/gi,function(e,t){e.replace(/height="(.*)"/gi,"");return e.replace(/width="(.*)"/gi,"")}),n.state.editor.clipboard.dangerouslyPasteHTML(t,"user"),n.state.editor.videoInit();var a=Object(U.G)(e.coverPic)?JSON.parse(e.coverPic):{pc_recommend:"",pc:"",wap_big:"",wap_small:"",video_pc:"",video_m:""},r=n.fileList(a,"video_pc"),i=n.fileList(a,"video_m"),o=n.fileList(a,"pc_recommend"),s=n.fileList(a,"pc"),l=n.fileList(a,"wap_small"),c=n.fileList(a,"wap_big");n.setState({updateOrNot:!0,videoPcfileList:r,videoMfileList:i,fileList:s,pcfileList:o,mfileList:l,mcfileList:c,videofileList:Object(U.G)(e.video)?JSON.parse(e.video):[],newsContent:t,Img:a.pc,allImg:a.all,pcImg:a.pc_recommend||"",mImg:a.wap_small,mcImg:a.wap_big,videoMImg:a.video_m,videoPcImg:a.video_pc,videoUrl:e.video||"",loading:!1,recommend:e.recommend||0,placeType:e.placeType})}),X($(n),"placeChange",function(e){n.setState({place:e.target.value})}),X($(n),"placeTypeChange",function(e){var t=n.props.form;"1"===e.target.value?t.setFieldsValue({placeType:"1"}):t.setFieldsValue({placeType:"2"}),n.setState({placeType:e.target.value})}),X($(n),"handleClose",function(e){var t=n.state.tags.filter(function(t){return t!==e});n.setState({tags:t})}),X($(n),"showInput",function(){n.setState({inputVisible:!0},function(){return n.input.focus()})}),X($(n),"handleInputChange",function(e){n.setState({inputValue:e.target.value})}),X($(n),"handleInputConfirm",function(){var e=n.state,t=e.inputValue,a=e.tags;t&&-1===a.indexOf(t)&&(a=[].concat(J(a),[t.slice(0,8)])),n.setState({tags:a,inputVisible:!1,inputValue:""})}),X($(n),"saveInputRef",function(e){n.input=e}),X($(n),"handleCancel",function(){return n.setState({previewVisible:!1})}),X($(n),"handlePreview",function(e){if(e.hasOwnProperty("target")){var t=e.target.getAttribute("data-type");""!==n.state[t]?n.setState({previewImage:n.state[t],previewVisible:!0}):w.a.info("请先上传图片")}else n.setState({previewImage:e.url||e.thumbUrl,previewVisible:!0})}),X($(n),"file",function(e){return new Promise(function(t){var a=new FileReader,n=new Image;a.readAsDataURL(e),a.onload=function(e){var t=e.target.result;n.src=t},t(n)})}),X($(n),"image",function(e){return new Promise(function(t){e.onload=function(){var a=e.width,n=e.height;t(a<=1300&&n<=1300)}})}),X($(n),"beforeUpload",function(){var e=B(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.file(t).then(function(e){return n.image(e)}).then(function(e){return e});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),X($(n),"handleChange",function(){var e=B(regeneratorRuntime.mark(function e(t){var a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.file,r=t.fileList,"removed"!==a.status){e.next=5;break}n.setState({Img:""}),e.next=11;break;case 5:return e.next=7,n.beforeUpload(a.originFileObj);case 7:if(e.sent){e.next=11;break}return w.a.warning("单张图片上传尺寸不能大于 1300 * 1300, 请重新选择图片或使用统一上传!"),e.abrupt("return",!1);case 11:n.setState({fileList:r}),a.response&&(1===a.response.code&&"done"===a.status&&n.setState({Img:a.response.obj}),"error"===a.status&&(w.a.error("网络错误，上传失败！"),n.setState({Img:"",fileList:[]})));case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),X($(n),"handleVideoPcChange",function(e){var t=e.file,a=e.fileList;n.setState({videoPcfileList:a}),"removed"===t.status&&n.setState({videoPcImg:""}),t.response&&(1===t.response.code&&"done"===t.status&&n.setState({videoPcImg:t.response.obj}),"error"===t.status&&(w.a.error("网络错误，上传失败！"),n.setState({videoPcImg:"",videoPcfileList:[]})))}),X($(n),"handleVideoMChange",function(e){var t=e.file,a=e.fileList;n.setState({videoMfileList:a}),"removed"===t.status&&n.setState({videoMImg:""}),t.response&&(1===t.response.code&&"done"===t.status&&n.setState({videoMImg:t.response.obj}),"error"===t.status&&(w.a.error("网络错误，上传失败！"),n.setState({videoMImg:"",videoMfileList:[]})))}),X($(n),"handlePcChange",function(){var e=B(regeneratorRuntime.mark(function e(t){var a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.file,r=t.fileList,"removed"!==a.status){e.next=5;break}n.setState({pcImg:""}),e.next=11;break;case 5:return e.next=7,n.beforeUpload(a.originFileObj);case 7:if(e.sent){e.next=11;break}return w.a.warning("单张图片上传尺寸不能大于 1300 * 1300, 请重新选择图片或使用统一上传!"),e.abrupt("return",!1);case 11:n.setState({pcfileList:r}),a.response&&(1===a.response.code&&"done"===a.status&&n.setState({pcImg:a.response.obj}),"error"===a.status&&(w.a.error("网络错误，上传失败！"),n.setState({pcImg:"",pcfileList:[]})));case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),X($(n),"handleMobileChange",function(){var e=B(regeneratorRuntime.mark(function e(t){var a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.file,r=t.fileList,"removed"!==a.status){e.next=5;break}n.setState({mImg:""}),e.next=11;break;case 5:return e.next=7,n.beforeUpload(a.originFileObj);case 7:if(e.sent){e.next=11;break}return w.a.warning("单张图片上传尺寸不能大于 1300 * 1300, 请重新选择图片或使用统一上传!"),e.abrupt("return",!1);case 11:n.setState({mfileList:r}),a.response&&(1===a.response.code&&"done"===a.status&&n.setState({mImg:a.response.obj}),"error"===a.status&&(w.a.error("网络错误，上传失败！"),n.setState({mImg:"",mfileList:[]})));case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),X($(n),"handleMobileCommentChange",function(){var e=B(regeneratorRuntime.mark(function e(t){var a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.file,r=t.fileList,"removed"!==a.status){e.next=5;break}n.setState({mcImg:""}),e.next=11;break;case 5:return e.next=7,n.beforeUpload(a.originFileObj);case 7:if(e.sent){e.next=11;break}return w.a.warning("单张图片上传尺寸不能大于 1300 * 1300, 请重新选择图片或使用统一上传!"),e.abrupt("return",!1);case 11:n.setState({mcfileList:r}),a.response&&(1===a.response.code&&"done"===a.status&&n.setState({mcImg:a.response.obj}),"error"===a.status&&(w.a.error("网络错误，上传失败！"),n.setState({mcImg:"",mcfileList:[]})));case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),X($(n),"handleMp3",function(e){var t=e.file,a=e.fileList;t.response&&(1===t.response.code&&n.setState({mp3fileList:a},function(){}),"error"===t.status&&w.a.error("网络错误，上传失败！"))}),X($(n),"handleUpload",function(){var e=n.state.videoList[0],t=e.size,a=Math.ceil(t/2097152),r=new FormData;r.append("fileName",e.name),r.append("blockCount",a),r.append("currIndex",ie),r.append("uploadId",re),r.append("uploadFile",null),r.append("type","video"),n.setState({uploading:!0}),n.UploadPost(e,r,t,a,2097152)}),X($(n),"UploadPost",function(e,t,a,r,i){if(!oe)try{var o=(ie-1)*i,s=Math.min(a,o+i),l=e.slice(o,s);t.set("uploadFile",l),t.set("currIndex",ie),t.set("uploadId",re),Object(U.l)("post","/file/upload",t,function(o){if(1===o.code){1===ie&&(re=o.obj);var s=ie/r*100;ie+1===r&&(s=100),n.setState({progressNum:parseFloat(s.toFixed(2))}),ie<r&&(ie+=1,n.UploadPost(e,t,a,r,i))}else if(o.code<0)re="",ie=1,w.a.error(o.msg);else if(2===o.code){re="",ie=1;var l=n.state.videofileList,c=[];l.map(function(e,t){c.push({uid:e.uid,fileName:e.name,name:e.name,fileUrl:o.obj})}),n.setState({videoList:[],videofileList:c,uploading:!1}),w.a.success("文件上传成功!")}})}catch(e){console.log(e)}}),X($(n),"newsVisibleHide",function(){n.setState({newsVisible:!1})}),X($(n),"newsVisibleShow",function(){n.setState({newsVisible:!0})}),X($(n),"normFile",function(e){return Array.isArray(e)?e:e&&e.fileList}),X($(n),"delAudio",function(e){var t=n.state.audioDefalutArr;t.map(function(a,n){a.uid.toString()===e.toString()&&t.splice(n,1)}),n.setState({audioDefalutArr:t})}),X($(n),"delPost",function(){re="",ie=1,n.setState({videoList:[],videofileList:[],uploading:!1})}),X($(n),"uploadAllImg",function(t){var a=t.file,r=t.fileList,i=$(n);if(a.size/1048576>=2)return w.a.error("图片大小超过 2M , 请重新选择!"),n.setState({allfilelist:[],allImg:""}),!1;n.setState({allfileList:r}),"removed"===a.status&&(n.setState({allfilelist:[],allImg:""}),n.state.cropImgRule.map(function(e,t){var a;i.setState((X(a={},e.coverName,""),X(a,e.coverList,[]),a))})),a.response&&(1===a.response.code&&"done"===a.status&&n.setState({allImg:a.response.obj,uploadAllImgModal:!0,focusImg:-1},function(){var t=document.querySelector("#croppedImg");t.src=a.thumbUrl,i.setState({cropper:new V.a(t,{aspectRatio:n.state.ratio,viewMode:1,crop:function(t){var a=this.cropper.getCroppedCanvas({maxWidth:800}).toDataURL("image/jpeg"),n=e(".crop-preview-item"),r=i.state.focusImg;-1===r?n.each(function(t,n){e(this).children("img").attr("src",a)}):n.eq(r).children("img").attr("src",a)}})})}),"error"===a.status&&(w.a.error("网络错误，上传失败！"),n.setState({allImg:"",allfileList:[]})))}),X($(n),"sureCropImg",function(){var t=$(n),a=0;n.setState({uploadAllImgModal:!1,loading:!0}),w.a.warning("上传中，请稍候！"),n.state.cropper.destroy(),e(".crop-preview-item").each(function(n,r){var i=this;setTimeout(function(){var n,r=e(i).data("type"),o=e(i).data("list");t.setState((X(n={},r,""),X(n,o,[]),n));var s=Object(U.r)(e(i).find("img").prop("src")),l=new FormData;l.append("uploadFile",s),e.ajax("".concat(U.a,"/pic/upload"),{headers:{"Sign-Param":Object(U.A)()},method:"POST",data:l,processData:!1,timeout:2e4,contentType:!1,success:function(e){var n;4===(a+=1)&&(t.setState({loading:!1}),w.a.success("上传完毕！")),t.setState((X(n={},r,e.obj),X(n,o,[{uid:0,name:"xxx.png",status:"done",url:e.obj}]),n),function(){})},error:function(e,a){t.setState({loading:!1}),"timeout"===a?w.a.error("上传超时, 请检查网络后重新上传！"):w.a.error("上传发生错误, 请尝试重新上传！"),e.abort()}})},500*n)})}),X($(n),"uploadAllImgCancel",function(){n.setState({uploadAllImgModal:!1}),n.state.cropper.destroy()}),X($(n),"selectTime",function(e){}),X($(n),"handleSubmit",function(t){t.preventDefault(),n.enterIconLoading();var a=t.target.getAttribute("data-status"),r=n.state.updateOrNot&&(n.props.location.query.id||n.props.location.query.url);return e(".simditor").find("img.uploading").length>0?(w.a.warning("编辑器中图片正在上传, 请稍候提交!"),n.setState({iconLoading:!1}),!1):n.state.uploading?(w.a.warning("视频正在上传, 请稍候提交!"),n.setState({iconLoading:!1}),!1):void n.setState({audioDefalutArr:[]},function(){var e=this;this.props.form.setFieldsValue({recommend:this.state.recommend,content:this.state.newsContent,pc_recommend:this.state.pcImg,pc:this.state.Img,wap_small:this.state.mImg,wap_big:this.state.mcImg}),this.props.form.validateFieldsAndScroll(function(t,n){t?e.setState({iconLoading:!1}):(e.setState({loading:!0}),n.startTime=Date.parse(n.publishTime[0].format("YYYY-MM-DD HH:mm:ss")),n.endTime=Date.parse(n.publishTime[1].format("YYYY-MM-DD HH:mm:ss")),n.coverPic=JSON.stringify({pc_recommend:n.pc_recommend||"",pc:n.pc,wap_big:n.wap_big,wap_small:n.wap_small,video_pc:e.state.videoPcImg,video_m:e.state.videoMImg}),delete n.pc,delete n.pc_recommend,delete n.wap_big,delete n.wap_small,delete n.video_pc,delete n.video_m,delete n.alignLeft,delete n.wordBreak,delete n.watermark,delete n.publishTime,n.id=e.props.location.query.id||"",n.status=a||1,(!e.state.updateOrNot||!e.props.location.query.id)&&delete n.id,Object(U.i)("post","".concat(e.state.updateOrNot&&e.props.location.query.id?"/activity/update":"/activity/add"),n,function(t){e.setState({loading:!1}),t.code&&1===t.code?(w.a.success(r?"修改成功！":"添加成功！"),!r&&localStorage.removeItem("articleData"),_.hashHistory.push("/activityPublish-list")):(e.setState({iconLoading:!1}),w.a.error(t.msg))}))})})}),X($(n),"sendPost",function(e){var t=n.state,a=t.wordBreak,r=t.alignLeft,i='<style type="text/css"> .details .details-cont p, p {word-break: '.concat(a?"break-all !important":"normal","; text-align: ").concat(r?"left !important":"unset","} p img {text-align: center !important;} </style>"),o={newsTitle:e.postTitle||"",newsContent:"<div class=".concat(r?"simditorSupport":"",">").concat(i).concat(e.postContent,"</div>")||!1};n.setState(W({},n.state,o))}),X($(n),"createMarkup",function(e){return{__html:e}}),X($(n),"CropperImgCroped",function(e){console.log(e)}),X($(n),"FormItem",function(e){var t=n.state.updateOrNot,a=n.props.form.getFieldDecorator,r=k.a.createElement("div",null,k.a.createElement(b.a,{type:"plus"}),k.a.createElement("div",{className:"ant-upload-text"},"上传图片"));return k.a.createElement(Z,Y({},{labelCol:{span:1},wrapperCol:{span:15,offset:1}},{label:e.label}),k.a.createElement("div",{className:"dropbox"},a(e.imgName,{initialValue:t&&e.activityPublishInfo?e.fileList:"",rules:[{required:e.require,message:"请上传".concat(e.label,"封面！")}]})(k.a.createElement(h.a,{headers:{"Sign-Param":Object(U.A)()},action:"".concat(U.a,"/pic/upload"),name:"uploadFile",listType:"picture-card",fileList:e.fileList,onPreview:n.handlePreview,onChange:e.changeEvent},e.fileList.length>=1?null:r)),e.noBtn?"":k.a.createElement(f.a,{"data-type":e.imgUrl,onClick:n.handlePreview,className:"img-preview",type:"primary"},"预览"),k.a.createElement("span",{className:"cover-img-tip"},"用于 ",e.label," 的封面展示, 建议尺寸: ",k.a.createElement("font",{style:{color:"red"}},e.size))))}),n.state={editor:"",updateOrNot:!1,tags:[],mp3fileList:[],videofileList:[],videoList:[],audioDefalutArr:[],inputVisible:!1,inputValue:"",isLogin:!1,place:"北京",newsVisible:!1,placeType:"1",previewVisible:!1,previewImage:"",newsTitle:"",newsContent:"",mp3Url:"",videoUrl:"",uploading:!1,progressNum:0,loading:!0,recommend:0,advertised:0,subject:0,uploadAllImgModal:!1,cropper:null,focusImg:-1,ratio:2,cropImgRule:[{coverName:"pcImg",coverList:"pcfileList",width:"800px",height:"200px",ratio:4,intro:"PC端推荐位新闻封面:1200 * 300"},{coverName:"mcImg",coverList:"mcfileList",width:"320px",height:"230px",ratio:640/460,intro:"M端推荐新闻的滚动:640 * 460"},{coverName:"Img",coverList:"fileList",width:"256px",height:"186px",ratio:1.375,intro:"PC 端新闻封面:385 * 280"},{coverName:"mImg",coverList:"mfileList",width:"200px",height:"145px",ratio:255/185,intro:"M端新闻封面:255 * 185"}],width:0,height:0,wordBreak:0,alignLeft:0,iconLoading:!1,interval:0},n}var n,i,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(a,x["Component"]),n=a,(i=[{key:"componentWillMount",value:function(){D.a.set("watermark",0),this.insertState(["mHotSubject","pcHotSubject","mSubject","pcSubject","videoPc","videoM","all","","pc","m","mc"])}},{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.dispatch,n=t.location;a(Object(R.e)()),n.query.id?(this.setState({loading:!0}),a(Object(F.b)({id:n.query.id},function(t){e.renderData(t)}))):this.setState({loading:!1})}},{key:"componentWillUnmount",value:function(){var e=this.state.interval;this.setState({interval:clearInterval(e)})}},{key:"changeActiveImg",value:function(e,t,a){var n=this;if(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),a===this.state.focusImg)return!1;this.setState({ratio:t.ratio,focusImg:a},function(){n.state.cropper.setAspectRatio(t.ratio)})}},{key:"render",value:function(){var e=this,t=this,a=this.props.form.getFieldDecorator,n=this.props.activityPublishInfo,i=this.state,s=i.focusImg,c=i.allfileList,p=i.uploadAllImgModal,d=i.previewVisible,g=i.previewImage,v=i.fileList,y=i.pcfileList,w=i.mfileList,S=i.mcfileList,I=i.newsContent,E=i.updateOrNot,L=i.newsVisible,P={labelCol:{span:1},wrapperCol:{span:20,offset:1}},j=k.a.createElement("div",null,k.a.createElement(b.a,{type:"plus"}),k.a.createElement("div",{className:"ant-upload-text"},"上传图片"));return k.a.createElement("div",{className:"activityPublish-send"},k.a.createElement(r.a,{spinning:this.state.loading,size:"large"},k.a.createElement(O.a,{onSubmit:this.handleSubmit},k.a.createElement(Z,Y({},P,{label:"主办方: "}),a("sponsor",{initialValue:E&&n&&n.sponsor||"",rules:[{required:!0,message:"请输入活动主办方！"}]})(k.a.createElement(C.a,{className:"news-source",placeholder:"请输入活动主办方"}))),k.a.createElement(Z,Y({},P,{label:"场地类型: "}),a("placeType",{initialValue:E&&n?"".concat(n.placeType||"1"):"1"})(k.a.createElement(te,{options:ne,onChange:this.placeTypeChange,setFieldsValue:this.state.placeType}))),k.a.createElement(Z,Y({},P,{label:"举办城市: "}),a("place",{initialValue:E&&n&&n.place||"",rules:[{required:!0,message:"请输入活动举办城市！"},{pattern:/^[^\s]+$/,message:"禁止输入空格！"}]})(k.a.createElement(C.a,{disabled:!this.state.place,className:"news-source",placeholder:"请输入活动举办城市, 不能含有空格"}))),k.a.createElement(Z,Y({},P,{label:"详细地址: "}),a("detailPlace",{initialValue:E&&n&&n.detailPlace||"",rules:[{required:!0,message:"请输入活动详细地址！"}]})(k.a.createElement(C.a,{disabled:!this.state.place,className:"news-source",placeholder:"请输入活动详细地址"}))),k.a.createElement(Z,Y({},P,{label:"报名链接: "}),a("url",{initialValue:E&&n?"".concat(n.url||""):"",rules:[{type:"url",message:"请输入正确的超链接！"},{required:!1,message:"请输入报名链接！"}]})(k.a.createElement(C.a,{className:"news-source",placeholder:"请输入报名链接"}))),k.a.createElement(Z,Y({},P,{label:"活动时间: "}),a("publishTime",{rules:[{required:!0,message:"请选择活动时间！"}],initialValue:E&&n?[q()(Object(U.w)(n.startTime||Date.parse(new Date)),"YYYY-MM-DD HH:mm:ss"),q()(Object(U.w)(n.endTime||Date.parse(new Date)),"YYYY-MM-DD HH:mm:ss")]:[]})(k.a.createElement(ae,{placeholder:["开始时间","结束时间"],showTime:!0,onOk:this.selectTime,format:"YYYY-MM-DD HH:mm:ss"}))),k.a.createElement(Z,Y({},P,{label:"联系方式: "}),a("connection",{initialValue:E&&n&&n.connection||"",rules:[{required:!0,message:"请输入活动联系方式！"}]})(k.a.createElement(C.a,{className:"news-source",placeholder:"请输入活动联系方式"}))),k.a.createElement(Z,Y({},P,{label:"费用: "}),a("fee",{initialValue:E&&n&&n.fee||"",rules:[{required:!1,message:"请输入活动费用！"}]})(k.a.createElement(C.a,{className:"news-source",placeholder:"请输入活动费用"}))),k.a.createElement(Z,Y({},P,{label:"人数: "}),a("numPeople",{initialValue:E&&n&&n.numPeople||"",rules:[{required:!1,message:"请输入活动人数！"},{pattern:/^[1-9]\d*$/,message:"请输入正整数！"}]})(k.a.createElement(C.a,{className:"news-source",placeholder:"请输入活动人数"}))),k.a.createElement(Z,Y({},P,{label:"活动标题: "}),a("title",{initialValue:E&&n?"".concat(n.title):"",rules:[{required:!0,message:"请输入活动标题！"}]})(k.a.createElement(C.a,{placeholder:"活动标题"}))),k.a.createElement(Z,Y({},P,{label:"活动特色: "}),a("synopsis",{initialValue:E&&n?"".concat(n.synopsis):"",rules:[{max:120,required:!0,message:"请输入活动特色, 最多120字！"}]})(k.a.createElement(ee,{rows:4,className:"news-summary",placeholder:"活动特色(简介), 最多120字"}))),k.a.createElement(Z,Y({},P,{label:"文章左对齐: "}),a("alignLeft",{initialValue:!1,valuePropName:"checked"})(k.a.createElement(m.a,{onChange:function(t){e.setState({alignLeft:t?1:0},function(){e.sendPost({postTitle:e.state.newsTitle,postContent:e.state.editor.getValue()})})},checkedChildren:"是",unCheckedChildren:"否"}))),k.a.createElement(Z,Y({},P,{label:"英文强制换行: "}),a("wordBreak",{initialValue:!1,valuePropName:"checked"})(k.a.createElement(m.a,{onChange:function(t){e.setState({wordBreak:t?1:0},function(){e.sendPost({postTitle:e.state.newsTitle,postContent:e.state.editor.getValue()})})},checkedChildren:"是",unCheckedChildren:"否"}))),k.a.createElement(Z,Y({},P,{label:"图片加水印: "}),a("watermark",{initialValue:!1,valuePropName:"checked"})(k.a.createElement(m.a,{onChange:function(e){e?D.a.set("watermark",1):D.a.set("watermark",0)},checkedChildren:"是",unCheckedChildren:"否"}))),k.a.createElement(Z,Y({},P,{label:"活动内容: "}),a("content",{initialValue:E&&n?I:"",rules:[{required:!0,message:"请输入活动内容！"}]})(k.a.createElement(C.a,{className:"news",style:{display:"none"}})),k.a.createElement("div",{className:"media-quill-editor"},k.a.createElement(N.a,{setEditor:function(t){e.setState({editor:t})},subSend:function(t){return e.sendPost(t)}}))),k.a.createElement(Z,Y({},P,{label:"统一上传图片: "}),k.a.createElement("div",{className:"dropbox"},k.a.createElement(h.a,{headers:{"Sign-Param":Object(U.A)()},action:"".concat(U.a,"/pic/upload"),name:"uploadFile",listType:"picture-card",fileList:c,onPreview:this.handlePreview,onChange:this.uploadAllImg},c.length>=1?null:j),k.a.createElement("span",{className:"cover-img-tip all-img"},"统一上传所有尺寸图片，自动剪裁适配尺寸"))),this.FormItem({imgName:"pc",label:"PC-缩略图",imgUrl:"Img",activityPublishInfo:n,fileList:v,changeEvent:this.handleChange,size:"385 * 280",noBtn:!1,require:!0}),this.FormItem({imgName:"pc_recommend",label:"PC-推荐位",imgUrl:"pcImg",activityPublishInfo:n,fileList:y,changeEvent:this.handlePcChange,size:"1200 * 300",noBtn:!1,require:!1}),this.FormItem({imgName:"wap_small",label:"M-缩略图",imgUrl:"mImg",activityPublishInfo:n,fileList:w,changeEvent:this.handleMobileChange,size:"255 * 185",noBtn:!1,require:!0}),this.FormItem({imgName:"wap_big",label:"M-推荐位",imgUrl:"mcImg",activityPublishInfo:n,fileList:S,changeEvent:this.handleMobileCommentChange,size:"640 * 460",noBtn:!1,require:!1}),k.a.createElement(Z,Y({},P,{label:"是否推荐: "}),a("recommend",{initialValue:!(!E||!n.recommend)&&1===parseInt(n.recommend),valuePropName:"checked"})(k.a.createElement(m.a,{onChange:function(t){e.setState({recommend:t?1:0})},checkedChildren:"是",unCheckedChildren:"否"}))),k.a.createElement(Z,{wrapperCol:{span:12,offset:2}},k.a.createElement(f.a,{type:"primary",onClick:this.newsVisibleShow,className:"preview",style:{marginRight:"10px",marginBottom:10}},"活动内容预览"),k.a.createElement(f.a,{loading:this.state.iconLoading,type:"primary","data-status":"1",onClick:this.handleSubmit,style:{marginRight:"10px"}},"发布"),k.a.createElement(f.a,{type:"primary","data-status":"0",onClick:this.handleSubmit,style:{marginRight:"10px"}},"待发布"),k.a.createElement(f.a,{type:"primary",className:"cancel",onClick:function(){_.hashHistory.goBack()}},"取消")),k.a.createElement(u.a,{height:"700px",width:"1400px",style:{top:"50px"},visible:p,onOk:this.sureCropImg,maskClosable:!1,onCancel:this.uploadAllImgCancel},k.a.createElement("div",{className:"croper-wrap activityPub clearfix"},k.a.createElement("div",{className:"crop-img",id:"cropImgWrap"},k.a.createElement("img",{id:"croppedImg",src:"",alt:"Picture"})),k.a.createElement("div",{onClick:function(t){t.stopPropagation(),t.nativeEvent.stopImmediatePropagation(),e.setState({focusImg:-1})},className:"crop-preview"},this.state.cropImgRule.map(function(e,a){return k.a.createElement("div",{key:a,onClick:function(n){t.changeActiveImg(n,e,a)},className:"cropper-intro"},k.a.createElement("div",{className:"cropper-item-wrap ".concat(s===a?"active":"")},k.a.createElement("div",{"data-type":e.coverName,"data-list":e.coverList,className:"crop-preview-item",style:{fontSize:0,width:e.width,height:e.height}},k.a.createElement("img",{src:"",alt:"",style:{width:"100%",height:"100%"}}))),k.a.createElement("span",null,e.intro))})))),k.a.createElement(u.a,{visible:L,footer:null,className:"newsModal",onCancel:this.newsVisibleHide,width:1e3},k.a.createElement(o.a,null,k.a.createElement(l.a,{className:"previewNews simditor"},k.a.createElement("p",{className:"simditor-body",style:{padding:10},dangerouslySetInnerHTML:this.createMarkup(I)})))),k.a.createElement(u.a,{visible:d,footer:null,onCancel:this.handleCancel},k.a.createElement("img",{alt:"example",style:{width:"100%"},src:g})))))}}])&&G(n.prototype,i),s&&G(n,s),a}();t.default=Object(T.connect)(function(e){return{userInfo:e.activityPublishInfo.userInfo,activityPublishInfo:e.activityPublishInfo.info,placeList:e.placeListInfo}})(O.a.create()(se))}.call(this,a(97))},1614:function(e,t,a){"use strict";a.d(t,"a",function(){return v});var n=a(0),r=a.n(n),i=a(1402),o=a.n(i),s=a(248);a(1615);function l(e,t,a,n,r,i,o){try{var s=e[i](o),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(n,r)}function c(e){return function(){var t=this,a=arguments;return new Promise(function(n,r){var i=e.apply(t,a);function o(e){l(i,n,r,o,s,"next",e)}function s(e){l(i,n,r,o,s,"throw",e)}o(void 0)})}}function u(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var g=o.a.import("delta"),h=function(e){var t=this.quill.getSelection(!0),a=this.quill.getContents(t.index,t.length),n=(new g).retain(t.index+t.length);a.ops=a.ops.map(function(e){if(!e.insert)return e;if("object"!==f(e.insert))return{insert:e.insert};switch(Object.keys(e.insert)[0]){case"LinkBlot":return{insert:e.insert.LinkBlot.text};default:return{insert:e.insert}}}),n=n.concat(a),this.quill.updateContents(n,o.a.sources.USER),this.quill.deleteText(t.index,t.length),this.quill.videoInit()},v=function(e){function t(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=p(this,m(t).call(this,e));var n=e.toolbar;return a.toolbarOptions=n||[[{header:[1,2,3,4,!1]}],[{header:2},"bold","italic","underline","strike"],["blockquote"],[{color:[]},{background:[]}],[{align:[]}],[{list:"ordered"},{list:"bullet"}],["link","image","video"],["clean"],["sourceEditor"]],a.state={editor:null,fullscreen:!1},a}var a,i,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,n["Component"]),a=t,(i=[{key:"componentDidMount",value:function(){var e=this,t={modules:{toolbar:{container:this.toolbarOptions,handlers:{clean:h}},imageResize:{},clipboard:{imageUpload:function(){var e=c(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,Object(s.p)([{signTime:(new Date).getTime(),imgSrc:t||""}]);case 3:if(!((a=e.sent)&&a.code&&1===a.code&&a.obj[0]&&a.obj[0].imgSrc)){e.next=6;break}return e.abrupt("return",a.obj[0].imgSrc);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),paste:function(t){e.props.state&&e.props.paste(t)},matchVisual:!1},mediaUploader:{imageUpload:function(){var e=c(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,Object(s.c)({type:"news",uploadFile:t});case 3:if(!(a=e.sent)||1!==a.code){e.next=6;break}return e.abrupt("return",a.obj);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),videoUpload:function(){var e=c(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.d)({file:t});case 2:if(!(a=e.sent)){e.next=5;break}return e.abrupt("return",a);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}},placeholder:"请输入文章内容",theme:"snow"},a=new o.a("#editorQuill",t);a.on("text-change",function(t,n,r){e.props.subSend({postContent:a.root.innerHTML})}),this.props.setEditor&&this.props.setEditor(a),this.setState({editor:a});var n=document.createElement("span");n.setAttribute("class","ql-formats ql-fullscreen-formats");var r=document.createElement("button");r.setAttribute("type","button"),r.setAttribute("class","ql-fullscreen"),r.innerHTML='<svg class="ql-fullscreen-svg" viewBox="0 0 1024 1024"><path d="M160 96h192q14.016 0.992 23.008 10.016t8.992 22.496-8.992 22.496T352 160H160v192q0 14.016-8.992 23.008T128 384t-23.008-8.992T96 352V96h64z m0 832H96v-256q0-14.016 8.992-23.008T128 640t23.008 8.992T160 672v192h192q14.016 0 23.008 8.992t8.992 22.496-8.992 22.496T352 928H160zM864 96h64v256q0 14.016-8.992 23.008T896 384t-23.008-8.992T864 352V160h-192q-14.016 0-23.008-8.992T640 128.512t8.992-22.496T672 96h192z m0 832h-192q-14.016-0.992-23.008-10.016T640 895.488t8.992-22.496T672 864h192v-192q0-14.016 8.992-23.008T896 640t23.008 8.992T928 672v256h-64z" p-id="8486"></path></svg>',n.appendChild(r),document.querySelector(".ql-toolbar").appendChild(n),document.addEventListener("click",function(t){var a=t.target.getAttribute("class");a&&a.indexOf("ql-fullscreen")>-1&&e.setState({fullscreen:!e.state.fullscreen})},!1)}},{key:"render",value:function(){return r.a.createElement("div",{className:"editor-quill-box ".concat(this.state.fullscreen?"active":"")},r.a.createElement("div",{className:"editor-quill-cotent"},r.a.createElement("div",{id:"editorQuill"})))}}])&&u(a.prototype,i),l&&u(a,l),t}()},1615:function(e,t,a){var n=a(1616);"string"==typeof n&&(n=[[e.i,n,""]]);var r={transform:void 0};a(186)(n,r);n.locals&&(e.exports=n.locals)},1616:function(e,t,a){(e.exports=a(185)(!1)).push([e.i,"",""])},1655:function(e,t,a){"use strict";(function(e){a.d(t,"d",function(){return c}),a.d(t,"c",function(){return u}),a.d(t,"b",function(){return p}),a.d(t,"a",function(){return d}),a.d(t,"g",function(){return f}),a.d(t,"e",function(){return g}),a.d(t,"f",function(){return h});a(361);var n=a(20),r=a.n(n),i=a(48),o=a(2);function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(t){l(e,t,a[t])})}return e}function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var c=function(e){return{type:o.xb,data:e}},u=function(e,t,a){return function(n){var o="init"===e?"/activity/list":"/post/search";Object(i.i)("get",o,t?s({},t):{},function(e){if(1===e.code){var t=e.obj;n(m({list:t.inforList})),n(h({totalCount:t.recordCount,pageSize:t.pageSize,currPage:t.currentPage})),a&&a(t)}else e.msg&&r.a.error(e.msg)})}},p=function(e,t){return function(a){Object(i.i)("post","/activity/getbyid",s({},e),function(e){if(1===e.code){var n=e.obj;a(m({info:n})),t&&t(n)}else r.a.error(e.msg)})}},m=function(e){return{type:o.c.ADD_DATA,data:e}},d=function(e,t){return{type:o.c.EDIT_LIST_ITEM,data:e,index:t}},f=function(e){return{type:o.c.SET_SEARCH_QUERY,data:e}},g=function(e){return{type:o.c.SET_FILTER_DATA,data:e}},h=function(e){return{type:o.c.SET_PAGE_DATA,data:e}}}).call(this,a(97))}}]);