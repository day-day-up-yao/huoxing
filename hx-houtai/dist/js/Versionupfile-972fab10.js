(window.webpackJsonp=window.webpackJsonp||[]).push([[189],{1499:function(e,t,n){"use strict";n.r(t);n(681);var a=n(682),o=n.n(a),i=(n(1388),n(1389)),r=n.n(i),l=(n(247),n(183)),s=n.n(l),p=(n(1387),n(50)),u=n.n(p),c=(n(184),n(1378)),d=n.n(c),f=(n(1381),n(1382)),m=n.n(f),v=(n(1383),n(1384)),h=n.n(v),b=(n(361),n(20)),y=n.n(b),g=(n(1379),n(1380)),w=n.n(g),O=n(0),E=n.n(O),L=n(246),j=n(48),S=n(10);n(1664);function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(){return(I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function U(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=w.a.Item,T="",x=1,M=!1,V=function(e){function t(){var e,n,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,a=C(t).call(this),e=!a||"object"!==k(a)&&"function"!=typeof a?P(n):a,_(P(e),"handleUpload",function(){if(""!==e.state.password&&"passwordAPP"===e.state.password){var t=e.state,n=t.videoList,a=t.id,o=n[0],i=o.size,r=Math.ceil(i/2097152),l=new FormData;l.append("id",a),l.append("fileName",o.name),l.append("blockCount",r),l.append("currIndex",x),l.append("uploadId",T),l.append("uploadFile",null),l.append("password","passwordAPP"),l.append("channel","web"),l.append("type",""),e.setState({uploading:!0}),e.UploadVideo(o,l,i,r,2097152)}else alert("请输入正确的密码")}),_(P(e),"UploadVideo",function(t,n,a,o,i){if(!M)try{var r=(x-1)*i,l=Math.min(a,r+i),s=t.slice(r,l);n.set("uploadFile",s),n.set("currIndex",x),n.set("uploadId",T),Object(j.l)("post","/app/upload",n,function(r){if(r.request)return clearInterval(e.timeOut),e.timeOut=setTimeout(function(){e.UploadVideo(t,n,a,o,i)},1e4),!1;if(r.response)return/^(5|4)\d{2}/.test(r.response.status)&&(clearInterval(e.timeOut),e.timeOut=setTimeout(function(){e.UploadVideo(t,n,a,o,i)},1e4)),!1;if(1===r.code){clearInterval(e.timeOut),1===x&&(T=r.obj);var l=x/o*100;x+1===o&&(l=99),e.setState({progressNum:parseFloat(l.toFixed(2))}),x<o&&(x+=1,e.UploadVideo(t,n,a,o,i))}else if(r.code<0)T="",x=1,y.a.error(r.msg);else if(2===r.code){clearInterval(e.timeOut),T="",x=1;var s=e.state.videofileList,p=[];s.map(function(e,t){p.push({uid:e.uid,fileName:e.name,name:e.name,fileUrl:r.obj})}),e.setState({fileUrl:r.obj,videoList:[],videofileList:p,uploading:!1}),y.a.success("文件上传成功!")}})}catch(e){console.log(e)}}),_(P(e),"handleSubmit",function(){S.hashHistory.push("/version-list")}),_(P(e),"handleChangeMd5",function(t){e.setState({password:t.target.value})}),e.state={updateOrNot:!1,uploading:!1,apkfileList:[],apkList:[],fileUrl:null,progressNum:0,videofileList:[],videoList:[],id:null,password:""},e}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(t,O["Component"]),n=t,(a=[{key:"componentDidMount",value:function(){var e=this.props.location;this.setState({id:e.query.id})}},{key:"render",value:function(){var e=this,t={labelCol:{span:4},wrapperCol:{span:8,offset:1}},n=this.props.versionInfo;console.log(n);var a=this.props.form.getFieldDecorator,i=this.state,l=i.progressNum,p=i.videofileList,c=i.uploading,f={action:"/file/upload",accept:"application/vnd.android.package-archive",onRemove:function(t){e.setState(function(e){var n=e.fileList,a=n.indexOf(t),o=n.slice();return o.splice(a,1),{videoList:o,videofileList:o}})},beforeUpload:function(t){return e.setState({videoList:[t],videofileList:[t]}),!1},fileList:this.state.videofileList};return E.a.createElement("div",null,E.a.createElement(w.a,null,E.a.createElement(m.a,null,E.a.createElement(h.a,{span:4},E.a.createElement("div",{className:"updateTitle"},"官网安装包上传")),E.a.createElement(h.a,{span:8})),E.a.createElement(F,I({},t,{label:"密码"}),E.a.createElement(d.a,{placeholder:"请输入上传密码",onChange:this.handleChangeMd5})),E.a.createElement(F,I({},t,{label:"文件："}),a("url",{rules:[{required:!0,message:"请上传安装包！"}]})(E.a.createElement(r.a,I({},f,{name:"uploadFile"}),E.a.createElement(s.a,null,E.a.createElement(u.a,{type:"upload"}),"选择安装包"))),0===p.length?"":p[0].fileName?E.a.createElement("div",null,E.a.createElement("a",{href:e.state.fileUrl,title:""},e.state.fileName)):void 0,E.a.createElement(s.a,{style:{marginTop:16},className:"upload-demo-start",type:"primary",onClick:this.handleUpload,disabled:0===this.state.videoList.length,loading:c},c?"上传中":"开始上传"),c&&E.a.createElement(o.a,{strokeWidth:5,style:{width:300,display:"block"},percent:l,status:"active"})),E.a.createElement(F,{wrapperCol:{span:12,offset:3}},E.a.createElement(s.a,{type:"primary",onClick:this.handleSubmit},"回到列表"))))}}])&&U(n.prototype,a),i&&U(n,i),t}();t.default=Object(L.connect)(function(e){return{versionInfo:e.versionInfo.info}})(w.a.create()(V))}}]);