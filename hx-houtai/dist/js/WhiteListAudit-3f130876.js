(window.webpackJsonp=window.webpackJsonp||[]).push([[198],{1579:function(e,t,a){"use strict";a.r(t);a(1396);var n=a(1397),r=a.n(n),i=(a(675),a(676)),o=a.n(i),s=(a(1385),a(1386)),c=a.n(s),l=(a(1381),a(1382)),u=a.n(l),h=(a(1383),a(1384)),p=a.n(h),d=(a(247),a(183)),m=a.n(d),f=(a(184),a(1378)),g=a.n(f),b=(a(361),a(20)),k=a.n(b),y=(a(1376),a(1377)),v=a.n(y),S=a(0),E=a.n(S),w=a(246),O=(a(1627),a(48)),N=a(2),P=function(e,t){return function(a){Object(O.i)("post","/author/whitelist/list",e,function(e){if(1===e.code){var n=e.obj;a({type:N.l.WHITE_LIST,data:n}),a(j({totalCount:n.recordCount,pageSize:n.pageSize,currPage:n.currentPage})),t&&t(n)}else k.a.error(e.msg)})}},j=function(e){return{type:N.l.PAGE_DATA,data:e}};function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(t){B(e,t,a[t])})}return e}function x(e,t,a,n,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void a(e)}s.done?t(c):Promise.resolve(c).then(n,r)}function I(e){return function(){var t=this,a=arguments;return new Promise(function(n,r){var i=e.apply(t,a);function o(e){x(i,n,r,o,s,"next",e)}function s(e){x(i,n,r,o,s,"throw",e)}o(void 0)})}}function W(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function B(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var H=v.a.confirm,M=[],T=function(e){function t(){var e,a,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,n=_(t).call(this),e=!n||"object"!==C(n)&&"function"!=typeof n?z(a):n,B(z(e),"openNotWhiteListUser",I(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:Object(O.i)("get","/author/nonwhitelist/canPublish",{},function(t){if(1===t.code){var a=t.obj.nonCanPublish,n=a?"关闭":"开启";console.log("打开弹窗是：".concat(n)),e.setState({visibleBlack:!0,whiteListStatus:!a})}});case 1:case"end":return t.stop()}},t)}))),B(z(e),"setNotWhiteListUser",I(regeneratorRuntime.mark(function t(){var a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=e.state.whiteListStatus?"打开":"关闭",console.log("获取值确定：".concat(a)),Object(O.i)("get","/author/nonwhitelist/canPublish",{canPublish:"关闭"===a?1:0},function(t){1===t.code?e.setState({visibleBlack:!1}):k.a.error(t.msg)});case 3:case"end":return t.stop()}},t)}))),B(z(e),"chanageWhiteListStatus",function(){console.log("改变值"+!e.state.whiteListStatus),e.setState({whiteListStatus:!e.state.whiteListStatus})}),B(z(e),"handleCancelBlack",function(t){e.setState({visibleBlack:!1})}),B(z(e),"setPhone",function(t){e.setState({phone:t.target.value,authorInfo:{}})}),B(z(e),"inquireWhiteList",function(){if(!Object(O.I)(e.state.phone))return k.a.error("请输入正确的手机号！");Object(O.i)("post","/author/whitelist/queryAccount",{phonenum:e.state.phone},function(t){1===t.code?(k.a.success("查询成功！"),e.setState({nickName:t.obj.nickName,introduce:t.obj.introduce?t.obj.introduce:"",remarks:t.obj.remarks?t.obj.remarks:"暂无备注"})):-1===t.code&&k.a.error("未查到入驻的MarsBit专栏！")})}),B(z(e),"handleOk",function(t){var a=e.state,n=a.phone,r=a.isEdit,i=a.passportId;if(""===n.trim()||11!==n.length)return k.a.error("输入手机号有误，请检查后重新提交！"),!1;console.log(e.state.remarks),r?Object(O.i)("post","/author/whitelist/update",{phonenum:n,passportId:i,remarks:e.state.remarks},function(t){if(1===t.code){k.a.success("添加成功！"),e.setState({visible:!1,phone:"",name:"",nickName:"",remarks:""});var a=e.props.dispatch,n=z(e);a(P({currentPage:1,pageSize:20,search:""},function(){n.setState({loading:!1})}))}else-1===t.code?k.a.error("添加失败！"):k.a.error(t.msg)}):Object(O.i)("post","/author/whitelist/add",{phonenum:n,remarks:e.state.remarks},function(t){if(1===t.code){k.a.success("添加成功！"),e.setState({visible:!1,phone:"",name:"",nickName:""});var a=e.props.dispatch,n=z(e);a(P({currentPage:1,pageSize:20,search:""},function(){n.setState({loading:!1})}))}else-1===t.code?k.a.error("添加失败！"):k.a.error(t.msg)})}),B(z(e),"handleCancel",function(t){e.setState({disabled:!1,visible:!1,isEdit:!1,nickName:"",phone:"",remarks:""})}),e.state={loading:!0,auditStatus:null,visible:!1,visibleBlack:!1,previewVisible:!1,previewImage:"",phone:"",funs:0,disabled:!1,authorInfo:{},searchVal:"",passportId:"",symbolVisible:!1,identityAuth:0,nickName:"",remarks:"",isEdit:!1,whiteListStatus:!1},e}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,S["Component"]),a=t,(n=[{key:"componentWillMount",value:function(){var e=this,t=this.props.dispatch,a=this;t(P({currentPage:1,pageSize:20,search:this.state.searchVal},function(){a.setState({loading:!1})})),M=[{title:"昵称",width:200,key:"nickName",render:function(t,a){return E.a.createElement("div",{className:"audit-info clearfix"},E.a.createElement("div",null,E.a.createElement("h4",{title:a.nickName,dangerouslySetInnerHTML:e.createMarkup(a.nickName?Object(O.q)(a.nickName,100):"暂无")})))}},{title:"手机号 ",dataIndex:"phoneNum",key:"phoneNum",width:200,render:function(e,t){return E.a.createElement("h3",{title:t.phoneNum},t.phoneNum?Object(O.q)(t.phoneNum,30):"暂无")}},{title:"备注",dataIndex:"remarks ",key:"remarks",width:200,render:function(e,t){return E.a.createElement("h3",{title:t.remarks},t.remarks?Object(O.q)(t.remarks,500):"暂无")}},{title:"添加时间",key:"realFollow",width:90,render:function(t){return E.a.createElement("div",null,E.a.createElement("p",{dangerouslySetInnerHTML:e.createMarkup(Object(O.w)(t.createTime,"-",!0))}))}},{title:"操作",key:"action",width:100,render:function(t){return E.a.createElement("div",null,E.a.createElement("p",null,E.a.createElement("a",{className:"mr10 opt-btn",onClick:function(){e.editAudit(t)},style:{background:"#2e55a3"}},"编辑"),E.a.createElement("a",{className:"mr10 opt-btn",onClick:function(){e.delAudit(t)},style:{background:"#d73435"}},"删除")))}}]}},{key:"createMarkup",value:function(e){return{__html:e}}},{key:"doSearch",value:function(e){var t=this,a=this.props.dispatch,n={currentPage:e,pageSize:20,search:this.state.searchVal};a(P(L({},n),function(){t.setState({loading:!1})}))}},{key:"searchValue",value:function(e){var t=e.target.value;this.setState({searchVal:t})}},{key:"updateRemarks",value:function(e){var t=e.target.value;this.setState({remarks:t})}},{key:"changePage",value:function(e){var t=this,a=this.props.dispatch;this.setState({loading:!0}),a(P({currentPage:e,pageSize:20,search:this.state.searchVal},function(){t.setState({loading:!1})}))}},{key:"editAudit",value:function(e){this.setState({disabled:!1,visible:!0,isEdit:!0,nickName:e.nickName,phone:e.phoneNum,remarks:e.records,passportId:e.passportId})}},{key:"delAudit",value:function(e){var t=this.props,a=t.dispatch,n=t.pageData,r=this;H({title:"提示",content:"确认要删除吗 ?",onOk:function(){console.log(e);var t={phonenum:e.phoneNum};Object(O.i)("POST","/author/whitelist/remove",L({},t),function(e){1===e.code?(r.setState({loading:!0}),k.a.success("删除成功"),a(P({currentPage:n.currPage,pageSize:20},function(){r.setState({loading:!1})}))):k.a.error(e.msg)})}})}},{key:"render",value:function(){var e=this,t=this.props,a=t.whiteList,n=t.pageData,i=this.state,s=i.isEdit,l=i.whiteListStatus;return E.a.createElement("div",{className:"audit-index"},E.a.createElement(u.a,null,E.a.createElement(p.a,{span:20},E.a.createElement(g.a,{style:{width:200},onChange:function(t){e.searchValue(t)},placeholder:"手机号/昵称/姓名",onPressEnter:function(){e.doSearch(1)}}),E.a.createElement(m.a,{style:{margin:"0 15px"},type:"primary",onClick:function(){e.doSearch(1)}},"搜索"),E.a.createElement(m.a,{style:{margin:"0 15px"},type:"primary",onClick:function(){e.setState({visible:!0})}},"添加白名单"),E.a.createElement(m.a,{type:"primary",onClick:this.openNotWhiteListUser},"非白名单用权限"))),E.a.createElement("div",{className:"mt30"},E.a.createElement(o.a,{spinning:this.state.loading,size:"large"},E.a.createElement(c.a,{dataSource:a.map(function(e,t){return L({},e,{key:t})}),columns:M,bordered:!0,pagination:{current:n.currPage,total:n.totalCount,pageSize:n.pageSize,onChange:function(t){return e.changePage(t)}}}))),E.a.createElement(v.a,{title:"非白名单作者权限开关",visible:this.state.visibleBlack,onOk:this.setNotWhiteListUser,onCancel:this.handleCancelBlack},E.a.createElement("p",null,E.a.createElement("span",{style:{marginRight:"10px"}},"限制打开后，非白名单MarsBit专栏用户将无法发布文章与视频"),E.a.createElement(r.a,{checkedChildren:"开启",unCheckedChildren:"关闭",onChange:this.chanageWhiteListStatus,checked:l}))),E.a.createElement(v.a,{title:"".concat(s?"编辑":"添加","白名单作者"),visible:this.state.visible,onOk:this.handleOk,onCancel:this.handleCancel},E.a.createElement("div",{className:"auditModalInfo",style:{padding:"0 10px 10px"}},E.a.createElement(u.a,null,E.a.createElement(p.a,{span:3,className:"audit-title",style:{lineHeight:"28px",fontWeight:"bold"}},"手机号: "),s?E.a.createElement(p.a,{span:12},E.a.createElement("div",{style:{lineHeight:"28px"}},this.state.phone)):E.a.createElement(p.a,{span:12},E.a.createElement(g.a,{placeholder:"输入手机号进行搜索",onPressEnter:this.checkAuthor,type:"tel",disabled:this.state.disabled,value:this.state.phone,style:{width:"100%"},className:"",onChange:function(t){e.setPhone(t)}})),s?E.a.createElement("div",null):E.a.createElement(p.a,{span:5,offset:1},E.a.createElement(m.a,{type:"primary",onClick:this.inquireWhiteList},"匹配"))),E.a.createElement(u.a,null,E.a.createElement(p.a,{span:3,className:"audit-title",style:{lineHeight:"28px",fontWeight:"bold"}},"昵称: "),E.a.createElement(p.a,{span:16,className:"audit-title",style:{lineHeight:"28px",fontWeight:"bold"}},this.state.nickName)),E.a.createElement(u.a,null,E.a.createElement(p.a,{span:3,className:"audit-title",style:{lineHeight:"28px",fontWeight:"bold"}},"备注："),E.a.createElement(p.a,{span:16,className:"audit-title",style:{lineHeight:"28px",fontWeight:"bold"}},E.a.createElement("textarea",{rows:"4",cols:"50",style:{padding:"5px"},onChange:function(t){return e.updateRemarks(t)},value:this.state.remarks}))))))}}])&&W(a.prototype,n),i&&W(a,i),t}();t.default=Object(w.connect)(function(e){return{whiteList:e.whiteListInfo.whiteList,pageData:e.whiteListInfo.pageData}})(T)}}]);