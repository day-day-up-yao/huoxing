(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{1496:function(e,t,a){"use strict";a.r(t);a(675);var n=a(676),r=a.n(n),i=(a(1376),a(1377)),o=a.n(i),l=(a(1381),a(1382)),s=a.n(l),c=(a(1383),a(1384)),u=a.n(c),d=(a(184),a(1378)),p=a.n(d),m=(a(247),a(183)),f=a.n(m),y=(a(1388),a(1389)),h=a.n(y),g=(a(1387),a(50)),v=a.n(g),k=(a(361),a(20)),b=a.n(k),E=(a(1392),a(1393)),T=a.n(E),w=(a(1379),a(1380)),C=a.n(w),S=(a(677),a(362)),O=a.n(S),I=a(0),P=a.n(I),U=a(246),j=(a(1606),a(11)),x=a.n(j),L=a(1705),_=a(48);a(1704);function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(){return(N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function V(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function B(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var A=O.a.Option,J=C.a.Item,R=T.a.MonthPicker,Y=1,W=function(e){function t(e){var a,n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,r=D(t).call(this,e),a=!r||"object"!==q(r)&&"function"!=typeof r?M(n):r,B(M(a),"fileList",function(e,t){return e[t]&&""!==e[t]?[{uid:0,name:"xxx.png",status:"done",url:e[t]}]:[]}),B(M(a),"channelChangeOne",function(e){var t=[];for(var n in a.props.rankType[e])t.push(a.props.rankType[e][n]);var r=t.map(function(e){return P.a.createElement(A,{value:e.typeId.toString(),key:e.typeId},e.typeName)});a.setState({firstType:e,tag:!1,optionsTwo:r})}),B(M(a),"channelChangeTwo",function(e){a.setState({secondType:e})}),B(M(a),"handleCancel",function(){return a.setState({previewVisible:!1})}),B(M(a),"handlePreview",function(e){a.setState({previewImage:e.url||e.thumbUrl,previewVisible:!0})}),B(M(a),"handleSubmit",function(){var e=a.props.form;e.validateFields(function(t,n){console.log(n);var r=[];if(t)return!1;a.setState({loading:!0});var i=x()(n.rankMonth).valueOf(),o=Object(_.x)(i,"yyyy-MM");for(var l in n){var s=l.split("_");Array.isArray(n[l])||"marsPhone"===s[0]&&r.push({marsPhone:n[l],effectPoint:n["effectPoint_".concat(s[1])].toString(),articleCount:n["articleCount_".concat(s[1])].toString(),readCount:n["readCount_".concat(s[1])].toString()})}var c={name:n.name,firstType:a.state.firstType,secondType:a.state.secondType,rankMonth:new Date(o).getTime()-288e5,imgUrl:a.state.coverImgUrl,rankUserList:r},u={name:n.name,firstType:a.state.firstType,secondType:a.state.secondType,rankMonth:new Date(o).getTime()-288e5,imgUrl:a.state.coverImgUrl,rankId:a.props.rankDetail.rankId},d=a.props.rankDetail.id?u:c,p=a.props.rankDetail.id?"/rank/update":"/rank/add";Object(_.i)("post",p,JSON.stringify(d),function(t){if(a.setState({loading:!1}),1===t.code){if(a.setState({objPhone:t.obj}),e.resetFields(),a.props.rankDetail.id?b.a.success("修改成功"):b.a.success("添加成功"),0!==t.obj.length)return a.setState({visible:!0}),!1;window.location.href="/#/audit-mprank",document.location.reload()}else a.setState({loading:!1}),b.a.error(t.msg)},{"Sign-Param":Object(_.A)(),"Content-Type":"application/json"})})}),B(M(a),"handleOk",function(){a.setState({visible:!1}),window.location.href="/#/audit-mprank",document.location.reload()}),B(M(a),"modifyUser",function(e){console.log(e);var t=document.getElementById("marsPhone_".concat(e.id)).value,n=document.getElementById("effectPoint_".concat(e.id)).value,r=document.getElementById("articleCount_".concat(e.id)).value,i=document.getElementById("readCount_".concat(e.id)).value,o={rankId:e.rankId,marsPhone:t,effectPoint:n,articleCount:r,readCount:i,rankUserId:e.rankUserId};a.setState({loading:!0}),Object(_.i)("post","/rank/user/update",JSON.stringify(o),function(e){1===e.code?(a.setState({loading:!1}),b.a.success("修改成功")):(a.setState({loading:!1}),b.a.error(e.msg))},{"Sign-Param":Object(_.A)(),"Content-Type":"application/json"})}),B(M(a),"deleteUser",function(e){var t={rankUserId:e.rankUserId};a.setState({loading:!0}),Object(_.i)("post","/rank/user/delete",t,function(e){1===e.code?(a.setState({loading:!1}),b.a.success("删除成功"),location.reload()):(a.setState({loading:!1}),b.a.error(e.msg))})}),B(M(a),"handleChange",function(e){var t=e.file,n=e.fileList;a.setState({fileList:n}),"removed"===t.status&&a.setState({coverImgUrl:""}),t.response&&(1===t.response.code&&"done"===t.status&&a.setState({coverImgUrl:t.response.obj}),"error"===t.status&&(b.a.error("网络错误，上传失败！"),a.setState({coverImgUrl:"",fileList:[]})))}),B(M(a),"remove",function(e){var t=a.props,n=t.form,r=t.rankDetail,i=r.id?r.rankUserList:n.getFieldValue("keys");1!==i.length&&(r.id?a.deleteUser(e):n.setFieldsValue({keys:i.filter(function(t){return t!==e})}))}),B(M(a),"add",function(){var e=a.props.form,t=e.getFieldValue("keys").concat(Y++);e.setFieldsValue({keys:t})}),B(M(a),"FormItem",function(e,t,n,r,i,o,l,s){var c=a.props.form.getFieldDecorator,u=P.a.createElement("div",null,P.a.createElement(v.a,{type:"plus"}),P.a.createElement("div",{className:"ant-upload-text"},"上传图片"));return P.a.createElement(J,N({},{labelCol:{span:1},wrapperCol:{span:15,offset:1}},{label:n}),P.a.createElement("div",{className:"dropbox"},c(t,{initialValue:a.props.rankDetail.id?i:"",rules:[{required:e,message:"请上传榜单图片！"}]})(P.a.createElement(h.a,{headers:{"Sign-Param":Object(_.A)()},action:"".concat(_.a,"/pic/upload"),name:"uploadFile",listType:"picture-card",fileList:i,onPreview:a.handlePreview,onChange:o},i.length>=1?null:u)),s?"":P.a.createElement(f.a,{"data-type":r,onClick:a.handlePreview,className:"img-preview",type:"primary"},"预览"),P.a.createElement("span",{className:"cover-img-tip"},"建议尺寸: ",P.a.createElement("font",{style:{color:"red"}},l))))}),B(M(a),"disabledEndDate",function(e){var t=a.state.currentTime;return!(!e||!t)&&e.valueOf()>=t.valueOf()+2592e6}),B(M(a),"handleEndOpenChange",function(e){var t=M(a);e&&(t.currentTime=x()()),a.setState({currentTime:x()()})}),a.state={loading:!0,coverImgUrl:"",previewImage:"",fileList:[],firstType:1,secondType:1,addList:[],rankUserList:[],twoType:[],tag:!0,optionsTwo:"",visible:!1,objPhone:[]},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(t,I["Component"]),a=t,(n=[{key:"componentWillMount",value:function(){var e=this,t=this.props,a=t.dispatch,n=t.location;a(Object(L.c)()),n.query.id||n.query.url?a(Object(L.a)({rankId:n.query.id},function(t){console.log(t),e.setState({loading:!1,coverImgUrl:t.imgUrl,firstType:t.firstType,secondType:t.secondType,fileList:""===t.imgUrl?[]:[{uid:0,name:"xxx.png",status:"done",url:t.imgUrl}],rankUserList:t.rankUserList});var a=[];for(var n in e.props.rankType[t.firstType])a.push(e.props.rankType[t.firstType][n]);var r=a.map(function(e){return P.a.createElement(A,{value:e.typeId.toString(),key:e.typeId},e.typeName)});e.setState({optionsTwo:r}),e.channelChangeOne(t.firstType)})):this.setState({loading:!1})}},{key:"componentDidMount",value:function(){this.forceUpdate(),this.add()}},{key:"componentWillUnmount",value:function(){document.location.reload()}},{key:"render",value:function(){var e=this,t=this.props,a=t.rankType,n=t.rankDetail,i=P.a.createElement("div",null,P.a.createElement(v.a,{type:"plus"}),P.a.createElement("div",{className:"ant-upload-text"},"上传图片")),l=this.props.form,c=l.getFieldDecorator,d=l.getFieldValue,m={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}},y={wrapperCol:{xs:{span:24,offset:0},sm:{span:20,offset:4}}};c("keys",{initialValue:[]});var g=n.id&&n.rankUserList?this.state.rankUserList:d("keys"),k=g.map(function(t,a){return P.a.createElement(s.a,{key:a,style:{marginBottom:15}},P.a.createElement("div",{className:"rank_index"},a+1),P.a.createElement(u.a,{span:"3",offset:1},P.a.createElement(C.a.Item,N({},0===a?m:y,{required:!1,key:a}),c("marsPhone_".concat(t.id?t.id:a),{initialValue:n.id?t.marsPhone:"",validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"不能为空！"}]})(P.a.createElement(p.a,{placeholder:"MarsBit专栏账号（手机号）"})))),P.a.createElement(u.a,{span:"3",offset:1},P.a.createElement(C.a.Item,N({},0===a?m:y,{required:!1,key:a}),c("effectPoint_".concat(t.id?t.id:a),{initialValue:n.id?t.effectPoint:"",validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"不能为空！"}]})(P.a.createElement(p.a,{placeholder:"影响力",type:"number"})))),P.a.createElement(u.a,{span:"3",offset:1},P.a.createElement(C.a.Item,N({},0===a?m:y,{required:!1,key:a}),c("articleCount_".concat(t.id?t.id:a),{initialValue:n.id?t.articleCount:"",validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"不能为空！"}]})(P.a.createElement(p.a,{placeholder:"文章数",type:"number"})))),P.a.createElement(u.a,{span:"3",offset:1},P.a.createElement(C.a.Item,N({},0===a?m:y,{required:!1,key:a}),c("readCount_".concat(t.id?t.id:a),{initialValue:n.id?t.readCount:"",validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"不能为空！"}]})(P.a.createElement(p.a,{placeholder:"阅读数",type:"number"})))),P.a.createElement(u.a,{style:{display:"inline-block"}},g.length>1?P.a.createElement(v.a,{className:"dynamic-delete-button",type:"minus-circle-o",onClick:function(){return e.remove(t)}}):null),P.a.createElement(u.a,{style:{display:n.id?"inline-block":"none",marginLeft:10}},P.a.createElement(f.a,{className:"rank-list-btn",onClick:function(){e.modifyUser(t)}},"修改")))}),b=[];for(var E in a[0])if(b.push(a[0][E]),"0"===E&&this.state.tag){for(var T=[],w=0;w<a[1].length;w++)T.push(a[1][w]);this.state.optionsTwo=T.map(function(e){return P.a.createElement(A,{value:e.typeId.toString(),key:e.typeId},e.typeName)})}var S=b.map(function(e,t){return P.a.createElement(A,{value:e.typeId.toString(),key:t},e.typeName)});return P.a.createElement("div",{className:"videoAudit-send"},P.a.createElement(r.a,{spinning:this.state.loading,size:"large"},P.a.createElement(C.a,null,P.a.createElement(J,N({},m,{label:"榜单名称: "}),c("name",{initialValue:n.id?"".concat(n.name):"",rules:[{required:!0,message:"请输入榜单名称！"}]})(P.a.createElement(p.a,{className:"news-author",placeholder:"请输入榜单名称"}))),P.a.createElement(J,N({},m,{label:"榜单类别: "}),P.a.createElement(s.a,null,P.a.createElement(u.a,null,c("firstType",{initialValue:n.id?"".concat(n.firstType):"1",rules:[{required:!0,message:"请选择类型！"}]})(P.a.createElement(O.a,{style:{width:100},placeholder:"请选择类型",onChange:this.channelChangeOne},S)),P.a.createElement("span",{style:{marginLeft:15}}),c("secondType",{initialValue:n.id?"".concat(n.secondType):"1",rules:[{required:!0,message:"请选择类型！"}]})(P.a.createElement(O.a,{style:{width:100},placeholder:"请选择类型",onChange:this.channelChangeTwo},this.state.optionsTwo))))),P.a.createElement(J,N({},m,{label:"榜单时间: "}),c("rankMonth",{rules:[{required:!0,message:"请选择视榜单时间！"}],initialValue:n.id?x()(Object(_.w)(n.rankMonth),"YYYY-MM"):x()()})(P.a.createElement(R,{renderExtraFooter:function(){return"extra footer"},placeholder:"Select month",disabledDate:this.disabledEndDate,onOpenChange:this.handleEndOpenChange}))),P.a.createElement(J,N({},m,{label:"榜单图片: "}),P.a.createElement("div",{className:"dropbox"},c("imgUrl",{initialValue:n.id?"".concat(n.imgUrl):"",rules:[{required:!1,message:"请上传榜单图片！"}]})(P.a.createElement(h.a,{headers:{"Sign-Param":Object(_.A)()},action:"".concat(_.a,"/pic/upload"),name:"uploadFile",listType:"picture-card",fileList:this.state.fileList,onPreview:this.handlePreview,onChange:this.handleChange},this.state.fileList.length>=1?null:i)),P.a.createElement(o.a,{footer:null,onCancel:this.handleCancel},P.a.createElement("img",{alt:"example",style:{width:"100%"},src:this.state.coverImgUrl})),P.a.createElement("span",{className:"cover-img-tip",style:{display:"inline-block",marginTop:"70px",position:"absolute"}},"长宽比例: ",P.a.createElement("font",{style:{color:"red"}},"1 : 1")))),P.a.createElement(J,m,P.a.createElement("div",null,k),P.a.createElement(f.a,{type:"dashed",onClick:this.add,style:{width:"30%",marginLeft:160,visibility:"".concat(this.props.location.query.id?"hidden":"inherit")}},P.a.createElement(v.a,{type:"plus"})," 增加榜单用户")),P.a.createElement(J,m,P.a.createElement(f.a,{onClick:this.handleSubmit,style:{marginLeft:340,marginTop:40}},"提交")))),P.a.createElement(o.a,{title:"错误提示",visible:this.state.visible,onCancel:this.handleOk,footer:[P.a.createElement(f.a,{key:"back",onClick:this.handleOk},"确定")]},this.state.objPhone.map(function(t,a){return P.a.createElement("span",{key:a,style:{marginRight:"10px",lineHeight:"22px"}},t,"、 ",a===e.state.objPhone.length-1?"非MarsBit专栏或手机号格式错误！":"")})))}}])&&V(a.prototype,n),i&&V(a,i),t}();t.default=Object(U.connect)(function(e){return{rankType:e.mpRankInfo.rankType,rankDetail:e.mpRankInfo.rankDetail}})(C.a.create()(W))}}]);