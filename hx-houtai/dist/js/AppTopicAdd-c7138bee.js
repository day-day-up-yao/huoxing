(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{1470:function(e,t,a){"use strict";a.r(t);a(675);var n=a(676),r=a.n(n),s=(a(247),a(183)),i=a.n(s),l=(a(1376),a(1377)),c=a.n(l),o=(a(1388),a(1389)),p=a.n(o),m=(a(184),a(1378)),u=a.n(m),g=(a(1387),a(50)),y=a.n(g),d=(a(361),a(20)),f=a.n(d),h=(a(677),a(362)),S=a.n(h),b=(a(678),a(363)),I=a.n(b),v=(a(1379),a(1380)),k=a.n(v),L=a(0),w=a.n(L),T=a(246),E=a(10),O=a(1679),C=a(248),N=a(48);a(1678);function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(){return(j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function B(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var R=k.a.Item,x=I.a.Group,D=S.a.Option,M=function(e){function t(){var e,a,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var s=arguments.length,i=new Array(s),l=0;l<s;l++)i[l]=arguments[l];return n=this,r=(e=F(t)).call.apply(e,[this].concat(i)),a=!r||"object"!==q(r)&&"function"!=typeof r?_(n):r,V(_(a),"state",{updateOrNot:!1,previewVisible:!1,previewImage:"",pcImgSrcFileList:[],mImgSrcFileList:[],pcImgSrc:"",mImgSrc:"",pcBackImageFileList:[],mBackImageFileList:[],pcBackImage:"",mBackImage:"",loading:!1,type:"1",newsReqType:"1",channelId:"1"}),V(_(a),"handleCancel",function(){return a.setState({previewVisible:!1})}),V(_(a),"handlePreview",function(e){a.setState({previewImage:e.url||e.thumbUrl,previewVisible:!0})}),V(_(a),"handlePcImgChange",function(e){var t=e.file,n=e.fileList;a.setState({pcImgSrcFileList:n}),"removed"===t.status&&a.setState({pcImgSrc:""}),t.response&&(1===t.response.code&&"done"===t.status&&a.setState({pcImgSrc:t.response.obj}),"error"===t.status&&(f.a.error("网络错误，上传失败！"),a.setState({pcImgSrc:"",pcImgSrcFileList:[]})))}),V(_(a),"handleMImgChange",function(e){var t=e.file,n=e.fileList;a.setState({mImgSrcFileList:n}),"removed"===t.status&&a.setState({mImgSrc:""}),t.response&&(1===t.response.code&&"done"===t.status&&a.setState({mImgSrc:t.response.obj}),"error"===t.status&&(f.a.error("网络错误，上传失败！"),a.setState({mImgSrc:"",mImgSrcFileList:[]})))}),V(_(a),"handlePcBackImgChange",function(e){var t=e.file,n=e.fileList;a.setState({pcBackImageFileList:n}),"removed"===t.status&&a.setState({pcBackImage:""}),t.response&&(1===t.response.code&&"done"===t.status&&a.setState({pcBackImage:t.response.obj}),"error"===t.status&&(f.a.error("网络错误，上传失败！"),a.setState({pcBackImage:"",pcBackImageFileList:[]})))}),V(_(a),"handleMBackImgChange",function(e){var t=e.file,n=e.fileList;a.setState({mBackImageFileList:n}),"removed"===t.status&&a.setState({mBackImage:""}),t.response&&(1===t.response.code&&"done"===t.status&&a.setState({mBackImage:t.response.obj}),"error"===t.status&&(f.a.error("网络错误，上传失败！"),a.setState({mBackImage:"",mBackImageFileList:[]})))}),V(_(a),"typeOnChange",function(e){a.setState({type:e.target.value})}),V(_(a),"newsOnChange",function(e){a.setState({newsReqType:e.target.value})}),V(_(a),"handleSubmit",function(e){a.props.form.setFieldsValue({mImgSrc:a.state.mImgSrc}),e.preventDefault();var t={type:a.state.type,status:1,pcImgSrc:"",mImgSrc:a.state.mImgSrc,pcBackImage:"",mBackImage:""};a.props.form.validateFieldsAndScroll(function(e,n){e||(a.setState({loading:!0}),t.topicName=n.topicName,t.tags="","3"===a.state.type&&"1"===a.state.newsReqType?t.typeLink=n.typeLink_channel:"3"===a.state.type&&"2"===a.state.newsReqType?t.typeLink=n.typeLink_tags:"1"===a.state.type?t.typeLink=n.typeLink:"5"===a.state.type?t.typeLink=n.typeLink_author:t.typeLink=n.typeLink_2,a.state.updateOrNot?(t.id=a.props.location.query.id,t.setTop=a.props.appTopicInfo.setTop,t.status=a.props.appTopicInfo.status,Object(N.i)("post","/topic/update",t,function(e){1===e.code?(a.setState({loading:!1}),f.a.success("修改成功！"),E.hashHistory.push("/appTopic-list")):(a.setState({loading:!1}),f.a.error(e.msg))})):Object(N.m)("/topic/add",{topic:t},function(e){1===e.code?(a.setState({loading:!1}),f.a.success("添加成功！"),E.hashHistory.push("/appTopic-list")):(f.a.error(e.msg),a.setState({loading:!1}))}))})}),V(_(a),"handleChange2",function(e){a.setState({channelId:e})}),V(_(a),"createMarkup",function(e){return{__html:e}}),a}var a,n,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,L["Component"]),a=t,(n=[{key:"componentWillMount",value:function(){var e=this,t=this.props,a=t.dispatch,n=t.location;a(Object(C.f)()),n.query.id?(this.setState({loading:!0}),a(Object(O.a)({id:n.query.id},function(t){var a=3===t.type&&t.typeLink&&""!==parseInt(t.typeLink);e.setState({updateOrNot:!0,mImgSrcFileList:[{uid:0,name:"xxx.png",status:"done",url:t.mImgSrc}],mImgSrc:t.mImgSrc,loading:!1,type:t.type.toString(),channelId:a?t.typeLink:"1",newsReqType:a?"1":"2"})}))):this.setState({loading:!1})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.props.appTopicInfo,n=3===a.type&&a.typeLink&&""!==parseInt(a.typeLink),s=this.state,l=s.previewVisible,o=s.previewImage,m=s.mImgSrcFileList,g=s.updateOrNot,d={labelCol:{span:1},wrapperCol:{span:19}},f=w.a.createElement("div",null,w.a.createElement(y.a,{type:"plus"}),w.a.createElement("div",{className:"ant-upload-text"},"上传图片")),h=function(){return"3"===e.state.type&&"1"===e.state.newsReqType?"新闻频道":"3"===e.state.type&&"2"===e.state.newsReqType?"关键词(tags)":"1"===e.state.type?"专题跳转链接":"5"===e.state.type?"作者信息":"待定"};return w.a.createElement("div",{className:"appTopic-send"},w.a.createElement(r.a,{spinning:this.state.loading,size:"large"},w.a.createElement(k.a,{onSubmit:this.handleSubmit},w.a.createElement(R,j({className:"appTopicTitle"},d,{label:"标题 "}),t("topicName",{initialValue:g&&a?"".concat(a.topicName):"",rules:[{required:!0,message:"请输入专题标题！"}]})(w.a.createElement(u.a,{className:"appTopic-name",placeholder:"请输入专题标题"}))),w.a.createElement(R,j({className:"appTopicTitle"},d,{label:"专题类型"}),t("type",{initialValue:g&&a?"".concat(a.type):"1",rules:[{required:!0,message:"请选择专题类型！"}]})(w.a.createElement(x,{onChange:this.typeOnChange},N.T.map(function(e,t){return w.a.createElement(I.a,{key:t,value:e.value},e.label)})))),"3"===this.state.type?w.a.createElement(R,j({className:"appTopicTitle"},d,{label:"新闻类型"}),t("newsType",{initialValue:this.state.newsReqType,rules:[{required:!0,message:"请选择新闻类型！"}]})(w.a.createElement(x,{onChange:this.newsOnChange},w.a.createElement(I.a,{value:"1"},"频道"),w.a.createElement(I.a,{value:"2"},"关键字(tags)")))):"","3"===e.state.type&&"1"===e.state.newsReqType?w.a.createElement(R,j({},d,{className:"appTopicTitle",label:h()}),t("typeLink_channel",{initialValue:e.state.channelId,rules:[{required:!0,message:"请选择新闻频道！"}]})(w.a.createElement(S.a,{style:{width:100},onChange:e.handleChange2},e.props.channelList.map(function(e){return w.a.createElement(D,{value:e.value,key:e.value},e.label)})))):"3"===e.state.type&&"2"===e.state.newsReqType?w.a.createElement(R,j({},d,{className:"appTopicTitle",label:h()}),t("typeLink_tags",{initialValue:n?"":a.typeLink||"无",rules:[{required:!0,message:"关键词不能为空！"}]})(w.a.createElement(u.a,{placeholder:"请输入新闻关键词(tags)"}))):"1"===e.state.type?w.a.createElement(R,j({},d,{className:"appTopicTitle",label:h()}),t("typeLink",{initialValue:g&&a?"".concat(1===a.type?a.typeLink:""):"",rules:[{type:"url",message:"请输入正确的超链接地址！"},{required:!0,message:"超链接地址不能为空！"}]})(w.a.createElement(u.a,{placeholder:"请输入专题跳转的超链接地址"}))):"5"===e.state.type?w.a.createElement(R,j({},d,{className:"appTopicTitle",label:h()}),t("typeLink_author",{initialValue:g&&a?"".concat(5===a.type?a.typeLink:""):"",rules:[{required:!0,message:"作者昵称/作者ID不能为空！"}]})(w.a.createElement(u.a,{placeholder:"请输入作者昵称/作者ID"}))):w.a.createElement(R,j({},d,{className:"appTopicTitle",label:h()}),t("typeLink_2",{initialValue:"",rules:[{required:!0,message:"内容不能为空！"}]})(w.a.createElement(u.a,{disabled:!0,placeholder:"待定"}))),w.a.createElement(R,j({},d,{label:"M 端轮播封面: ",className:"upload-div"}),w.a.createElement("div",{className:"dropbox"},t("mImgSrc",{initialValue:g&&a?m:"",rules:[{required:!0,message:"请上传轮播封面图！"}]})(w.a.createElement(p.a,{headers:{"Sign-Param":Object(N.A)()},action:"".concat(N.a,"/pic/upload"),name:"uploadFile",listType:"picture-card",fileList:m,onPreview:this.handlePreview,onChange:this.handleMImgChange},m.length>=1?null:f)),w.a.createElement(c.a,{visible:l,footer:null,onCancel:this.handleCancel},w.a.createElement("img",{alt:"example",style:{width:"100%"},src:o})),w.a.createElement("span",{className:"cover-img-tip"},"用于 APP 发现模块轮播的封面图展示, 长宽比例: ",w.a.createElement("font",{style:{color:"red"}},"496 * 267")))),w.a.createElement(R,{wrapperCol:{span:12,offset:2}},w.a.createElement(i.a,{type:"primary","data-status":"1",htmlType:"submit",style:{marginRight:"10px"}},"保存"),w.a.createElement(i.a,{type:"primary",className:"cancel",onClick:function(){E.hashHistory.goBack()}},"取消")))))}}])&&B(a.prototype,n),s&&B(a,s),t}();t.default=Object(T.connect)(function(e){return{appTopicInfo:e.appTopicInfo.info,selectData:e.appTopicInfo.selectedData,channelList:e.channelListInfo}})(k.a.create()(M))}}]);