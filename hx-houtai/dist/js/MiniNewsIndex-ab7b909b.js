(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{1486:function(e,t,n){"use strict";n.r(t);n(1392);var a=n(1393),r=n.n(a),i=(n(675),n(676)),o=n.n(i),s=(n(1385),n(1386)),c=n.n(s),l=(n(1381),n(1382)),u=n.n(l),p=(n(1383),n(1384)),d=n.n(p),m=(n(361),n(20)),h=n.n(m),f=(n(680),n(250)),b=n.n(f),y=(n(184),n(1378)),g=n.n(y),v=(n(1379),n(1380)),E=n.n(v),O=(n(677),n(362)),w=n.n(O),j=(n(1376),n(1377)),k=n.n(j),S=n(0),T=n.n(S),I=n(246),D=(n(1662),n(10)),P=n(1663),N=n(248),H=n(48),Y=n(11),C=n.n(Y);function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.forEach(function(t){z(e,t,n[t])})}return e}function V(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=k.a.confirm,$=w.a.Option,J=E.a.Item,W={labelCol:{xs:{span:2},sm:{span:4}},wrapperCol:{xs:{span:4},sm:{span:16}}},B=[],R=function(e){function t(){var e,n,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,a=x(t).call(this),e=!a||"object"!==M(a)&&"function"!=typeof a?L(n):a,z(L(e),"disabledDate",function(e){return e&&e<C()().endOf("hours")}),z(L(e),"handleChange",function(t){(0,e.props.dispatch)(Object(P.g)({status:t})),e.setState({newsStatus:t}),e.doSearch("init",{currentPage:1,status:t})}),z(L(e),"handleChange1",function(t){(0,e.props.dispatch)(Object(P.g)({recommend:t})),e.doSearch("init",{currentPage:1,recommend:t})}),z(L(e),"handleChange2",function(t){(0,e.props.dispatch)(Object(P.g)({channelId:t})),e.doSearch("init",{currentPage:1,channelId:t})}),e.state={loading:!0,newsStatus:null,editNewsId:""},e}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(t,S["Component"]),n=t,(a=[{key:"channelName",value:function(e){var t="";return this.props.channelList.map(function(n,a){parseInt(n.value)===e&&(t=n.label)}),t}},{key:"componentWillMount",value:function(){var e=this,t=this.props,n=t.search,a=t.filter;(0,t.dispatch)(Object(N.f)()),this.doSearch("init",A({},a,{title:n.title})),B=[].concat([{title:"新闻标题",width:230,key:"name",render:function(t,n){return n&&T.a.createElement("div",{className:"miniApp-info clearfix"},T.a.createElement("div",null,T.a.createElement("h4",{title:n.title,dangerouslySetInnerHTML:e.createMarkup(Object(H.q)(n.title,30))}),T.a.createElement("div",null,parseInt(n.recommend)?T.a.createElement("div",{style:{display:"inline-block",verticalAlign:"middle"}},T.a.createElement("span",{className:"org-bg mr10"},"推荐")):"",n.topOrder&&0!==parseInt(n.topOrder)?T.a.createElement(b.a,{placement:"bottom",title:"失效时间: ".concat(C()(n.topEndTime).format("YYYY年MM月DD日 HH:mm:ss"),"; 失效热度: ").concat(n.topEndHotcount)},T.a.createElement("div",{className:"news-top clearfix"},T.a.createElement("span",{className:"top-bg"},"置顶"),T.a.createElement(g.a,{className:"top-num",onBlur:function(t){return e._editTopValue(t,n)},onChange:function(t){return e.changeTopValue(t,n)},value:n.topOrder}))):"")))}},{title:"新闻状态",key:"status",width:80,render:function(e){return e&&0===e.status?T.a.createElement("span",{className:"news-status pre-publish"},"草稿"):e&&1===e.status?T.a.createElement("span",{className:"news-status"},"已发表"):e&&3===e.status?T.a.createElement("span",{className:"news-status will-publish"},"定时发表"):T.a.createElement("span",null,"暂无")}},{title:"频道 ",width:100,dataIndex:"channelId",key:"channelId",render:function(t){return t&&e.channelName(t)}},{title:"发表时间",key:"createTime",width:150,render:function(e){return e&&Object(H.w)(e.publishTime)}}],[{title:"操作",key:"action",width:300,render:function(t){return T.a.createElement("div",{className:"btns"},T.a.createElement("p",null,T.a.createElement(D.Link,{className:"mr10 opt-btn",to:{pathname:"/miniNews-detail",query:{id:t.id}},style:{background:"#108ee9"}},"详情")),T.a.createElement("p",null,T.a.createElement("a",{className:"mr10 opt-btn",href:"javascript:void(0)",onClick:function(){return e._isPublish(t)},style:{background:"#00a854"}},1===t.status||3===t.status?"撤回到草稿":0===t.status?t.publishTime>Date.parse(new Date)?"定时发表":"发表":void 0)),T.a.createElement("p",null,T.a.createElement("a",{onClick:function(){return e.delMiniApp(t)},className:"mr10 opt-btn",href:"javascript:void(0)",style:{background:"#d73435"}},"删除")))}}])}},{key:"componentWillUnmount",value:function(){var e=this.props.dispatch;e(Object(P.i)({type:"init",nickName:""})),e(Object(P.h)({pageSize:20,totalCount:0}))}},{key:"createMarkup",value:function(e){return{__html:e}}},{key:"showToTopModal",value:function(e,t,n){var a=this.props.dispatch;e?this.newsIsToTop({id:t,topEndHotcount:0,topOrder:0,topEndTime:0}):(this.setState({editNewsId:t,topIsShow:!0}),a(Object(P.f)(n)))}},{key:"newsIsToTop",value:function(e){var t=this,n=this.props.dispatch;n(Object(P.e)(e,function(){t.doSearch("init"),n(Object(P.i)({type:"init"}))}))}},{key:"setNewsTop",value:function(){var e=this,t=this.props.form;t.validateFields(function(n,a){n||(e.setState({topIsShow:!1}),e.newsIsToTop({id:e.state.editNewsId,topOrder:a.order,topEndHotcount:a.topEndHotcount,topEndTime:Date.parse(a.topEndTime.format("YYYY-MM-DD HH:mm:ss"))}),t.resetFields())})}},{key:"changeTopValue",value:function(e,t){var n=this.props.dispatch,a=e.target.value;0!==parseInt(a)?n(Object(P.a)({topOrder:a},t.key)):h.a.warning("置顶权重值不能为0！")}},{key:"_editTopValue",value:function(e,t){var n=e.target.value,a=t.id;n?/^\d+$/.test(n)?this.newsIsToTop({id:a,topEndHotcount:t.topEndHotcount||1e4,topOrder:n,topEndTime:t.topEndTime||Date.parse(C()().add("day",1).format("YYYY-MM-DD HH:mm:ss"))}):h.a.warning("置顶权重值必须是整数！"):h.a.warning("请输入置顶权重值！")}},{key:"doSearch",value:function(e,t){var n=this,a=this.props,r=a.dispatch,i=a.pageData,o=a.search,s=A({},a.filter,{title:o.title,authorName:o.authorName,pageSize:20,currentPage:i.currPage});this.setState({loading:!0}),s=A({},s,t),r(Object(P.d)(e,s,function(){n.setState({loading:!1})}))}},{key:"_search",value:function(){var e=this.props.dispatch;this.doSearch("init",{currentPage:1}),e(Object(P.i)({type:"init"})),e(Object(P.h)({currPage:1}))}},{key:"changePage",value:function(e){this.setState({loading:!0});var t=this.props,n=t.dispatch,a=t.search,r=t.filter;n(Object(P.h)({currPage:e})),this.doSearch(a.type,A({currentPage:e},r))}},{key:"delMiniApp",value:function(e){var t=this.props.dispatch,n=this;F({title:"提示",content:"确认要删除吗 ?",onOk:function(){var a={id:e.id};Object(H.i)("POST","/miniapp/delete",A({},a),function(e){1===e.code?(h.a.success("删除成功"),n.doSearch("init"),t(Object(P.i)({type:"init"}))):h.a.error(e.msg)})}})}},{key:"_isPublish",value:function(e){var t=this.props.dispatch,n=this;F({title:"提示",content:"确认要".concat(1===e.status?"撤回":"发表","吗 ?"),onOk:function(){var a={id:e.id,status:0===e.status?e.publishTime>Date.parse(new Date)?3:1:0};Object(H.i)("POST","/miniapp/status",A({},a),function(a){1===a.code?(h.a.success("".concat(1===e.status?"撤回":"发表","成功")),n.doSearch("init"),t(Object(P.i)({type:"init"}))):h.a.error(a.msg)})}})}},{key:"_forbidcomment",value:function(e){var t=this,n=this.props.dispatch,a={id:e.id,operate:parseInt(e.forbidComment)?"0":"1"};Object(H.i)("post","/post/forbidcomment",a,function(e){200===e.status?(t.doSearch("init"),n(Object(P.i)({type:"init"}))):h.a.error(e.msg)})}},{key:"_isTop",value:function(e){var t=this,n=this.props.dispatch,a={id:e.id,recommend:1===e.recommend?0:1};Object(H.i)("post","/news/recommend",a,function(e){1===e.code?(t.doSearch("init"),n(Object(P.i)({type:"init"}))):h.a.error(e.msg)})}},{key:"render",value:function(){var e=this,t=this.props,n=t.list,a=t.pageData,i=t.filter,s=t.form,l=t.selectedData,p=s.getFieldDecorator;return T.a.createElement("div",{className:"miniApp-index"},T.a.createElement(u.a,null,T.a.createElement(d.a,null,T.a.createElement("span",null,"新闻状态："),T.a.createElement(w.a,{defaultValue:"".concat(i.status),style:{width:100},onChange:this.handleChange},T.a.createElement($,{value:""},"全部"),T.a.createElement($,{value:"1"},"已发表"),T.a.createElement($,{value:"3"},"定时发表"),T.a.createElement($,{value:"0"},"草稿箱")),T.a.createElement("span",{style:{marginLeft:15}},"新闻类别："),T.a.createElement(w.a,{defaultValue:"".concat(i.channelId),style:{width:100},onChange:this.handleChange2},T.a.createElement($,{value:""},"全部"),this.props.channelList.map(function(e){return T.a.createElement($,{value:e.value,key:e.value},e.label)})))),T.a.createElement("div",{className:"mt30"},T.a.createElement(o.a,{spinning:this.state.loading,size:"large"},T.a.createElement(c.a,{dataSource:n.map(function(e,t){return A({},e,{key:t})}),columns:B,bordered:!0,pagination:{current:a.currPage,total:a.totalCount,pageSize:a.pageSize,onChange:function(t){return e.changePage(t)}}}))),T.a.createElement(k.a,{title:"置顶权重",visible:this.state.topIsShow,onOk:function(){return e.setNewsTop()},onCancel:function(){e.setState({topIsShow:!1}),s.resetFields()}},T.a.createElement(E.a,null,T.a.createElement(J,_({},W,{label:"置顶权重"}),p("order",{rules:[{required:!0,message:"请输入置顶权重!"},{pattern:/^[1-9]\d*$/,message:"设置权重必须大于0!"}],initialValue:0===l.topOrder?1:l.topOrder})(T.a.createElement(g.a,{min:1}))),T.a.createElement(J,_({},W,{label:"失效热度"}),p("topEndHotcount",{rules:[{required:!0,message:"请输入置顶失效热度!"},{pattern:/^[1-9]\d*$/,message:"置顶失效热度必须大于0!"}],initialValue:l.topEndHotcount&&0!==l.topEndHotcount?l.topEndHotcount:1e4})(T.a.createElement(g.a,{min:1e4}))),T.a.createElement(J,_({},W,{label:"失效时间: "}),p("topEndTime",{rules:[{required:!0,message:"请选择置顶失效时间！"}],initialValue:l.topEndTime&&""!==l.topEndTime?C()(Object(H.w)(l.topEndTime),"YYYY-MM-DD HH:mm:ss"):C()().add("hours",1)})(T.a.createElement(r.a,{showTime:!0,disabledDate:this.disabledDate,format:"YYYY-MM-DD HH:mm:ss"}))))))}}])&&V(n.prototype,a),i&&V(n,i),t}();t.default=Object(I.connect)(function(e){return{miniAppInfo:e.miniAppInfo,list:e.miniAppInfo.list,search:e.miniAppInfo.search,filter:e.miniAppInfo.filter,pageData:e.miniAppInfo.pageData,selectedData:e.miniAppInfo.selectedData,channelList:e.channelListInfo}})(E.a.create()(R))}}]);