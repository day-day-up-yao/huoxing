(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{1476:function(e,t,a){"use strict";a.r(t);a(675);var n=a(676),s=a.n(n),l=(a(1376),a(1377)),r=a.n(l),i=(a(247),a(183)),c=a.n(i),o=(a(1388),a(1389)),p=a.n(o),m=(a(1387),a(50)),u=a.n(m),d=(a(361),a(20)),g=a.n(d),y=(a(184),a(1378)),h=a.n(y),f=(a(679),a(249)),b=a.n(f),v=(a(677),a(362)),S=a.n(v),I=(a(678),a(363)),k=a.n(I),w=(a(1379),a(1380)),L=a.n(w),E=a(0),C=a.n(E),O=a(246),V=a(10),N=a(1654),B=a(248),j=a(48);a(1653);function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(){return(P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function _(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var D=L.a.Item,M=k.a.Group,R=S.a.Option,H=b.a.Group,K=h.a.TextArea,G=[{label:"网页端",value:"1"},{label:"App端",value:"2"}],J=function(e){function t(){var e,a,n,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var l=arguments.length,r=new Array(l),i=0;i<l;i++)r[i]=arguments[i];return n=this,s=(e=T(t)).call.apply(e,[this].concat(r)),a=!s||"object"!==F(s)&&"function"!=typeof s?q(n):s,x(q(a),"state",{updateOrNot:!1,previewVisible:!1,previewImage:"",pcImgSrcFileList:[],mImgSrcFileList:[],pcImgSrc:"",mImgSrc:"",pcBackImageFileList:[],mBackImageFileList:[],pcBackImage:"",mBackImage:"",loading:!1,type:"1",place:["1","2"],position:"1",newsReqType:"1",channelId:"1",specialVal:[],specialActive:"",specialValShow:!0}),x(q(a),"handleCancel",function(){return a.setState({previewVisible:!1})}),x(q(a),"handlePreview",function(e){a.setState({previewImage:e.url||e.thumbUrl,previewVisible:!0})}),x(q(a),"handlePcImgChange",function(e){var t=e.file,n=e.fileList;a.setState({pcImgSrcFileList:n}),"removed"===t.status&&a.setState({pcImgSrc:""}),t.response&&(1===t.response.code&&"done"===t.status&&a.setState({pcImgSrc:t.response.obj}),"error"===t.status&&(g.a.error("网络错误，上传失败！"),a.setState({pcImgSrc:"",pcImgSrcFileList:[]})))}),x(q(a),"handleMImgChange",function(e){var t=e.file,n=e.fileList;a.setState({mImgSrcFileList:n}),"removed"===t.status&&a.setState({mImgSrc:""}),t.response&&(1===t.response.code&&"done"===t.status&&a.setState({mImgSrc:t.response.obj}),"error"===t.status&&(g.a.error("网络错误，上传失败！"),a.setState({mImgSrc:"",mImgSrcFileList:[]})))}),x(q(a),"handlePcBackImgChange",function(e){var t=e.file,n=e.fileList;a.setState({pcBackImageFileList:n}),"removed"===t.status&&a.setState({pcBackImage:""}),t.response&&(1===t.response.code&&"done"===t.status&&a.setState({pcBackImage:t.response.obj}),"error"===t.status&&(g.a.error("网络错误，上传失败！"),a.setState({pcBackImage:"",pcBackImageFileList:[]})))}),x(q(a),"handleMBackImgChange",function(e){var t=e.file,n=e.fileList;a.setState({mBackImageFileList:n}),"removed"===t.status&&a.setState({mBackImage:""}),t.response&&(1===t.response.code&&"done"===t.status&&a.setState({mBackImage:t.response.obj}),"error"===t.status&&(g.a.error("网络错误，上传失败！"),a.setState({mBackImage:"",mBackImageFileList:[]})))}),x(q(a),"typeOnChange",function(e){a.setState({type:e.target.value})}),x(q(a),"positionOnChange",function(e){var t=e.target.value,n=a.props.form;/^[89]$/.test(t)?n.setFieldsValue({type:t}):n.setFieldsValue({type:"1"}),a.setState({position:t,type:"2"===t?"1":t})}),x(q(a),"placeOnChange",function(e){a.props.form.setFieldsValue({showPlace:e}),a.setState({place:e})}),x(q(a),"newsOnChange",function(e){a.setState({newsReqType:e.target.value})}),x(q(a),"handleSubmit",function(e){e.preventDefault(),a.props.form.setFieldsValue({pcImgSrc:a.state.pcImgSrc,mImgSrc:a.state.mImgSrc}),a.props.form.validateFieldsAndScroll(function(e,t){if(!e){a.setState({loading:!0}),t.status=0;var n="";switch(a.state.type){case"1":n=t.typeLink;break;case"2":n=t.typeLink_channel,delete t.typeLink_channel;break;case"3":n=t.typeLink_tags,delete t.typeLink_tags;break;case"5":n=t.typeLink_author,delete t.typeLink_author;break;case"6":case"7":case"8":case"9":n=t.typeLink_ad,delete t.typeLink_ad;break;default:n=t.typeLink}console.log("4"===a.state.type),"4"===a.state.type?t.typeLink=a.state.specialActive:t.typeLink=n,console.log(t.typeLink),t.showPlace=a.state.place.join(","),a.state.updateOrNot?(t.id=a.props.location.query.id,t.showNum=a.props.bannerInfo.showNum,t.status=a.props.bannerInfo.status,Object(j.i)("post","/homerecommend/updatehomerecommend",t,function(e){1===e.code?(a.setState({loading:!1}),g.a.success("修改成功！"),V.hashHistory.goBack()):(a.setState({loading:!1}),g.a.error(e.msg))})):Object(j.i)("post","/homerecommend/addhomerecommend",t,function(e){1===e.code?(a.setState({loading:!1}),g.a.success("添加成功！"),V.hashHistory.goBack()):(g.a.error(e.msg),a.setState({loading:!1}))})}})}),x(q(a),"specialIdChange",function(e){var t=q(a);console.log(e.target.value),a.setState({specialActive:e.target.value}),Object(j.i)("post","/topic/getTagsByTopicId",{id:e.target.value},function(e){if(1===e.code){var a=e.obj;console.log(a),t.setState({specialValShow:!0}),t.setState({specialVal:a||[]})}else t.setState({specialValShow:!1})})}),x(q(a),"specialKeyDown",function(e){var t=e.keyCode;46!==t&&8!==t||a.setState({ModifyActive:""})}),x(q(a),"specialValClick",function(e){var t=e.target.getAttribute("data-val");console.log("".concat(t,"/").concat(a.state.specialActive)),a.setState({specialActive:"".concat(t,"/").concat(a.state.specialActive)}),a.setState({specialValShow:!1})}),x(q(a),"channelIdChange",function(e){a.setState({channelId:e})}),x(q(a),"createMarkup",function(e){return{__html:e}}),a}var a,n,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,E["Component"]),a=t,(n=[{key:"componentDidUpdate",value:function(e,t){e.bannerInfo.typeLink!==this.props.bannerInfo.typeLink&&this.setState({specialActive:this.props.bannerInfo.typeLink})}},{key:"componentWillMount",value:function(){var e=this,t=this.props,a=t.dispatch,n=t.location;a(Object(B.f)()),n.query.id?(this.setState({loading:!0}),a(Object(N.a)({id:n.query.id},function(t){e.setState({position:t.position,updateOrNot:!0,mImgSrcFileList:[{uid:0,name:"xxx.png",status:"done",url:t.mImgSrc}],pcImgSrcFileList:[{uid:0,name:"xxx.png",status:"done",url:t.pcImgSrc}],mImgSrc:t.mImgSrc,pcImgSrc:t.pcImgSrc,loading:!1,place:t.showPlace.split(","),type:t.type.toString()})}))):this.setState({loading:!1})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.props.bannerInfo,n=this.state,l=n.previewVisible,i=n.previewImage,o=n.mImgSrcFileList,m=n.updateOrNot,d=n.pcImgSrcFileList,g={labelCol:{span:1},wrapperCol:{span:19}};console.log(this.state.ModifyActive);var y=C.a.createElement("div",null,C.a.createElement(u.a,{type:"plus"}),C.a.createElement("div",{className:"ant-upload-text"},"上传图片")),f=function(){return"2"===e.state.type?"新闻频道":"3"===e.state.type?"关键词/标签名":"1"===e.state.type?"新闻 ID":"4"===e.state.type?"跳转到专题":"5"===e.state.type?"作者信息":"6"===e.state.type?"广告":"7"===e.state.type?"跳转到链接":"8"===e.state.type?"跳转到活动":"9"===e.state.type?"跳转到产品":"待定"};return C.a.createElement("div",{className:"banner-send"},C.a.createElement(s.a,{spinning:this.state.loading,size:"large"},C.a.createElement(L.a,{onSubmit:this.handleSubmit},C.a.createElement(D,P({className:"bannerTitle"},g,{label:"标题 "}),t("title",{initialValue:m&&a?"".concat(a.title):"",rules:[{required:!0,message:"请输入Banner标题！"}]})(C.a.createElement(h.a,{className:"banner-name",placeholder:"请输入Banner标题"}))),C.a.createElement(D,P({className:"bannerTitle"},g,{label:"简介 "}),t("description",{initialValue:m&&a?"".concat(a.description):"",rules:[{required:!1,message:"请输入Banner简介！"}]})(C.a.createElement(K,{rows:4,className:"banner-name",placeholder:"请输入Banner简介"}))),C.a.createElement(D,P({className:"bannerTitle"},g,{label:"平台选择"}),t("showPlace",{initialValue:m&&a?a.showPlace.split(","):["1","2"],rules:[{required:!0,message:"请选择轮播位置！"}]})(C.a.createElement(H,{options:G,onChange:this.placeOnChange}))),C.a.createElement(D,P({className:"bannerTitle"},g,{label:"位置选择"}),t("position",{initialValue:m&&a?"".concat(a.position):"1",rules:[{required:!0,message:"请选择轮播位置！"}]})(C.a.createElement(M,{onChange:this.positionOnChange},j.O.map(function(e,t){return C.a.createElement(k.a,{key:t,value:e.value},e.label)})))),C.a.createElement(D,P({className:"bannerTitle"},g,{label:"跳转类型"}),t("type",{initialValue:m&&a?"".concat(a.type):"1",rules:[{required:!0,message:"请选择跳转类型！"}]})(C.a.createElement(M,{disabled:8===parseInt(this.state.position)||9===parseInt(this.state.position),onChange:this.typeOnChange},j.n.map(function(e,t){return C.a.createElement(k.a,{key:t,value:e.value},e.label)})))),"2"===e.state.type?C.a.createElement(D,P({},g,{className:"bannerTitle",label:f()}),t("typeLink_channel",{initialValue:m&&a?"".concat(a.typeLink||"1"):"1",rules:[{required:!0,message:"请选择新闻频道！"}]})(C.a.createElement(S.a,{style:{width:100},onChange:e.channelIdChange},e.props.channelList.map(function(e){return C.a.createElement(R,{value:e.value,key:e.value},e.label)})))):"3"===e.state.type?C.a.createElement(D,P({},g,{className:"bannerTitle",label:f()}),t("typeLink_tags",{initialValue:m&&a?a.typeLink:"",rules:[{required:!0,message:"请输入相关内容！"}]})(C.a.createElement(h.a,{placeholder:"请输入相关内容"}))):"4"===e.state.type?C.a.createElement(D,P({},g,{label:f()}),C.a.createElement("div",{className:"special-cont",style:{marginLeft:"15px"}},C.a.createElement(h.a,{placeholder:"示例：MarsBit特训营/20180725170844035121",value:e.state.specialActive,onChange:e.specialIdChange,onKeyDown:e.specialKeyDown}),C.a.createElement("div",{className:"special-select",style:{display:e.state.specialValShow?"block":"none"}},e.state.specialVal.map(function(t,a){return C.a.createElement("p",{key:a,"data-val":t,onClick:e.specialValClick.bind(event)},t)})))):"1"===e.state.type?C.a.createElement(D,P({},g,{className:"bannerTitle",label:f()}),t("typeLink",{initialValue:m&&a?"".concat(1===a.type?a.typeLink:""):"",rules:[{required:!0,message:"新闻 ID 不能为空！"}]})(C.a.createElement(h.a,{placeholder:"请输入跳转的新闻 ID"}))):"5"===e.state.type?C.a.createElement(D,P({},g,{className:"bannerTitle",label:f()}),t("typeLink_author",{initialValue:m&&a?"".concat(5===a.type?a.typeLink:""):"",rules:[{required:!0,message:"作者昵称/作者ID不能为空！"}]})(C.a.createElement(h.a,{placeholder:"请输入作者昵称/作者ID"}))):"6"===e.state.type||"7"===e.state.type||"8"===e.state.type||"9"===e.state.type?C.a.createElement(D,P({},g,{className:"bannerTitle",label:f()}),t("typeLink_ad",{initialValue:m&&a?"".concat(6===a.type||7===a.type||8===a.type||9===a.type?a.typeLink:""):"",rules:[{type:"url",message:"请输入正确的超链接！"},{required:!0,message:"地址不能为空！"}]})(C.a.createElement(h.a,{placeholder:"请输入相关链接"}))):C.a.createElement(D,P({},g,{className:"bannerTitle",label:f()}),t("typeLink",{initialValue:"",rules:[{required:!0,message:"内容不能为空！"}]})(C.a.createElement(h.a,{disabled:!0,placeholder:"待定"}))),C.a.createElement(D,P({},g,{label:"pc 端封面: ",className:"upload-div"}),C.a.createElement("div",{className:"dropbox"},t("pcImgSrc",{initialValue:m&&a?d:"",rules:[{required:!0,message:"请上传pc 封面图！"}]})(C.a.createElement(p.a,{headers:{"Sign-Param":Object(j.A)()},action:"".concat(j.a,"/pic/upload"),name:"uploadFile",listType:"picture-card",fileList:d,onPreview:this.handlePreview,onChange:this.handlePcImgChange},d.length>=1?null:y)),C.a.createElement("span",{className:"cover-img-tip"},"用于 pc 端首页推荐的封面图展示"))),C.a.createElement(D,P({},g,{label:"M 端封面: ",className:"upload-div"}),C.a.createElement("div",{className:"dropbox"},t("mImgSrc",{initialValue:m&&a?o:"",rules:[{required:!0,message:"请上传轮播封面图！"}]})(C.a.createElement(p.a,{headers:{"Sign-Param":Object(j.A)()},action:"".concat(j.a,"/pic/upload"),name:"uploadFile",listType:"picture-card",fileList:o,onPreview:this.handlePreview,onChange:this.handleMImgChange},o.length>=1?null:y)),C.a.createElement("span",{className:"cover-img-tip"},"用于 M 端相关模块封面图展示"))),C.a.createElement(D,{wrapperCol:{span:12,offset:2}},C.a.createElement(c.a,{type:"primary","data-status":"1",htmlType:"submit",style:{marginRight:"10px"}},"保存"),C.a.createElement(c.a,{type:"primary",className:"cancel",onClick:function(){V.hashHistory.goBack()}},"取消"))),C.a.createElement(r.a,{visible:l,footer:null,onCancel:this.handleCancel},C.a.createElement("img",{alt:"example",style:{width:"100%"},src:i}))))}}])&&_(a.prototype,n),l&&_(a,l),t}();t.default=Object(O.connect)(function(e){return{bannerInfo:e.bannerInfo.info,selectData:e.bannerInfo.selectedData,channelList:e.channelListInfo}})(L.a.create()(J))}}]);