(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{1440:function(e,t,a){"use strict";a.r(t),function(e){a(1376);var n=a(1377),r=a.n(n),i=(a(1388),a(1389)),o=a.n(i),l=(a(1381),a(1382)),s=a.n(l),c=(a(1383),a(1384)),u=a.n(c),p=(a(675),a(676)),m=a.n(p),g=(a(1392),a(1393)),d=a.n(g),h=(a(184),a(1378)),f=a.n(h),y=(a(1387),a(50)),b=a.n(y),v=(a(247),a(183)),w=a.n(v),S=(a(361),a(20)),E=a.n(S),O=(a(677),a(362)),I=a.n(O),j=(a(1379),a(1380)),T=a.n(j),x=a(0),C=a.n(x),N=a(246),L=a(1398),P=(a(1606),a(1692),a(48)),k=a(11),V=a.n(k),_=a(10),D=a(51),R=a.n(D);function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(){return(J=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function M(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function U(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(t){B(e,t,a[t])})}return e}function Y(e,t,a,n,r,i,o){try{var l=e[i](o),s=l.value}catch(e){return void a(e)}l.done?t(s):Promise.resolve(s).then(n,r)}function F(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function B(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var W,G,K=T.a.Item,Q=I.a.Option,X=function(t){function a(){var t,n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),n=this,r=q(a).call(this),t=!r||"object"!==A(r)&&"function"!=typeof r?H(n):r,B(H(t),"getBase64",function(e){return new Promise(function(t,a){var n=new FileReader;n.readAsDataURL(e),n.onload=function(){return t(n.result)},n.onerror=function(e){return a(e)}})}),B(H(t),"handleCancel",function(){t.setState({previewVisible:!1})}),B(H(t),"handlePreview",function(){var e,a=(e=regeneratorRuntime.mark(function e(a){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.url||a.preview){e.next=4;break}return e.next=3,t.getBase64(a.originFileObj);case 3:a.preview=e.sent;case 4:t.setState({previewImage:a.url||a.preview,previewVisible:!0});case 5:case"end":return e.stop()}},e)}),function(){var t=this,a=arguments;return new Promise(function(n,r){var i=e.apply(t,a);function o(e){Y(i,n,r,o,l,"next",e)}function l(e){Y(i,n,r,o,l,"throw",e)}o(void 0)})});return function(e){return a.apply(this,arguments)}}()),B(H(t),"handleUploadImg",function(a){var n=a.file,r=a.fileList,i=H(t);if(n.size/1048576>=2)return E.a.error("图片大小超过 2M , 请重新选择!"),t.setState({fileList:[],imgUrl:"",focusImg:-1}),!1;t.setState({fileList:r}),n.response&&1===n.response.code&&"done"===n.status&&t.setState({uploadAllImgModal:!0,imgUrl:n.response.obj,focusImg:-1},function(){var t=document.querySelector("#croppedImg");t.src=n.thumbUrl,i.setState({cropper:new L.a(t,{aspectRatio:this.state.ratio,viewMode:1,crop:function(t){var a=this.cropper.getCroppedCanvas({maxWidth:800}).toDataURL("image/jpeg",.85),n=e(".crop-preview-item"),r=i.state.focusImg;-1===r?n.each(function(t,n){e(this).children("img").attr("src",a)}):n.eq(r).children("img").attr("src",a)}})})})}),B(H(t),"uploadImgCancel",function(){t.setState({uploadAllImgModal:!1}),t.state.cropper.destroy()}),B(H(t),"sureCropImg",function(){var a=H(t);t.setState({loading:!0,uploadAllImgModal:!1,confirmLoading:!0}),E.a.warning("上传中，请稍候！"),t.state.cropper.destroy();var n=Object(P.r)(e(".crop-preview-item").find("img").prop("src")),r=new FormData;r.append("uploadFile",n),e.ajax("".concat(P.a,"/pic/upload"),{headers:{"Sign-Param":Object(P.A)()},method:"POST",data:r,processData:!1,timeout:3e4,contentType:!1,success:function(e){1===e.code&&(a.setState({loading:!1,confirmLoading:!1,cropImg:e.obj}),E.a.success("图片上传完毕！"))},error:function(e,t){a.setState({confirmLoading:!1,loading:!1}),"timeout"===t?E.a.error("上传超时, 请检查网络后重新上传！"):E.a.error("网络故障, 请尝试重新上传！"),e.abort()}})}),B(H(t),"handleSubmit",function(e){e.preventDefault(),t.props.form.validateFields(function(e,a){if(!e){var n=t.props.location.query.id;if(0===a.tagsV2.length)a.tagsV2="";else{var r=[];a.tagsV2.forEach(function(e){r.push(U({name:e.label},JSON.parse(e.key)))}),a.tagsV2=JSON.stringify(r)}var i={title:a.title,url:a.url,tagsV2:a.tagsV2,star:t.state.star,bgPicUrl:0===t.state.fileList.length?"":t.state.cropImg,publishTime:parseInt(Date.parse(a.publishTime)/1e3)};n?Object(P.i)("post","/chance/update",U({},i,{id:n}),function(e){1===e.code?(t.setState({loading:!1}),E.a.success("修改成功"),_.hashHistory.push("/cc-chanceLists")):E.a.error(e.msg)}):Object(P.i)("post","/chance/add",U({},i),function(e){1===e.code?(t.setState({loading:!1}),E.a.success("增加成功"),_.hashHistory.push("/cc-chanceLists")):E.a.error(e.msg)})}})}),B(H(t),"handleDeselect",function(e,a){var n=t.state.selectedTags.filter(function(t){return JSON.parse(t).id!==JSON.parse(e.key).id});t.setState({selectedTags:n})}),B(H(t),"handleTagsChange",function(e,a){e.map(function(e){e.title=Object(P.R)(JSON.parse(e.key).type,e.label)}),t.setState({value:e})}),B(H(t),"handleBlur",function(){t.setState({searchText:""})}),B(H(t),"handleSelect",function(e,t){e.type=t.props.dataType}),B(H(t),"handleDeselect",function(e,a){var n=t.state.selectedTags.filter(function(t){return JSON.parse(t).id!==JSON.parse(e.key).id});t.setState({selectedTags:n})}),B(H(t),"judgeExist",function(e,a){0===(a&&0!==a.length?a.filter(function(t){return t.name===e}):[]).length&&0!==a.length?t.setState({noCurrResult:!0}):t.setState({noCurrResult:!1})}),B(H(t),"getTagList",function(e){W&&(clearTimeout(W),W=null),G=e;W=setTimeout(function(){t.setState({searching:!0,data:[]}),Object(P.i)("post","/tagmgr/like",{name:e},function(a){if(t.setState({searching:!1}),t.judgeExist(G,a.obj),0===a.obj.length&&""!==e.trim()?t.setState({searchText:C.a.createElement("div",null,C.a.createElement("span",null,"未查询到相关标签, 是否创建?"),C.a.createElement(w.a,{type:"primary",loading:t.state.tagsIconLoading,style:{margin:"0 10px"},onClick:t.addNewTag,size:"small"},"是"),C.a.createElement(w.a,{type:"primary",size:"small",onClick:function(){t.setState({searchText:""})}},"否")),noCurrResult:!1}):t.setState({searchText:""}),G===e){var n=a.obj;t.setState({data:n})}})},500)}),B(H(t),"addNewTag",function(e){e.target.disabled=!0;var a=t.props.form;t.setState({tagsIconLoading:!0}),Object(P.i)("post","/tagmgr/addSimpleTag",{name:G,creator:R.a.get("hx_passportId")},function(e){t.setState({searchText:"",tagsIconLoading:!1,noCurrResult:!1});var n=[{title:"".concat(e.obj.name,"-聚合"),key:JSON.stringify({id:e.obj.id,type:e.obj.type}),type:e.obj.type,label:e.obj.name}];a.setFieldsValue({tagsV2:[].concat(M(a.getFieldValue("tagsV2")),n)})})}),B(H(t),"transTags",function(e){var t=[];return e.forEach(function(e){t.push({title:"".concat(Object(P.R)(e.type,e.name)),label:e.name,key:JSON.stringify({id:e.id,type:e.type})})}),t}),t.state={content:"",title:"",previewVisible:!1,previewImage:"",fileList:[],uploadAllImgModal:!1,imgUrl:"",cropImg:"",focusImg:-1,ratio:340/188,loading:!1,updateOrNot:!1,publishTime:"",url:"",cropImgRule:[{coverName:"mcImg",coverList:"mcfileList",width:"340px",height:"188px",ratio:340/188,intro:"图片尺寸: 340 * 188"}],searching:!1,data:[],searchText:"",noCurrResult:!1,tagsIconLoading:!1,selectedTags:[],tagsV2:[]},t}var n,i,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(a,x["Component"]),n=a,(i=[{key:"changeActiveImg",value:function(e,t,a){var n=this;if(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),a===this.state.focusImg)return!1;this.setState({ratio:t.ratio,focusImg:a},function(){n.state.cropper.setAspectRatio(t.ratio)})}},{key:"componentWillMount",value:function(){if(this.props.location.query.id&&R.a.get("hx_chance_id")){var e=R.a.get("hx_chance_title"),t=R.a.get("hx_chance_publishTime"),a=R.a.get("hx_chance_url"),n=R.a.get("hx_chance_tagsV2"),r=R.a.get("hx_chance_bgPicUrl"),i=[{uid:"-1",name:"xxx.png",status:"done",url:r}];this.setState({title:e,publishTime:t,url:a,tagsV2:n,cropImg:r,fileList:r?i:[]})}}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a={labelCol:{span:2},wrapperCol:{span:15}},n=this.state,i=n.previewVisible,l=n.previewImage,c=n.fileList,p=n.uploadAllImgModal,g=n.focusImg,h=n.title,y=n.publishTime,v=n.url,S=n.tagsV2,E=n.cropImg,O=n.data,j=this.props.location.query.id,x=this,N=C.a.createElement("div",null,C.a.createElement(b.a,{type:"plus"}),C.a.createElement("div",{className:"ant-upload-text"},"Upload")),L=O.map(function(e){return C.a.createElement(Q,{title:Object(P.R)(e.type,e.name),dataType:e.type,className:"tagType-".concat(e.type),value:JSON.stringify({id:e.id,type:e.type}),key:e.id},e.name)});return C.a.createElement("div",{className:"calendar-add"},C.a.createElement("h4",null,"新增机会"),C.a.createElement(T.a,{onSubmit:this.handleSubmit},C.a.createElement(m.a,{spinning:this.state.loading,size:"large"},C.a.createElement(K,J({},a,{label:C.a.createElement("span",null,"主标题   ")}),t("title",{rules:[{required:!0,message:"请输入主标题!",whitespace:!0}],initialValue:j?h:""})(C.a.createElement(f.a,{className:"calendar-title",placeholder:"主标题"}))),C.a.createElement(K,J({},a,{label:C.a.createElement("span",null,"选择时间   ")}),t("publishTime",{rules:[{required:!0,message:"请选时间！"}],initialValue:j?V()(Object(P.w)(1e3*y),"YYYY-MM-DD HH:mm:ss"):V()(Object(P.w)(Date.parse(new Date)),"YYYY-MM-DD HH:mm:ss")})(C.a.createElement(d.a,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss"}))),C.a.createElement(K,J({},a,{label:C.a.createElement("span",null,"链接地址   ")}),t("url",{rules:[{required:!1,type:"url",message:"请输入正确的超链接地址！"}],initialValue:j?v:""})(C.a.createElement(f.a,{className:"calendar-title",placeholder:"超链接地址"}))),C.a.createElement(s.a,null,C.a.createElement(u.a,null,C.a.createElement(K,J({},a,{label:"关联标签 ："}),t("tagsV2",{initialValue:j&&S&&0!==JSON.parse(S).length?this.transTags(JSON.parse(S)):[],rules:[{required:!1,message:"请选择相关标签！"}]})(C.a.createElement(I.a,{mode:"multiple",showSearch:!0,labelInValue:!0,notFoundContent:this.state.searching?C.a.createElement(m.a,{size:"small"}):this.state.searchText,filterOption:!1,optionFilterProp:"children",style:{width:"100%"},onSearch:this.getTagList,onSelect:this.handleSelect,onDeselect:this.handleDeselect,onChange:this.handleTagsChange,onBlur:this.handleBlur},L)),this.state.noCurrResult&&C.a.createElement("p",{style:{position:"absolute",right:"-160px",bottom:0}},C.a.createElement("span",null,"未找到结果?"),C.a.createElement(w.a,{type:"primary",loading:this.state.tagsIconLoading,style:{margin:"0 10px"},onClick:this.addNewTag,size:"small"},"创建"),C.a.createElement("span",null,"一个"))))),C.a.createElement(K,J({},a,{label:C.a.createElement("span",null,"上传图片   ")}),C.a.createElement("div",{className:"clearfix"},t("bgPicUrl",{initialValue:j?E:""})(C.a.createElement(o.a,{headers:{"Sign-Param":Object(P.A)()},action:"".concat(P.a,"/pic/upload"),name:"uploadFile",listType:"picture-card",fileList:c,onPreview:this.handlePreview,onChange:this.handleUploadImg},c.length>=1?null:N)),C.a.createElement(r.a,{visible:i,footer:null,onCancel:this.handleCancel},C.a.createElement("img",{alt:"example",style:{width:"100%"},src:l})))),C.a.createElement(r.a,{confirmLoading:this.state.confirmLoading,height:"550px",width:"1200px",visible:p,onOk:this.sureCropImg,maskClosable:!1,onCancel:this.uploadImgCancel},C.a.createElement("div",{className:"chance croper-wrap clearfix"},C.a.createElement("div",{className:"crop-img",id:"cropImgWrap"},C.a.createElement("img",{id:"croppedImg",src:"",alt:"Picture"})),C.a.createElement("div",{onClick:function(t){t.stopPropagation(),t.nativeEvent.stopImmediatePropagation(),e.setState({focusImg:-1})},className:"crop-preview"},this.state.cropImgRule.map(function(e,t){return C.a.createElement("div",{key:t,onClick:function(a){x.changeActiveImg(a,e,t)},className:"cropper-intro"},C.a.createElement("div",{className:"cropper-item-wrap ".concat(g===t?"active":"")},C.a.createElement("div",{"data-type":e.coverName,"data-list":e.coverList,className:"crop-preview-item",style:{fontSize:0,width:e.width,height:e.height}},C.a.createElement("img",{src:"",alt:"",style:{width:"100%",height:"100%"}}))),C.a.createElement("span",null,e.intro))})))),C.a.createElement(K,{wrapperCol:{span:12,offset:2}},C.a.createElement(w.a,{type:"primary",className:"submit",onClick:this.handleSubmit},"提交"),C.a.createElement(w.a,{type:"primary",className:"cancel",style:{marginLeft:"10px"}},"取消")))))}}])&&F(n.prototype,i),l&&F(n,l),a}();t.default=Object(N.connect)(null)(T.a.create()(X))}.call(this,a(97))}}]);