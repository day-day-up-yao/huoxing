(window.webpackJsonp=window.webpackJsonp||[]).push([[107],{1460:function(e,t,n){"use strict";n.r(t),function(e){n(1388);var a=n(1389),r=n.n(a),o=(n(678),n(363)),i=n.n(o),c=(n(675),n(676)),s=n.n(c),l=(n(1381),n(1382)),u=n.n(l),d=(n(1383),n(1384)),m=n.n(d),p=(n(247),n(183)),f=n.n(p),g=(n(1387),n(50)),v=n.n(g),b=(n(361),n(20)),y=n.n(b),h=(n(184),n(1378)),I=n.n(h),E=(n(1379),n(1380)),S=n.n(E),O=(n(1376),n(1377)),L=n.n(O),w=n(0),N=n.n(w),C=n(246),j=n(89),P=n(10),k=n(1628),T=n(1674),D=n(48);n(1648);function V(e){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.forEach(function(t){q(e,t,n[t])})}return e}function x(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var z=L.a.confirm,F=S.a.Item,R=I.a.TextArea,J=function(t){function n(){var t,a,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),a=this,r=A(n).call(this),t=!r||"object"!==V(r)&&"function"!=typeof r?M(a):r,q(M(t),"onChange",function(e){var t=e.target.value;z({title:"提示",content:"确认要删除吗 ?",onOk:function(){var e={castId:this.props.location.query.id,status:t};Object(D.i)("POST","/caster/room/update/status",_({},e),function(e){1===e.code?y.a.success("操作成功"):y.a.error(e.msg)})}})}),q(M(t),"sendPost",function(e){var n={content:"".concat(e.postContent)||""};t.setState(_({},t.state,n))}),q(M(t),"changeStatus",function(e){t.setState({userType:e.userType,userName:e.userName,userId:e.userId})}),q(M(t),"handleSubmit",function(e){e.preventDefault();var n=t.state,a=n.data,r=n.updateOrNot,o=n.content;t.props.form.setFieldsValue({content:o.replace(/style=['"][^"']+['"]/gi,"")}),t.props.form.validateFieldsAndScroll(function(e,n){if(n.imgSrc=t.state.coverImgUrl,n.content=JSON.stringify({content:{content:n.content,imgs:[n.imgSrc]}}),""===JSON.parse(n.content).content.content&&""===n.imgSrc)return!1;e||(t.setState({disabled:!0,loading:!0}),n.castId=t.props.location.query.id||"",n.userId=t.state.userId,r&&(delete n.castId,n.contentId=a.content.contentId),r?t.props.actions.updateLive(n,a.index,function(e){1===e.code?(t.cancelEdit(),t.setState({disabled:!1,content:"",loading:!1,updateOrNot:!1,visible:!1,fileList:[],previewImage:"",coverImgUrl:""})):(t.setState({disabled:!1,loading:!1}),y.a.error(e.msg))}):t.props.actions.addNewLive(n,function(e){1===e.code?(y.a.success("发表成功！"),t.cancelEdit(),t.setState({disabled:!1,content:"",loading:!1,visible:!1,fileList:[],previewImage:"",coverImgUrl:""})):(t.setState({disabled:!1,loading:!1}),y.a.error(e.msg))}))})}),q(M(t),"showModal",function(n,a){var r=JSON.parse(n.content.content),o=e(".live-editor-area");document.getElementsByClassName("shop-content")[0].scrollTop=0,t.props.actions.selectedData(n),o.focus(),t.props.form.setFieldsValue({roleId:n.user.userId}),t.setState({updateOrNot:!0,visible:!0,roleId:n.user.userId,userId:n.user.userId,castId:n.content.castId,content:r.content.content,data:_({},n,{index:a}),userName:n.user.userName,coverImgUrl:r.content.imgs[0],fileList:0===r.content.imgs[0].length?[]:[{uid:0,name:"xxx.png",status:"done",url:r.content.imgs[0]}]})}),q(M(t),"cancelEdit",function(){t.props.form.resetFields(),t.setState({updateOrNot:!1,visible:!1,content:""})}),q(M(t),"loadMore",function(){var e=t.props,n=e.location,a=e.actions,r=e.pageData;t.setState({contentLoading:!0}),a.getLiveContentList("more",{castId:n.query.id,currentPage:r.currentPage+1,pageSize:30},function(e){1===e.code?t.setState({contentLoading:!1,currentPage:r.currentPage+1}):t.setState({contentLoading:!1})})}),q(M(t),"changeLiveStatus",function(e){var n=e.target.getAttribute("data-status"),a=M(t);z({title:"提示",content:"确认要".concat("1"===n?"结束直播":"开始直播","吗 ?"),onOk:function(){var e={castId:a.props.location.query.id,status:"1"===n?"2":"1"};Object(D.i)("POST","/caster/room/update/status",_({},e),function(e){1===e.code?(y.a.success("操作成功!"),a.setState({radioValue:"1"===n?"2":"1"}),a.props.actions.setFilterData({status:"1"===n?"2":"1"})):y.a.error(e.msg)})}})}),q(M(t),"onChangeTextArea",function(e){var n=e.target.value;t.setState({content:n})}),q(M(t),"handleCancel",function(){return t.setState({previewVisible:!1})}),q(M(t),"handlePreview",function(e){t.setState({previewImage:e.url||e.thumbUrl,previewVisible:!0})}),q(M(t),"handleChange",function(e){var n=e.file,a=e.fileList;t.setState({fileList:a}),"removed"===n.status&&t.setState({coverImgUrl:""}),n.response&&(1===n.response.code&&"done"===n.status&&t.setState({coverImgUrl:n.response.obj}),"error"===n.status&&(y.a.error("网络错误，上传失败！"),t.setState({coverImgUrl:"",fileList:[]})))}),t.state={updateOrNot:!1,visible:!1,isEdit:!1,loading:!1,previewVisible:!1,previewImage:"",radioValue:"",disabled:!1,content:"",editorContent:"",data:{},contentLoading:!0,currentPage:1,editor:"",roleId:"",zcrId:"",guestId:"",title:"",guestList:[],presenterList:[],userType:1,userName:"",userId:"",fileList:[],coverImgUrl:""},t}var a,o,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(n,w["Component"]),a=n,(o=[{key:"componentWillMount",value:function(){var e=this,t=this.props,n=t.location,a=t.actions;a.getLiveItemInfo({castId:n.query.id},function(t){e.setState({title:t.title,roleId:"",zcrId:t.presenterId,guestId:t.guestId,radioValue:"".concat(t.status)||"0",presenterList:t.presenterList||[],guestList:t.guestList||[]})}),a.getLiveContentList("init",{castId:n.query.id,currentPage:1,pageSize:30},function(){e.setState({contentLoading:!1})})}},{key:"createMarkup",value:function(e){return{__html:e}}},{key:"setSimditor",value:function(e){this.setState({editor:e})}},{key:"delListItem",value:function(e,t){var n=this;z({title:"提示",content:"确认要删除吗 ?",onOk:function(){n.props.actions.delLiveItem({contentId:e},t)}})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,n=this.props,a=n.contentList,o=n.pageData,c=this.state,l=c.content,d=c.loading,p=c.contentLoading,g=c.radioValue,b=c.presenterList,y=c.guestList,h=c.fileList,I=c.previewVisible,E=c.previewImage,O=c.coverImgUrl,w=N.a.createElement("div",null,N.a.createElement(v.a,{type:"plus"}),N.a.createElement("div",{className:"ant-upload-text"},"上传图片"));return N.a.createElement("div",{className:"live-detail-content"},N.a.createElement(f.a,{type:"primary","data-status":g,style:{marginRight:"15px"},onClick:this.changeLiveStatus},"1"===g?"结束直播":"开始直播"),N.a.createElement(f.a,{type:"primary",className:"cancel",onClick:function(){P.hashHistory.goBack()}},"返回"),N.a.createElement("div",{className:"live-detail-title"},'正在 "',this.state.title,'" 直播间发布内容'),N.a.createElement("div",{className:"live-detail-section"},N.a.createElement(m.a,{span:8,className:"live-detail simditor"},N.a.createElement(s.a,{spinning:p,size:"large"},a?N.a.createElement("div",null,a.map(function(t,n){var a=JSON.parse(t.content.content),r=a.content?a.content:a.news,o=a.content?a.content.imgs:JSON.parse(a.news.coverPic).pc,i=r.content?r.content:r.title;return N.a.createElement("div",{key:n},N.a.createElement(u.a,{className:"item-section simditor-body"},N.a.createElement(m.a,{className:"item-content",dangerouslySetInnerHTML:e.createMarkup(i)}),N.a.createElement("img",{className:"item-section-img",style:{display:o?"block":"none"},src:o,alt:""}),N.a.createElement(m.a,{span:4,className:"item-opts"},N.a.createElement("a",{style:{display:r.msg&&r.title?"none":"inlinkBlock"},onClick:function(){e.showModal(t,n)}},"编辑"),N.a.createElement("a",{onClick:function(){e.delListItem(t.content.contentId,n)}},"删除")),N.a.createElement(m.a,{className:"item-date"},Object(D.w)(t.content.createTime),N.a.createElement("span",null,r.content?2===t.user.userType?"（主持人）":"（嘉宾）":"",t.user.userName))))}),0===a.length?N.a.createElement("div",{className:"tips"},"直播好像还没开始哦~"):e.state.currentPage>=o.pageCount?N.a.createElement("div",{className:"content-end"},"已加载全部~"):N.a.createElement("div",{className:"check-more-load",onClick:e.loadMore},"查看更多")):N.a.createElement("div",{className:"tips"},"加载中..."))),N.a.createElement(m.a,{span:11,offset:1,className:"live-editor"},N.a.createElement(s.a,{spinning:d,size:"large"},N.a.createElement(S.a,{onSubmit:this.handleSubmit},N.a.createElement(F,{label:"选择当前发言人："},t("roleId",{initialValue:this.state.roleId,rules:[{required:!0,message:"请选择当前发言人！"}]})(N.a.createElement(i.a.Group,{buttonStyle:"solid"},N.a.createElement("span",null,"主持人:"),N.a.createElement("div",null,b.map(function(t){return N.a.createElement(i.a.Button,{onClick:function(){return e.changeStatus(t)},key:t.userId,value:t.userId},t.userName)})),N.a.createElement("span",null,"嘉宾:"),N.a.createElement("div",null,y.map(function(t){return N.a.createElement(i.a.Button,{onClick:function(){return e.changeStatus(t)},key:t.userId,value:t.userId},t.userName)}))))),N.a.createElement(F,{label:"直播内容: "},t("content",{initialValue:l,rules:[{required:!1,message:"请输入直播内容！"}]})(N.a.createElement(R,{onChange:this.onChangeTextArea,placeholder:"请输入直播内容！",autosize:{minRows:6,maxRows:10},className:"live-editor-area"}))),N.a.createElement(F,{label:"插入图片: "},N.a.createElement("div",{className:"dropbox"},t("imgSrc",{initialValue:O,rules:[{required:!1,message:""}]})(N.a.createElement(r.a,{action:"".concat(D.a,"/pic/upload"),headers:{"Sign-Param":Object(D.A)()},name:"uploadFile",listType:"picture-card",fileList:h,onPreview:this.handlePreview,onChange:this.handleChange},h.length>=1?null:w)),N.a.createElement(L.a,{visible:I,footer:null,onCancel:this.handleCancel},N.a.createElement("img",{alt:"example",style:{width:"100%"},src:E})))),N.a.createElement(F,null,N.a.createElement(f.a,{disabled:this.state.disabled,type:"primary","data-status":"1",htmlType:"submit",style:{marginRight:"10px"}},"发表"),this.state.visible?N.a.createElement(f.a,{type:"primary","data-status":"2",htmlType:"button",style:{marginRight:"10px"},onClick:this.cancelEdit},"取消"):""))))))}}])&&x(a.prototype,o),c&&x(a,c),n}();t.default=Object(C.connect)(function(e){return{info:e.liveInfo.info,contentList:e.liveContent.list,pageData:e.liveContent.pageData}},function(e){return{actions:Object(j.bindActionCreators)({setFilterData:T.e,getLiveContentList:T.c,getLiveItemInfo:k.b,selectedData:T.d,addNewLive:T.a,delLiveItem:T.b,updateLive:T.f},e)}})(S.a.create()(J))}.call(this,n(97))},1674:function(e,t,n){"use strict";n.d(t,"d",function(){return l}),n.d(t,"c",function(){return u}),n.d(t,"a",function(){return d}),n.d(t,"b",function(){return m}),n.d(t,"f",function(){return p}),n.d(t,"e",function(){return v});n(361);var a=n(20),r=n.n(a),o=n(48),i=n(2);function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.forEach(function(t){s(e,t,n[t])})}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(e){return{type:i.xb,data:e}},u=function(e,t,n){return function(a){Object(o.i)("get","/caster/room/content/list",t?c({},t):{},function(t){if(1===t.code){var o=t.obj;"init"===e?a(f({list:o.inforList})):"more"===e&&a(g({list:o.inforList})),a(b({totalCount:o.recordCount,pageCount:o.pageCount,pageSize:o.pageSize,currentPage:o.currentPage})),n&&n(t)}else r.a.error(t.msg)})}},d=function(e,t){return function(n){Object(o.i)("POST","/caster/room/content/add",e,function(e){if(1===e.code){var a=e.obj;n({type:i.V.INSERT_LIVE,newLive:a}),t&&t(e)}else r.a.error(e.msg)})}},m=function(e,t,n){return function(a){Object(o.i)("post","/caster/room/content/delete",e,function(e){if(1===e.code){var o=e.obj;a({type:i.V.DEL_LIST_ITEM,actionData:o,index:t}),n&&n(e),r.a.success("删除成功！")}else r.a.error(e.msg)})}},p=function(e,t,n){return function(a){Object(o.i)("post","/caster/room/content/update",e,function(e){if(1===e.code){var o=e.obj;a({type:i.V.EDIT_LIST_ITEM,actionData:o,index:t}),n&&n(e),r.a.success("修改成功！")}else r.a.error(e.msg)})}},f=function(e){return{type:i.V.ADD_DATA,data:e}},g=function(e){return{type:i.V.MORE_DATA,data:e}},v=function(e){return{type:i.V.SET_FILTER_DATA,data:e}},b=function(e){return{type:i.V.SET_PAGE_DATA,data:e}}}}]);