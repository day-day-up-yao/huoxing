(window.webpackJsonp=window.webpackJsonp||[]).push([[174,43],{1468:function(t,e,n){"use strict";n.r(e),function(t){n(184);var o=n(1378),r=n.n(o),a=(n(675),n(676)),i=n.n(a),c=(n(1381),n(1382)),s=n.n(c),u=(n(1383),n(1384)),l=n.n(u),d=(n(247),n(183)),f=n.n(d),p=(n(361),n(20)),m=n.n(p),b=(n(1379),n(1380)),g=n.n(b),y=(n(1376),n(1377)),v=n.n(y),h=n(0),O=n.n(h),S=n(246),E=n(89),j=n(1650),w=n(10),T=n(1628),I=n(1674),P=n(48);n(1649);function _(t){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(e){N(t,e,n[e])})}return t}function C(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function D(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function N(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var x=v.a.confirm,V=g.a.Item,q=function(e){function n(){var e,o,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),o=this,r=k(n).call(this),e=!r||"object"!==_(r)&&"function"!=typeof r?D(o):r,N(D(e),"onChange",function(t){var e=t.target.value;x({title:"提示",content:"确认要删除吗 ?",onOk:function(){var t={castId:this.props.location.query.id,status:e};Object(P.i)("POST","/caster/room/update/status",L({},t),function(t){1===t.code?m.a.success("操作成功"):m.a.error(t.msg)})}})}),N(D(e),"sendPost",function(t){var n={content:"".concat(t.postContent)||""};e.setState(L({},e.state,n))}),N(D(e),"clear",function(){e.state.editor.setValue("")}),N(D(e),"handleSubmit",function(t){t.preventDefault();var n=e.state,o=n.data,r=n.updateOrNot,a=n.content;e.props.form.setFieldsValue({content:a}),e.props.form.validateFieldsAndScroll(function(t,n){t||(e.setState({disabled:!0,loading:!0}),n.castId=e.props.location.query.id||"",n.userId=e.props.info.presenterId,r&&(delete n.castId,n.contentId=o.contentId),r?e.props.actions.updateLive(n,o.index,function(t){1===t.code?(e.clear(),e.setState({disabled:!1,content:"",loading:!1,updateOrNot:!1})):(e.setState({disabled:!1,loading:!1}),m.a.error(t.msg))}):e.props.actions.addNewLive(n,function(t){1===t.code?(m.a.success("发表成功！"),e.clear(),e.setState({disabled:!1,content:"",loading:!1})):(e.setState({disabled:!1,loading:!1}),m.a.error(t.msg))}))})}),N(D(e),"showModal",function(n,o){var r=t(".live-editor .simditor-body");document.getElementsByClassName("shop-content")[0].scrollTop=0,e.props.actions.selectedData(n),r.html(n.content),r.focus(),e.setState({updateOrNot:!0,visible:!0,content:n.content,data:L({},n,{index:o})})}),N(D(e),"loadMore",function(){var t=e.props,n=t.location,o=t.actions,r=t.pageData;e.setState({contentLoading:!0}),o.getLiveContentList("more",{castId:n.query.id,currentPage:r.currentPage+1,pageSize:30},function(t){1===t.code?e.setState({contentLoading:!1,currentPage:r.currentPage+1}):e.setState({contentLoading:!1})})}),N(D(e),"changeLiveStatus",function(t){var n=t.target.getAttribute("data-status"),o=D(e);x({title:"提示",content:"确认要".concat("1"===n?"结束直播":"开始直播","吗 ?"),onOk:function(){var t={castId:o.props.location.query.id,status:"1"===n?"2":"1"};Object(P.i)("POST","/caster/room/update/status",L({},t),function(t){1===t.code?(m.a.success("操作成功!"),o.setState({radioValue:"1"===n?"2":"1"}),o.props.actions.setFilterData({status:"1"===n?"2":"1"})):m.a.error(t.msg)})}})}),e.state={updateOrNot:!1,visible:!1,isEdit:!1,loading:!1,previewVisible:!1,previewImage:"",radioValue:"",disabled:!1,content:"",editorContent:"",data:{},contentLoading:!0,currentPage:1,editor:""},e}var o,a,c;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}(n,h["Component"]),o=n,(a=[{key:"componentWillMount",value:function(){var t=this,e=this.props,n=e.location,o=e.actions;o.getLiveItemInfo({castId:n.query.id},function(e){t.setState({radioValue:"".concat(e.status)||"0"})}),o.getLiveContentList("init",{castId:n.query.id,currentPage:1,pageSize:30},function(){t.setState({contentLoading:!1})})}},{key:"createMarkup",value:function(t){return{__html:t}}},{key:"setSimditor",value:function(t){this.setState({editor:t})}},{key:"delListItem",value:function(t,e){var n=this;x({title:"提示",content:"确认要删除吗 ?",onOk:function(){n.props.actions.delLiveItem({contentId:t},e)}})}},{key:"render",value:function(){var t=this,e=this.props.form.getFieldDecorator,n=this.props,o=n.contentList,a=n.pageData,c=this.state,u=c.content,d=c.loading,p=c.contentLoading,m=c.data,b=c.updateOrNot,y=c.radioValue;return O.a.createElement("div",{className:"specialTopic-detail-content"},O.a.createElement(f.a,{type:"primary","data-status":y,style:{marginRight:"15px"},onClick:this.changeLiveStatus},"1"===y?"结束直播":"开始直播"),O.a.createElement(f.a,{type:"primary",className:"cancel",onClick:function(){w.hashHistory.goBack()}},"返回"),O.a.createElement("div",{className:"specialTopic-detail-section"},O.a.createElement(l.a,{span:8,className:"specialTopic-detail simditor"},O.a.createElement(i.a,{spinning:p,size:"large"},o?O.a.createElement("div",null,o.map(function(e,n){return O.a.createElement(s.a,{className:"item-section simditor-body",key:n},O.a.createElement(l.a,{className:"item-content",dangerouslySetInnerHTML:t.createMarkup(e.content)}),O.a.createElement(l.a,{span:4,className:"item-opts"},O.a.createElement("a",{onClick:function(){t.showModal(e,n)}},"编辑"),O.a.createElement("a",{onClick:function(){t.delListItem(e.contentId,n)}},"删除")),O.a.createElement(l.a,{span:9,className:"item-date"},Object(P.w)(e.createTime)))}),0===o.length?O.a.createElement("div",{className:"tips"},"直播好像还没开始哦~"):t.state.currentPage>=a.pageCount?O.a.createElement("div",{className:"content-end"},"已加载全部~"):O.a.createElement("div",{className:"check-more-load",onClick:t.loadMore},"查看更多")):O.a.createElement("div",{className:"tips"},"加载中..."))),O.a.createElement(l.a,{span:11,offset:1,className:"specialTopic-editor"},O.a.createElement(i.a,{spinning:d,size:"large"},O.a.createElement(g.a,{onSubmit:this.handleSubmit},O.a.createElement(V,{label:"直播内容: "},e("content",{initialValue:"",rules:[{required:!0,message:"请输入直播内容！"}]})(O.a.createElement(r.a,{className:"news",style:{display:"none"}})),O.a.createElement(j.a,{setSimditor:function(e){return t.setSimditor(e)},toolBar:["fontScale","image","title","bold","italic","underline","strikethrough","color","ol","ul","alignment"],info:{postContent:b?m.content:u},subSend:function(e){return t.sendPost(e)}})),O.a.createElement(V,null,O.a.createElement(f.a,{disabled:this.state.disabled,type:"primary","data-status":"1",htmlType:"submit",style:{marginRight:"10px"}},"发表")))))))}}])&&C(o.prototype,a),c&&C(o,c),n}();e.default=Object(S.connect)(function(t){return{info:t.liveInfo.info,contentList:t.liveContent.list,pageData:t.liveContent.pageData}},function(t){return{actions:Object(E.bindActionCreators)({setFilterData:I.e,getLiveContentList:I.c,getLiveItemInfo:T.b,selectedData:I.d,addNewLive:I.a,delLiveItem:I.b,updateLive:I.f},t)}})(g.a.create()(q))}.call(this,n(97))},1628:function(t,e,n){"use strict";n.d(e,"c",function(){return u}),n.d(e,"a",function(){return l}),n.d(e,"b",function(){return d}),n.d(e,"f",function(){return p}),n.d(e,"d",function(){return m}),n.d(e,"e",function(){return b});n(361);var o=n(20),r=n.n(o),a=n(48),i=n(2);function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(e){s(t,e,n[e])})}return t}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(t,e,n){return function(o){var i="init"===t?"/caster/room/list":"/post/search";Object(a.i)("get",i,e?c({},e):{},function(t){if(1===t.code){var e=t.obj;o(f({list:e.inforList})),o(b({totalCount:e.recordCount,pageSize:e.pageSize,currentPage:e.currentPage})),n&&n(e)}else r.a.error(t.msg)})}},l=function(t,e){return function(n){Object(a.i)("get","/caster/usertype/list",t,function(o){if(1===o.code){var a=o.obj;1===parseInt(t.type)?n({type:i.U.GET_GUEST_LIST,actionData:a}):n({type:i.U.GET_ZCR_LIST,actionData:a}),e&&e(a)}else r.a.error(o.msg)})}},d=function(t,e){return function(n){Object(a.i)("post","/caster/room/one",c({},t),function(t){if(1===t.code){var o=t.obj;n(f({info:o})),e&&e(o)}else r.a.error(t.msg)})}},f=function(t){return{type:i.U.ADD_DATA,data:t}},p=function(t){return{type:i.U.SET_SEARCH_QUERY,data:t}},m=function(t){return{type:i.U.SET_FILTER_DATA,data:t}},b=function(t){return{type:i.U.SET_PAGE_DATA,data:t}}},1650:function(t,e,n){"use strict";n(184);var o=n(1378),r=n.n(o),a=n(0),i=n.n(a),c=n(246),s=n(97),u=n.n(s),l=n(1399),d=n.n(l),f=(n(1640),n(1622)),p=n.n(f),m=(n(1651),n(48));n(1623);function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function y(t,e){return!e||"object"!==b(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var O=r.a.TextArea,S="",E=function(t){function e(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=y(this,v(e).call(this,t));var o=t.info,r=t.toolBar;return n.state={postContent:o&&o.postContent?o.postContent:""},n.EDITTOOLBAR=r||["title","bold","italic","underline","strikethrough","fontScale","color","ol","ul","blockquote","code","table","link","image","hr","indent","outdent","alignment","clearhtml"],n}var n,o,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(e,a["Component"]),n=e,(o=[{key:"componentDidMount",value:function(){var t=this;(S=new d.a({pasteImage:!0,textarea:u()(".editor"),defaultImage:p.a,toolbar:this.EDITTOOLBAR,upload:{pasteImage:!0,url:"".concat(m.a,"/picture/upload"),params:{type:"news"},fileKey:"uploadFile",connectionCount:1,headers:{"Sign-Param":Object(m.A)()},leaveConfirm:"正在上传文件",success:function(t){this.editor.opts.upload.headers["Sign-Param"]=Object(m.A)();var e="",n="";return 1!==t.code?(e=t.msg||this._t("uploadFailed"),window.layer.msg(e),n=this.defaultImage):n=t.obj,n}}})).on("focus",function(){var t=u()(".toolbar-menu-title").find("li");t.eq(2).hide(),t.eq(3).hide(),t.eq(6).hide(),t.eq(7).hide();var e=u()(".link-popover").find(".settings-field");e.eq(0).hide(),e.eq(1).find("input").val(""),e.eq(2).hide()}),S.on("pasting",function(t,e){e.each(function(){u()(this).removeAttr("style"),u()(this).find("*").removeAttr("style"),u()(this).removeAttr("class"),u()(this).find("*").removeAttr("class")});var n=u()(e[0]),o=Object(m.G)(n.html())?n.html():[],r=u()(".simditor-body"),a=u()(".simditor");setTimeout(function(){r.children("p").each(function(){var t=u()(this),e=u()(this).html();Object(m.G)(e)&&e.indexOf("signTime")>-1&&e.indexOf("imgSrc")>-1&&t.remove()})},10);0!==o.length&&(a.find(".simditorModal").length>0?u()(".simditorModal").show():a.append('<div class="simditorModal" style="position:absolute;top: 0;left: 0;z-index: 6; width:100%;height:100%;box-sizing:border-box;padding-top:40px;text-align: center;line-height: 150%;font-size: 1.2rem;background-color: rgba(255,255,255,0.5);">图片上传中</div>'),Object(m.i)("POST","/pic/url_upload",{data:o},function(t){1===t.code&&(u.a.each(t.obj,function(t,e){var n="pasteUploadingImg"+e.signTime;u()("img[src="+n+"]").attr("src",e.imgSrc)}),u()(".simditorModal").hide(),S.setValue(r.html()))}))}),this.props.setSimditor&&this.props.setSimditor(S);var e=this.props.info;e&&e.postContent&&S.setValue(e.postContent),S.on("valuechanged ",function(e){t.setState({postContent:S.getValue()}),t.sendPost()})}},{key:"sendPost",value:function(){(0,this.props.subSend)(this.state)}},{key:"clearContent",value:function(){S.setValue(""),this.setState({postContent:""})}},{key:"render",value:function(){return i.a.createElement("div",{className:"editor-post-content"},i.a.createElement(O,{className:"editor",autosize:!0}))}}])&&g(n.prototype,o),r&&g(n,r),e}();e.a=Object(c.connect)(function(t){return{query:t.postInfo.query}})(E)},1651:function(t,e,n){var o=n(1652);"string"==typeof o&&(o=[[t.i,o,""]]);var r={transform:void 0};n(186)(o,r);o.locals&&(t.exports=o.locals)},1652:function(t,e,n){(t.exports=n(185)(!1)).push([t.i,"",""])},1674:function(t,e,n){"use strict";n.d(e,"d",function(){return u}),n.d(e,"c",function(){return l}),n.d(e,"a",function(){return d}),n.d(e,"b",function(){return f}),n.d(e,"f",function(){return p}),n.d(e,"e",function(){return g});n(361);var o=n(20),r=n.n(o),a=n(48),i=n(2);function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(e){s(t,e,n[e])})}return t}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(t){return{type:i.xb,data:t}},l=function(t,e,n){return function(o){Object(a.i)("get","/caster/room/content/list",e?c({},e):{},function(e){if(1===e.code){var a=e.obj;"init"===t?o(m({list:a.inforList})):"more"===t&&o(b({list:a.inforList})),o(y({totalCount:a.recordCount,pageCount:a.pageCount,pageSize:a.pageSize,currentPage:a.currentPage})),n&&n(e)}else r.a.error(e.msg)})}},d=function(t,e){return function(n){Object(a.i)("POST","/caster/room/content/add",t,function(t){if(1===t.code){var o=t.obj;n({type:i.V.INSERT_LIVE,newLive:o}),e&&e(t)}else r.a.error(t.msg)})}},f=function(t,e,n){return function(o){Object(a.i)("post","/caster/room/content/delete",t,function(t){if(1===t.code){var a=t.obj;o({type:i.V.DEL_LIST_ITEM,actionData:a,index:e}),n&&n(t),r.a.success("删除成功！")}else r.a.error(t.msg)})}},p=function(t,e,n){return function(o){Object(a.i)("post","/caster/room/content/update",t,function(t){if(1===t.code){var a=t.obj;o({type:i.V.EDIT_LIST_ITEM,actionData:a,index:e}),n&&n(t),r.a.success("修改成功！")}else r.a.error(t.msg)})}},m=function(t){return{type:i.V.ADD_DATA,data:t}},b=function(t){return{type:i.V.MORE_DATA,data:t}},g=function(t){return{type:i.V.SET_FILTER_DATA,data:t}},y=function(t){return{type:i.V.SET_PAGE_DATA,data:t}}}}]);